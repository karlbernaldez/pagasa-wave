import{g as al,b as DL,r as Te,j as ue,d as pn,c as CM,t as a5,f as rx,h as Jg,i as kL,k as EM,R as Do,n as AM,m as ll,l as uh}from"./index-CbM3mBlV.js";import{G as Ps,M as PM,a as MM}from"./index-Dm-_dRF2.js";import"./index-C7om5-QH.js";import{S as Po}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{A as Hy,m as qy}from"./proxy-5lmoJ-mh.js";import{c as cS}from"./createLucideIcon-BvXpfdCH.js";import{X as l5}from"./x-D_uShodW.js";import{F as c5}from"./file-text-BEBqW1FH.js";import{C as OL}from"./calendar-QWcjwBBT.js";import{C as LL}from"./circle-alert-TIXdJSGU.js";import{l as zL}from"./auth-DWBqGp9a.js";var IM=DL();const i1=al(IM);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FL=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],u5=cS("file",FL);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],NL=cS("type",BL);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VL=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],o1=cS("upload",VL);var L1={exports:{}},UL=L1.exports,d5;function jL(){return d5||(d5=1,(function(t,s){(function(c,p){t.exports=p()})(UL,(function(){var c,p,g;function v(r,E){if(!c)c=E;else if(!p)p=E;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",I={};c(I),g=E(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}v(["exports"],(function(r){var E=1e-6,A=typeof Float32Array<"u"?Float32Array:Array;function I(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=i*f-u*l;return m?(o[0]=f*(m=1/m),o[1]=-l*m,o[2]=-u*m,o[3]=i*m,o):null}function F(){var o=new A(9);return A!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function z(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=e[4],w=e[5],C=e[6],M=e[7],B=e[8];return o[0]=m*B-w*M,o[1]=u*M-l*B,o[2]=l*w-u*m,o[3]=w*C-f*B,o[4]=i*B-u*C,o[5]=u*f-i*w,o[6]=f*M-m*C,o[7]=l*C-i*M,o[8]=i*m-l*f,o}function R(o,e,i){var l=e[0],u=e[1],f=e[2],m=e[3],w=e[4],C=e[5],M=e[6],B=e[7],U=e[8],$=i[0],Q=i[1],ee=i[2],he=i[3],_e=i[4],ve=i[5],De=i[6],ke=i[7],ze=i[8];return o[0]=$*l+Q*m+ee*M,o[1]=$*u+Q*w+ee*B,o[2]=$*f+Q*C+ee*U,o[3]=he*l+_e*m+ve*M,o[4]=he*u+_e*w+ve*B,o[5]=he*f+_e*C+ve*U,o[6]=De*l+ke*m+ze*M,o[7]=De*u+ke*w+ze*B,o[8]=De*f+ke*C+ze*U,o}function D(){var o=new A(16);return A!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function O(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function N(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=e[4],w=e[5],C=e[6],M=e[7],B=e[8],U=e[9],$=e[10],Q=e[11],ee=e[12],he=e[13],_e=e[14],ve=e[15],De=i*w-l*m,ke=i*C-u*m,ze=i*M-f*m,Je=l*C-u*w,Qe=l*M-f*w,st=u*M-f*C,lt=B*he-U*ee,ft=B*_e-$*ee,Ut=B*ve-Q*ee,vt=U*_e-$*he,$t=U*ve-Q*he,tn=$*ve-Q*_e,qt=De*tn-ke*$t+ze*vt+Je*Ut-Qe*ft+st*lt;return qt?(o[0]=(w*tn-C*$t+M*vt)*(qt=1/qt),o[1]=(u*$t-l*tn-f*vt)*qt,o[2]=(he*st-_e*Qe+ve*Je)*qt,o[3]=($*Qe-U*st-Q*Je)*qt,o[4]=(C*Ut-m*tn-M*ft)*qt,o[5]=(i*tn-u*Ut+f*ft)*qt,o[6]=(_e*ze-ee*st-ve*ke)*qt,o[7]=(B*st-$*ze+Q*ke)*qt,o[8]=(m*$t-w*Ut+M*lt)*qt,o[9]=(l*Ut-i*$t-f*lt)*qt,o[10]=(ee*Qe-he*ze+ve*De)*qt,o[11]=(U*ze-B*Qe-Q*De)*qt,o[12]=(w*ft-m*vt-C*lt)*qt,o[13]=(i*vt-l*ft+u*lt)*qt,o[14]=(he*ke-ee*Je-_e*De)*qt,o[15]=(B*Je-U*ke+$*De)*qt,o):null}function H(o,e,i){var l=e[0],u=e[1],f=e[2],m=e[3],w=e[4],C=e[5],M=e[6],B=e[7],U=e[8],$=e[9],Q=e[10],ee=e[11],he=e[12],_e=e[13],ve=e[14],De=e[15],ke=i[0],ze=i[1],Je=i[2],Qe=i[3];return o[0]=ke*l+ze*w+Je*U+Qe*he,o[1]=ke*u+ze*C+Je*$+Qe*_e,o[2]=ke*f+ze*M+Je*Q+Qe*ve,o[3]=ke*m+ze*B+Je*ee+Qe*De,o[4]=(ke=i[4])*l+(ze=i[5])*w+(Je=i[6])*U+(Qe=i[7])*he,o[5]=ke*u+ze*C+Je*$+Qe*_e,o[6]=ke*f+ze*M+Je*Q+Qe*ve,o[7]=ke*m+ze*B+Je*ee+Qe*De,o[8]=(ke=i[8])*l+(ze=i[9])*w+(Je=i[10])*U+(Qe=i[11])*he,o[9]=ke*u+ze*C+Je*$+Qe*_e,o[10]=ke*f+ze*M+Je*Q+Qe*ve,o[11]=ke*m+ze*B+Je*ee+Qe*De,o[12]=(ke=i[12])*l+(ze=i[13])*w+(Je=i[14])*U+(Qe=i[15])*he,o[13]=ke*u+ze*C+Je*$+Qe*_e,o[14]=ke*f+ze*M+Je*Q+Qe*ve,o[15]=ke*m+ze*B+Je*ee+Qe*De,o}function j(o,e,i){var l,u,f,m,w,C,M,B,U,$,Q,ee,he=i[0],_e=i[1],ve=i[2];return e===o?(o[12]=e[0]*he+e[4]*_e+e[8]*ve+e[12],o[13]=e[1]*he+e[5]*_e+e[9]*ve+e[13],o[14]=e[2]*he+e[6]*_e+e[10]*ve+e[14],o[15]=e[3]*he+e[7]*_e+e[11]*ve+e[15]):(u=e[1],f=e[2],m=e[3],w=e[4],C=e[5],M=e[6],B=e[7],U=e[8],$=e[9],Q=e[10],ee=e[11],o[0]=l=e[0],o[1]=u,o[2]=f,o[3]=m,o[4]=w,o[5]=C,o[6]=M,o[7]=B,o[8]=U,o[9]=$,o[10]=Q,o[11]=ee,o[12]=l*he+w*_e+U*ve+e[12],o[13]=u*he+C*_e+$*ve+e[13],o[14]=f*he+M*_e+Q*ve+e[14],o[15]=m*he+B*_e+ee*ve+e[15]),o}function V(o,e,i){var l=i[0],u=i[1],f=i[2];return o[0]=e[0]*l,o[1]=e[1]*l,o[2]=e[2]*l,o[3]=e[3]*l,o[4]=e[4]*u,o[5]=e[5]*u,o[6]=e[6]*u,o[7]=e[7]*u,o[8]=e[8]*f,o[9]=e[9]*f,o[10]=e[10]*f,o[11]=e[11]*f,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function Z(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[4],m=e[5],w=e[6],C=e[7],M=e[8],B=e[9],U=e[10],$=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=f*u+M*l,o[5]=m*u+B*l,o[6]=w*u+U*l,o[7]=C*u+$*l,o[8]=M*u-f*l,o[9]=B*u-m*l,o[10]=U*u-w*l,o[11]=$*u-C*l,o}function X(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],w=e[2],C=e[3],M=e[8],B=e[9],U=e[10],$=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=f*u-M*l,o[1]=m*u-B*l,o[2]=w*u-U*l,o[3]=C*u-$*l,o[8]=f*l+M*u,o[9]=m*l+B*u,o[10]=w*l+U*u,o[11]=C*l+$*u,o}function se(o,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],w=e[2],C=e[3],M=e[4],B=e[5],U=e[6],$=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=f*u+M*l,o[1]=m*u+B*l,o[2]=w*u+U*l,o[3]=C*u+$*l,o[4]=M*u-f*l,o[5]=B*u-m*l,o[6]=U*u-w*l,o[7]=$*u-C*l,o}function ge(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ae(o,e,i){var l,u,f,m=i[0],w=i[1],C=i[2],M=Math.sqrt(m*m+w*w+C*C);return M<E?null:(m*=M=1/M,w*=M,C*=M,l=Math.sin(e),u=Math.cos(e),o[0]=m*m*(f=1-u)+u,o[1]=w*m*f+C*l,o[2]=C*m*f-w*l,o[3]=0,o[4]=m*w*f-C*l,o[5]=w*w*f+u,o[6]=C*w*f+m*l,o[7]=0,o[8]=m*C*f+w*l,o[9]=w*C*f-m*l,o[10]=C*C*f+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function oe(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=i+i,w=l+l,C=u+u,M=i*m,B=l*m,U=l*w,$=u*m,Q=u*w,ee=u*C,he=f*m,_e=f*w,ve=f*C;return o[0]=1-U-ee,o[1]=B+ve,o[2]=$-_e,o[3]=0,o[4]=B-ve,o[5]=1-M-ee,o[6]=Q+he,o[7]=0,o[8]=$+_e,o[9]=Q-he,o[10]=1-M-U,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var fe=H;function pe(){var o=new A(3);return A!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function K(o){var e=new A(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function ye(o){var e=o[0],i=o[1],l=o[2];return Math.sqrt(e*e+i*i+l*l)}function J(o,e,i){var l=new A(3);return l[0]=o,l[1]=e,l[2]=i,l}function de(o,e,i,l){return o[0]=e,o[1]=i,o[2]=l,o}function Ae(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o[2]=e[2]+i[2],o}function ne(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],o}function xe(o,e,i){return o[0]=e[0]*i[0],o[1]=e[1]*i[1],o[2]=e[2]*i[2],o}function Ce(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o}function Re(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o}function Ee(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o}function Oe(o,e,i,l){return o[0]=e[0]+i[0]*l,o[1]=e[1]+i[1]*l,o[2]=e[2]+i[2]*l,o}function Be(o,e){var i=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return i*i+l*l+u*u}function at(o){var e=o[0],i=o[1],l=o[2];return e*e+i*i+l*l}function ut(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function nt(o,e){var i=e[0],l=e[1],u=e[2],f=i*i+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),o[0]=e[0]*f,o[1]=e[1]*f,o[2]=e[2]*f,o}function $e(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function ct(o,e,i){var l=e[0],u=e[1],f=e[2],m=i[0],w=i[1],C=i[2];return o[0]=u*C-f*w,o[1]=f*m-l*C,o[2]=l*w-u*m,o}function At(o,e,i,l){var u=e[0],f=e[1],m=e[2];return o[0]=u+l*(i[0]-u),o[1]=f+l*(i[1]-f),o[2]=m+l*(i[2]-m),o}function xt(o,e,i){var l=e[0],u=e[1],f=e[2],m=i[3]*l+i[7]*u+i[11]*f+i[15];return o[0]=(i[0]*l+i[4]*u+i[8]*f+i[12])/(m=m||1),o[1]=(i[1]*l+i[5]*u+i[9]*f+i[13])/m,o[2]=(i[2]*l+i[6]*u+i[10]*f+i[14])/m,o}function It(o,e,i){var l=e[0],u=e[1],f=e[2];return o[0]=l*i[0]+u*i[3]+f*i[6],o[1]=l*i[1]+u*i[4]+f*i[7],o[2]=l*i[2]+u*i[5]+f*i[8],o}function jt(o,e,i){var l=i[0],u=i[1],f=i[2],m=i[3],w=e[0],C=e[1],M=e[2],B=u*M-f*C,U=f*w-l*M,$=l*C-u*w;return o[0]=w+m*(B+=B)+u*($+=$)-f*(U+=U),o[1]=C+m*U+f*B-l*$,o[2]=M+m*$+l*U-u*B,o}function cn(o){return o[0]=0,o[1]=0,o[2]=0,o}function Se(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var mt=ne,Ke=xe,Ue=ye;function je(){var o=new A(4);return A!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function gt(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o[3]=e[3]*i,o}function Ot(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=i*i+l*l+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),o[0]=i*m,o[1]=l*m,o[2]=u*m,o[3]=f*m,o}function Ft(o,e,i){var l=e[0],u=e[1],f=e[2],m=e[3];return o[0]=i[0]*l+i[4]*u+i[8]*f+i[12]*m,o[1]=i[1]*l+i[5]*u+i[9]*f+i[13]*m,o[2]=i[2]*l+i[6]*u+i[10]*f+i[14]*m,o[3]=i[3]*l+i[7]*u+i[11]*f+i[15]*m,o}function pt(){var o=new A(4);return A!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function dn(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function An(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],w=Math.sin(i),C=Math.cos(i);return o[0]=l*C+m*w,o[1]=u*C+f*w,o[2]=f*C-u*w,o[3]=m*C-l*w,o}function Gt(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],w=Math.sin(i),C=Math.cos(i);return o[0]=l*C-f*w,o[1]=u*C+m*w,o[2]=f*C+l*w,o[3]=m*C-u*w,o}pe(),je();var Yt,zn,$n,On=Ot,Bn=(Yt=pe(),zn=J(1,0,0),$n=J(0,1,0),function(o,e,i){var l=$e(e,i);return l<-.999999?(ct(Yt,zn,e),Ue(Yt)<1e-6&&ct(Yt,$n,e),nt(Yt,Yt),(function(u,f,m){m*=.5;var w=Math.sin(m);u[0]=w*f[0],u[1]=w*f[1],u[2]=w*f[2],u[3]=Math.cos(m)})(o,Yt,Math.PI),o):l>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(ct(Yt,e,i),o[0]=Yt[0],o[1]=Yt[1],o[2]=Yt[2],o[3]=1+l,On(o,o))});function kn(){var o=new A(2);return A!=Float32Array&&(o[0]=0,o[1]=0),o}function Pr(o,e){var i=new A(2);return i[0]=o,i[1]=e,i}function mr(o,e,i){return o[0]=e,o[1]=i,o}function ni(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o}function tr(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o}function Br(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o}function Tr(o){var e=o[0],i=o[1];return Math.sqrt(e*e+i*i)}function Fr(o,e){var i=e[0],l=e[1],u=i*i+l*l;return u>0&&(u=1/Math.sqrt(u)),o[0]=e[0]*u,o[1]=e[1]*u,o}function di(o,e){return o[0]*e[0]+o[1]*e[1]}pt(),pt(),F();var Mo,ds,Yr=tr;function co(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}kn();var ya=(function(){if(ds)return Mo;function o(e,i,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=l,this.p2y=u}return ds=1,Mo=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<i)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=f/m}var w=0,C=1;for(l=e,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<i));u++)e>f?w=l:C=l,l=.5*(C-w)+w;return l},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Mo})(),cl=co(ya);function Kt(o,e){this.x=o,this.y=e}function yo(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(!yo(o[i],e[i]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const i in o)if(!yo(o[i],e[i]))return!1;return!0}return o===e}Kt.prototype={clone(){return new Kt(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,i=o.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),i=Math.sin(o),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround(o,e){const i=Math.cos(o),l=Math.sin(o),u=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Kt},Kt.convert=function(o){if(o instanceof Kt)return o;if(Array.isArray(o))return new Kt(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Kt(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const ca=Math.PI/180,Va=180/Math.PI;function _t(o){return o*ca}function we(o){return o*Va}const Ie=[[0,0],[1,0],[1,1],[0,1]];function Ge(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,i=e*o;return 4*(o<.5?i:3*(o-e)+i-.75)}function it(o,e,i,l){const u=new cl(o,e,i,l);return function(f){return u.solve(f)}}const tt=it(.25,.1,.25,1);function et(o,e,i){return Math.min(i,Math.max(e,o))}function Ct(o,e,i){return(i=et((i-o)/(e-o),0,1))*i*(3-2*i)}function dt(o,e,i){const l=i-e,u=((o-e)%l+l)%l+e;return u===e?i:u}function Rt(o,e,i){if(!o.length)return i(null,[]);let l=o.length;const u=new Array(o.length);let f=null;o.forEach(((m,w)=>{e(m,((C,M)=>{C&&(f=C),u[w]=M,--l==0&&i(f,u)}))}))}let un=1;function Wt(){return un++}function qn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function lr(o,e){o.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function fr(o,e,i){const l={};for(const u in o)l[u]=e.call(this,o[u],u,o);return l}function Nr(o,e,i){const l={};for(const u in o)e.call(this,o[u],u,o)&&(l[u]=o[u]);return l}function Ir(o){return Array.isArray(o)?o.map(Ir):typeof o=="object"&&o?fr(o,Ir):o}function gr(o,e){for(let i=0;i<o.length;i++)if(e.indexOf(o[i])>=0)return!0;return!1}const wi={};function Vr(o){wi[o]||(typeof console<"u"&&console.warn(o),wi[o]=!0)}function fo(o,e,i){return(i.y-o.y)*(e.x-o.x)>(e.y-o.y)*(i.x-o.x)}function ko(o){let e=0;for(let i,l,u=0,f=o.length,m=f-1;u<f;m=u++)i=o[u],l=o[m],e+=(l.x-i.x)*(i.y+l.y);return e}function jo([o,e,i]){const l=_t(e+90),u=_t(i);return{x:o*Math.cos(l)*Math.sin(u),y:o*Math.sin(l)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:i}}function bi(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function ai(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,l,u,f)=>{const m=u||f;return e[l]=!m||m.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let io=null;function yi(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Hr(o,e,i,l){for(;e<i;){const u=e+i>>1;o[u]<l?e=u+1:i=u}return e}function ts(o,e,i,l){for(;e<i;){const u=e+i>>1;o[u]<=l?e=u+1:i=u}return e}function rs(o){return o>0?1/(1.001-o):1+o}function $s(o){return o>0?1-1/(1.001-o):-o}function ul(o,e,i){return(o-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Oo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Oo.API_URL)return null;try{const o=new URL(Oo.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function dc(o){return Oo.API_URL_REGEX.test(o)}function vf(o){return Oo.API_SPRITE_REGEX.test(o)}let zl,Cu,pd,md,hc,gd;function xf(){return zl==null&&(zl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),zl}const Ua={now:()=>md!==void 0?md:performance.now(),setNow(o){md=o},restoreNow(){md=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:i,height:l}=o;hc||(hc=document.createElement("canvas"));const u=hc.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>hc.width||l>hc.height)&&(hc.width=i,hc.height=l),u.clearRect(-e,-e,i+2*e,l+2*e),u.drawImage(o,0,0,i,l),u.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:o=>(Cu||(Cu=document.createElement("a")),Cu.href=o,Cu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(pd==null&&(pd=window.matchMedia("(prefers-reduced-motion: reduce)")),pd.matches)},hasCanvasFingerprintNoise(){if(gd!==void 0)return gd;if(!xf())return gd=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,o.width,o.height);i=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&i++!==l.data[u])return gd=!0,!0;return gd=!1,!1}};function bf(o,e){const i=o.indexOf("?");if(i<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(i));for(const u in e)l.set(u,e[u]);return`${o.slice(0,i)}?${l.toString()}`}function wf(o,e={persistentParams:[]}){const i=o.indexOf("?");if(i<0)return o;const l=new URLSearchParams,u=new URLSearchParams(o.slice(i));for(const m of e.persistentParams){const w=u.get(m);w&&l.set(m,w)}const f=l.toString();return`${o.slice(0,i)}${f.length>0?`?${f}`:""}`}const va="mapbox-tiles";let ja=500,Fl=50;const Pa=["language","worldview","jobid"];let Is,Nc;function Sf(){try{return caches}catch{}}function _d(){const o=Sf();o&&Is==null&&(Is=o.open(va))}let fc=1/0;const bh={supported:!1,testSupport:function(o){!Hs&&dl&&(Tf?Bl(o):yd=o)}};let yd,dl,Hs=!1,Tf=!1;const Eu=typeof self<"u"?self:{};function Bl(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,dl),o.isContextLost())return;bh.supported=!0}catch{}o.deleteTexture(e),Hs=!0}Eu.document&&(dl=Eu.document.createElement("img"),dl.onload=function(){yd&&Bl(yd),yd=null,Tf=!0},dl.onerror=function(){Hs=!0,yd=null},dl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const wh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(wh);class Cf extends Error{constructor(e,i,l){i===401&&dc(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sh=bi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Wr=function(o,e){if(!(/^file:/.test(i=o.url)||/^file:/.test(Sh())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,u){const f=new AbortController,m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Sh(),referrerPolicy:l.referrerPolicy,signal:f.signal});let w=!1,C=!1;const M=(B=m.url).indexOf("sku=")>0&&dc(B);var B;l.type==="json"&&m.headers.set("Accept","application/json");const U=(Q,ee,he)=>{if(C)return;if(Q&&Q.message!=="SecurityError"&&Vr(Q.toString()),ee&&he)return $(ee);const _e=Date.now();fetch(m).then((ve=>{if(ve.ok){const De=M?ve.clone():null;return $(ve,De,_e)}return u(new Cf(ve.statusText,ve.status,l.url))})).catch((ve=>{ve.name!=="AbortError"&&u(new Error(`${ve.message} ${l.url}`))}))},$=(Q,ee,he)=>{(l.type==="arrayBuffer"?Q.arrayBuffer():l.type==="json"?Q.json():Q.text()).then((_e=>{C||(ee&&he&&(function(ve,De,ke){if(_d(),Is==null)return;const ze=ai(De.headers.get("Cache-Control")||"");if(ze["no-store"])return;const Je={status:De.status,statusText:De.statusText,headers:new Headers};De.headers.forEach(((lt,ft)=>Je.headers.set(ft,lt))),ze["max-age"]&&Je.headers.set("Expires",new Date(ke+1e3*ze["max-age"]).toUTCString());const Qe=Je.headers.get("Expires");if(!Qe||new Date(Qe).getTime()-ke<42e4)return;let st=wf(ve.url,{persistentParams:Pa});if(De.status===206){const lt=ve.headers.get("Range");if(!lt)return;Je.status=200,st=bf(st,{range:lt})}(function(lt,ft){if(Nc===void 0)try{new Response(new ReadableStream),Nc=!0}catch{Nc=!1}Nc?ft(lt.body):lt.blob().then(ft).catch((Ut=>Vr(Ut.message)))})(De,(lt=>{const ft=new Response((Ut=De.status)!==200&&Ut!==404&&[101,103,204,205,304].includes(Ut)?null:lt,Je);var Ut;_d(),Is?.then((vt=>vt.put(st,ft))).catch((vt=>Vr(vt.message)))}))})(m,ee,he),w=!0,u(null,_e,Q.headers.get("Cache-Control"),Q.headers.get("Expires")))})).catch((_e=>{C||u(new Error(_e.message))}))};return M?(function(Q,ee){if(_d(),Is==null)return ee(null);Is.then((he=>{let _e=wf(Q.url,{persistentParams:Pa});const ve=Q.headers.get("Range");ve&&(_e=bf(_e,{range:ve})),he.match(_e).then((De=>{const ke=(function(ze){if(!ze)return!1;const Je=new Date(ze.headers.get("Expires")||0),Qe=ai(ze.headers.get("Cache-Control")||"");return Number(Je)>Date.now()&&!Qe["no-cache"]})(De);he.delete(_e).catch(ee),ke&&he.put(_e,De.clone()).catch(ee),ee(null,De,ke)})).catch(ee)})).catch(ee)})(m,U):U(null,null),{cancel:()=>{C=!0,w||f.abort()}}})(o,e);if(bi(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var i;return(function(l,u){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in l.headers)f.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(l.type==="json")try{m=JSON.parse(f.response)}catch(w){return u(w)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Cf(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}})(o,e)},Au=function(o,e){return Wr(Object.assign(o,{type:"arrayBuffer"}),e)};function Gp(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Ef="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Th,pc;Th=[],pc=0;const Vc=function(o,e){if(bh.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),pc>=Oo.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Th.push(f),f}pc++;let i=!1;const l=()=>{if(!i)for(i=!0,pc--;Th.length&&pc<Oo.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Th.shift(),{requestParameters:m,callback:w,cancelled:C}=f;C||(f.cancel=Vc(m,w).cancel)}},u=Au(o,((f,m,w,C)=>{l(),f?e(f):m&&(self.createImageBitmap?(function(M,B){const U=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(U).then(($=>{B(null,$)})).catch(($=>{B(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(m,((M,B)=>e(M,B,w,C))):(function(M,B){const U=new Image;U.onload=()=>{B(null,U),URL.revokeObjectURL(U.src),U.onload=null,requestAnimationFrame((()=>{U.src=Ef}))},U.onerror=()=>B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(M)],{type:"image/png"});U.src=M.byteLength?URL.createObjectURL($):Ef})(m,((M,B)=>e(M,B,w,C))))}));return{cancel:()=>{u.cancel(),l()}}};var vd,Ch,$p,mc={exports:{}},Hp={exports:{}},Af={exports:{}},xd=(function(){if($p)return mc.exports;$p=1;var o=(vd||(vd=1,Hp.exports=function(i,l){var u,f,m,w,C,M,B,U;for(f=i.length-(u=3&i.length),m=l,C=3432918353,M=461845907,U=0;U<f;)B=255&i.charCodeAt(U)|(255&i.charCodeAt(++U))<<8|(255&i.charCodeAt(++U))<<16|(255&i.charCodeAt(++U))<<24,++U,m=27492+(65535&(w=5*(65535&(m=(m^=B=(65535&(B=(B=(65535&B)*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*M+(((B>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(B=0,u){case 3:B^=(255&i.charCodeAt(U+2))<<16;case 2:B^=(255&i.charCodeAt(U+1))<<8;case 1:m^=B=(65535&(B=(B=(65535&(B^=255&i.charCodeAt(U)))*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*M+(((B>>>16)*M&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Hp.exports),e=(Ch||(Ch=1,Af.exports=function(i,l){for(var u,f=i.length,m=l^f,w=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:m^=(255&i.charCodeAt(w+2))<<16;case 2:m^=(255&i.charCodeAt(w+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(w)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Af.exports);return mc.exports=o,mc.exports.murmur3=o,mc.exports.murmur2=e,mc.exports})(),Pf=co(xd);class Ga{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class gc extends Ga{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function bd(o,e,i){i[o]&&i[o].indexOf(e)!==-1||(i[o]=i[o]||[],i[o].push(e))}function qs(o,e,i){if(i&&i[o]){const l=i[o].indexOf(e);l!==-1&&i[o].splice(l,1)}}class Uc{on(e,i){return this._listeners=this._listeners||{},bd(e,i,this._listeners),this}off(e,i){return qs(e,i,this._listeners),qs(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},bd(e,i,this._oneTimeListeners),this):new Promise((l=>{this.once(e,l)}))}fire(e,i){const l=typeof e=="string"?new Ga(e,i):e,u=l.type;if(this.listens(u)){l.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const C of f)C.call(this,l);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const C of m)qs(u,C,this._oneTimeListeners),C.call(this,l);const w=this._eventedParent;if(w){const C=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,C),w.fire(l)}}else l instanceof gc&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class xa{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new xa(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,l]=e.split("");return new xa({name:i,iconsetId:l})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return xa.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var wd,jc={},Sd=(function(){if(wd)return jc;wd=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function l(f){return(m=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:m>1?1:m;var m}function u(f,m,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?f+(m-f)*w*6:2*w<1?m:3*w<2?f+(m-f)*(2/3-w)*6:f}try{jc.parseCSSColor=function(f){var m,w=f.replace(/ /g,"").toLowerCase();if(w in o)return o[w].slice();if(w[0]==="#")return w.length===4?(m=parseInt(w.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:w.length===7&&(m=parseInt(w.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var C=w.indexOf("("),M=w.indexOf(")");if(C!==-1&&M+1===w.length){var B=w.substr(0,C),U=w.substr(C+1,M-(C+1)).split(","),$=1;switch(B){case"rgba":if(U.length!==4)return null;$=l(U.pop());case"rgb":return U.length!==3?null:[i(U[0]),i(U[1]),i(U[2]),$];case"hsla":if(U.length!==4)return null;$=l(U.pop());case"hsl":if(U.length!==3)return null;var Q=(parseFloat(U[0])%360+360)%360/360,ee=l(U[1]),he=l(U[2]),_e=he<=.5?he*(ee+1):he+ee-he*ee,ve=2*he-_e;return[e(255*u(ve,_e,Q+1/3)),e(255*u(ve,_e,Q)),e(255*u(ve,_e,Q-1/3)),$];default:return null}}return null}}catch{}return jc})();class mi{constructor(e,i,l,u=1){this.r=e,this.g=i,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof mi)return e;if(typeof e!="string")return;const i=Sd.parseCSSColor(e);return i?new mi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:l,b:u,a:f}=this;return new _c(e,i,l,u,f)}toPremultipliedRenderColor(e){const{r:i,g:l,b:u,a:f}=this;return new Eh(e,i*f,l*f,u*f,f)}clone(){return new mi(this.r,this.g,this.b,this.a)}}class Mf{constructor(e,i,l,u,f,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const w=e.image.height,C=w*w;this.premultiplied?(i=f===0?0:i/f*(w-1),l=f===0?0:l/f*(w-1),u=f===0?0:u/f*(w-1)):(i*=w-1,l*=w-1,u*=w-1);const M=Math.floor(i),B=Math.floor(l),U=Math.floor(u),$=Math.ceil(i),Q=Math.ceil(l),ee=Math.ceil(u),he=i-M,_e=l-B,ve=u-U,De=e.image.data,ke=4*(M+B*C+U*w),ze=4*(M+B*C+ee*w),Je=4*(M+Q*C+U*w),Qe=4*(M+Q*C+ee*w),st=4*($+B*C+U*w),lt=4*($+B*C+ee*w),ft=4*($+Q*C+U*w),Ut=4*($+Q*C+ee*w);if(ke<0||Ut>=De.length)throw new Error("out of range");this.r=Qn(Qn(Qn(De[ke],De[ze],ve),Qn(De[Je],De[Qe],ve),_e),Qn(Qn(De[st],De[lt],ve),Qn(De[ft],De[Ut],ve),_e),he)/255*(this.premultiplied?f:1),this.g=Qn(Qn(Qn(De[ke+1],De[ze+1],ve),Qn(De[Je+1],De[Qe+1],ve),_e),Qn(Qn(De[st+1],De[lt+1],ve),Qn(De[ft+1],De[Ut+1],ve),_e),he)/255*(this.premultiplied?f:1),this.b=Qn(Qn(Qn(De[ke+2],De[ze+2],ve),Qn(De[Je+2],De[Qe+2],ve),_e),Qn(Qn(De[st+2],De[lt+2],ve),Qn(De[ft+2],De[Ut+2],ve),_e),he)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=l,this.b=u,this.a=f}toArray(){const{r:e,g:i,b:l,a:u}=this;return[255*e,255*i,255*l,u]}toHslaArray(){let{r:e,g:i,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const ee=1/u;e*=ee,i*=ee,l*=ee}const f=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),w=Math.min(Math.max(l,0),1),C=Math.min(f,m,w),M=Math.max(f,m,w),B=M-C,U=.5*(C+M);if(B===0)return[0,0,100*U,u];const $=U>.5?B/(2-M-C):B/(M+C);let Q;switch(M){case f:Q=60*((m-w)/B+(m<w?6:0));break;case m:Q=60*((w-f)/B+2);break;default:Q=60*((f-m)/B+4)}return[Q,100*$,100*U,u]}toArray01(){const{r:e,g:i,b:l,a:u}=this;return[e,i,l,u]}toArray01Scaled(e){const{r:i,g:l,b:u}=this;return[i*e,l*e,u*e]}toArray01Linear(){const{r:e,g:i,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(l,2.2),u]}}class _c extends Mf{constructor(e,i,l,u,f){super(e,i,l,u,f,!1)}}class Eh extends Mf{constructor(e,i,l,u,f){super(e,i,l,u,f,!0)}}function Qn(o,e,i){return o*(1-i)+e*i}function hl(o,e,i){return o.map(((l,u)=>Qn(l,e[u],i)))}mi.black=new mi(0,0,0,1),mi.white=new mi(1,1,1,1),mi.transparent=new mi(0,0,0,0),mi.red=new mi(1,0,0,1),mi.blue=new mi(0,0,1,1);var Ws=Object.freeze({__proto__:null,array:hl,color:function(o,e,i){return new mi(Qn(o.r,e.r,i),Qn(o.g,e.g,i),Qn(o.b,e.b,i),Qn(o.a,e.a,i))},number:Qn});class Ma extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ah{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,u]of i)this.bindings[l]=u}concat(e){return new Ah(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const fl={kind:"null"},jn={kind:"number"},li={kind:"string"},gi={kind:"boolean"},Zs={kind:"color"},Gc={kind:"object"},ci={kind:"value"},If={kind:"collator"},Go={kind:"formatted"},Td={kind:"resolvedImage"};function ys(o,e){return{kind:"array",itemType:o,N:e}}function Lo(o){if(o.kind==="array"){const e=Lo(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Qm=[fl,jn,li,gi,Zs,Go,Gc,ys(ci),Td];function Cd(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cd(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const i of Qm)if(!Cd(i,e))return null}}return`Expected ${Lo(o)} but found ${Lo(e)} instead.`}function Ed(o,e){return e.some((i=>i.kind===o.kind))}function Pu(o,e){return e.some((i=>i==="null"?o===null:i==="array"?Array.isArray(o):i==="object"?o&&!Array.isArray(o)&&typeof o=="object":i===typeof o))}function Ad(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&Ad(o.itemType,e.itemType):o.kind===e.kind}class yc{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ph{constructor(e,i,l,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=u,this.textColor=f}}class vs{constructor(e){this.sections=e}static fromString(e){return new vs([new Ph(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof vs?e:vs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Ia{constructor(e,i={}){if(this.id=xa.from(e),this.options=Object.assign({},i),i.transform){const{a:l,b:u,c:f,d:m,e:w,f:C}=i.transform;this.options.transform=new DOMMatrix([l,u,f,m,w,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:l,d:u,e:f,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:l,d:u,e:f,f:m}})}static parse(e){let i,l,u,f;try{({name:i,iconsetId:l,params:u,transform:f}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:m,b:w,c:C,d:M,e:B,f:U}=f||{};return new Ia({name:i,iconsetId:l},{params:u,transform:new DOMMatrix([m,w,C,M,B,U])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Ys{constructor(e,i,l,u,f=!1){this.primaryId=xa.from(e),this.primaryOptions=i,l&&(this.secondaryId=xa.from(l)),this.secondaryOptions=u,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ia(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ia(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ys.build({name:e}):e}static build(e,i,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new Ys(e,l,i,u)}}function Rf(o,e,i,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,i,l]:[o,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vc(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof mi||o instanceof yc||o instanceof vs||o instanceof Ys)return!0;if(Array.isArray(o)){for(const e of o)if(!vc(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!vc(o[e]))return!1;return!0}return!1}function $o(o){if(o===null)return fl;if(typeof o=="string")return li;if(typeof o=="boolean")return gi;if(typeof o=="number")return jn;if(o instanceof mi)return Zs;if(o instanceof yc)return If;if(o instanceof vs)return Go;if(o instanceof Ys)return Td;if(Array.isArray(o)){const e=o.length;let i;for(const l of o){const u=$o(l);if(i){if(i===u)continue;i=ci;break}i=u}return ys(i||ci,e)}return Gc}function Xs(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof vs||o instanceof Ys||o instanceof mi?o.toString():JSON.stringify(o)}class br{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!vc(e[1]))return i.error("invalid value");const l=e[1];let u=$o(l);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new br(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof mi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof vs?this.value.serialize():this.value}}class Pn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ra={string:li,number:jn,boolean:gi,object:Gc};class sr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,u=1;const f=e[0];if(f==="array"){let w,C;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in Ra)||M==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ra[M],u++}else w=ci;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);C=e[2],u++}l=ys(w,C)}else l=Ra[f];const m=[];for(;u<e.length;u++){const w=i.parse(e[u],u,ci);if(!w)return null;m.push(w)}return new sr(l,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Cd(this.type,$o(l)))return l;if(i===this.args.length-1)throw new Pn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Lo($o(l))} but was expected to be of type ${Lo(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map((l=>l.serialize())))}}class Mu{constructor(e){this.type=Go,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const w=e[m];if(f&&typeof w=="object"&&!Array.isArray(w)){f=!1;let C=null;if(w["font-scale"]&&(C=i.parseObjectValue(w["font-scale"],m,"font-scale",jn),!C))return null;let M=null;if(w["text-font"]&&(M=i.parseObjectValue(w["text-font"],m,"text-font",ys(li)),!M))return null;let B=null;if(w["text-color"]&&(B=i.parseObjectValue(w["text-color"],m,"text-color",Zs),!B))return null;const U=u[u.length-1];U.scale=C,U.font=M,U.textColor=B}else{const C=i.parse(e[m],m,ci);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:C,scale:null,font:null,textColor:null})}}return new Mu(u)}evaluate(e){return new vs(this.sections.map((i=>{const l=i.content.evaluate(e);return Ad($o(l),Td)?new Ph("",l,null,null,null):new Ph(Xs(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class Iu{constructor(e,i,l,u){this._imageWarnHistory={},this.type=Td,this.namePrimary=e,this.nameSecondary=i,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let l=1;const u=[];function f(){if(l<e.length){const w=i.parse(e[l],l++,li);return w?(u.push({image:w,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(l<e.length){const C=e[l];if((w=C)===null||typeof w!="object"||Array.isArray(w))return!0;const M=C.params,B=C.iconset,U=i.concat(l);if(!M&&!B)return l++,!0;if(M){if(typeof M!="object"||M.constructor!==Object)return U.error('Image options "params" should be an object'),!1;const $={},Q=U.concat(void 0,"params");for(const ee in M){if(!ee)return Q.error("Image parameter name should be non-empty"),!1;const he=Q.concat(void 0,ee).parse(M[ee],void 0,Zs,void 0,{typeAnnotation:"coerce"});if(!he)return!1;$[ee]=he}u[u.length-1].options.params=$}if(B){if(typeof B!="object"||B.constructor!==Object)return U.error('Image options "iconset" should be an object'),!1;if(!B.id)return U.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=B}return l++,!0}var w;return!0}for(let w=0;w<2;w++)if(!f()||!m())return;return new Iu(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const l={};if(i){for(const u in i)if(i[u])try{l[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Ys.build(i,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const f=u.getPrimary().id;if(u.available=e.availableImages.some((m=>xa.isEqual(m,f))),u.available){const m=u.getSecondary()?u.getSecondary().id:null;m&&(u.available=e.availableImages.some((w=>xa.isEqual(w,m))))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const l={};if(i&&(l.iconset={id:i}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function er(o){return Ru(o)?"string":Pd(o)?"number":kf(o)?"boolean":Array.isArray(o)?"array":o===null?"null":Df(o)?"object":typeof o}function Df(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function Ru(o){return typeof o=="string"||o instanceof String}function Pd(o){return typeof o=="number"||o instanceof Number}function kf(o){return typeof o=="boolean"||o instanceof Boolean}const Md={"to-boolean":gi,"to-color":Zs,"to-number":jn,"to-string":li};class vo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0],u=[];let f=fl;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=ys(i.expectedType.itemType,m)}else{if(!(m>0&&vc(e[1][0])))return null;f=ys($o(e[1][0]),m)}for(let w=0;w<m;w++){const C=e[1][w];let M;if(Array.isArray(C))M=i.parse(C,void 0,f.itemType);else{const B=er(C);if(B!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${B}.`);M=i.registry.literal.parse(["literal",C===void 0?null:C],i)}if(!M)return null;u.push(M)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=Md[l];for(let m=1;m<e.length;m++){const w=i.parse(e[m],m,ci);if(!w)return null;u.push(w)}}return new vo(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const u of this.args){if(i=u.evaluate(e),l=null,i instanceof mi)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Rf(i[0],i[1],i[2],i[3]),!l))return new mi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Pn(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Pn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?vs.fromString(Xs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ys.build(Xs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Xs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Mu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Iu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const Of=["Unknown","Point","LineString","Polygon"];class $a{constructor(e,i,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Of[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=mi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class is{constructor(e,i,l,u,f){this.name=e,this.type=i,this._evaluate=l,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=is.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const l=e[0],u=is.definitions[l];if(!u)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,w=[];let C=null,M=-1;for(const[B,U]of m){if(Array.isArray(B)&&B.length!==e.length-1)continue;w.push(B),M++,C=new Fh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const $=[];let Q=!1;for(let ee=1;ee<e.length;ee++){const he=e[ee],_e=Array.isArray(B)?B[ee-1]:B.type,ve=C.parse(he,1+$.length,_e);if(!ve){Q=!0;break}$.push(ve)}if(!Q)if(Array.isArray(B)&&B.length!==$.length)C.error(`Expected ${B.length} arguments, but found ${$.length} instead.`);else{for(let ee=0;ee<$.length;ee++){const he=Array.isArray(B)?B[ee]:B.type,_e=$[ee];C.concat(ee+1).checkSubtype(he,_e.type)}if(C.errors.length===0)return new is(l,f,U,$,M)}}if(w.length===1)i.errors.push(...C.errors);else{const B=(w.length?w:m.map((([$])=>$))).map(po).join(" | "),U=[];for(let $=1;$<e.length;$++){const Q=i.parse(e[$],1+U.length);if(!Q)return null;U.push(Lo(Q.type))}i.error(`Expected arguments of type ${B}, but found (${U.join(", ")}) instead.`)}return null}static register(e,i){is.definitions=i;for(const l in i)e[l]=is}}function po(o){return Array.isArray(o)?`(${o.map(Lo).join(", ")})`:`(${Lo(o.type)}...)`}class hs{constructor(e,i,l){this.type=If,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?i.parse(!1,1,gi):i.parseObjectValue(l["case-sensitive"],1,"case-sensitive",gi);if(!u)return null;const f=l["diacritic-sensitive"]===void 0?i.parse(!1,1,gi):i.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",gi);if(!f)return null;let m=null;return l.locale&&(m=i.parseObjectValue(l.locale,1,"locale",li),!m)?null:new hs(u,f,m)}evaluate(e){return new yc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function eg(o,e,i=0,l=o.length-1,u=Mh){for(;l>i;){if(l-i>600){const C=l-i+1,M=e-i+1,B=Math.log(C),U=.5*Math.exp(2*B/3),$=.5*Math.sqrt(B*U*(C-U)/C)*(M-C/2<0?-1:1);eg(o,e,Math.max(i,Math.floor(e-M*U/C+$)),Math.min(l,Math.floor(e+(C-M)*U/C+$)),u)}const f=o[e];let m=i,w=l;for(Id(o,i,e),u(o[l],f)>0&&Id(o,i,l);m<w;){for(Id(o,m,w),m++,w--;u(o[m],f)<0;)m++;for(;u(o[w],f)>0;)w--}u(o[i],f)===0?Id(o,i,w):(w++,Id(o,w,l)),w<=e&&(i=w+1),e<=w&&(l=w-1)}}function Id(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}function Mh(o,e){return o<e?-1:o>e?1:0}function pl(o){let e=0;for(let i,l,u=0,f=o.length,m=f-1;u<f;m=u++)i=o[u],l=o[m],e+=(l.x-i.x)*(i.y+l.y);return e}function Du(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Ha(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Ih(o,e,i){const l=o[0]-e[0],u=o[1]-e[1],f=o[0]-i[0],m=o[1]-i[1];return l*m-f*u==0&&l*f<=0&&u*m<=0}function ua(o,e,i=!1){let l=!1;for(let w=0,C=e.length;w<C;w++){const M=e[w];for(let B=0,U=M.length,$=U-1;B<U;$=B++){const Q=M[$],ee=M[B];if(Ih(o,Q,ee))return i;(f=Q)[1]>(u=o)[1]!=(m=ee)[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(l=!l)}}var u,f,m;return l}function qp(o,e,i,l){const u=l[0]-i[0],f=l[1]-i[1],m=(o[0]-i[0])*f-u*(o[1]-i[1]),w=(e[0]-i[0])*f-u*(e[1]-i[1]);return m>0&&w<0||m<0&&w>0}function Rd(o,e,i,l){return(u=[l[0]-i[0],l[1]-i[1]])[0]*(f=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*f[0]!=0&&!(!qp(o,e,i,l)||!qp(i,l,o,e));var u,f}function Rh(o){const e=new Kt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Kt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of o[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),i.x<l.x&&(i.x=l.x),i.y<l.y&&(i.y=l.y);return{min:e,max:i}}const Nl=8192;function xc(o,e){const i=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Nl),Math.round(l*u*Nl)]}function Lf(o,e){for(let i=0;i<e.length;i++)if(ua(o,e[i]))return!0;return!1}function tg(o,e,i){for(const l of i)for(let u=0,f=l.length,m=f-1;u<f;m=u++)if(Rd(o,e,l[m],l[u]))return!0;return!1}function Dh(o,e){for(let i=0;i<o.length;++i)if(!ua(o[i],e))return!1;for(let i=0;i<o.length-1;++i)if(tg(o[i],o[i+1],e))return!1;return!0}function ng(o,e){for(let i=0;i<e.length;i++)if(Dh(o,e[i]))return!0;return!1}function kh(o,e,i){const l=[];for(let u=0;u<o.length;u++){const f=[];for(let m=0;m<o[u].length;m++){const w=xc(o[u][m],i);Du(e,w),f.push(w)}l.push(f)}return l}function Da(o,e,i){const l=[];for(let u=0;u<o.length;u++){const f=kh(o[u],e,i);l.push(f)}return l}function qa(o,e,i,l){if(o[0]<i[0]||o[0]>i[2]){const u=.5*l;let f=o[0]-i[0]>u?-l:i[0]-o[0]>u?l:0;f===0&&(f=o[0]-i[2]>u?-l:i[2]-o[0]>u?l:0),o[0]+=f}Du(e,o)}function zf(o,e,i,l){const u=Math.pow(2,l.z)*Nl,f=[l.x*Nl,l.y*Nl],m=[];if(!o)return m;for(const w of o)for(const C of w){const M=[C.x+f[0],C.y+f[1]];qa(M,e,i,u),m.push(M)}return m}function Wp(o,e,i,l){const u=Math.pow(2,l.z)*Nl,f=[l.x*Nl,l.y*Nl],m=[];if(!o)return m;for(const C of o){const M=[];for(const B of C){const U=[B.x+f[0],B.y+f[1]];Du(e,U),M.push(U)}m.push(M)}if(e[2]-e[0]<=u/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of m)for(const M of C)qa(M,e,i,u)}var w;return m}class ku{constructor(e,i){this.type=gi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(vc(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const f=l.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ku(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ku(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ku(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const w=kh(l.coordinates,f,m),C=zf(i.geometry(),u,f,m);if(!Ha(u,f))return!1;for(const M of C)if(!ua(M,w))return!1}if(l.type==="MultiPolygon"){const w=Da(l.coordinates,f,m),C=zf(i.geometry(),u,f,m);if(!Ha(u,f))return!1;for(const M of C)if(!Lf(M,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const w=kh(l.coordinates,f,m),C=Wp(i.geometry(),u,f,m);if(!Ha(u,f))return!1;for(const M of C)if(!Dh(M,w))return!1}if(l.type==="MultiPolygon"){const w=Da(l.coordinates,f,m),C=Wp(i.geometry(),u,f,m);if(!Ha(u,f))return!1;for(const M of C)if(!ng(M,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ou={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Rs=1/298.257223563,Ff=Rs*(2-Rs),fs=Math.PI/180;class Lu{static fromTile(e,i,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/fs;return new Lu(f,l)}static get units(){return Ou}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ou[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ou).join(", ")}`);const l=6378.137*fs*(i?Ou[i]:1),u=Math.cos(e*fs),f=1/(1-Ff*(1-u*u)),m=Math.sqrt(f);this.kx=l*m*u,this.ky=l*m*f*(1-Ff)}distance(e,i){const l=os(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,i){const l=os(i[0]-e[0])*this.kx;return Math.atan2(l,(i[1]-e[1])*this.ky)/fs}destination(e,i,l){const u=l*fs;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,l){return[e[0]+i/this.kx,e[1]+l/this.ky]}lineDistance(e){let i=0;for(let l=0;l<e.length-1;l++)i+=this.distance(e[l],e[l+1]);return i}area(e){let i=0;for(let l=0;l<e.length;l++){const u=e[l];for(let f=0,m=u.length,w=m-1;f<m;w=f++)i+=os(u[f][0]-u[w][0])*(u[f][1]+u[w][1])*(l?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let l=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const f=e[u],m=e[u+1],w=this.distance(f,m);if(l+=w,l>i)return Ul(f,m,(i-(l-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,i,l){let[u,f]=i,m=os(l[0]-u)*this.kx,w=(l[1]-f)*this.ky;if(m!==0||w!==0){const C=(os(e[0]-u)*this.kx*m+(e[1]-f)*this.ky*w)/(m*m+w*w);C>1?(u=l[0],f=l[1]):C>0&&(u+=m/this.kx*C,f+=w/this.ky*C)}return m=os(e[0]-u)*this.kx,w=(e[1]-f)*this.ky,Math.sqrt(m*m+w*w)}pointOnLine(e,i){let l=1/0,u=e[0][0],f=e[0][1],m=0,w=0;for(let C=0;C<e.length-1;C++){let M=e[C][0],B=e[C][1],U=os(e[C+1][0]-M)*this.kx,$=(e[C+1][1]-B)*this.ky,Q=0;U===0&&$===0||(Q=(os(i[0]-M)*this.kx*U+(i[1]-B)*this.ky*$)/(U*U+$*$),Q>1?(M=e[C+1][0],B=e[C+1][1]):Q>0&&(M+=U/this.kx*Q,B+=$/this.ky*Q)),U=os(i[0]-M)*this.kx,$=(i[1]-B)*this.ky;const ee=U*U+$*$;ee<l&&(l=ee,u=M,f=B,m=C,w=Q)}return{point:[u,f],index:m,t:Math.max(0,Math.min(1,w))}}lineSlice(e,i,l){let u=this.pointOnLine(l,e),f=this.pointOnLine(l,i);if(u.index>f.index||u.index===f.index&&u.t>f.t){const M=u;u=f,f=M}const m=[u.point],w=u.index+1,C=f.index;!Vl(l[w],m[0])&&w<=C&&m.push(l[w]);for(let M=w+1;M<=C;M++)m.push(l[M]);return Vl(l[C],f.point)||m.push(f.point),m}lineSliceAlong(e,i,l){let u=0;const f=[];for(let m=0;m<l.length-1;m++){const w=l[m],C=l[m+1],M=this.distance(w,C);if(u+=M,u>e&&f.length===0&&f.push(Ul(w,C,(e-(u-M))/M)),u>=i)return f.push(Ul(w,C,(i-(u-M))/M)),f;u>e&&f.push(C)}return f}bufferPoint(e,i){const l=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,i){const l=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,i){return os(e[0]-i[0])>=0&&os(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Vl(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ul(o,e,i){const l=os(e[0]-o[0]);return[o[0]+l*i,o[1]+(e[1]-o[1])*i]}function os(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Dd{constructor(e=[],i=((l,u)=>l<u?-1:l>u?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,u=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(l(u,m)>=0)break;i[e]=m,e=f}i[e]=u}_down(e){const{data:i,compare:l}=this,u=this.length>>1,f=i[e];for(;e<u;){let m=1+(e<<1);const w=m+1;if(w<this.length&&l(i[w],i[m])<0&&(m=w),l(i[m],f)>=0)break;i[e]=i[m],e=m}i[e]=f}}var hn=8192;function Wa(o,e){return e.dist-o.dist}const zu=100,ml=50;function bc(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==o[i])return!1;return!0}function gl(o){return o[1]-o[0]+1}function _l(o,e){const i=o[1]>=o[0]&&o[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Oh(o,e){if(o[0]>o[1])return[null,null];const i=gl(o);if(e){if(i===2)return[o,null];const l=Math.floor(i/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(i===1)return[o,null];const l=Math.floor(i/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function Ks(o,e){const i=[1/0,1/0,-1/0,-1/0];if(!_l(e,o.length))return i;for(let l=e[0];l<=e[1];++l)Du(i,o[l]);return i}function Ur(o){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<o.length;++i)for(let l=0;l<o[i].length;++l)Du(e,o[i][l]);return e}function wc(o,e,i){if(bc(o)||bc(e))return NaN;let l=0,u=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),i.distance([0,0],[l,u])}function rg(o){return 360*o-180}function Zp(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function kd(o,e){const i=Math.pow(2,e.z),l=(o.y/hn+e.y)/i;return[rg((o.x/hn+e.x)/i),Zp(l)]}function Yp(o,e){const i=[];for(let l=0;l<o.length;++l)i.push(kd(o[l],e));return i}function Yi(o,e,i){const l=i.pointOnLine(e,o).point;return i.distance(o,l)}function Bf(o,e,i,l,u){const f=i.slice(l[0],l[1]+1);let m=1/0;for(let w=e[0];w<=e[1];++w)if((m=Math.min(m,Yi(o[w],f,u)))===0)return 0;return m}function da(o,e,i,l,u){const f=Math.min(u.pointToSegmentDistance(o,i,l),u.pointToSegmentDistance(e,i,l)),m=Math.min(u.pointToSegmentDistance(i,o,e),u.pointToSegmentDistance(l,o,e));return Math.min(f,m)}function ig(o,e,i,l,u){if(!_l(e,o.length)||!_l(l,i.length))return NaN;let f=1/0;for(let m=e[0];m<e[1];++m)for(let w=l[0];w<l[1];++w){if(Rd(o[m],o[m+1],i[w],i[w+1]))return 0;f=Math.min(f,da(o[m],o[m+1],i[w],i[w+1],u))}return f}function ka(o,e,i,l,u){if(!_l(e,o.length)||!_l(l,i.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let w=l[0];w<=l[1];++w)if((f=Math.min(f,u.distance(o[m],i[w])))===0)return f;return f}function og(o,e,i){if(ua(o,e,!0))return 0;let l=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(l=Math.min(l,i.pointToSegmentDistance(o,u[f-1],u[0])))===0||(l=Math.min(l,Yi(o,u,i)))===0)return l}return l}function sg(o,e,i,l){if(!_l(e,o.length))return NaN;for(let f=e[0];f<=e[1];++f)if(ua(o[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const m of i)for(let w=0,C=m.length,M=C-1;w<C;M=w++){if(Rd(o[f],o[f+1],m[M],m[w]))return 0;u=Math.min(u,da(o[f],o[f+1],m[M],m[w],l))}return u}function ag(o,e){for(const i of o)for(let l=0;l<=i.length-1;++l)if(ua(i[l],e,!0))return!0;return!1}function $c(o,e,i,l=1/0){const u=Ur(o),f=Ur(e);if(l!==1/0&&wc(u,f,i)>=l)return l;if(Ha(u,f)){if(ag(o,e))return 0}else if(ag(e,o))return 0;let m=l;for(const w of o)for(let C=0,M=w.length,B=M-1;C<M;B=C++)for(const U of e)for(let $=0,Q=U.length,ee=Q-1;$<Q;ee=$++){if(Rd(w[B],w[C],U[ee],U[$]))return 0;m=Math.min(m,da(w[B],w[C],U[ee],U[$],i))}return m}function Lh(o,e,i,l,u,f,m){if(f===null||m===null)return;const w=wc(Ks(l,f),Ks(u,m),i);w<e&&o.push({dist:w,range1:f,range2:m})}function Xp(o,e,i,l,u=1/0){let f=Math.min(l.distance(o[0],i[0][0]),u);if(f===0)return f;const m=new Dd([{dist:0,range1:[0,o.length-1],range2:[0,0]}],Wa),w=e?ml:zu,C=Ur(i);for(;m.length;){const M=m.pop();if(M.dist>=f)continue;const B=M.range1;if(gl(B)<=w){if(!_l(B,o.length))return NaN;if(e){const U=sg(o,B,i,l);if((f=Math.min(f,U))===0)return f}else for(let U=B[0];U<=B[1];++U){const $=og(o[U],i,l);if((f=Math.min(f,$))===0)return f}}else{const U=Oh(B,e);if(U[0]!==null){const $=wc(Ks(o,U[0]),C,l);$<f&&m.push({dist:$,range1:U[0],range2:[0,0]})}if(U[1]!==null){const $=wc(Ks(o,U[1]),C,l);$<f&&m.push({dist:$,range1:U[1],range2:[0,0]})}}}return f}function Fu(o,e,i,l,u,f=1/0){let m=Math.min(f,u.distance(o[0],i[0]));if(m===0)return m;const w=new Dd([{dist:0,range1:[0,o.length-1],range2:[0,i.length-1]}],Wa),C=e?ml:zu,M=l?ml:zu;for(;w.length;){const B=w.pop();if(B.dist>=m)continue;const U=B.range1,$=B.range2;if(gl(U)<=C&&gl($)<=M){if(!_l(U,o.length)||!_l($,i.length))return NaN;if(e&&l?m=Math.min(m,ig(o,U,i,$,u)):e||l?e&&!l?m=Math.min(m,Bf(i,$,o,U,u)):!e&&l&&(m=Math.min(m,Bf(o,U,i,$,u))):m=Math.min(m,ka(o,U,i,$,u)),m===0)return m}else{const Q=Oh(U,e),ee=Oh($,l);Lh(w,m,u,o,i,Q[0],ee[0]),Lh(w,m,u,o,i,Q[0],ee[1]),Lh(w,m,u,o,i,Q[1],ee[0]),Lh(w,m,u,o,i,Q[1],ee[1])}}return m}function Nf(o,e,i,l,u=1/0){let f=u;const m=Ks(o,[0,o.length-1]);for(const w of i)if(!(f!==1/0&&wc(m,Ks(w,[0,w.length-1]),l)>=f)&&(f=Math.min(f,Fu(o,e,w,!0,l,f)),f===0))return f;return f}function zh(o,e,i,l,u=1/0){let f=u;const m=Ks(o,[0,o.length-1]);for(const w of i){if(f!==1/0&&wc(m,Ur(w),l)>=f)continue;const C=Xp(o,e,w,l,f);if(isNaN(C))return C;if((f=Math.min(f,C))===0)return f}return f}function Vf(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class Hc{constructor(e,i){this.type=jn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(vc(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(Vf(l.features[u].geometry.type))return new Hc(l,l.features[u].geometry)}else if(l.type==="Feature"){if(Vf(l.geometry.type))return new Hc(l,l.geometry)}else if(Vf(l.type))return new Hc(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),l=e.canonicalID();if(i!=null&&l!=null){if(e.geometryType()==="Point")return(function(u,f,m){const w=[];for(const M of u)for(const B of M)w.push(kd(B,f));const C=new Lu(w[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Fu(w,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",C):m.type==="MultiLineString"?Nf(w,!1,m.coordinates,C):m.type==="Polygon"||m.type==="MultiPolygon"?zh(w,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,C):null})(i,l,this.geometries);if(e.geometryType()==="LineString")return(function(u,f,m){const w=[];for(const M of u){const B=[];for(const U of M)B.push(kd(U,f));w.push(B)}const C=new Lu(w[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Nf(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w,C);if(m.type==="MultiLineString"){let M=1/0;for(let B=0;B<m.coordinates.length;B++){const U=Nf(m.coordinates[B],!0,w,C,M);if(isNaN(U))return U;if((M=Math.min(M,U))===0)return M}return M}if(m.type==="Polygon"||m.type==="MultiPolygon"){let M=1/0;for(let B=0;B<w.length;B++){const U=zh(w[B],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,C,M);if(isNaN(U))return U;if((M=Math.min(M,U))===0)return M}return M}return null})(i,l,this.geometries);if(e.geometryType()==="Polygon")return(function(u,f,m){const w=[];for(const M of(function(B,U){const $=B.length;if($<=1)return[B];const Q=[];let ee,he;for(let _e=0;_e<$;_e++){const ve=pl(B[_e]);ve!==0&&(B[_e].area=Math.abs(ve),he===void 0&&(he=ve<0),he===ve<0?(ee&&Q.push(ee),ee=[B[_e]]):ee.push(B[_e]))}return ee&&Q.push(ee),Q})(u)){const B=[];for(let U=0;U<M.length;++U)B.push(Yp(M[U],f));w.push(B)}const C=new Lu(w[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return zh(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w,C);if(m.type==="MultiLineString"){let M=1/0;for(let B=0;B<m.coordinates.length;B++){const U=zh(m.coordinates[B],!0,w,C,M);if(isNaN(U))return U;if((M=Math.min(M,U))===0)return M}return M}return m.type==="Polygon"||m.type==="MultiPolygon"?(function(M,B,U){let $=1/0;for(const Q of M)for(const ee of B){const he=$c(Q,ee,U,$);if(isNaN(he))return he;if(($=Math.min($,he))===0)return $}return $})(m.type==="Polygon"?[m.coordinates]:m.coordinates,w,C):null})(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qc(o){if(o instanceof is&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ku||o instanceof Hc)return!1;if(o instanceof yl)return o.featureConstant;let e=!0;return o.eachChild((i=>{e&&!qc(i)&&(e=!1)})),e}function Od(o){if(o instanceof is&&o.name==="feature-state")return!1;let e=!0;return o.eachChild((i=>{e&&!Od(i)&&(e=!1)})),e}function Uf(o){if(o instanceof yl)return new Set([o.key]);let e=new Set;return o.eachChild((i=>{e=new Set([...e,...Uf(i)])})),e}function Ld(o,e){if(o instanceof is&&e.indexOf(o.name)>=0)return!1;let i=!0;return o.eachChild((l=>{i&&!Ld(l,e)&&(i=!1)})),i}function lg(o,e,i){return[o,e,i].filter(Boolean).join("")}function jf(o,e){switch(o){case"string":return Xs(e);case"number":return+e;case"boolean":return!!e;case"color":return mi.parse(e);case"formatted":return vs.fromString(Xs(e));case"resolvedImage":return Ys.build(Xs(e))}return e}function Kp(o,e,i,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),i!==void 0&&o>i&&(o=i),o}class yl{constructor(e,i,l,u=!1){this.type=e,this.key=i,this.scope=l,this.featureConstant=u}static parse(e,i){let l=i.expectedType;if(l==null&&(l=ci),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof br))return i.error("Key name of 'config' expression must be a string literal.");let f,m=!0;const w=Xs(u.value);if(e.length>=3){const C=i.parse(e[2],2);if(!(C instanceof br))return i.error("Scope of 'config' expression must be a string literal.");f=Xs(C.value)}if(i.options){const C=lg(w,f,i._scope),M=i.options.get(C);M&&(m=qc(M.value||M.default))}return new yl(l,w,f,m)}evaluate(e){const i=lg(this.key,this.scope,e.scope),l=e.getConfig(i);if(!l)return null;const{type:u,value:f,values:m,minValue:w,maxValue:C,stepValue:M}=l,B=l.default.evaluate(e);let U=B;if(f){const $=e.scope;e.scope=($||"").split("").slice(1).join(""),U=f.evaluate(e),e.scope=$}return u&&(U=jf(u,U)),U===void 0||w===void 0&&C===void 0&&M===void 0||(typeof U=="number"?U=Kp(U,w,C,M):Array.isArray(U)&&(U=U.map(($=>typeof $=="number"?Kp($,w,C,M):$)))),f!==void 0&&U!==void 0&&m&&!m.includes(U)&&(U=B,u&&(U=jf(u,U))),(u&&u!==this.type||U!==void 0&&!Ad($o(U),this.type))&&(U=jf(this.type.kind,U)),U}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Bu{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Bu(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fh{constructor(e,i=[],l,u=new Ah,f=[],m,w,C){this.registry=e,this.path=i,this.key=i.map((M=>typeof M=="string"?`['${M}']`:`[${M}]`)).join(""),this.scope=u,this.errors=f,this.expectedType=l,this._scope=m,this.options=w,this.iconImageUseTheme=C}parse(e,i,l,u,f={}){return i||l?this.concat(i,null,l,u)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,l,u,f,m={}){return this.concat(i,l,u,f)._parse(e,m)}_parse(e,i){function l(u,f,m){return m==="assert"?new sr(f,[u]):m==="coerce"?new vo(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,w=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||w.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(m,w))return null}else f=l(f,m,i.typeAnnotation||"coerce");else f=l(f,m,i.typeAnnotation||"assert")}if(!(f instanceof br)&&f.type.kind!=="resolvedImage"&&Gf(f)){const m=new $a(this._scope,this.options,this.iconImageUseTheme);try{f=new br(f.type,f.evaluate(m))}catch(w){return this.error(w.message),null}}return f}return vo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l,u){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const m=u?this.scope.concat(u):this.scope;return new Fh(this.registry,f,l||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const l=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Ma(l,e))}checkSubtype(e,i){const l=Cd(e,i);return l&&this.error(l),l}}function Gf(o){if(o instanceof Bu)return Gf(o.boundExpression);if(o instanceof is&&o.name==="error"||o instanceof hs||o instanceof ku||o instanceof Hc||o instanceof yl)return!1;const e=o instanceof vo||o instanceof sr;let i=!0;return o.eachChild((l=>{i=e?i&&Gf(l):i&&l instanceof br})),!!i&&qc(o)&&Ld(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bh(o,e){const i=o.length-1;let l,u,f=0,m=i,w=0;for(;f<=m;)if(w=Math.floor((f+m)/2),l=o[w],u=o[w+1],l<=e){if(w===i||e<u)return w;f=w+1}else{if(!(l>e))throw new Pn("Input is not a number.");m=w-1}return 0}class zd{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of l)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,jn);if(!l)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const w=m===1?-1/0:e[m],C=e[m+1],M=m,B=m+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const U=i.parse(C,B,f);if(!U)return null;f=f||U.type,u.push([w,U])}return new zd(f,l,u)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;return u>=i[f-1]?l[f-1].evaluate(e):l[Bh(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Jp=.95047,Qp=1.08883,Fd=4/29,Sc=6/29,em=3*Sc*Sc,mo=Sc*Sc*Sc,tm=Math.PI/180,w_=180/Math.PI;function $f(o){return o>mo?Math.pow(o,1/3):o/em+Fd}function Hf(o){return o>Sc?o*o*o:em*(o-Fd)}function qf(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Wc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function nm(o){const e=Wc(o.r),i=Wc(o.g),l=Wc(o.b),u=$f((.4124564*e+.3575761*i+.1804375*l)/Jp),f=$f((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-$f((.0193339*e+.119192*i+.9503041*l)/Qp)),alpha:o.a}}function Nh(o){let e=(o.l+16)/116,i=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*Hf(e),i=Jp*Hf(i),l=Qp*Hf(l),new mi(qf(3.2404542*i-1.5371385*e-.4985314*l),qf(-.969266*i+1.8760108*e+.041556*l),qf(.0556434*i-.2040259*e+1.0572252*l),o.alpha)}function Tc(o,e,i){const l=e-o;return o+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const Zc={forward:nm,reverse:Nh,interpolate:function(o,e,i){return{l:Qn(o.l,e.l,i),a:Qn(o.a,e.a,i),b:Qn(o.b,e.b,i),alpha:Qn(o.alpha,e.alpha,i)}}},jl={forward:function(o){const{l:e,a:i,b:l}=nm(o),u=Math.atan2(l,i)*w_;return{h:u<0?u+360:u,c:Math.sqrt(i*i+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*tm,i=o.c;return Nh({l:o.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:o.alpha})},interpolate:function(o,e,i){return{h:Tc(o.h,e.h,i),c:Qn(o.c,e.c,i),l:Qn(o.l,e.l,i),alpha:Qn(o.alpha,e.alpha,i)}}};var Yc=Object.freeze({__proto__:null,hcl:jl,lab:Zc});class ha{constructor(e,i,l,u,f){this.type=e,this.operator=i,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[m,w]of f)this.labels.push(m),this.outputs.push(w)}static interpolationFactor(e,i,l,u){let f=0;if(e.name==="exponential")f=Bd(i,e.base,l,u);else if(e.name==="linear")f=Bd(i,1,l,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new cl(m[0],m[1],m[2],m[3]).solve(Bd(i,1,l,u))}return f}static parse(e,i){let[l,u,f,...m]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some((B=>typeof B!="number"||B<0||B>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,jn),!f)return null;const w=[];let C=null;l==="interpolate-hcl"||l==="interpolate-lab"?C=Zs:i.expectedType&&i.expectedType.kind!=="value"&&(C=i.expectedType);for(let M=0;M<m.length;M+=2){const B=m[M],U=m[M+1],$=M+3,Q=M+4;if(typeof B!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(w.length&&w[w.length-1][0]>=B)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const ee=i.parse(U,Q,C);if(!ee)return null;C=C||ee.type,w.push([B,ee])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new ha(C,l,u,f,w):i.error(`Type ${Lo(C)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;if(u>=i[f-1])return l[f-1].evaluate(e);const m=Bh(i,u),w=ha.interpolationFactor(this.interpolation,u,i[m],i[m+1]),C=l[m].evaluate(e),M=l[m+1].evaluate(e);return this.operator==="interpolate"?Ws[this.type.kind.toLowerCase()](C,M,w):this.operator==="interpolate-hcl"?jl.reverse(jl.interpolate(jl.forward(C),jl.forward(M),w)):Zc.reverse(Zc.interpolate(Zc.forward(C),Zc.forward(M),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Bd(o,e,i,l){const u=l-i,f=o-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class Vh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const u=i.expectedType;u&&u.kind!=="value"&&(l=u);const f=[];for(const w of e.slice(1)){const C=i.parse(w,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!C)return null;l=l||C.type,f.push(C)}const m=u&&f.some((w=>Cd(u,w.type)));return new Vh(m?ci:l,f)}evaluate(e){let i,l=null,u=0;for(const f of this.args){if(u++,l=f.evaluate(e),l&&l instanceof Ys&&!l.available&&(i||(i=l),l=null,u===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Uh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const w=i.parse(e[f+1],f+1);if(!w)return null;l.push([m,w])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return u?new Uh(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}class Wf{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,jn),u=i.parse(e[2],2,ys(i.expectedType||ci));return l&&u?new Wf(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new Pn("Array index out of bounds: negative index");if(i>=l.length)throw new Pn("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Pn("Array index must be an integer. Use at-interpolated for fractional indices");return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zf{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,jn),u=i.parse(e[2],2,ys(i.expectedType||ci));return l&&u?new Zf(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new Pn(`Array index out of bounds: ${i} < 0.`);if(i>l.length-1)throw new Pn(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i===Math.floor(i))return l[i];const u=Math.floor(i),f=Math.ceil(i),m=l[u],w=l[f];if(typeof m!="number"||typeof w!="number")throw new Pn(`Cannot interpolate between non-number values at index ${i}.`);const C=i-u;return m*(1-C)+w*C}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class jh{constructor(e,i){this.type=gi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,ci),u=i.parse(e[2],2,ci);return l&&u?Ed(l.type,[gi,li,jn,fl,ci])?new jh(l,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lo(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Pu(i,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${Lo($o(i))} instead.`);if(!Pu(l,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${Lo($o(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nd{constructor(e,i,l){this.type=jn,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,ci),u=i.parse(e[2],2,ci);if(!l||!u)return null;if(!Ed(l.type,[gi,li,jn,fl,ci]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lo(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,jn);return f?new Nd(l,u,f):null}return new Nd(l,u)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Pu(i,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${Lo($o(i))} instead.`);if(!Pu(l,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${Lo($o(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(i,u)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xc{constructor(e,i,l,u,f,m){this.inputType=e,this.type=i,this.input=l,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},m=[];for(let M=2;M<e.length-1;M+=2){let B=e[M];const U=e[M+1];Array.isArray(B)||(B=[B]);const $=i.concat(M);if(B.length===0)return $.error("Expected at least one branch label.");for(const ee of B){if(typeof ee!="number"&&typeof ee!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return $.error("Numeric branch labels must be integer values.");if(l){if($.checkSubtype(l,$o(ee)))return null}else l=$o(ee);if(f[String(ee)]!==void 0)return $.error("Branch labels must be unique.");f[String(ee)]=m.length}const Q=i.parse(U,M,u);if(!Q)return null;u=u||Q.type,m.push(Q)}const w=i.parse(e[1],1,ci);if(!w)return null;const C=i.parse(e[e.length-1],e.length-1,u);return C?w.type.kind!=="value"&&i.concat(1).checkSubtype(l,w.type)?null:new Xc(l,u,w,f,m,C):null}evaluate(e){const i=this.input.evaluate(e);return(Ad($o(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],u={};for(const m of i){const w=u[this.cases[m]];w===void 0?(u[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[w][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,w]of l)e.push(w.length===1?f(w[0]):w.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Ai{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const w=i.parse(e[m],m,gi);if(!w)return null;const C=i.parse(e[m+1],m+1,l);if(!C)return null;u.push([w,C]),l=l||C.type}const f=i.parse(e[e.length-1],e.length-1,l);return f?new Ai(l,u,f):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Gh{constructor(e,i,l,u){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,ci),u=i.parse(e[2],2,jn);if(!l||!u)return null;if(!Ed(l.type,[ys(ci),li,ci]))return i.error(`Expected first argument to be of type array or string, but found ${Lo(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,jn);return f?new Gh(l.type,l,u,f):null}return new Gh(l.type,l,u)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Pu(i,["string","array"]))throw new Pn(`Expected first argument to be of type array or string, but found ${Lo($o(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(l,u)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class fa{constructor(e,i){this.type=ys(li),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,li),u=i.parse(e[2],2,li);return l&&u?new fa(l,u):void 0}evaluate(e){const i=this.str.evaluate(e),l=this.delimiter.evaluate(e);return i.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Yf(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function rm(o,e,i,l){return l.compare(e,i)===0}function Gl(o,e,i){const l=o!=="=="&&o!=="!=";return class RM{constructor(f,m,w){this.type=gi,this.lhs=f,this.rhs=m,this.collator=w,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const w=f[0];let C=m.parse(f[1],1,ci);if(!C)return null;if(!Yf(w,C.type))return m.concat(1).error(`"${w}" comparisons are not supported for type '${Lo(C.type)}'.`);let M=m.parse(f[2],2,ci);if(!M)return null;if(!Yf(w,M.type))return m.concat(2).error(`"${w}" comparisons are not supported for type '${Lo(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return m.error(`Cannot compare types '${Lo(C.type)}' and '${Lo(M.type)}'.`);l&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new sr(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new sr(C.type,[M])));let B=null;if(f.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(B=m.parse(f[3],3,If),!B)return null}return new RM(C,M,B)}evaluate(f){const m=this.lhs.evaluate(f),w=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const C=$o(m),M=$o(w);if(C.kind!==M.kind||C.kind!=="string"&&C.kind!=="number")throw new Pn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const C=$o(m),M=$o(w);if(C.kind!=="string"||M.kind!=="string")return e(f,m,w)}return this.collator?i(f,m,w,this.collator.evaluate(f)):e(f,m,w)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[o];return this.eachChild((m=>{f.push(m.serialize())})),f}}}const Vd=Gl("==",(function(o,e,i){return e===i}),rm),Ud=Gl("!=",(function(o,e,i){return e!==i}),(function(o,e,i,l){return!rm(0,e,i,l)})),cg=Gl("<",(function(o,e,i){return e<i}),(function(o,e,i,l){return l.compare(e,i)<0})),jd=Gl(">",(function(o,e,i){return e>i}),(function(o,e,i,l){return l.compare(e,i)>0})),S_=Gl("<=",(function(o,e,i){return e<=i}),(function(o,e,i,l){return l.compare(e,i)<=0})),ug=Gl(">=",(function(o,e,i){return e>=i}),(function(o,e,i,l){return l.compare(e,i)>=0}));class $l{constructor(e,i,l,u,f,m){this.type=li,this.number=e,this.locale=i,this.currency=l,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,jn);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parseObjectValue(u.locale,2,"locale",li),!f))return null;let m=null;if(u.currency&&(m=i.parseObjectValue(u.currency,2,"currency",li),!m))return null;let w=null;if(u.unit&&(w=i.parseObjectValue(u.unit,2,"unit",li),!w))return null;let C=null;if(u["min-fraction-digits"]&&(C=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",jn),!C))return null;let M=null;return u["max-fraction-digits"]&&(M=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",jn),!M)?null:new $l(l,f,m,w,C,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class $h{constructor(e){this.type=jn,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Lo(l.type)} instead.`):new $h(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Pn(`Expected value to be of type string or array, but found ${Lo($o(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function Hh(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Kc={"==":Vd,"!=":Ud,">":jd,"<":cg,">=":ug,"<=":S_,array:sr,at:Wf,"at-interpolated":Zf,boolean:sr,case:Ai,coalesce:Vh,collator:hs,format:Mu,image:Iu,in:jh,"index-of":Nd,interpolate:ha,"interpolate-hcl":ha,"interpolate-lab":ha,length:$h,let:Uh,literal:br,match:Xc,number:sr,"number-format":$l,object:sr,slice:Gh,step:zd,string:sr,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:Bu,within:ku,distance:Hc,config:yl,split:fa};function Xf(o,[e,i,l,u]){e=e.evaluate(o),i=i.evaluate(o),l=l.evaluate(o);const f=u?u.evaluate(o):1,m=Rf(e,i,l,f);if(m)throw new Pn(m);return new mi(e/255,i/255,l/255,f)}function Hl(o,[e,i,l,u]){e=e.evaluate(o),i=i.evaluate(o),l=l.evaluate(o);const f=u?u.evaluate(o):1,m=(function(M,B,U,$){return typeof M=="number"&&M>=0&&M<=360?typeof B=="number"&&B>=0&&B<=100&&typeof U=="number"&&U>=0&&U<=100?$===void 0||typeof $=="number"&&$>=0&&$<=1?null:`Invalid hsla value [${[M,B,U,$].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof $=="number"?[M,B,U,$]:[M,B,U]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof $=="number"?[M,B,U,$]:[M,B,U]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,l,f);if(m)throw new Pn(m);const w=`hsla(${e}, ${i}%, ${l}%, ${f})`,C=mi.parse(w);if(!C)throw new Pn(`Failed to parse HSLA color: ${w}`);return C}function qh(o,e){return o in e}function Kf(o,e){const i=e[o];return i===void 0?null:i}function Jc(o){return{type:o}}function Nu(o){return{result:"success",value:o}}function vl(o){return{result:"error",value:o}}function Zr(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Jf(o){return o["property-type"]==="data-driven"}function im(o){return Zr(o.expression,"measure-light")}function Qf(o){return Zr(o.expression,"zoom")}function Qc(o){return!!o.expression&&o.expression.interpolated}function ep(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function om(o){return o}function tp(o,e){const i=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",u=l||!(l||o.property!==void 0),f=o.type||(Qc(e)?"exponential":"interval");if(i&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map((M=>[M[0],mi.parse(M[1])]))),o.default=mi.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Yc[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let m,w,C;if(f==="exponential")m=sm;else if(f==="interval")m=ql;else if(f==="categorical"){m=T_,w=Object.create(null);for(const M of o.stops)w[M[0]]=M[1];C=typeof o.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=np}if(l){const M={},B=[];for(let Q=0;Q<o.stops.length;Q++){const ee=o.stops[Q],he=ee[0].zoom;M[he]===void 0&&(M[he]={zoom:he,type:o.type,property:o.property,default:o.default,stops:[]},B.push(he)),M[he].stops.push([ee[0].value,ee[1]])}const U=[];for(const Q of B)U.push([M[Q].zoom,tp(M[Q],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:ha.interpolationFactor.bind(void 0,$),zoomStops:U.map((Q=>Q[0])),evaluate:({zoom:Q},ee)=>sm({stops:U,base:o.base},e,Q).evaluate(Q,ee)}}if(u){const M=f==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:ha.interpolationFactor.bind(void 0,M),zoomStops:o.stops.map((B=>B[0])),evaluate:({zoom:B})=>m(o,e,B,w,C)}}return{kind:"source",evaluate(M,B){const U=B&&B.properties?B.properties[o.property]:void 0;return U===void 0?Gd(o.default,e.default):m(o,e,U,w,C)}}}function Gd(o,e,i){return o!==void 0?o:e!==void 0?e:i!==void 0?i:void 0}function T_(o,e,i,l,u){return Gd(typeof i===u?l[i]:void 0,o.default,e.default)}function ql(o,e,i){if(!Pd(i))return Gd(o.default,e.default);const l=o.stops.length;if(l===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[l-1][0])return o.stops[l-1][1];const u=Bh(o.stops.map((f=>f[0])),i);return o.stops[u][1]}function sm(o,e,i){const l=o.base!==void 0?o.base:1;if(!Pd(i))return Gd(o.default,e.default);const u=o.stops.length;if(u===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[u-1][0])return o.stops[u-1][1];const f=Bh(o.stops.map((B=>B[0])),i),m=(function(B,U,$,Q){const ee=Q-$,he=B-$;return ee===0?0:U===1?he/ee:(Math.pow(U,he)-1)/(Math.pow(U,ee)-1)})(i,l,o.stops[f][0],o.stops[f+1][0]),w=o.stops[f][1],C=o.stops[f+1][1];let M=Ws[e.type]||om;if(o.colorSpace&&o.colorSpace!=="rgb"){const B=Yc[o.colorSpace];M=(U,$)=>B.reverse(B.interpolate(B.forward(U),B.forward($),m))}return typeof w.evaluate=="function"?{evaluate(...B){const U=w.evaluate.apply(void 0,B),$=C.evaluate.apply(void 0,B);if(U!==void 0&&$!==void 0)return M(U,$,m)}}:M(w,C,m)}function np(o,e,i){return e.type==="color"?i=mi.parse(i):e.type==="formatted"?i=vs.fromString(i.toString()):e.type==="resolvedImage"?i=Ys.build(i.toString()):er(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Gd(i,o.default,e.default)}is.register(Kc,{error:[{kind:"error"},[li],(o,[e])=>{throw new Pn(e.evaluate(o))}],typeof:[li,[ci],(o,[e])=>Lo($o(e.evaluate(o)))],"to-rgba":[ys(jn,4),[Zs],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ys(jn,4),[Zs],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Zs,[jn,jn,jn],Xf],rgba:[Zs,[jn,jn,jn,jn],Xf],hsl:[Zs,[jn,jn,jn],Hl],hsla:[Zs,[jn,jn,jn,jn],Hl],has:{type:gi,overloads:[[[li],(o,[e])=>qh(e.evaluate(o),o.properties())],[[li,Gc],(o,[e,i])=>qh(e.evaluate(o),i.evaluate(o))]]},get:{type:ci,overloads:[[[li],(o,[e])=>Kf(e.evaluate(o),o.properties())],[[li,Gc],(o,[e,i])=>Kf(e.evaluate(o),i.evaluate(o))]]},"feature-state":[ci,[li],(o,[e])=>Kf(e.evaluate(o),o.featureState||{})],properties:[Gc,[],o=>o.properties()],"geometry-type":[li,[],o=>o.geometryType()],worldview:[li,[],o=>o.globals.worldview||""],id:[ci,[],o=>o.id()],zoom:[jn,[],o=>o.globals.zoom],pitch:[jn,[],o=>o.globals.pitch||0],"distance-from-center":[jn,[],o=>o.distanceFromCenter()],"measure-light":[jn,[li],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[jn,[],o=>o.globals.heatmapDensity||0],"line-progress":[jn,[],o=>o.globals.lineProgress||0],"raster-value":[jn,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[jn,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[jn,[],o=>o.globals.skyRadialProgress||0],accumulated:[ci,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[jn,Jc(jn),(o,e)=>{let i=0;for(const l of e)i+=l.evaluate(o);return i}],"*":[jn,Jc(jn),(o,e)=>{let i=1;for(const l of e)i*=l.evaluate(o);return i}],"-":{type:jn,overloads:[[[jn,jn],(o,[e,i])=>e.evaluate(o)-i.evaluate(o)],[[jn],(o,[e])=>-e.evaluate(o)]]},"/":[jn,[jn,jn],(o,[e,i])=>e.evaluate(o)/i.evaluate(o)],"%":[jn,[jn,jn],(o,[e,i])=>e.evaluate(o)%i.evaluate(o)],ln2:[jn,[],()=>Math.LN2],pi:[jn,[],()=>Math.PI],e:[jn,[],()=>Math.E],"^":[jn,[jn,jn],(o,[e,i])=>Math.pow(e.evaluate(o),i.evaluate(o))],sqrt:[jn,[jn],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[jn,[jn],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[jn,[jn],(o,[e])=>Math.log(e.evaluate(o))],log2:[jn,[jn],(o,[e])=>Math.log2(e.evaluate(o))],sin:[jn,[jn],(o,[e])=>Math.sin(e.evaluate(o))],cos:[jn,[jn],(o,[e])=>Math.cos(e.evaluate(o))],tan:[jn,[jn],(o,[e])=>Math.tan(e.evaluate(o))],asin:[jn,[jn],(o,[e])=>Math.asin(e.evaluate(o))],acos:[jn,[jn],(o,[e])=>Math.acos(e.evaluate(o))],atan:[jn,[jn],(o,[e])=>Math.atan(e.evaluate(o))],min:[jn,Jc(jn),(o,e)=>Math.min(...e.map((i=>i.evaluate(o))))],max:[jn,Jc(jn),(o,e)=>Math.max(...e.map((i=>i.evaluate(o))))],abs:[jn,[jn],(o,[e])=>Math.abs(e.evaluate(o))],round:[jn,[jn],(o,[e])=>{const i=e.evaluate(o);return i<0?-Math.round(-i):Math.round(i)}],floor:[jn,[jn],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[jn,[jn],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[gi,[li,ci],(o,[e,i])=>o.properties()[e.value]===i.value],"filter-id-==":[gi,[ci],(o,[e])=>o.id()===e.value],"filter-type-==":[gi,[li],(o,[e])=>o.geometryType()===e.value],"filter-<":[gi,[li,ci],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l<u}],"filter-id-<":[gi,[ci],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[gi,[li,ci],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l>u}],"filter-id->":[gi,[ci],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[gi,[li,ci],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[gi,[ci],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[gi,[li,ci],(o,[e,i])=>{const l=o.properties()[e.value],u=i.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[gi,[ci],(o,[e])=>{const i=o.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[gi,[ci],(o,[e])=>e.value in o.properties()],"filter-has-id":[gi,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[gi,[ys(li)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[gi,[ys(ci)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[gi,[li,ys(ci)],(o,[e,i])=>i.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[gi,[li,ys(ci)],(o,[e,i])=>(function(l,u,f,m){for(;f<=m;){const w=f+m>>1;if(u[w]===l)return!0;u[w]>l?m=w-1:f=w+1}return!1})(o.properties()[e.value],i.value,0,i.value.length-1)],all:{type:gi,overloads:[[[gi,gi],(o,[e,i])=>e.evaluate(o)&&i.evaluate(o)],[Jc(gi),(o,e)=>{for(const i of e)if(!i.evaluate(o))return!1;return!0}]]},any:{type:gi,overloads:[[[gi,gi],(o,[e,i])=>e.evaluate(o)||i.evaluate(o)],[Jc(gi),(o,e)=>{for(const i of e)if(i.evaluate(o))return!0;return!1}]]},"!":[gi,[gi],(o,[e])=>!e.evaluate(o)],"is-supported-script":[gi,[li],(o,[e])=>{const i=o.globals&&o.globals.isSupportedScript;return!i||i(e.evaluate(o))}],upcase:[li,[li],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[li,[li],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[li,Jc(ci),(o,e)=>e.map((i=>Xs(i.evaluate(o)))).join("")],"resolved-locale":[li,[If],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[jn,[jn,jn,ci],(o,e)=>{const[i,l,u]=e.map((m=>m.evaluate(o)));if(i>l||i===l)return i;let f;if(typeof u=="string")f=(function(m){let w=0;if(m.length===0)return w;for(let C=0;C<m.length;C++)w=(w<<5)-w+m.charCodeAt(C),w|=0;return w})(u);else{if(typeof u!="number")throw new Pn(`Invalid seed input: ${u}`);f=u}return i+Hh(f)()*(l-i)}]});class Wh{constructor(e,i,l,u,f){this.expression=e,this._warningHistory={},this._evaluator=new $a(l,u,f),this._defaultValue=i?(function(m){return m.type==="color"&&(ep(m.default)||Array.isArray(m.default))?new mi(0,0,0,0):m.type==="color"?mi.parse(m.default)||null:m.default===void 0?null:m.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Uf(e)}evaluateWithoutErrorHandling(e,i,l,u,f,m,w,C){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,u,f,m,w,C,M){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this._evaluator.iconImageUseTheme=M||null;try{const B=this.expression.evaluate(this._evaluator);if(B==null||typeof B=="number"&&B!=B)return this._defaultValue;if(this._enumValues&&!(B in this._enumValues))throw new Pn(`Expected value to be one of ${Object.keys(this._enumValues).map((U=>JSON.stringify(U))).join(", ")}, but found ${JSON.stringify(B)} instead.`);return B}catch(B){return this._warningHistory[B.message]||(this._warningHistory[B.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${B.message}`)),this._defaultValue}}}function am(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Kc}function Wl(o,e,i,l,u){const f=new Fh(Kc,[],e?(function(w){const C={color:Zs,string:li,number:jn,enum:li,boolean:gi,formatted:Go,resolvedImage:Td};return w.type==="array"?ys(C[w.value]||ci,w.length):C[w.type]})(e):void 0,void 0,void 0,i,l,u),m=f.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Nu(new Wh(m,e,i,l,u)):vl(f.errors)}class xl{constructor(e,i,l,u){this.kind=e,this._styleExpression=i,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Od(i.expression),this.configDependencies=Uf(i.expression)}evaluateWithoutErrorHandling(e,i,l,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,m)}evaluate(e,i,l,u,f,m,w){return this._styleExpression.evaluate(e,i,l,u,f,m,void 0,void 0,w)}}class Js{constructor(e,i,l,u,f,m){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Od(i.expression),this.isLightConstant=f,this.isLineProgressConstant=m,this.configDependencies=Uf(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,l,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,m)}evaluate(e,i,l,u,f,m){return this._styleExpression.evaluate(e,i,l,u,f,m)}interpolationFactor(e,i,l){return this.interpolationType?ha.interpolationFactor(this.interpolationType,e,i,l):0}}function xs(o,e,i,l,u){if((o=Wl(o,e,i,l,u)).result==="error")return o;const f=o.value.expression,m=qc(f);if(!m&&!Jf(e))return vl([new Ma("","data expressions not supported")]);const w=Ld(f,["zoom","pitch","distance-from-center"]);if(!w&&!Qf(e))return vl([new Ma("","zoom expressions not supported")]);const C=Ld(f,["measure-light"]);if(!C&&!im(e))return vl([new Ma("","measure-light expression not supported")]);const M=Ld(f,["line-progress"]);if(!M&&!(function($){return Zr($.expression,"line-progress")})(e))return vl([new Ma("","line-progress expression not supported")]);const B=e.expression&&e.expression.relaxZoomRestriction,U=pa(f);return U||w||B?U instanceof Ma?vl([U]):U instanceof ha&&!Qc(e)?vl([new Ma("",'"interpolate" expressions cannot be used with this property')]):Nu(U?new Js(m&&M?"camera":"composite",o.value,U.labels,U instanceof ha?U.interpolation:void 0,C,M):new xl(m&&M?"constant":"source",o.value,C,M)):vl([new Ma("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bl{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,tp(this._parameters,this._specification))}static deserialize(e){return new bl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function pa(o){let e=null;if(o instanceof Uh)e=pa(o.result);else if(o instanceof Vh){for(const i of o.args)if(e=pa(i),e)break}else(o instanceof zd||o instanceof ha)&&o.input instanceof is&&o.input.name==="zoom"&&(e=o);return e instanceof Ma||o.eachChild((i=>{const l=pa(i);l instanceof Ma?e=l:e&&l&&e!==l&&(e=new Ma("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Zh,rp,ps=(function(){if(rp)return Zh;rp=1,Zh=e;var o=3;function e(i,l,u){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(l=m[1])+2*(u=m[2]);for(var w=0;w<this.d*this.d;w++){var C=m[o+w],M=m[o+w+1];f.push(C===M?null:m.subarray(C,M))}var B=m[o+f.length+1];this.keys=m.subarray(m[o+f.length],B),this.bboxes=m.subarray(B),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var U=0;U<this.d*this.d;U++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=u,this.scale=l/i,this.uid=0;var $=u/l*i;this.min=-$,this.max=i+$}return e.prototype.insert=function(i,l,u,f,m){this._forEachCell(l,u,f,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,l,u,f,m,w){this.cells[m].push(w)},e.prototype.query=function(i,l,u,f,m){var w=this.min,C=this.max;if(i<=w&&l<=w&&C<=u&&C<=f&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(i,l,u,f,this._queryCell,M,{},m),M},e.prototype._queryCell=function(i,l,u,f,m,w,C,M){var B=this.cells[m];if(B!==null)for(var U=this.keys,$=this.bboxes,Q=0;Q<B.length;Q++){var ee=B[Q];if(C[ee]===void 0){var he=4*ee;(M?M($[he+0],$[he+1],$[he+2],$[he+3]):i<=$[he+2]&&l<=$[he+3]&&u>=$[he+0]&&f>=$[he+1])?(C[ee]=!0,w.push(U[ee])):C[ee]=!1}}},e.prototype._forEachCell=function(i,l,u,f,m,w,C,M){for(var B=this._convertToCellCoord(i),U=this._convertToCellCoord(l),$=this._convertToCellCoord(u),Q=this._convertToCellCoord(f),ee=B;ee<=$;ee++)for(var he=U;he<=Q;he++){var _e=this.d*he+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(he),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(he+1)))&&m.call(this,i,l,u,f,_e,w,C,M))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,l=o+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var m=new Int32Array(l+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var w=l,C=0;C<i.length;C++){var M=i[C];m[o+C]=w,m.set(M,w),w+=M.length}return m[o+i.length]=w,m.set(this.keys,w),m[o+i.length+1]=w+=this.keys.length,m.set(this.bboxes,w),w+=this.bboxes.length,m.buffer},Zh})(),ma=co(ps);const $d={};function In(o,e,i={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),$d[e]={klass:o,omit:i.omit||[]}}In(Object,"Object"),ma.serialize=function(o,e){const i=o.toArrayBuffer();return e&&e.add(i),{buffer:i}},ma.deserialize=function(o){return new ma(o.buffer)},Object.defineProperty(ma,"name",{value:"Grid"}),In(ma,"Grid"),delete Kt.prototype.constructor,typeof DOMMatrix<"u"&&In(DOMMatrix,"DOMMatrix"),In(mi,"Color"),In(Error,"Error"),In(vs,"Formatted"),In(Ph,"FormattedSection"),In(Cf,"AJAXError"),In(Ys,"ResolvedImage"),In(bl,"StylePropertyFunction"),In(Wh,"StyleExpression",{omit:["_evaluator"]}),In(xa,"ImageId"),In(Ia,"ImageVariant"),In(Js,"ZoomDependentExpression"),In(xl,"ZoomConstantExpression"),In(is,"CompoundExpression",{omit:["_evaluate"]});for(const o in Kc)$d[Kc[o]._classRegistryKey]||In(Kc[o],`Expression${o}`);function lm(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Cc(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ec(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(lm(o)||Cc(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const i=[];for(const l of o)i.push(Ec(l,e));return i}if(o instanceof Map){const i={$name:"Map",entries:[]};for(const[l,u]of o.entries())i.entries.push(Ec(l),Ec(u,e));return i}if(o instanceof Set){const i={$name:"Set"};let l=0;for(const u of o.values())i[++l]=Ec(u);return i}if(o instanceof DOMMatrix){const i={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of l)i[u]=o[u];return i}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const i=o.constructor,l=i._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(o,e):{};if(!i.serialize){for(const f in o)o.hasOwnProperty(f)&&($d[l].omit.indexOf(f)>=0||(u[f]=Ec(o[f],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof o)}function eu(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||lm(o)||Cc(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(eu);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],f=new Map;for(let m=0;m<u.length;m+=2)f.set(eu(u[m]),eu(u[m+1]));return f}if(e==="Set"){const u=new Set;for(const f of Object.keys(o))f!=="$name"&&u.add(eu(o[f]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:i}=$d[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(o);const l=Object.create(i.prototype);for(const u of Object.keys(o))u!=="$name"&&(l[u]=eu(o[u]));return l}throw new Error("can't deserialize object of type "+typeof o)}const rr={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function cm(o){for(const e of o)if(ip(e.charCodeAt(0)))return!0;return!1}function Vu(o){for(const e of o)if(!Zl(e.charCodeAt(0)))return!1;return!0}function Zl(o){return!(rr.Arabic(o)||rr["Arabic Supplement"](o)||rr["Arabic Extended-A"](o)||rr["Arabic Presentation Forms-A"](o)||rr["Arabic Presentation Forms-B"](o))}function ip(o){return!(o!==746&&o!==747&&(o<4352||!(rr["Bopomofo Extended"](o)||rr.Bopomofo(o)||rr["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||rr["CJK Compatibility Ideographs"](o)||rr["CJK Compatibility"](o)||rr["CJK Radicals Supplement"](o)||rr["CJK Strokes"](o)||!(!rr["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||rr["CJK Unified Ideographs Extension A"](o)||rr["CJK Unified Ideographs"](o)||rr["Enclosed CJK Letters and Months"](o)||rr["Hangul Compatibility Jamo"](o)||rr["Hangul Jamo Extended-A"](o)||rr["Hangul Jamo Extended-B"](o)||rr["Hangul Jamo"](o)||rr["Hangul Syllables"](o)||rr.Hiragana(o)||rr["Ideographic Description Characters"](o)||rr.Kanbun(o)||rr["Kangxi Radicals"](o)||rr["Katakana Phonetic Extensions"](o)||rr.Katakana(o)&&o!==12540||!(!rr["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!rr["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||rr["Unified Canadian Aboriginal Syllabics"](o)||rr["Unified Canadian Aboriginal Syllabics Extended"](o)||rr["Vertical Forms"](o)||rr["Yijing Hexagram Symbols"](o)||rr["Yi Syllables"](o)||rr["Yi Radicals"](o))))}function op(o){return!(ip(o)||(function(e){return!!(rr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||rr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||rr["Letterlike Symbols"](e)||rr["Number Forms"](e)||rr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||rr["Control Pictures"](e)&&e!==9251||rr["Optical Character Recognition"](e)||rr["Enclosed Alphanumerics"](e)||rr["Geometric Shapes"](e)||rr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||rr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||rr["CJK Symbols and Punctuation"](e)||rr.Katakana(e)||rr["Private Use Area"](e)||rr["CJK Compatibility Forms"](e)||rr["Small Form Variants"](e)||rr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function C_(o){return rr.Arabic(o)||rr["Arabic Supplement"](o)||rr["Arabic Extended-A"](o)||rr["Arabic Presentation Forms-A"](o)||rr["Arabic Presentation Forms-B"](o)}function Hd(o){return o>=1424&&o<=2303||rr["Arabic Presentation Forms-A"](o)||rr["Arabic Presentation Forms-B"](o)}function E_(o,e){return!(!e&&Hd(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||rr.Khmer(o))}function A_(o){for(const e of o)if(Hd(e.charCodeAt(0)))return!0;return!1}const ba={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Uu=null,Qs=ba.unavailable,tu=null;const dg=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Qs=ba.error),Uu&&Uu(o)};function um(){dm.fire(new Ga("pluginStateChange",{pluginStatus:Qs,pluginURL:tu}))}const dm=new Uc,sp=function(){return Qs},ju=function(){if(Qs!==ba.deferred||!tu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qs=ba.loading,um(),tu&&Au({url:tu},(o=>{o?dg(o):(Qs=ba.loaded,um())}))},Yl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qs===ba.loaded||Yl.applyArabicShaping!=null,isLoading:()=>Qs===ba.loading,setState(o){Qs=o.pluginStatus,tu=o.pluginURL},isParsing:()=>Qs===ba.parsing,isParsed:()=>Qs===ba.parsed,getPluginURL:()=>tu};class ki{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,l){for(const u of i)if(!E_(u.charCodeAt(0),l))return!1;return!0})(e,Yl.isLoaded())}}class Gu{constructor(e,i,l,u,f){this.property=e,this.value=i,this.expression=(function(m,w,C,M,B){if(ep(m))return new bl(m,w);if(am(m)||Array.isArray(m)&&m.length>0){const U=xs(m,w,C,M,B);if(U.result==="error")throw new Error(U.value.map(($=>`${$.key}: ${$.message}`)).join(", "));return U.value}{let U=m;return typeof m=="string"&&w.type==="color"&&(U=mi.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>U}}})(i===void 0?e.specification.default:i,e.specification,l,u,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l,u){return this.property.possiblyEvaluate(this,e,i,l,u)}}class hm{constructor(e,i,l,u){this.property=e,this.value=new Gu(e,void 0,i,l,u)}transitioned(e,i){return new Xl(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Xl(this.property,this.value,null,{},0)}}class hg{constructor(e,i,l,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return Ir(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new hm(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Gu(this._values[e].property,i===null?void 0:Ir(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const l=this._properties.properties;if(e)for(const u in e){const f=e[u];if(u.endsWith("-transition")){const m=u.slice(0,-11);l[m]&&this.setTransition(m,f)}else l.hasOwnProperty(u)&&this.setValue(u,f)}}getTransition(e){return Ir(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new hm(this._values[e].property)),this._values[e].transition=Ir(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const l=new fm(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,i._values[u]);return l}untransitioned(){const e=new fm(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Xl{constructor(e,i,l,u,f){const m=u.delay||0,w=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+m,this.end=this.begin+w,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,l),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,i,l);{const w=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,l),f,Ge(w))}}return f}}class fm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const u=new qu(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class $u{constructor(e,i,l,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return Ir(this._values[e].value)}setValue(e,i){this._values[e]=new Gu(this._values[e].property,i===null?void 0:Ir(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l,u){const f=new qu(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(e,i,l,u);return f}}class Hu{constructor(e,i,l,u){this.property=e,this.value=i,this.parameters=l,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,u){return this.property.evaluate(this.value,this.parameters,e,i,l,u,this.iconImageUseTheme)}}class qu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ln{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const u=Ws[this.specification.type];return u?u(e,i,l):e}}class wn{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,u,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Hu(this,{kind:"constant",value:e.expression.evaluate(i,null,{},l,u,void 0,f)},i):new Hu(this,e.expression,i,f)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Hu(this,{kind:"constant",value:void 0},e.parameters);const u=Ws[this.specification.type];return u?new Hu(this,{kind:"constant",value:u(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,u,f,m,w){return e.kind==="constant"?e.value:e.evaluate(i,l,u,f,m,void 0,w)}}class Wu{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,u){return!!e.expression.evaluate(i,null,{},l,u)}interpolate(){return!1}}class oo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ki(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new Gu(u,void 0),m=this.defaultTransitionablePropertyValues[l]=new hm(u);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}In(wn,"DataDrivenProperty"),In(ln,"DataConstantProperty"),In(Wu,"ColorRampProperty");var yt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Yh(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function nu(o){if(Array.isArray(o))return o.map(nu);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const i in o)e[i]=nu(o[i]);return e}return Yh(o)}function Xh(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Xh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Zu(o,e="",i=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xh(o)||(o=lp(o));const u=o;let f=!0;try{f=(function(B){if(!qd(B))return B;let U=nu(B);return wl(U),U=ap(U),U})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let m=null,w=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){w=yt[`filter_${l}`];const B=Wl(f,w,e,i);if(B.result==="error")throw new Error(B.value.map((U=>`${U.key}: ${U.message}`)).join(", "));m=(U,$,Q)=>B.value.evaluate(U,$,{},Q)}let C=null,M=null;if(f!==u){const B=Wl(u,w,e,i);if(B.result==="error")throw new Error(B.value.map((U=>`${U.key}: ${U.message}`)).join(", "));C=(U,$,Q,ee,he)=>B.value.evaluate(U,$,{},Q,void 0,void 0,ee,he),M=!qc(B.value.expression)}return{filter:m,dynamicFilter:C||void 0,needGeometry:pm(f),needFeature:!!M}}function ap(o){if(!Array.isArray(o))return o;const e=(function(i){if(fg.has(i[0])){for(let l=1;l<i.length;l++)if(qd(i[l]))return!0}return i})(o);return e===!0?e:e.map((i=>ap(i)))}function wl(o){let e=!1;const i=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||qd(o[l]),i.push(o[l+1]);i.push(o[o.length-1])}else if(o[0]==="match"){e=e||qd(o[1]);for(let l=2;l<o.length-1;l+=2)i.push(o[l+1]);i.push(o[o.length-1])}else if(o[0]==="step"){e=e||qd(o[1]);for(let l=1;l<o.length-1;l+=2)i.push(o[l+1])}e&&(o.length=0,o.push("any",...i));for(let l=1;l<o.length;l++)wl(o[l])}function qd(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<o.length;i++)if(qd(o[i]))return!0;return!1}const fg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function P_(o,e){return o<e?-1:o>e?1:0}function pm(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(pm(o[e]))return!0;return!1}function lp(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?mm(o[1],o[2],"=="):e==="!="?cp(mm(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?mm(o[1],o[2],e):e==="any"?(i=o.slice(1),["any"].concat(i.map(lp))):e==="all"?["all"].concat(o.slice(1).map(lp)):e==="none"?["all"].concat(o.slice(1).map(lp).map(cp)):e==="in"?pg(o[1],o.slice(2)):e==="!in"?cp(pg(o[1],o.slice(2))):e==="has"?mg(o[1]):e!=="!has"||cp(mg(o[1]));var i}function mm(o,e,i){switch(o){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,o,e]}}function pg(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",o,["literal",e.sort(P_)]]:["filter-in-small",o,["literal",e]]}}function mg(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function cp(o){return["!",o]}const Kh="";function Wd(o,e){return e?`${o}${Kh}${e}`:o}let gm;const gg=()=>gm||(gm=new oo({"icon-size":new wn(yt.layout_symbol["icon-size"]),"icon-image":new wn(yt.layout_symbol["icon-image"]),"icon-rotate":new wn(yt.layout_symbol["icon-rotate"]),"icon-offset":new wn(yt.layout_symbol["icon-offset"])}));class M_{constructor(e,i,l,u,f,m){const w=Wl(e,yt.appearance.condition);if(w.result==="success"&&(this.condition=w.value),this.name=i,l){this.properties=new qu(gg()),this.unevaluatedLayout=new $u(gg(),u,f,m);for(const C in l)this.unevaluatedLayout.setValue(C,l[C])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const _g="-transition",yg=new Set(["fill","line","background","hillshade","raster"]);class Ds extends Uc{constructor(e,i,l,u,f,m){if(super(),this.id=e.id,this.fqid=Wd(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=f,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const w=Wl(this.filter,yt[`filter_${e.type}`]);w.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...w.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach((w=>{this.appearances.push(new M_(w.condition,w.name,w.properties,this.scope,f,this.iconImageUseTheme))})),i.layout&&(this._unevaluatedLayout=new $u(i.layout,this.scope,f,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new hg(i.paint,this.scope,f);for(const w in e.paint)this.setPaintProperty(w,e.paint[w]);for(const w in e.layout)this.setLayoutProperty(w,e.layout[w]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&yg.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(_g)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(_g)){const U=e.slice(0,-11);return u[U]&&l.setTransition(U,i||void 0),!1}if(!u[e])return!1;const f=l._values[e],m=f.value.isDataDriven(),w=f.value;l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const C=l._values[e].value,M=C.isDataDriven(),B=e.endsWith("pattern")||e==="line-dasharray";return M||m||B||this._handleOverridablePaintPropertyUpdate(e,w,C)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,l){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),Nr(e,((i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Hu&&Jf(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Zu(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,l,u,f,m,w,C,M){}}const ru={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zd{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fi{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function jr(o,e=1){let i=0,l=0;return{members:o.map((u=>{const f=ru[u.type].BYTES_PER_ELEMENT,m=i=vg(i,Math.max(e,f)),w=u.components||1;return l=Math.max(l,f),i+=f*w,{name:u.name,type:u.type,components:w,offset:m}})),size:vg(i,Math.max(l,e)),alignment:e}}function vg(o,e){return Math.ceil(o/e)*e}class iu extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=l,e}}iu.prototype.bytesPerElement=4,In(iu,"StructArrayLayout2i4");class ks extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=u,e}}ks.prototype.bytesPerElement=6,In(ks,"StructArrayLayout3i6");class ou extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=u,this.int16[m+3]=f,e}}ou.prototype.bytesPerElement=8,In(ou,"StructArrayLayout4i8");class Kl extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Kl.prototype.bytesPerElement=4,In(Kl,"StructArrayLayout1f4");class up extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=4*e,m=2*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.float32[m+1]=u,e}}up.prototype.bytesPerElement=8,In(up,"StructArrayLayout2i1f8");class Jh extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=u,e}}Jh.prototype.bytesPerElement=8,In(Jh,"StructArrayLayout3i8");class dp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const w=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=m,e}}dp.prototype.bytesPerElement=10,In(dp,"StructArrayLayout5i10");class hp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,l,u,f,m,w)}emplace(e,i,l,u,f,m,w,C){const M=6*e,B=12*e,U=3*e;return this.int16[M+0]=i,this.int16[M+1]=l,this.uint8[B+4]=u,this.uint8[B+5]=f,this.uint8[B+6]=m,this.uint8[B+7]=w,this.float32[U+2]=C,e}}hp.prototype.bytesPerElement=12,In(hp,"StructArrayLayout2i4ub1f12");class ea extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=u,e}}ea.prototype.bytesPerElement=12,In(ea,"StructArrayLayout3f12");class Ac extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const w=6*e,C=3*e;return this.uint16[w+0]=i,this.uint16[w+1]=l,this.uint16[w+2]=u,this.uint16[w+3]=f,this.float32[C+2]=m,e}}Ac.prototype.bytesPerElement=12,In(Ac,"StructArrayLayout4ui1f12");class Yd extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=u,this.uint16[m+3]=f,e}}Yd.prototype.bytesPerElement=8,In(Yd,"StructArrayLayout4ui8");class fp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,w){const C=6*e;return this.int16[C+0]=i,this.int16[C+1]=l,this.int16[C+2]=u,this.int16[C+3]=f,this.int16[C+4]=m,this.int16[C+5]=w,e}}fp.prototype.bytesPerElement=12,In(fp,"StructArrayLayout6i12");class _m extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U,$){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,l,u,f,m,w,C,M,B,U,$)}emplace(e,i,l,u,f,m,w,C,M,B,U,$,Q){const ee=12*e;return this.int16[ee+0]=i,this.int16[ee+1]=l,this.int16[ee+2]=u,this.int16[ee+3]=f,this.uint16[ee+4]=m,this.uint16[ee+5]=w,this.uint16[ee+6]=C,this.uint16[ee+7]=M,this.int16[ee+8]=B,this.int16[ee+9]=U,this.int16[ee+10]=$,this.int16[ee+11]=Q,e}}_m.prototype.bytesPerElement=24,In(_m,"StructArrayLayout4i4ui4i24");class pp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,w){const C=10*e,M=5*e;return this.int16[C+0]=i,this.int16[C+1]=l,this.int16[C+2]=u,this.float32[M+2]=f,this.float32[M+3]=m,this.float32[M+4]=w,e}}pp.prototype.bytesPerElement=20,In(pp,"StructArrayLayout3i3f20");class Sl extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=u,this.float32[m+3]=f,e}}Sl.prototype.bytesPerElement=16,In(Sl,"StructArrayLayout4f16");class Ho extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ho.prototype.bytesPerElement=4,In(Ho,"StructArrayLayout1ul4");class zo extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=l,e}}zo.prototype.bytesPerElement=4,In(zo,"StructArrayLayout2ui4");class Xd extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U,$,Q){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,l,u,f,m,w,C,M,B,U,$,Q)}emplace(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee){const he=20*e,_e=10*e;return this.int16[he+0]=i,this.int16[he+1]=l,this.int16[he+2]=u,this.int16[he+3]=f,this.int16[he+4]=m,this.float32[_e+3]=w,this.float32[_e+4]=C,this.float32[_e+5]=M,this.float32[_e+6]=B,this.int16[he+14]=U,this.uint32[_e+8]=$,this.uint16[he+18]=Q,this.uint16[he+19]=ee,e}}Xd.prototype.bytesPerElement=40,In(Xd,"StructArrayLayout5i4f1i1ul2ui40");class Qh extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,l,u,f,m,w)}emplace(e,i,l,u,f,m,w,C){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=l,this.int16[M+2]=u,this.int16[M+4]=f,this.int16[M+5]=m,this.int16[M+6]=w,this.int16[M+7]=C,e}}Qh.prototype.bytesPerElement=16,In(Qh,"StructArrayLayout3i2i2i16");class mp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const w=4*e,C=8*e;return this.float32[w+0]=i,this.float32[w+1]=l,this.float32[w+2]=u,this.int16[C+6]=f,this.int16[C+7]=m,e}}mp.prototype.bytesPerElement=16,In(mp,"StructArrayLayout2f1f2i16");class su extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,w){const C=20*e,M=5*e;return this.uint8[C+0]=i,this.uint8[C+1]=l,this.float32[M+1]=u,this.float32[M+2]=f,this.float32[M+3]=m,this.float32[M+4]=w,e}}su.prototype.bytesPerElement=20,In(su,"StructArrayLayout2ub4f20");class Fo extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=u,e}}Fo.prototype.bytesPerElement=6,In(Fo,"StructArrayLayout3ui6");class Jl extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je)}emplace(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je,Qe){const st=30*e,lt=15*e,ft=60*e;return this.int16[st+0]=i,this.int16[st+1]=l,this.int16[st+2]=u,this.float32[lt+2]=f,this.float32[lt+3]=m,this.uint16[st+8]=w,this.uint16[st+9]=C,this.uint32[lt+5]=M,this.uint32[lt+6]=B,this.uint32[lt+7]=U,this.uint16[st+16]=$,this.uint16[st+17]=Q,this.uint16[st+18]=ee,this.float32[lt+10]=he,this.float32[lt+11]=_e,this.uint8[ft+48]=ve,this.uint8[ft+49]=De,this.uint8[ft+50]=ke,this.uint32[lt+13]=ze,this.int16[st+28]=Je,this.uint8[ft+58]=Qe,e}}Jl.prototype.bytesPerElement=60,In(Jl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class au extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je,Qe,st,lt,ft,Ut,vt,$t,tn,qt,Jt,on,Bt){const Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je,Qe,st,lt,ft,Ut,vt,$t,tn,qt,Jt,on,Bt)}emplace(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke,ze,Je,Qe,st,lt,ft,Ut,vt,$t,tn,qt,Jt,on,Bt,Qt){const Dt=20*e,Et=40*e,an=80*e;return this.float32[Dt+0]=i,this.float32[Dt+1]=l,this.int16[Et+4]=u,this.int16[Et+5]=f,this.int16[Et+6]=m,this.int16[Et+7]=w,this.int16[Et+8]=C,this.int16[Et+9]=M,this.int16[Et+10]=B,this.int16[Et+11]=U,this.int16[Et+12]=$,this.uint16[Et+13]=Q,this.uint16[Et+14]=ee,this.uint16[Et+15]=he,this.uint16[Et+16]=_e,this.uint16[Et+17]=ve,this.uint16[Et+18]=De,this.uint16[Et+19]=ke,this.uint16[Et+20]=ze,this.uint16[Et+21]=Je,this.uint16[Et+22]=Qe,this.uint16[Et+23]=st,this.uint16[Et+24]=lt,this.uint16[Et+25]=ft,this.uint16[Et+26]=Ut,this.uint16[Et+27]=vt,this.uint32[Dt+14]=$t,this.float32[Dt+15]=tn,this.float32[Dt+16]=qt,this.float32[Dt+17]=Jt,this.float32[Dt+18]=on,this.uint8[an+76]=Bt,this.uint16[Et+39]=Qt,e}}au.prototype.bytesPerElement=80,In(au,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Os extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,w){const C=6*e;return this.float32[C+0]=i,this.float32[C+1]=l,this.float32[C+2]=u,this.float32[C+3]=f,this.float32[C+4]=m,this.float32[C+5]=w,e}}Os.prototype.bytesPerElement=24,In(Os,"StructArrayLayout6f24");class Yu extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const w=5*e;return this.float32[w+0]=i,this.float32[w+1]=l,this.float32[w+2]=u,this.float32[w+3]=f,this.float32[w+4]=m,e}}Yu.prototype.bytesPerElement=20,In(Yu,"StructArrayLayout5f20");class ym extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,l,u,f,m,w)}emplace(e,i,l,u,f,m,w,C){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=l,this.float32[M+2]=u,this.float32[M+3]=f,this.float32[M+4]=m,this.float32[M+5]=w,this.float32[M+6]=C,e}}ym.prototype.bytesPerElement=28,In(ym,"StructArrayLayout7f28");class Xu extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U){const $=this.length;return this.resize($+1),this.emplace($,e,i,l,u,f,m,w,C,M,B,U)}emplace(e,i,l,u,f,m,w,C,M,B,U,$){const Q=11*e;return this.float32[Q+0]=i,this.float32[Q+1]=l,this.float32[Q+2]=u,this.float32[Q+3]=f,this.float32[Q+4]=m,this.float32[Q+5]=w,this.float32[Q+6]=C,this.float32[Q+7]=M,this.float32[Q+8]=B,this.float32[Q+9]=U,this.float32[Q+10]=$,e}}Xu.prototype.bytesPerElement=44,In(Xu,"StructArrayLayout11f44");class lu extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,l,u,f,m,w,C,M)}emplace(e,i,l,u,f,m,w,C,M,B){const U=9*e;return this.float32[U+0]=i,this.float32[U+1]=l,this.float32[U+2]=u,this.float32[U+3]=f,this.float32[U+4]=m,this.float32[U+5]=w,this.float32[U+6]=C,this.float32[U+7]=M,this.float32[U+8]=B,e}}lu.prototype.bytesPerElement=36,In(lu,"StructArrayLayout9f36");class Pc extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=l,e}}Pc.prototype.bytesPerElement=8,In(Pc,"StructArrayLayout2f8");class Kd extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=l,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}Kd.prototype.bytesPerElement=12,In(Kd,"StructArrayLayout1ul3ui12");class gp extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}gp.prototype.bytesPerElement=2,In(gp,"StructArrayLayout1ui2");class vm extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e){const ve=this.length;return this.resize(ve+1),this.emplace(ve,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e)}emplace(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve){const De=16*e;return this.float32[De+0]=i,this.float32[De+1]=l,this.float32[De+2]=u,this.float32[De+3]=f,this.float32[De+4]=m,this.float32[De+5]=w,this.float32[De+6]=C,this.float32[De+7]=M,this.float32[De+8]=B,this.float32[De+9]=U,this.float32[De+10]=$,this.float32[De+11]=Q,this.float32[De+12]=ee,this.float32[De+13]=he,this.float32[De+14]=_e,this.float32[De+15]=ve,e}}vm.prototype.bytesPerElement=64,In(vm,"StructArrayLayout16f64");class ta extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,l,u,f,m,w)}emplace(e,i,l,u,f,m,w,C){const M=10*e,B=5*e;return this.uint16[M+0]=i,this.uint16[M+1]=l,this.uint16[M+2]=u,this.uint16[M+3]=f,this.float32[B+2]=m,this.float32[B+3]=w,this.float32[B+4]=C,e}}ta.prototype.bytesPerElement=20,In(ta,"StructArrayLayout4ui3f20");class Ku extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Ku.prototype.bytesPerElement=2,In(Ku,"StructArrayLayout1i2");class _p extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}_p.prototype.bytesPerElement=1,In(_p,"StructArrayLayout1ub1");class yp extends Zd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}yp.prototype.size=40;class xm extends Xd{get(e){return new yp(this,e)}}In(xm,"CollisionBoxArray");class xg extends Zd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xg.prototype.size=60;class vp extends Jl{get(e){return new xg(this,e)}}In(vp,"PlacedSymbolArray");class Jd extends Zd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Jd.prototype.size=80;class wa extends au{get(e){return new Jd(this,e)}}In(wa,"SymbolInstanceArray");class xp extends Kl{getoffsetX(e){return this.float32[1*e+0]}}In(xp,"GlyphOffsetArray");class bm extends iu{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}In(bm,"SymbolLineVertexArray");class ef extends Zd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ef.prototype.size=12;class wm extends Kd{get(e){return new ef(this,e)}}In(wm,"FeatureIndexArray");class Ju extends zo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}In(Ju,"FillExtrusionCentroidArray");class Qu extends Zd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Qu.prototype.size=6;class tf extends ks{get(e){return new Qu(this,e)}}In(tf,"FillExtrusionWallArray");const bp=jr([{name:"a_pos",components:2,type:"Int16"}],4),Za=jr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ya=jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Pi{constructor(e=[]){this.segments=e}_prepareSegment(e,i,l,u){let f=this.segments[this.segments.length-1];return e>Pi.MAX_VERTEX_ARRAY_LENGTH&&Vr(`Max vertices per segment is ${Pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Pi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,i,l,u){return this._prepareSegment(e,i.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,u){return new Pi([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function Oa(o,e){return 256*(o=et(Math.floor(o),0,255))+et(Math.floor(e),0,255)}Pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,In(Pi,"SegmentVector");const Mc=jr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ls=jr([{name:"a_pattern_b",components:4,type:"Uint16"}]),cu=jr([{name:"a_dash",components:4,type:"Uint16"}]);class Xa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,l,u){this.ids.push(Qd(e)),this.positions.push(i,l,u)}eachPosition(e,i){const l=Qd(e);let u=0,f=this.ids.length-1;for(;u<f;){const m=u+f>>1;this.ids[m]>=l?f=m:u=m+1}for(;this.ids[u]===l;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return zs(l,u,0,l.length-1),i&&(i.add(l.buffer),i.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const i=new Xa;let l;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==l&&i.uniqueIds.push(u),l=u;return i.indexed=!0,i}}function Qd(o){const e=+o;return Number.isSafeInteger(e)?e:Pf(String(o))}function zs(o,e,i,l){for(;i<l;){const u=o[i+l>>1];let f=i-1,m=l+1;for(;;){do f++;while(o[f]<u);do m--;while(o[m]>u);if(f>=m)break;Wo(o,f,m),Wo(e,3*f,3*m),Wo(e,3*f+1,3*m+1),Wo(e,3*f+2,3*m+2)}m-i<l-m?(zs(o,e,i,m),i=m+1):(zs(o,e,m+1,l),l=m)}}function Wo(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}In(Xa,"FeaturePositionMap");class Ci{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Tl extends Ci{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Bi extends Ci{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Ka extends Ci{constructor(e){super(e),this.current=[0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Fs extends Ci{constructor(e){super(e),this.current=[0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class uu extends Ci{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class du extends Ci{constructor(e){super(e),this.current=mi.transparent.toPremultipliedRenderColor(null)}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Ic=new Float32Array(16);class nf extends Ci{constructor(e){super(e),this.current=Ic}set(e,i,l){if(this.fetchUniformLocation(e,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const I_=new Float32Array(9),R_=new Float32Array(4);class Bo extends Ci{constructor(e){super(e),this.current=R_}set(e,i,l){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function hu(o){return[Oa(255*o.r,255*o.g),Oa(255*o.b,255*o.a)]}class bs{constructor(e,i,l,u){this.value=e,this.uniformNames=i.map((f=>`u_${f}`)),this.type=l,this.context=u}setUniform(e,i,l,u,f){const m=u.constantOr(this.value);i.set(e,f,m instanceof mi?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new du(e):new Bi(e)}}class Rc{constructor(e,i){this.uniformNames=i.map((l=>`u_${l}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,l,u,f){let m=null;f!=="u_pattern"&&f!=="u_dash"||(m=this.pattern),f==="u_pattern_b"&&(m=this.patternTransition),f==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,f,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new uu(e):new Bi(e)}}class Cl{constructor(e,i,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,l,u,f,m,w,C){const M=this.paintVertexArray.length,B=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ki(0,{brightness:m,worldview:C}),i,{},f,u,w):this.expression.kind==="constant"&&this.expression.value,U=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ki(0,{brightness:m,worldview:C}),i,{},f,u,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(M,e,B,U?null:this.context.lut)}updatePaintArray(e,i,l,u,f,m,w,C){const M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:C},l,u,void 0,f):this.expression.kind==="constant"&&this.expression.value,B=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ki(0,{brightness:w,worldview:C}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,M,B?null:this.context.lut)}_setPaintValue(e,i,l,u){if(this.type==="color"){const f=hu(l.toPremultipliedRenderColor(u));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class El{constructor(e,i,l,u,f,m){this.expression=e,this.uniformNames=i.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=u,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,i,l,u,f,m,w,C){const M=this.expression.evaluate(new ki(this.context.zoom,{brightness:m,worldview:C}),i,{},f,u,w),B=this.expression.evaluate(new ki(this.context.zoom+1,{brightness:m,worldview:C}),i,{},f,u,w),U=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ki(0,{brightness:m,worldview:C}),i,{},f,u,w):this.lutExpression.value)==="none",$=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue($,e,M,B,U?null:this.context.lut)}updatePaintArray(e,i,l,u,f,m,w,C){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:C},l,u,void 0,f),B=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:C},l,u,void 0,f),U=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ki(0,{brightness:w,worldview:C}),l,u,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,M,B,U?null:this.context.lut)}_setPaintValue(e,i,l,u,f){if(this.type==="color"){const m=hu(l.toPremultipliedRenderColor(f)),w=hu(l.toPremultipliedRenderColor(f));for(let C=e;C<i;C++)this.paintVertexArray.emplace(C,m[0],m[1],w[0],w[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,u,f){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,w=et(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,w)}getBinding(e,i){return new Bi(e)}}class Sa{constructor(e,i,l,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?cu:Mc).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new u,this.paintTransitionVertexArray=new Yd}populatePaintArray(e,i,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,u,f,m,w){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,i,l,u){if(!u||!l)return;const f=u[l[0]],m=u[l[1]];if(f){if(f){const{tl:w,br:C,pixelRatio:M}=f;for(let B=e;B<i;B++)this.paintVertexArray.emplace(B,w[0],w[1],C[0],C[1],M)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:C}=m;for(let M=e;M<i;M++)this.paintTransitionVertexArray.emplace(M,w[0],w[1],C[0],C[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Ls.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Al{constructor(e,i,l=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const u=[];for(const f in e.paint._values){const m=e.paint.get(f);if(f.endsWith("-use-theme")||!l(f)||!(m instanceof Hu&&Jf(m.property.specification)))continue;const w=rf(f,e.type),C=m.value,M=m.property.specification.type,B=!!m.property.useIntegerZoom,U=f==="line-dasharray"||f.endsWith("pattern"),$=e.paint.get(`${f}-use-theme`),Q=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||$&&$.value.kind!=="constant";if(C.kind!=="constant"||Q)if(C.kind==="source"||Q||U){const ee=a(f,M,"source");this.binders[f]=U?new Sa(C,w,M,ee,e.id):new Cl(C,w,M,ee),u.push(`/a_${f}`)}else{const ee=a(f,M,"composite");this.binders[f]=new El(C,w,M,B,i,ee),u.push(`/z_${f}`)}else this.binders[f]=U?new Rc(C.value,w):new bs(C.value,w,M,i),u.push(`/u_${f}`);$&&(this.binders[f].lutExpression=$.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Cl||i instanceof El?i.maxValue:0}populatePaintArrays(e,i,l,u,f,m,w,C){for(const M in this.binders){const B=this.binders[M];B.context=this.context,(B instanceof Cl||B instanceof El||B instanceof Sa)&&B.populatePaintArray(e,i,l,u,f,m,w,C)}}setConstantPatternPositions(e,i){for(const l in this.binders){const u=this.binders[l];u instanceof Rc&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Sa?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,l,u,f,m,w,C,M,B){let U=!1;const $=Object.keys(e),Q=$.length!==0&&!C,ee=Q?$:i.uniqueIds;this.context.lut=f.lut;for(const he in this.binders){const _e=this.binders[he];if(_e.context=this.context,(_e instanceof Cl||_e instanceof El||_e instanceof Sa)&&_e.expression&&_e.expression.kind&&_e.expression.kind!=="constant"&&(_e.expression.isStateDependent===!0||_e.expression.isLightConstant===!1)){const ve=f.paint.get(he);_e.expression=ve.value;for(const De of ee){const ke=e[De.toString()];i.eachPosition(De,((ze,Je,Qe)=>{const st=u.feature(ze);_e.updatePaintArray(Je,Qe,st,ke,m,w,M,B)}))}if(!Q)for(const De of l.uniqueIds){const ke=e[De.toString()];l.eachPosition(De,((ze,Je,Qe)=>{const st=u.feature(ze);_e.updatePaintArray(Je,Qe,st,ke,m,w,M,B)}))}U=!0}}return U}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof bs||l instanceof Rc)&&e.push(...l.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof bs||u instanceof Rc||u instanceof El)for(const f of u.uniformNames)i.push({name:f,property:l,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,l,u,f){for(const{name:m,property:w,binding:C}of l)this.binders[w].setUniform(e,C,f,u.get(w),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Cl||i instanceof El||i instanceof Sa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Sa&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof Cl||l instanceof El||l instanceof Sa)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Cl||i instanceof El||i instanceof Sa)&&i.destroy()}}}class La{constructor(e,i,l=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Al(u,i,l);this.needsUpload=!1,this._featureMap=new Xa,this._featureMapWithoutIds=new Xa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,l,u,f,m,w,C,M){for(const B in this.programConfigurations)this.programConfigurations[B].populatePaintArrays(e,i,u,f,m,w,C,M);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,u,f,m,w,C){for(const M of l)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,M,u,f,m,w||0,C)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ed={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function rf(o,e){return ed[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const h={"line-pattern":{source:Ac,composite:Ac},"fill-pattern":{source:Ac,composite:Ac},"fill-extrusion-pattern":{source:Ac,composite:Ac},"line-dasharray":{source:Yd,composite:Yd}},n={color:{source:Pc,composite:Sl},number:{source:Kl,composite:Pc}};function a(o,e,i){const l=h[o];return l&&l[i]||n[e][i]}In(bs,"ConstantBinder"),In(Rc,"PatternConstantBinder"),In(Cl,"SourceExpressionBinder"),In(Sa,"PatternCompositeBinder"),In(El,"CompositeExpressionBinder"),In(Al,"ProgramConfiguration",{omit:["_buffers"]}),In(La,"ProgramConfigurationSet");const d=hn/Math.PI/2,_=5,b=6,T=16383,P=64,k=[P,32,16],G=-d,q=d;function te(o,e,i,l=d){return i=_t(i),[o*Math.sin(i)*l,-e*l,o*Math.cos(i)*l]}function Y(o,e,i){return te(Math.cos(_t(o)),Math.sin(_t(o)),e,i)}const re=63710088e-1,le=2*Math.PI*re;class ce{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ce(dt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,u=e.lat*i,f=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return re*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new Pe({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(e){return Y(this.lat,this.lng,d+e*d/re)}static convert(e){if(e instanceof ce)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ce(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ce(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Pe{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}setSouthWest(e){return this._sw=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}extend(e){const i=this._sw,l=this._ne;let u,f;if(e instanceof ce)u=e,f=e;else{if(!(e instanceof Pe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pe.convert(e)):this.extend(ce.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ce.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||l?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new ce(u.lng,u.lat),this._ne=new ce(f.lng,f.lat)),this}getCenter(){return new ce((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ce(this.getWest(),this.getNorth())}getSouthEast(){return new ce(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=ce.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Pe?e:new Pe(e)}}const me=0,Me=25.5;function Le(o){return le*Math.cos(o*Math.PI/180)}function Fe(o){return(180+o)/360}function Ze(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function He(o,e){return o/Le(e)}function Ye(o){return 360*o-180}function qe(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function We(o,e){return o*Le(qe(e))}const Xe=85.051129;function Tt(o){return Math.cos(_t(et(o,-Xe,Xe)))}function ht(o,e){const i=et(e,me,Me),l=Math.pow(2,i);return Tt(o)*le/(512*l)}function Lt(o){return 1/Math.cos(o*Math.PI/180)}function bt(o,e=0){const i=Math.exp(Math.PI*(1-(o.y+e/hn)/(1<<o.z)*2));return 80150034*i/(i*i+1)/hn/(1<<o.z)}class Pt{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=ce.convert(e);return new Pt(Fe(l.lng),Ze(l.lat),He(i,l.lat))}toLngLat(){return new ce(Ye(this.x),qe(this.y))}toAltitude(){return We(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/le*Lt(qe(this.y))}}function nn(o,e,i,l,u,f,m,w,C){const M=(e+l)/2,B=(i+u)/2,U=new Kt(M,B);w(U),(function($,Q,ee,he,_e,ve){const De=ee-_e,ke=he-ve;return Math.abs((he-Q)*De-(ee-$)*ke)/Math.hypot(De,ke)})(U.x,U.y,f.x,f.y,m.x,m.y)>=C?(nn(o,e,i,M,B,f,U,w,C),nn(o,M,B,l,u,U,m,w,C)):o.push(m)}function St(o,e,i){let l=o[0],u=l.x,f=l.y;e(l);const m=[l];for(let w=1;w<o.length;w++){const C=o[w],{x:M,y:B}=C;e(C),nn(m,u,f,M,B,l,C,e,i),u=M,f=B,l=C}return m}function rt(o,e,i,l){if(l(e,i)){const u=e.add(i)._mult(.5);rt(o,e,u,l),rt(o,u,i,l)}else o.push(i)}function zt(o,e){let i=o[0];const l=[i];for(let u=1;u<o.length;u++){const f=o[u];rt(l,i,f,e),i=f}return l}const wt=Math.pow(2,14)-1,Zt=-wt-1;function sn(o,e){const i=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=et(i,Zt,wt),o.y=et(l,Zt,wt),(i<o.x||i>o.x+1||l<o.y||l>o.y+1)&&Vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Sn(o,e,i){const l=o.loadGeometry(),u=o.extent,f=hn/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:w,x:C,y:M,projection:B}=i,U=$=>{const Q=Ye((e.x+$.x/u)/m),ee=qe((e.y+$.y/u)/m),he=B.project(Q,ee);$.x=(he.x*w-C)*u,$.y=(he.y*w-M)*u};for(let $=0;$<l.length;$++)if(o.type!==1)l[$]=St(l[$],U,1);else{const Q=[];for(const ee of l[$])ee.x<0||ee.x>=u||ee.y<0||ee.y>=u||(U(ee),Q.push(ee));l[$]=Q}}for(const m of l)for(const w of m)sn(w,f);return l}function Ht(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Sn(o):[]}}class en{constructor(e,i,l,u,f){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(Nn,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,l=[];let u,f=1,m=0,w=0,C=0;for(;e.pos<i;){if(m<=0){const M=e.readVarint();f=7&M,m=M>>3}if(m--,f===1||f===2)w+=e.readSVarint(),C+=e.readSVarint(),f===1&&(u&&l.push(u),u=[]),u&&u.push(new Kt(w,C));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let l=1,u=0,f=0,m=0,w=1/0,C=-1/0,M=1/0,B=-1/0;for(;e.pos<i;){if(u<=0){const U=e.readVarint();l=7&U,u=U>>3}if(u--,l===1||l===2)f+=e.readSVarint(),m+=e.readSVarint(),f<w&&(w=f),f>C&&(C=f),m<M&&(M=m),m>B&&(B=m);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,M,C,B]}toGeoJSON(e,i,l){const u=this.extent*Math.pow(2,l),f=this.extent*e,m=this.extent*i,w=this.loadGeometry();function C($){return[360*($.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*($.y+m)/u)*Math.PI))-90]}function M($){return $.map(C)}let B;if(this.type===1){const $=[];for(const ee of w)$.push(ee[0]);const Q=M($);B=$.length===1?{type:"Point",coordinates:Q[0]}:{type:"MultiPoint",coordinates:Q}}else if(this.type===2){const $=w.map(M);B=$.length===1?{type:"LineString",coordinates:$[0]}:{type:"MultiLineString",coordinates:$}}else{if(this.type!==3)throw new Error("unknown feature type");{const $=(function(ee){const he=ee.length;if(he<=1)return[ee];const _e=[];let ve,De;for(let ke=0;ke<he;ke++){const ze=En(ee[ke]);ze!==0&&(De===void 0&&(De=ze<0),De===ze<0?(ve&&_e.push(ve),ve=[ee[ke]]):ve&&ve.push(ee[ke]))}return ve&&_e.push(ve),_e})(w),Q=[];for(const ee of $)Q.push(ee.map(M));B=Q.length===1?{type:"Polygon",coordinates:Q[0]}:{type:"MultiPolygon",coordinates:Q}}}const U={type:"Feature",geometry:B,properties:this.properties};return this.id!=null&&(U.id=this.id),U}}function Nn(o,e,i){o===1?e.id=i.readVarint():o===2?(function(l,u){const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=u._keys[l.readVarint()],w=u._values[l.readVarint()];u.properties[m]=w}})(i,e):o===3?e.type=i.readVarint():o===4&&(e._geometry=i.pos)}function En(o){let e=0;for(let i,l,u=0,f=o.length,m=f-1;u<f;m=u++)i=o[u],l=o[m],e+=(l.x-i.x)*(i.y+l.y);return e}en.types=["Unknown","Point","LineString","Polygon"];class Gn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Vn,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new en(this._pbf,i,this.extent,this._keys,this._values)}}function Vn(o,e,i){o===15?e.version=i.readVarint():o===1?e.name=i.readString():o===5?e.extent=i.readVarint():o===2?e._features.push(i.pos):o===3?e._keys.push(i.readString()):o===4&&e._values.push((function(l){let u=null;const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=l.readVarint()>>3;u=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class Kn{constructor(e,i){this.layers=e.readFields(ir,{},i)}}function ir(o,e,i){if(o===3){const l=new Gn(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}const dr="3d_elevation_id",qr="level";class hr{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,l){return this.get(e,!0,i,l)}optional(e,i,l){return this.get(e,!1,i,l)}success(){return this._valid}get(e,i,l,u){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?l(u?u(f):f):i&&(this._valid=!1),this}}class ri{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,l){return this.featureFunc(e,i,l)}parseVertex(e,i,l){return this.vertexFunc(e,i,l)}}const si=new ri(((o,e,i)=>o.reset(e).require(dr,(l=>{i.id=l})).optional("fixed_height_relative",(l=>{i.constantHeight=l}),yr.decodeRelativeHeight).geometry((l=>{i.bounds=l}),Rh).success()),((o,e,i)=>o.reset(e).require(dr,(l=>{i.id=l})).require("elevation_idx",(l=>{i.idx=l})).require("extent",(l=>{i.extent=l})).require("height_relative",(l=>{i.height=l}),yr.decodeRelativeHeight).geometry((l=>{i.position=l}),yr.getPoint).success())),Mi=new ri(((o,e,i)=>o.reset(e).require(dr,(l=>{i.id=l})).optional("fixed_height",(l=>{i.constantHeight=l}),yr.decodeMetricHeight).geometry((l=>{i.bounds=l}),Rh).success()),((o,e,i)=>o.reset(e).require(dr,(l=>{i.id=l})).require("elevation_idx",(l=>{i.idx=l})).require("extent",(l=>{i.extent=l})).require("height",(l=>{i.height=l}),yr.decodeMetricHeight).geometry((l=>{i.position=l}),yr.getPoint).success()));class yr{static getPoint(e){return Pr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Mi:void 0:si}static parse(e){const i=[],l=[],u=e.length,f=new hr;for(let m=0;m<u;m++){const w=e.feature(m),C=w.properties.version,M=yr.getVersionSchema(C);if(M===void 0){Vr(`Unknown elevation feature version number ${C||"(unknown)"}`);continue}const B=w.properties.type;if(!B)continue;const U=en.types[w.type];if(U==="Point"&&B==="curve_point"){const $={};M.parseVertex(f,w,$)&&i.push($)}else if(U==="Polygon"&&B==="curve_meta"){const $={};M.parseFeature(f,w,$)&&l.push($)}}return{vertices:i,features:l}}}class Qr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=di(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,!0}}class Xr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=$e(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,l){if((function(Q,ee){var he=Q[0],_e=Q[1],ve=Q[2],De=ee[0],ke=ee[1],ze=ee[2];return Math.abs(he-De)<=E*Math.max(1,Math.abs(he),Math.abs(De))&&Math.abs(_e-ke)<=E*Math.max(1,Math.abs(_e),Math.abs(ke))&&Math.abs(ve-ze)<=E*Math.max(1,Math.abs(ve),Math.abs(ze))})(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[u,f,m]=this.dir,w=this.pos[0]-e[0],C=this.pos[1]-e[1],M=this.pos[2]-e[2],B=u*u+f*f+m*m,U=2*(w*u+C*f+M*m),$=U*U-4*B*(w*w+C*C+M*M-i*i);if($<0){const Q=Math.max(-U/2,0),ee=w+u*Q,he=C+f*Q,_e=M+m*Q,ve=Math.hypot(ee,he,_e);return l[0]=ee*i/ve,l[1]=he*i/ve,l[2]=_e*i/ve,!1}{const Q=(-U-Math.sqrt($))/(2*B);if(Q<0){const ee=Math.hypot(w,C,M);return l[0]=w*i/ee,l[1]=C*i/ee,l[2]=M*i/ee,!1}return l[0]=w+u*Q,l[1]=C+f*Q,l[2]=M+m*Q,!0}}}class ei{constructor(e,i,l,u,f){this.TL=e,this.TR=i,this.BR=l,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,l){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],w=[-1,-1,1],C=xt(u,u,e),M=xt(f,f,e),B=xt(m,m,e),U=xt(w,w,e);return new ei(C,M,B,U,i/l)}}function $i(o,e,i){let l=1/0,u=-1/0;const f=[];for(const m of o){mt(f,m,e);const w=$e(f,i);l=Math.min(l,w),u=Math.max(u,w)}return[l,u]}function Dr(o,e){let i=!0;for(let l=0;l<o.planes.length;l++){const u=o.planes[l];let f=0;for(let m=0;m<e.length;m++)f+=+($e(u,e[m])+u[3]>=0);if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function hi(o,e){for(const i of o.projections){const l=$i(e,o.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function wr(o,e){let i=0;const l=[0,0,0,0];for(let m=0;m<o.length;m++)l[0]=o[m][0],l[1]=o[m][1],l[2]=o[m][2],l[3]=1,(u=l)[0]*(f=e)[0]+u[1]*f[1]+u[2]*f[2]+u[3]*f[3]>=0&&i++;var u,f;return i}class Zn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Fn.fromPoints(this.points),this.projections=[],this.frustumEdges=[mt([],this.points[2],this.points[3]),mt([],this.points[0],this.points[3]),mt([],this.points[4],this.points[0]),mt([],this.points[5],this.points[1]),mt([],this.points[6],this.points[2]),mt([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:u,projection:$i(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:$i(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,l,u){const f=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((M=>{const B=Ft([],M,e),U=1/B[3]/i*f;return($=B)[0]=(Q=B)[0]*(ee=[U,U,u?1/B[3]:U,U])[0],$[1]=Q[1]*ee[1],$[2]=Q[2]*ee[2],$[3]=Q[3]*ee[3],$;var $,Q,ee})),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((M=>{const B=nt([],ct([],mt([],m[M[0]],m[M[1]]),mt([],m[M[2]],m[M[1]]))),U=-$e(B,m[M[1]]);return B.concat(U)})),C=[];for(let M=0;M<m.length;M++)C.push([m[M][0],m[M][1],m[M][2]]);return new Zn(C,w)}intersectsPrecise(e,i,l){for(let u=0;u<i.length;u++)if(!wr(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!wr(e,this.planes[u]))return 0;for(const u of l)for(const f of this.frustumEdges){const m=ct([],u,f),w=ye(m);if(w===0)continue;Ee(m,m,1/w);const C=$i(this.points,this.points[0],m),M=$i(e,this.points[0],m);if(C[0]>M[1]||M[0]>C[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const l=i[3];if($e([i[0],i[1],i[2]],e)+l<0)return!1}return!0}}class Fn{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)Ce(i,i,u),Re(l,l,u);return new Fn(i,l)}static fromTileIdAndHeight(e,i,l){const u=1<<e.canonical.z,f=e.canonical.x,m=e.canonical.y;return new Fn([f/u,m/u,i],[(f+1)/u,(m+1)/u,l])}static applyTransform(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)xt(l[u],l[u],i);return Fn.fromPoints(l)}static applyTransformFast(e,i){const l=[i[12],i[13],i[14]],u=[...l];for(let f=0;f<3;f++)for(let m=0;m<3;m++){const w=i[4*m+f],C=w*e.min[m],M=w*e.max[m];l[f]+=Math.min(C,M),u[f]+=Math.max(C,M)}return new Fn(l,u)}static projectAabbCorners(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)xt(l[u],l[u],i);return l}constructor(e,i){this.min=e,this.max=i,this.center=Ee([],Ae([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=K(this.min),u=K(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Fn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Dr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Dr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?hi(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?hi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}In(Fn,"Aabb");class Gr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,l=i[1],u=-i[0],f=(e.extent+1)*this.metersToTile;return[new Kt(Math.trunc(e.position[0]+l*f),Math.trunc(e.position[1]+u*f)),new Kt(Math.trunc(e.position[0]-l*f),Math.trunc(e.position[1]-u*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Oi{constructor(e,i,l,u,f,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[kn(),kn(),kn(),kn(),kn(),kn(),kn()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=i,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=f,this.edges=this.edges.filter((w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((C=this.vertices[w.a].position)[0]===(M=this.vertices[w.b].position)[0]&&C[1]===M[1]);var C,M})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:Pr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const C=this.vertices[w.a].position,M=this.vertices[w.b].position,B=tr(kn(),M,C),U=Tr(B),$=Br(kn(),B,1/U);this.edgeProps.push({vec:B,dir:$,len:U});const Q=this.vertexProps[w.a].dir,ee=this.vertexProps[w.b].dir;ni(Q,Q,$),ni(ee,ee,$)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||Fr(w.dir,w.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[l,u]=i;return Qn(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,i){const l=this.getClosestEdge(e);if(!l)return J(0,0,1);const u=l[0],f=this.edges[u],m=this.edgeProps[u].vec,w=J(m[0],m[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),C=J(w[1],-w[0],0);ct(C,C,w);const M=ye(C);return M>0?Ee(C,C,1/M):de(C,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,l=Number.POSITIVE_INFINITY,u=0;const[f,m,w,C,M,B,U]=this._tmpVec2;mr(U,e.x,e.y);const $=new Qr(U,null);for(let Q=0;Q<this.edges.length;Q++){const ee=this.edges[Q],he=this.edgeProps[Q].dir;$.dir=he;const _e=this.vertices[ee.a].position,ve=this.vertices[ee.b].position,De=$.intersectsPlane(_e,this.vertexProps[ee.a].dir,f),ke=$.intersectsPlane(ve,this.vertexProps[ee.b].dir,m);if(!De||!ke)continue;tr(w,m,f),tr(C,U,f);const ze=di(w,w),Je=ze>0?di(C,w)/ze:0,Qe=et(Je,0,1),st=Math.abs((Je-Qe)*this.edgeProps[Q].len);tr(M,U,_e),mr(B,he[1],-he[0]);const lt=st+Math.abs(di(M,B));lt<l&&(i=Q,l=lt,u=Qe)}return[i,u]}tessellate(e){const i=pe(),l=pe(),u=pe(),f=pe();for(let m=this.edges.length-1;m>=0;--m){const w=this.edges[m].a,C=this.edges[m].b,{position:M,height:B,extent:U}=this.vertices[w],{position:$,height:Q,extent:ee}=this.vertices[C],he=this.vertexProps[w].dir,_e=this.vertexProps[C].dir;if(de(i,M[0]/e,M[1]/e,B),de(l,$[0]/e,$[1]/e,Q),de(u,he[1],-he[0],0),Ee(u,u,U),de(f,_e[1],-_e[0],0),Ee(f,f,ee),this.distSqLines(J(i[0]+.5*u[0],i[1]+.5*u[1],i[2]+.5*u[2]),J(l[0]-.5*f[0],l[1]-.5*f[1],l[2]-.5*f[2]),J(i[0]-.5*u[0],i[1]-.5*u[1],i[2]-.5*u[2]),J(l[0]+.5*f[0],l[1]+.5*f[1],l[2]+.5*f[2]))<=.0025000000000000005)continue;const ve=this.vertices.length,De=ni(kn(),M,$);this.vertices.push({position:Br(De,De,.5),height:.5*(B+Q),extent:.5*(U+ee)});const ke=ni(kn(),he,_e);this.vertexProps.push({dir:Fr(ke,ke)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:w,b:ve}),this.edges.push({a:ve,b:C});const ze=tr(kn(),this.vertices[ve].position,M),Je=Tr(ze),Qe={vec:ze,dir:Br(kn(),ze,1/Je),len:Je};this.edgeProps.push(Qe),this.edgeProps.push(Qe)}}distSqLines(e,i,l,u){const f=ne(pe(),i,e),m=ne(pe(),u,l),w=ne(pe(),e,l),C=$e(f,f),M=$e(f,m),B=$e(f,w),U=$e(m,m),$=$e(m,w),Q=C*U-M*M;if(Q===0)return Be(At(f,l,u,$e(w,m)/$e(m,m)),e);const ee=(C*$-M*B)/Q;return Be(At(f,e,i,(M*$-B*U)/Q),At(m,l,u,ee))}}class Ii{static parseFrom(e,i){const l=yr.parse(e);if(!l)return[];let{vertices:u,features:f}=l;const m=1/bt(i);f.sort(((B,U)=>B.id-U.id)),u.sort(((B,U)=>B.id-U.id||B.idx-U.idx)),u=u.filter(((B,U,$)=>U===$.findIndex((Q=>Q.id===B.id&&Q.idx===B.idx))));const w=new Array;let C=0;const M=u.length;for(const B of f){if(B.constantHeight){w.push(new Oi(B.id,B.bounds,B.constantHeight));continue}for(;C!==M&&u[C].id<B.id;)C++;if(C===M||u[C].id!==B.id)continue;const U=new Array,$=new Array,Q=C;for(;C!==M&&u[C].id===B.id;){const ee=u[C];if(U.push({position:ee.position,height:ee.height,extent:ee.extent}),C!==Q&&u[C-1].idx===ee.idx-1){const he=C-Q;$.push({a:he-1,b:he})}C++}w.push(new Oi(B.id,B.bounds,void 0,U,$,m))}return w}static getElevationFeature(e,i){if(!i)return;const l=+e.properties[dr];return Number.isNaN(l)?void 0:i.find((u=>u.id===l))}}class xo{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*hn,this.yOffset=(e.y*this.zScale-i.y)*hn)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,l){const u=this.constantElevation(i,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),l))}computeBiasedHeight(e,i){return i<=0?e:e+i*Ct(0,i,e>=0?e:Math.abs(.5*e))}}In(Oi,"ElevationFeature");class bo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new iu,this.indexArray=new Fo,this.segments=new Pi,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Kl),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){const f=this.layers[0],m=[];let w=null;f.type==="circle"&&(w=f.layout.get("circle-sort-key"));for(const{feature:M,id:B,index:U,sourceLayerIndex:$}of e){const Q=this.layers[0]._featureFilter.needGeometry,ee=Ht(M,Q);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),ee,l))continue;const he=w?w.evaluate(ee,{},l):void 0,_e={id:B,properties:M.properties,type:M.type,sourceLayerIndex:$,index:U,geometry:Q?ee.geometry:Sn(M,l,u),patterns:{},sortKey:he};m.push(_e)}w&&m.sort(((M,B)=>M.sortKey-B.sortKey));let C=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new fp,C=u.projection);for(const M of m){const{geometry:B,index:U,sourceLayerIndex:$}=M,Q=e[U].feature;this.addFeature(M,B,U,i.availableImages,l,C,i.brightness,i.elevationFeatures),i.featureIndex.insert(Q,B,U,$,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,l,u,f,m,w){this.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ya.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Za.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,l,u,f,m,w,C){let M;this.elevationMode!=="none"&&(M=Ii.getElevationFeature(e,C));for(const B of i)for(const U of B){const $=U.x,Q=U.y;if($<0||$>=hn||Q<0||Q>=hn)continue;if(m){const _e=m.projectTilePoint($,Q,f),ve=m.upVector(f,$,Q);this.addGlobeExtVertex(_e,ve),this.addGlobeExtVertex(_e,ve),this.addGlobeExtVertex(_e,ve),this.addGlobeExtVertex(_e,ve)}const ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),he=ee.vertexLength;if(this.addCircleVertex($,Q,-1,-1),this.addCircleVertex($,Q,1,-1),this.addCircleVertex($,Q,1,1),this.addCircleVertex($,Q,-1,1),this.elevationMode!=="none"){const _e=M?M.pointElevation(new Kt($,Q)):0;this.hasElevation=this.hasElevation||_e!==0;for(let ve=0;ve<4;ve++)this.elevatedLayoutVertexArray.emplaceBack(_e)}this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+2,he+3),ee.vertexLength+=4,ee.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,f,w,void 0,this.worldview)}addCircleVertex(e,i,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Xi(o,e){for(let i=0;i<o.length;i++)if(No(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(No(o,e[i]))return!0;return!!Co(o,e)}function ss(o,e,i){return!!No(o,e)||!!uo(e,o,i)}function as(o,e){if(o.length===1)return wo(e,o[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let u=0;u<l.length;u++)if(No(o,l[u]))return!0}for(let i=0;i<o.length;i++)if(wo(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(Co(o,e[i]))return!0;return!1}function na(o,e,i){if(o.length>1){if(Co(o,e))return!0;for(let l=0;l<e.length;l++)if(uo(e[l],o,i))return!0}for(let l=0;l<o.length;l++)if(uo(o[l],e,i))return!0;return!1}function Co(o,e){if(o.length===0||e.length===0)return!1;for(let i=0;i<o.length-1;i++){const l=o[i],u=o[i+1];for(let f=0;f<e.length-1;f++)if(Bs(l,u,e[f],e[f+1]))return!0}return!1}function Bs(o,e,i,l){return fo(o,i,l)!==fo(e,i,l)&&fo(o,e,i)!==fo(o,e,l)}function ga(o,e,i){return(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x)}function vi(o,e,i,l){const u=ga(o,e,l),f=ga(o,e,i);if(Math.sign(u)===Math.sign(f))return;const m=ga(i,l,o),w=m+f-u;return Math.sign(m)!==Math.sign(w)?[m/(m-w),f/(f-u)]:void 0}function uo(o,e,i){const l=i*i;if(e.length===1)return o.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Ni(o,e[u-1],e[u])<l)return!0;return!1}function Ni(o,e,i){const l=e.distSqr(i);if(l===0)return o.distSqr(e);const u=((o.x-e.x)*(i.x-e.x)+(o.y-e.y)*(i.y-e.y))/l;return o.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function wo(o,e){let i,l,u,f=!1;for(let m=0;m<o.length;m++){i=o[m];for(let w=0,C=i.length-1;w<i.length;C=w++)l=i[w],u=i[C],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(f=!f)}return f}function No(o,e){let i=!1;for(let l=0,u=o.length-1;l<o.length;u=l++){const f=o[l],m=o[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function Ki(o,e,i,l,u){for(const m of o)if(e<=m.x&&i<=m.y&&l>=m.x&&u>=m.y)return!0;const f=[new Kt(e,i),new Kt(e,u),new Kt(l,u),new Kt(l,i)];if(o.length>2){for(const m of f)if(No(o,m))return!0}for(let m=0;m<o.length-1;m++)if(Ji(o[m],o[m+1],f))return!0;return!1}function Ji(o,e,i){const l=i[0],u=i[2];if(o.x<l.x&&e.x<l.x||o.x>u.x&&e.x>u.x||o.y<l.y&&e.y<l.y||o.y>u.y&&e.y>u.y)return!1;const f=fo(o,e,i[0]);return f!==fo(o,e,i[1])||f!==fo(o,e,i[2])||f!==fo(o,e,i[3])}function Ns(o,e,i,l,u,f){let m=e.y-o.y,w=o.x-e.x;if(f=f||0){const C=m*m+w*w;if(C===0)return!0;const M=Math.sqrt(C);m/=M,w/=M}return!((i.x-o.x)*m+(i.y-o.y)*w-f<0||(l.x-o.x)*m+(l.y-o.y)*w-f<0||(u.x-o.x)*m+(u.y-o.y)*w-f<0)}function Ta(o,e,i,l,u,f,m){return!(Ns(o,e,l,u,f,m)||Ns(e,i,l,u,f,m)||Ns(i,o,l,u,f,m)||Ns(l,u,o,e,i,m)||Ns(u,f,o,e,i,m)||Ns(f,l,o,e,i,m))}function ra(o,e,i){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(o)}function Ql(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function ec(o,e,i,l,u){if(!e[0]&&!e[1])return o;const f=Kt.convert(e)._mult(u);i==="viewport"&&f._rotate(-l);const m=[];for(let w=0;w<o.length;w++)m.push(o[w].sub(f));return m}function Pl(o,e,i,l){const u=Kt.convert(o)._mult(l);return e==="viewport"&&u._rotate(-i),u}let tc,Ml;function y(o,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[o*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}In(bo,"CircleBucket",{omit:["layers"]});class x{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=ie(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const l=(function(f,m,w){var C=y(256*f,256*(m=Math.pow(2,w)-m-1),w),M=y(256*(f+1),256*(m+1),w);return C[0]+","+C[1]+","+M[0]+","+M[1]})(this.x,this.y,this.z),u=(function(f,m,w){let C,M="";for(let B=f;B>0;B--)C=1<<B-1,M+=(m&C?1:0)+(w&C?2:0);return M})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class L{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ie(e,i.z,i.z,i.x,i.y)}}class W{constructor(e,i,l,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new x(l,+u,+f),this.key=i===0&&e===l?this.canonical.key:ie(i,e,l,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new W(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new W(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return ie(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return ie(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new W(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new W(i,this.wrap,i,l,u),new W(i,this.wrap,i,l+1,u),new W(i,this.wrap,i,l,u+1),new W(i,this.wrap,i,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new W(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new W(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new L(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ie(o,e,i,l,u){const f=1<<Math.min(i,22);let m=f*(u%f)+l%f;return o&&i<22&&(m+=f*f*((o<0?-2*o-1:2*o)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const be=[o=>{let e=o.canonical.x-1,i=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,i--),new W(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,i=o.wrap;return e===1<<o.canonical.z&&(e=0,i++),new W(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>new W(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new W(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];In(x,"CanonicalTileID"),In(W,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ot=jr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kt}=ot,gn=jr([{name:"a_pos_3",components:3,type:"Int16"}]);var Yn=jr([{name:"a_pos",type:"Int16",components:2}]);function or(o){return o*d/re}const vr=[new Fn([G,G,G],[q,q,q]),new Fn([G,G,G],[0,0,q]),new Fn([0,G,G],[q,0,q]),new Fn([G,0,G],[0,q,q]),new Fn([0,0,G],[q,q,q])];function Er(o,e,i,l=!0){const u=Ee([],o._camera.position,o.worldSize),f=[e,i,1,1];Ft(f,f,o.pixelMatrixInverse),gt(f,f,1/f[3]);const m=nt([],mt([],f,u)),w=o.globeMatrix,C=[w[12],w[13],w[14]],M=mt([],C,u),B=ye(M),U=nt([],M),$=o.worldSize/(2*Math.PI),Q=$e(U,m),ee=Math.asin($/B);if(ee<Math.acos(Q)){if(!l)return null;const Ut=[],vt=[];Ee(Ut,m,B/Q),nt(vt,mt(vt,Ut,M)),nt(m,Ae(m,M,Ee(m,vt,Math.tan(ee)*B)))}const he=[];new Xr(u,m).closestPointOnSphere(C,$,he);const _e=nt([],yi(w,0)),ve=nt([],yi(w,1)),De=nt([],yi(w,2)),ke=$e(_e,he),ze=$e(ve,he),Je=$e(De,he),Qe=we(Math.asin(-ze/$));let st=we(Math.atan2(ke,Je));st=o.center.lng+(function(Ut,vt){const $t=(vt-Ut+180)%360-180;return $t<-180?$t+360:$t})(o.center.lng,st);const lt=Fe(st),ft=et(Ze(Qe),0,1);return new Pt(lt,ft)}class Ri{constructor(e,i,l){this.a=mt([],e,l),this.b=mt([],i,l),this.center=l;const u=nt([],this.a),f=nt([],this.b);this.angle=Math.acos($e(u,f))}}function Ja(o,e){if(o.angle===0)return null;let i;return i=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),i<0||i>1?null:(function(l,u,f,m){const w=Math.sin(f);return l*(Math.sin((1-m)*f)/w)+u*(Math.sin(m*f)/w)})(o.a[e],o.b[e],o.angle,et(i,0,1))+o.center[e]}function Qa(o){if(o.z<=1)return vr[o.z+2*o.y+o.x];const e=nr(_n(o));return Fn.fromPoints(e)}function za(o,e,i){return Ee(o,o,1-i),Oe(o,o,e,i)}function fn(o,e,i){for(const l of o)xt(l,l,e),Ee(l,l,i)}function Xt(o,e,i,l){const u=e/o.worldSize,f=o.globeMatrix;if(i.z<=1){const ft=Qa(i).getCorners();return fn(ft,f,u),Fn.fromPoints(ft)}const m=_n(i,l),w=nr(m,d+or(o._tileCoverLift));fn(w,f,u);const C=Number.MAX_VALUE,M=[-C,-C,-C],B=[C,C,C];if(m.contains(o.center)){for(const vt of w)Ce(B,B,vt),Re(M,M,vt);M[2]=0;const ft=o.point,Ut=[ft.x*u,ft.y*u,0];return Ce(B,B,Ut),Re(M,M,Ut),new Fn(B,M)}if(o._tileCoverLift>0){for(const ft of w)Ce(B,B,ft),Re(M,M,ft);return new Fn(B,M)}const U=[f[12]*u,f[13]*u,f[14]*u],$=m.getCenter(),Q=et(o.center.lat,-Xe,Xe),ee=et($.lat,-Xe,Xe),he=Fe(o.center.lng),_e=Ze(Q);let ve=he-Fe($.lng);const De=_e-Ze(ee);ve>.5?ve-=1:ve<-.5&&(ve+=1);let ke=0;Math.abs(ve)>Math.abs(De)?ke=ve>=0?1:3:(ke=De>=0?0:2,Oe(U,U,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(_t(De>=0?m.getSouth():m.getNorth()))*d));const ze=w[ke],Je=w[(ke+1)%4],Qe=new Ri(ze,Je,U),st=[Ja(Qe,0)||ze[0],Ja(Qe,1)||ze[1],Ja(Qe,2)||ze[2]],lt=wp(o.zoom);if(lt>0){const ft=(function({x:vt,y:$t,z:tn},qt,Jt,on,Bt){const Qt=1/(1<<tn);let Dt=vt*Qt,Et=Dt+Qt,an=$t*Qt,rn=an+Qt,Xn=0;const Rn=(Dt+Et)/2-on;return Rn>.5?Xn=-1:Rn<-.5&&(Xn=1),Dt=((Dt+Xn)*qt-(on*=qt))*Jt+on,Et=((Et+Xn)*qt-on)*Jt+on,an=(an*qt-(Bt*=qt))*Jt+Bt,rn=(rn*qt-Bt)*Jt+Bt,[[Dt,rn,0],[Et,rn,0],[Et,an,0],[Dt,an,0]]})(i,e,o._pixelsPerMercatorPixel,he,_e);for(let vt=0;vt<w.length;vt++)za(w[vt],ft[vt],lt);const Ut=Ae([],ft[ke],ft[(ke+1)%4]);Ee(Ut,Ut,.5),za(st,Ut,lt)}for(const ft of w)Ce(B,B,ft),Re(M,M,ft);return B[2]=Math.min(ze[2],Je[2]),Ce(B,B,st),Re(M,M,st),new Fn(B,M)}function _n({x:o,y:e,z:i},l=!1){const u=1/(1<<i),f=new ce(Ye(o*u),e===(1<<i)-1&&l?-90:qe((e+1)*u)),m=new ce(Ye((o+1)*u),e===0&&l?90:qe(e*u));return new Pe(f,m)}function nr(o,e=d){const i=_t(o.getNorth()),l=_t(o.getSouth()),u=Math.cos(i),f=Math.cos(l),m=Math.sin(i),w=Math.sin(l),C=o.getWest(),M=o.getEast();return[te(f,w,C,e),te(f,w,M,e),te(u,m,M,e),te(u,m,C,e)]}function $r(o,e,i,l){const u=1<<i.z,f=(o/hn+i.x)/u;return Y(qe((e/hn+i.y)/u),Ye(f),l)}function Io({min:o,max:e}){return T/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const fi=new Float64Array(16);function eo(o){const e=Io(o),i=ge(fi,[e,e,e]);return j(i,i,ut([],o.min))}function ws(o){const e=(l=o.min,(i=fi)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const u=1/Io(o);return V(e,e,[u,u,u])}function so(o){const e=hn/(2*Math.PI);return o/(2*Math.PI)/e}function td(o,e){return hn/(512*Math.pow(2,o))*Io(Qa(e))}function pv(o,e,i,l,u){const f=so(i),m=[o,e,-i/(2*Math.PI)],w=O(new Float64Array(16));return j(w,w,m),V(w,w,[f,f,f]),Z(w,w,_t(-u)),X(w,w,_t(-l)),w}function wp(o){return Ct(_,b,o)}function ST(o,e){const i=Y(e.lat,e.lng),l=(function(ee){const he=Y(ee._center.lat,ee._center.lng);let _e=ct([],J(0,1,0),he);const ve=ae([],-ee.angle,he);_e=xt(_e,_e,ve),ae(ve,-ee._pitch,_e);const De=nt([],he);return Ee(De,De,or(ee.cameraToCenterDistance/ee.pixelsPerMeter)),xt(De,De,ve),Ae([],he,De)})(o);return m=(u=ne([],l,i))[0],w=u[1],C=u[2],M=(f=i)[0],B=f[1],U=f[2],Q=($=Math.sqrt((m*m+w*w+C*C)*(M*M+B*B+U*U)))&&$e(u,f)/$,Math.acos(Math.min(Math.max(Q,-1),1));var u,f,m,w,C,M,B,U,$,Q}function gb(o,e){return ST(o,e)>Math.PI/2*1.01}const TT=_t(85),o6=Math.cos(TT),s6=Math.sin(TT),a6=D(),CT=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function ET(o,e,i,l,u,f,m,w,C){if(f&&o.queryGeometry.isAboveHorizon)return!1;f&&(C*=o.pixelToTileUnitsFactor);const M=o.tileID.canonical,B=i.projection.upVectorScale(M,i.center.lat,i.worldSize).metersToTile;for(const U of e)for(const $ of U){const Q=$.add(w),ee=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(Q.x,Q.y,!0):0,he=i.projection.projectTilePoint(Q.x,Q.y,M);if(ee>0){const ke=i.projection.upVector(M,Q.x,Q.y);he.x+=ke[0]*B*ee,he.y+=ke[1]*B*ee,he.z+=ke[2]*B*ee}const _e=f?Q:l6(he.x,he.y,he.z,l),ve=f?o.tilespaceRays.map((ke=>u6(ke,ee))):o.queryGeometry.screenGeometry,De=Ft([],[he.x,he.y,he.z,1],l);if(!m&&f?C*=De[3]/i.cameraToCenterDistance:m&&!f&&(C*=i.cameraToCenterDistance/De[3]),f){const ke=qe(($.y/hn+M.y)/(1<<M.z));C/=i.projection.pixelsPerMeter(ke,1)/He(1,ke)}if(ss(ve,_e,C))return!0}return!1}function l6(o,e,i,l){const u=Ft([],[o,e,i,1],l);return new Kt(u[0]/u[3],u[1]/u[3])}const AT=J(0,0,0),c6=J(0,0,1);function u6(o,e){const i=pe();return AT[2]=e,o.intersectsPlane(AT,c6,i),new Kt(i[0],i[1])}class PT extends bo{}let MT,IT,RT,DT;function kT(o,{width:e,height:i},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*l);return o.width=e,o.height=i,o.data=u,o}function OT(o,e,i){const{width:l,height:u}=e;l===o.width&&u===o.height||(_b(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,u)},i,null),o.width=l,o.height=u,o.data=e.data)}function _b(o,e,i,l,u,f,m,w){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||i.x>o.width-u.width||i.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const C=o.data,M=e.data,B=f===4&&w;for(let U=0;U<u.height;U++){const $=((i.y+U)*o.width+i.x)*f,Q=((l.y+U)*e.width+l.x)*f;if(B)for(let ee=0;ee<u.width;ee++){const he=$+ee*f+3,_e=Q+ee*f;M[_e+0]=255,M[_e+1]=255,M[_e+2]=255,M[_e+3]=C[he]}else if(m)for(let ee=0;ee<u.width;ee++){const he=$+ee*f,_e=Q+ee*f,ve=new mi(C[he+0]/255,C[he+1]/255,C[he+2]/255,C[he+3]).toNonPremultipliedRenderColor(m).toArray();M[_e+0]=ve[0],M[_e+1]=ve[1],M[_e+2]=ve[2],M[_e+3]=ve[3]}else for(let ee=0;ee<u.width*f;ee++)M[Q+ee]=C[$+ee]}return e}In(PT,"HeatmapBucket",{omit:["layers"]});class Sp{constructor(e,i){kT(this,e,1,i)}resize(e){OT(this,new Sp(e),1)}clone(){return new Sp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f){_b(e,i,l,u,f,1,null)}}class ia{constructor(e,i){kT(this,e,4,i)}resize(e){OT(this,new ia(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f,m,w){_b(e,i,l,u,f,4,m,w)}}class LT{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function D_(o){const e={},i=o.resolution||256,l=o.clips?o.clips.length:1,u=o.image||new ia({width:i,height:l}),f=(m,w,C)=>{e[o.evaluationKey]=C;const M=o.expression.evaluate(e),B=M?M.toNonPremultipliedRenderColor(null):null;B&&(u.data[m+w+0]=Math.floor(255*B.r),u.data[m+w+1]=Math.floor(255*B.g),u.data[m+w+2]=Math.floor(255*B.b),u.data[m+w+3]=Math.floor(255*B.a))};if(o.clips)for(let m=0,w=0;m<l;++m,w+=4*i)for(let C=0,M=0;C<i;C++,M+=4){const B=C/(i-1),{start:U,end:$}=o.clips[m];f(w,M,U*(1-B)+$*B)}else for(let m=0,w=0;m<i;m++,w+=4)f(0,w,m/(i-1));return u}In(Sp,"AlphaImage"),In(ia,"RGBAImage");const d6=jr([{name:"a_pos",components:2,type:"Int16"}],4),h6=jr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),f6=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),p6=jr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function bg(o,e,i=2){const l=e&&e.length,u=l?e[0]*i:o.length;let f=zT(o,0,u,i,!0);const m=[];if(!f||f.next===f.prev)return m;let w,C,M;if(l&&(f=(function(B,U,$,Q){const ee=[];for(let he=0,_e=U.length;he<_e;he++){const ve=zT(B,U[he]*Q,he<_e-1?U[he+1]*Q:B.length,Q,!1);ve===ve.next&&(ve.steiner=!0),ee.push(w6(ve))}ee.sort(v6);for(let he=0;he<ee.length;he++)$=x6(ee[he],$);return $})(o,e,f,i)),o.length>80*i){w=o[0],C=o[1];let B=w,U=C;for(let $=i;$<u;$+=i){const Q=o[$],ee=o[$+1];Q<w&&(w=Q),ee<C&&(C=ee),Q>B&&(B=Q),ee>U&&(U=ee)}M=Math.max(B-w,U-C),M=M!==0?32767/M:0}return k_(f,m,i,w,C,M,0),m}function zT(o,e,i,l,u){let f;if(u===(function(m,w,C,M){let B=0;for(let U=w,$=C-M;U<C;U+=M)B+=(m[$]-m[U])*(m[U+1]+m[$+1]),$=U;return B})(o,e,i,l)>0)for(let m=e;m<i;m+=l)f=VT(m/l|0,o[m],o[m+1],f);else for(let m=i-l;m>=e;m-=l)f=VT(m/l|0,o[m],o[m+1],f);return f&&wg(f,f.next)&&(z_(f),f=f.next),f}function Sm(o,e){if(!o)return o;e||(e=o);let i,l=o;do if(i=!1,l.steiner||!wg(l,l.next)&&ms(l.prev,l,l.next)!==0)l=l.next;else{if(z_(l),l=e=l.prev,l===l.next)break;i=!0}while(i||l!==e);return e}function k_(o,e,i,l,u,f,m){if(!o)return;!m&&f&&(function(C,M,B,U){let $=C;do $.z===0&&($.z=yb($.x,$.y,M,B,U)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==C);$.prevZ.nextZ=null,$.prevZ=null,(function(Q){let ee,he=1;do{let _e,ve=Q;Q=null;let De=null;for(ee=0;ve;){ee++;let ke=ve,ze=0;for(let Qe=0;Qe<he&&(ze++,ke=ke.nextZ,ke);Qe++);let Je=he;for(;ze>0||Je>0&&ke;)ze!==0&&(Je===0||!ke||ve.z<=ke.z)?(_e=ve,ve=ve.nextZ,ze--):(_e=ke,ke=ke.nextZ,Je--),De?De.nextZ=_e:Q=_e,_e.prevZ=De,De=_e;ve=ke}De.nextZ=null,he*=2}while(ee>1)})($)})(o,l,u,f);let w=o;for(;o.prev!==o.next;){const C=o.prev,M=o.next;if(f?g6(o,l,u,f):m6(o))e.push(C.i,o.i,M.i),z_(o),o=M.next,w=M.next;else if((o=M)===w){m?m===1?k_(o=_6(Sm(o),e),e,i,l,u,f,2):m===2&&y6(o,e,i,l,u,f):k_(Sm(o),e,i,l,u,f,1);break}}}function m6(o){const e=o.prev,i=o,l=o.next;if(ms(e,i,l)>=0)return!1;const u=e.x,f=i.x,m=l.x,w=e.y,C=i.y,M=l.y,B=Math.min(u,f,m),U=Math.min(w,C,M),$=Math.max(u,f,m),Q=Math.max(w,C,M);let ee=l.next;for(;ee!==e;){if(ee.x>=B&&ee.x<=$&&ee.y>=U&&ee.y<=Q&&O_(u,w,f,C,m,M,ee.x,ee.y)&&ms(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function g6(o,e,i,l){const u=o.prev,f=o,m=o.next;if(ms(u,f,m)>=0)return!1;const w=u.x,C=f.x,M=m.x,B=u.y,U=f.y,$=m.y,Q=Math.min(w,C,M),ee=Math.min(B,U,$),he=Math.max(w,C,M),_e=Math.max(B,U,$),ve=yb(Q,ee,e,i,l),De=yb(he,_e,e,i,l);let ke=o.prevZ,ze=o.nextZ;for(;ke&&ke.z>=ve&&ze&&ze.z<=De;){if(ke.x>=Q&&ke.x<=he&&ke.y>=ee&&ke.y<=_e&&ke!==u&&ke!==m&&O_(w,B,C,U,M,$,ke.x,ke.y)&&ms(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,ze.x>=Q&&ze.x<=he&&ze.y>=ee&&ze.y<=_e&&ze!==u&&ze!==m&&O_(w,B,C,U,M,$,ze.x,ze.y)&&ms(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;ke&&ke.z>=ve;){if(ke.x>=Q&&ke.x<=he&&ke.y>=ee&&ke.y<=_e&&ke!==u&&ke!==m&&O_(w,B,C,U,M,$,ke.x,ke.y)&&ms(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;ze&&ze.z<=De;){if(ze.x>=Q&&ze.x<=he&&ze.y>=ee&&ze.y<=_e&&ze!==u&&ze!==m&&O_(w,B,C,U,M,$,ze.x,ze.y)&&ms(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function _6(o,e){let i=o;do{const l=i.prev,u=i.next.next;!wg(l,u)&&BT(l,i,i.next,u)&&L_(l,u)&&L_(u,l)&&(e.push(l.i,i.i,u.i),z_(i),z_(i.next),i=o=u),i=i.next}while(i!==o);return Sm(i)}function y6(o,e,i,l,u,f){let m=o;do{let w=m.next.next;for(;w!==m.prev;){if(m.i!==w.i&&S6(m,w)){let C=NT(m,w);return m=Sm(m,m.next),C=Sm(C,C.next),k_(m,e,i,l,u,f,0),void k_(C,e,i,l,u,f,0)}w=w.next}m=m.next}while(m!==o)}function v6(o,e){let i=o.x-e.x;return i===0&&(i=o.y-e.y,i===0)&&(i=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function x6(o,e){const i=(function(u,f){let m=f;const w=u.x,C=u.y;let M,B=-1/0;if(wg(u,m))return m;do{if(wg(u,m.next))return m.next;if(C<=m.y&&C>=m.next.y&&m.next.y!==m.y){const he=m.x+(C-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(he<=w&&he>B&&(B=he,M=m.x<m.next.x?m:m.next,he===w))return M}m=m.next}while(m!==f);if(!M)return null;const U=M,$=M.x,Q=M.y;let ee=1/0;m=M;do{if(w>=m.x&&m.x>=$&&w!==m.x&&FT(C<Q?w:B,C,$,Q,C<Q?B:w,C,m.x,m.y)){const he=Math.abs(C-m.y)/(w-m.x);L_(m,u)&&(he<ee||he===ee&&(m.x>M.x||m.x===M.x&&b6(M,m)))&&(M=m,ee=he)}m=m.next}while(m!==U);return M})(o,e);if(!i)return e;const l=NT(i,o);return Sm(l,l.next),Sm(i,i.next)}function b6(o,e){return ms(o.prev,o,e.prev)<0&&ms(e.next,o,o.next)<0}function yb(o,e,i,l,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-i)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function w6(o){let e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function FT(o,e,i,l,u,f,m,w){return(u-m)*(e-w)>=(o-m)*(f-w)&&(o-m)*(l-w)>=(i-m)*(e-w)&&(i-m)*(f-w)>=(u-m)*(l-w)}function O_(o,e,i,l,u,f,m,w){return!(o===m&&e===w)&&FT(o,e,i,l,u,f,m,w)}function S6(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(i,l){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==l.i&&u.next.i!==l.i&&BT(u,u.next,i,l))return!0;u=u.next}while(u!==i);return!1})(o,e)&&(L_(o,e)&&L_(e,o)&&(function(i,l){let u=i,f=!1;const m=(i.x+l.x)/2,w=(i.y+l.y)/2;do u.y>w!=u.next.y>w&&u.next.y!==u.y&&m<(u.next.x-u.x)*(w-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(o,e)&&(ms(o.prev,o,e.prev)||ms(o,e.prev,e))||wg(o,e)&&ms(o.prev,o,o.next)>0&&ms(e.prev,e,e.next)>0)}function ms(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function wg(o,e){return o.x===e.x&&o.y===e.y}function BT(o,e,i,l){const u=gv(ms(o,e,i)),f=gv(ms(o,e,l)),m=gv(ms(i,l,o)),w=gv(ms(i,l,e));return u!==f&&m!==w||!(u!==0||!mv(o,i,e))||!(f!==0||!mv(o,l,e))||!(m!==0||!mv(i,o,l))||!(w!==0||!mv(i,e,l))}function mv(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function gv(o){return o>0?1:o<0?-1:0}function L_(o,e){return ms(o.prev,o,o.next)<0?ms(o,e,o.next)>=0&&ms(o,o.prev,e)>=0:ms(o,e,o.prev)<0||ms(o,o.next,e)<0}function NT(o,e){const i=vb(o.i,o.x,o.y),l=vb(e.i,e.x,e.y),u=o.next,f=e.prev;return o.next=e,e.prev=o,i.next=u,u.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function VT(o,e,i,l){const u=vb(o,e,i);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function z_(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function vb(o,e,i){return{i:o,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function F_(o,e){const i=o.length;if(i<=1)return[o];const l=[];let u,f;for(let m=0;m<i;m++){const w=ko(o[m]);w!==0&&(o[m].area=Math.abs(w),f===void 0&&(f=w<0),f===w<0?(u&&l.push(u),u=[o[m]]):u.push(o[m]))}if(u&&l.push(u),e>1)for(let m=0;m<l.length;m++)l[m].length<=e||(eg(l[m],e,1,l[m].length-1,T6),l[m]=l[m].slice(0,e));return l}function T6(o,e){return e.area-o.area}function UT(o,e,i=1){if(!o)return null;const l=typeof o=="string"?Ys.from(o).getPrimary():o.getPrimary(),u=typeof o=="string"?null:o.getSecondary();for(const f of[l,u]){if(!f)continue;const m=f.id.toString();e.has(m)||e.set(m,[]),f.scaleSelf(i),e.get(m).push(f)}return{primary:l.toString(),secondary:u?u.toString():null}}function xb(o,e,i,l){const u=l.patternDependencies;let f=!1;for(const m of e){const w=m.paint.get(`${o}-pattern`);w.isConstant()||(f=!0),UT(w.constantOr(null),u,i)&&(f=!0)}return f}function bb(o,e,i,l,u,f){const m=f.patternDependencies;for(const w of e){const C=w.paint.get(`${o}-pattern`).value;if(C.kind!=="constant"){let M=C.evaluate({zoom:l},i,{},f.availableImages);M=M&&M.name?M.name:M;const B=UT(M,m,u);if(!B)continue;const{primary:U,secondary:$}=B;U&&(i.patterns[w.id]=[U,$].filter(Boolean))}}return i}class jT{constructor(){this.polygons=new Map}add(e,...i){const l=this.polygons.get(e);l?l.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,l]of e.polygons)this.add(i,...l)}}class of{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=hn&&i>=hn}static evaluate(e){if(e.length===0)return new of;let i=[];for(const C of e)i.push(...C.portals);if(i.length===0)return new of;for(const C of i){const M=C.va,B=C.vb;(of.isOnBorder(M.x,B.x)||of.isOnBorder(M.y,B.y))&&(C.type="border")}const l=i.filter((C=>C.type!=="unevaluated")),u=i.filter((C=>C.type==="unevaluated"));if(u.length===0)return new of;u.sort(((C,M)=>C.hash===M.hash?C.isTunnel===M.isTunnel?0:C.isTunnel?-1:1:C.hash<M.hash?1:-1)),i=l.concat(u);let f=l.length,m=f,w=f;do if(m++,m===i.length||i[f].hash!==i[m].hash){if(m-f==2){w<f&&(i[w]=i[f],i[f]=null);const C=i[w],M=i[m-1];C.type=C.isTunnel!==M.isTunnel?"tunnel":"polygon",C.connection={a:C.connection.a,b:M.connection.a},w++}f=m}while(f!==i.length);return i.splice(w),i.sort(((C,M)=>C.hash<M.hash?1:-1)),{portals:i}}}In(of,"ElevationPortalGraph"),In(jT,"ElevationPolygons");class C6{constructor(e,i,l){this.outPositions=e,this.outNormals=i,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,i,l){let u=e[2];l!=null&&(u*=l);const f=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,m=this.vertexLookup.get(f);if(m!=null)return m;const w=this.outPositions.length;this.vertexLookup.set(f,w);const C=Math.trunc(16384*i[0]),M=Math.trunc(16384*i[1]),B=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(C,M,B),w}addTriangle(e,i,l){this.outIndices.emplaceBack(e,i,l)}addTriangles(e,i,l){if(e.length===0)return;const u=l.length===1,f=pe(),m=pe();for(let w=0;w<e.length;w+=3){const C=i[e[w+0]],M=i[e[w+1]],B=i[e[w+2]],U=u?l[0]:l[e[w+1]],$=u?l[0]:l[e[w+2]];de(f,C.x,C.y,u?l[0]:l[e[w+0]]);const Q=this.addVertex(f,m);de(f,M.x,M.y,U);const ee=this.addVertex(f,m);de(f,B.x,B.y,$);const he=this.addVertex(f,m);this.outIndices.emplaceBack(Q,ee,he)}}addQuad(e,i,l,u,f,m){const w=this.addVertex(e,f,m),C=this.addVertex(i,f,m),M=this.addVertex(l,f,m),B=this.addVertex(u,f,m);this.addTriangle(w,C,M),this.addTriangle(M,B,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Il{constructor(e,i,l,u){this.unevaluatedPortals=new of,this.portalPolygons=new jT,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new up,this.vertexNormals=new Jh,this.indexArray=new Fo,this.tileToMeters=bt(e),this.bridgeProgramConfigurations=new La(i,{zoom:l,lut:u},(f=>f!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new La(i,{zoom:l,lut:u},(f=>f!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return l}addTriangles(e,i,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)u.push(f+i)}addRenderableRing(e,i,l,u,f,m){const w=[new Kt(f.min.x,f.min.y),new Kt(f.max.x,f.min.y),new Kt(f.max.x,f.max.y),new Kt(f.min.x,f.max.y)];for(let C=0;C<l-1;C++){const M=i+C,B=M+1,U=this.unevalVertices[M],$=this.unevalVertices[B];if(!(U.x>=f.min.x&&U.x<=f.max.x&&U.y>=f.min.y&&U.y<=f.max.y||$.x>=f.min.x&&$.x<=f.max.x&&$.y>=f.min.y&&$.y<=f.max.y||Ji(U,$,w))||this.isOnBorder(U.x,$.x)||this.isOnBorder(U.y,$.y))continue;const Q=Il.computeEdgeHash(this.unevalVertices[M],this.unevalVertices[B]);let ee,he=this.vertexHashLookup.get(Il.computePosHash(U));he!=null?ee=he.next:(he=this.vertexHashLookup.get(Il.computePosHash($)),ee=he!=null?he.prev:Q),this.unevalEdges.push({polygonIdx:e,a:M,b:B,hash:Q,portalHash:ee,isTunnel:u,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,l,u,f){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:f});const m=i[0];this.vertexHashLookup.clear();let w=Il.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let C=0;C<m.length-1;C++){const M=m[C+0],B=m[C+1],U=Pr(B.x-M.x,B.y-M.y),$=Tr(U);if($===0)continue;let Q="unevaluated";const ee=u.pointElevation(M),he=u.pointElevation(B);Math.abs(ee)<.01&&Math.abs(he)<.01?Q="entrance":(this.isOnBorder(M.x,B.x)||this.isOnBorder(M.y,B.y))&&(Q="border");const _e=Il.computeEdgeHash(M,B);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:M,vb:B,vab:U,length:$,hash:_e,isTunnel:l,type:Q});const ve=Il.computePosHash(M);this.vertexHashLookup.set(ve,{prev:w,next:_e}),w=_e}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=$=>{$.primitiveLength=this.indexArray.length-$.primitiveOffset},u=new C6(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),m=i(),w=i(),C=($,Q)=>{$.sort(((he,_e)=>he.type===Q&&_e.type!==Q?-1:he.type!==Q&&_e.type===Q?1:0));const ee=$.findIndex((he=>he.type!==Q));return ee>=0?ee:$.length};let M=0;this.unevalEdges.length>0&&(M=C(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},this.tileToMeters)),l(w);const B=i(),U=i();if(this.unevalEdges.length>0){const $=this.unevalEdges.splice(M),Q=C($,"tunnel")+M;this.unevalEdges.push(...$),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},{min:M,max:Q})}l(B),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(U),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(m),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(f),this.maskSegments=Pi.simpleSegment(0,U.primitiveOffset,0,U.primitiveLength),this.depthSegments=Pi.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=Pi.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=Pi.simpleSegment(0,B.primitiveOffset,0,B.primitiveLength),this.shadowCasterSegments=Pi.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,l,u,f,m,w,C){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,l,u,m,w,C),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,l,u,m,w,C)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,f6.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,p6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,l,u,f){const m=(w,C)=>{for(let M=0;M<C.length-1;M++){const B=C[M].featureIndex,U=C[M+1].vertexStart,$=e.feature(B);w.populatePaintArrays(U,$,B,{},l,i,u,void 0,f)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,l,u,f){const m=new Map;for(let w=u;w<f;w++){const C=l[w],M=C.a,B=C.b,U=Il.computePosHash(e[M]),$=Il.computePosHash(e[B]);let Q=m.get(U);Q||(Q={},m.set(U,Q));let ee=m.get($);ee||(ee={},m.set($,ee)),i[M]<=0&&i[B]<=0||(Q.to=B,ee.from=M)}return m}isTerminalVertex(e,i){const l=Il.computePosHash(this.unevalVertices[e]),u=i.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,i,l,u,f,m){e.clearVertexLookup();const w=this.computeVertexConnections(i,l,u,f.min,f.max),C=1/m,M=.5*C,B=(Jt,on)=>de(Jt,i[on].x,i[on].y,l[on]*C),U=pe(),$=pe(),Q=pe(),ee=pe(),he=pe(),_e=(Jt,on)=>{const Bt=w.get(Il.computePosHash(i[on])),Qt=Bt.from,Dt=Bt.to;if(!Qt||!Dt)return;B(U,Qt),B($,on),B(Q,Dt),cn(ee),Se(U,$)||(mt(he,$,U),nt(ee,he)),Se(Q,$)||(mt(he,Q,$),Ae(ee,ee,nt(he,he)));const Et=Ue(ee);return Et>0?Ee(Jt,ee,1/Et):void 0};let ve=Number.POSITIVE_INFINITY;this.sortSubarray(u,f.min,f.max,((Jt,on)=>Jt.featureInfo.featureIndex-on.featureInfo.featureIndex));const De=pe(),ke=pe(),ze=pe(),Je=pe(),Qe=pe(),st=pe(),lt=pe(),ft=pe(),Ut=pe(),vt=[pe(),pe(),pe(),pe()],$t=[pe(),pe(),pe(),pe()],tn=[{coord:new Kt(0,0),height:0},{coord:new Kt(0,0),height:0}],qt=(Jt,on)=>Jt>on;for(let Jt=f.min;Jt<f.max;Jt++){const on=u[Jt];if(!on.featureInfo.guardRailEnabled||!this.prepareEdgePoints(tn,i,l,on,qt))continue;const[Bt,Qt]=tn;if(de(De,Bt.coord.x,Bt.coord.y,C*Bt.height),de(ke,Qt.coord.x,Qt.coord.y,C*Qt.height),Se(De,ke))continue;mt(ze,ke,De),nt(ze,ze);const Dt=_e(ft,on.a)||ze,Et=_e(Ut,on.b)||ze;de(Je,Dt[1],-Dt[0],0),nt(Je,Je),de(Qe,Et[1],-Et[0],0),nt(Qe,Qe),ct(ft,Je,Dt),nt(st,ft),ct(ft,Qe,Et),nt(lt,ft),Ae(vt[0],De,Ee(ft,mt(ft,Je,st),M)),Ae(vt[1],De,Ee(ft,Ae(ft,Je,st),M)),Ae(vt[2],De,Ee(ft,st,M)),vt[3]=De,Ae($t[0],ke,Ee(ft,mt(ft,Qe,lt),M)),Ae($t[1],ke,Ee(ft,Ae(ft,Qe,lt),M)),Ae($t[2],ke,Ee(ft,lt,M)),$t[3]=ke,ve=this.addFeatureSection(on.featureInfo.featureIndex,ve,this.bridgeFeatureSections,e);const an=e.addVertex(vt[0],Je,m),rn=e.addVertex(vt[1],Je,m),Xn=e.addVertex($t[0],Qe,m),Rn=e.addVertex($t[1],Qe,m);e.addTriangle(an,rn,Xn),e.addTriangle(rn,Rn,Xn);const Un=e.addVertex(vt[1],st,m),mn=e.addVertex(vt[2],st,m),Wn=e.addVertex($t[1],lt,m),pr=e.addVertex($t[2],lt,m);e.addTriangle(Un,mn,Wn),e.addTriangle(mn,pr,Wn),ut(Je,Je),ut(Qe,Qe);const bn=e.addVertex(vt[2],Je,m),Hn=e.addVertex(vt[3],Je,m),cr=e.addVertex($t[2],Qe,m),xr=e.addVertex($t[3],Qe,m);e.addTriangle(bn,Hn,cr),e.addTriangle(Hn,xr,cr);const kr=this.isTerminalVertex(on.a,w),Cr=this.isTerminalVertex(on.b,w);Bt.height<.01&&kr&&e.addQuad(vt[3],vt[2],vt[1],vt[0],ut(Dt,Dt),m),Qt.height<.01&&Cr&&e.addQuad($t[0],$t[1],$t[2],$t[3],Et,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,l,u,f,m){e.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const C=(ve,De)=>ve.featureInfo.featureIndex-De.featureInfo.featureIndex;this.sortSubarray(u,f.min,f.max,C),this.sortSubarray(u,m.min,m.max,C);const M=ve=>nt(ve,ve),B=[{coord:new Kt(0,0),height:0},{coord:new Kt(0,0),height:0}],U=(ve,De)=>ve<De,$=pe(),Q=pe(),ee=pe(),he=pe(),_e=pe();for(let ve=f.min;ve<f.max;ve++){if(!this.prepareEdgePoints(B,i,l,u[ve],U))continue;const[De,ke]=B,ze=M(de(_e,-(ke.coord.y-De.coord.y),ke.coord.x-De.coord.x,0));w=this.addFeatureSection(u[ve].featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(de($,De.coord.x,De.coord.y,De.height),de(Q,ke.coord.x,ke.coord.y,ke.height),de(ee,ke.coord.x,ke.coord.y,u[ve].isTunnel?-.1:0),de(he,De.coord.x,De.coord.y,u[ve].isTunnel?-.1:0),ze)}for(let ve=m.min;ve<m.max;ve++){const De=u[ve];De.isTunnel&&([De.a,De.b]=[De.b,De.a]);const ke=i[De.a],ze=i[De.b],Je=M(de(_e,-(ze.y-ke.y),ze.x-ke.x,0));w=this.addFeatureSection(De.featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(de($,ze.x,ze.y,0),de(Q,ke.x,ke.y,0),de(ee,ke.x,ke.y,l[De.a]+4),de(he,ze.x,ze.y,l[De.b]+4),Je),e.addQuad(de($,ke.x,ke.y,0),de(Q,ze.x,ze.y,0),de(ee,ze.x,ze.y,l[De.b]+4),de(he,ke.x,ke.y,l[De.a]+4),Je)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,l,u){e.coord.x=i,e.coord.y=l,e.height=u}prepareEdgePoints(e,i,l,u,f){let m=i[u.a].x,w=i[u.a].y,C=i[u.b].x,M=i[u.b].y,B=l[u.a],U=l[u.b];const $=f(B,0),Q=f(U,0);if($&&Q)return this.setElevatedPoint(e[0],m,w,B),this.setElevatedPoint(e[1],C,M,U),!0;if(!$&&!Q)return!1;if($){if(!Q){const ee=U/(U-B);C=Qn(C,m,ee),M=Qn(M,w,ee),U=Qn(U,B,ee)}}else{const ee=B/(B-U);m=Qn(m,C,ee),w=Qn(w,M,ee),B=Qn(B,U,ee)}return this.setElevatedPoint(e[0],m,w,B),this.setElevatedPoint(e[1],C,M,U),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((w,C)=>w.hash===C.hash?C.polygonIdx-w.polygonIdx:C.hash>w.hash?1:-1));let l=0,u=0,f=0,m=i[l].polygonIdx;do u++,(u===i.length||i[l].hash!==i[u].hash)&&((u-l==1||i[u-1].polygonIdx!==m)&&(f<l&&(i[f]=i[l],i[l]=null),i[f].type="none",f++),l=u,l!==i.length&&(m=i[l].polygonIdx));while(l!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort(((M,B)=>M.portalHash<B.portalHash?1:-1));let w=0,C=0;for(;w!==i.length&&C!==e.length;){const M=i[w],B=e[C];M.portalHash>B.hash?w++:B.hash>M.portalHash?C++:(M.type=B.type,w++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=hn&&i>=hn}addFeatureSection(e,i,l,u){return e!==i&&(i=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,l,u){const f=e.slice(i,l);f.sort(u),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Il.computePosHash(e))<<32n|BigInt(Il.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var GT,$T={exports:{}},HT=(GT||(GT=1,(function(o,e){(function(i){function l(Ne,Ve){return Ne>Ve?1:Ne<Ve?-1:0}var u=function(Ne,Ve){Ne===void 0&&(Ne=l),Ve===void 0&&(Ve=!1),this._compare=Ne,this._root=null,this._size=0,this._noDuplicates=!!Ve},f={size:{configurable:!0}};function m(Ne,Ve,Mt,Vt,xn){var vn=xn-Vt;if(vn>0){var Dn=Vt+Math.floor(vn/2),Jn={key:Ve[Dn],data:Mt[Dn],parent:Ne};return Jn.left=m(Jn,Ve,Mt,Vt,Dn),Jn.right=m(Jn,Ve,Mt,Dn+1,xn),Jn}return null}function w(Ne,Ve,Mt,Vt,xn){if(!(Mt>=Vt)){for(var vn=Ne[Mt+Vt>>1],Dn=Mt-1,Jn=Vt+1;;){do Dn++;while(xn(Ne[Dn],vn)<0);do Jn--;while(xn(Ne[Jn],vn)>0);if(Dn>=Jn)break;var Or=Ne[Dn];Ne[Dn]=Ne[Jn],Ne[Jn]=Or,Or=Ve[Dn],Ve[Dn]=Ve[Jn],Ve[Jn]=Or}w(Ne,Ve,Mt,Jn,xn),w(Ne,Ve,Jn+1,Vt,xn)}}u.prototype.rotateLeft=function(Ne){var Ve=Ne.right;Ve&&(Ne.right=Ve.left,Ve.left&&(Ve.left.parent=Ne),Ve.parent=Ne.parent),Ne.parent?Ne===Ne.parent.left?Ne.parent.left=Ve:Ne.parent.right=Ve:this._root=Ve,Ve&&(Ve.left=Ne),Ne.parent=Ve},u.prototype.rotateRight=function(Ne){var Ve=Ne.left;Ve&&(Ne.left=Ve.right,Ve.right&&(Ve.right.parent=Ne),Ve.parent=Ne.parent),Ne.parent?Ne===Ne.parent.left?Ne.parent.left=Ve:Ne.parent.right=Ve:this._root=Ve,Ve&&(Ve.right=Ne),Ne.parent=Ve},u.prototype._splay=function(Ne){for(;Ne.parent;){var Ve=Ne.parent;Ve.parent?Ve.left===Ne&&Ve.parent.left===Ve?(this.rotateRight(Ve.parent),this.rotateRight(Ve)):Ve.right===Ne&&Ve.parent.right===Ve?(this.rotateLeft(Ve.parent),this.rotateLeft(Ve)):Ve.left===Ne&&Ve.parent.right===Ve?(this.rotateRight(Ve),this.rotateLeft(Ve)):(this.rotateLeft(Ve),this.rotateRight(Ve)):Ve.left===Ne?this.rotateRight(Ve):this.rotateLeft(Ve)}},u.prototype.splay=function(Ne){for(var Ve,Mt,Vt,xn,vn;Ne.parent;)(Mt=(Ve=Ne.parent).parent)&&Mt.parent?((Vt=Mt.parent).left===Mt?Vt.left=Ne:Vt.right=Ne,Ne.parent=Vt):(Ne.parent=null,this._root=Ne),xn=Ne.left,vn=Ne.right,Ne===Ve.left?(Mt&&(Mt.left===Ve?(Ve.right?(Mt.left=Ve.right,Mt.left.parent=Mt):Mt.left=null,Ve.right=Mt,Mt.parent=Ve):(xn?(Mt.right=xn,xn.parent=Mt):Mt.right=null,Ne.left=Mt,Mt.parent=Ne)),vn?(Ve.left=vn,vn.parent=Ve):Ve.left=null,Ne.right=Ve,Ve.parent=Ne):(Mt&&(Mt.right===Ve?(Ve.left?(Mt.right=Ve.left,Mt.right.parent=Mt):Mt.right=null,Ve.left=Mt,Mt.parent=Ve):(vn?(Mt.left=vn,vn.parent=Mt):Mt.left=null,Ne.right=Mt,Mt.parent=Ne)),xn?(Ve.right=xn,xn.parent=Ve):Ve.right=null,Ne.left=Ve,Ve.parent=Ne)},u.prototype.replace=function(Ne,Ve){Ne.parent?Ne===Ne.parent.left?Ne.parent.left=Ve:Ne.parent.right=Ve:this._root=Ve,Ve&&(Ve.parent=Ne.parent)},u.prototype.minNode=function(Ne){if(Ne===void 0&&(Ne=this._root),Ne)for(;Ne.left;)Ne=Ne.left;return Ne},u.prototype.maxNode=function(Ne){if(Ne===void 0&&(Ne=this._root),Ne)for(;Ne.right;)Ne=Ne.right;return Ne},u.prototype.insert=function(Ne,Ve){var Mt=this._root,Vt=null,xn=this._compare;if(this._noDuplicates)for(;Mt;){if(Vt=Mt,xn(Mt.key,Ne)===0)return;Mt=xn(Mt.key,Ne)<0?Mt.right:Mt.left}else for(;Mt;)Vt=Mt,Mt=xn(Mt.key,Ne)<0?Mt.right:Mt.left;return Mt={key:Ne,data:Ve,left:null,right:null,parent:Vt},Vt?xn(Vt.key,Mt.key)<0?Vt.right=Mt:Vt.left=Mt:this._root=Mt,this.splay(Mt),this._size++,Mt},u.prototype.find=function(Ne){for(var Ve=this._root,Mt=this._compare;Ve;){var Vt=Mt(Ve.key,Ne);if(Vt<0)Ve=Ve.right;else{if(!(Vt>0))return Ve;Ve=Ve.left}}return null},u.prototype.contains=function(Ne){for(var Ve=this._root,Mt=this._compare;Ve;){var Vt=Mt(Ne,Ve.key);if(Vt===0)return!0;Ve=Vt<0?Ve.left:Ve.right}return!1},u.prototype.remove=function(Ne){var Ve=this.find(Ne);if(!Ve)return!1;if(this.splay(Ve),Ve.left)if(Ve.right){var Mt=this.minNode(Ve.right);Mt.parent!==Ve&&(this.replace(Mt,Mt.right),Mt.right=Ve.right,Mt.right.parent=Mt),this.replace(Ve,Mt),Mt.left=Ve.left,Mt.left.parent=Mt}else this.replace(Ve,Ve.left);else this.replace(Ve,Ve.right);return this._size--,!0},u.prototype.removeNode=function(Ne){if(!Ne)return!1;if(this.splay(Ne),Ne.left)if(Ne.right){var Ve=this.minNode(Ne.right);Ve.parent!==Ne&&(this.replace(Ve,Ve.right),Ve.right=Ne.right,Ve.right.parent=Ve),this.replace(Ne,Ve),Ve.left=Ne.left,Ve.left.parent=Ve}else this.replace(Ne,Ne.left);else this.replace(Ne,Ne.right);return this._size--,!0},u.prototype.erase=function(Ne){var Ve=this.find(Ne);if(Ve){this.splay(Ve);var Mt=Ve.left,Vt=Ve.right,xn=null;Mt&&(Mt.parent=null,xn=this.maxNode(Mt),this.splay(xn),this._root=xn),Vt&&(Mt?xn.right=Vt:this._root=Vt,Vt.parent=xn),this._size--}},u.prototype.pop=function(){var Ne=this._root,Ve=null;if(Ne){for(;Ne.left;)Ne=Ne.left;Ve={key:Ne.key,data:Ne.data},this.remove(Ne.key)}return Ve},u.prototype.next=function(Ne){var Ve=Ne;if(Ve)if(Ve.right)for(Ve=Ve.right;Ve&&Ve.left;)Ve=Ve.left;else for(Ve=Ne.parent;Ve&&Ve.right===Ne;)Ne=Ve,Ve=Ve.parent;return Ve},u.prototype.prev=function(Ne){var Ve=Ne;if(Ve)if(Ve.left)for(Ve=Ve.left;Ve&&Ve.right;)Ve=Ve.right;else for(Ve=Ne.parent;Ve&&Ve.left===Ne;)Ne=Ve,Ve=Ve.parent;return Ve},u.prototype.forEach=function(Ne){for(var Ve=this._root,Mt=[],Vt=!1,xn=0;!Vt;)Ve?(Mt.push(Ve),Ve=Ve.left):Mt.length>0?(Ne(Ve=Mt.pop(),xn++),Ve=Ve.right):Vt=!0;return this},u.prototype.range=function(Ne,Ve,Mt,Vt){for(var xn=[],vn=this._compare,Dn=this._root;xn.length!==0||Dn;)if(Dn)xn.push(Dn),Dn=Dn.left;else{if(vn((Dn=xn.pop()).key,Ve)>0)break;if(vn(Dn.key,Ne)>=0&&Mt.call(Vt,Dn))return this;Dn=Dn.right}return this},u.prototype.keys=function(){for(var Ne=this._root,Ve=[],Mt=[],Vt=!1;!Vt;)Ne?(Ve.push(Ne),Ne=Ne.left):Ve.length>0?(Ne=Ve.pop(),Mt.push(Ne.key),Ne=Ne.right):Vt=!0;return Mt},u.prototype.values=function(){for(var Ne=this._root,Ve=[],Mt=[],Vt=!1;!Vt;)Ne?(Ve.push(Ne),Ne=Ne.left):Ve.length>0?(Ne=Ve.pop(),Mt.push(Ne.data),Ne=Ne.right):Vt=!0;return Mt},u.prototype.at=function(Ne){for(var Ve=this._root,Mt=[],Vt=!1,xn=0;!Vt;)if(Ve)Mt.push(Ve),Ve=Ve.left;else if(Mt.length>0){if(Ve=Mt.pop(),xn===Ne)return Ve;xn++,Ve=Ve.right}else Vt=!0;return null},u.prototype.load=function(Ne,Ve,Mt){if(Ne===void 0&&(Ne=[]),Ve===void 0&&(Ve=[]),Mt===void 0&&(Mt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Vt=Ne.length;return Mt&&w(Ne,Ve,0,Vt-1,this._compare),this._root=m(null,Ne,Ve,0,Vt),this._size=Vt,this},u.prototype.min=function(){var Ne=this.minNode(this._root);return Ne?Ne.key:null},u.prototype.max=function(){var Ne=this.maxNode(this._root);return Ne?Ne.key:null},u.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},u.createTree=function(Ne,Ve,Mt,Vt,xn){return new u(Mt,xn).load(Ne,Ve,Vt)},Object.defineProperties(u.prototype,f);var C=0,M=1,B=2,U=3,$=0,Q=1,ee=2,he=3;function _e(Ne,Ve,Mt){Ve===null?(Ne.inOut=!1,Ne.otherInOut=!0):(Ne.isSubject===Ve.isSubject?(Ne.inOut=!Ve.inOut,Ne.otherInOut=Ve.otherInOut):(Ne.inOut=!Ve.otherInOut,Ne.otherInOut=Ve.isVertical()?!Ve.inOut:Ve.inOut),Ve&&(Ne.prevInResult=!ve(Ve,Mt)||Ve.isVertical()?Ve.prevInResult:Ve));var Vt=ve(Ne,Mt);Ne.resultTransition=Vt?(function(xn,vn){var Dn,Jn=!xn.inOut,Or=!xn.otherInOut;switch(vn){case $:Dn=Jn&&Or;break;case Q:Dn=Jn||Or;break;case he:Dn=Jn^Or;break;case ee:Dn=xn.isSubject?Jn&&!Or:Or&&!Jn}return Dn?1:-1})(Ne,Mt):0}function ve(Ne,Ve){switch(Ne.type){case C:switch(Ve){case $:return!Ne.otherInOut;case Q:return Ne.otherInOut;case ee:return Ne.isSubject&&Ne.otherInOut||!Ne.isSubject&&!Ne.otherInOut;case he:return!0}break;case B:return Ve===$||Ve===Q;case U:return Ve===ee;case M:return!1}return!1}var De=function(Ne,Ve,Mt,Vt,xn){this.left=Ve,this.point=Ne,this.otherEvent=Mt,this.isSubject=Vt,this.type=xn||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ke={inResult:{configurable:!0}};function ze(Ne,Ve){return Ne[0]===Ve[0]&&Ne[1]===Ve[1]}De.prototype.isBelow=function(Ne){var Ve=this.point,Mt=this.otherEvent.point;return this.left?(Ve[0]-Ne[0])*(Mt[1]-Ne[1])-(Mt[0]-Ne[0])*(Ve[1]-Ne[1])>0:(Mt[0]-Ne[0])*(Ve[1]-Ne[1])-(Ve[0]-Ne[0])*(Mt[1]-Ne[1])>0},De.prototype.isAbove=function(Ne){return!this.isBelow(Ne)},De.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ke.inResult.get=function(){return this.resultTransition!==0},De.prototype.clone=function(){var Ne=new De(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ne.contourId=this.contourId,Ne.resultTransition=this.resultTransition,Ne.prevInResult=this.prevInResult,Ne.isExteriorRing=this.isExteriorRing,Ne.inOut=this.inOut,Ne.otherInOut=this.otherInOut,Ne},Object.defineProperties(De.prototype,ke);var Je=11102230246251565e-32,Qe=134217729,st=(3+8*Je)*Je;function lt(Ne,Ve,Mt,Vt,xn){var vn,Dn,Jn,Or,Lr=Ve[0],Rr=Vt[0],xi=0,to=0;Rr>Lr==Rr>-Lr?(vn=Lr,Lr=Ve[++xi]):(vn=Rr,Rr=Vt[++to]);var Mr=0;if(xi<Ne&&to<Mt)for(Rr>Lr==Rr>-Lr?(Jn=vn-((Dn=Lr+vn)-Lr),Lr=Ve[++xi]):(Jn=vn-((Dn=Rr+vn)-Rr),Rr=Vt[++to]),vn=Dn,Jn!==0&&(xn[Mr++]=Jn);xi<Ne&&to<Mt;)Rr>Lr==Rr>-Lr?(Jn=vn-((Dn=vn+Lr)-(Or=Dn-vn))+(Lr-Or),Lr=Ve[++xi]):(Jn=vn-((Dn=vn+Rr)-(Or=Dn-vn))+(Rr-Or),Rr=Vt[++to]),vn=Dn,Jn!==0&&(xn[Mr++]=Jn);for(;xi<Ne;)Jn=vn-((Dn=vn+Lr)-(Or=Dn-vn))+(Lr-Or),Lr=Ve[++xi],vn=Dn,Jn!==0&&(xn[Mr++]=Jn);for(;to<Mt;)Jn=vn-((Dn=vn+Rr)-(Or=Dn-vn))+(Rr-Or),Rr=Vt[++to],vn=Dn,Jn!==0&&(xn[Mr++]=Jn);return vn===0&&Mr!==0||(xn[Mr++]=vn),Mr}function ft(Ne){return new Float64Array(Ne)}var Ut=33306690738754716e-32,vt=22204460492503146e-32,$t=11093356479670487e-47,tn=ft(4),qt=ft(8),Jt=ft(12),on=ft(16),Bt=ft(4);function Qt(Ne,Ve,Mt){var Vt=(function(xn,vn,Dn,Jn,Or,Lr){var Rr=(vn-Lr)*(Dn-Or),xi=(xn-Or)*(Jn-Lr),to=Rr-xi;if(Rr===0||xi===0||Rr>0!=xi>0)return to;var Mr=Math.abs(Rr+xi);return Math.abs(to)>=Ut*Mr?to:-(function(Vi,Si,pi,Hi,qi,zi,Ui){var Ti,zr,Ei,ho,ur,ii,Wi,go,Qi,Jo,Di,Zo,el,oa,Vs,tl,nh,Qo,ls=Vi-qi,sa=pi-qi,Ca=Si-zi,_a=Hi-zi;tn[0]=(Vs=(go=ls-(Wi=(ii=Qe*ls)-(ii-ls)))*(Jo=_a-(Qi=(ii=Qe*_a)-(ii-_a)))-((oa=ls*_a)-Wi*Qi-go*Qi-Wi*Jo))-((Di=Vs-(nh=(go=Ca-(Wi=(ii=Qe*Ca)-(ii-Ca)))*(Jo=sa-(Qi=(ii=Qe*sa)-(ii-sa)))-((tl=Ca*sa)-Wi*Qi-go*Qi-Wi*Jo)))+(ur=Vs-Di))+(ur-nh),tn[1]=(el=oa-((Zo=oa+Di)-(ur=Zo-oa))+(Di-ur))-((Di=el-tl)+(ur=el-Di))+(ur-tl),tn[2]=Zo-((Qo=Zo+Di)-(ur=Qo-Zo))+(Di-ur),tn[3]=Qo;var Ip=(function(ane,o5){for(var s5=o5[0],A2=1;A2<4;A2++)s5+=o5[A2];return s5})(0,tn),p0=vt*Ui;if(Ip>=p0||-Ip>=p0||(Ti=Vi-(ls+(ur=Vi-ls))+(ur-qi),Ei=pi-(sa+(ur=pi-sa))+(ur-qi),zr=Si-(Ca+(ur=Si-Ca))+(ur-zi),ho=Hi-(_a+(ur=Hi-_a))+(ur-zi),Ti===0&&zr===0&&Ei===0&&ho===0)||(p0=$t*Ui+st*Math.abs(Ip),(Ip+=ls*ho+_a*Ti-(Ca*Ei+sa*zr))>=p0||-Ip>=p0))return Ip;Bt[0]=(Vs=(go=Ti-(Wi=(ii=Qe*Ti)-(ii-Ti)))*(Jo=_a-(Qi=(ii=Qe*_a)-(ii-_a)))-((oa=Ti*_a)-Wi*Qi-go*Qi-Wi*Jo))-((Di=Vs-(nh=(go=zr-(Wi=(ii=Qe*zr)-(ii-zr)))*(Jo=sa-(Qi=(ii=Qe*sa)-(ii-sa)))-((tl=zr*sa)-Wi*Qi-go*Qi-Wi*Jo)))+(ur=Vs-Di))+(ur-nh),Bt[1]=(el=oa-((Zo=oa+Di)-(ur=Zo-oa))+(Di-ur))-((Di=el-tl)+(ur=el-Di))+(ur-tl),Bt[2]=Zo-((Qo=Zo+Di)-(ur=Qo-Zo))+(Di-ur),Bt[3]=Qo;var ML=lt(4,tn,4,Bt,qt);Bt[0]=(Vs=(go=ls-(Wi=(ii=Qe*ls)-(ii-ls)))*(Jo=ho-(Qi=(ii=Qe*ho)-(ii-ho)))-((oa=ls*ho)-Wi*Qi-go*Qi-Wi*Jo))-((Di=Vs-(nh=(go=Ca-(Wi=(ii=Qe*Ca)-(ii-Ca)))*(Jo=Ei-(Qi=(ii=Qe*Ei)-(ii-Ei)))-((tl=Ca*Ei)-Wi*Qi-go*Qi-Wi*Jo)))+(ur=Vs-Di))+(ur-nh),Bt[1]=(el=oa-((Zo=oa+Di)-(ur=Zo-oa))+(Di-ur))-((Di=el-tl)+(ur=el-Di))+(ur-tl),Bt[2]=Zo-((Qo=Zo+Di)-(ur=Qo-Zo))+(Di-ur),Bt[3]=Qo;var IL=lt(ML,qt,4,Bt,Jt);Bt[0]=(Vs=(go=Ti-(Wi=(ii=Qe*Ti)-(ii-Ti)))*(Jo=ho-(Qi=(ii=Qe*ho)-(ii-ho)))-((oa=Ti*ho)-Wi*Qi-go*Qi-Wi*Jo))-((Di=Vs-(nh=(go=zr-(Wi=(ii=Qe*zr)-(ii-zr)))*(Jo=Ei-(Qi=(ii=Qe*Ei)-(ii-Ei)))-((tl=zr*Ei)-Wi*Qi-go*Qi-Wi*Jo)))+(ur=Vs-Di))+(ur-nh),Bt[1]=(el=oa-((Zo=oa+Di)-(ur=Zo-oa))+(Di-ur))-((Di=el-tl)+(ur=el-Di))+(ur-tl),Bt[2]=Zo-((Qo=Zo+Di)-(ur=Qo-Zo))+(Di-ur),Bt[3]=Qo;var RL=lt(IL,Jt,4,Bt,on);return on[RL-1]})(xn,vn,Dn,Jn,Or,Lr,Mr)})(Ne[0],Ne[1],Ve[0],Ve[1],Mt[0],Mt[1]);return Vt>0?-1:Vt<0?1:0}function Dt(Ne,Ve){var Mt=Ne.point,Vt=Ve.point;return Mt[0]>Vt[0]?1:Mt[0]<Vt[0]?-1:Mt[1]!==Vt[1]?Mt[1]>Vt[1]?1:-1:(function(xn,vn,Dn,Jn){return xn.left!==vn.left?xn.left?1:-1:Qt(Dn,xn.otherEvent.point,vn.otherEvent.point)!==0?xn.isBelow(vn.otherEvent.point)?-1:1:!xn.isSubject&&vn.isSubject?1:-1})(Ne,Ve,Mt)}function Et(Ne,Ve,Mt){var Vt=new De(Ve,!1,Ne,Ne.isSubject),xn=new De(Ve,!0,Ne.otherEvent,Ne.isSubject);return ze(Ne.point,Ne.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ne),Vt.contourId=xn.contourId=Ne.contourId,Dt(xn,Ne.otherEvent)>0&&(Ne.otherEvent.left=!0,xn.left=!1),Ne.otherEvent.otherEvent=xn,Ne.otherEvent=Vt,Mt.push(xn),Mt.push(Vt),Mt}function an(Ne,Ve){return Ne[0]*Ve[1]-Ne[1]*Ve[0]}function rn(Ne,Ve){return Ne[0]*Ve[0]+Ne[1]*Ve[1]}function Xn(Ne,Ve,Mt){var Vt=(function(Or,Lr,Rr,xi,to){var Mr=[Lr[0]-Or[0],Lr[1]-Or[1]],Vi=[xi[0]-Rr[0],xi[1]-Rr[1]];function Si(ii,Wi,go){return[ii[0]+Wi*go[0],ii[1]+Wi*go[1]]}var pi=[Rr[0]-Or[0],Rr[1]-Or[1]],Hi=an(Mr,Vi),qi=Hi*Hi,zi=rn(Mr,Mr);if(qi>0){var Ui=an(pi,Vi)/Hi;if(Ui<0||Ui>1)return null;var Ti=an(pi,Mr)/Hi;return Ti<0||Ti>1?null:Ui===0||Ui===1?[Si(Or,Ui,Mr)]:Ti===0||Ti===1?[Si(Rr,Ti,Vi)]:[Si(Or,Ui,Mr)]}if((qi=(Hi=an(pi,Mr))*Hi)>0)return null;var zr=rn(Mr,pi)/zi,Ei=zr+rn(Mr,Vi)/zi,ho=Math.min(zr,Ei),ur=Math.max(zr,Ei);return ho<=1&&ur>=0?ho===1?[Si(Or,ho>0?ho:0,Mr)]:ur===0?[Si(Or,ur<1?ur:1,Mr)]:[Si(Or,ho>0?ho:0,Mr),Si(Or,ur<1?ur:1,Mr)]:null})(Ne.point,Ne.otherEvent.point,Ve.point,Ve.otherEvent.point),xn=Vt?Vt.length:0;if(xn===0||xn===1&&(ze(Ne.point,Ve.point)||ze(Ne.otherEvent.point,Ve.otherEvent.point))||xn===2&&Ne.isSubject===Ve.isSubject)return 0;if(xn===1)return ze(Ne.point,Vt[0])||ze(Ne.otherEvent.point,Vt[0])||Et(Ne,Vt[0],Mt),ze(Ve.point,Vt[0])||ze(Ve.otherEvent.point,Vt[0])||Et(Ve,Vt[0],Mt),1;var vn=[],Dn=!1,Jn=!1;return ze(Ne.point,Ve.point)?Dn=!0:Dt(Ne,Ve)===1?vn.push(Ve,Ne):vn.push(Ne,Ve),ze(Ne.otherEvent.point,Ve.otherEvent.point)?Jn=!0:Dt(Ne.otherEvent,Ve.otherEvent)===1?vn.push(Ve.otherEvent,Ne.otherEvent):vn.push(Ne.otherEvent,Ve.otherEvent),Dn&&Jn||Dn?(Ve.type=M,Ne.type=Ve.inOut===Ne.inOut?B:U,Dn&&!Jn&&Et(vn[1].otherEvent,vn[0].point,Mt),2):Jn?(Et(vn[0],vn[1].point,Mt),3):vn[0]!==vn[3].otherEvent?(Et(vn[0],vn[1].point,Mt),Et(vn[1],vn[2].point,Mt),3):(Et(vn[0],vn[1].point,Mt),Et(vn[3].otherEvent,vn[2].point,Mt),3)}function Rn(Ne,Ve){if(Ne===Ve)return 0;if(Qt(Ne.point,Ne.otherEvent.point,Ve.point)!==0||Qt(Ne.point,Ne.otherEvent.point,Ve.otherEvent.point)!==0)return ze(Ne.point,Ve.point)?Ne.isBelow(Ve.otherEvent.point)?-1:1:Ne.point[0]===Ve.point[0]?Ne.point[1]<Ve.point[1]?-1:1:Dt(Ne,Ve)===1?Ve.isAbove(Ne.point)?-1:1:Ne.isBelow(Ve.point)?-1:1;if(Ne.isSubject!==Ve.isSubject)return Ne.isSubject?-1:1;var Mt=Ne.point,Vt=Ve.point;return Mt[0]===Vt[0]&&Mt[1]===Vt[1]?(Mt=Ne.otherEvent.point)[0]===(Vt=Ve.otherEvent.point)[0]&&Mt[1]===Vt[1]?0:Ne.contourId>Ve.contourId?1:-1:Dt(Ne,Ve)===1?1:-1}var Un=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function mn(Ne,Ve,Mt,Vt){var xn,vn=Ne+1,Dn=Ve[Ne].point,Jn=Ve.length;for(vn<Jn&&(xn=Ve[vn].point);vn<Jn&&xn[0]===Dn[0]&&xn[1]===Dn[1];){if(!Mt[vn])return vn;++vn<Jn&&(xn=Ve[vn].point)}for(vn=Ne-1;Mt[vn]&&vn>Vt;)vn--;return vn}Un.prototype.isExterior=function(){return this.holeOf==null};var Wn=bn,pr=bn;function bn(Ne,Ve){if(!(this instanceof bn))return new bn(Ne,Ve);if(this.data=Ne||[],this.length=this.data.length,this.compare=Ve||Hn,this.length>0)for(var Mt=(this.length>>1)-1;Mt>=0;Mt--)this._down(Mt)}function Hn(Ne,Ve){return Ne<Ve?-1:Ne>Ve?1:0}bn.prototype={push:function(Ne){this.data.push(Ne),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ne=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ne}},peek:function(){return this.data[0]},_up:function(Ne){for(var Ve=this.data,Mt=this.compare,Vt=Ve[Ne];Ne>0;){var xn=Ne-1>>1,vn=Ve[xn];if(Mt(Vt,vn)>=0)break;Ve[Ne]=vn,Ne=xn}Ve[Ne]=Vt},_down:function(Ne){for(var Ve=this.data,Mt=this.compare,Vt=this.length>>1,xn=Ve[Ne];Ne<Vt;){var vn=1+(Ne<<1),Dn=vn+1,Jn=Ve[vn];if(Dn<this.length&&Mt(Ve[Dn],Jn)<0&&(vn=Dn,Jn=Ve[Dn]),Mt(Jn,xn)>=0)break;Ve[Ne]=Jn,Ne=vn}Ve[Ne]=xn}},Wn.default=pr;var cr=Math.max,xr=Math.min,kr=0;function Cr(Ne,Ve,Mt,Vt,xn,vn){var Dn,Jn,Or,Lr,Rr,xi;for(Dn=0,Jn=Ne.length-1;Dn<Jn;Dn++)if(Lr=Ne[Dn+1],Rr=new De(Or=Ne[Dn],!1,void 0,Ve),xi=new De(Lr,!1,Rr,Ve),Rr.otherEvent=xi,Or[0]!==Lr[0]||Or[1]!==Lr[1]){Rr.contourId=xi.contourId=Mt,vn||(Rr.isExteriorRing=!1,xi.isExteriorRing=!1),Dt(Rr,xi)>0?xi.left=!0:Rr.left=!0;var to=Or[0],Mr=Or[1];xn[0]=xr(xn[0],to),xn[1]=xr(xn[1],Mr),xn[2]=cr(xn[2],to),xn[3]=cr(xn[3],Mr),Vt.push(Rr),Vt.push(xi)}}var Ln=[];function Sr(Ne,Ve,Mt){typeof Ne[0][0][0]=="number"&&(Ne=[Ne]),typeof Ve[0][0][0]=="number"&&(Ve=[Ve]);var Vt=(function(Mr,Vi,Si){var pi=null;return Mr.length*Vi.length==0&&(Si===$?pi=Ln:Si===ee?pi=Mr:Si!==Q&&Si!==he||(pi=Mr.length===0?Vi:Mr)),pi})(Ne,Ve,Mt);if(Vt)return Vt===Ln?null:Vt;var xn=[1/0,1/0,-1/0,-1/0],vn=[1/0,1/0,-1/0,-1/0],Dn=(function(Mr,Vi,Si,pi,Hi){var qi,zi,Ui,Ti,zr,Ei,ho=new Wn(null,Dt);for(Ui=0,Ti=Mr.length;Ui<Ti;Ui++)for(zr=0,Ei=(qi=Mr[Ui]).length;zr<Ei;zr++)(zi=zr===0)&&kr++,Cr(qi[zr],!0,kr,ho,Si,zi);for(Ui=0,Ti=Vi.length;Ui<Ti;Ui++)for(zr=0,Ei=(qi=Vi[Ui]).length;zr<Ei;zr++)zi=zr===0,Hi===ee&&(zi=!1),zi&&kr++,Cr(qi[zr],!1,kr,ho,pi,zi);return ho})(Ne,Ve,xn,vn,Mt);if(Vt=(function(Mr,Vi,Si,pi,Hi){var qi=null;return(Si[0]>pi[2]||pi[0]>Si[2]||Si[1]>pi[3]||pi[1]>Si[3])&&(Hi===$?qi=Ln:Hi===ee?qi=Mr:Hi!==Q&&Hi!==he||(qi=Mr.concat(Vi))),qi})(Ne,Ve,xn,vn,Mt))return Vt===Ln?null:Vt;for(var Jn=(function(Mr){var Vi,Si,pi=(function(Ui){var Ti,zr,Ei,ho,ur=[];for(zr=0,Ei=Ui.length;zr<Ei;zr++)((Ti=Ui[zr]).left&&Ti.inResult||!Ti.left&&Ti.otherEvent.inResult)&&ur.push(Ti);for(var ii=!1;!ii;)for(ii=!0,zr=0,Ei=ur.length;zr<Ei;zr++)zr+1<Ei&&Dt(ur[zr],ur[zr+1])===1&&(ho=ur[zr],ur[zr]=ur[zr+1],ur[zr+1]=ho,ii=!1);for(zr=0,Ei=ur.length;zr<Ei;zr++)(Ti=ur[zr]).otherPos=zr;for(zr=0,Ei=ur.length;zr<Ei;zr++)(Ti=ur[zr]).left||(ho=Ti.otherPos,Ti.otherPos=Ti.otherEvent.otherPos,Ti.otherEvent.otherPos=ho);return ur})(Mr),Hi={},qi=[],zi=function(){if(!Hi[Vi]){var Ui=qi.length,Ti=(function(ur,ii,Wi){var go=new Un;if(ur.prevInResult!=null){var Qi=ur.prevInResult,Jo=Qi.outputContourId;if(Qi.resultTransition>0){var Di=ii[Jo];if(Di.holeOf!=null){var Zo=Di.holeOf;ii[Zo].holeIds.push(Wi),go.holeOf=Zo,go.depth=ii[Jo].depth}else ii[Jo].holeIds.push(Wi),go.holeOf=Jo,go.depth=ii[Jo].depth+1}else go.holeOf=null,go.depth=ii[Jo].depth}else go.holeOf=null,go.depth=0;return go})(pi[Vi],qi,Ui),zr=function(ur){Hi[ur]=!0,ur<pi.length&&pi[ur]&&(pi[ur].outputContourId=Ui)},Ei=Vi,ho=Vi;for(Ti.points.push(pi[Vi].point);zr(Ei),zr(Ei=pi[Ei].otherPos),Ti.points.push(pi[Ei].point),!((Ei=mn(Ei,pi,Hi,ho))==ho||Ei>=pi.length)&&pi[Ei];);qi.push(Ti)}};for(Vi=0,Si=pi.length;Vi<Si;Vi++)zi();return qi})((function(Mr,Vi,Si,pi,Hi,qi){for(var zi,Ui,Ti,zr=new u(Rn),Ei=[],ho=Math.min(pi[2],Hi[2]);Mr.length!==0;){var ur=Mr.pop();if(Ei.push(ur),qi===$&&ur.point[0]>ho||qi===ee&&ur.point[0]>pi[2])break;if(ur.left){Ui=zi=zr.insert(ur),zi=zi!==(Ti=zr.minNode())?zr.prev(zi):null,Ui=zr.next(Ui);var ii=zi?zi.key:null;if(_e(ur,ii,qi),Ui&&Xn(ur,Ui.key,Mr)===2&&(_e(ur,ii,qi),_e(Ui.key,ur,qi)),zi&&Xn(zi.key,ur,Mr)===2){var Wi=zi;_e(ii,(Wi=Wi!==Ti?zr.prev(Wi):null)?Wi.key:null,qi),_e(ur,ii,qi)}}else Ui=zi=zr.find(ur=ur.otherEvent),zi&&Ui&&(zi=zi!==Ti?zr.prev(zi):null,Ui=zr.next(Ui),zr.remove(ur),Ui&&zi&&Xn(zi.key,Ui.key,Mr))}return Ei})(Dn,0,0,xn,vn,Mt)),Or=[],Lr=0;Lr<Jn.length;Lr++){var Rr=Jn[Lr];if(Rr.isExterior()){for(var xi=[Rr.points],to=0;to<Rr.holeIds.length;to++)xi.push(Jn[Rr.holeIds[to]].points);Or.push(xi)}}return Or}var Kr={UNION:Q,DIFFERENCE:ee,INTERSECTION:$,XOR:he};i.diff=function(Ne,Ve){return Sr(Ne,Ve,ee)},i.intersection=function(Ne,Ve){return Sr(Ne,Ve,$)},i.operations=Kr,i.union=function(Ne,Ve){return Sr(Ne,Ve,Q)},i.xor=function(Ne,Ve){return Sr(Ne,Ve,he)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,$T.exports)),$T.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function _v(o,e,i,l){const u=[],f=l===0?(m,w,C,M,B,U)=>{m.push(new Kt(U,C+(U-w)/(M-w)*(B-C)))}:(m,w,C,M,B,U)=>{m.push(new Kt(w+(U-C)/(B-C)*(M-w),U))};for(const m of o){const w=[];for(const C of m){if(C.length<=2)continue;const M=[];for(let $=0;$<C.length-1;$++){const Q=C[$].x,ee=C[$].y,he=C[$+1].x,_e=C[$+1].y,ve=l===0?Q:ee,De=l===0?he:_e;ve<e?De>e&&f(M,Q,ee,he,_e,e):ve>i?De<i&&f(M,Q,ee,he,_e,i):M.push(C[$]),De<e&&ve>=e&&f(M,Q,ee,he,_e,e),De>i&&ve<=i&&f(M,Q,ee,he,_e,i)}let B=C[C.length-1];const U=l===0?B.x:B.y;U>=e&&U<=i&&M.push(B),M.length&&(B=M[M.length-1],M[0].x===B.x&&M[0].y===B.y||M.push(M[0]),w.push(M))}w.length&&u.push(w)}return u}function E6(o,e){const i=wb(o),l=wb([e]),u=HT.intersection(i,l);return u==null?[]:qT(u)}function A6(o,e){let l=wb(o,65536);const u=[];for(;e.valid();e.next()){const[f,m]=e.get(),w=f.x*65536,C=f.y*65536,M=m.x*65536,B=m.y*65536,U=M-w,$=B-C,Q=Math.hypot(U,$);if(Q===0)continue;const ee=Math.trunc($/Q*3),he=-Math.trunc(U/Q*3);u.push([[[w,C],[M,B],[M+ee,B+he],[w+ee,C+he],[w,C]]])}return u.length>0&&(l=HT.diff(l,u)),qT(l,1/65536)}function wb(o,e=1){return[o.map((i=>i.map((l=>[l.x*e,l.y*e]))))]}function qT(o,e=1){return o.map((i=>i.map(((l,u)=>{const f=l.map((m=>new Kt(m[0]*e,m[1]*e).round()));return u>0&&f.reverse(),f}))))}class Sb{constructor(e,i){this.layoutVertexArray=new iu,this.indexArray=new Fo,this.lineIndexArray=new zo,this.triangleSegments=new Pi,this.lineSegments=new Pi,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Kl)}update(e,i,l,u,f,m,w,C){this.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,h6.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,l,u,f,m,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,u,f,m,void 0,w)}}class Tb{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Sb(e,!1),this.elevationBufferData=new Sb(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.hasPattern=xb("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:w,id:C,index:M,sourceLayerIndex:B}of e){const U=this.layers[0]._featureFilter.needGeometry,$=Ht(w,U);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),$,l))continue;const Q=f?f.evaluate($,{},l,i.availableImages):void 0,ee={id:C,properties:w.properties,type:w.type,sourceLayerIndex:B,index:M,geometry:U?$.geometry:Sn(w,l,u),patterns:{},sortKey:Q};m.push(ee)}f&&m.sort(((w,C)=>w.sortKey-C.sortKey));for(const w of m){const{geometry:C,index:M,sourceLayerIndex:B}=w;if(this.hasPattern){const U=bb("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(U)}else this.addFeature(w,C,M,l,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[M].feature,C,M,B,this.index)}}update(e,i,l,u,f,m,w){this.bufferData.update(e,i,l,u,f,m,w,this.worldview),this.elevationBufferData.update(e,i,l,u,f,m,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,l,u,f,m,w,this.worldview)}addFeatures(e,i,l,u,f,m){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,l,u,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,l,u,f,m=[],w,C){const M=F_(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,M,u,l,C):this.addGeometry(M,this.bufferData),this.bufferData.populatePaintArrays(e,l,f,m,u,w,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,f,m,u,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,l,u,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,l,u,f,this.worldview))}addElevatedRoadFeature(e,i,l,u,f){const m=new Array,w=Ii.getElevationFeature(e,f);if(!w)return void this.addGeometry(i,this.bufferData);{const M=this.clipPolygonsToTile(i,1);M.length>0&&m.push({polygons:M,elevationFeature:w,elevationTileID:l})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const M of m)if(M.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Il(M.elevationTileID,this.layers,this.zoom,this.lut));const U=M.elevationFeature.isTunnel();let $=0;e.properties.hasOwnProperty(qr)&&($=+e.properties[qr]);for(const Q of M.polygons)this.elevatedStructures.addPortalCandidates(M.elevationFeature.id,Q,U,M.elevationFeature,$)}M.elevationFeature.constantHeight==null&&(M.polygons=this.prepareElevatedPolygons(M.polygons,M.elevationFeature,M.elevationTileID));const B=new xo(l,M.elevationTileID);this.addElevatedGeometry(M.polygons,B,M.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,C)}}addElevatedGeometry(e,i,l,u,f,m){const w={elevation:l,elevationSampler:i,bias:u,index:f,featureInfo:m},[C,M]=this.addGeometry(e,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:M}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,M))}addGeometry(e,i,l){let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,m=null;l&&(m=l.elevationSampler.constantElevation(l.elevation,l.bias),m!=null&&(u=m,f=m));const w=(C,M,B)=>{if(l!=null)if(M.push(C),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),B.push(m);else{const U=l.elevationSampler.pointElevation(C,l.elevation,l.bias);i.elevatedLayoutVertexArray.emplaceBack(U),B.push(U),u=Math.min(u,U),f=Math.max(f,U)}};for(const C of e){let M=0;for(const ke of C)M+=ke.length;const B=i.triangleSegments.prepareSegment(M,i.layoutVertexArray,i.indexArray),U=B.vertexLength,$=[],Q=[],ee=[],he=[],_e=[],ve=i.layoutVertexArray.length;for(const ke of C){if(ke.length===0)continue;ke!==C[0]&&Q.push($.length/2);const ze=i.lineSegments.prepareSegment(ke.length,i.layoutVertexArray,i.lineIndexArray),Je=ze.vertexLength;l&&_e.push(i.layoutVertexArray.length-ve),w(ke[0],ee,he),i.layoutVertexArray.emplaceBack(ke[0].x,ke[0].y),i.lineIndexArray.emplaceBack(Je+ke.length-1,Je),$.push(ke[0].x),$.push(ke[0].y);for(let Qe=1;Qe<ke.length;Qe++)w(ke[Qe],ee,he),i.layoutVertexArray.emplaceBack(ke[Qe].x,ke[Qe].y),i.lineIndexArray.emplaceBack(Je+Qe-1,Je+Qe),$.push(ke[Qe].x),$.push(ke[Qe].y);ze.vertexLength+=ke.length,ze.primitiveLength+=ke.length}const De=bg($,Q);for(let ke=0;ke<De.length;ke+=3)i.indexArray.emplaceBack(U+De[ke],U+De[ke+1],U+De[ke+2]);if(De.length>0&&l&&this.elevationMode==="hd-road-base"){const ke=l.elevation.isTunnel(),ze=l.elevation.safeArea,Je=this.elevatedStructures.addVertices(ee,he);this.elevatedStructures.addTriangles(De,Je,ke);const Qe=_e.length;if(Qe>0){for(let st=0;st<Qe-1;st++)this.elevatedStructures.addRenderableRing(l.index,_e[st]+Je,_e[st+1]-_e[st],ke,ze,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,_e[Qe-1]+Je,ee.length-_e[Qe-1],ke,ze,l.featureInfo)}}B.vertexLength+=M,B.primitiveLength+=De.length/3}return[u,f]}prepareElevatedPolygons(e,i,l){const u=1/bt(l),f=[];for(const m of e){const w=A6(m,new Gr(i,u));f.push(...w)}return f}clipPolygonsToTile(e,i){const l=-i,u=-i,f=hn+i,m=hn+i;let w=0;const C=[],M=[];for(;w<e.length;w++){const $=e[w],Q=Rh($);(Q.min.x>=l&&Q.max.x<=f&&Q.min.y>=u&&Q.max.y<=m?C:M).push($)}if(C.length===e.length)return e;const B=[new Kt(l,u),new Kt(f,u),new Kt(f,m),new Kt(l,m),new Kt(l,u)],U=C;for(const $ of M)U.push(...E6($,B));return U}}let WT,ZT,YT,XT;In(Tb,"FillBucket",{omit:["layers","patternFeatures"]}),In(Sb,"FillBufferData"),In(Il,"ElevatedStructures");class yv{constructor(e,i,l,u){if(this.triangleCount=i.length/3,this.min=new Kt(0,0),this.max=new Kt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,m]=[e[0].clone(),e[0].clone()];for(let U=1;U<e.length;++U){const $=e[U];f.x=Math.min(f.x,$.x),f.y=Math.min(f.y,$.y),m.x=Math.max(m.x,$.x),m.y=Math.max(m.y,$.y)}if(u){const U=Math.ceil(Math.max(m.x-f.x,m.y-f.y)/u);l=Math.max(l,U)}if(l===0)return;this.min=f,this.max=m;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const C=Math.max(w.x,w.y)/l;this.cellsX=Math.max(1,Math.ceil(w.x/C)),this.cellsY=Math.max(1,Math.ceil(w.y/C)),this.xScale=1/C,this.yScale=1/C;const M=[];for(let U=0;U<this.triangleCount;U++){const $=e[i[3*U+0]].sub(this.min),Q=e[i[3*U+1]].sub(this.min),ee=e[i[3*U+2]].sub(this.min),he=eh(Math.floor(Math.min($.x,Q.x,ee.x)),this.xScale,this.cellsX),_e=eh(Math.floor(Math.max($.x,Q.x,ee.x)),this.xScale,this.cellsX),ve=eh(Math.floor(Math.min($.y,Q.y,ee.y)),this.yScale,this.cellsY),De=eh(Math.floor(Math.max($.y,Q.y,ee.y)),this.yScale,this.cellsY),ke=new Kt(0,0),ze=new Kt(0,0),Je=new Kt(0,0),Qe=new Kt(0,0);for(let st=ve;st<=De;++st){ke.y=ze.y=st*C,Je.y=Qe.y=(st+1)*C;for(let lt=he;lt<=_e;++lt)ke.x=Je.x=lt*C,ze.x=Qe.x=(lt+1)*C,(Ta($,Q,ee,ke,ze,Qe)||Ta($,Q,ee,ke,Qe,Je))&&M.push({cellIdx:st*this.cellsX+lt,triIdx:U})}}if(M.length===0)return;M.sort(((U,$)=>U.cellIdx-$.cellIdx||U.triIdx-$.triIdx));let B=0;for(;B<M.length;){const U=M[B].cellIdx,$={start:this.payload.length,len:0};for(;B<M.length&&M[B].cellIdx===U;)++$.len,this.payload.push(M[B++].triIdx);this.cells[U]=$}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=eh(e.x-this.min.x,this.xScale,this.cellsX),u=eh(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[u*this.cellsX+l];if(f){this._lazyInitLookup();for(let m=0;m<f.len;m++){const w=this.payload[f.start+m],C=Math.floor(w/8),M=1<<w%8;if(!(this.lookup[C]&M)&&(this.lookup[C]|=M,i.push(w),i.length===this.triangleCount))return}}}query(e,i,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=eh(e.x-this.min.x,this.xScale,this.cellsX),f=eh(i.x-this.min.x,this.xScale,this.cellsX),m=eh(e.y-this.min.y,this.yScale,this.cellsY),w=eh(i.y-this.min.y,this.yScale,this.cellsY);for(let C=m;C<=w;C++)for(let M=u;M<=f;M++){const B=this.cells[C*this.cellsX+M];if(B)for(let U=0;U<B.len;U++){const $=this.payload[B.start+U],Q=Math.floor($/8),ee=1<<$%8;if(!(this.lookup[Q]&ee)&&(this.lookup[Q]|=ee,l.push($),l.length===this.triangleCount))return}}}}function eh(o,e,i){return Math.max(0,Math.min(i-1,Math.floor(o*e)))}In(yv,"TriangleGridIndex");class KT{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}populate(e,i,l,u){const f=[];for(const{feature:m,id:w,index:C,sourceLayerIndex:M}of e){const B=this.layers[0]._featureFilter.needGeometry,U=Ht(m,B);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),U,l))continue;const $={id:w,properties:m.properties,type:m.type,sourceLayerIndex:M,index:C,geometry:B?U.geometry:Sn(m,l,u),patterns:{}};f.push($)}for(const m of f){const{geometry:w,index:C,sourceLayerIndex:M}=m;this.addFeature(m,w,C,l,{},i.availableImages,i.brightness),i.featureIndex.insert(e[C].feature,w,C,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,l,u,f,m,w){}destroy(){}addFeature(e,i,l,u,f,m=[],w){for(const C of F_(i,2)){const M=[],B=[],U=[],$=new Kt(1/0,1/0),Q=new Kt(-1/0,-1/0);for(const _e of C)if(_e.length!==0){_e!==C[0]&&U.push(B.length/2);for(let ve=0;ve<_e.length;ve++)B.push(_e[ve].x),B.push(_e[ve].y),M.push(_e[ve]),$.x=Math.min($.x,_e[ve].x),$.y=Math.min($.y,_e[ve].y),Q.x=Math.max(Q.x,_e[ve].x),Q.y=Math.max(Q.y,_e[ve].y)}const ee=bg(B,U),he=new yv(M,ee,8,256);this.footprints.push({vertices:M,indices:ee,grid:he,min:$,max:Q})}}}In(KT,"ClipBucket",{omit:["layers"]});const P6=jr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),M6=jr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),I6=jr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),R6=jr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),D6=jr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),k6=jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:O6}=P6,B_=Number.MAX_SAFE_INTEGER,JT=B_-1;function QT(o,e,i,l){return o.order<e||o.order===B_||!(o.clipMask&i)||(function(u,f){return f.length!==0&&f.find((m=>m===u))===void 0})(l,o.clipScope)}function vv(o,e){return o.x-e.x||o.y-e.y}function eC(o,e){return vv(o.min,e.min)===0&&vv(o.max,e.max)===0}function Cb(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function xv(o,e){if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(o[i].sourceId!==e[i].sourceId||!eC(o[i],e[i])||o[i].order!==e[i].order||o[i].clipMask!==e[i].clipMask||!yo(o[i].clipScope,e[i].clipScope))return!1;return!0}function tC(o,e,i){const l=1/hn,u=1/(1<<i.canonical.z),f=(e.x*l+i.canonical.x)*u+i.wrap,m=(e.y*l+i.canonical.y)*u;return{min:new Kt((o.x*l+i.canonical.x)*u+i.wrap,(o.y*l+i.canonical.y)*u),max:new Kt(f,m)}}function L6(o,e,i){const l=1<<i.canonical.z,u=((e.x-i.wrap)*l-i.canonical.x)*hn,f=(e.y*l-i.canonical.y)*hn;return{min:new Kt(((o.x-i.wrap)*l-i.canonical.x)*hn,(o.y*l-i.canonical.y)*hn),max:new Kt(u,f)}}function Eb(o,e,i,l,u,f,m){const w=o.indices,C=o.vertices,M=[];for(let B=l;B<l+u;B+=3){const U=e[i[B+0]+f],$=e[i[B+1]+f],Q=e[i[B+2]+f],ee=Math.min(U.x,$.x,Q.x),he=Math.max(U.x,$.x,Q.x),_e=Math.min(U.y,$.y,Q.y),ve=Math.max(U.y,$.y,Q.y);M.length=0,o.grid.query(new Kt(ee,_e),new Kt(he,ve),M);for(let De=0;De<M.length;De++){const ke=M[De];if(Ta(C[w[3*ke+0]],C[w[3*ke+1]],C[w[3*ke+2]],U,$,Q,m))return!0}}return!1}function nC(o,e,i,l){if(!o||!i)return!1;let u=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(i.vertices.length<o.vertices.length)return nC(i,l,o,e);const f=e.canonical,m=l.canonical,w=Math.pow(2,m.z-f.z);u=o.vertices.map((C=>new Kt((C.x+f.x*hn)*w-m.x*hn,(C.y+f.y*hn)*w-m.y*hn)))}return Eb(i,u,o.indices,0,o.indices.length,0,0)}function rC(o,e,i,l){const u=Math.pow(2,l.z-i.z);return new Kt((o+i.x*hn)*u-l.x*hn,(e+i.y*hn)*u-l.y*hn)}function Ab(o,e){const i=[];e.grid.queryPoint(o,i);const l=e.indices,u=e.vertices;for(let f=0;f<i.length;f++){const m=i[f];if(No([u[l[3*m+0]],u[l[3*m+1]],u[l[3*m+2]]],o))return!0}return!1}const Pb=[new Kt(0,0),new Kt(hn,0),new Kt(hn,hn),new Kt(0,hn)];function iC(o,e){const i=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return Ji(o[0],o[1],Pb)?[o]:[];for(let u=0;u<o.length+2;u++){const f=o[u%o.length],m=o[(u+1)%o.length],w=Ji(u===0?o[o.length-1]:o[(u-1)%o.length],f,Pb),C=Ji(f,m,Pb),M=w||C;M&&l.push(f),M&&C||l.length>0&&(l.length>1&&i.push(l),l=[])}return l.length>1&&i.push(l),i}const Mb=en.types,z6=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],F6=["fill-extrusion-flood-light-ground-radius"],B6=Math.pow(2,13),N6=Math.pow(2,15)-1,oC=new Kt(0,1),Tp=2147483648;function N_(o,e,i,l,u,f,m,w){o.emplaceBack((e<<1)+m,(i<<1)+f,(Math.floor(l*B6)<<1)+u,Math.round(w))}function V_(o,e,i){o.emplaceBack(e.x*hn,e.y*hn,i?1:0)}function bv(o,e,i,l,u,f){o.emplaceBack(e.x,e.y,(i.x<<1)+l,(i.y<<1)+u,f)}function U_(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class sC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class aC{constructor(){this.centroidXY=new Kt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Kt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Kt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Kt(this.max.x-this.min.x,this.max.y-this.min.y)}}class lC{constructor(){this.acc=new Kt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,l){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===hn)&&i.x===l.x)!=((i.y===0||i.y===hn)&&i.y===l.y)&&this.processBorderOverlap(i,l),u&&this.checkBorderIntersection(i,l)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Qn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>hn!=e.x>hn&&this.addBorderIntersection(1,Qn(i.y,e.y,(hn-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Qn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>hn!=e.y>hn&&this.addBorderIntersection(3,Qn(i.x,e.x,(hn-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Kt(0,0):new Kt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function cC(o,e){const i=o.add(e)._unit(),l=et(o.x*i.x+o.y*i.y,-1,1);var u,f,m;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*N6*((f=o).x*(m=e).y-f.y*m.x<0?-1:1)}const V6=[o=>o.x<0,o=>o.x>hn,o=>o.y<0,o=>o.y>hn];function U6(o,e,i,l){const u=[4];if(l===0)return u;i._mult(l);const f=o.sub(i),m=e.sub(i),w=[o,e,f,m];for(let C=0;C<4;C++)for(const M of w)if(V6[C](M)){u.push(C);break}return u}class Ib{constructor(e){this.vertexArray=new dp,this.indexArray=new Fo,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut},(i=>F6.includes(i))),this._segments=new Pi,this.hiddenByLandmarkVertexArray=new _p,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Pi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,l,u=!1){const f=e.length;if(f>2){let m=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let C;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const M=e[0],B=e[1];C=cC(M.sub(e[f-1])._perp()._unit(),B.sub(M)._perp()._unit())}for(let M=0;M<f;M++){const B=M===f-1?0:M+1,U=e[M],$=e[B],Q=e[B===f-1?0:B+1],ee=$.sub(U)._perp()._unit(),he=cC(ee,Q.sub($)._perp()._unit()),_e=C,ve=he;if(Rb(U,$,i)||u&&hC(U,i)&&hC($,i)){C=he;continue}const De=w.vertexLength;bv(this.vertexArray,U,$,1,1,_e),bv(this.vertexArray,U,$,1,0,_e),bv(this.vertexArray,U,$,0,1,ve),bv(this.vertexArray,U,$,0,0,ve),w.vertexLength+=4;const ke=U6(U,$,ee,l);for(const ze of ke)this._segmentToGroundQuads[m].push({id:De,region:ze}),this._segmentToRegionTriCounts[m][ze]+=2,w.primitiveLength+=2;C=he}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort(((u,f)=>u.region-f.region));for(let l=0;l<i;l++){const u=this._segmentToGroundQuads[l],f=e[l],m=this._segmentToRegionTriCounts[l];m.reduce(((C,M)=>C+M),0);let w=0;for(let C=0;C<=4;C++){const M=m[C];if(M!==0){let B=this.regionSegments[C];B||(B=this.regionSegments[C]=new Pi);const U={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+w,vertexLength:f.vertexLength,primitiveLength:M};B.get().push(U)}w+=M}for(let C=0;C<u.length;C++){const M=u[C].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,l,u,f,m,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,l,u,f,m,void 0,w)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,M6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,l,u,f,m,w,C){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,l,u,f,m,w,C)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Tp))}updateHiddenByLandmarkRange(e,i,l){if(!this.hasData())return;const u=i+e;if(i!==0){for(let f=e;f<u;++f)this.hiddenByLandmarkVertexArray.emplace(f,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,D6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class wv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fo,this.footprintVertices=new iu,this.footprintSegments=[],this.layoutVertexArray=new ou,this.centroidVertexArray=new Ju,this.wallVertexArray=new tf,this.indexArray=new Fo,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut},(i=>z6.includes(i))),this.segments=new Pi,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new Ib(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.features=[],this.hasPattern=xb("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=bt(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:m,index:w,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,B=Ht(f,M);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),B,l))continue;const U={id:m,sourceLayerIndex:C,index:w,geometry:M?B.geometry:Sn(f,l,u),properties:f.properties,type:f.type,patterns:{}},$=this.layoutVertexArray.length,Q=Mb[U.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:bb("fill-extrusion",this.layers,U,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const ee of U.geometry)for(const he of iC(ee,Q))this.addFeature(f.id,U,[he],w,l,{},i.availableImages,u,i.brightness);else this.addFeature(f.id,U,U.geometry,w,l,{},i.availableImages,u,i.brightness);i.featureIndex.insert(f,U.geometry,w,C,this.index,$)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,l,u,f,m){for(const{featureId:w,feature:C}of this.features){const M=Mb[C.type]==="Polygon",{geometry:B}=C;if(this.wallMode)for(const U of B)for(const $ of iC(U,M))this.addFeature(w,C,[$],C.index,i,l,u,f,m);else this.addFeature(w,C,B,C.index,i,l,u,f,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,l,u,f,m,w){this.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,this.worldview),this.groundEffect.update(e,i,f,l,u,m,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O6),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,R6.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,k6.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,I6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,u,f,m,w,C,M){const B=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,U=[new Kt(0,0),new Kt(hn,hn)],$=C.projection,Q=$.name==="globe",ee=this.wallMode||Mb[i.type]==="Polygon",he=new lC;he.centroidDataIndex=this.centroidData.length;const _e=new aC;_e.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(_e.buildingId=i.properties.building_id);const ve=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,De=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let ke;if(_e.height=De,_e.vertexArrayOffset=this.layoutVertexArray.length,_e.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Q&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fp),this.wallMode){if(Q)return void Vr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;ke=(function(vt){const $t=vt[0].x===vt[vt.length-1].x&&vt[0].y===vt[vt.length-1].y;(function(mn){let Wn=0;const pr=mn.length;for(let bn=0;bn<pr;bn++)Wn+=(mn[(bn+1)%pr].x-mn[bn].x)*(mn[(bn+1)%pr].y+mn[bn].y);return Wn>=0})(vt)||(vt=vt.reverse());const qt={geometry:[],joinNormals:[],indices:[]},Jt=[],on=[],Bt=[];let Qt=vt.length;for(;Qt>=2&&vt[Qt-1].equals(vt[Qt-2]);)Qt--;if(Qt<($t?3:2))return qt;let Dt,Et,an,rn,Xn,Rn=0;for(;Rn<Qt-1&&vt[Rn].equals(vt[Rn+1]);)Rn++;$t&&(Dt=vt[Qt-2],Xn=vt[Rn].sub(Dt)._unit()._perp());for(let mn=Rn;mn<Qt;mn++){if(an=mn===Qt-1?$t?vt[Rn+1]:void 0:vt[mn+1],an&&vt[mn].equals(an))continue;Xn&&(rn=Xn),Dt&&(Et=Dt),Dt=vt[mn],Xn=an?an.sub(Dt)._unit()._perp():rn,rn=rn||Xn;let Wn=rn.add(Xn);Wn.x===0&&Wn.y===0||Wn._unit();const pr=Wn.x*Xn.x+Wn.y*Xn.y,bn=pr!==0?1/pr:1/0,Hn=rn.x*Xn.y-rn.y*Xn.x>0;let cr="miter";const xr=2;cr==="miter"&&bn>xr&&(cr="bevel"),cr==="bevel"&&(bn>100&&(cr="flipbevel"),bn<xr&&(cr="miter"));const kr=(Cr,Ln,Sr,Kr)=>{const Ne=new Kt(Cr.x,Cr.y),Ve=new Kt(Cr.x,Cr.y);Ne.x+=Ln.x*Kr,Ne.y+=Ln.y*Kr,Ve.x-=Ln.x*Math.max(Sr,1),Ve.y-=Ln.y*Math.max(Sr,1),Bt.push(Ln),Jt.push(Ne),on.push(Ve)};if(cr==="miter")Wn._mult(bn),kr(Dt,Wn,0,0);else if(cr==="flipbevel")Wn=Xn.mult(-1),kr(Dt,Wn,0,0),kr(Dt,Wn.mult(-1),0,0);else{const Cr=-Math.sqrt(bn*bn-1),Ln=Hn?Cr:0,Sr=Hn?0:Cr;Et&&kr(Dt,rn,Ln,Sr),an&&kr(Dt,Xn,Ln,Sr)}}qt.geometry=[...Jt,...on.reverse(),Jt[0]],qt.joinNormals=[...Bt,...Bt.reverse(),Bt[Bt.length-1]];const Un=qt.geometry.length-1;for(let mn=0;mn<Un/2;mn++)if(mn+1<Un/2){let Wn=mn,pr=mn+1,bn=Un-1-mn,Hn=Un-2-mn;Wn=Wn===0?Un-1:Wn-1,pr=pr===0?Un-1:pr-1,bn=bn===0?Un-1:bn-1,Hn=Hn===0?Un-1:Hn-1,qt.indices.push(bn),qt.indices.push(pr),qt.indices.push(Wn),qt.indices.push(bn),qt.indices.push(Hn),qt.indices.push(pr)}return qt})(l[0]),l=[ke.geometry]}const ze=(vt,$t)=>vt<($t.length-1)/2||vt===$t.length-1,Je=this.wallMode?[l]:F_(l,500);for(let vt=Je.length-1;vt>=0;vt--){const $t=Je[vt];($t.length===0||(Qe=$t[0]).every((tn=>tn.x<=0))||Qe.every((tn=>tn.x>=hn))||Qe.every((tn=>tn.y<=0))||Qe.every((tn=>tn.y>=hn)))&&Je.splice(vt,1)}var Qe;let st;if(Q)st=gC(Je,U,f);else{st=[];for(const vt of Je)st.push({polygon:vt,bounds:U})}const lt=ee?this.edgeRadius:0,ft=lt>0&&this.zoom<17,Ut=(vt,$t)=>{if(vt.length===0)return!1;const tn=vt[vt.length-1];return $t.x===tn.x&&$t.y===tn.y};for(const{polygon:vt,bounds:$t}of st){let tn=0,qt=0;for(const Qt of vt)ee&&!Qt[0].equals(Qt[Qt.length-1])&&Qt.push(Qt[0]),qt+=ee?Qt.length-1:Qt.length;const Jt=this.segments.prepareSegment((ee?5:4)*qt,this.layoutVertexArray,this.indexArray);_e.footprintSegIdx<0&&(_e.footprintSegIdx=this.footprintSegments.length),_e.polygonSegIdx<0&&(_e.polygonSegIdx=this.polygonSegments.length);const on={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Bt=new sC;if(Bt.vertexOffset=this.footprintVertices.length,Bt.indexOffset=3*this.footprintIndices.length,Bt.ringIndices=[],ee){const Qt=[],Dt=[];tn=Jt.vertexLength;for(let an=0;an<vt.length;an++){const rn=vt[an];rn.length&&an!==0&&Dt.push(Qt.length/2);const Xn=[];let Rn,Un;Rn=rn[1].sub(rn[0])._perp()._unit(),Bt.ringIndices.push(rn.length-1);for(let mn=1;mn<rn.length;mn++){const Wn=rn[mn],pr=rn[mn===rn.length-1?1:mn+1],bn=Wn.clone();if(lt){Un=pr.sub(Wn)._perp()._unit();const Hn=Rn.add(Un)._unit(),cr=lt*Math.min(4,1/(Rn.x*Hn.x+Rn.y*Hn.y));bn.x+=cr*Hn.x,bn.y+=cr*Hn.y,bn.x=Math.round(bn.x),bn.y=Math.round(bn.y),Rn=Un}if(!ve||lt!==0&&!ft||Ut(Xn,bn)||Xn.push(bn),N_(this.layoutVertexArray,bn.x,bn.y,0,0,1,1,0),this.wallMode){const Hn=ze(mn,rn);V_(this.wallVertexArray,ke.joinNormals[mn],!Hn)}Jt.vertexLength++,this.footprintVertices.emplaceBack(Wn.x,Wn.y),Qt.push(Wn.x,Wn.y),Q&&U_(this.layoutVertexExtArray,$.projectTilePoint(bn.x,bn.y,f),$.upVector(f,bn.x,bn.y))}ve&&(lt===0||ft)&&(Xn.length!==0&&Ut(Xn,Xn[0])&&Xn.pop(),this.groundEffect.addData(Xn,$t,B))}const Et=this.wallMode?ke.indices:bg(Qt,Dt);for(let an=0;an<Et.length;an+=3)this.footprintIndices.emplaceBack(Bt.vertexOffset+Et[an+0],Bt.vertexOffset+Et[an+1],Bt.vertexOffset+Et[an+2]),this.indexArray.emplaceBack(tn+Et[an],tn+Et[an+2],tn+Et[an+1]),Jt.primitiveLength++;Bt.indexCount+=Et.length,Bt.vertexCount+=this.footprintVertices.length-Bt.vertexOffset}for(let Qt=0;Qt<vt.length;Qt++){const Dt=vt[Qt];he.startRing(_e,Dt[0]);let Et=Dt.length>4&&fC(Dt[Dt.length-2],Dt[0],Dt[1]),an=lt?j6(Dt[Dt.length-2],Dt[0],Dt[1],lt):0;const rn=[];let Xn,Rn,Un;Rn=Dt[1].sub(Dt[0])._perp()._unit();let mn=!0;for(let Wn=1,pr=0;Wn<Dt.length;Wn++){let bn=Dt[Wn-1],Hn=Dt[Wn];const cr=Dt[Wn===Dt.length-1?1:Wn+1];if(he.appendEdge(_e,Hn,bn),Rb(Hn,bn,$t)){lt&&(Rn=cr.sub(Hn)._perp()._unit(),mn=!mn);continue}const xr=Hn.sub(bn)._perp(),kr=xr.x/(Math.abs(xr.x)+Math.abs(xr.y)),Cr=xr.y>0?1:0,Ln=bn.dist(Hn);if(pr+Ln>32768&&(pr=0),lt){Un=cr.sub(Hn)._perp()._unit();let Ve=dC(bn,Hn,cr,uC(Rn,Un),lt);isNaN(Ve)&&(Ve=0);const Mt=Hn.sub(bn)._unit();bn=bn.add(Mt.mult(an))._round(),Hn=Hn.add(Mt.mult(-Ve))._round(),an=Ve,Rn=Un,ve&&this.zoom>=17&&(Ut(rn,bn)||rn.push(bn),Ut(rn,Hn)||rn.push(Hn))}const Sr=Jt.vertexLength,Kr=Dt.length>4&&fC(bn,Hn,cr);let Ne=pC(pr,Et,mn);if(N_(this.layoutVertexArray,bn.x,bn.y,kr,Cr,0,0,Ne),N_(this.layoutVertexArray,bn.x,bn.y,kr,Cr,0,1,Ne),this.wallMode){const Ve=ze(Wn-1,Dt),Mt=ke.joinNormals[Wn-1];V_(this.wallVertexArray,Mt,Ve),V_(this.wallVertexArray,Mt,Ve)}if(pr+=Ln,Ne=pC(pr,Kr,!mn),Et=Kr,N_(this.layoutVertexArray,Hn.x,Hn.y,kr,Cr,0,0,Ne),N_(this.layoutVertexArray,Hn.x,Hn.y,kr,Cr,0,1,Ne),this.wallMode){const Ve=ze(Wn,Dt),Mt=ke.joinNormals[Wn];V_(this.wallVertexArray,Mt,Ve),V_(this.wallVertexArray,Mt,Ve)}if(Jt.vertexLength+=4,this.indexArray.emplaceBack(Sr+0,Sr+1,Sr+2),this.indexArray.emplaceBack(Sr+1,Sr+3,Sr+2),Jt.primitiveLength+=2,lt){const Ve=tn+(Wn===1?Dt.length-2:Wn-2),Mt=Wn===1?tn:Ve+1;if(this.indexArray.emplaceBack(Sr+1,Ve,Sr+3),this.indexArray.emplaceBack(Ve,Mt,Sr+3),Jt.primitiveLength+=2,Xn===void 0&&(Xn=Sr),!Rb(cr,Dt[Wn],$t)){const Vt=Wn===Dt.length-1?Xn:Jt.vertexLength;this.indexArray.emplaceBack(Sr+2,Sr+3,Vt),this.indexArray.emplaceBack(Sr+3,Vt+1,Vt),this.indexArray.emplaceBack(Sr+3,Mt,Vt+1),Jt.primitiveLength+=3}mn=!mn}if(Q){const Ve=this.layoutVertexExtArray,Mt=$.projectTilePoint(bn.x,bn.y,f),Vt=$.projectTilePoint(Hn.x,Hn.y,f),xn=$.upVector(f,bn.x,bn.y),vn=$.upVector(f,Hn.x,Hn.y);U_(Ve,Mt,xn),U_(Ve,Mt,xn),U_(Ve,Vt,vn),U_(Ve,Vt,vn)}}ee&&(tn+=Dt.length-1),ve&&lt&&this.zoom>=17&&(rn.length!==0&&Ut(rn,rn[0])&&rn.pop(),this.groundEffect.addData(rn,$t,B,lt>0))}this.footprintSegments.push(Bt),on.triangleCount=this.indexArray.length-on.triangleArrayOffset,this.polygonSegments.push(on),++_e.footprintSegLen,++_e.polygonSegLen}if(_e.vertexCount=this.layoutVertexArray.length-_e.vertexArrayOffset,_e.groundVertexCount=this.groundEffect.vertexArray.length-_e.groundVertexArrayOffset,_e.vertexCount!==0){if(_e.centroidXY=he.borders?oC:this.encodeCentroid(he,_e),this.centroidData.push(_e),he.borders){this.featuresOnBorder.push(he);const vt=this.featuresOnBorder.length-1;for(let $t=0;$t<he.borders.length;$t++)he.borders[$t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$t].push(vt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,m,w,f,M,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,u,m,w,f,M,this.worldview),this.maxHeight=Math.max(this.maxHeight,De)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0]))}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const C=this.centroidData[w],M=+(C.min.y+C.max.y>hn),B=2*M+(+(C.min.x+C.max.x>hn)^M);for(let U=0;U<C.polygonSegLen;U++){const $=C.polygonSegIdx+U;e.push({centroidIdx:w,subtile:B,polygonSegmentIdx:$,triangleSegmentIdx:this.polygonSegments[$].triangleSegIdx})}}const i=new Fo;e.sort(((w,C)=>w.triangleSegmentIdx===C.triangleSegmentIdx?w.subtile-C.subtile:w.triangleSegmentIdx-C.triangleSegmentIdx));let l=0,u=0,f=0;for(const w of e){if(w.triangleSegmentIdx!==l)break;f++}const m=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let w=0,C=u,M=u;for(let B=C;B<f&&e[B].subtile===w;B++)M++;for(;C!==f;){const B=e[C];w=B.subtile;const U=this.centroidData[B.centroidIdx].min.clone(),$=this.centroidData[B.centroidIdx].max.clone(),Q={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let ee=C;ee<M;ee++){const he=e[ee],_e=this.polygonSegments[he.polygonSegmentIdx],ve=this.centroidData[he.centroidIdx].min,De=this.centroidData[he.centroidIdx].max,ke=this.indexArray.uint16;for(let ze=_e.triangleArrayOffset;ze<_e.triangleArrayOffset+_e.triangleCount;ze++)i.emplaceBack(ke[3*ze],ke[3*ze+1],ke[3*ze+2]);Q.primitiveLength+=_e.triangleCount,U.x=Math.min(U.x,ve.x),U.y=Math.min(U.y,ve.y),$.x=Math.max($.x,De.x),$.y=Math.max($.y,De.y)}Q.primitiveLength>0&&this.triangleSubSegments.push({segment:Q,min:U,max:$}),C=M;for(let ee=C;ee<f&&e[ee].subtile===e[C].subtile;ee++)M++}u=f;for(let B=u;B<m&&e[B].triangleSegmentIdx===e[u].triangleSegmentIdx;B++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,l){const u=new Pi;if(this.wallMode){for(const he of this.triangleSubSegments)u.segments.push(he.segment);return u}let f=0,m=0;const w=1<<e.canonical.z;if(i){const he=i.getMinMaxForTile(e);he&&(f=he.min,m=he.max)}m+=this.maxHeight;const C=e.toUnwrapped();let M;const B=[C.canonical.x/w+C.wrap,C.canonical.y/w],U=[(C.canonical.x+1)/w+C.wrap,(C.canonical.y+1)/w],$=(he,_e,ve)=>[he[0]*(1-ve[0])+_e[0]*ve[0],he[1]*(1-ve[1])+_e[1]*ve[1]],Q=[],ee=[];for(const he of this.triangleSubSegments){Q[0]=he.min.x/hn,Q[1]=he.min.y/hn,ee[0]=he.max.x/hn,ee[1]=he.max.y/hn;const _e=$(B,U,Q),ve=$(B,U,ee);if(new Fn([_e[0],_e[1],f],[ve[0],ve[1],m]).intersectsPrecise(l)===0){M&&(u.segments.push(M),M=void 0);continue}const De=he.segment;M&&M.vertexOffset!==De.vertexOffset&&(u.segments.push(M),M=void 0),M?(M.vertexLength+=De.vertexLength,M.primitiveLength+=De.primitiveLength):M={vertexOffset:De.vertexOffset,primitiveLength:De.primitiveLength,vertexLength:De.vertexLength,primitiveOffset:De.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&u.segments.push(M),u}encodeCentroid(e,i){const l=e.centroid(),u=i.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Kt(et(l.x,1,hn-1)<<3|f,et(l.y,1,hn-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Kt(0,0);const i=e.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const u=i[0][0]!==l?0:1;return new Kt(6|(i[0][0]!==l?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==l?2:3;return new Kt((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Tp?oC:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||f!==u.x){for(let m=i;m<l;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(xv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const f=[];for(const m of this.activeReplacements){if(m.order<l)continue;const w=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingId){const C=m.footprint.buildingId;for(const M of this.centroidData)M.buildingId===C&&(M.flags|=Tp)}else for(const C of this.centroidData)if(!(C.flags&Tp||m.min.x>C.max.x||C.min.x>m.max.x||m.min.y>C.max.y||C.min.y>m.max.y))for(let M=0;M<C.footprintSegLen;M++){const B=this.footprintSegments[C.footprintSegIdx+M];if(f.length=0,G6(this.footprintVertices,B.vertexOffset,B.vertexCount,m.footprintTileId.canonical,e.canonical,f),Eb(m.footprint,f,this.footprintIndices.uint16,B.indexOffset,B.indexCount,-B.vertexOffset,-w)){C.flags|=Tp;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,l){let u=!1;for(let f=0;f<l.footprintSegLen;f++){const m=this.footprintSegments[l.footprintSegIdx+f];let w=0;for(const C of m.ringIndices){for(let M=w,B=C+w-1;M<C+w;B=M++){const U=this.footprintVertices.int16[2*(M+m.vertexOffset)+0],$=this.footprintVertices.int16[2*(M+m.vertexOffset)+1],Q=this.footprintVertices.int16[2*(B+m.vertexOffset)+1];$>i!=Q>i&&e<(this.footprintVertices.int16[2*(B+m.vertexOffset)+0]-U)*(i-$)/(Q-$)+U&&(u=!u)}w=C}}return u}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+hn)*hn+(i+hn);if(this.partLookup.hasOwnProperty(f)){const m=this.partLookup[f];return m?{height:m.height,hidden:!!(m.flags&Tp)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||m.height<=l||this.footprintContainsPoint(e,i,m)&&(l=m.height,this.partLookup[f]=m,u=!!(m.flags&Tp));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[f]=void 0}}function uC(o,e){const i=o.add(e)._unit();return o.x*i.x+o.y*i.y}function j6(o,e,i,l){const u=e.sub(o)._perp()._unit(),f=i.sub(e)._perp()._unit();return dC(o,e,i,uC(u,f),l)}function dC(o,e,i,l,u){const f=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(i)/3,u*f/l)}function Rb(o,e,i){return o.x<i[0].x&&e.x<i[0].x||o.x>i[1].x&&e.x>i[1].x||o.y<i[0].y&&e.y<i[0].y||o.y>i[1].y&&e.y>i[1].y}function hC(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function fC(o,e,i){if(o.x<0||o.x>=hn||e.x<0||e.x>=hn||i.x<0||i.x>=hn)return!1;const l=i.sub(e),u=l.perp(),f=o.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function pC(o,e,i){const l=e?2|o:-3&o;return i?1|l:-2&l}function mC(){const o=Math.PI/32,e=Math.tan(o),i=re;return i*Math.sqrt(1+2*e*e)-i}function gC(o,e,i){const l=1<<i.z,u=Ye(i.x/l),f=Ye((i.x+1)/l),m=qe(i.y/l),w=qe((i.y+1)/l);return(function(C,M,B,U,$=0,Q){const ee=[];if(!C.length||!B||!U)return ee;const he=(Qe,st)=>{for(const lt of Qe)ee.push({polygon:lt,bounds:st})},_e=Math.ceil(Math.log2(B)),ve=Math.ceil(Math.log2(U)),De=_e-ve,ke=[];for(let Qe=0;Qe<Math.abs(De);Qe++)ke.push(De>0?0:1);for(let Qe=0;Qe<Math.min(_e,ve);Qe++)ke.push(0),ke.push(1);let ze=C;if(ze=_v(ze,M[0].y-$,M[1].y+$,1),ze=_v(ze,M[0].x-$,M[1].x+$,0),!ze.length)return ee;const Je=[];for(ke.length?Je.push({polygons:ze,bounds:M,depth:0}):he(ze,M);Je.length;){const Qe=Je.pop(),st=Qe.depth,lt=ke[st],ft=Qe.bounds[0],Ut=Qe.bounds[1],vt=lt===0?ft.x:ft.y,$t=lt===0?Ut.x:Ut.y,tn=Q?Q(lt,vt,$t):.5*(vt+$t),qt=_v(Qe.polygons,vt-$,tn+$,lt),Jt=_v(Qe.polygons,tn-$,$t+$,lt);if(qt.length){const on=[ft,new Kt(lt===0?tn:Ut.x,lt===1?tn:Ut.y)];ke.length>st+1?Je.push({polygons:qt,bounds:on,depth:st+1}):he(qt,on)}if(Jt.length){const on=[new Kt(lt===0?tn:ft.x,lt===1?tn:ft.y),Ut];ke.length>st+1?Je.push({polygons:Jt,bounds:on,depth:st+1}):he(Jt,on)}}return ee})(o,e,Math.ceil((f-u)/11.25),Math.ceil((m-w)/11.25),1,((C,M,B)=>{if(C===0)return .5*(M+B);{const U=qe((i.y+M/hn)/l);return(Ze(.5*(qe((i.y+B/hn)/l)+U))*l-i.y)*hn}}))}function G6(o,e,i,l,u,f){const m=Math.pow(2,l.z-u.z);for(let w=0;w<i;w++){let C=o.int16[2*(w+e)+0],M=o.int16[2*(w+e)+1];C=(C+u.x*hn)*m-l.x*hn,M=(M+u.y*hn)*m-l.y*hn,f.push(new Kt(C,M))}}let _C,yC;In(wv,"FillExtrusionBucket",{omit:["layers","features"]}),In(aC,"PartData"),In(sC,"FootprintSegment"),In(lC,"BorderCentroidData"),In(Ib,"GroundEffect");class Tm extends Kt{constructor(e,i,l){super(e,i),this.z=l}}class vC extends Tm{constructor(e,i,l,u){super(e,i,l),this.w=u}}function xC(o,e,i,l){const u=i==="x"?"y":"x",f=(l-o[i])/(e[i]-o[i]);o[u]=Math.round(o[u]+(e[u]-o[u])*f),o[i]=l,o.hasOwnProperty("z")&&(o.z=Qn(o.z,e.z,f)),o.hasOwnProperty("w")&&(o.w=Qn(o.w,e.w,f))}function bC(o,e,i,l){const u=i,f=l;for(const m of["x","y"]){let w=o,C=e;w[m]>=C[m]&&(w=e,C=o),w[m]<u&&C[m]>u&&xC(w,C,m,u),w[m]<f&&C[m]>f&&xC(C,w,m,f)}}function Sv(o,e,i,l,u,f){const m=[];for(let w=0;w<o.length;w++){const C=o[w];let M;const B=m.length;let U=0;for(let $=0;$<C.length-1;$++){let Q=C[$],ee=C[$+1],he=0;const _e=U;let ve,De;f&&(he=Math.hypot(ee.x-Q.x,ee.y-Q.y),U+=he,ve=Q,De=ee),Q.x<e&&ee.x<e||(Q.x<e?Q=new Kt(e,Q.y+(e-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round():ee.x<e&&(ee=new Kt(e,Q.y+(e-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round()),Q.y<i&&ee.y<i||(Q.y<i?Q=new Kt(Q.x+(i-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),i)._round():ee.y<i&&(ee=new Kt(Q.x+(i-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),i)._round()),Q.x>=l&&ee.x>=l||(Q.x>=l?Q=new Kt(l,Q.y+(l-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round():ee.x>=l&&(ee=new Kt(l,Q.y+(l-Q.x)/(ee.x-Q.x)*(ee.y-Q.y))._round()),Q.y>=u&&ee.y>=u||(Q.y>=u?Q=new Kt(Q.x+(u-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),u)._round():ee.y>=u&&(ee=new Kt(Q.x+(u-Q.y)/(ee.y-Q.y)*(ee.x-Q.x),u)._round()),M&&Q.equals(M[M.length-1])||(M=[Q],m.push(M),f&&f.push({progress:{min:_e+wC(ve,De,Q)*he,max:1},parentIndex:w,prevPoint:ve,nextPoint:De})),M.push(ee),f&&(f[f.length-1].progress.max=_e+wC(ve,De,ee)*he,f[f.length-1].nextPoint=De)))))}if(f&&U>0)for(let $=B;$<m.length;$++)f[$].progress.min/=U,f[$].progress.max/=U}return m}function $6(o,e,i,l,u){if(o.length<2)return void l.push(o);const f=[];for(;e.valid();){const[M,B]=e.get();for(let U=0;U<o.length-1;U++){const $=o[U],Q=o[U+1],ee=vi($,Q,M,B);if(ee){const[he]=ee,_e=new Kt(Qn($.x,Q.x,he),Qn($.y,Q.y,he));f.push({t:U+he,distance:0,point:_e})}}e.next()}if(f.length===0)return void l.push(o);f.sort(((M,B)=>M.t-B.t));let m=0,w=0,C=[];for(l.push(C);m!==o.length;){if(w===f.length){for(;m!==o.length;)C.length!==0&&C[C.length-1].equals(o[m])||C.push(o[m]),m++;break}f[w].t<=m?(C.length!==0&&C[C.length-1].equals(f[w].point)||C.push(f[w].point),Math.trunc(f[w].t),w++):(C.length!==0&&C[C.length-1].equals(o[m])||C.push(o[m]),m++)}}function wC(o,e,i){return o.x!==e.x?(i.x-o.x)/(e.x-o.x):o.y!==e.y?(i.y-o.y)/(e.y-o.y):0}function j_(o,e){return o.x*e.x+o.y*e.y}function SC(o,e){if(o.length===1){let i=0;const l=e[i++];let u;for(;!u||l.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],m=o[0],w=u.sub(l),C=f.sub(l),M=m.sub(l),B=j_(w,w),U=j_(w,C),$=j_(C,C),Q=j_(M,w),ee=j_(M,C),he=B*$-U*U,_e=($*Q-U*ee)/he,ve=(B*ee-U*Q)/he,De=l.z*(1-_e-ve)+u.z*_e+f.z*ve;if(isFinite(De))return De}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function TC(o,e,i,l,u,f,m,w){const C=m*u.getElevationAt(o,e,!0,!0),M=f[0]!==0,B=M?f[1]===0?m*(f[0]/7-450):m*(function(U,$,Q){const ee=Math.floor($[0]/8),he=Math.floor($[1]/8),_e=10*($[0]-8*ee),ve=10*($[1]-8*he),De=U.getElevationAt(ee,he,!0,!0),ke=U.getMeterToDEM(Q),ze=Math.floor(.5*(_e*ke-1)),Je=Math.floor(.5*(ve*ke-1)),Qe=U.tileCoordToPixel(ee,he),st=2*ze+1,lt=2*Je+1,ft=(function(Jt,on,Bt,Qt,Dt){return[Jt.getElevationAtPixel(on,Bt,!0),Jt.getElevationAtPixel(on+Dt,Bt,!0),Jt.getElevationAtPixel(on,Bt+Dt,!0),Jt.getElevationAtPixel(on+Qt,Bt+Dt,!0)]})(U,Qe.x-ze,Qe.y-Je,st,lt),Ut=Math.abs(ft[0]-ft[1]),vt=Math.abs(ft[2]-ft[3]),$t=Math.abs(ft[0]-ft[2])+Math.abs(ft[1]-ft[3]),tn=Math.min(.25,.5*ke*(Ut+vt)/st),qt=Math.min(.25,.5*ke*$t/lt);return De+Math.max(tn*_e,qt*ve)})(u,f,w):C;return{base:C+(i===0?-1:i),top:M?Math.max(B+l,C+i+2):C+l}}class H6{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class q6{constructor(){this.tasks={},this.taskQueue=[],lr(["process"],this),this.invoker=new H6(this.process),this.nextId=0}add(e,i){const l=this.nextId++,u=(function({type:f,isSymbolTile:m,zoom:w}){return w=w||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-w:f==="maybePrepare"&&m?400-w:500:200-w:100-w})(i);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:i,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((l=>!!this.tasks[l])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class CC{constructor(e,i,l){this.target=e,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},lr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new q6}send(e,i,l,u,f=!1,m){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=m,this.callbacks[w]=l);const C=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Ec(i,C)},C),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(i.mustQueue||bi(self)){const u=this.callbacks[l],f=this.scheduler.add((()=>this.processTask(l,i)),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(i.error?l(eu(i.error)):l(null,eu(i.data)))}else{const l=new Set,u=i.hasCallback?(m,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Ec(m):null,data:Ec(w,l)},l)}:()=>{},f=eu(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,u);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:w,scope:C}=f;this.parent.getWorkerSource(i.sourceMapId,m[0],w,C)[m[1]](f,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var G_={workerUrl:"",workerClass:null,workerParams:void 0};const Db="mapboxgl_preloaded_worker_pool";class Cm{constructor(){this.active={}}acquire(e,i=Cm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(G_.workerClass!=null?new G_.workerClass:new self.Worker(G_.workerUrl,G_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Db]}numActive(){return Object.keys(this.active).length}}Cm.workerCount=2;class Sg{constructor(e,i,l="Worker",u=Cm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Wt();const f=this.workerPool.acquire(this.id,u);for(let m=0;m<f.length;m++){const w=new Sg.Actor(f[m],i,this.id);w.name=`${l} ${m}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,l){Rt(this.actors,((u,f)=>{u.send(e,i,f)}),l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let $_,kb;function Tv(){return $_||($_=new Cm),$_}Sg.Actor=CC;class W6{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,l/i.BYTES_PER_ELEMENT),l}createFloatArray(e){const i=new Float32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,l/i.BYTES_PER_ELEMENT),l}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[i+l]=e.charCodeAt(l);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,l=e.facadeGlazingColorRgb,u=e.roofColorRgb,f=e.wallColorRgb,m=e.normalScale;this.module.setStyle(i[0],i[1],i[2],l[0],l[1],l[2],u[0],u[1],u[2],f[0],f[1],f[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,l){this.module.setFauxFacadeOptions(e?1:0,i?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const w of e){const C=this.createStringBuffer(w.roofType),M=[0],B=[];for(const Q of w.coordinates)if(Array.isArray(Q)){for(const ee of Q)B.push(ee.x),B.push(ee.y);M.push(B.length)}const U=this.createIntArray(M),$=this.createFloatArray(B);this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,C,w.roofType.length,$,U,M.length-1),this.module.free(C),this.module.free(U),this.module.free($)}for(const w of i){let C;C=w.entrances?JSON.parse(w.entrances):[];const M=this.createFloatArray(C),B=[];for(const $ of w.coordinates)B.push($.x),B.push($.y);const U=this.createFloatArray(B);this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,M,C.length,U,B.length),this.module.free(M),this.module.free(U)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const l=this.module.getMeshCount(),u=new Array(l);for(let w=0;w<l;w++){const C=this.module.getPositionsPtr(w),M=this.module.getPositionsLength(w),B=new Float32Array(this.module.heapF32.buffer,C,M),U=this.module.getNormalsPtr(w),$=this.module.getNormalsLength(w),Q=new Float32Array(this.module.heapF32.buffer,U,$),ee=this.module.getColorsPtr(w),he=this.module.getColorsLength(w),_e=new Uint8Array(this.module.heapU8.buffer,ee,he),ve=this.module.getAOPtr(w),De=this.module.getAOLength(w),ke=new Float32Array(this.module.heapF32.buffer,ve,De),ze=this.module.getUVPtr(w),Je=this.module.getUVLength(w),Qe=new Float32Array(this.module.heapF32.buffer,ze,Je),st=this.module.getFauxFacadePtr(w),lt=this.module.getFauxFacadeLength(w),ft=new Uint8Array(this.module.heapU8.buffer,st,lt),Ut=this.module.getIndicesPtr(w),vt=this.module.getIndicesLength(w),$t=new Int32Array(this.module.heap32.buffer,Ut,vt),tn=this.module.getBuildingPart(w),qt=this.readStringBuffer(tn);u[w]={positions:B,normals:Q,colors:_e,ao:ke,uv:Qe,isFauxFacade:ft,indices:$t,buildingPart:qt}}const f=this.module.getRingCount(),m=[];for(let w=0;w<f;w++){const C=this.module.getRingPtr(w),M=this.module.getRingLength(w),B=new Float32Array(this.module.heapF32.buffer,C,M);m.push(B)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let H_,Ob,nd,Tg,Lb,Cg=null,Eg=null,EC=null,Cv=null;function AC(){return bi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Ob||Oo.DRACO_URL}function PC(){if(bi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Tg)return Tg;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Tg=WebAssembly.validate(o)?Oo.MESHOPT_SIMD_URL:Oo.MESHOPT_URL,Tg}function Z6(){return Cv}const Ev={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Y6={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},q_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function MC(o,e,i){const l=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=l,i.json.bufferViews[l]={buffer:u,byteLength:o.byteLength},i.buffers[u]=o}const zb="KHR_draco_mesh_compression";function X6(o,e){const i=o.extensions&&o.extensions[zb];if(!i)return;const l=new nd.Decoder,u=kC(e,i.bufferView),f=new nd.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[o.indices],w=Ev[m.componentType],C=m.count*w.BYTES_PER_ELEMENT,M=nd._malloc(C);w===Uint16Array?l.GetTrianglesUInt16Array(f,C,M):l.GetTrianglesUInt32Array(f,C,M),MC(nd.memory.buffer.slice(M,M+C),m,e),nd._free(M);for(const B of Object.keys(i.attributes)){const U=l.GetAttributeByUniqueId(f,i.attributes[B]),$=e.json.accessors[o.attributes[B]],Q=Y6[$.componentType],ee=$.count*q_[$.type]*Ev[$.componentType].BYTES_PER_ELEMENT,he=nd._malloc(ee);l.GetAttributeDataArrayForAllPoints(f,U,nd[Q],ee,he),MC(nd.memory.buffer.slice(he,he+ee),$,e),nd._free(he)}l.destroy(),f.destroy(),delete o.extensions[zb]}const Av="EXT_meshopt_compression";function K6(o,e){if(!o.extensions||!o.extensions[Av])return;const i=o.extensions[Av],l=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);Lb.decodeGltfBuffer(u,i.count,i.byteStride,l,i.mode,i.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[Av]}const IC=1179937895,RC=new TextDecoder("utf8");function DC(o,e){return new URL(o,e).href}function J6(o,e,i,l){return fetch(DC(o.uri,l)).then((u=>u.arrayBuffer())).then((u=>{e.buffers[i]=u}))}function kC(o,e){const i=o.json.bufferViews[e];return new Uint8Array(o.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Q6(o,e,i,l){if(o.uri){const u=DC(o.uri,l);return fetch(u).then((f=>f.blob())).then((f=>createImageBitmap(f))).then((f=>{e.images[i]=f}))}if(o.bufferView!==void 0){const u=kC(e,o.bufferView),f=new Blob([u],{type:o.mimeType});return createImageBitmap(f).then((m=>{e.images[i]=m}))}}function OC(o,e=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===IC){const B=new Uint32Array(o,e);let U=2;const $=(B[U++]>>2)-3,Q=B[U++]>>2;if(U++,l.json=JSON.parse(RC.decode(B.subarray(U,U+Q))),U+=Q,U<$){const ee=B[U++];U++;const he=e+(U<<2);l.buffers[0]=o.slice(he,he+ee)}}else l.json=JSON.parse(RC.decode(new Uint8Array(o,e)));const{buffers:u,images:f,meshes:m,extensionsUsed:w,bufferViews:C}=l.json;let M=Promise.resolve();if(u){const B=[];for(let U=0;U<u.length;U++){const $=u[U];$.uri?B.push(J6($,l,U,i)):l.buffers[U]||(l.buffers[U]=null)}M=Promise.all(B)}return M.then((()=>{const B=[],U=w&&w.includes(zb),$=w&&w.includes(Av);if(U&&B.push((function(){if(!nd)return H_??(H_=(function(Q){let ee,he=null;function _e(){ee=new Uint8Array(he.buffer)}function ve(){throw new Error("Unexpected Draco error.")}const De={a:{a:ve,d:function(ke,ze,Je){return ee.copyWithin(ke,ze,ze+Je)},c:function(ke){const ze=ee.length,Je=Math.max(ke>>>0,Math.ceil(1.2*ze)),Qe=Math.ceil((Je-ze)/65536);try{return he.grow(Qe),_e(),!0}catch{return!1}},b:ve}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Q,De):Q.then((ke=>ke.arrayBuffer())).then((ke=>WebAssembly.instantiate(ke,De)))).then((ke=>{const{Rb:ze,Qb:Je,P:Qe,T:st,X:lt,Ja:ft,La:Ut,Qa:vt,Va:$t,Wa:tn,eb:qt,jb:Jt,f:on,e:Bt,yb:Qt,zb:Dt,Ab:Et,Bb:an,Db:rn,Gb:Xn}=ke.instance.exports;he=Bt;const Rn=(()=>{let Un=0,mn=0,Wn=0,pr=0;return bn=>{Wn&&(ze(pr),ze(Un),mn+=Wn,Wn=Un=0),Un||(mn+=128,Un=Je(mn));const Hn=bn.length+7&-8;let cr=Un;Hn>=mn&&(Wn=Hn,cr=pr=Je(Hn));for(let xr=0;xr<bn.length;xr++)ee[cr+xr]=bn[xr];return cr}})();return _e(),on(),{memory:Bt,_free:ze,_malloc:Je,Mesh:class{constructor(){this.ptr=Qe()}destroy(){st(this.ptr)}},Decoder:class{constructor(){this.ptr=ft()}destroy(){Jt(this.ptr)}DecodeArrayToMesh(Un,mn,Wn){const pr=Rn(Un),bn=Ut(this.ptr,pr,mn,Wn.ptr);return!!lt(bn)}GetAttributeByUniqueId(Un,mn){return{ptr:vt(this.ptr,Un.ptr,mn)}}GetTrianglesUInt16Array(Un,mn,Wn){$t(this.ptr,Un.ptr,mn,Wn)}GetTrianglesUInt32Array(Un,mn,Wn){tn(this.ptr,Un.ptr,mn,Wn)}GetAttributeDataArrayForAllPoints(Un,mn,Wn,pr,bn){qt(this.ptr,Un.ptr,mn.ptr,Wn,pr,bn)}},DT_INT8:Qt(),DT_UINT8:Dt(),DT_INT16:Et(),DT_UINT16:an(),DT_UINT32:rn(),DT_FLOAT32:Xn()}}))})(fetch(AC())),H_.then((Q=>{nd=Q,H_=void 0})))})()),$&&B.push((function(){if(Lb)return;const Q=(function(ee){let he;const _e=WebAssembly.instantiateStreaming(ee,{}).then((ke=>{he=ke.instance,he.exports.__wasm_call_ctors()})),ve={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},De={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:_e,supported:!0,decodeGltfBuffer(ke,ze,Je,Qe,st,lt){(function(ft,Ut,vt,$t,tn,qt,Jt){const on=ft.exports.sbrk,Bt=$t+3&-4,Qt=on(Bt*tn),Dt=on(qt.length),Et=new Uint8Array(ft.exports.memory.buffer);Et.set(qt,Dt);const an=Ut(Qt,$t,tn,Dt,qt.length);if(an===0&&Jt&&Jt(Qt,Bt,tn),vt.set(Et.subarray(Qt,Qt+$t*tn)),on(Qt-on(0)),an!==0)throw new Error(`Malformed buffer data: ${an}`)})(he,he.exports[De[st]],ke,ze,Je,Qe,he.exports[ve[lt]])}}})(fetch(PC()));return Q.ready.then((()=>{Lb=Q}))})()),f)for(let Q=0;Q<f.length;Q++)B.push(Q6(f[Q],l,Q,i));return(B.length?Promise.all(B):Promise.resolve()).then((()=>{if(U&&m)for(const{primitives:Q}of m)for(const ee of Q)X6(ee,l);if($&&m&&C)for(const Q of C)K6(Q,l);return l}))}))}function Fb(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Bb(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Nb{constructor(e,i,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:m}=f,{x:w,y:C}=i&&i.position?i.position:{x:0,y:0},M=w+l,B=C+u;!this.size||this.size[0]===M&&this.size[1]===B||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const U=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&M>0&&B>0){const $=this.useMipmap?Math.floor(Math.log2(Math.max(M,B)))+1:1;m.texStorage2D(m.TEXTURE_2D,$,this.format,M,B),this.size=[M,B]}this.size&&(U?m.texSubImage2D(m.TEXTURE_2D,0,w,C,Fb(this.format),Bb(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,w,C,l,u,Fb(this.format),Bb(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,l=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,l,u,f){const{context:m}=this,{gl:w}=m;w.bindTexture(w.TEXTURE_2D,this.texture),i!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?e===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,u),this.wrapT=u),f!==this.compareMode&&(f?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,f)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class W_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}const ek=jr([{name:"a_pos_3f",components:3,type:"Float32"}]),tk=jr([{name:"a_color_3f",components:3,type:"Float32"}]),nk=jr([{name:"a_color_4f",components:4,type:"Float32"}]),rk=jr([{name:"a_uv_2f",components:2,type:"Float32"}]),ik=jr([{name:"a_normal_3f",components:3,type:"Float32"}]),ok=jr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sk=jr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function LC(o,e){const i=Pv(o.projection,o.zoom,o.width,o.height),l=(function(f,m,w,C,M){const B=new ce(w.lng-180*Cp,w.lat),U=new ce(w.lng+180*Cp,w.lat),$=f.project(B.lng,B.lat),Q=f.project(U.lng,U.lat),ee=-Math.atan2(Q.y-$.y,Q.x-$.x),he=Pt.fromLngLat(w);he.y=et(he.y,-1+Cp,1-Cp);const _e=he.toLngLat(),ve=f.project(_e.lng,_e.lat),De=Pt.fromLngLat(_e);De.x+=Cp;const ke=De.toLngLat(),ze=f.project(ke.lng,ke.lat),Je=FC(ze.x-ve.x,ze.y-ve.y,ee),Qe=Pt.fromLngLat(_e);Qe.y+=Cp;const st=Qe.toLngLat(),lt=f.project(st.lng,st.lat),ft=FC(lt.x-ve.x,lt.y-ve.y,ee),Ut=Math.abs(Je.x)/Math.abs(ft.y),vt=O([]);se(vt,vt,-ee*(1-(M?0:C)));const $t=O([]);return V($t,$t,[1,1-(1-Ut)*C,1]),$t[4]=-ft.x/ft.y*C,se($t,$t,ee),H($t,vt,$t),$t})(o.projection,0,o.center,i,e),u=zC(o);return V(l,l,[u,u,1]),l}function zC(o){const e=o.projection,i=Pv(o.projection,o.zoom,o.width,o.height),l=Vb(e,o.center),u=Vb(e,ce.convert(e.center));return Math.pow(2,l*i+(1-i)*u)}function Pv(o,e,i,l,u=1/0){const f=o.range;if(!f)return 0;const m=Math.min(u,Math.max(i,l)),w=Math.log2(m/1024);return Ct(f[0]+w,f[1]+w,e)}const Cp=1/4e4;function Vb(o,e){const i=et(e.lat,-Xe,Xe),l=new ce(e.lng-180*Cp,i),u=new ce(e.lng+180*Cp,i),f=o.project(l.lng,i),m=o.project(u.lng,i),w=Pt.fromLngLat(l),C=Pt.fromLngLat(u),M=m.x-f.x,B=m.y-f.y,U=C.x-w.x,$=C.y-w.y,Q=Math.sqrt((U*U+$*$)/(M*M+B*B));return Math.log2(Q)}function FC(o,e,i){const l=Math.cos(i),u=Math.sin(i);return{x:o*l-e*u,y:o*u+e*l}}function BC(o,e,i){O(o),se(o,o,_t(e[2])),Z(o,o,_t(e[0])),X(o,o,_t(e[1])),V(o,o,i),H(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Mv(o,e,i,l,u,f,m,w){const C=[i[0]-e[0],i[1]-e[1],0],M=[l[0]-e[0],l[1]-e[1],0];if(ye(C)<1e-12||ye(M)<1e-12)return dn(o);const B=ct([],C,M);nt(B,B),ne(M,l,e),C[2]=(f-u)*w,M[2]=(m-u)*w;const U=C;return ct(U,C,M),nt(U,U),Bn(o,B,U)}function Ub(o,e,i=!1){const l=wp(e.zoom),u=(function(f,m,w){const C=m.worldSize,M=[f[12],f[13],f[14]],B=qe(M[1]/C),U=Ye(M[0]/C),$=O([]),Q=He(1,B)*C,ee=He(1,0)*C*ht(B,m.zoom),he=1/so(C);let _e=ee*he;if(w){const ze=Pv(m.projection,m.zoom,m.width,m.height,1024);_e=he*m.projection.pixelSpaceConversion(m.center.lat,C,ze)}const ve=Y(B,U);Ae(ve,ve,Ee([],nt([],ve),Q*_e*M[2]));const De=(function(ze){const Je=[ze[0],ze[1],ze[2]];let Qe=[0,1,0];const st=ct([],Qe,Je);return ct(Qe,Je,st),at(Qe)===0&&(Qe=[0,1,0],ct(st,Je,Qe)),nt(st,st),nt(Qe,Qe),nt(Je,Je),[st[0],st[1],st[2],0,Qe[0],Qe[1],Qe[2],0,Je[0],Je[1],Je[2],0,ze[0],ze[1],ze[2],1]})(ve);V($,$,[_e,_e,_e*Q]),j($,$,[-M[0],-M[1],-M[2]]);const ke=H([],m.globeMatrix,De);return H(ke,ke,$),H(ke,ke,f),ke})(o,e,i);if(l>0){const f=(function(m,w){const C=w.worldSize,M=He(1,0)*C*ht(w.center.lat,w.zoom)/so(C),B=He(1,w.center.lat)*C,U=O([]);X(U,U,_t(w.center.lng)),Z(U,U,_t(w.center.lat)),j(U,U,[0,0,d]),V(U,U,[M,M,M*B]);const $=w.point;return j(U,U,[-$.x,-$.y,0]),H(U,U,m),H(U,w.globeMatrix,U)})(o,e);return(function(m,w,C){const M=(ee,he,_e)=>{const ve=ye(ee),De=ye(he),ke=za(ee,he,_e);return Ee(ke,ke,1/ye(ke)*Qn(ve,De,_e))},B=M([m[0],m[1],m[2]],[w[0],w[1],w[2]],C),U=M([m[4],m[5],m[6]],[w[4],w[5],w[6]],C),$=M([m[8],m[9],m[10]],[w[8],w[9],w[10]],C),Q=za([m[12],m[13],m[14]],[w[12],w[13],w[14]],C);return[B[0],B[1],B[2],0,U[0],U[1],U[2],0,$[0],$[1],$[2],0,Q[0],Q[1],Q[2],1]})(u,f,l)}return u}function NC(o,e,i,l){const u=Fn.projectAabbCorners(l,i);let f=Number.MAX_VALUE,m=-1;for(let M=0;M<u.length;++M){const B=u[M];B[0]=(.5*B[0]+.5)*e.width,B[1]=(.5-.5*B[1])*e.height,B[2]<f&&(m=M,f=B[2])}const w=M=>new Kt(u[M][0],u[M][1]);let C;switch(m){case 0:case 6:C=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:C=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:C=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:C=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(Xi(o,C))return f}const Em=64,Ag={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function VC(o,e,i,l,u,f,m,w,C,M=!1){const B=i.zoom,U=i.project(l),$=ht(l.lat,B),Q=1/$;O(o),j(o,o,[U.x+m[0]*Q,U.y+m[1]*Q,m[2]]);let ee=1,he=1;const _e=i.worldSize;if(M){if(i.projection.name==="mercator"){let ze=0;i.elevation&&(ze=i.elevation.getAtPointOrZero(new Pt(U.x/_e,U.y/_e),0));const Je=Ft([],[U.x,U.y,ze,1],i.projMatrix)[3]/i.cameraToCenterDistance;ee=Je,he=Je*ht(i.center.lat,B)}else if(i.projection.name==="globe"){const ze=Ub(o,i),Je=[0,0,0,1];Ft(Je,Je,H([],i.projMatrix,ze));const Qe=Je[3]/i.cameraToCenterDistance,st=wp(B),lt=i.projection.pixelsPerMeter(l.lat,_e)*ht(l.lat,B),ft=i.projection.pixelsPerMeter(i.center.lat,_e)*ht(i.center.lat,B);ee=Qe/Qn(lt,Tt(i.center.lat),st),he=Qe*$/lt,ee*=ft,he*=ft}}else ee=Q;V(o,o,[ee,ee,he]);const ve=[...o],De=e.orientation,ke=[];if(BC(ke,[De[0]+u[0],De[1]+u[1],De[2]+u[2]],f),H(o,ve,ke),w&&i.elevation){let ze=0;const Je=[];if(C&&i.elevation){ze=(function(st,lt,ft,Ut,vt){const $t=lt.elevation;if(!$t)return 0;const tn=Fn.projectAabbCorners(ft,Ut),qt=He(1,vt.lat)*lt.worldSize,Jt=(function(mn,Wn){const pr=[0,0,1],bn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Hn of bn){const cr=mn[Hn.corners[0]],xr=mn[Hn.corners[1]],kr=mn[Hn.corners[2]],Cr=[xr[0]-cr[0],xr[1]-cr[1],Wn*(xr[2]-cr[2])],Ln=ct(Cr,Cr,[kr[0]-cr[0],kr[1]-cr[1],Wn*(kr[2]-cr[2])]);nt(Ln,Ln),Hn.dotProductWithUp=$e(Ln,pr)}return bn.sort(((Hn,cr)=>Hn.dotProductWithUp-cr.dotProductWithUp)),bn[0].corners})(tn,qt),on=tn[Jt[0]],Bt=tn[Jt[1]],Qt=tn[Jt[2]],Dt=tn[Jt[3]],Et=$t.getAtPointOrZero(new Pt(on[0]/lt.worldSize,on[1]/lt.worldSize),0),an=$t.getAtPointOrZero(new Pt(Bt[0]/lt.worldSize,Bt[1]/lt.worldSize),0),rn=$t.getAtPointOrZero(new Pt(Qt[0]/lt.worldSize,Qt[1]/lt.worldSize),0),Xn=$t.getAtPointOrZero(new Pt(Dt[0]/lt.worldSize,Dt[1]/lt.worldSize),0),Rn=(Et+Xn)/2,Un=(an+rn)/2;return Rn>Un?an<rn?Mv(st,Bt,Dt,on,an,Xn,Et,qt):Mv(st,Qt,on,Dt,rn,Et,Xn,qt):Et<Xn?Mv(st,on,Bt,Qt,Et,an,rn,qt):Mv(st,Dt,Qt,Bt,Xn,rn,an,qt),Math.max(Rn,Un)})(Je,i,e.aabb,o,l);const Qe=H([],oe([],Je),ke);H(o,ve,Qe)}else ze=i.elevation.getAtPointOrZero(new Pt(U.x/_e,U.y/_e),0);ze!==0&&(o[14]+=ze)}}function Z_(o,e,i=!1){o.uploaded||(o.gfxTexture=new Nb(e,o.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function ak(o,e,i){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,ek.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,ik.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,rk.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?tk:nk).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,sk.members,!0)),o.segments=Pi.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&Z_(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&Z_(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&Z_(l.normalTexture,e),l.occlusionTexture&&Z_(l.occlusionTexture,e,i),l.emissionTexture&&Z_(l.emissionTexture,e)}function jb(o,e,i){if(o.meshes)for(const l of o.meshes)ak(l,e,i);if(o.children)for(const l of o.children)jb(l,e,i)}function Iv(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)Iv(e)}function Gb(o){if(o.meshes)for(const i of o.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const i of o.children)Gb(i)}function Am(o,e){const i=o.json.bufferViews[e.bufferView],l=Ev[e.componentType];return new l(o.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==q_[e.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:q_[e.type]))}function $b(o,e,i,l){const u=Ev[e.componentType],f=(function(B){switch(B){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),m=o.json.bufferViews[e.bufferView],w=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:q_[e.type],C=i.float32,M=C.length/i.capacity;for(let B=0,U=0;B<e.count*w;B+=w,U+=M)for(let $=0;$<M;$++)C[U+$]=l[B+$]*f;i._trim()}function lk(o,e,i){const l=o.indices,u=o.attributes,f={};f.indexArray=new Fo;const m=e.json.accessors[l],w=m.count/3;f.indexArray.reserve(w);const C=Am(e,m);for(let $=0;$<w;$++)f.indexArray.emplaceBack(C[3*$],C[3*$+1],C[3*$+2]);f.indexArray._trim(),f.vertexArray=new ea;const M=e.json.accessors[u.POSITION];f.vertexArray.reserve(M.count);const B=Am(e,M);for(let $=0;$<M.count;$++)f.vertexArray.emplaceBack(B[3*$],B[3*$+1],B[3*$+2]);if(f.vertexArray._trim(),f.aabb=new Fn(M.min,M.max),f.centroid=(function($,Q){const ee=[0,0,0],he=$.length;if(he>0){for(let _e=0;_e<he;_e++){const ve=3*$[_e];ee[0]+=Q[ve],ee[1]+=Q[ve+1],ee[2]+=Q[ve+2]}ee[0]/=he,ee[1]/=he,ee[2]/=he}return ee})(C,B),u.COLOR_0!==void 0){const $=e.json.accessors[u.COLOR_0],Q=q_[$.type],ee=Am(e,$);f.colorArray=Q===3?new ea:new Sl,f.colorArray.resize($.count),$b(e,$,f.colorArray,ee)}if(u.NORMAL!==void 0){f.normalArray=new ea;const $=e.json.accessors[u.NORMAL];f.normalArray.resize($.count);const Q=Am(e,$);$b(e,$,f.normalArray,Q)}if(u.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new Pc;const $=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.resize($.count);const Q=Am(e,$);$b(e,$,f.texcoordArray,Q)}if(u._FEATURE_ID_RGBA4444!==void 0){const $=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Am(e,$))}u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Am(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const U=o.material;return f.material=(function($,Q){const{emissiveFactor:ee=[0,0,0],alphaMode:he="OPAQUE",alphaCutoff:_e=.5,normalTexture:ve,occlusionTexture:De,emissiveTexture:ke,doubleSided:ze}=$,{baseColorFactor:Je=[1,1,1,1],metallicFactor:Qe=1,roughnessFactor:st=1,baseColorTexture:lt,metallicRoughnessTexture:ft}=$.pbrMetallicRoughness||{},Ut=De?Q[De.index]:void 0;if(De&&De.extensions&&De.extensions.KHR_texture_transform&&Ut){const vt=De.extensions.KHR_texture_transform;Ut.offsetScale=[vt.offset[0],vt.offset[1],vt.scale[0],vt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new mi(...Je),metallicFactor:Qe,roughnessFactor:st,baseColorTexture:lt?Q[lt.index]:void 0,metallicRoughnessTexture:ft?Q[ft.index]:void 0},doubleSided:ze,emissiveFactor:new mi(...ee),alphaMode:he,alphaCutoff:_e,normalTexture:ve?Q[ve.index]:void 0,occlusionTexture:Ut,emissionTexture:ke?Q[ke.index]:void 0,defined:$.defined===void 0}})(U!==void 0?e.json.materials[U]:{defined:!1},i),f}function UC(o,e,i){const{matrix:l,rotation:u,translation:f,scale:m,mesh:w,extras:C,children:M}=o,B={};if(B.matrix=l||(function(U,$,Q,ee){var he=$[0],_e=$[1],ve=$[2],De=$[3],ke=he+he,ze=_e+_e,Je=ve+ve,Qe=he*ke,st=he*ze,lt=he*Je,ft=_e*ze,Ut=_e*Je,vt=ve*Je,$t=De*ke,tn=De*ze,qt=De*Je,Jt=ee[0],on=ee[1],Bt=ee[2];return U[0]=(1-(ft+vt))*Jt,U[1]=(st+qt)*Jt,U[2]=(lt-tn)*Jt,U[3]=0,U[4]=(st-qt)*on,U[5]=(1-(Qe+vt))*on,U[6]=(Ut+$t)*on,U[7]=0,U[8]=(lt+tn)*Bt,U[9]=(Ut-$t)*Bt,U[10]=(1-(Qe+ft))*Bt,U[11]=0,U[12]=Q[0],U[13]=Q[1],U[14]=Q[2],U[15]=1,U})([],u||[0,0,0,1],f||[0,0,0],m||[1,1,1]),w!==void 0){B.meshes=i[w];const U=B.anchor=[0,0];for(const $ of B.meshes){const{min:Q,max:ee}=$.aabb;U[0]+=Q[0]+ee[0],U[1]+=Q[1]+ee[1]}U[0]=Math.floor(U[0]/B.meshes.length/2),U[1]=Math.floor(U[1]/B.meshes.length/2)}if(C&&(C.id&&(B.id=C.id),C.lights&&(B.lights=(function(U){if(!U.length)return[];const $=(function(ve){const De=atob(ve),ke=new Uint8Array(De.length);for(let ze=0;ze<De.length;ze++)ke[ze]=De.codePointAt(ze);return ke})(U),Q=[],ee=$.length/24,he=new Uint16Array($.buffer),_e=new Float32Array($.buffer);for(let ve=0;ve<ee;ve++){const De=he[2*ve*6]/30,ke=he[2*ve*6+1]/30,ze=he[2*ve*6+10]/100,Je=_e[6*ve+1],Qe=_e[6*ve+2],st=_e[6*ve+3],lt=_e[6*ve+4],ft=st-Je,Ut=lt-Qe,vt=Math.hypot(ft,Ut);Q.push({pos:[Je+.5*ft,Qe+.5*Ut,ke],normal:[Ut/vt,-ft/vt,0],width:vt,height:De,depth:ze,points:[Je,Qe,st,lt]})}return Q})(C.lights))),M){const U=[];for(const $ of M)U.push(UC(e.json.nodes[$],e,i));B.children=U}return B}function ck(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new yv(o.vertices,o.indices,8,256),[i,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:i,max:l}}function uk(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const w=m[0],C=m[1];typeof w=="number"&&typeof C=="number"&&l.push(new Kt(w,C))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let m=0;m<l.length;m++){const w=l[m],C=l[(m+1)%l.length],M=l[(m+2)%l.length];u+=(w.x-C.x)*(M.y-C.y)-(M.x-C.x)*(w.y-C.y)}u>0&&l.reverse();const f=bg(l.flatMap((m=>[m.x,m.y])),[]);return f.length===0?null:{vertices:l,indices:f}}function dk(o,e){const i=[],l=[];let u=0;const f=[];for(const m of o){u=i.length;const w=m.vertexArray.float32,C=m.indexArray.uint16;for(let M=0;M<m.vertexArray.length;M++)f[0]=w[3*M+0],f[1]=w[3*M+1],f[2]=w[3*M+2],xt(f,f,e),i.push(new Kt(f[0],f[1]));for(let M=0;M<3*m.indexArray.length;M++)l.push(C[M]+u)}if(l.length%3!=0)return null;for(let m=0;m<l.length;m+=3){const w=i[l[m+0]],C=i[l[m+1]],M=i[l[m+2]];(w.x-C.x)*(M.y-C.y)-(M.x-C.x)*(w.y-C.y)>0&&([l[m+1],l[m+2]]=[l[m+2],l[m+1]])}return{vertices:i,indices:l}}function jC(o){const e=(function(C,M){const B=[],U=WebGL2RenderingContext;if(C.json.textures)for(const $ of C.json.textures){const Q={magFilter:U.LINEAR,minFilter:U.NEAREST,wrapS:U.REPEAT,wrapT:U.REPEAT};$.sampler!==void 0&&Object.assign(Q,C.json.samplers[$.sampler]),B.push({image:M[$.source],sampler:Q,uploaded:!1})}return B})(o,o.images),i=(function(C,M){const B=[];for(const U of C.json.meshes){const $=[];for(const Q of U.primitives)$.push(lk(Q,C,M));B.push($)}return B})(o,e),{scenes:l,scene:u,nodes:f}=o.json,m=l?l[u||0].nodes:[...f.keys()],w=[];for(const C of m)w.push(UC(f[C],o,i));return(function(C,M,B){const U={},$=new Set;for(let Q=0;Q<C.length;Q++){const ee=B[M[Q]];if(!ee.extras)continue;const he=ee.extras["mapbox:footprint:version"],_e=ee.extras["mapbox:footprint:id"];(he||_e)&&$.add(Q),he==="1.0.0"&&_e&&(U[_e]=Q)}for(let Q=0;Q<C.length;Q++){if($.has(Q))continue;const ee=C[Q],he=B[M[Q]];if(!he.extras)continue;let _e=null;ee.id in U&&(_e=dk(C[U[ee.id]].meshes,ee.matrix)),_e||(_e=uk(he)),_e&&(ee.footprint=ck(_e))}if($.size>0){const Q=Array.from($.values()).sort(((ee,he)=>ee-he));for(let ee=Q.length-1;ee>=0;ee--)C.splice(Q[ee],1)}})(w,m,o.json.nodes),w}function hk(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,i=o.aabb.min[0]-1,l=o.aabb.min[1]-1,u=Em/(o.aabb.max[0]-i+2),f=Em/(o.aabb.max[1]-l+2);for(let m=0;m<e.length;m+=3){const w=e[m+2],C=(e[m+0]-i)*u|0,M=(e[m+1]-l)*f|0;w>o.heightmap[M*Em+C]&&(o.heightmap[M*Em+C]=w)}}function GC(o,e,i,l,u){i.reserve(i.length+4*o.length),l.reserve(l.length+10*o.length),u.reserve(u.length+10*o.length);let f=l.length;for(const m of o){const w=Math.min(10,Math.max(4,1.3*m.height))*e,C=[-m.normal[1],m.normal[0],0],M=Math.min(.29,.1*m.width/m.depth),B=m.width-2*m.depth*e*(M+.01),U=Oe([],m.pos,C,B/2),$=Oe([],m.pos,C,-B/2),Q=[U[0],U[1],U[2]+m.height],ee=[$[0],$[1],$[2]+m.height],he=Oe([],m.normal,C,M);Ee(he,he,w);const _e=Oe([],m.normal,C,-M);Ee(_e,_e,w),Ae(he,U,he),Ae(_e,$,_e),U[2]+=.1,$[2]+=.1,l.emplaceBack(he[0],he[1],he[2]),l.emplaceBack(_e[0],_e[1],_e[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack($[0],$[1],$[2]),l.emplaceBack(Q[0],Q[1],Q[2]),l.emplaceBack(ee[0],ee[1],ee[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack($[0],$[1],$[2]),l.emplaceBack(he[0],he[1],he[2]),l.emplaceBack(_e[0],_e[1],_e[2]);const ve=B/w/2;u.emplaceBack(-ve-M,-1,ve,.8),u.emplaceBack(ve+M,-1,ve,.8),u.emplaceBack(-ve,0,ve,1.3),u.emplaceBack(ve,0,ve,1.3),u.emplaceBack(ve+M,-.8,ve,.7),u.emplaceBack(ve+M,-.8,ve,.7),u.emplaceBack(0,0,ve,1.3),u.emplaceBack(0,0,ve,1.3),u.emplaceBack(ve+M,-1.2,ve,.8),u.emplaceBack(ve+M,-1.2,ve,.8),i.emplaceBack(6+f,4+f,8+f),i.emplaceBack(7+f,9+f,5+f),i.emplaceBack(0+f,1+f,2+f),i.emplaceBack(1+f,3+f,2+f),f+=10}}function fk(o,e){const i={};i.indexArray=new Fo,i.vertexArray=new ea,i.colorArray=new Sl,GC(o,e,i.indexArray,i.vertexArray,i.colorArray);const l={defined:!0};l.emissiveFactor=mi.black;const u={};return u.baseColorFactor=mi.white,l.pbrMetallicRoughness=u,i.material=l,i.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const $C=jr([{name:"a_pos_3f",components:3,type:"Float32"}]),pk=jr([{name:"a_normal_3",components:3,type:"Int16"}]),mk=jr([{name:"a_centroid_3",components:3,type:"Int16"}]),HC=jr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),gk=jr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),_k=jr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yk=jr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),vk=jr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qC=en.types,Hb=32767;function xk(o,e){const i=hn+e;for(const l of o)for(const u of l)if(u.x<-e||u.x>i||u.y<-e||u.y>i)return!1;return!0}class WC{constructor(){this.layoutVertexArray=new ea,this.layoutAttenuationArray=new Sl,this.layoutColorArray=new zo,this.indexArray=new Fo,this.indexArrayForConflation=new Fo,this.segmentsBucket=new Pi}}class qb{constructor(){this.layoutVertexArray=new ea,this.layoutNormalArray=new ks,this.layoutCentroidArray=new ks,this.layoutColorArray=new zo,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Fo,this.indexArrayForConflation=new Fo,this.segmentsBucket=new Pi,this.entranceBloom=new WC}}class ZC{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new qb,this.buildingWithFacade=new qb,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new zo,this.buildingWithFacade.layoutFacadeDataArray=new Yd,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new zo,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new Ib(e)}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}prepare(){return(function(){if(Cv!=null||EC!=null)return null;if(Eg!=null)return Eg;const e=fetch(Oo.BUILDING_GEN_URL);return Eg=(function(i){let l,u,f,m;function w(){l=new Uint8Array(m.buffer),u=new Int32Array(m.buffer),f=new Float32Array(m.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},B={a:{a:C,f:function(U){const $=l.length,Q=Math.max(U>>>0,Math.ceil(1.2*$)),ee=Math.ceil((Q-$)/65536);try{return m.grow(ee),w(),!0}catch{return!1}},g:C,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,B):i.then((U=>U.arrayBuffer())).then((U=>WebAssembly.instantiate(U,B)))).then((U=>{const $=U.instance.exports;return(0,$.g)(),m=$.f,w(),new W6({setStyle:$.h,setAOOptions:$.i,setMetricOptions:$.j,setStructuralOptions:$.k,setFacadeOptions:$.l,setFauxFacadeOptions:$.m,setFacadeClassifierOptions:$.n,addFeature:$.o,addFacade:$.p,generateMesh:$.q,getLastError:$.r,getOuterRingLength:$.s,getMeshCount:$.t,getPositionsPtr:$.u,getPositionsLength:$.v,getNormalsPtr:$.w,getNormalsLength:$.x,getColorsPtr:$.y,getColorsLength:$.z,getAOPtr:$.A,getAOLength:$.B,getUVPtr:$.C,getUVLength:$.D,getFauxFacadePtr:$.E,getFauxFacadeLength:$.F,getIndicesPtr:$.G,getIndicesLength:$.H,getBuildingPart:$.I,getRingCount:$.J,getRingPtr:$.K,getRingLength:$.L,free:$.M,malloc:$.N,heapU8:l,heap32:u,heapF32:f})}))})(e).then((i=>(Eg=null,Cv=i,Cv))).catch((i=>{Vr("Could not load building-gen"),Eg=null,EC=i})),Eg})()}populate(e,i,l,u){const f=Z6();if(!f)return;const m=bt(l);this.tileToMeter=m,this.brightness=i.brightness,f.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,m],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:m,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const w=new Map;for(const{feature:C}of e){if(qC[C.type]!=="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,B=Ht(C,M);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),B,l))continue;const U=M?B.geometry:Sn(C,l,u),$=[];for(const _e of U)for(const ve of _e)$.push({x:ve.x,y:ve.y});const Q={coordinates:$,crossPerc:C.properties.cross_perc,distanceToRoad:C.properties.distance_to_road,entrances:C.properties.entrances,sourceId:0},ee=C.properties.source_id;let he=w.get(ee);he||(he=[],w.set(ee,he)),he.push(Q)}this.maxHeight=0;for(const{feature:C,index:M}of e){if(qC[C.type]==="LineString")continue;const B=this.layers[0]._featureFilter.needGeometry,U=Ht(C,B);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),U,l))continue;const $=B?U.geometry:Sn(C,l,u),Q=F_($,500);if(!xk($,163))continue;const ee=this.layers[0],he=ee.layout.get("building-base").evaluate(C,{},l),_e=ee.layout.get("building-height").evaluate(C,{},l),ve=ee.layout.get("building-roof-shape").evaluate(C,{},l),De=ee.paint.get("building-ambient-occlusion-intensity"),ke=ee.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ve==="flat")continue;const ze=ee.layout.get("building-facade").evaluate(C,{},l);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(ze,!1,1);const Je=C.properties.source_id;let Qe;Qe=w.has(Je)?w.get(Je):[];let st=0,lt=0,ft=0,Ut=0,vt=0,$t=0;if(ze){let Ln=Math.round(ee.layout.get("building-facade-floors").evaluate(C,{},l));if(he===0){Ln=Math.max(1,Ln-(Qe.length>0?1:0));let Kr=4;if(_e>100){const Ne=[10,13,15];Kr=Ne[C.id?C.id%Ne.length:0],f.setFacadeOptions(Kr,!0)}vt=1.6803*Kr/m}else vt=he/m;$t=_e/m,vt=Math.min(vt,$t),ft=ee.layout.get("building-facade-unit-width").evaluate(C,{},l)/m,Ut=($t-vt)/Ln,f.setFauxFacadeOptions(!0,!0,ft);const Sr=ee.layout.get("building-facade-window").evaluate(C,{},l);st=Sr[0],lt=Sr[1]}const tn=[],qt=new Kt(1/0,1/0),Jt=new Kt(-1/0,-1/0),on=new Kt(0,0);let Bt=0;for(const Ln of Q)if(Ln.length>0){const Sr=[];for(const Kr of Ln){const Ne=[];for(let Ve=Kr.length-1;Ve>=0;Ve--){const Mt=Kr[Ve];Ne.push({x:Mt.x,y:Mt.y}),qt.x=Math.min(qt.x,Mt.x),qt.y=Math.min(qt.y,Mt.y),Jt.x=Math.max(Jt.x,Mt.x),Jt.y=Math.max(Jt.y,Mt.y),on.x+=Mt.x,on.y+=Mt.y,Bt++}Sr.push(Ne)}tn.push({id:C.id?C.id:0,height:_e,minHeight:he,sourceId:0,roofType:ve,coordinates:Sr})}on.x/=Bt||1,on.y/=Bt||1;const Qt=f.generateMesh(tn,Qe);if(typeof Qt=="string"){Vr(`Unable to generate building ${C.id}: ${Qt}`);continue}if(Qt.meshes.length===0||Qt.modifiedPolygonRings.length===0)continue;let Dt=0;for(const Ln of Qt.meshes)Dt+=Ln.positions.length/3;const Et=ze?this.buildingWithFacade:this.buildingWithoutFacade,an=Et.segmentsBucket.prepareSegment(Dt,Et.layoutVertexArray,Et.indexArray),rn=[];let Xn=null,Rn=0,Un=-1;const mn=Et.indexArray.length;let Wn=0;for(const Ln of Qt.meshes){const Sr=Et.layoutVertexArray.length;if(Ln.buildingPart==="entrance"){const Vt=new Array;for(let Jn=0;Jn<Ln.indices.length;Jn+=12){const Or=Ln.positions[Jn+0],Lr=Ln.positions[Jn+1],Rr=Ln.positions[Jn+3],xi=Ln.positions[Jn+4],to=Ln.positions[Jn+2],Mr=Ln.positions[Jn+8]-to,Vi=1,Si=Rr-Or,pi=xi-Lr,Hi=Math.hypot(Si,pi);Vt.push({pos:[Or+.5*Si,Lr+.5*pi,to],normal:[pi/Hi,-Si/Hi,0],width:Hi,height:Mr,depth:Vi,points:[Or,Lr,Rr,xi]})}const xn=Et.entranceBloom.segmentsBucket.prepareSegment(10*Vt.length,Et.entranceBloom.layoutVertexArray,Et.entranceBloom.indexArray),vn=Et.entranceBloom.layoutVertexArray.length;Rn=Et.entranceBloom.indexArray.length,GC(Vt,.5/this.tileToMeter,Et.entranceBloom.indexArray,Et.entranceBloom.layoutVertexArray,Et.entranceBloom.layoutAttenuationArray);const Dn=Et.entranceBloom.layoutVertexArray.length-vn;Un=Et.entranceBloom.indexArray.length-Rn;for(let Jn=0;Jn<Dn;Jn++)Et.entranceBloom.layoutColorArray.emplaceBack(65535,65535);xn.vertexLength+=Dn,xn.primitiveLength+=Un,Xn={part:Ln.buildingPart,vertexOffset:vn,vertexLength:Dn}}for(let Vt=0;Vt<Ln.positions.length;Vt+=3)Wn=Math.max(Wn,Ln.positions[Vt+2]),Et.layoutVertexArray.emplaceBack(Ln.positions[Vt],Ln.positions[Vt+1],Ln.positions[Vt+2]);const Kr=Math.floor(on.x),Ne=Math.floor(on.y),Ve=Math.floor(Wn);for(let Vt=0;Vt<Ln.positions.length;Vt+=3)Et.layoutCentroidArray.emplaceBack(Kr,Ne,Ve);for(let Vt=0;Vt<Ln.normals.length;Vt+=3)Et.layoutNormalArray.emplaceBack(Ln.normals[Vt+0]*Hb,Ln.normals[Vt+1]*Hb,Ln.normals[Vt+2]*Hb);for(let Vt=0;Vt<Ln.ao.length;Vt++)Et.layoutAOArray.push(Ln.ao[Vt]);for(let Vt=0;Vt<Ln.colors.length;Vt+=3){const xn=1+(Ln.ao[Vt/3]-1)*De;Et.layoutColorArray.emplaceBack(Ln.colors[Vt]*xn<<8|Ln.colors[Vt+1]*xn,Ln.colors[Vt+2]*xn<<8)}if(ze){for(let Vt=0;Vt<Ln.positions.length;Vt+=3)Et.layoutFacadePaintArray.emplaceBack(65535,255);for(let Vt=0;Vt<Ln.isFauxFacade.length;Vt++)if(Ln.isFauxFacade[Vt]){const xn=1|Math.min(65535,Math.floor(Ln.uv[2*Vt]*Qt.outerRingLength)),vn=Math.floor(255*st)<<8|Math.floor(255*lt),Dn=Math.floor(65535*Math.min(1,ft/hn)),Jn=Math.floor(65535*Math.min(1,Ut/hn));Et.layoutFacadeDataArray.emplaceBack(xn,vn,Dn,Jn);const Or=Math.floor(65535*Math.min(1,vt/hn)),Lr=Math.floor(65535*Math.min(1,$t/hn));Et.layoutFacadeVerticalRangeArray.emplaceBack(Or,Lr)}else Et.layoutFacadeDataArray.emplaceBack(0,0,0,0),Et.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Mt=an.vertexLength;for(let Vt=0;Vt<Ln.indices.length;Vt+=3)Et.indexArray.emplaceBack(Mt+Ln.indices[Vt],Mt+Ln.indices[Vt+1],Mt+Ln.indices[Vt+2]);an.vertexLength+=Ln.positions.length/3,an.primitiveLength+=Ln.indices.length/3,(Ln.buildingPart==="roof"||Ln.buildingPart==="wall"||Ln.buildingPart==="facade_glazing"||Ln.buildingPart==="entrance")&&rn.push({part:Ln.buildingPart,vertexOffset:Sr,vertexLength:Ln.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Wn),this.buildingFeatures.push({feature:U,hasFauxFacade:ze,segment:an,parts:rn,buildingBloom:Xn});const pr=Et.indexArray.length-mn,bn=[],Hn=[],cr=new Kt(1/0,1/0),xr=new Kt(-1/0,-1/0),kr=this.groundEffect.vertexArray.length;for(const Ln of Qt.modifiedPolygonRings){const Sr=[],Kr=new Kt(1/0,1/0),Ne=new Kt(-1/0,-1/0);for(let Ve=0;Ve<Ln.length;Ve+=2){const Mt=Ln.length-Ve-2;Kr.x=Math.min(Kr.x,Ln[Mt]),Kr.y=Math.min(Kr.y,Ln[Mt+1]),Ne.x=Math.max(Ne.x,Ln[Mt]),Ne.y=Math.max(Ne.y,Ln[Mt+1]);const Vt=new Kt(Ln[Mt],Ln[Mt+1]);Sr.push(Vt),bn.push(Vt.x,Vt.y),Hn.push(Vt.clone())}cr.x=Math.min(cr.x,Kr.x),cr.y=Math.min(cr.y,Kr.y),xr.x=Math.max(xr.x,Ne.x),xr.y=Math.max(xr.y,Ne.y),this.groundEffect.addData(Sr,[Kr,Ne],ke)}const Cr=this.groundEffect.vertexArray.length-kr;(qt.x<0||Jt.x>hn||qt.y<0||Jt.y>hn)&&this.featuresOnBorder.push({featureId:C.id,footprintIndex:this.footprints.length});{const Ln=bg(bn,null,2),Sr=new yv(Hn,Ln,8,256);let Kr=C.id;C.properties&&C.properties.hasOwnProperty("building_id")&&(Kr=C.properties.building_id),this.footprints.push({vertices:Hn,indices:Ln,grid:Sr,min:cr,max:xr,buildingId:Kr,hiddenFlags:0,indicesOffset:mn,indicesLength:pr,bloomIndicesOffset:Rn,bloomIndicesLength:Un,groundEffectVertexOffset:kr,groundEffectVertexLength:Cr,hasFauxFacade:ze,segment:an,height:Wn})}this.programConfigurations.populatePaintArrays(Et.layoutVertexArray.length,C,M,{},i.availableImages,l,i.brightness),this.groundEffect.addPaintPropertiesData(C,M,{},i.availableImages,l,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,l,u,f,m,w){this.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w),this.groundEffect.update(e,i,f,l,u,m,w),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,$C.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,pk.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,mk.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,_k.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,yk.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,$C.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,vk.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,l=!0){let u=!1;const f=l?i:0,m=0|(l?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of e){const C=this.footprints[w],M=C.hiddenFlags&m|f;C.hiddenFlags!==M&&(C.hiddenFlags=M,u=!0,this.groundEffect.updateHiddenByLandmarkRange(C.groundEffectVertexOffset,C.groundEffectVertexLength,C.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const u of this.footprints){const f=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let C=u.indicesOffset;C<m;C++)f.indexArrayForConflation.uint16[3*C+0]=0,f.indexArrayForConflation.uint16[3*C+1]=0,f.indexArrayForConflation.uint16[3*C+2]=0;const w=u.bloomIndicesOffset+u.bloomIndicesLength;for(let C=u.bloomIndicesOffset;C<w;C++)f.entranceBloom.indexArrayForConflation.uint16[3*C+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*C+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*C+2]=0}}const l=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,HC.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,gk.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,HC.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const l=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const f=i[u.feature.id],m=u.feature;m.properties["building-part"]="roof";const w=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),C=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="wall";const M=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),B=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="window";const U=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),$=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="door";const Q=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),ee=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical),he=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ve of u.parts){let De,ke=w;ve.part==="roof"?(ke=w,De=C):ve.part==="wall"?(ke=M,De=B):ve.part==="facade_glazing"?(ke=U,De=$):ve.part==="entrance"&&(ke=Q,De=ee),De=et(De,0,1);for(let ze=0;ze<ve.vertexLength;ze++){const Je=ve.vertexOffset+ze,Qe=1+(he.layoutAOArray[Je]-1)*l;he.layoutColorArray.emplace(Je,ke.r*Qe*255<<8|ke.g*Qe*255,ke.b*Qe*255<<8|255*De),u.hasFauxFacade&&he.layoutFacadePaintArray.emplace(Je,255*U.r<<8|255*U.g,255*U.b<<8|255*$)}}const _e=u.buildingBloom;if(_e)for(let ve=0;ve<_e.vertexLength;ve++)he.entranceBloom.layoutColorArray.emplace(_e.vertexOffset+ve,255*Q.r<<8|255*Q.g,255*Q.b<<8|51*ee)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(xv(this.activeReplacements,u))return;this.activeReplacements=u;for(const m of this.footprints)m.hiddenFlags&=-2;const f=[];for(const m of this.activeReplacements){if(m.order<=JT)continue;const w=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const C of this.footprints)C.min.x>m.max.x||C.max.x<m.min.x||C.min.y>m.max.y||C.max.y<m.min.y||(f.length=0,bk(C.vertices,0,C.vertices.length,m.footprintTileId.canonical,e.canonical,f),Eb(m.footprint,f,C.indices,0,C.indices.length,0,-w)&&(C.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+hn)*hn+(i+hn);if(this.footprintLookup.hasOwnProperty(f)){const w=this.footprintLookup[f];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const m=new Kt(e,i);for(const w of this.footprints)e>w.max.x||w.min.x>e||i>w.max.y||w.min.y>i||w.height<=l||Ab(m,w)&&(l=w.height,this.footprintLookup[f]=w,u=w.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[f]=void 0}}function bk(o,e,i,l,u,f){const m=Math.pow(2,l.z-u.z);for(let w=0;w<i;w++){let C=o[w+e].x,M=o[w+e].y;C=(C+u.x*hn)*m-l.x*hn,M=(M+u.y*hn)*m-l.y*hn,f.push(new Kt(C,M))}}let YC,XC;In(ZC,"BuildingBucket",{omit:["layers"]}),In(qb,"BuildingGeometry"),In(WC,"BuildingBloomGeometry");const wk=jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Sk=jr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Tk}=wk,Ck=jr([{name:"a_packed",components:3,type:"Float32"}]),{members:Ek}=Ck,Ak=jr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Pk}=Ak;class KC{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Sp({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=qn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const u=[];let f=e.length%2==1?-e[e.length-1]*l:0,m=e[0]*l,w=!0;u.push({left:f,right:m,isDash:w,zeroLength:e[0]===0});let C=e[0];for(let M=1;M<e.length;M++){w=!w;const B=e[M];f=C*l,C+=B,m=C*l,u.push({left:f,right:m,isDash:w,zeroLength:B===0})}return u}addRoundDash(e,i,l){const u=i/2;for(let f=-l;f<=l;f++){const m=this.width*(this.nextRow+l+f);let w=0,C=e[w];for(let M=0;M<this.width;M++){M/C.right>1&&(C=e[++w]);const B=Math.abs(M-C.left),U=Math.abs(M-C.right),$=Math.min(B,U);let Q;const ee=f/l*(u+1);if(C.isDash){const he=u-Math.abs(ee);Q=Math.sqrt($*$+he*he)}else Q=u-Math.sqrt($*$+ee*ee);this.image.data[m+M]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(e,i){for(let C=e.length-1;C>=0;--C){const M=e[C],B=e[C+1];M.zeroLength?e.splice(C,1):B&&B.isDash===M.isDash&&(B.left=M.left,e.splice(C,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const f=this.width*this.nextRow;let m=0,w=e[m];for(let C=0;C<this.width;C++){C/w.right>1&&(w=e[++m]);const M=Math.abs(C-w.left),B=Math.abs(C-w.right),U=Math.min(M,B);this.image.data[f+C]=Math.max(0,Math.min(255,(w.isDash?U:-U)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const u=i==="round",f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Vr("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let B=0;B<e.length;B++)e[B]<0&&(Vr("Negative value is found in line dasharray, replacing values with 0"),e[B]=0),w+=e[B];if(w!==0){const B=this.width/w,U=this.getDashRanges(e,this.width,B);u?this.addRoundDash(U,B,f):this.addRegularDash(U,i==="square"?.5*B:0)}const C=this.nextRow+f;this.nextRow+=m;const M={tl:[C,f],br:[w,0]};return this.positions[l]=M,M}}In(KC,"LineAtlas");const Mk=en.types,Ik=Math.cos(Math.PI/180*37.5),Rk=Math.cos(Math.PI/180*5);class Wb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new hp,this.layoutVertexArray2=new ea,this.patternVertexArray=new ea,this.indexArray=new Fo,this.programConfigurations=new La(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Pi,this.maxLineLength=0,this.zOffsetVertexArray=new ea,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:hn/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,u){this.hasPattern=xb("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=bt(l);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const $=this.layers[0].layout.get("line-z-offset"),Q=$.isConstant()&&!$.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&Q?"none":"offset",this.elevationType==="offset"&&m==="none"&&Vr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const C=[];for(const{feature:$,id:Q,index:ee,sourceLayerIndex:he}of e){const _e=this.layers[0]._featureFilter.needGeometry,ve=Ht($,_e);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),ve,l))continue;const De=f?f.evaluate(ve,{},l):void 0,ke={id:Q,properties:$.properties,type:$.type,sourceLayerIndex:he,index:ee,geometry:_e?ve.geometry:Sn($,l,u),patterns:{},sortKey:De};C.push(ke)}f&&C.sort((($,Q)=>$.sortKey-Q.sortKey));const{lineAtlas:M,featureIndex:B}=i,U=this.addConstantDashes(M);for(const $ of C){const{geometry:Q,index:ee,sourceLayerIndex:he}=$;if(U&&this.addFeatureDashes($,M),this.hasPattern){const _e=bb("line",this.layers,$,this.zoom,this.pixelRatio,i);this.patternFeatures.push(_e)}else this.addFeature($,Q,ee,l,M.positions,i.availableImages,i.brightness,i.elevationFeatures);B.insert(e[ee].feature,Q,ee,he,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,w=u.value;if(!w)continue;e.addDash(w,m)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let w,C;if(f.kind==="constant"){if(w=f.value,!w)continue}else w=f.evaluate({zoom:l},e);C=m.kind==="constant"?m.value:m.evaluate({zoom:l},e),i.addDash(w,C),e.patterns[u.id]=[i.getKey(w,C)]}}update(e,i,l,u,f,m,w,C){this.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,C)}addFeatures(e,i,l,u,f,m){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,l,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ek)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Pk)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Sk.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tk),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let l,u;if(i&&i>0?(l=`mapbox_clip_start_${i}`,u=`mapbox_clip_end_${i}`):(l="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(u))return{start:+e.properties[l],end:+e.properties[u]}}addFeature(e,i,l,u,f,m,w,C){const M=this.layers[0].layout,B=M.get("line-join").evaluate(e,{}),U=M.get("line-cap").evaluate(e,{}),$=M.get("line-miter-limit"),Q=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const ee=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=M.get("line-z-offset").value;const he=this.layers[0].paint.get("line-width").value;if(he.kind!=="constant"&&he.isLineProgressConstant===!1&&(this.variableWidthValue=he),this.elevationType==="road"){const _e=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,C,B,U,$,Q)){const[ve,De]=this.clipRuntimeLinesToTile(i,1);for(let ke=0;ke<ve.length;ke++){const ze=ve[ke],Je=De[ke],Qe={progress:{min:Je.progress.min,max:Je.progress.max},nextDir:this.computeSegNextDir(Je,ze),prevDir:this.computeSegPrevDir(Je,ze)};this.addLine(ze,e,u,B,U,$,Q,Qe,ee&&Je.parentIndex>0?Je.parentIndex:null)}this.fillNonElevatedRoadSegment(_e)}}else for(let _e=0;_e<i.length;_e++)this.addLine(i[_e],e,u,B,U,$,Q,void 0,ee&&_e>0?_e:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,u,w,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Sv(e,-i,-i,hn+i,hn+i)}clipRuntimeLinesToTile(e,i){const l=[];return[Sv(e,-i,-i,hn+i,hn+i,l),l]}addElevatedRoadFeature(e,i,l,u,f,m,w,C){const M=[],B=Ii.getElevationFeature(e,u);if(B){const U=this.clipLinesToTile(i,1),$=this.prepareElevatedLines(U,B,l);for(const Q of $)M.push({geometry:Q,elevation:B,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(M.length===0)return!1;for(const U of M){const $=this.layoutVertexArray.length;this.addLine(U.geometry,e,l,f,m,w,C);const Q=new xo(l,U.elevationTileID);if(U.elevation)for(let ee=$;ee<this.layoutVertexArray.length;ee++){const he=new Kt(this.layoutVertexArray.int16[6*ee]>>1,this.layoutVertexArray.int16[6*ee+1]>>1),_e=Q.pointElevation(he,U.elevation,.05);this.updateHeightRange(_e),this.zOffsetVertexArray.emplaceBack(_e,0,0)}else this.fillNonElevatedRoadSegment($)}return!0}prepareElevatedLines(e,i,l){if(i.constantHeight!=null)return e;const u=[],f=1/bt(l);for(const m of e)$6(m,new Gr(i,f),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,l,u,f,m,w,C,M){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=M?this.lineFeatureClips(i,M):this.lineClips;const B=u==="none";this.patternJoinNone=this.hasPattern&&B,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const U=C&&C.progress.min>0,$=C&&C.progress.max<1;if(this.lineClips){let ft={min:this.lineClips.start,max:this.lineClips.end},Ut=1;if(C){const tn=this.lineClips.end-this.lineClips.start;ft=(function(qt,Jt,on){return{min:ul(qt.min,Jt,on),max:ul(qt.max,Jt,on)}})(C.progress,{min:0,max:1},ft),tn>0&&(Ut=(ft.max-ft.min)/tn)}const vt=+i.properties.mapbox_clip_feature_len,$t=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(vt)||Number.isNaN($t)){for(let qt=0;qt<e.length-1;qt++)this.totalDistance+=e[qt].dist(e[qt+1]);const tn=this.totalDistance/(ft.max-ft.min);this.totalFeatureLength=Number.isFinite(tn)?tn:0,this.lineClips.start=ft.min,this.lineClips.end=ft.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=vt,this.distance=$t*Ut,this.lineClips.start=ft.min,this.lineClips.end=ft.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Q=Mk[i.type]==="Polygon";let ee=e.length;for(;ee>=2&&e[ee-1].equals(e[ee-2]);)ee--;let he=0;for(;he<ee-1&&e[he].equals(e[he+1]);)he++;if(ee<(Q?3:2))return;u==="bevel"&&(m=1.05);const _e=this.segments.prepareSegment(10*ee,this.layoutVertexArray,this.indexArray);let ve,De,ke,ze,Je,Qe,st,lt;C&&C.prevDir&&(Qe=C.prevDir.perp()),C&&C.nextDir&&(st=C.nextDir.perp()),this.e1=this.e2=-1,Q&&(ve=e[ee-2],Je=e[he].sub(ve)._unit()._perp());for(let ft=he;ft<ee;ft++){if(ke=ft===ee-1?Q?e[he+1]:void 0:e[ft+1],ke&&e[ft].equals(ke))continue;Je&&(ze=Je),ve&&(De=ve),ve=e[ft],lt=this.evaluateLineProgressFeatures(De?De.dist(ve):0),Je=ke?ke.sub(ve)._unit()._perp():ze,ze=ze||Je;const Ut=De&&ke;let vt=Ut?u:Q||B?"butt":f;const $t=ze.x*Je.x+ze.y*Je.y;if(B){const Et=function(an){if(an.patternJoinNone){const rn=an.segmentPoints.length/2,Xn=an.lineSoFar-an.segmentStart;for(let Rn=0;Rn<rn;++Rn){const Un=an.segmentPoints[2*Rn+1],mn=Math.round(an.segmentPoints[2*Rn])+.5+.25*Un;an.patternVertexArray.emplaceBack(mn,Xn,an.segmentStart),an.patternVertexArray.emplaceBack(mn,Xn,an.segmentStart)}an.segmentPoints.length=0}an.e1=an.e2=-1};if(Ut&&$t<Rk){this.updateDistance(De,ve),this.addCurrentVertex(ve,ze,1,1,_e,lt),Et(this),this.addCurrentVertex(ve,Je,-1,-1,_e,lt);continue}if(De){if(!ke){this.updateDistance(De,ve),this.addCurrentVertex(ve,ze,1,1,_e,lt),Et(this);continue}vt="miter"}}let tn=ze.add(Je);tn.x===0&&tn.y===0||tn._unit();const qt=tn.x*Je.x+tn.y*Je.y,Jt=qt!==0?1/qt:1/0,on=2*Math.sqrt(2-2*qt),Bt=qt<Ik&&De&&ke,Qt=ze.x*Je.y-ze.y*Je.x>0,Dt=this.overscaling<=16?15*hn/(512*this.overscaling):0;if(Ut&&vt==="round"){if(Jt<w)vt="miter";else if(Jt<=2){const Et=Zb(ve,-10,hn+10);vt=this.elevationType==="offset"&&(Et||this.hasCrossSlope)?"miter":"fakeround"}}if(vt==="miter"&&Jt>m&&(vt="bevel"),vt==="bevel"&&(Jt>2&&(vt="flipbevel"),Jt<m&&(vt="miter")),De&&!(vt==="miter"&&Bt)&&this.updateDistance(De,ve),vt==="miter")if(Bt){const Et=ve.dist(De);if(Et>2*Dt){const rn=ve.sub(ve.sub(De)._mult(Dt/Et)._round());this.updateDistance(De,rn),this.addCurrentVertex(rn,ze,0,0,_e,lt),De=rn}this.updateDistance(De,ve),tn._mult(Jt),this.addCurrentVertex(ve,tn,0,0,_e,lt);const an=ve.dist(ke);if(an>2*Dt){const rn=ve.add(ke.sub(ve)._mult(Dt/an)._round());this.updateDistance(ve,rn),this.addCurrentVertex(rn,Je,0,0,_e,lt),ve=rn}}else tn._mult(Jt),this.addCurrentVertex(ve,tn,0,0,_e,lt);else if(vt==="flipbevel"){if(Jt>100)tn=Je.mult(-1);else{const Et=Jt*ze.add(Je).mag()/ze.sub(Je).mag();tn._perp()._mult(Et*(Qt?-1:1))}this.addCurrentVertex(ve,tn,0,0,_e,lt),this.addCurrentVertex(ve,tn.mult(-1),0,0,_e,lt)}else if(vt==="bevel"||vt==="fakeround"){lt!=null&&De&&this.addCurrentVertex(ve,st||ze,-1,-1,_e,lt);const Et=ve.dist(De)<=2*Dt&&vt!=="bevel",an=tn.mult(Qt?1:-1);an._mult(Jt);const rn=Je.mult(Qt?-1:1),Xn=ze.mult(Qt?-1:1),Rn=this.evaluateLineProgressFeatures(this.distance);if(lt==null&&(this.addHalfVertex(ve,an.x,an.y,!1,!Qt,0,_e,Rn),Et||this.addHalfVertex(ve,an.x+2*Xn.x,an.y+2*Xn.y,!1,Qt,0,_e,Rn)),vt==="fakeround"){const Un=Math.round(180*on/Math.PI/20);this.addHalfVertex(ve,Xn.x,Xn.y,!1,Qt,0,_e,Rn);for(let mn=0;mn<Un;mn++){let Wn=mn/Un;if(Wn!==.5){const bn=Wn-.5;Wn+=Wn*bn*(Wn-1)*((1.0904+$t*($t*(3.55645-1.43519*$t)-3.2452))*bn*bn+(.848013+$t*(.215638*$t-1.06021)))}const pr=rn.sub(Xn)._mult(Wn)._add(Xn)._unit();this.addHalfVertex(ve,pr.x,pr.y,!1,Qt,0,_e,Rn)}this.addHalfVertex(ve,rn.x,rn.y,!1,Qt,0,_e,Rn)}Et||lt!=null||this.addHalfVertex(ve,an.x+2*rn.x,an.y+2*rn.y,!1,Qt,0,_e,Rn),lt!=null&&ke&&this.addCurrentVertex(ve,Qe||Je,1,1,_e,lt)}else if(vt==="butt")this.addCurrentVertex(ve,tn,0,0,_e,lt);else if(vt==="square"){if(!De){const Et=U?0:-1;this.addCurrentVertex(ve,tn,Et,Et,_e,lt)}if(this.addCurrentVertex(ve,tn,0,0,_e,lt),De){const Et=$?0:1;this.addCurrentVertex(ve,tn,Et,Et,_e,lt)}}else if(vt==="round"){if(De){const Et=!Ut&&st?st:ze;this.addCurrentVertex(ve,Et,0,0,_e,lt),!Ut&&$||this.addCurrentVertex(ve,Et,1,1,_e,lt,!0)}if(ke){const Et=!Ut&&Qe?Qe:Je;!Ut&&U||this.addCurrentVertex(ve,Et,-1,-1,_e,lt,!0),this.addCurrentVertex(ve,Et,0,0,_e,lt)}}}}addVerticesTo(e,i,l,u,f,m,w,C,M,B){const U=(i.w-e.w)/this.tessellationStep|0;let $=0;const Q=this.scaledDistance;if(U>1){this.lineSoFar=e.w;const he=(i.x-e.x)/U,_e=(i.y-e.y)/U,ve=(i.z-e.z)/U,De=(i.w-e.w)/U;for(let ke=1;ke<U;++ke){e.x+=he,e.y+=_e,e.z+=ve,this.lineSoFar+=De,$+=De;const ze=this.evaluateLineProgressFeatures(this.prevDistance+$);this.scaledDistance=(this.prevDistance+$)/this.totalDistance,this.addHalfVertex(e,l,u,B,!1,w,M,ze),this.addHalfVertex(e,f,m,B,!0,-C,M,ze)}}this.lineSoFar=i.w,this.scaledDistance=Q;const ee=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,l,u,B,!1,w,M,ee),this.addHalfVertex(i,f,m,B,!0,-C,M,ee)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Vr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,l,u,f,m,w=!1){const C=i.x+i.y*l,M=i.y-i.x*l,B=i.y*u-i.x,U=-i.y-i.x*u;if(m!=null){const $=this.elevationType==="offset",Q=-10,ee=hn+10,he=m.zOffset,_e=new vC(e.x,e.y,he,this.lineSoFar),ve=!!$&&Zb(e,Q,ee),De=this.lineSoFar,ke=this.distance;if(this.currentVertex)if(ve){const ze=this.currentVertexIsOutside,Je=this.currentVertex,Qe=new vC(e.x,e.y,he,this.lineSoFar);if(bC(Je,Qe,Q,ee),!Zb(Qe,Q,ee)){if(ze){this.e1=this.e2=-1,this.distance-=Je.dist(_e),this.lineSoFar=Je.w;const st=this.evaluateLineProgressFeatures(Je.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Je,C,M,w,!1,l,f,st),this.addHalfVertex(Je,B,U,w,!0,-u,f,st),this.prevDistance=this.distance}this.distance=this.prevDistance+Je.dist(Qe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Je,Qe,C,M,B,U,l,u,f,w),this.distance=ke,this.scaledDistance=this.distance/this.totalDistance}}else{const ze=this.currentVertex;if(this.currentVertexIsOutside){bC(ze,_e,Q,ee),this.e1=this.e2=-1,this.distance-=ze.dist(_e),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ze.w;const Je=this.evaluateLineProgressFeatures(ze.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ze,C,M,w,!1,l,f,Je),this.addHalfVertex(ze,B,U,w,!0,-u,f,Je),this.prevDistance=this.distance,this.distance=ke,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ze,_e,C,M,B,U,l,u,f,w)}else ve||(this.addHalfVertex(e,C,M,w,!1,l,f,m),this.addHalfVertex(e,B,U,w,!0,-u,f,m));this.currentVertex=_e,this.currentVertexIsOutside=ve,this.lineSoFar=De}else this.addHalfVertex(e,C,M,w,!1,l,f,m),this.addHalfVertex(e,B,U,w,!0,-u,f,m)}addHalfVertex({x:e,y:i},l,u,f,m,w,C,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const U=Qn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,U)}const B=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),C.primitiveLength++),m?this.e2=B:this.e1=B,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Zb(o,e,i){return o.x<e||o.x>i||o.y<e||o.y>i}let JC,QC;function eE(o,e,i){return e*(hn/(o.tileSize*Math.pow(2,i-o.tileID.overscaledZ)))}In(Wb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const tE=(o,e,i)=>(1-i)*o+i*e;function nE(o,e){return 1/eE(o,1,e.tileZoom)}function rE(o,e,i,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const iE=o=>{const e=[];oE(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=o.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function oE(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Yb;const sE=()=>Yb||(Yb={layout:JC||(JC=new oo({"line-cap":new wn(yt.layout_line["line-cap"]),"line-join":new wn(yt.layout_line["line-join"]),"line-miter-limit":new ln(yt.layout_line["line-miter-limit"]),"line-round-limit":new ln(yt.layout_line["line-round-limit"]),"line-sort-key":new wn(yt.layout_line["line-sort-key"]),"line-z-offset":new wn(yt.layout_line["line-z-offset"]),"line-elevation-reference":new ln(yt.layout_line["line-elevation-reference"]),"line-cross-slope":new ln(yt.layout_line["line-cross-slope"]),visibility:new ln(yt.layout_line.visibility),"line-width-unit":new ln(yt.layout_line["line-width-unit"])})),paint:QC||(QC=new oo({"line-opacity":new wn(yt.paint_line["line-opacity"]),"line-color":new wn(yt.paint_line["line-color"]),"line-translate":new ln(yt.paint_line["line-translate"]),"line-translate-anchor":new ln(yt.paint_line["line-translate-anchor"]),"line-width":new wn(yt.paint_line["line-width"]),"line-gap-width":new wn(yt.paint_line["line-gap-width"]),"line-offset":new wn(yt.paint_line["line-offset"]),"line-blur":new wn(yt.paint_line["line-blur"]),"line-dasharray":new wn(yt.paint_line["line-dasharray"]),"line-pattern":new wn(yt.paint_line["line-pattern"]),"line-pattern-cross-fade":new ln(yt.paint_line["line-pattern-cross-fade"]),"line-gradient":new Wu(yt.paint_line["line-gradient"]),"line-trim-offset":new ln(yt.paint_line["line-trim-offset"]),"line-trim-fade-range":new ln(yt.paint_line["line-trim-fade-range"]),"line-trim-color":new ln(yt.paint_line["line-trim-color"]),"line-emissive-strength":new ln(yt.paint_line["line-emissive-strength"]),"line-border-width":new wn(yt.paint_line["line-border-width"]),"line-border-color":new wn(yt.paint_line["line-border-color"]),"line-occlusion-opacity":new ln(yt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},Yb);class Dk extends wn{possiblyEvaluate(e,i){return i=new ki(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,l,u){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,l,u)}}let Y_;function aE(o,e){return e>0?e+2*o:o}const kk=jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ok=jr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Lk=jr([{name:"a_projected_pos",components:4,type:"Float32"}],4);jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zk=jr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Fk=jr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Bk=jr([{name:"a_texb",components:2,type:"Uint16"}]),Nk=jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Vk=jr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lE=jr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Uk=jr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);jr([{name:"triangle",components:3,type:"Uint16"}]),jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),jr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),jr([{type:"Float32",name:"offsetX"}]),jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ss=24;function jk(o,e,i){return o.sections.forEach((l=>{l.text=(function(u,f,m){const w=f.layout.get("text-transform").evaluate(m,{});return w==="uppercase"?u=u.toLocaleUpperCase():w==="lowercase"&&(u=u.toLocaleLowerCase()),Yl.applyArabicShaping&&(u=Yl.applyArabicShaping(u)),u})(l.text,e,i)})),o}const X_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Gk(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function $k(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const Xb=4294967296,cE=1/Xb,uE=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Rv=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,i=this.length){for(;this.pos<i;){const l=this.readVarint(),u=l>>3,f=this.pos;this.type=7&l,o(u,e,this),this.pos===f&&this.skip(l)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Xb;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Xb;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let i,l;return l=e[this.pos++],i=127&l,l<128?i:(l=e[this.pos++],i|=(127&l)<<7,l<128?i:(l=e[this.pos++],i|=(127&l)<<14,l<128?i:(l=e[this.pos++],i|=(127&l)<<21,l<128?i:(l=e[this.pos],i|=(15&l)<<28,(function(u,f,m){const w=m.buf;let C,M;if(M=w[m.pos++],C=(112&M)>>4,M<128||(M=w[m.pos++],C|=(127&M)<<3,M<128)||(M=w[m.pos++],C|=(127&M)<<10,M<128)||(M=w[m.pos++],C|=(127&M)<<17,M<128)||(M=w[m.pos++],C|=(127&M)<<24,M<128)||(M=w[m.pos++],C|=(1&M)<<31,M<128))return Pg(u,C,f);throw new Error("Expected varint not more than 10 bytes")})(i,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&uE?uE.decode(this.buf.subarray(e,o)):(function(i,l,u){let f="",m=l;for(;m<u;){const w=i[m];let C,M,B,U=null,$=w>239?4:w>223?3:w>191?2:1;if(m+$>u)break;$===1?w<128&&(U=w):$===2?(C=i[m+1],(192&C)==128&&(U=(31&w)<<6|63&C,U<=127&&(U=null))):$===3?(C=i[m+1],M=i[m+2],(192&C)==128&&(192&M)==128&&(U=(15&w)<<12|(63&C)<<6|63&M,(U<=2047||U>=55296&&U<=57343)&&(U=null))):$===4&&(C=i[m+1],M=i[m+2],B=i[m+3],(192&C)==128&&(192&M)==128&&(192&B)==128&&(U=(15&w)<<18|(63&C)<<12|(63&M)<<6|63&B,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,$=1):U>65535&&(U-=65536,f+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),f+=String.fromCharCode(U),m+=$}return f})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const i=this.readPackedEnd();for(;this.pos<i;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*cE),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*cE),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,i){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(f,m,w){w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,f>>>=7,w.buf[w.pos++]=127&f|128,w.buf[w.pos]=127&(f>>>=7)})(l,0,i),(function(f,m){const w=(7&f)<<4;m.buf[m.pos++]|=w|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))})(u,i)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(l,u,f){for(let m,w,C=0;C<u.length;C++){if(m=u.charCodeAt(C),m>55295&&m<57344){if(!w){m>56319||C+1===u.length?(l[f++]=239,l[f++]=191,l[f++]=189):w=m;continue}if(m<56320){l[f++]=239,l[f++]=191,l[f++]=189,w=m;continue}m=w-55296<<10|m-56320|65536,w=null}else w&&(l[f++]=239,l[f++]=191,l[f++]=189,w=null);m<128?l[f++]=m:(m<2048?l[f++]=m>>6|192:(m<65536?l[f++]=m>>12|224:(l[f++]=m>>18|240,l[f++]=m>>12&63|128),l[f++]=m>>6&63|128),l[f++]=63&m|128)}return f})(this.buf,o,this.pos);const i=this.pos-e;i>=128&&dE(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=o[i]}writeRawMessage(o,e){this.pos++;const i=this.pos;o(e,this);const l=this.pos-i;l>=128&&dE(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeMessage(o,e,i){this.writeTag(o,2),this.writeRawMessage(e,i)}writePackedVarint(o,e){e.length&&this.writeMessage(o,Hk,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,qk,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,Yk,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,Wk,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,Zk,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,Xk,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,Kk,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,Jk,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,Qk,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function Pg(o,e,i){return i?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function dE(o,e,i){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(let u=i.pos-1;u>=o;u--)i.buf[u+l]=i.buf[u]}function Hk(o,e){for(let i=0;i<o.length;i++)e.writeVarint(o[i])}function qk(o,e){for(let i=0;i<o.length;i++)e.writeSVarint(o[i])}function Wk(o,e){for(let i=0;i<o.length;i++)e.writeFloat(o[i])}function Zk(o,e){for(let i=0;i<o.length;i++)e.writeDouble(o[i])}function Yk(o,e){for(let i=0;i<o.length;i++)e.writeBoolean(o[i])}function Xk(o,e){for(let i=0;i<o.length;i++)e.writeFixed32(o[i])}function Kk(o,e){for(let i=0;i<o.length;i++)e.writeSFixed32(o[i])}function Jk(o,e){for(let i=0;i<o.length;i++)e.writeFixed64(o[i])}function Qk(o,e){for(let i=0;i<o.length;i++)e.writeSFixed64(o[i])}const Kb=3;function eO(o,e,i){e.glyphs=[],o===1&&i.readMessage(tO,e)}function tO(o,e,i){if(o===3){const{id:l,bitmap:u,width:f,height:m,left:w,top:C,advance:M}=i.readMessage(nO,{});e.glyphs.push({id:l,bitmap:new Sp({width:f+2*Kb,height:m+2*Kb},u),metrics:{width:f,height:m,left:w,top:C,advance:M}})}else o===4?e.ascender=i.readSVarint():o===5&&(e.descender=i.readSVarint())}function nO(o,e,i){o===1?e.id=i.readVarint():o===2?e.bitmap=i.readBytes():o===3?e.width=i.readVarint():o===4?e.height=i.readVarint():o===5?e.left=i.readSVarint():o===6?e.top=i.readSVarint():o===7&&(e.advance=i.readVarint())}const hE=Kb,Rl={horizontal:1,vertical:2,horizontalOnly:3};class K_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const l=new K_;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new K_;return i.image=e,i}}class Mg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,l){const u=new Mg;for(let f=0;f<e.sections.length;f++){const m=e.sections[f];m.image?u.addImageSection(m,l):u.addTextSection(m,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,l){let u="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,w=i.charCodeAt(f-1)||null;u+=!l&&(m&&op(m)&&!X_[i[f+1]]||w&&op(w)&&!X_[i[f-1]])||!X_[i[f]]?i[f]:X_[i[f]]}return u})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Dv[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Dv[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new Mg;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(K_.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,i){const l=e.image?e.image.getPrimary():null;if(!l)return void Vr("Can't add FormattedSection with an empty image.");l.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(K_.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jb(o,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he=1){const _e=Mg.fromFeature(o,u,he);U===Rl.vertical&&_e.verticalizePunctuation($);let ve=[];const De=(function(st,lt,ft,Ut,vt,$t){if(!st)return[];const tn=[],qt=(function(Qt,Dt,Et,an,rn,Xn){let Rn=0;for(let Un=0;Un<Qt.length();Un++){const mn=Qt.getSection(Un);Rn+=fE(Qt.getCodePoint(Un),mn,an,rn,Dt,Xn)}return Rn/Math.max(1,Math.ceil(Rn/Et))})(st,lt,ft,Ut,vt,$t),Jt=st.text.indexOf("")>=0;let on=0;for(let Qt=0;Qt<st.length();Qt++){const Dt=st.getSection(Qt),Et=st.getCodePoint(Qt);if(Dv[Et]||(on+=fE(Et,Dt,Ut,vt,lt,$t)),Qt<st.length()-1){const an=!((Bt=Et)<11904||!(rr["Bopomofo Extended"](Bt)||rr.Bopomofo(Bt)||rr["CJK Compatibility Forms"](Bt)||rr["CJK Compatibility Ideographs"](Bt)||rr["CJK Compatibility"](Bt)||rr["CJK Radicals Supplement"](Bt)||rr["CJK Strokes"](Bt)||rr["CJK Symbols and Punctuation"](Bt)||rr["CJK Unified Ideographs Extension A"](Bt)||rr["CJK Unified Ideographs"](Bt)||rr["Enclosed CJK Letters and Months"](Bt)||rr["Halfwidth and Fullwidth Forms"](Bt)||rr.Hiragana(Bt)||rr["Ideographic Description Characters"](Bt)||rr["Kangxi Radicals"](Bt)||rr["Katakana Phonetic Extensions"](Bt)||rr.Katakana(Bt)||rr["Vertical Forms"](Bt)||rr["Yi Radicals"](Bt)||rr["Yi Syllables"](Bt)));(rO[Et]||an||Dt.image)&&tn.push(mE(Qt+1,on,qt,tn,iO(Et,st.getCodePoint(Qt+1),an&&Jt),!1))}}var Bt;return gE(mE(st.length(),on,qt,tn,0,!0))})(_e,M,f,e,l,Q),{processBidirectionalText:ke,processStyledBidirectionalText:ze}=Yl;if(ke&&_e.sections.length===1){const st=ke(_e.toString(),De);for(const lt of st){const ft=new Mg;ft.text=lt,ft.sections=_e.sections;for(let Ut=0;Ut<lt.length;Ut++)ft.sectionIndex.push(0);ve.push(ft)}}else if(ze){const st=ze(_e.text,_e.sectionIndex,De);for(const lt of st){const ft=new Mg;ft.text=lt[0],ft.sectionIndex=lt[1],ft.sections=_e.sections,ve.push(ft)}}else ve=(function(st,lt){const ft=[],Ut=st.text;let vt=0;for(const $t of lt)ft.push(st.substring(vt,$t)),vt=$t;return vt<Ut.length&&ft.push(st.substring(vt,Ut.length)),ft})(_e,De);const Je=[],Qe={positionedLines:Je,text:_e.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(st,lt,ft,Ut,vt,$t,tn,qt,Jt,on,Bt,Qt){let Dt=0,Et=0,an=0;const rn=qt==="right"?1:qt==="left"?0:.5;let Xn=!1;for(const bn of vt){const Hn=bn.getSections();for(const cr of Hn){if(cr.image)continue;const xr=lt[cr.fontStack];if(xr&&(Xn=xr.ascender!==void 0&&xr.descender!==void 0,!Xn))break}if(!Xn)break}let Rn=0;for(const bn of vt){bn.trim();const Hn=bn.getMaxScale(),cr=(Hn-1)*Ss,xr={positionedGlyphs:[],lineOffset:0};st.positionedLines[Rn]=xr;const kr=xr.positionedGlyphs;let Cr=0;if(!bn.length()){Et+=$t,++Rn;continue}let Ln=0,Sr=0;for(let Ne=0;Ne<bn.length();Ne++){const Ve=bn.getSection(Ne),Mt=bn.getSectionIndex(Ne),Vt=bn.getCodePoint(Ne);let xn=Ve.scale,vn=null,Dn=null,Jn=null,Or=Ss,Lr=0,Rr=Jt;Rr===Rl.vertical&&((Un=Vt)===12312||Un===12313||Un===12316||Un===12540||Un===12448)&&(Rr=Rl.horizontal);const xi=!(Rr===Rl.horizontal||!Bt&&!ip(Vt)||Bt&&(Dv[Vt]||C_(Vt)));if(Ve.image){const to=Ut.get(Ve.image.toString());if(!to)continue;Jn=Ve.image,st.iconsInText=st.iconsInText||!0,Dn=to.paddedRect;const Mr=to.displaySize;xn=xn*Ss/Qt,vn={width:Mr[0],height:Mr[1],left:0,top:-hE,advance:xi?Mr[1]:Mr[0],localGlyph:!1},Lr=Xn?-vn.height*xn:Hn*Ss-17-Mr[1]*xn,Or=vn.advance;const Vi=(xi?Mr[0]:Mr[1])*xn-Ss*Hn;Vi>0&&Vi>Cr&&(Cr=Vi)}else{const to=ft[Ve.fontStack];if(!to)continue;to[Vt]&&(Dn=to[Vt]);const Mr=lt[Ve.fontStack];if(!Mr)continue;const Vi=Mr.glyphs[Vt];if(!Vi)continue;if(vn=Vi.metrics,Or=Vt!==8203?Ss:0,Xn){const Si=Mr.ascender!==void 0?Math.abs(Mr.ascender):0,pi=Mr.descender!==void 0?Math.abs(Mr.descender):0,Hi=(Si+pi)*xn;Ln<Hi&&(Ln=Hi,Sr=(Si-pi)/2*xn),Lr=-Si*xn}else Lr=(Hn-xn)*Ss-17}xi?(st.verticalizable=!0,kr.push({glyph:Vt,image:Jn,x:Dt,y:Et+Lr,vertical:xi,scale:xn,localGlyph:vn.localGlyph,fontStack:Ve.fontStack,sectionIndex:Mt,metrics:vn,rect:Dn}),Dt+=Or*xn+on):(kr.push({glyph:Vt,image:Jn,x:Dt,y:Et+Lr,vertical:xi,scale:xn,localGlyph:vn.localGlyph,fontStack:Ve.fontStack,sectionIndex:Mt,metrics:vn,rect:Dn}),Dt+=vn.advance*xn+on)}kr.length!==0&&(an=Math.max(Dt-on,an),Xn?_E(kr,rn,Cr,Sr,$t*Hn/2):_E(kr,rn,Cr,0,$t/2)),Dt=0;const Kr=$t*Hn+Cr;xr.lineOffset=Math.max(Cr,cr),Et+=Kr,++Rn}var Un;const mn=Et,{horizontalAlign:Wn,verticalAlign:pr}=Qb(tn);(function(bn,Hn,cr,xr,kr,Cr){const Ln=(Hn-cr)*kr,Sr=-Cr*xr;for(const Kr of bn)for(const Ne of Kr.positionedGlyphs)Ne.x+=Ln,Ne.y+=Sr})(st.positionedLines,rn,Wn,pr,an,mn),st.top+=-pr*mn,st.bottom=st.top+mn,st.left+=-Wn*an,st.right=st.left+an,st.hasBaseline=Xn})(Qe,e,i,l,ve,m,w,C,U,M,$,ee),!(function(st){for(const lt of st)if(lt.positionedGlyphs.length!==0)return!1;return!0})(Je))return Qe}const Dv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fE(o,e,i,l,u,f){if(e.image){const m=l.get(e.image.toString());return m?m.displaySize[0]*e.scale*Ss/f+u:0}{const m=i[e.fontStack],w=m&&m.glyphs[o];return w?w.metrics.advance*e.scale+u:0}}function pE(o,e,i,l){const u=Math.pow(o-e,2);return l?o<e?u/2:2*u:u+Math.abs(i)*i}function iO(o,e,i){let l=0;return o===10&&(l-=1e4),i&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function mE(o,e,i,l,u,f){let m=null,w=pE(e,i,u,f);for(const C of l){const M=pE(e-C.x,i,u,f)+C.badness;M<=w&&(m=C,w=M)}return{index:o,x:e,priorBreak:m,badness:w}}function gE(o){return o?gE(o.priorBreak).concat(o.index):[]}function Qb(o){let e=.5,i=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function _E(o,e,i,l,u){if(!(e||i||l||u))return;const f=o.length-1,m=o[f],w=(m.x+m.metrics.advance*m.scale)*e;for(let C=0;C<=f;C++)o[C].x-=w,o[C].y+=i+l+u}function yE(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function oO(o,e,i,l){const{horizontalAlign:u,verticalAlign:f}=Qb(l),m=i[0]-o.displaySize[0]*u,w=i[1]-o.displaySize[1]*f;return{imagePrimary:o,imageSecondary:e,top:w,bottom:w+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function vE(o,e,i,l,u,f){const m=o.imagePrimary;let w;if(m.content){const _e=m.content,ve=m.pixelRatio||1;w=[_e[0]/ve,_e[1]/ve,m.displaySize[0]-_e[2]/ve,m.displaySize[1]-_e[3]/ve]}const C=e.left*f,M=e.right*f;let B,U,$,Q;i==="width"||i==="both"?(Q=u[0]+C-l[3],U=u[0]+M+l[1]):(Q=u[0]+(C+M-m.displaySize[0])/2,U=Q+m.displaySize[0]);const ee=e.top*f,he=e.bottom*f;return i==="height"||i==="both"?(B=u[1]+ee-l[0],$=u[1]+he+l[2]):(B=u[1]+(ee+he-m.displaySize[1])/2,$=B+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:B,right:U,bottom:$,left:Q,collisionPadding:w}}function xE(o){return!o.imagePrimary.stretchX}function bE(o){return!o.imagePrimary.stretchY}function wE(o){return{width:o.right-o.left,height:o.bottom-o.top}}const th=128;function SE(o,e,i){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ki(o+1,{worldview:i}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let m=0;for(;m<u.length&&u[m]<=o;)m++;m=Math.max(0,m-1);let w=m;for(;w<u.length&&u[w]<o+1;)w++;w=Math.min(u.length-1,w);const C=u[m],M=u[w];return l.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:C,maxZoom:M,minSize:l.evaluate(new ki(C,{worldview:i})),maxSize:l.evaluate(new ki(M,{worldview:i})),interpolationType:f}}}function e2(o,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:u}){return o.kind==="source"?l/th:o.kind==="composite"?Qn(l/th,u/th,i):e}function J_(o,e,i=1){let l=0,u=0;if(o.kind==="constant")u=o.layoutSize*i;else if(o.kind!=="source"){const{interpolationType:f,minZoom:m,maxZoom:w}=o,C=f?et(ha.interpolationFactor(f,e,m,w),0,1):0;o.kind==="camera"?u=Qn(o.minSize,o.maxSize,C)*i:l=C*i}return{uSizeT:l,uSize:u}}class sf extends Kt{constructor(e,i,l,u,f){super(e,i),this.angle=u,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new sf(this.x,this.y,this.z,this.angle,this.segment)}}function TE(o,e,i,l,u){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,w=0;for(;w>-i/2;){if(m--,m<0)return!1;w-=o[m].dist(f),f=o[m]}w+=o[m].dist(o[m+1]),m++;const C=[];let M=0;for(;w<i/2;){const B=o[m],U=o[m+1];if(!U)return!1;let $=o[m-1].angleTo(B)-B.angleTo(U);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:$}),M+=$;w-C[0].distance>l;)M-=C.shift().angleDelta;if(M>u)return!1;m++,w+=B.dist(U)}return!0}function CE(o){let e=0;for(let i=0;i<o.length-1;i++)e+=o[i].dist(o[i+1]);return e}function EE(o,e,i){return o?.6*e*i:0}function AE(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function sO(o,e,i,l,u,f){const m=EE(i,u,f),w=AE(i,l)*f;let C=0;const M=CE(o)/2;for(let B=0;B<o.length-1;B++){const U=o[B],$=o[B+1],Q=U.dist($);if(C+Q>M){const ee=(M-C)/Q,he=Qn(U.x,$.x,ee),_e=Qn(U.y,$.y,ee),ve=new sf(he,_e,0,$.angleTo(U),B);return!m||TE(o,ve,w,m,e)?ve:void 0}C+=Q}}function aO(o,e,i,l,u,f,m,w,C){const M=EE(l,f,m),B=AE(l,u),U=B*m,$=o[0].x===0||o[0].x===C||o[0].y===0||o[0].y===C;return e-U<e/4&&(e=U+e/4),PE(o,$?e/2*w%e:(B/2+2*f)*m*w%e,e,M,i,U,$,!1,C)}function PE(o,e,i,l,u,f,m,w,C){const M=f/2,B=CE(o);let U=0,$=e-i,Q=[];for(let ee=0;ee<o.length-1;ee++){const he=o[ee],_e=o[ee+1],ve=he.dist(_e),De=_e.angleTo(he);for(;$+i<U+ve;){$+=i;const ke=($-U)/ve,ze=Qn(he.x,_e.x,ke),Je=Qn(he.y,_e.y,ke);if(ze>=0&&ze<C&&Je>=0&&Je<C&&$-M>=0&&$+M<=B){const Qe=new sf(ze,Je,0,De,ee);l&&!TE(o,Qe,f,l,u)||Q.push(Qe)}}U+=ve}return w||Q.length||m||(Q=PE(o,U/2,i,l,u,f,m,!0,C)),Q}function ME(o){let e=0,i=0;for(const m of o)e+=m.w*m.h,i=Math.max(i,m.w);o.sort(((m,w)=>w.h-m.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const m of o)for(let w=l.length-1;w>=0;w--){const C=l[w];if(!(m.w>C.w||m.h>C.h)){if(m.x=C.x,m.y=C.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===C.w&&m.h===C.h){const M=l.pop();M&&w<l.length&&(l[w]=M)}else m.h===C.h?(C.x+=m.w,C.w-=m.w):m.w===C.w?(C.y+=m.h,C.h-=m.h):(l.push({x:C.x+m.w,y:C.y,w:C.w-m.w,h:m.h}),C.y+=m.h,C.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}In(sf,"Anchor");const Pm=1;class Q_{static getImagePositionScale(e,i,l){if(i&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:l,y:l}}constructor(e,i,l,u){this.paddedRect=e;const{pixelRatio:f,version:m,stretchX:w,stretchY:C,content:M,sdf:B,usvg:U}=i;this.pixelRatio=f,this.stretchX=w,this.stretchY=C,this.content=M,this.version=m,this.padding=l,this.sdf=B,this.usvg=U,this.scale=Q_.getImagePositionScale(u,U,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function t2(o,e,i){const l=Ia.parse(o),u=(function(f,m,w=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*w[0])+2*m,h:(f.data?f.data.height:f.height*w[1])+2*m}})(e,i,[l.options.transform.a,l.options.transform.d]);return{bin:u,imagePosition:new Q_(u,e,i,l),imageVariant:l}}class IE{constructor(e,i,l){const u=new Map,f=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,u,Pm,m),this.addImages(i,f,2,m);const{w,h:C}=ME(m),M=new ia({width:w||1,height:C||1});for(const[B,U]of e.entries()){const $=u.get(B).paddedRect;ia.copy(U.data,M,{x:0,y:0},{x:$.x+Pm,y:$.y+Pm},U.data,null,U.sdf)}for(const[B,U]of i.entries()){const $=f.get(B),Q=$.paddedRect;let ee=$.padding;const he=Q.x+ee,_e=Q.y+ee,ve=U.data.width,De=U.data.height;ee=ee>1?ee-1:ee,ia.copy(U.data,M,{x:0,y:0},{x:he,y:_e},U.data,l),ia.copy(U.data,M,{x:0,y:De-ee},{x:he,y:_e-ee},{width:ve,height:ee},l),ia.copy(U.data,M,{x:0,y:0},{x:he,y:_e+De},{width:ve,height:ee},l),ia.copy(U.data,M,{x:ve-ee,y:0},{x:he-ee,y:_e},{width:ee,height:De},l),ia.copy(U.data,M,{x:0,y:0},{x:he+ve,y:_e},{width:ee,height:De},l),ia.copy(U.data,M,{x:ve-ee,y:De-ee},{x:he-ee,y:_e-ee},{width:ee,height:ee},l),ia.copy(U.data,M,{x:0,y:De-ee},{x:he+ve,y:_e-ee},{width:ee,height:ee},l),ia.copy(U.data,M,{x:0,y:0},{x:he+ve,y:_e+De},{width:ee,height:ee},l),ia.copy(U.data,M,{x:ve-ee,y:0},{x:he-ee,y:_e+De},{width:ee,height:ee},l)}this.lut=l,this.image=M,this.iconPositions=u,this.patternPositions=f}addImages(e,i,l,u){for(const[f,m]of e.entries()){const{bin:w,imagePosition:C,imageVariant:M}=t2(f,m,l);i.set(f,C),u.push(w),m.hasRenderCallback&&this.haveRenderCallbacks.push(M.id)}}patchUpdatedImages(e,i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((u=>e.hasImage(u,l))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const f of this.iconPositions.keys()){const m=Ia.parse(f);if(xa.isEqual(m.id,u)){const w=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(f),w,i,null)}}for(const f of this.patternPositions.keys()){const m=Ia.parse(f);if(xa.isEqual(m.id,u)){const w=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(f),w,i,this.lut)}}}}patchUpdatedImage(e,i,l,u=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,m]=e.tl,w=e.sdf;if(this.lut||w){const C={width:i.data.width,height:i.data.height},M=new ia(C);ia.copy(i.data,M,{x:0,y:0},{x:0,y:0},C,u,w),l.update(M,{position:{x:f,y:m}})}else l.update(i.data,{position:{x:f,y:m}})}}In(Q_,"ImagePosition"),In(IE,"ImageAtlas");const e0=1e20;function RE(o,e,i,l,u,f,m,w,C){for(let M=e;M<e+l;M++)DE(o,i*f+M,f,u,m,w,C);for(let M=i;M<i+u;M++)DE(o,M*f+e,1,l,m,w,C)}function DE(o,e,i,l,u,f,m){f[0]=0,m[0]=-e0,m[1]=e0,u[0]=o[e];for(let w=1,C=0,M=0;w<l;w++){u[w]=o[e+w*i];const B=w*w;do{const U=f[C];M=(u[w]-u[U]+B-U*U)/(w-U)/2}while(M<=m[C]&&--C>-1);C++,f[C]=w,m[C]=M,m[C+1]=e0}for(let w=0,C=0;w<l;w++){for(;m[C+1]<w;)C++;const M=f[C],B=w-M;o[e+w*i]=u[M]+B*B}}const rd=2,n2={none:0,ideographs:1,all:2};class Ig{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[],u=this.url||Oo.GLYPHS_URL;for(const f in e)for(const m of e[f])l.push({stack:f,id:m});Rt(l,(({stack:f,id:m},w)=>{let C=this.entries[f];C||(C=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=C.glyphs[m];if(M!==void 0)return void w(null,{stack:f,id:m,glyph:M});if(M=this._tinySDF(C,f,m),M)return C.glyphs[m]=M,void w(null,{stack:f,id:m,glyph:M});const B=Math.floor(m/256);if(256*B>65535)return Vr("glyphs > 65535 not supported"),void w(null,{stack:f,id:m,glyph:M});if(C.ranges[B])return void w(null,{stack:f,id:m,glyph:M});let U=C.requests[B];U||(U=C.requests[B]=[],Ig.loadGlyphRange(f,B,u,this.requestManager,(($,Q)=>{if(Q){C.ascender=Q.ascender,C.descender=Q.descender;for(const ee in Q.glyphs)this._doesCharSupportLocalGlyph(+ee)||(C.glyphs[+ee]=Q.glyphs[+ee]);C.ranges[B]=!0}for(const ee of U)ee($,Q);delete C.requests[B]}))),U.push((($,Q)=>{$?w($):Q&&w(null,{stack:f,id:m,glyph:Q.glyphs[m]||null})}))}),((f,m)=>{if(f)i(f);else if(m){const w={};for(const{stack:C,id:M,glyph:B}of m)w[C]===void 0&&(w[C]={}),w[C].glyphs===void 0&&(w[C].glyphs={}),w[C].glyphs[M]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics},w[C].ascender=this.entries[C].ascender,w[C].descender=this.entries[C].descender;i(null,w)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==n2.none&&(this.localGlyphMode===n2.all?!!this.localFontFamily:!!this.localFontFamily&&(rr["CJK Unified Ideographs"](e)||rr["Hangul Syllables"](e)||rr.Hiragana(e)||rr.Katakana(e)||rr["CJK Symbols and Punctuation"](e)||rr["CJK Unified Ideographs Extension A"](e)||rr["CJK Unified Ideographs Extension B"](e)||rr.Osage(e)))}_tinySDF(e,i,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let he="400";/bold/i.test(i)?he="900":/medium/i.test(i)?he="500":/light/i.test(i)&&(he="200"),f=e.tinySDF=new Ig.TinySDF({fontFamily:u,fontWeight:he,fontSize:24*rd,buffer:3*rd,radius:8*rd}),f.fontWeight=he}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const m=String.fromCodePoint(l),{data:w,width:C,height:M,glyphWidth:B,glyphHeight:U,glyphLeft:$,glyphTop:Q,glyphAdvance:ee}=f.draw(m);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Sp({width:C,height:M},w),metrics:{width:B/rd,height:U/rd,left:$/rd,top:Q/rd-27,advance:ee/rd,localGlyph:!0}}}}Ig.loadGlyphRange=function(o,e,i,l,u){const f=256*e,m=f+255,w=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",o).replace("{range}",`${f}-${m}`),wh.Glyphs);Au(w,((C,M)=>{if(C)u(C);else if(M){const B={},U=(function($){return new Rv($).readFields(eO,{})})(M);for(const $ of U.glyphs)B[$.id]=$;u(null,{glyphs:B,ascender:U.ascender,descender:U.descender})}}))},Ig.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=i,this.lang=w;const C=this.size=o+4*e,M=this._createCanvas(C),B=this.ctx=M.getContext("2d",{willReadFrequently:!0});B.font=`${m} ${f} ${o}px ${u}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(o),m=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),C=Math.min(this.size-this.buffer,m+Math.ceil(l)),M=w+2*this.buffer,B=C+2*this.buffer,U=Math.max(M*B,0),$=new Uint8ClampedArray(U),Q={data:$,width:M,height:B,glyphWidth:w,glyphHeight:C,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(w===0||C===0)return Q;const{ctx:ee,buffer:he,gridInner:_e,gridOuter:ve}=this;this.lang&&(ee.lang=this.lang),ee.clearRect(he,he,w,C),ee.fillText(o,he,he+m);const De=ee.getImageData(he,he,w,C);ve.fill(e0,0,U),_e.fill(0,0,U);for(let ke=0;ke<C;ke++)for(let ze=0;ze<w;ze++){const Je=De.data[4*(ke*w+ze)+3]/255;if(Je===0)continue;const Qe=(ke+he)*M+ze+he;if(Je===1)ve[Qe]=0,_e[Qe]=e0;else{const st=.5-Je;ve[Qe]=st>0?st*st:0,_e[Qe]=st<0?st*st:0}}RE(ve,0,0,M,B,M,this.f,this.v,this.z),RE(_e,he,he,w,C,M,this.f,this.v,this.z);for(let ke=0;ke<U;ke++){const ze=Math.sqrt(ve[ke])-Math.sqrt(_e[ke]);$[ke]=Math.round(255-255*(ze/this.radius+this.cutoff))}return Q}};const Ep=Pm;function kE(o,e){return o+e[1]-e[0]}function OE(o,e,i,l,u=1){const f=[],m=o.imagePrimary,w=m.pixelRatio,C=m.paddedRect.w-2*Ep,M=m.paddedRect.h-2*Ep,B=(o.right-o.left)*u,U=(o.bottom-o.top)*u,$=m.stretchX||[[0,C]],Q=m.stretchY||[[0,M]],ee=$.reduce(kE,0),he=Q.reduce(kE,0),_e=C-ee,ve=M-he;let De=0,ke=ee,ze=0,Je=he,Qe=0,st=_e,lt=0,ft=ve;if(m.content&&l){const vt=m.content;De=kv($,0,vt[0]),ze=kv(Q,0,vt[1]),ke=kv($,vt[0],vt[2]),Je=kv(Q,vt[1],vt[3]),Qe=vt[0]-De,lt=vt[1]-ze,st=vt[2]-vt[0]-ke,ft=vt[3]-vt[1]-Je}const Ut=(vt,$t,tn,qt)=>{const Jt=Ov(vt.stretch-De,ke,B,o.left*u),on=Lv(vt.fixed-Qe,st,vt.stretch,ee),Bt=Ov($t.stretch-ze,Je,U,o.top*u),Qt=Lv($t.fixed-lt,ft,$t.stretch,he),Dt=Ov(tn.stretch-De,ke,B,o.left*u),Et=Lv(tn.fixed-Qe,st,tn.stretch,ee),an=Ov(qt.stretch-ze,Je,U,o.top*u),rn=Lv(qt.fixed-lt,ft,qt.stretch,he),Xn=new Kt(Jt,Bt),Rn=new Kt(Dt,Bt),Un=new Kt(Dt,an),mn=new Kt(Jt,an),Wn=new Kt(on/w,Qt/w),pr=new Kt(Et/w,rn/w),bn=e*Math.PI/180;if(bn){const Ln=Math.sin(bn),Sr=Math.cos(bn),Kr=[Sr,-Ln,Ln,Sr];Xn._matMult(Kr),Rn._matMult(Kr),mn._matMult(Kr),Un._matMult(Kr)}const Hn=vt.stretch+vt.fixed,cr=tn.stretch+tn.fixed,xr=$t.stretch+$t.fixed,kr=qt.stretch+qt.fixed,Cr=o.imageSecondary;return{tl:Xn,tr:Rn,bl:mn,br:Un,texPrimary:{x:m.paddedRect.x+Ep+Hn,y:m.paddedRect.y+Ep+xr,w:cr-Hn,h:kr-xr},texSecondary:Cr?{x:Cr.paddedRect.x+Ep+Hn,y:Cr.paddedRect.y+Ep+xr,w:cr-Hn,h:kr-xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wn,pixelOffsetBR:pr,minFontScaleX:st/w/B,minFontScaleY:ft/w/U,isSDF:i}};if(l&&(m.stretchX||m.stretchY)){const vt=LE($,_e,ee),$t=LE(Q,ve,he);for(let tn=0;tn<vt.length-1;tn++){const qt=vt[tn],Jt=vt[tn+1];for(let on=0;on<$t.length-1;on++)f.push(Ut(qt,$t[on],Jt,$t[on+1]))}}else f.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return f}function kv(o,e,i){let l=0;for(const u of o)l+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return l}function LE(o,e,i){const l=[{fixed:-Ep,stretch:0}];for(const[u,f]of o){const m=l[l.length-1];l.push({fixed:u-m.stretch,stretch:m.stretch}),l.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return l.push({fixed:e+Ep,stretch:i}),l}function Ov(o,e,i,l){return o/e*i+l}function Lv(o,e,i,l){return o-e*i/l}function lO(o,e,i,l){const u=e+o.positionedLines[l].lineOffset;return l===0?i+u/2:i+(u+(e+o.positionedLines[l-1].lineOffset))/2}function cO(o,e=1,i=!1){let l=1/0,u=1/0,f=-1/0,m=-1/0;const w=o[0];for(let Q=0;Q<w.length;Q++){const ee=w[Q];(!Q||ee.x<l)&&(l=ee.x),(!Q||ee.y<u)&&(u=ee.y),(!Q||ee.x>f)&&(f=ee.x),(!Q||ee.y>m)&&(m=ee.y)}const C=Math.min(f-l,m-u);let M=C/2;const B=new Dd([],uO);if(C===0)return new Kt(l,u);for(let Q=l;Q<f;Q+=C)for(let ee=u;ee<m;ee+=C)B.push(new Rg(Q+M,ee+M,M,o));let U=(function(Q){let ee=0,he=0,_e=0;const ve=Q[0];for(let De=0,ke=ve.length,ze=ke-1;De<ke;ze=De++){const Je=ve[De],Qe=ve[ze],st=Je.x*Qe.y-Qe.x*Je.y;he+=(Je.x+Qe.x)*st,_e+=(Je.y+Qe.y)*st,ee+=3*st}return new Rg(he/ee,_e/ee,0,Q)})(o),$=B.length;for(;B.length;){const Q=B.pop();(Q.d>U.d||!U.d)&&(U=Q,i&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,$)),Q.max-U.d<=e||(M=Q.h/2,B.push(new Rg(Q.p.x-M,Q.p.y-M,M,o)),B.push(new Rg(Q.p.x+M,Q.p.y-M,M,o)),B.push(new Rg(Q.p.x-M,Q.p.y+M,M,o)),B.push(new Rg(Q.p.x+M,Q.p.y+M,M,o)),$+=4)}return i&&(console.log(`num probes: ${$}`),console.log(`best distance: ${U.d}`)),U.p}function uO(o,e){return e.max-o.max}class Rg{constructor(e,i,l,u){this.p=new Kt(e,i),this.h=l,this.d=(function(f,m){let w=!1,C=1/0;for(let M=0;M<m.length;M++){const B=m[M];for(let U=0,$=B.length,Q=$-1;U<$;Q=U++){const ee=B[U],he=B[Q];ee.y>f.y!=he.y>f.y&&f.x<(he.x-ee.x)*(f.y-ee.y)/(he.y-ee.y)+ee.x&&(w=!w),C=Math.min(C,Ni(f,ee,he))}}return(w?1:-1)*Math.sqrt(C)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const dO=Object.keys,r2=Number.POSITIVE_INFINITY,hO=Math.sqrt(2);function zE(o,[e,i]){let l=0,u=0;if(i===r2){e<0&&(e=0);const f=e/hO;switch(o){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),o){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function zv(o,e,i,l,u,f,m,w,C){if(!e||!e.usvg)return;const M=wE(l),B=wE(u),U=f!=="both"&&f!=="width"||!xE(l)?1:B.width/M.width,$=f!=="both"&&f!=="height"||!bE(l)?1:B.height/M.height;i.scaleSelf(U,$);const Q=i.toString();m.set(Q,i),w.set(Q,e);const{imagePosition:ee}=t2(Q,e,Pm);C.set(Q,ee)}function FE(o,e,i,l,u,f,m,w,C){if(!o)return;const M=(function(B,U,$,Q,ee,he){if(B.kind==="camera")return B.maxSize;if(B.kind==="composite"){const _e=U.possiblyEvaluate(new ki(B.maxZoom,{worldview:he}),$).evaluate(ee,{},$),ve=U.possiblyEvaluate(new ki(B.minZoom,{worldview:he}),$).evaluate(ee,{},$);return Math.max(_e,ve)}return U.possiblyEvaluate(new ki(Q,{worldview:he})).evaluate(ee,{},$)})(e,i,l,u,f,C);return o.scaleSelf(M*w*m)}function BE(o,e,i,l,u,f,m,w,C){return{iconPrimary:FE(o.getPrimary(),e,i,l,u,f,m,w,C),iconSecondary:FE(o.getSecondary(),e,i,l,u,f,m,w,C)}}function fO(o,e,i){if(!e)return;const l=i.get(o.toString()),u=i.get(e.toString());l&&u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||Vr(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&Vr(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function NE(o,e,i,l){if(!o)return;const u=e.get(i.toString());if(o.imagePrimary=u,l){const f=e.get(l.toString());o.imageSecondary=f}}function pO(o,e){for(const i in o.horizontal)VE(o.horizontal[i],e);VE(o.vertical,e)}function VE(o,e){if(o){for(const i of o.positionedLines)for(const l of i.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function i2(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mO(o,e,i,l,u,f,m,w,C){const M=o2(f.horizontal)||f.vertical,B=i.get("icon-text-fit-padding").evaluate(l,{},u);let U,$=e;return e&&C!=="none"&&(o.allowVerticalPlacement&&f.vertical&&(U=vE(e,f.vertical,C,B,w,m)),M&&($=vE(e,M,C,B,w,m))),{defaultShapedIcon:$,verticallyShapedIcon:U}}function gO(o,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve,De,ke){let ze=m.textMaxSize.evaluate(e,{},$);ze===void 0?ze=w*m.textScaleFactor:ze*=m.textScaleFactor;const Je=o.layers[0].layout,Qe=o2(i.horizontal)||i.vertical,st=Q.name==="globe",lt=Ss,ft=o.tilePixelRatio*ze/lt,Ut=(on=o.overscaling,o.zoom>18&&on>2&&(on>>=1),Math.max(hn/(512*on),1)*Je.get("symbol-spacing")),vt=Je.get("text-padding")*o.tilePixelRatio,$t=Je.get("icon-padding")*o.tilePixelRatio,tn=_t(Je.get("text-max-angle")),qt=Je.get("icon-rotation-alignment")==="map"&&ke!=="point",Jt=Ut/2;var on;o.hasAnyIconTextFit===!1&&_e!=="none"&&(o.hasAnyIconTextFit=!0);const Bt=e.properties?+e.properties[dr]:null,Qt=Bt&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Bt):65535,Dt=(Et,an,rn)=>{if(an.x<0||an.x>=hn||an.y<0||an.y>=hn)return;let Xn=null;if(st){const{x:Rn,y:Un,z:mn}=Q.projectTilePoint(an.x,an.y,rn);Xn={anchor:new sf(Rn,Un,mn,0,void 0),up:Q.upVector(rn,an.x,an.y)}}(function(Rn,Un,mn,Wn,pr,bn,Hn,cr,xr,kr,Cr,Ln,Sr,Kr,Ne,Ve,Mt,Vt,xn,vn,Dn,Jn,Or,Lr,Rr,xi,to,Mr,Vi){const Si=Rn.addToLineVertexArray(Un,Wn);let pi,Hi,qi,zi,Ui,Ti,zr,Ei=0,ho=0,ur=0,ii=0,Wi=-1,go=-1;const Qi={};let Jo=Pf("");const Di=mn?mn.anchor:Un,Zo=Mr!=="none";let el=0,oa=0;if(xr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Qo=xr.layout.get("text-offset").evaluate(Dn,{},Rr);el=Qo[0]*Ss,oa=Qo[1]*Ss}else el=xr.layout.get("text-radial-offset").evaluate(Dn,{},Rr)*Ss,oa=r2;if(Rn.allowVerticalPlacement&&pr.vertical){const Qo=pr.vertical;if(Ne)Ti=s2(Qo),cr&&(zr=s2(cr));else{const ls=xr.layout.get("text-rotate").evaluate(Dn,{},Rr)+90;qi=Fv(kr,Di,Un,Cr,Ln,Sr,Qo,Kr,ls,Ve),cr&&(zi=Fv(kr,Di,Un,Cr,Ln,Sr,cr,Vt,ls))}}if(bn){const Qo=Rn.iconSizeData,ls=xr.layout.get("icon-rotate").evaluate(Dn,{},Rr),sa=OE(bn,ls,Or,Zo,Jn.iconScaleFactor),Ca=cr?OE(cr,ls,Or,Zo,Jn.iconScaleFactor):void 0;Hi=Fv(kr,Di,Un,Cr,Ln,Sr,bn,Vt,ls,null),Ei=4*sa.length;let _a=null;Qo.kind==="source"?(_a=[th*xr.layout.get("icon-size").evaluate(Dn,{},Rr)*Jn.iconScaleFactor],_a[0]>Ap&&Vr(`${Rn.layerIds[0]}: Value for "icon-size" is >= ${t0}. Reduce your "icon-size".`)):Qo.kind==="composite"&&(_a=[th*Jn.compositeIconSizes[0].evaluate(Dn,{},Rr)*Jn.iconScaleFactor,th*Jn.compositeIconSizes[1].evaluate(Dn,{},Rr)*Jn.iconScaleFactor],(_a[0]>Ap||_a[1]>Ap)&&Vr(`${Rn.layerIds[0]}: Value for "icon-size" is >= ${t0}. Reduce your "icon-size".`)),Rn.addSymbols(Rn.icon,sa,_a,vn,xn,Dn,void 0,mn,Un,Si.lineStartIndex,Si.lineLength,-1,Lr,Rr,xi,to),Wi=Rn.icon.placedSymbolArray.length-1,Ca&&(ho=4*Ca.length,Rn.addSymbols(Rn.icon,Ca,_a,vn,xn,Dn,Rl.vertical,mn,Un,Si.lineStartIndex,Si.lineLength,-1,Lr,Rr,xi,to),go=Rn.icon.placedSymbolArray.length-1)}for(const Qo in pr.horizontal){const ls=Qo,sa=pr.horizontal[ls];pi||(Jo=Pf(sa.text),Ne?Ui=s2(sa):pi=Fv(kr,Di,Un,Cr,Ln,Sr,sa,Kr,xr.layout.get("text-rotate").evaluate(Dn,{},Rr),Ve));const Ca=sa.positionedLines.length===1;if(ur+=UE(Rn,mn,Un,sa,Hn,xr,Ne,Dn,Ve,Si,pr.vertical?Rl.horizontal:Rl.horizontalOnly,Ca?dO(pr.horizontal):[ls],Qi,Wi,Jn,Lr,Rr,xi),Ca)break}pr.vertical&&(ii+=UE(Rn,mn,Un,pr.vertical,Hn,xr,Ne,Dn,Ve,Si,Rl.vertical,["vertical"],Qi,go,Jn,Lr,Rr,xi));let Vs=-1;const tl=(Qo,ls)=>Qo?Math.max(Qo,ls):ls;Vs=tl(Ui,Vs),Vs=tl(Ti,Vs),Vs=tl(zr,Vs);const nh=Vs>-1?1:0;Rn.glyphOffsetArray.length>=65535&&Vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dn.sortKey!==void 0&&Rn.addToSortKeyRanges(Rn.symbolInstances.length,Dn.sortKey),Rn.symbolInstances.emplaceBack(Un.x,Un.y,Di.x,Di.y,Di.z,Qi.right>=0?Qi.right:-1,Qi.center>=0?Qi.center:-1,Qi.left>=0?Qi.left:-1,Qi.vertical>=0?Qi.vertical:-1,Wi,go,Jo,pi!==void 0?pi:Rn.collisionBoxArray.length,pi!==void 0?pi+1:Rn.collisionBoxArray.length,qi!==void 0?qi:Rn.collisionBoxArray.length,qi!==void 0?qi+1:Rn.collisionBoxArray.length,Hi!==void 0?Hi:Rn.collisionBoxArray.length,Hi!==void 0?Hi+1:Rn.collisionBoxArray.length,zi||Rn.collisionBoxArray.length,zi?zi+1:Rn.collisionBoxArray.length,Cr,ur,ii,Ei,ho,nh,0,el,oa,Vs,0,Zo?1:0,Vi)})(o,an,Xn,Et,i,l,f,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,vt,De,M,0,$t,qt,ve,e,m,B,U,$,ee,he,_e,Qt)};if(ke==="line")for(const Et of Sv(e.geometry,0,0,hn,hn)){const an=aO(Et,Ut,tn,i.vertical||Qe,l,lt,ft,o.overscaling,hn);for(const rn of an)Qe&&_O(o,Qe.text,Jt,rn)||Dt(Et,rn,$)}else if(ke==="line-center"){for(const Et of e.geometry)if(Et.length>1){const an=sO(Et,tn,i.vertical||Qe,l,lt,ft);an&&Dt(Et,an,$)}}else if(e.type==="Polygon")for(const Et of F_(e.geometry,0)){const an=cO(Et,16);Dt(Et[0],new sf(an.x,an.y,0,0,void 0),$)}else if(e.type==="LineString")for(const Et of e.geometry)Dt(Et,new sf(Et[0].x,Et[0].y,0,0,void 0),$);else if(e.type==="Point")for(const Et of e.geometry)for(const an of Et)Dt([an],new sf(an.x,an.y,0,0,void 0),$)}const t0=255,Ap=t0*th;function UE(o,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e,ve){const De=(function(Je,Qe,st,lt,ft,Ut,vt,$t){const tn=[];if(Qe.positionedLines.length===0)return tn;const qt=lt.layout.get("text-rotate").evaluate(Ut,{})*Math.PI/180,Jt=(function(Et){const an=Et[0],rn=Et[1],Xn=an*rn;return Xn>0?[an,-rn]:Xn<0?[-an,rn]:an===0?[rn,an]:[rn,-an]})(st);let on=Math.abs(Qe.top-Qe.bottom);for(const Et of Qe.positionedLines)on-=Et.lineOffset;const Bt=Qe.positionedLines.length,Qt=on/Bt;let Dt=Qe.top-st[1];for(let Et=0;Et<Bt;++Et){const an=Qe.positionedLines[Et];Dt=lO(Qe,Qt,Dt,Et);for(const rn of an.positionedGlyphs){if(!rn.rect)continue;const Xn=rn.rect||{};let Rn=hE+1,Un=!0,mn=1,Wn=0;if(rn.image){const Dn=vt.get(rn.image.toString());if(!Dn)continue;if(Dn.sdf){Vr("SDF images are not supported in formatted text and will be ignored.");continue}Un=!1,mn=Dn.pixelRatio,Rn=Pm/mn}const pr=(ft||$t)&&rn.vertical,bn=rn.metrics.advance*rn.scale/2,Hn=rn.metrics,cr=rn.rect;if(cr===null)continue;$t&&Qe.verticalizable&&(Wn=rn.image?bn-rn.metrics.width*rn.scale/2:0);const xr=ft?[rn.x+bn,rn.y]:[0,0];let kr=[0,0],Cr=[0,0],Ln=!1;ft||(pr?(Cr=[rn.x+bn+Jt[0],rn.y+Jt[1]-Wn],Ln=!0):kr=[rn.x+bn+st[0],rn.y+st[1]-Wn]);const Sr=cr.w*rn.scale/(mn*(rn.localGlyph?rd:1)),Kr=cr.h*rn.scale/(mn*(rn.localGlyph?rd:1));let Ne,Ve,Mt,Vt;if(pr){const Dn=rn.y-Dt,Jn=new Kt(-bn,bn-Dn),Or=-Math.PI/2,Lr=new Kt(...Cr);Ne=new Kt(-bn+kr[0],kr[1]),Ne._rotateAround(Or,Jn)._add(Lr),Ne.x+=-Dn+bn,Ne.y-=(Hn.left-Rn)*rn.scale;const Rr=rn.image?Hn.advance*rn.scale:Ss*rn.scale,xi=String.fromCodePoint(rn.glyph);Gk(xi)?Ne.x+=(1-Rn)*rn.scale:$k(xi)?Ne.x+=Rr-Hn.height*rn.scale+(-Rn-1)*rn.scale:Ne.x+=rn.image||Hn.width+2*Rn===cr.w&&Hn.height+2*Rn===cr.h?(Rr-Kr)/2:(Rr-(Hn.height+2*Rn)*rn.scale)/2,Ve=new Kt(Ne.x,Ne.y-Sr),Mt=new Kt(Ne.x+Kr,Ne.y),Vt=new Kt(Ne.x+Kr,Ne.y-Sr)}else{const Dn=(Hn.left-Rn)*rn.scale-bn+kr[0],Jn=(-Hn.top-Rn)*rn.scale+kr[1],Or=Dn+Sr,Lr=Jn+Kr;Ne=new Kt(Dn,Jn),Ve=new Kt(Or,Jn),Mt=new Kt(Dn,Lr),Vt=new Kt(Or,Lr)}if(qt){let Dn;Dn=ft?new Kt(0,0):Ln?new Kt(Jt[0],Jt[1]):new Kt(st[0],st[1]),Ne._rotateAround(qt,Dn),Ve._rotateAround(qt,Dn),Mt._rotateAround(qt,Dn),Vt._rotateAround(qt,Dn)}const xn=new Kt(0,0),vn=new Kt(0,0);tn.push({tl:Ne,tr:Ve,bl:Mt,br:Vt,texPrimary:Xn,texSecondary:void 0,writingMode:Qe.writingMode,glyphOffset:xr,sectionIndex:rn.sectionIndex,isSDF:Un,pixelOffsetTL:xn,pixelOffsetBR:vn,minFontScaleX:0,minFontScaleY:0})}}return tn})(0,l,C,f,m,w,u,o.allowVerticalPlacement),ke=o.textSizeData;let ze=null;ke.kind==="source"?(ze=[th*f.layout.get("text-size").evaluate(w,{},_e)*ee.textScaleFactor],ze[0]>Ap&&Vr(`${o.layerIds[0]}: Value for "text-size" is >= ${t0}. Reduce your "text-size".`)):ke.kind==="composite"&&(ze=[th*ee.compositeTextSizes[0].evaluate(w,{},_e)*ee.textScaleFactor,th*ee.compositeTextSizes[1].evaluate(w,{},_e)*ee.textScaleFactor],(ze[0]>Ap||ze[1]>Ap)&&Vr(`${o.layerIds[0]}: Value for "text-size" is >= ${t0}. Reduce your "text-size".`)),o.addSymbols(o.text,De,ze,C,m,w,B,e,i,M.lineStartIndex,M.lineLength,Q,he,_e,ve,!1);for(const Je of U)$[Je]=o.text.placedSymbolArray.length-1;return 4*De.length}function o2(o){for(const e in o)return o[e];return null}function Fv(o,e,i,l,u,f,m,w,C,M){let B=m.top,U=m.bottom,$=m.left,Q=m.right;if(yE(m)&&m.collisionPadding){const ee=m.collisionPadding;$-=ee[0],B-=ee[1],Q+=ee[2],U+=ee[3]}if(C){const ee=new Kt($,B),he=new Kt(Q,B),_e=new Kt($,U),ve=new Kt(Q,U),De=_t(C);let ke=new Kt(0,0);M&&(ke=new Kt(M[0],M[1])),ee._rotateAround(De,ke),he._rotateAround(De,ke),_e._rotateAround(De,ke),ve._rotateAround(De,ke),$=Math.min(ee.x,he.x,_e.x,ve.x),Q=Math.max(ee.x,he.x,_e.x,ve.x),B=Math.min(ee.y,he.y,_e.y,ve.y),U=Math.max(ee.y,he.y,_e.y,ve.y)}return o.emplaceBack(e.x,e.y,e.z,i.x,i.y,$,B,Q,U,w,l,u,f),o.length-1}function s2(o){yE(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function _O(o,e,i,l){const u=o.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<i)return!0}else u[e]=[];return u[e].push(l),!1}function jE(o,e){const i=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-o._pitch-i,.01));let m=Math.sin(o._pitch)*f+u;const w=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let C=Math.max(o.zoom-17,0);o.isOrthographic&&(C/=10),m*=1+C}return Math.min(1.01*m,w)}function n0(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const i=Math.pow(2,-o.z),l=o.x*i,u=(o.x+1)*i,f=o.y*i,m=(o.y+1)*i,w=Ye(l),C=Ye(u),M=qe(f),B=qe(m),U=e.project(w,M),$=e.project(C,M),Q=e.project(C,B),ee=e.project(w,B);let he=Math.min(U.x,$.x,Q.x,ee.x),_e=Math.min(U.y,$.y,Q.y,ee.y),ve=Math.max(U.x,$.x,Q.x,ee.x),De=Math.max(U.y,$.y,Q.y,ee.y);const ke=i/16;function ze(Qe,st,lt,ft,Ut,vt){const $t=(lt+Ut)/2,tn=(ft+vt)/2,qt=e.project(Ye($t),qe(tn)),Jt=Math.max(0,he-qt.x,_e-qt.y,qt.x-ve,qt.y-De);he=Math.min(he,qt.x),ve=Math.max(ve,qt.x),_e=Math.min(_e,qt.y),De=Math.max(De,qt.y),Jt>ke&&(ze(Qe,qt,lt,ft,$t,tn),ze(qt,st,$t,tn,Ut,vt))}ze(U,$,l,f,u,f),ze($,Q,u,f,u,m),ze(Q,ee,u,m,l,m),ze(ee,U,l,m,l,f),he-=ke,_e-=ke,ve+=ke,De+=ke;const Je=1/Math.max(ve-he,De-_e);return{scale:Je,x:he*Je,y:_e*Je,x2:ve*Je,y2:De*Je,projection:e}}function GE(o,{x:e,y:i},l=0){return new Kt(((e-l)*o.scale-o.x)*hn,(i*o.scale-o.y)*hn)}const yO=O(new Float32Array(16));class Pp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ce(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l,u=!0){return e._coordinatePoint(e.locationCoordinate(i,l),u)}pixelsPerMeter(e,i){return He(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return jE(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,u){const f=e.horizonLineFromTop(!1),m=new Kt(i,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,i,l){const u=new Kt(i,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return yO}createTileMatrix(e,i,l){let u,f,m;const w=l.canonical,C=O(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=n0(w,this);u=1,f=M.x+l.wrap*M.scale,m=M.y,V(C,C,[u/M.scale,u/M.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(w.z),f=(w.x+Math.pow(2,w.z)*l.wrap)*u,m=w.y*u;return j(C,C,[f,m,0]),V(C,C,[u/hn,u/hn,1]),C}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class vO extends Pp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(_t(i));this.n=(u+Math.sin(_t(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:u,r0:f}=this,m=_t(e-this.center[0]),w=_t(i),C=Math.sqrt(u-2*l*Math.sin(w))/l;return{x:C*Math.sin(m*l),y:C*Math.cos(m*l)-f,z:0}}unproject(e,i){const{n:l,c:u,r0:f}=this,m=f+i;let w=Math.atan2(e,Math.abs(m))*Math.sign(m);m*l<0&&(w-=Math.PI*Math.sign(e)*Math.sign(m));const C=_t(this.center[0])*l;w=dt(w,-Math.PI-C,Math.PI-C);const M=et(we(w/l)+this.center[0],-180,180),B=Math.asin(et((u-(e*e+m*m)*l*l)/(2*l),-1,1)),U=et(we(B),-Xe,Xe);return new ce(M,U)}}const r0=1.340264,i0=-.081106,o0=893e-6,s0=.003796,Bv=Math.sqrt(3)/2;class xO extends Pp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Bv*Math.sin(i)),u=l*l,f=u*u*u;return{x:.5*(e*Math.cos(l)/(Bv*(r0+3*i0*u+f*(7*o0+9*s0*u)))/Math.PI+.5),y:1-.5*(l*(r0+i0*u+f*(o0+s0*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=l*l,f=u*u*u;for(let B,U,$,Q=0;Q<12&&(U=l*(r0+i0*u+f*(o0+s0*u))-i,$=r0+3*i0*u+f*(7*o0+9*s0*u),B=U/$,l=et(l-B,-Math.PI/3,Math.PI/3),u=l*l,f=u*u*u,!(Math.abs(B)<1e-12));++Q);const m=Bv*e*(r0+3*i0*u+f*(7*o0+9*s0*u))/Math.cos(l),w=Math.asin(Math.sin(l)/Bv),C=et(180*m/Math.PI,-180,180),M=et(180*w/Math.PI,-Xe,Xe);return new ce(C,M)}}class bO extends Pp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),u=et(360*(.5-i),-Xe,Xe);return new ce(l,u)}}const Dg=Math.PI/2;function Nv(o){return Math.tan((Dg+o)/2)}class wO extends Pp{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let u=_t(i),f=_t(l);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),w=Nv(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Nv(f)/w),this.f=m*Math.pow(Nv(u),this.n)/this.n}project(e,i){i=_t(i),this.southernCenter&&(i=-i),e=_t(e-this.center[0]);const l=1e-6,{n:u,f}=this;f>0?i<-Dg+l&&(i=-Dg+l):i>Dg-l&&(i=Dg-l);const m=f/Math.pow(Nv(i),u);let w=m*Math.sin(u*e),C=f-m*Math.cos(u*e);return w=.5*(w/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:w,y:this.southernCenter?C:1-C,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:u}=this,f=u-i,m=Math.sign(f),w=Math.sign(l)*Math.sqrt(e*e+f*f);let C=Math.atan2(e,Math.abs(f))*m;f*l<0&&(C-=Math.PI*Math.sign(e)*m);const M=et(we(C/l)+this.center[0],-180,180),B=et(we(2*Math.atan(Math.pow(u/w,1/l))-Dg),-Xe,Xe);return new ce(M,this.southernCenter?-B:B)}}class $E extends Pp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Fe(e),y:Ze(i),z:0}}unproject(e,i){const l=Ye(e),u=qe(i);return new ce(l,u)}}const HE=_t(Xe);class SO extends Pp{project(e,i){const l=(i=_t(i))*i,u=l*l;return{x:.5*((e=_t(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=25,f=0,m=l*l;do{m=l*l;const M=m*m;f=(l*(1.007226+m*(.015085+M*(.028874*m-.044475-.005916*M)))-i)/(1.007226+m*(.045255+M*(.259866*m-.311325-.005916*11*M))),l=et(l-f,-HE,HE)}while(Math.abs(f)>1e-6&&--u>0);m=l*l;const w=et(we(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),C=we(l);return new ce(w,C)}}const qE=_t(Xe);class TO extends Pp{project(e,i){i=_t(i),e=_t(e);const l=Math.cos(i),u=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),m=Math.sin(f)/f,w=.5*(e*u+2*l*Math.sin(e/2)/m)||0,C=.5*(i+Math.sin(i)/m)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let w=0,C=0;do{const M=Math.cos(u),B=Math.sin(u),U=2*B*M,$=B*B,Q=M*M,ee=Math.cos(l/2),he=Math.sin(l/2),_e=2*ee*he,ve=he*he,De=1-Q*ee*ee,ke=De?1/De:0,ze=De?Math.acos(M*ee)*Math.sqrt(1/De):0,Je=.5*(2*ze*M*he+2*l/Math.PI)-e,Qe=.5*(ze*B+u)-i,st=.5*ke*(Q*ve+ze*M*ee*$)+1/Math.PI,lt=ke*(_e*U/4-ze*B*he),ft=.125*ke*(U*he-ze*B*Q*_e),Ut=.5*ke*($*ee+ze*ve*M)+.5,vt=lt*ft-Ut*st;w=(Qe*lt-Je*Ut)/vt,C=(Je*ft-Qe*st)/vt,l=et(l-w,-Math.PI,Math.PI),u=et(u-C,-qE,qE)}while((Math.abs(w)>m||Math.abs(C)>m)&&--f>0);return new ce(we(l),we(u))}}class WE extends Pp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_t(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:u}=this;return{x:_t(e)*u*l+.5,y:-Math.sin(_t(i))/u*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:u}=this,f=-(i-.5)/l,m=et(we((e-.5)/l)/u,-180,180),w=Math.asin(et(f*u,-1,1)),C=et(we(w),-Xe,Xe);return new ce(m,C)}}class CO extends $E{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const u=$r(e,i,l);return xt(u,u,eo(Qa(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,l){const u=Y(i.lat,i.lng),f=nt([],u),m=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Oe(u,u,f,He(1,0)*hn*m);const w=O(new Float64Array(16));return H(w,e.pixelMatrix,e.globeMatrix),xt(u,u,w),new Kt(u[0],u[1])}pixelsPerMeter(e,i){return He(1,0)*i}pixelSpaceConversion(e,i,l){const u=He(1,e)*i,f=Qn(He(1,45)*i,u,l);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,l){const u=ws(Qa(l.canonical));return H(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:l}=e,u=eo(Qa(i));return X(u,u,_t(l.lng)),Z(u,u,_t(l.lat)),V(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,l,u){return Er(e,i,l,!0)||new Pt(0,0)}pointCoordinate3D(e,i,l){const u=this.pointCoordinate(e,i,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!Er(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(u,f){const m=u.cameraToCenterDistance,w=u._centerAltitude*f,C=u._camera,M=u._camera.forward(),B=Ae([],Ee([],M,-m),[0,0,w]),U=u.worldSize/(2*Math.PI),$=[0,0,-U],Q=u.width/u.height,ee=Math.tan(u.fovAboveCenter),he=Ee([],C.up(),ee),_e=Ee([],C.right(),ee*Q),ve=nt([],Ae([],Ae([],M,he),_e)),De=[];let ke;if(new Xr(B,ve).closestPointOnSphere($,U,De)){const ze=Ae([],De,$),Je=mt([],ze,B);ke=Math.cos(u.fovAboveCenter)*ye(Je)}else{const ze=mt([],B,$),Je=mt([],$,B);nt(Je,Je);const Qe=ye(ze)-U;ke=Math.sqrt(Qe*(Qe+2*U));const st=Math.acos(ke/(U+Qe))-Math.acos($e(M,Je));ke*=Math.cos(st)}return 1.01*ke})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=wp(e.zoom);if(l>0){const u=jE(e,He(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Qn(i,u+f*(1-Math.cos(m)),Math.pow(l,10))}return i}upVector(e,i,l){return $r(i,l,e,1)}upVectorScale(e){return{metersToTile:or(Io(Qa(e)))}}}function ZE(o){const e=o.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new $E(o);case"equirectangular":return new bO(o);case"naturalEarth":return new SO(o);case"equalEarth":return new xO(o);case"winkelTripel":return new TO(o);case"albers":return i?new WE(o):new vO(o);case"lambertConformalConic":return i?new WE(o):new wO(o);case"globe":return new CO(o)}throw new Error(`Invalid projection name: ${o.name}`)}const EO=en.types,AO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vv(o,e,i,l,u,f,m,w,C,M,B,U,$){const Q=w?Math.min(Ap,Math.round(w[0])):0,ee=w?Math.min(Ap,Math.round(w[1])):0;o.emplaceBack(e,i,Math.round(32*l),Math.round(32*u),f,m,(Q<<1)+(C?1:0),ee,16*M,16*B,256*U,256*$)}function Uv(o,e,i){o.emplaceBack(e,i)}function jv(o,e,i,l,u,f,m){o.emplaceBack(e,i,l,u,f,m)}const Gv=(o,e,i,l)=>{for(let u=0;u<e;u++)o.emplaceBack(i[0],i[1],i[2],l[0],l[1],l[2])};function $v(o,e,i,l,u){o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u),o.emplaceBack(e,i,l,u)}function PO(o){for(const e of o.sections)if(A_(e.text))return!0;return!1}class a2{constructor(e){this.layoutVertexArray=new _m,this.indexArray=new Fo,this.programConfigurations=e,this.segments=new Pi,this.dynamicLayoutVertexArray=new Sl,this.opacityVertexArray=new Ho,this.placedSymbolArray=new vp,this.iconTransitioningVertexArray=new zo,this.globeExtVertexArray=new pp,this.zOffsetVertexArray=new Kl,this.orientationVertexArray=new Os}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,l,u,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kk.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Lk.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,AO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Bk.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ok.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zk.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Fk.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}In(a2,"SymbolBuffers");class l2{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Pi,this.collisionVertexArray=new su,this.collisionVertexArrayExt=new Sl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Nk.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}In(l2,"CollisionBuffers");class Hv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=O([]),this.placementViewportMatrix=O([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=SE(this.zoom,i["text-size"],this.worldview),this.iconSizeData=SE(this.zoom,i["icon-size"],this.worldview);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map((m=>Rl[m])),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new a2(new La(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new a2(new La(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new xp,this.lineVertexArray=new bm,this.symbolInstances=new wa}calculateGlyphDependencies(e,i,l,u,f){for(const m of e){const w=m.codePointAt(0);if(w===void 0)break;if(i[w]=!0,u&&f&&w<=65535){const C=X_[m];C&&(i[C.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!xv(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,i,l,u){const f=this.layers[0],m=f.layout,w=this.projection.name==="globe",C=m.get("text-font"),M=m.get("text-field"),B=m.get("icon-image"),[U,$]=m.get("icon-size-scale-range"),Q=et(i.scaleFactor||1,U,$),ee=(M.value.kind!=="constant"||M.value.value instanceof vs&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),he=B.value.kind!=="constant"||!!B.value.value||Object.keys(B.parameters).length>0,_e=m.get("symbol-sort-key");if(this.features=[],!ee&&!he)return;const ve=i.iconDependencies,De=i.glyphDependencies,ke=i.availableImages,ze=new ki(this.zoom,{worldview:this.worldview});for(const{feature:Je,id:Qe,index:st,sourceLayerIndex:lt}of e){const ft=f._featureFilter.needGeometry,Ut=Ht(Je,ft);if(!f._featureFilter.filter(ze,Ut,l))continue;if(ft||(Ut.geometry=Sn(Je,l,u)),w&&Je.type!==1&&l.z<=5){const Jt=Ut.geometry,on=.98078528056,Bt=(Qt,Dt)=>$e($r(Qt.x,Qt.y,l,1),$r(Dt.x,Dt.y,l,1))<on;for(let Qt=0;Qt<Jt.length;Qt++)Jt[Qt]=zt(Jt[Qt],Bt)}let vt,$t;if(ee){const Jt=f.getValueAndResolveTokens("text-field",Ut,l,ke),on=vs.factory(Jt);PO(on)&&(this.hasRTLText=!0),(!this.hasRTLText||sp()==="unavailable"||this.hasRTLText&&Yl.isParsed())&&(vt=jk(on,f,Ut))}if(he){const Jt=f.getValueAndResolveTokens("icon-image",Ut,l,ke);$t=typeof Jt=="string"?Ys.build(Jt):Jt}if(!vt&&!$t)continue;const tn=this.sortFeaturesByKey?_e.evaluate(Ut,{},l):void 0,qt={id:Qe,text:vt,icon:$t,index:st,sourceLayerIndex:lt,geometry:Ut.geometry,properties:Je.properties,type:EO[Je.type],sortKey:tn};if(this.features.push(qt),$t){const Jt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:on,iconSecondary:Bt}=BE($t,this.iconSizeData,Jt["icon-size"],l,this.zoom,qt,this.pixelRatio,Q,this.worldview),Qt=on.id.toString();if(ve.has(Qt)?ve.get(Qt).push(on):ve.set(Qt,[on]),Bt){this.hasAnySecondaryIcon=!0;const Dt=Bt.id.toString();ve.has(Dt)?ve.get(Dt).push(Bt):ve.set(Dt,[Bt])}}if(vt){const Jt=C.evaluate(Ut,{},l).join(","),on=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rl.vertical)>=0;for(const Bt of vt.sections)if(Bt.image){const Qt=Bt.image.getPrimary().scaleSelf(this.pixelRatio),Dt=Qt.id.toString(),Et=ve.get(Dt)||[];Et.push(Qt),ve.set(Dt,Et)}else{const Qt=cm(vt.toString()),Dt=Bt.fontStack||Jt,Et=De[Dt]=De[Dt]||{};this.calculateGlyphDependencies(Bt.text,Et,on,this.allowVerticalPlacement,Qt)}}}if(m.get("symbol-placement")==="line"&&(this.features=(function(Je){const Qe={},st={},lt=[];let ft=0;function Ut(qt){lt.push(Je[qt]),ft++}function vt(qt,Jt,on){const Bt=st[qt];return delete st[qt],st[Jt]=Bt,lt[Bt].geometry[0].pop(),lt[Bt].geometry[0]=lt[Bt].geometry[0].concat(on[0]),Bt}function $t(qt,Jt,on){const Bt=Qe[Jt];return delete Qe[Jt],Qe[qt]=Bt,lt[Bt].geometry[0].shift(),lt[Bt].geometry[0]=on[0].concat(lt[Bt].geometry[0]),Bt}function tn(qt,Jt,on){const Bt=on?Jt[0][Jt[0].length-1]:Jt[0][0];return`${qt}:${Bt.x}:${Bt.y}`}for(let qt=0;qt<Je.length;qt++){const Jt=Je[qt],on=Jt.geometry,Bt=Jt.text?Jt.text.toString():null;if(!Bt){Ut(qt);continue}const Qt=tn(Bt,on),Dt=tn(Bt,on,!0);if(Qt in st&&Dt in Qe&&st[Qt]!==Qe[Dt]){const Et=$t(Qt,Dt,on),an=vt(Qt,Dt,lt[Et].geometry);delete Qe[Qt],delete st[Dt],st[tn(Bt,lt[an].geometry,!0)]=an,lt[Et].geometry=null}else Qt in st?vt(Qt,Dt,on):Dt in Qe?$t(Qt,Dt,on):(Ut(qt),Qe[Qt]=ft-1,st[Dt]=ft-1)}return lt.filter((qt=>qt.geometry))})(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Je of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Je.id,this.elevationFeatures.length),this.elevationFeatures.push(Je)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Je,Qe)=>Je.sortKey-Qe.sortKey))}update(e,i,l,u,f,m,w){this.text.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,l,u,m,w,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const l=bt(e),u=1/l;let f=!1,m=!1;for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w),M=J(1,0,0),B=J(0,1,0),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:$,numIconVertices:Q,numVerticalIconVertices:ee}=C,he=U>0||$>0,_e=Q>0,ve=this.elevationFeatures[C.elevationFeatureIndex];if(ve){const De=new Kt(C.tileAnchorX,C.tileAnchorY),ke=.075+ve.pointElevation(De);C.zOffset!==ke&&(i=!0,C.zOffset=ke);const ze=ve.computeSlopeNormal(De,u),Je=Bn(pt(),J(0,0,1),ze);jt(M,M,Je),jt(B,B,Je),M[2]*=l,B[2]*=l,M[0]===1&&M[1]===0&&M[2]===0&&B[0]===0&&B[1]===1&&B[2]===0||(f=f||he,m=m||_e)}if(he&&(Gv(this.text.orientationVertexArray,U,M,B),Gv(this.text.orientationVertexArray,$,M,B)),_e){const{placedIconSymbolIndex:De,verticalPlacedIconSymbolIndex:ke}=C;De>=0&&Gv(this.icon.orientationVertexArray,Q,M,B),ke>=0&&Gv(this.icon.orientationVertexArray,ee,M,B)}}f||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,m,w)=>{l+=m,l>f.length&&f.resize(l);for(let C=-m;C<0;C++)f.emplace(C+l,w)},i=(f,m,w)=>{u+=m,u>f.length&&f.resize(u);for(let C=-m;C<0;C++)f.emplace(C+u,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:C,numIconVertices:M}=m,B=m.zOffset,U=M>0;if((w>0||C>0)&&(e(this.text.zOffsetVertexArray,w,B),e(this.text.zOffsetVertexArray,C,B)),U){const{placedIconSymbolIndex:$,verticalPlacedIconSymbolIndex:Q}=m;$>=0&&i(this.icon.zOffsetVertexArray,M,B),Q>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,B)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ZE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he,_e){const ve=e.indexArray,De=e.layoutVertexArray,ke=e.globeExtVertexArray,ze=e.segments.prepareSegment(4*i.length,De,ve,this.canOverlap?m.sortKey:void 0),Je=this.glyphOffsetArray.length,Qe=ze.vertexLength,st=this.allowVerticalPlacement&&w===Rl.vertical?Math.PI/2:0,lt=m.text&&m.text.sections;for(let Ut=0;Ut<i.length;Ut++){const{tl:vt,tr:$t,bl:tn,br:qt,texPrimary:Jt,texSecondary:on,pixelOffsetTL:Bt,pixelOffsetBR:Qt,minFontScaleX:Dt,minFontScaleY:Et,glyphOffset:an,isSDF:rn,sectionIndex:Xn}=i[Ut],Rn=ze.vertexLength,Un=an[1];if(Vv(De,M.x,M.y,vt.x,Un+vt.y,Jt.x,Jt.y,l,rn,Bt.x,Bt.y,Dt,Et),Vv(De,M.x,M.y,$t.x,Un+$t.y,Jt.x+Jt.w,Jt.y,l,rn,Qt.x,Bt.y,Dt,Et),Vv(De,M.x,M.y,tn.x,Un+tn.y,Jt.x,Jt.y+Jt.h,l,rn,Bt.x,Qt.y,Dt,Et),Vv(De,M.x,M.y,qt.x,Un+qt.y,Jt.x+Jt.w,Jt.y+Jt.h,l,rn,Qt.x,Qt.y,Dt,Et),C){const{x:mn,y:Wn,z:pr}=C.anchor,[bn,Hn,cr]=C.up;jv(ke,mn,Wn,pr,bn,Hn,cr),jv(ke,mn,Wn,pr,bn,Hn,cr),jv(ke,mn,Wn,pr,bn,Hn,cr),jv(ke,mn,Wn,pr,bn,Hn,cr),$v(e.dynamicLayoutVertexArray,mn,Wn,pr,st)}else $v(e.dynamicLayoutVertexArray,M.x,M.y,M.z,st);if(_e){const mn=on||Jt;Uv(e.iconTransitioningVertexArray,mn.x,mn.y),Uv(e.iconTransitioningVertexArray,mn.x+mn.w,mn.y),Uv(e.iconTransitioningVertexArray,mn.x,mn.y+mn.h),Uv(e.iconTransitioningVertexArray,mn.x+mn.w,mn.y+mn.h)}ve.emplaceBack(Rn,Rn+1,Rn+2),ve.emplaceBack(Rn+1,Rn+2,Rn+3),ze.vertexLength+=4,ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(an[0]),Ut!==i.length-1&&Xn===i[Ut+1].sectionIndex||e.programConfigurations.populatePaintArrays(De.length,m,m.index,{},Q,ee,he,lt&&lt[Xn],this.worldview)}const ft=C?C.anchor:M;e.placedSymbolArray.emplaceBack(ft.x,ft.y,ft.z,M.x,M.y,Je,this.glyphOffsetArray.length-Je,Qe,B,U,M.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],w,0,0,0,$,0)}_commitLayoutVertex(e,i,l,u,f,m,w){e.emplaceBack(i,l,u,f,m,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,i,l,u,f,m,w){const C=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),M=C.vertexLength,B=w.tileAnchorX,U=w.tileAnchorY;for(let Q=0;Q<4;Q++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,e.padding,w.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,B,U,new Kt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,B,U,new Kt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,B,U,new Kt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,B,U,new Kt(e.x1,e.y2)),C.vertexLength+=4;const $=l.indexArray;$.emplaceBack(M,M+1),$.emplaceBack(M+1,M+2),$.emplaceBack(M+2,M+3),$.emplaceBack(M+3,M),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,u,f,m){for(let w=u;w<f;w++){const C=l.get(w),M=this.getSymbolInstanceTextSize(e,m,i,w);this._addCollisionDebugVertices(C,M,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,l,u,f,m){for(let w=u;w<f;w++){const C=l.get(w),M=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(C,M,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new l2(Qh,lE.members,zo),this.iconCollisionBox=new l2(Qh,lE.members,zo);const u=J_(this.iconSizeData,e),f=J_(this.textSizeData,e,l);for(let m=0;m<this.symbolInstances.length;m++){const w=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(f,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(f,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(u,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,i,l,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),m=e2(this.textSizeData,e,f)/Ss;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,l){const u=this.icon.placedSymbolArray.get(l),f=e2(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,l,u){e.emplaceBack(i,-l,-l,u),e.emplaceBack(i,l,-l,u),e.emplaceBack(i,l,l,u),e.emplaceBack(i,-l,l,u)}_updateTextDebugCollisionBoxes(e,i,l,u,f,m,w){for(let C=u;C<f;C++){const M=l.get(C),B=this.getSymbolInstanceTextSize(e,m,i,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,B,M.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,l,u,f,m,w){for(let C=u;C<f;C++){const M=l.get(C),B=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,B,M.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=J_(this.iconSizeData,e,u),m=J_(this.textSizeData,e,l);for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(m,e,i,C.textBoxStartIndex,C.textBoxEndIndex,C,l),this._updateTextDebugCollisionBoxes(m,e,i,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,l),this._updateIconDebugCollisionBoxes(f,e,i,C.iconBoxStartIndex,C.iconBoxEndIndex,C,u),this._updateIconDebugCollisionBoxes(f,e,i,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,u,f,m,w,C,M){const B={};if(i<l){const{x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze,featureIndex:Je}=e.get(i);B.textBox={x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze},B.textFeatureIndex=Je}if(u<f){const{x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze,featureIndex:Je}=e.get(u);B.verticalTextBox={x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze},B.verticalTextFeatureIndex=Je}if(m<w){const{x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze,featureIndex:Je}=e.get(m);B.iconBox={x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze},B.iconFeatureIndex=Je}if(C<M){const{x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze,featureIndex:Je}=e.get(C);B.verticalIconBox={x1:U,y1:$,x2:Q,y2:ee,padding:he,projectedAnchorX:_e,projectedAnchorY:ve,projectedAnchorZ:De,tileAnchorX:ke,tileAnchorY:ze},B.verticalIconFeatureIndex=Je}return B}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),u=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),u=[],f=[],m=[];for(let w=0;w<this.symbolInstances.length;++w){m.push(w);const C=this.symbolInstances.get(w);u.push(0|Math.round(i*C.tileAnchorX+l*C.tileAnchorY)),f.push(C.featureIndex)}return m.sort(((w,C)=>u[w]-u[C]||f[C]-f[w])),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:M}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let YE,XE,c2;In(Hv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hv.addDynamicAttributes=$v;class KE{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:fl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}In(KE,"FormatSectionOverride",{omit:["defaultValue"]});const u2=()=>c2||(c2={layout:YE||(YE=new oo({"symbol-placement":new ln(yt.layout_symbol["symbol-placement"]),"symbol-spacing":new ln(yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ln(yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ln(yt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ln(yt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ln(yt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ln(yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ln(yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ln(yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ln(yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(yt.layout_symbol["icon-size"]),"icon-size-scale-range":new ln(yt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new wn(yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wn(yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(yt.layout_symbol["icon-image"]),"icon-image-use-theme":new ln({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new wn(yt.layout_symbol["icon-rotate"]),"icon-padding":new ln(yt.layout_symbol["icon-padding"]),"icon-keep-upright":new ln(yt.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(yt.layout_symbol["icon-offset"]),"icon-anchor":new wn(yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ln(yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ln(yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ln(yt.layout_symbol["text-rotation-alignment"]),"text-field":new wn(yt.layout_symbol["text-field"]),"text-font":new wn(yt.layout_symbol["text-font"]),"text-size":new wn(yt.layout_symbol["text-size"]),"text-size-scale-range":new ln(yt.layout_symbol["text-size-scale-range"]),"text-max-width":new wn(yt.layout_symbol["text-max-width"]),"text-line-height":new wn(yt.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(yt.layout_symbol["text-letter-spacing"]),"text-justify":new wn(yt.layout_symbol["text-justify"]),"text-radial-offset":new wn(yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ln(yt.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(yt.layout_symbol["text-anchor"]),"text-max-angle":new ln(yt.layout_symbol["text-max-angle"]),"text-writing-mode":new ln(yt.layout_symbol["text-writing-mode"]),"text-rotate":new wn(yt.layout_symbol["text-rotate"]),"text-padding":new ln(yt.layout_symbol["text-padding"]),"text-keep-upright":new ln(yt.layout_symbol["text-keep-upright"]),"text-transform":new wn(yt.layout_symbol["text-transform"]),"text-offset":new wn(yt.layout_symbol["text-offset"]),"text-allow-overlap":new ln(yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ln(yt.layout_symbol["text-ignore-placement"]),"text-optional":new ln(yt.layout_symbol["text-optional"]),visibility:new ln(yt.layout_symbol.visibility)})),paint:XE||(XE=new oo({"icon-opacity":new wn(yt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wn(yt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wn(yt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wn(yt.paint_symbol["text-emissive-strength"]),"icon-color":new wn(yt.paint_symbol["icon-color"]),"icon-halo-color":new wn(yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(yt.paint_symbol["icon-halo-blur"]),"icon-translate":new ln(yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ln(yt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ln(yt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wn(yt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wn(yt.paint_symbol["text-occlusion-opacity"]),"text-color":new wn(yt.paint_symbol["text-color"],{runtimeType:Zs,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new wn(yt.paint_symbol["text-halo-color"]),"text-halo-width":new wn(yt.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(yt.paint_symbol["text-halo-blur"]),"text-translate":new ln(yt.paint_symbol["text-translate"]),"text-translate-anchor":new ln(yt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ln(yt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ln(yt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ln(yt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ln(yt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new wn(yt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},c2);class qv extends Ds{constructor(e,i,l,u){super(e,u2(),i,l,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=O([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const f of l)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,l,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(f,m,w,C){f=$s(f),m=rs(m);const M=D(),B=f/3,U=1-2*B,$=[U,B,B,0,B,U,B,0,B,B,U,0,0,0,0,1],Q=.5-.5*m,ee=C-w;return H(M,[ee,0,0,0,0,ee,0,0,0,0,ee,0,w,w,w,1],[m,0,0,0,0,m,0,0,0,0,m,0,Q,Q,Q,1]),H(M,M,$),M})(e,i,l,u),this._saturation=e,this._contrast=i,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,l,u){const f=this.layout.get(e).evaluate(i,{},l,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||am(m.value)||!f?f:(function(w,C){return C.replace(/{([^{}]+)}/g,((M,B)=>B in w?String(w[B]):""))})(i.properties,f)}createBucket(e){return new Hv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of u2().paint.overridableProperties){if(!qv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new KE(i),u=new Wh(l,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new xl("source",u):new Js("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Hu(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&qv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),u=u2().paint.properties[i];let f=!1;const m=w=>{for(const C of w)if(u.overrides&&u.overrides.hasOverride(C))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof vs)m(l.value.value.sections);else if(l.value.kind==="source"){const w=M=>{f||(M instanceof br&&$o(M.value)===Go?m(M.value.sections):M instanceof Mu?m(M.sections):M.eachChild(w))},C=l.value;C._styleExpression&&w(C._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,l){return{config:new Al(this,{zoom:i,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let JE,QE,e3,t3;var d2=jr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Wv(o,e,i,l,u,f,m,w){const C=[o,e,1,i,l,1,u,f,1],M=[m,w,1],B=z([],C),[U,$,Q]=It(M,M,B);return R(C,C,[U,0,0,0,$,0,0,0,Q])}function n3(o,e,i,l,u,f,m,w){const C=(function(M,B,U,$,Q,ee,he,_e){const ve=Wv(0,0,1,0,1,1,0,1),De=Wv(M,B,U,$,Q,ee,he,_e);return R(De,De,z([],ve))})(o,e,i,l,u,f,m,w);return[C[2]/C[8]/hn,C[5]/C[8]/hn]}function Zv(o){return[o[0],Math.min(Math.max(o[1],-Xe),Xe)]}class r3 extends Uc{constructor(e,i,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ga("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Vc(this.map._requestManager.transformRequest(this.url,wh.Image),((l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new gc(l)):u&&(this.image=u instanceof HTMLImageElement?Ua.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new W_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ga("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof W_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],l=e[0][1];for(const f of e)f[1]>l&&(l=f[1]),f[1]<i&&(i=f[1]);const u=(l+i)/2;if(u>Xe?this.onNorthPole=!0:u<-Xe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(Pt.fromLngLat);this.tileID=(function(m){let w=1/0,C=1/0,M=-1/0,B=-1/0;for(const he of m)w=Math.min(w,he.x),C=Math.min(C,he.y),M=Math.max(M,he.x),B=Math.max(B,he.y);const U=Math.max(M-w,B-C),$=Math.max(0,Math.floor(-Math.log2(U))),Q=Math.pow(2,$);let ee=Math.floor((w+M)/2*Q);return ee>1&&(ee-=1),new x($,ee,Math.floor((C+B)/2*Q))})(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ga("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof W_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ve in this.tiles){const De=this.tiles[ve];De.state!=="loaded"&&(De.state="loaded",De.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=n0(new x(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ve){const De=ve[1].x-ve[0].x,ke=ve[1].y-ve[0].y,ze=ve[2].x-ve[1].x,Je=ve[2].y-ve[1].y,Qe=ve[3].x-ve[2].x,st=ve[3].y-ve[2].y,lt=ve[0].x-ve[3].x,ft=ve[0].y-ve[3].y,Ut=De*Je-ze*ke,vt=ze*st-Qe*Je,$t=Qe*ft-lt*st,tn=lt*ke-De*ft;return Ut>0&&vt>0&&$t>0&&tn>0||Ut<0&&vt<0&&$t<0&&tn<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=n0(this.tileID,this.map.transform.projection),[f,m,w,C]=this.coordinates.map((ve=>{const De=u.projection.project(ve[0],ve[1]);return GE(u,De)._round()}));this.perspectiveTransform=n3(f.x,f.y,m.x,m.y,w.x,w.y,C.x,C.y);const M=this._boundsArray=new ou;M.emplaceBack(f.x,f.y,0,0),M.emplaceBack(m.x,m.y,hn,0),M.emplaceBack(C.x,C.y,0,hn),M.emplaceBack(w.x,w.y,hn,hn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(M,d2.members),this.boundsSegments=Pi.simpleSegment(0,0,4,2);const B=[],U=[Zv(($=this.coordinates)[0]),Zv($[1]),Zv($[2]),Zv($[3])];var $;const[Q,ee,he,_e]=(function(ve){let De=ve[0][0],ke=De,ze=ve[0][1],Je=ze;for(let Qe=1;Qe<ve.length;Qe++)ve[Qe][0]<De?De=ve[Qe][0]:ve[Qe][0]>ke&&(ke=ve[Qe][0]),ve[Qe][1]<ze?ze=ve[Qe][1]:ve[Qe][1]>Je&&(Je=ve[Qe][1]);return[De,ze,ke-De,Je-ze]})(U);{const ve=new ou,[De,ke,ze,Je]=(function(Bt){let Qt=Bt[0].x,Dt=Qt,Et=Bt[0].y,an=Et;for(let rn=1;rn<Bt.length;rn++)Bt[rn].x<Qt?Qt=Bt[rn].x:Bt[rn].x>Dt&&(Dt=Bt[rn].x),Bt[rn].y<Et?Et=Bt[rn].y:Bt[rn].y>an&&(an=Bt[rn].y);return[Qt,Et,Dt-Qt,an-Et]})(l),Qe=Bt=>[(Bt.x-De)/ze,(Bt.y-ke)/Je],[st,lt,ft,Ut]=l.map(Qe),vt=(function(Bt,Qt,Dt,Et,an,rn,Xn,Rn){const Un=Wv(0,0,1,0,1,1,0,1);return R(Un,Un,z([],Wv(Bt,Qt,Dt,Et,an,rn,Xn,Rn)))})(st[0],st[1],lt[0],lt[1],ft[0],ft[1],Ut[0],Ut[1]);this.elevatedGlobePerspectiveTransform=n3(st[0],st[1],lt[0],lt[1],ft[0],ft[1],Ut[0],Ut[1]);const $t=(Bt,Qt)=>{B.push(Bt.lng);const Dt=Math.round((Bt.lng-Q)/he*hn),Et=Math.round((Bt.lat-ee)/_e*hn),an=Qe(Qt),rn=It([],[an[0],an[1],1],vt),Xn=Math.round(rn[0]/rn[2]*hn),Rn=Math.round(rn[1]/rn[2]*hn);ve.emplaceBack(Dt,Et,Xn,Rn)},tn=l[3].x-l[0].x,qt=l[3].y-l[0].y,Jt=l[2].x-l[1].x,on=l[2].y-l[1].y;for(let Bt=0;Bt<65;Bt++){const Qt=Bt/64,Dt=[l[0].x+Qt*tn,l[0].y+Qt*qt],Et=[l[1].x+Qt*Jt,l[1].y+Qt*on],an=Et[0]-Dt[0],rn=Et[1]-Dt[1];for(let Xn=0;Xn<65;Xn++){const Rn=Xn/64,Un={x:Dt[0]+an*Rn,y:Dt[1]+rn*Rn};$t(i.projection.unproject(Un.x,Un.y),Un)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ve,d2.members)}{this.maxLongitudeTriangleSize=0;let ve=[],De=new Fo;const ke=(ze,Je,Qe)=>{De.emplaceBack(ze,Je,Qe);const st=B[ze],lt=B[Je],ft=B[Qe],Ut=Math.min(Math.min(st,lt),ft),vt=Math.max(Math.max(st,lt),ft)-Ut;vt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=vt),ve.push(Ut+vt/2)};for(let ze=0;ze<64;ze++)for(let Je=0;Je<64;Je++){const Qe=65*ze+Je,st=Qe+1,lt=Qe+65,ft=lt+1;ke(Qe,lt,st),ke(st,lt,ft)}[ve,De]=(function(ze,Je){const Qe=Array.from({length:ze.length},((ft,Ut)=>Ut));Qe.sort(((ft,Ut)=>ze[ft]-ze[Ut]));const st=[],lt=new Fo;for(let ft=0;ft<Qe.length;ft++){const Ut=Qe[ft];st.push(ze[Ut]);const vt=3*Ut,$t=vt+1;lt.emplaceBack(Je.uint16[vt],Je.uint16[$t],Je.uint16[$t+1])}return[st,lt]})(ve,De),this.elevatedGlobeTrianglesCenterLongitudes=ve,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(De)}this.elevatedGlobeSegments=Pi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,he/hn,0,_e/hn,0,0,ee,Q,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof W_||(this.texture?this.texture.update(this.image):(this.texture=new Nb(i,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(f=e+180)+360*Math.round((l[0]-f)/360);var f;const m=new Pi,w=(U,$)=>{m.segments.push({vertexOffset:0,primitiveOffset:U,vertexLength:i.segments[0].vertexLength,primitiveLength:$,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=C){const U=ts(l,0,l.length,u+C);return U===l.length||w(U,Hr(l,U+1,l.length,u+360-C)-U),m}u<l[0]&&(u+=360);const M=Hr(l,0,l.length,u-C);if(M===l.length)return w(0,l.length),m;w(0,M-0);const B=ts(l,M+1,l.length,u+C);return B!==l.length&&w(B,l.length-B),m}}const MO=(Math.pow(256,2)-1)/16907520;class i3 extends Ds{constructor(e,i,l,u){super(e,{layout:e3||(e3=new oo({visibility:new ln(yt.layout_raster.visibility)})),paint:t3||(t3=new oo({"raster-opacity":new ln(yt.paint_raster["raster-opacity"]),"raster-color":new Wu(yt.paint_raster["raster-color"]),"raster-color-mix":new ln(yt.paint_raster["raster-color-mix"]),"raster-color-range":new ln(yt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ln(yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ln(yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ln(yt.paint_raster["raster-brightness-max"]),"raster-saturation":new ln(yt.paint_raster["raster-saturation"]),"raster-contrast":new ln(yt.paint_raster["raster-contrast"]),"raster-resampling":new ln(yt.paint_raster["raster-resampling"]),"raster-fade-duration":new ln(yt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ln(yt.paint_raster["raster-emissive-strength"]),"raster-array-band":new ln(yt.paint_raster["raster-array-band"]),"raster-elevation":new ln(yt.paint_raster["raster-elevation"]),"raster-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof r3&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=D_({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let o3,s3,a3,l3,c3;class u3 extends Ds{constructor(e,i,l,u){super(e,{layout:o3||(o3=new oo({visibility:new ln(yt["layout_raster-particle"].visibility)})),paint:s3||(s3=new oo({"raster-particle-array-band":new ln(yt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ln(yt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Wu(yt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ln(yt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ln(yt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ln(yt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ln(yt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ln(yt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,u),this._updateColorRamp(),this.lastInvalidatedAt=Ua.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=D_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ua.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class IO extends Ds{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function h2(o,e,i){const l=[0,0,1],u=dn([]);return Gt(u,u,i?-_t(o)+Math.PI:_t(o)),An(u,u,-_t(e)),jt(l,l,u),nt(l,l)}const d3={None:0,Model:1,Symbol:2,FillExtrusion:4};class Yv{constructor(e,i,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function f2(o,e){const i=o.indexOf("://")===-1;try{return new URL(o,i&&e?"http://example.com":void 0),!0}catch{return!1}}class h3{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class f3{constructor(){this.instancedDataArray=new vm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class p2{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,l,u){this.tileToMeter=bt(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:w,index:C,sourceLayerIndex:M}of e){const B=w??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),U=Ht(m,f);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview}),U,l))continue;const $={id:B,sourceLayerIndex:M,index:C,geometry:f?U.geometry:Sn(m,l,u),properties:m.properties,type:m.type,patterns:{}},Q=this.addFeature($,$.geometry,U);Q&&i.featureIndex.insert(m,$.geometry,C,M,this.index,this.instancesPerModel[Q].instancedDataArray.length,hn/32)}this.lookup=null}update(e,i,l,u){for(const f in this.instancesPerModel){const m=this.instancesPerModel[f];for(const w in e)m.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(m.features[m.idToFeaturesIndex[w]],e[w],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const u of l.features){const f=this.layers[0],m=u.feature,w=this.canonical,C=f.paint.get("model-rotation").evaluate(m,{},w),M=f.paint.get("model-scale").evaluate(m,{},w),B=f.paint.get("model-translation").evaluate(m,{},w);Se(u.rotation,C)&&Se(u.scale,M)&&Se(u.translation,B)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,i,l,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(xv(this.activeReplacements,f))return!1;this.activeReplacements=f;let m=!1;for(const w in this.instancesPerModel){const C=this.instancesPerModel[w],M=C.instancedDataArray;for(const B of C.features){const U=B.instancedDataOffset,$=B.instancedDataCount;for(let Q=0;Q<$;Q++){const ee=16*(Q+U);let he=M.float32[ee+0];const _e=he>hn;he=_e?he-hn:he;const ve=Math.floor(he),De=M.float32[ee+1];let ke=!1;for(const ze of this.activeReplacements)if(!QT(ze,l,d3.Model,u)&&!(ze.min.x>ve||ve>ze.max.x||ze.min.y>De||De>ze.max.y)&&(ke=Ab(rC(ve,De,e.canonical,ze.footprintTileId.canonical),ze.footprint),ke))break;M.float32[ee]=ke?he+hn:he,m=m||ke!==_e}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,ok.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,l){const u=this.layers[0],f=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return Vr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),f;(f2(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new f3);const m=this.instancesPerModel[f],w=m.instancedDataArray,C=new h3(l,w.length);for(const M of i)for(const B of M){if(B.x<0||B.x>=hn||B.y<0||B.y>=hn)continue;if(this.lookupDim!==0){const $=(this.lookupDim-1)/hn,Q=this.lookupDim*(B.y*$|0)+B.x*$|0;if(this.lookup){if(this.lookup[Q]!==0)continue;this.lookup[Q]=1}}this.instanceCount++;const U=w.length;w.resize(U+1),m.instancesEvaluatedElevation.push(0),w.float32[16*U]=B.x,w.float32[16*U+1]=B.y}return C.instancedDataCount=m.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(C),this.evaluate(C,{},m,!1)),f}getModelUris(){return this.modelUris}evaluate(e,i,l,u){const f=this.layers[0],m=e.feature,w=this.canonical,C=e.rotation=f.paint.get("model-rotation").evaluate(m,i,w),M=e.scale=f.paint.get("model-scale").evaluate(m,i,w),B=e.translation=f.paint.get("model-translation").evaluate(m,i,w),U=f.paint.get("model-color").evaluate(m,i,w);U.a=f.paint.get("model-color-mix-intensity").evaluate(m,i,w);const $=[];this.maxVerticalOffset<B[2]&&(this.maxVerticalOffset=B[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),BC($,C,M);const Q=Math.round(100*U.a)+U.b/1.05;for(let ee=0;ee<e.instancedDataCount;++ee){const he=e.instancedDataOffset+ee,_e=16*he,ve=l.instancedDataArray.float32;let De=0;u&&(De=ve[_e+6]-l.instancesEvaluatedElevation[he]);const ke=0|ve[_e+1];ve[_e]=(0|ve[_e])+U.r/1.05,ve[_e+1]=ke+U.g/1.05,ve[_e+2]=Q,ve[_e+3]=1/(w.z>10?this.tileToMeter:bt(w,ke)),ve[_e+4]=B[0],ve[_e+5]=B[1],ve[_e+6]=B[2]+De,ve[_e+7]=$[0],ve[_e+8]=$[1],ve[_e+9]=$[2],ve[_e+10]=$[4],ve[_e+11]=$[5],ve[_e+12]=$[6],ve[_e+13]=$[8],ve[_e+14]=$[9],ve[_e+15]=$[10],l.instancesEvaluatedElevation[he]=B[2]}}}let p3,m3;In(p2,"ModelBucket",{omit:["layers"]}),In(f3,"PerModelAttributes"),In(h3,"ModelFeature");class kg{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const u=l||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,w=1<<i.canonical.z-m.canonical.z;return new kg(u,f.dim/hn/w,[(i.canonical.x/w-m.canonical.x)*f.dim,(i.canonical.y/w-m.canonical.y)*f.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1];return new Kt(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,i,l,u){const f=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],w=Math.floor(f),C=Math.floor(m),M=this._dem;return u=!!u,l?Qn(Qn(M.get(w,C,u),M.get(w,C+1,u),m-C),Qn(M.get(w+1,C,u),M.get(w+1,C+1,u),m-C),f-w):M.get(w,C,u)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*He(1,e)*this._dem.stride}}const m2=new Float32Array(262144),Mm=new Uint8Array(262144);function g3(o){let e=0;if(o.meshes)for(const i of o.meshes)e=Math.max(e,i.aabb.max[2]);if(o.children)for(const i of o.children)e=Math.max(e,g3(i));return e}function _3(o,e,i){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const u=Fn.applyTransform(l.aabb,o.matrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const l of o.children)_3(l,e,i)}const y3=["","wall","door","roof","window","lamp","logo"];class v3{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:g3(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Fn.applyTransformFast(l.aabb,this.node.matrix),i.encapsulate(l.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Xv{constructor(e,i,l,u,f,m,w,C){this.id=l,this.layers=e,this.layerIds=this.layers.map((M=>M.fqid)),this.stateDependentLayerIds=this.layers.filter((M=>M.isStateDependent())).map((M=>M.id)),this.modelTraits|=Ag.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Ag.HasMapboxMeshFeatures),f&&(this.modelTraits|=Ag.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const M of i)this.nodesInfo.push(new v3(M)),_3(M,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const l=i?this.stateDependentLayers:this.layers;if(!yo(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const u=l.node;this.uploaded?this.updatePbrBuffer(u):jb(u,e,!0)}for(const l of i)Iv(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(e,i,l){const u=e.transform.projectionOptions,f=e.style.getBrightness(),m=this.brightness!==f;if(!this.uploaded||this.dirty||u.name!==this.projection.name||a0(l.paint.get("model-color").value,m)||a0(l.paint.get("model-color-mix-intensity").value,m)||a0(l.paint.get("model-roughness").value,m)||a0(l.paint.get("model-emissive-strength").value,m)||a0(l.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=u,this.brightness=f;const w=this.getNodesInfo();for(const C of w)C.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const f of l){const m=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},u),f.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e,i){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const f=u.feature,m=i&&i[f.id];if(yo(m,u.state))continue;u.state=structuredClone(m);const w=u.node.meshes&&u.node.meshes[0].featureData,C=u.evaluatedColor[2],M=u.evaluatedRMEA[2],B=this.id.canonical;if(u.hasTranslucentParts=!1,w){for(let U=0;U<y3.length;U++){const $=y3[U];$.length&&(f.properties.part=$);const Q=e.paint.get("model-color").evaluate(f,m,B).toPremultipliedRenderColor(null),ee=e.paint.get("model-color-mix-intensity").evaluate(f,m,B);u.evaluatedColor[U]=[Q.r,Q.g,Q.b,ee],u.evaluatedRMEA[U][0]=e.paint.get("model-roughness").evaluate(f,m,B),u.evaluatedRMEA[U][2]=e.paint.get("model-emissive-strength").evaluate(f,m,B),u.evaluatedRMEA[U][3]=Q.a,u.emissionHeightBasedParams[U]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,m,B),!u.hasTranslucentParts&&Q.a<1&&(u.hasTranslucentParts=!0)}delete f.properties.part,DO(u,C!==u.evaluatedColor[2]||M!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,m,B);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,m,B),u.evaluatedScale=e.paint.get("model-scale").evaluate(f,m,B),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,l,u){const f=e.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const m=kg.create(e,l,f);if(!m)return;this.modelTraits&Ag.HasMapboxMeshFeatures&&this.updateDEM(e,m,l,u);for(const w of this.getNodesInfo()){const C=w.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const M=C.footprint.vertices;let B=m.getElevationAt(M[0].x,M[0].y,!0,!0);for(let U=1;U<M.length;U++)B=Math.min(B,m.getElevationAt(M[U].x,M[U].y,!0,!0));C.elevation=B}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,l,u){let f=i._dem._modifiedForSources[u];if(f===void 0&&(i._dem._modifiedForSources[u]=[],f=i._dem._modifiedForSources[u]),f.includes(l.canonical))return;const m=i._dem.dim;f.push(l.canonical);let w=!1;for(const C of this.getNodesInfo()){const M=C.node;if(!M.footprint||!M.footprint.grid)continue;const B=M.footprint.grid,U=i.tileCoordToPixel(B.min.x,B.min.y),$=i.tileCoordToPixel(B.max.x,B.max.y),Q=Math.min(Math.min(m-$.y,U.x),Math.min(U.y,m-$.x));if(Q<0)continue;const ee=et(Q,2,5);let he=Math.max(0,U.x-ee),_e=Math.max(0,U.y-ee),ve=Math.min($.x+ee,m-1),De=Math.min($.y+ee,m-1);for(let Qe=_e;Qe<=De;++Qe)for(let st=he;st<=ve;++st)Mm[Qe*m+st]=255;let ke=0,ze=0;for(let Qe=0;Qe<B.cellsY;++Qe)for(let st=0;st<B.cellsX;++st){if(!B.cells[Qe*B.cellsX+st])continue;const lt=i.tileCoordToPixel(B.min.x+st/B.xScale,B.min.y+Qe/B.yScale),ft=i.tileCoordToPixel(B.min.x+(st+1)/B.xScale,B.min.y+(Qe+1)/B.yScale);for(let Ut=lt.y;Ut<=Math.min(ft.y+1,m-1);++Ut)for(let vt=lt.x;vt<=Math.min(ft.x+1,m-1);++vt)Mm[Ut*m+vt]===255&&(Mm[Ut*m+vt]=0,ke+=i.getElevationAtPixel(vt,Ut),ze++)}const Je=ke/ze;he=Math.max(1,U.x-ee),_e=Math.max(1,U.y-ee),ve=Math.min($.x+ee,m-2),De=Math.min($.y+ee,m-2),w=!0;for(let Qe=_e;Qe<=De;++Qe)for(let st=he;st<=ve;++st)Mm[Qe*m+st]===0&&(m2[Qe*m+st]=i._dem.set(st,Qe,Je));for(let Qe=1;Qe<ee;++Qe){he=Math.max(1,U.x-Qe),_e=Math.max(1,U.y-Qe),ve=Math.min($.x+Qe,m-2),De=Math.min($.y+Qe,m-2);for(let st=_e;st<=De;++st)for(let lt=he;lt<=ve;++lt){const ft=st*m+lt;if(Mm[ft]===255){let Ut=0,vt=0,$t=-1,tn=-1;for(let qt=-1;qt<=1;++qt)for(let Jt=-1;Jt<=1;++Jt){const on=(st+qt)*m+lt+Jt;if(Mm[on]>=Qe)continue;const Bt=m2[on],Qt=Math.abs(Bt);Qt>vt&&(Ut=Bt,vt=Qt,$t=Jt,tn=qt)}if(vt>.1){const qt=1-(Qe+.5*Math.abs($t*tn))/ee;let Jt=i._dem.get(lt,st)+Ut*qt;const on=i._dem.get(lt+$t,st+tn),Bt=i._dem.get(lt-$t,st-tn,!0);(Jt-on)*(Jt-Bt)>0&&(Jt=(on+Bt)/2),m2[ft]=i._dem.set(lt,st,Jt),Mm[ft]=Qe}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ua.now())}setFilter(e){this.filter=e?Zu(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new ki(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Iv(i.node),Gb(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const f=u.node.footprint;u.hiddenByReplacement=!!f&&!l.find((m=>m.footprint===f))}}getHeightAtTileCoord(e,i){const l=[],u=[0,0,0],f=O([]);for(const m of this.getNodesInfo()){const w=m.node.meshes[0],C=w.transformedAabb;if(e<C.min[0]||i<C.min[1]||e>C.max[0]||i>C.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};N(f,m.node.matrix),u[0]=e,u[1]=i,xt(u,u,f);const M=(u[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Em|0,B=Math.min(63,(u[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Em|0)*Em+Math.min(63,M),U=w.heightmap[B];if(!(U<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:U,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Kt(e,i),new Kt(e,i),l),l.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function a0(o,e){return o instanceof xl&&!o.isLightConstant&&e}function RO(o,e,i,l,u,f,m,w){let C=(61440&e|(61440&e)>>4)>>8,M=(3840&e|(3840&e)>>4)>>4,B=240&e|(240&e)>>4;i[3]>0&&(C=Qn(C,255*i[0],i[3]),M=Qn(M,255*i[1],i[3]),B=Qn(B,255*i[2],i[3]));const U=C<<8|M,$=B<<8|Math.floor(255*l[3]),Q=(function(Qe){const st=et(Qe,0,2);return Math.min(Math.round(.5*st*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],ee=et(u[0],0,1),he=et(u[1],0,1),_e=et(u[2],0,1),ve=et(u[3],0,1);let De,ke,ze,Je;if(ee!==he&&m!==f&&he!==ee){const Qe=m-f;ke=1/(Qe*(he-ee)),ze=-(f+Qe*ee)/(Qe*(he-ee));const st=et(u[4],-1,1);Je=Math.pow(10,st),De=255*_e<<8|255*ve}else De=65535,ke=0,ze=1,Je=1;if(o.emplaceBack(U,$,Q,De,ke,ze,Je),w){const Qe=w.length;w.clear();for(let st=0;st<Qe;st++)w.emplaceBack(U,$,Q,De,ke,ze,Je)}}function DO(o,e,i){const l=o.node;let u=0;const f=i&Ag.HasMeshoptCompression;for(const m of l.meshes){if(l.lights&&l.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new ta,m.featureArray.reserve(m.featureData.length);let w=e;for(const C of m.featureData){const M=f?65535&C:C>>16&65535,B=f?C>>16&65535:65535&C,U=(15&B)<8?15&B:0,$=o.evaluatedRMEA[U],Q=o.evaluatedColor[U],ee=o.emissionHeightBasedParams[U];let he;if(w&&U===2&&l.lights&&(he=new ta,he.resize(10*l.lights.length)),RO(m.featureArray,M,Q,$,ee,m.aabb.min[2],m.aabb.max[2],he),he&&w){w=!1;const _e=l.meshes[l.lightMeshIndex];_e.featureArray=he,_e.featureArray._trim()}}m.featureArray._trim(),u++}}function x3(o,e,i,l){const u=1<<o.z;e.lat=qe((l/hn+o.y)/u),e.lng=Ye((i/hn+o.x)/u)}function kO(o,e,i,l){const u=o.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let f=Number.MAX_VALUE;const m=u.node,w=i.tile,C=l.calculatePosMatrix(w.tileID.toUnwrapped(),l.worldSize),M=u.evaluatedScale;let B=0;l.elevation&&m.elevation&&(B=m.elevation*l.elevation.exaggeration()),j(C,C,[(m.anchor?m.anchor[0]:0)*(M[0]-1),(m.anchor?m.anchor[1]:0)*(M[1]-1),B]),V(C,C,M);const U=i.queryGeometry,$=U.isPointQuery()?U.screenBounds:U.screenGeometry,Q=function(he){const _e=H([],C,he.matrix);H(_e,l.expandedFarZProjMatrix,_e);for(let ve=0;ve<he.meshes.length;++ve){const De=he.meshes[ve];if(ve===he.lightMeshIndex)continue;const ke=NC($,l,_e,De.aabb);ke!=null&&(f=Math.min(ke,f))}if(he.children)for(const ve of he.children)Q(ve)};if(Q(m),f===Number.MAX_VALUE)return;const ee=new ce(0,0);return x3(w.tileID.canonical,ee,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:f,position:ee,feature:u.feature}}In(Xv,"Tiled3dModelBucket",{omit:["layers"]}),In(v3,"Tiled3dModelFeature");const OO={circle:class extends Ds{constructor(o,e,i,l){super(o,{layout:tc||(tc=new oo({"circle-sort-key":new wn(yt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ln(yt.layout_circle["circle-elevation-reference"]),visibility:new ln(yt.layout_circle.visibility)})),paint:Ml||(Ml=new oo({"circle-radius":new wn(yt.paint_circle["circle-radius"]),"circle-color":new wn(yt.paint_circle["circle-color"]),"circle-blur":new wn(yt.paint_circle["circle-blur"]),"circle-opacity":new wn(yt.paint_circle["circle-opacity"]),"circle-translate":new ln(yt.paint_circle["circle-translate"]),"circle-translate-anchor":new ln(yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ln(yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ln(yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(yt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ln(yt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}createBucket(o){return new bo(o)}queryRadius(o){const e=o;return ra("circle-radius",this,e)+ra("circle-stroke-width",this,e)+Ql(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,i,l,u,f,m,w){const C=Pl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return ET(o,l,f,m,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,i){const l=CT(this);return{config:new Al(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ds{createBucket(o){return new PT(o)}constructor(o,e,i,l){super(o,{layout:MT||(MT=new oo({visibility:new ln(yt.layout_heatmap.visibility)})),paint:IT||(IT=new oo({"heatmap-radius":new wn(yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ln(yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wu(yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ln(yt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return ra("heatmap-radius",this,o)}queryIntersectsFeature(o,e,i,l,u,f,m,w){const C=this.paint.get("heatmap-radius").evaluate(e,i);return ET(o,l,f,m,w,!0,!0,new Kt(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,i){return o==="heatmap"?{config:new Al(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Ds{constructor(o,e,i,l){super(o,{layout:RT||(RT=new oo({visibility:new ln(yt.layout_hillshade.visibility)})),paint:DT||(DT=new oo({"hillshade-illumination-direction":new ln(yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ln(yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ln(yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ln(yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ln(yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ln(yt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ln(yt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}},fill:class extends Ds{constructor(o,e,i,l){super(o,{layout:WT||(WT=new oo({"fill-sort-key":new wn(yt.layout_fill["fill-sort-key"]),visibility:new ln(yt.layout_fill.visibility),"fill-elevation-reference":new ln(yt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new wn(yt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:ZT||(ZT=new oo({"fill-antialias":new ln(yt.paint_fill["fill-antialias"]),"fill-opacity":new wn(yt.paint_fill["fill-opacity"]),"fill-color":new wn(yt.paint_fill["fill-color"]),"fill-outline-color":new wn(yt.paint_fill["fill-outline-color"]),"fill-translate":new ln(yt.paint_fill["fill-translate"]),"fill-translate-anchor":new ln(yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new wn(yt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ln(yt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ln(yt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new wn(yt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new wn(yt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new wn(yt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(o,e,i){return{config:new Al(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Tb(o)}queryRadius(){return Ql(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,i,l,u,f){return!o.queryGeometry.isAboveHorizon&&as(ec(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ds{constructor(o,e,i,l){super(o,{layout:_C||(_C=new oo({visibility:new ln(yt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ln(yt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yC||(yC=new oo({"fill-extrusion-opacity":new ln(yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ln(yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ln(yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wn(yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ln(yt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new wn(yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ln(yt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ln(yt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ln(yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ln(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ln(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ln(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ln(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ln(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ln(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ln(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wn(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wn(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ln(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ln(yt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ln(yt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ln(yt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wn(yt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new wn(yt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ln(yt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new wv(o)}queryRadius(){return Ql(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,i,l,u,f,m,w,C){const M=Pl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),B=this.paint.get("fill-extrusion-height").evaluate(e,i),U=this.paint.get("fill-extrusion-base").evaluate(e,i),$=[0,0],Q=w&&f.elevation,ee=f.elevation?f.elevation.exaggeration():1,he=o.tile.getBucket(this);if(Q&&he instanceof wv){const ze=he.centroidVertexArray,Je=C+1;Je<ze.length&&($[0]=ze.geta_centroid_pos0(Je),$[1]=ze.geta_centroid_pos1(Je))}if($[0]===0&&$[1]===1)return!1;f.projection.name==="globe"&&(l=gC([l],[new Kt(0,0),new Kt(hn,hn)],o.tileID.canonical).map((ze=>ze.polygon)).flat());const _e=Q?w:null,[ve,De]=(function(ze,Je,Qe,st,lt,ft,Ut,vt,$t,tn,qt){return ze.projection.name==="globe"?(function(Jt,on,Bt,Qt,Dt,Et,an,rn,Xn,Rn,Un){const mn=[],Wn=[],pr=Jt.projection.upVectorScale(Un,Jt.center.lat,Jt.worldSize).metersToTile,bn=[0,0,0,1],Hn=[0,0,0,1],cr=(kr,Cr,Ln,Sr)=>{kr[0]=Cr,kr[1]=Ln,kr[2]=Sr,kr[3]=1},xr=mC();Bt>0&&(Bt+=xr),Qt+=xr;for(const kr of on){const Cr=[],Ln=[];for(const Sr of kr){const Kr=Sr.x+Dt.x,Ne=Sr.y+Dt.y,Ve=Jt.projection.projectTilePoint(Kr,Ne,Un),Mt=Jt.projection.upVector(Un,Sr.x,Sr.y);let Vt=Bt,xn=Qt;if(an){const vn=TC(Kr,Ne,Bt,Qt,an,rn,Xn,Rn);Vt+=vn.base,xn+=vn.top}Bt!==0?cr(bn,Ve.x+Mt[0]*pr*Vt,Ve.y+Mt[1]*pr*Vt,Ve.z+Mt[2]*pr*Vt):cr(bn,Ve.x,Ve.y,Ve.z),cr(Hn,Ve.x+Mt[0]*pr*xn,Ve.y+Mt[1]*pr*xn,Ve.z+Mt[2]*pr*xn),xt(bn,bn,Et),xt(Hn,Hn,Et),Cr.push(new Tm(bn[0],bn[1],bn[2])),Ln.push(new Tm(Hn[0],Hn[1],Hn[2]))}mn.push(Cr),Wn.push(Ln)}return[mn,Wn]})(ze,Je,Qe,st,lt,ft,Ut,vt,$t,tn,qt):Ut?(function(Jt,on,Bt,Qt,Dt,Et,an,rn,Xn){const Rn=[],Un=[],mn=[0,0,0,1];for(const Wn of Jt){const pr=[],bn=[];for(const Hn of Wn){const cr=Hn.x+Qt.x,xr=Hn.y+Qt.y,kr=TC(cr,xr,on,Bt,Et,an,rn,Xn);mn[0]=cr,mn[1]=xr,mn[2]=kr.base,mn[3]=1,Ft(mn,mn,Dt),mn[3]=Math.max(mn[3],1e-5);const Cr=new Tm(mn[0]/mn[3],mn[1]/mn[3],mn[2]/mn[3]);mn[0]=cr,mn[1]=xr,mn[2]=kr.top,mn[3]=1,Ft(mn,mn,Dt),mn[3]=Math.max(mn[3],1e-5);const Ln=new Tm(mn[0]/mn[3],mn[1]/mn[3],mn[2]/mn[3]);pr.push(Cr),bn.push(Ln)}Rn.push(pr),Un.push(bn)}return[Rn,Un]})(Je,Qe,st,lt,ft,Ut,vt,$t,tn):(function(Jt,on,Bt,Qt,Dt){const Et=[],an=[],rn=Dt[8]*on,Xn=Dt[9]*on,Rn=Dt[10]*on,Un=Dt[11]*on,mn=Dt[8]*Bt,Wn=Dt[9]*Bt,pr=Dt[10]*Bt,bn=Dt[11]*Bt;for(const Hn of Jt){const cr=[],xr=[];for(const kr of Hn){const Cr=kr.x+Qt.x,Ln=kr.y+Qt.y,Sr=Dt[0]*Cr+Dt[4]*Ln+Dt[12],Kr=Dt[1]*Cr+Dt[5]*Ln+Dt[13],Ne=Dt[2]*Cr+Dt[6]*Ln+Dt[14],Ve=Dt[3]*Cr+Dt[7]*Ln+Dt[15],Mt=Sr+rn,Vt=Kr+Xn,xn=Ne+Rn,vn=Math.max(Ve+Un,1e-5),Dn=Sr+mn,Jn=Kr+Wn,Or=Ne+pr,Lr=Math.max(Ve+bn,1e-5);cr.push(new Tm(Mt/vn,Vt/vn,xn/vn)),xr.push(new Tm(Dn/Lr,Jn/Lr,Or/Lr))}Et.push(cr),an.push(xr)}return[Et,an]})(Je,Qe,st,lt,ft)})(f,l,U,B,M,m,_e,$,ee,f.center.lat,o.tileID.canonical),ke=o.queryGeometry;return(function(ze,Je,Qe){let st=1/0;as(Qe,Je)&&(st=SC(Qe,Je[0]));for(let lt=0;lt<Je.length;lt++){const ft=Je[lt],Ut=ze[lt];for(let vt=0;vt<ft.length-1;vt++){const $t=ft[vt],tn=[$t,ft[vt+1],Ut[vt+1],Ut[vt],$t];Xi(Qe,tn)&&(st=Math.min(st,SC(Qe,tn)))}}return st!==1/0&&st})(ve,De,ke.isPointQuery()?ke.screenBounds:ke.screenGeometry)}},building:class extends Ds{constructor(o,e,i,l){super(o,{layout:YC||(YC=new oo({visibility:new ln(yt.layout_building.visibility),"building-facade":new wn(yt.layout_building["building-facade"]),"building-facade-floors":new wn(yt.layout_building["building-facade-floors"]),"building-facade-unit-width":new wn(yt.layout_building["building-facade-unit-width"]),"building-facade-window":new wn(yt.layout_building["building-facade-window"]),"building-roof-shape":new wn(yt.layout_building["building-roof-shape"]),"building-height":new wn(yt.layout_building["building-height"]),"building-base":new wn(yt.layout_building["building-base"]),"building-flood-light-wall-radius":new wn(yt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new wn(yt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new wn(yt.layout_building["building-flip-roof-orientation"])})),paint:XC||(XC=new oo({"building-opacity":new ln(yt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ln(yt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ln(yt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ln(yt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ln(yt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ln(yt.paint_building["building-vertical-scale"]),"building-cast-shadows":new ln(yt.paint_building["building-cast-shadows"]),"building-color":new wn(yt.paint_building["building-color"]),"building-emissive-strength":new wn(yt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ln(yt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ln(yt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ln(yt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ln(yt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ln(yt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new ZC(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}},line:class extends Ds{constructor(o,e,i,l){const u=sE();super(o,u,e,i,l),u.layout&&(this.layout=new qu(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof zd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Y_)return Y_;const i=sE();return Y_=new Dk(i.paint.properties["line-width"].specification),Y_.useIntegerZoom=!0,Y_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Wb(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,i){const l=iE(this);return{config:new Al(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,i=aE(ra("line-width",this,e),ra("line-gap-width",this,e)),l=ra("line-offset",this,e);return i/2+Math.abs(l)+Ql(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,i,l,u,f){if(o.queryGeometry.isAboveHorizon)return!1;const m=ec(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),w=o.pixelToTileUnitsFactor/2*aE(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),C=this.paint.get("line-offset").evaluate(e,i);return C&&(l=(function(M,B){const U=[],$=new Kt(0,0);for(let Q=0;Q<M.length;Q++){const ee=M[Q],he=[];for(let _e=0;_e<ee.length;_e++){const ve=ee[_e],De=ee[_e+1],ke=_e===0?$:ve.sub(ee[_e-1])._unit()._perp(),ze=_e===ee.length-1?$:De.sub(ve)._unit()._perp(),Je=ke._add(ze)._unit();Je._mult(1/(Je.x*ze.x+Je.y*ze.y)),he.push(Je._mult(B)._add(ve))}U.push(he)}return U})(l,C*o.pixelToTileUnitsFactor)),(function(M,B,U){for(let $=0;$<B.length;$++){const Q=B[$];if(M.length>=3){for(let ee=0;ee<Q.length;ee++)if(No(M,Q[ee]))return!0}if(na(M,Q,U))return!0}return!1})(m,l,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:qv,background:class extends Ds{constructor(o,e,i,l){super(o,{layout:JE||(JE=new oo({visibility:new ln(yt.layout_background.visibility)})),paint:QE||(QE=new oo({"background-pitch-alignment":new ln(yt.paint_background["background-pitch-alignment"]),"background-color":new ln(yt.paint_background["background-color"]),"background-pattern":new ln(yt.paint_background["background-pattern"]),"background-opacity":new ln(yt.paint_background["background-opacity"]),"background-emissive-strength":new ln(yt.paint_background["background-emissive-strength"]),"background-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:i3,"raster-particle":u3,sky:class extends Ds{constructor(o,e,i,l){super(o,{layout:a3||(a3=new oo({visibility:new ln(yt.layout_sky.visibility)})),paint:l3||(l3=new oo({"sky-type":new ln(yt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ln(yt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ln(yt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ln(yt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ln(yt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Wu(yt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ln(yt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ln(yt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ln(yt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,f=o.style.light,m=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?h2(m.azimuthal,90-m.polar,e):h2(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return h2(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Ds{constructor(o,e,i,l){super(o,{paint:c3||(c3=new oo({}))},e,null)}},model:class extends Ds{constructor(o,e,i,l){super(o,{layout:p3||(p3=new oo({visibility:new ln(yt.layout_model.visibility),"model-id":new wn(yt.layout_model["model-id"])})),paint:m3||(m3=new oo({"model-opacity":new wn(yt.paint_model["model-opacity"]),"model-rotation":new wn(yt.paint_model["model-rotation"]),"model-scale":new wn(yt.paint_model["model-scale"]),"model-translation":new wn(yt.paint_model["model-translation"]),"model-color":new wn(yt.paint_model["model-color"]),"model-color-mix-intensity":new wn(yt.paint_model["model-color-mix-intensity"]),"model-type":new ln(yt.paint_model["model-type"]),"model-cast-shadows":new ln(yt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ln(yt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ln(yt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wn(yt.paint_model["model-emissive-strength"]),"model-roughness":new wn(yt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wn(yt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ln(yt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ln(yt.paint_model["model-front-cutoff"]),"model-elevation-reference":new ln(yt.paint_model["model-elevation-reference"]),"model-color-use-theme":new wn({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new p2(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Xv?hn-1:0}queryIntersectsFeature(o,e,i,l,u,f){if(!this.modelManager)return!1;const m=this.modelManager,w=o.tile.getBucket(this);if(!(w&&w instanceof p2))return!1;for(const C in w.instancesPerModel){const M=w.instancesPerModel[C],B=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(B)){const U=M.features[M.idToFeaturesIndex[B]],$=m.getModel(C,this.scope);if(!$)return!1;let Q=D();const ee=new ce(0,0),he=w.canonical;let _e=Number.MAX_VALUE;for(let ve=0;ve<U.instancedDataCount;++ve){const De=16*(U.instancedDataOffset+ve),ke=M.instancedDataArray.float32,ze=[ke[De+4],ke[De+5],ke[De+6]];x3(he,ee,ke[De],0|ke[De+1]),VC(Q,$,f,ee,U.rotation,U.scale,ze,!1,!1,!1),f.projection.name==="globe"&&(Q=Ub(Q,f));const Je=H([],f.projMatrix,Q),Qe=o.queryGeometry,st=NC(Qe.isPointQuery()?Qe.screenBounds:Qe.screenGeometry,f,Je,$.aabb);st!=null&&(_e=Math.min(st,_e))}return _e!==Number.MAX_VALUE&&_e}}return!1}_handleOverridablePaintPropertyUpdate(o,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Js}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ds{constructor(o,e,i,l){super(o,{layout:YT||(YT=new oo({"clip-layer-types":new ln(yt.layout_clip["clip-layer-types"]),"clip-layer-scope":new ln(yt.layout_clip["clip-layer-scope"])})),paint:XT||(XT=new oo({}))},e,i,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new KT(o)}is3D(o){return!0}}},g2=new mi(0,0,0),_2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},y2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Kv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},LO={PAINT_ORDER_FILL_AND_STROKE:1},l0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},b3={MASK_TYPE_LUMINANCE:1};function zO(o,e,i){o===1&&e.icons.push((function(l,u){return(function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:m}=f;if(m.content_area){const{content_area:w}=m;w.left==null&&(w.left=0),w.top==null&&(w.top=w.left),w.width==null&&(w.width=f.usvg_tree.width),w.height==null&&(w.height=w.width)}if(m.text_placeholder){const{text_placeholder:w}=m;w.top==null&&(w.top=w.left),w.height==null&&(w.height=w.width)}return m.stretch_x&&m.stretch_x.length&&w3(m,"x"),m.stretch_y&&m.stretch_y.length&&w3(m,"y"),f})(l.readFields(FO,{name:void 0},u))})(i,i.readVarint()+i.pos))}function w3(o,e){const i=[],l=o[`stretch_${e}`];let u=null;for(let f=0;f<l.length;f++)u===null?u=i.length===0?l[0]:i[i.length-1][1]+l[f]:(i.push([u,u+l[f]]),u=null);o[`stretch_${e}_areas`]=i}function FO(o,e,i){o===1?e.name=i.readString():o===2?e.metadata=(function(l,u){return l.readFields(BO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(i,i.readVarint()+i.pos):o===3&&(e.usvg_tree=(function(l,u){return l.readFields(UO,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function BO(o,e,i){o===1?e.stretch_x=i.readPackedVarint():o===2?e.stretch_y=i.readPackedVarint():o===3?e.content_area=S3(i,i.readVarint()+i.pos):o===4?e.variables.push((function(l,u){return l.readFields(VO,{name:void 0},u)})(i,i.readVarint()+i.pos)):o===5&&(e.text_placeholder=S3(i,i.readVarint()+i.pos))}function S3(o,e){return o.readFields(NO,{},e)}function NO(o,e,i){o===1?e.left=i.readVarint():o===2?e.width=i.readVarint():o===3?e.top=i.readVarint():o===4&&(e.height=i.readVarint())}function VO(o,e,i){o===1?e.name=i.readString():o===2&&(e.rgb_color=e1(i.readVarint()),e.value="rgb_color")}function UO(o,e,i){o===1?e.width=e.height=i.readVarint():o===2?e.height=i.readVarint():o===3?e.children.push(Jv(i,i.readVarint()+i.pos)):o===4?e.linear_gradients.push((function(l,u){return l.readFields(ZO,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(i,i.readVarint()+i.pos)):o===5?e.radial_gradients.push((function(l,u){return l.readFields(XO,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(i,i.readVarint()+i.pos)):o===7?e.clip_paths.push((function(l,u){return l.readFields(KO,{children:[]},u)})(i,i.readVarint()+i.pos)):o===8&&e.masks.push((function(l,u){const f=l.readFields(JO,{left:0,width:20,mask_type:b3.MASK_TYPE_LUMINANCE,children:[]},u);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f})(i,i.readVarint()+i.pos))}function Jv(o,e){return o.readFields(jO,{},e)}function jO(o,e,i){o===1?(e.group=(function(l,u){return l.readFields(GO,{opacity:255,children:[]},u)})(i,i.readVarint()+i.pos),e.node="group"):o===2&&(e.path=(function(l,u){return l.readFields(HO,{paint_order:1,commands:[],step:1,diffs:[],rule:_2.PATH_RULE_NON_ZERO},u)})(i,i.readVarint()+i.pos),e.node="path")}function GO(o,e,i){o===1?e.transform=Qv(i,i.readVarint()+i.pos):o===2?e.opacity=i.readVarint():o===5?e.clip_path_idx=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Jv(i,i.readVarint()+i.pos))}function Qv(o,e){return o.readFields($O,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function $O(o,e,i){o===1?e.sx=i.readFloat():o===2?e.ky=i.readFloat():o===3?e.kx=i.readFloat():o===4?e.sy=i.readFloat():o===5?e.tx=i.readFloat():o===6&&(e.ty=i.readFloat())}function HO(o,e,i){o===1?e.fill=(function(l,u){return l.readFields(qO,{rgb_color:g2,paint:"rgb_color",opacity:255},u)})(i,i.readVarint()+i.pos):o===2?e.stroke=(function(l,u){return l.readFields(WO,{rgb_color:g2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(i,i.readVarint()+i.pos):o===3?e.paint_order=i.readVarint():o===5?i.readPackedVarint(e.commands):o===6?e.step=i.readFloat():o===7?i.readPackedSVarint(e.diffs):o===8&&(e.rule=i.readVarint())}function qO(o,e,i){o===1?(e.rgb_color=e1(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=i.readVarint())}function e1(o){return new mi((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function WO(o,e,i){o===1?(e.rgb_color=e1(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5?i.readPackedFloat(e.dasharray):o===6?e.dashoffset=i.readFloat():o===7?e.miterlimit=i.readFloat():o===8?e.opacity=i.readVarint():o===9?e.width=i.readFloat():o===10?e.linecap=i.readVarint():o===11&&(e.linejoin=i.readVarint())}function ZO(o,e,i){o===1?e.transform=Qv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(T3(i,i.readVarint()+i.pos)):o===4?e.x1=i.readFloat():o===5?e.y1=i.readFloat():o===6?e.x2=i.readFloat():o===7&&(e.y2=i.readFloat())}function T3(o,e){return o.readFields(YO,{offset:0,opacity:255,rgb_color:g2},e)}function YO(o,e,i){o===1?e.offset=i.readFloat():o===2?e.opacity=i.readVarint():o===3&&(e.rgb_color=e1(i.readVarint()))}function XO(o,e,i){o===1?e.transform=Qv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(T3(i,i.readVarint()+i.pos)):o===4?e.cx=i.readFloat():o===5?e.cy=i.readFloat():o===6?e.r=i.readFloat():o===7?e.fx=i.readFloat():o===8?e.fy=i.readFloat():o===9&&(e.fr=i.readFloat())}function KO(o,e,i){o===1?e.transform=Qv(i,i.readVarint()+i.pos):o===2?e.clip_path_idx=i.readVarint():o===3&&e.children.push(Jv(i,i.readVarint()+i.pos))}function JO(o,e,i){o===1?e.left=e.top=i.readFloat():o===2?e.width=e.height=i.readFloat():o===3?e.top=i.readFloat():o===4?e.height=i.readFloat():o===5?e.mask_type=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Jv(i,i.readVarint()+i.pos))}class QO{static calculate(e={},i=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;i.forEach((f=>{u.set(f.name,f.rgb_color||new mi(0,0,0))}));for(const[f,m]of Object.entries(e))u.has(f)?l.set(u.get(f).toString(),m):console.warn(`Ignoring unknown image variable "${f}"`);return l}}function Og(o,e=255,i){const l=e/255,u=o.toString(),f=i.has(u)?i.get(u).clone():o.clone();return f.a*=l,f.toString()}function c0(o,e){if(!xf()){const i=document.createElement("canvas");return i.width=o,i.height=e,i}return new OffscreenCanvas(o,e)}function eL(o,e){const i=QO.calculate(e.params,o.metadata?o.metadata.variables:[]),l=o.usvg_tree,u=l.width,f=l.height,m=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(u*m.a)),C=Math.max(1,Math.round(f*m.d)),M=new DOMMatrix([w/u,0,0,C/f,0,0]),B=c0(w,C).getContext("2d");return v2(B,M,l,l,i),B.getImageData(0,0,w,C)}function v2(o,e,i,l,u){for(const f of l.children)C3(o,e,i,f,u)}function C3(o,e,i,l,u){l.group?(o.save(),(function(f,m,w,C,M){const B=C.mask_idx!=null?w.masks[C.mask_idx]:null,U=C.clip_path_idx!=null?w.clip_paths[C.clip_path_idx]:null;if(C.transform&&(m=Lg(C.transform).preMultiplySelf(m)),!(function(ee,he,_e){return ee.opacity!==255||he||_e})(C,U!=null,B!=null))return void v2(f,m,w,C,M);const $=c0(f.canvas.width,f.canvas.height),Q=$.getContext("2d");v2(Q,m,w,C,M),U&&D3(Q,m,w,U),B&&k3(Q,m,w,B,M),f.globalAlpha=C.opacity/255,f.drawImage($,0,0)})(o,e,i,l.group,u),o.restore()):l.path&&(o.save(),(function(f,m,w,C,M){f.setTransform(m),C.paint_order===LO.PAINT_ORDER_FILL_AND_STROKE?(E3(f,w,C,M),P3(f,w,C,M)):(P3(f,w,C,M),E3(f,w,C,M))})(o,e,i,l.path,u),o.restore())}function E3(o,e,i,l){const u=i.fill;if(!u)return;const f=u.opacity/255;switch(o.save(),o.beginPath(),O3(i,o),u.paint){case"rgb_color":o.fillStyle=Og(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const m=e.linear_gradients[u.linear_gradient_idx];m.transform&&o.setTransform(Lg(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=M3(o,m,f,l);break}case"radial_gradient_idx":{const m=e.radial_gradients[u.radial_gradient_idx];m.transform&&o.setTransform(Lg(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=I3(o,m,f,l)}}o.fill(A3(i)),o.restore()}function A3(o){return o.rule===_2.PATH_RULE_NON_ZERO?"nonzero":o.rule===_2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function P3(o,e,i,l){const u=i.stroke;if(!u)return;const f=L3(i);o.lineWidth=u.width,o.miterLimit=u.miterlimit,o.setLineDash(u.dasharray),o.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":o.strokeStyle=Og(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":o.strokeStyle=M3(o,e.linear_gradients[u.linear_gradient_idx],m,l,!0);break;case"radial_gradient_idx":o.strokeStyle=I3(o,e.radial_gradients[u.radial_gradient_idx],m,l,!0)}switch(u.linejoin){case Kv.LINE_JOIN_MITER_CLIP:case Kv.LINE_JOIN_MITER:o.lineJoin="miter";break;case Kv.LINE_JOIN_ROUND:o.lineJoin="round";break;case Kv.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(u.linecap){case y2.LINE_CAP_BUTT:o.lineCap="butt";break;case y2.LINE_CAP_ROUND:o.lineCap="round";break;case y2.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(f)}function M3(o,e,i,l,u=!1){if(e.stops.length===1){const $=e.stops[0];return Og($.rgb_color,$.opacity*i,l)}const{x1:f,y1:m,x2:w,y2:C}=e;let M=new DOMPoint(f,m),B=new DOMPoint(w,C);if(u){const $=Lg(e.transform);M=$.transformPoint(M),B=$.transformPoint(B)}const U=o.createLinearGradient(M.x,M.y,B.x,B.y);for(const $ of e.stops)U.addColorStop($.offset,Og($.rgb_color,$.opacity*i,l));return U}function I3(o,e,i,l,u=!1){if(e.stops.length===1){const ve=e.stops[0];return Og(ve.rgb_color,ve.opacity*i,l)}const f=Lg(e.transform),{fx:m,fy:w,fr:C,cx:M,cy:B,r:U}=e;let $=new DOMPoint(m,w),Q=new DOMPoint(M,B),ee=C,he=U;if(u){$=f.transformPoint($),Q=f.transformPoint(Q);const ve=(f.a+f.d)/2;ee=C*ve,he=e.r*ve}const _e=o.createRadialGradient($.x,$.y,ee,Q.x,Q.y,he);for(const ve of e.stops)_e.addColorStop(ve.offset,Og(ve.rgb_color,ve.opacity*i,l));return _e}function R3(o,e,i,l){const u=l.transform?Lg(l.transform).preMultiplySelf(e):e,f=c0(o.canvas.width,o.canvas.height),m=f.getContext("2d");for(const C of l.children)if(C.group)R3(m,u,i,C.group);else if(C.path){const M=C.path,B=new Path2D;B.addPath(L3(M),u),m.fill(B,A3(M))}const w=l.clip_path_idx!=null?i.clip_paths[l.clip_path_idx]:null;w&&D3(m,u,i,w),o.globalCompositeOperation="source-over",o.drawImage(f,0,0)}function D3(o,e,i,l){const u=c0(o.canvas.width,o.canvas.height);R3(u.getContext("2d"),e,i,l),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function k3(o,e,i,l,u){if(l.children.length===0)return;const f=l.mask_idx!=null?i.masks[l.mask_idx]:null;f&&k3(o,e,i,f,u);const m=o.canvas.width,w=o.canvas.height,C=c0(m,w),M=C.getContext("2d"),B=l.width,U=l.height,$=l.left,Q=l.top,ee=new Path2D,he=new Path2D;he.rect($,Q,B,U),ee.addPath(he,e),M.clip(ee);for(const De of l.children)C3(M,e,i,De,u);const _e=M.getImageData(0,0,m,w),ve=_e.data;if(l.mask_type===b3.MASK_TYPE_LUMINANCE)for(let De=0;De<ve.length;De+=4)ve[De+3]=ve[De+3]/255*(.2126*ve[De]+.7152*ve[De+1]+.0722*ve[De+2]);M.putImageData(_e,0,0),o.globalCompositeOperation="destination-in",o.drawImage(C,0,0)}function Lg(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function O3(o,e){const i=o.step;let l=o.diffs[0]*i,u=o.diffs[1]*i;e.moveTo(l,u);for(let f=0,m=2;f<o.commands.length;f++)switch(o.commands[f]){case l0.PATH_COMMAND_MOVE:l+=o.diffs[m++]*i,u+=o.diffs[m++]*i,e.moveTo(l,u);break;case l0.PATH_COMMAND_LINE:l+=o.diffs[m++]*i,u+=o.diffs[m++]*i,e.lineTo(l,u);break;case l0.PATH_COMMAND_QUAD:{const w=l+o.diffs[m++]*i,C=u+o.diffs[m++]*i;l=w+o.diffs[m++]*i,u=C+o.diffs[m++]*i,e.quadraticCurveTo(w,C,l,u);break}case l0.PATH_COMMAND_CUBIC:{const w=l+o.diffs[m++]*i,C=u+o.diffs[m++]*i,M=w+o.diffs[m++]*i,B=C+o.diffs[m++]*i;l=M+o.diffs[m++]*i,u=B+o.diffs[m++]*i,e.bezierCurveTo(w,C,M,B,l,u);break}case l0.PATH_COMMAND_CLOSE:e.closePath()}return e}function L3(o){return O3(o,new Path2D)}class t1{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}In(t1,"LRUCache");class x2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ia(e,e.data)}getFromCache(e,i,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new t1(150)),this.cacheMap.get(l).get(Wd(e.toString(),i))}setInCache(e,i,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new t1(150));const f=this.cacheDependenciesMap.get(u),m=Wd(e.id.toString(),l);f.get(m)||f.set(m,new Set);const w=this.cacheMap.get(u),C=e.toString();f.get(m).add(C),w.put(Wd(e.toString(),l),i)}removeImagesFromCacheByIds(e,i,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),f=this.cacheDependenciesMap.get(l);for(const m of e){const w=Wd(m.toString(),i);if(f.has(w)){for(const C of f.get(w))u.delete(C);f.delete(w)}}}rasterize(e,i,l,u,f=eL){const m=this.getFromCache(e,l,u);if(m)return m.clone();const w=f(i.icon,e.options),C=x2._getImage(w);return this.setInCache(e,C,l,u),C.clone()}}class z3{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function F3(o,e,i,l){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(i[m]<o[m]||i[m]>e[m])return null}else{const w=1/l[m];let C=(o[m]-i[m])*w,M=(e[m]-i[m])*w;if(C>M){const B=C;C=M,M=B}if(C>u&&(u=C),M<f&&(f=M),u>f)return null}return u}function B3(o,e,i,l,u,f,m,w,C,M,B){const U=l-o,$=u-e,Q=f-i,ee=m-o,he=w-e,_e=C-i,ve=B[1]*_e-B[2]*he,De=B[2]*ee-B[0]*_e,ke=B[0]*he-B[1]*ee,ze=U*ve+$*De+Q*ke;if(Math.abs(ze)<1e-15)return null;const Je=1/ze,Qe=M[0]-o,st=M[1]-e,lt=M[2]-i,ft=(Qe*ve+st*De+lt*ke)*Je;if(ft<0||ft>1)return null;const Ut=st*Q-lt*$,vt=lt*U-Qe*Q,$t=Qe*$-st*U,tn=(B[0]*Ut+B[1]*vt+B[2]*$t)*Je;return tn<0||ft+tn>1?null:(ee*Ut+he*vt+_e*$t)*Je}function N3(o,e,i){return(o-e)/(i-e)}function V3(o,e,i,l,u,f,m,w,C){const M=1<<i,B=f-l,U=m-u,$=(o+1)/M*B+l,Q=(e+0)/M*U+u,ee=(e+1)/M*U+u;w[0]=(o+0)/M*B+l,w[1]=Q,C[0]=$,C[1]=ee}class U3{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(f){const m=Math.ceil(Math.log2(f.dim/8)),w=[];let C=Math.ceil(Math.pow(2,m));const M=1/C,B=(Q,ee,he,_e,ve)=>{const De=_e?1:0,ke=(Q+1)*he-De,ze=ee*he,Je=(ee+1)*he-De;ve[0]=Q*he,ve[1]=ze,ve[2]=ke,ve[3]=Je};let U=new z3(C);const $=[];for(let Q=0;Q<C*C;Q++){B(Q%C,Math.floor(Q/C),M,!1,$);const ee=Mp($[0],$[1],f),he=Mp($[2],$[1],f),_e=Mp($[2],$[3],f),ve=Mp($[0],$[3],f);U.minimums.push(Math.min(ee,he,_e,ve)),U.maximums.push(Math.max(ee,he,_e,ve)),U.leaves.push(1)}for(w.push(U),C/=2;C>=1;C/=2){const Q=w[w.length-1];U=new z3(C);for(let ee=0;ee<C*C;ee++){B(ee%C,Math.floor(ee/C),2,!0,$);const he=Q.getElevation($[0],$[1]),_e=Q.getElevation($[2],$[1]),ve=Q.getElevation($[2],$[3]),De=Q.getElevation($[0],$[3]),ke=Q.isLeaf($[0],$[1]),ze=Q.isLeaf($[2],$[1]),Je=Q.isLeaf($[2],$[3]),Qe=Q.isLeaf($[0],$[3]),st=Math.min(he.min,_e.min,ve.min,De.min),lt=Math.max(he.max,_e.max,ve.max,De.max),ft=ke&&ze&&Je&&Qe;U.maximums.push(lt),U.minimums.push(st),U.leaves.push(lt-st<=5&&ft?1:0)}w.push(U)}return w})(this.dem),l=i.length-1,u=i[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,u,f,m,w=1){return F3([e,i,-100],[l,u,this.maximums[0]*w],f,m)}raycast(e,i,l,u,f,m,w=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,i,l,u,f,m,w);if(C==null)return null;const M=[],B=[],U=[],$=[],Q=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;Q.length>0;){const{idx:ee,t:he,nodex:_e,nodey:ve,depth:De}=Q.pop();if(this.leaves[ee]){V3(_e,ve,De,e,i,l,u,U,$);const ze=1<<De,Je=(_e+0)/ze,Qe=(_e+1)/ze,st=(ve+0)/ze,lt=(ve+1)/ze,ft=Mp(Je,st,this.dem)*w,Ut=Mp(Qe,st,this.dem)*w,vt=Mp(Qe,lt,this.dem)*w,$t=Mp(Je,lt,this.dem)*w,tn=B3(U[0],U[1],ft,$[0],U[1],Ut,$[0],$[1],vt,f,m),qt=B3($[0],$[1],vt,U[0],$[1],$t,U[0],U[1],ft,f,m),Jt=Math.min(tn!==null?tn:Number.MAX_VALUE,qt!==null?qt:Number.MAX_VALUE);if(Jt!==Number.MAX_VALUE)return Jt;{const on=Oe([],f,m,he);if(j3(ft,Ut,$t,vt,N3(on[0],U[0],$[0]),N3(on[1],U[1],$[1]))>=on[2])return he}continue}let ke=0;for(let ze=0;ze<this._siblingOffset.length;ze++){V3((_e<<1)+this._siblingOffset[ze][0],(ve<<1)+this._siblingOffset[ze][1],De+1,e,i,l,u,U,$),U[2]=-100,$[2]=this.maximums[this.childOffsets[ee]+ze]*w;const Je=F3(U,$,f,m);if(Je!=null){const Qe=Je;M[ze]=Qe;let st=!1;for(let lt=0;lt<ke&&!st;lt++)Qe>=M[B[lt]]&&(B.splice(lt,0,ze),st=!0);st||(B[ke]=ze),ke++}}for(let ze=0;ze<ke;ze++){const Je=B[ze];Q.push({idx:this.childOffsets[ee]+Je,t:M[Je],nodex:(_e<<1)+this._siblingOffset[Je][0],nodey:(ve<<1)+this._siblingOffset[Je][1],depth:De+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,u,f){if(e[u].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,w=e[m];let C=0,M=0;for(let B=0;B<this._siblingOffset.length;B++){const U=2*i+this._siblingOffset[B][0],$=2*l+this._siblingOffset[B][1],Q=w.getElevation(U,$),ee=w.isLeaf(U,$),he=this._addNode(Q.min,Q.max,ee);ee&&(C|=1<<B),M||(M=he)}for(let B=0;B<this._siblingOffset.length;B++)C&1<<B||this._construct(e,2*i+this._siblingOffset[B][0],2*l+this._siblingOffset[B][1],m,M+B)}}function j3(o,e,i,l,u,f){return Qn(Qn(o,i,f),Qn(e,l,f),u)}function Mp(o,e,i){const l=i.dim,u=et(o*l-.5,0,l-1),f=et(e*l-.5,0,l-1),m=Math.floor(u),w=Math.floor(f),C=Math.min(m+1,l-1),M=Math.min(w+1,l-1);return j3(i.get(m,w),i.get(C,w),i.get(m,M),i.get(C,M),u-m,f-w)}const tL={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function nL(o,e,i){return(256*o*256+256*e+i)/10-1e4}function rL(o,e,i){return 256*o+e+i/256-32768}class n1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Vr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let C=0;C<f;C++)m[this._idx(-1,C)]=m[this._idx(0,C)],m[this._idx(f,C)]=m[this._idx(f-1,C)],m[this._idx(C,-1)]=m[this._idx(C,0)],m[this._idx(C,f)]=m[this._idx(C,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)]}const w=l==="terrarium"?rL:nL;for(let C=0;C<m.length;++C){const M=4*C;this.floatView[C]=w(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=Ua.now()}_buildQuadTree(){this._tree=new U3(this)}get(e,i,l=!1){l&&(e=et(e,-1,this.dim),i=et(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,l){const u=this._idx(e,i),f=this.floatView[u];return this.floatView[u]=l,l-f}static getUnpackVector(e){return tL[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],u=n1.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new LT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,m=l*this.dim,w=l*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(l){case-1:m=w-1;break;case 1:w=m+1}const C=-i*this.dim,M=-l*this.dim;for(let B=m;B<w;B++)for(let U=u;U<f;U++){const $=4*this._idx(U,B),Q=4*this._idx(U+C,B+M);this.pixels[$+0]=e.pixels[Q+0],this.pixels[$+1]=e.pixels[Q+1],this.pixels[$+2]=e.pixels[Q+2],this.pixels[$+3]=e.pixels[Q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function iL(o,e,i){o===1?e.headerLength=i.readFixed32():o===2?e.x=i.readVarint():o===3?e.y=i.readVarint():o===4?e.z=i.readVarint():o===5&&e.layers.push((function(l,u){return l.readFields(cL,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(i,i.readVarint()+i.pos))}function oL(o,e,i){o===1?(e.delta_filter=(function(l,u){return l.readFields(sL,{blockSize:0},u)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):o===2?(i.readVarint(),e.filter="zigzag_filter"):o===3?(i.readVarint(),e.filter="bitshuffle_filter"):o===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function sL(o,e,i){o===1&&(e.blockSize=i.readVarint())}function aL(o,e,i){o===1?(i.readVarint(),e.codec="gzip_data"):o===2?(i.readVarint(),e.codec="jpeg_image"):o===3?(i.readVarint(),e.codec="webp_image"):o===4&&(i.readVarint(),e.codec="png_image")}function lL(o,e,i){let l=0,u=0;o===1?e.firstByte=i.readFixed64():o===2?e.lastByte=i.readFixed64():o===3?e.filters.push((function(f,m){return f.readFields(oL,{},m)})(i,i.readVarint()+i.pos)):o===4?e.codec=(function(f,m){return f.readFields(aL,{},m)})(i,i.readVarint()+i.pos):o===5?u=i.readFloat():o===6?l=i.readFloat():o===7?e.bands.push(i.readString()):o===8?e.offset=i.readDouble():o===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function cL(o,e,i){o===1?e.version=i.readVarint():o===2?e.name=i.readString():o===3?e.units=i.readString():o===4?e.tileSize=i.readVarint():o===5?e.buffer=i.readVarint():o===6?e.pixelFormat=i.readVarint():o===7&&e.dataIndex.push((function(l,u){return l.readFields(lL,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(i,i.readVarint()+i.pos))}function uL(o,e,i){if(o===2)(function(l,u,f){l.readFields(dL,f,u)})(i,i.readVarint()+i.pos,e);else if(o===3)throw new Error("Not implemented")}function dL(o,e,i){if(o===1){let l=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[l++]=i.readVarint()}}function hL(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,f=l===2?1:0;for(let m=0;m<e[0];m++){const w=e[1]*m;for(let C=u;C<e[1];C++){const M=e[2]*(C+w);for(let B=f;B<e[2];B++){const U=e[3]*(B+M);for(let $=0;$<e[3];$++){const Q=U+$;o[Q]+=o[Q-i]}}}}i*=e[l]}return o}function fL(o){for(let e=0,i=o.length;e<i;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function pL(o,e){switch(e){case"uint32":return o;case"uint16":for(let i=0;i<o.length;i+=2){const l=o[i],u=o[i+1];o[i]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,o[i+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let i=0;i<o.length;i+=4){const l=o[i],u=o[i+1],f=o[i+2],m=o[i+3];o[i+0]=(192&l)>>6|(192&u)>>4|(192&f)>>2|192&m,o[i+1]=(48&l)>>4|(48&u)>>2|48&f|(48&m)<<2,o[i+2]=(12&l)>>2|12&u|(12&f)<<2|(12&m)<<4,o[i+3]=3&l|(3&u)<<2|(3&f)<<4|(3&m)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}In(n1,"DEMData"),In(U3,"DemMinMaxQuadTree",{omit:["dem"]});var Dc=Uint8Array,u0=Uint16Array,mL=Int32Array,G3=new Dc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$3=new Dc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gL=new Dc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H3=function(o,e){for(var i=new u0(31),l=0;l<31;++l)i[l]=e+=1<<o[l-1];var u=new mL(i[30]);for(l=1;l<30;++l)for(var f=i[l];f<i[l+1];++f)u[f]=f-i[l]<<5|l;return{b:i,r:u}},q3=H3(G3,2),W3=q3.b,_L=q3.r;W3[28]=258,_L[258]=28;for(var yL=H3($3,0).b,Z3=new u0(32768),ns=0;ns<32768;++ns){var zg=(43690&ns)>>1|(21845&ns)<<1;Z3[ns]=((65280&(zg=(61680&(zg=(52428&zg)>>2|(13107&zg)<<2))>>4|(3855&zg)<<4))>>8|(255&zg)<<8)>>1}var d0=function(o,e,i){for(var l=o.length,u=0,f=new u0(e);u<l;++u)o[u]&&++f[o[u]-1];var m,w=new u0(e);for(u=1;u<e;++u)w[u]=w[u-1]+f[u-1]<<1;m=new u0(1<<e);var C=15-e;for(u=0;u<l;++u)if(o[u])for(var M=u<<4|o[u],B=e-o[u],U=w[o[u]-1]++<<B,$=U|(1<<B)-1;U<=$;++U)m[Z3[U]>>C]=M;return m},h0=new Dc(288);for(ns=0;ns<144;++ns)h0[ns]=8;for(ns=144;ns<256;++ns)h0[ns]=9;for(ns=256;ns<280;++ns)h0[ns]=7;for(ns=280;ns<288;++ns)h0[ns]=8;var Y3=new Dc(32);for(ns=0;ns<32;++ns)Y3[ns]=5;var vL=d0(h0,9),xL=d0(Y3,5),b2=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},id=function(o,e,i){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&i},w2=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(7&e)},bL=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],od=function(o,e,i){var l=new Error(e||bL[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,od),!i)throw l;return l},wL=new Dc(0),SL=typeof TextDecoder<"u"&&new TextDecoder;try{SL.decode(wL,{stream:!0})}catch{}const TL={gzip_data:"gzip"};class fu extends Error{constructor(e){super(e),this.name="MRTError"}}const CL={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},X3={uint32:1,uint16:2,uint8:4},EL={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let S2;class r1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new fu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),l=new DataView(e);if(i[0]!==13)throw new fu("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),l=this.getHeaderLength(e);if(i.length<l)throw new fu(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const u=new S2(i.subarray(0,l)).readFields(iL,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new fu(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new K3(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const f=l.dataIndex[u],m=f.firstByte-e.firstByte,w=f.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const C={layerName:l.name,firstByte:m,lastByte:w,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[f.bands.length].concat(l.bandShape),buffer:l.buffer,codec:f.codec.codec,filters:f.filters.map((M=>M.filter))};l._blocksInProgress.add(u),i.push(C)}return new J3(i,(()=>{i.forEach((u=>l._blocksInProgress.delete(u.blockIndex)))}),((u,f)=>{if(i.forEach((m=>l._blocksInProgress.delete(m.blockIndex))),u)throw u;f.forEach((m=>{this.getLayer(m.layerName).processDecodedData(m)}))}))}}class K3{constructor({version:e,name:i,units:l,tileSize:u,pixelFormat:f,buffer:m,dataIndex:w},C){if(this.version=e,this.version!==1)throw new fu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=l,this.tileSize=u,this.buffer=m,this.pixelFormat=CL[f],this.dataIndex=w,this.bandShape=[u+2*m,u+2*m,X3[this.pixelFormat]],this._decodedBlocks=new t1(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return X3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[f,m]of u.bands.entries())if(m===e)return{bandIndex:i+f,blockIndex:l,blockBandIndex:f};i+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new fu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,l=-1/0;const u=[],f=new Set;for(const m of e){const{blockIndex:w}=this.getBlockForBand(m);if(w<0)throw new fu(`Invalid band: ${JSON.stringify(m)}`);const C=this.dataIndex[w];u.includes(w)||u.push(w),f.add(w),i=Math.min(i,C.firstByte),l=Math.max(l,C.lastByte)}if(f.size>this.cacheSize)throw new fu(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(e);if(i<0)throw new fu(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new fu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],m=this.bandShape.reduce(((M,B)=>M*B),1),w=l*m,C=u.subarray(w,w+m);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}r1.setPbf=function(o){S2=o};class J3{constructor(e,i,l){this.tasks=e,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}r1.performDecoding=function(o,e){const i=new Uint8Array(o);return Promise.all(e.tasks.map((l=>{const{layerName:u,firstByte:f,lastByte:m,pixelFormat:w,blockShape:C,blockIndex:M,filters:B,codec:U}=l,$=i.subarray(f,m+1),Q=new Uint32Array(C[0]*C[1]*C[2]);let ee;if(U!=="gzip_data")throw new fu(`Unhandled codec: ${U}`);return ee=(function(he,_e){if(!globalThis.DecompressionStream&&_e==="gzip_data")return Promise.resolve(((ze=(function(st){st[0]==31&&st[1]==139&&st[2]==8||od(6,"invalid gzip data");var lt=st[3],ft=10;4&lt&&(ft+=2+(st[10]|st[11]<<8));for(var Ut=(lt>>3&1)+(lt>>4&1);Ut>0;Ut-=!st[ft++]);return ft+(2&lt)})(ke=he))+8>ke.length&&od(6,"invalid gzip data"),(function(st,lt,ft,Ut){var vt=st.length;if(!vt||lt.f&&!lt.l)return ft||new Dc(0);var $t=!ft,tn=$t||lt.i!=2,qt=lt.i;$t&&(ft=new Dc(3*vt));var Jt,on,Bt=function(Hi){var qi=ft.length;if(Hi>qi){var zi=new Dc(Math.max(2*qi,Hi));zi.set(ft),ft=zi}},Qt=lt.f||0,Dt=lt.p||0,Et=lt.b||0,an=lt.l,rn=lt.d,Xn=lt.m,Rn=lt.n,Un=8*vt;do{if(!an){Qt=id(st,Dt,1);var mn=id(st,Dt+1,3);if(Dt+=3,!mn){var Wn=st[(Ne=4+((Dt+7)/8|0))-4]|st[Ne-3]<<8,pr=Ne+Wn;if(pr>vt){qt&&od(0);break}tn&&Bt(Et+Wn),ft.set(st.subarray(Ne,pr),Et),lt.b=Et+=Wn,lt.p=Dt=8*pr,lt.f=Qt;continue}if(mn==1)an=vL,rn=xL,Xn=9,Rn=5;else if(mn==2){var bn=id(st,Dt,31)+257,Hn=id(st,Dt+10,15)+4,cr=bn+id(st,Dt+5,31)+1;Dt+=14;for(var xr=new Dc(cr),kr=new Dc(19),Cr=0;Cr<Hn;++Cr)kr[gL[Cr]]=id(st,Dt+3*Cr,7);Dt+=3*Hn;var Ln=b2(kr),Sr=(1<<Ln)-1,Kr=d0(kr,Ln);for(Cr=0;Cr<cr;){var Ne,Ve=Kr[id(st,Dt,Sr)];if(Dt+=15&Ve,(Ne=Ve>>4)<16)xr[Cr++]=Ne;else{var Mt=0,Vt=0;for(Ne==16?(Vt=3+id(st,Dt,3),Dt+=2,Mt=xr[Cr-1]):Ne==17?(Vt=3+id(st,Dt,7),Dt+=3):Ne==18&&(Vt=11+id(st,Dt,127),Dt+=7);Vt--;)xr[Cr++]=Mt}}var xn=xr.subarray(0,bn),vn=xr.subarray(bn);Xn=b2(xn),Rn=b2(vn),an=d0(xn,Xn),rn=d0(vn,Rn)}else od(1);if(Dt>Un){qt&&od(0);break}}tn&&Bt(Et+131072);for(var Dn=(1<<Xn)-1,Jn=(1<<Rn)-1,Or=Dt;;Or=Dt){var Lr=(Mt=an[w2(st,Dt)&Dn])>>4;if((Dt+=15&Mt)>Un){qt&&od(0);break}if(Mt||od(2),Lr<256)ft[Et++]=Lr;else{if(Lr==256){Or=Dt,an=null;break}var Rr=Lr-254;Lr>264&&(Rr=id(st,Dt,(1<<(Mr=G3[Cr=Lr-257]))-1)+W3[Cr],Dt+=Mr);var xi=rn[w2(st,Dt)&Jn],to=xi>>4;if(xi||od(3),Dt+=15&xi,vn=yL[to],to>3){var Mr=$3[to];vn+=w2(st,Dt)&(1<<Mr)-1,Dt+=Mr}if(Dt>Un){qt&&od(0);break}tn&&Bt(Et+131072);var Vi=Et+Rr;if(Et<vn){var Si=0-vn,pi=Math.min(vn,Vi);for(Si+Et<0&&od(3);Et<pi;++Et)ft[Et]=(void 0)[Si+Et]}for(;Et<Vi;++Et)ft[Et]=ft[Et-vn]}}lt.l=an,lt.p=Or,lt.b=Et,lt.f=Qt,an&&(Qt=1,lt.m=Xn,lt.d=rn,lt.n=Rn)}while(!Qt);return Et!=ft.length&&$t?(Jt=ft,((on=Et)==null||on>Jt.length)&&(on=Jt.length),new Dc(Jt.subarray(0,on))):ft.subarray(0,Et)})(ke.subarray(ze,-8),{i:2},new Dc(((ve=ke)[(De=ve.length)-4]|ve[De-3]<<8|ve[De-2]<<16|ve[De-1]<<24)>>>0))));var ve,De,ke,ze;const Je=TL[_e];if(!Je)throw new Error(`Unhandled codec: ${_e}`);const Qe=new globalThis.DecompressionStream(Je);return new Response(new Blob([he]).stream().pipeThrough(Qe)).arrayBuffer().then((st=>new Uint8Array(st)))})($,U).then((he=>((function(_e,ve){_e.readFields(uL,ve)})(new S2(he),Q),new EL[w](Q.buffer)))),ee.then((he=>{for(let _e=B.length-1;_e>=0;_e--)switch(B[_e]){case"delta_filter":hL(he,C);break;case"zigzag_filter":fL(he);break;case"bitshuffle_filter":pL(he,w);break;default:throw new fu(`Unhandled filter "${B[_e]}"`)}return{layerName:u,blockIndex:M,data:he}})).catch((he=>{throw he}))})))},In(J3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),In(r1,"MapboxRasterTile"),In(K3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Q3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const AL=["id","tile","layer","source","sourceLayer","state"];class Fg{constructor(e,i,l,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=u,this.properties=e.properties,this.id=f}clone(){const e=new Fg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of AL)this[i]!==void 0&&(e[i]=this[i]);return e}}class e5{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ma(hn,16,0),this.featureIndexArray=new wm,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,l,u,f,m=0,w=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,f,m);const M=this.grid;for(let B=0;B<i.length;B++){const U=i[B],$=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<U.length;Q++){const ee=U[Q];$[0]=Math.min($[0],ee.x),$[1]=Math.min($[1],ee.y),$[2]=Math.max($[2],ee.x),$[3]=Math.max($[3],ee.y)}w!==0&&($[0]-=w,$[1]-=w,$[2]+=w,$[3]+=w),$[0]<hn&&$[1]<hn&&$[2]>=0&&$[3]>=0&&M.insert(C,$[0],$[1],$[2],$[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kn(new Rv(this.rawTileData)).layers,this.sourceLayerCoder=new Q3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:l,transform:u,tileTransform:f,pixelPosMatrix:m,availableImages:w,worldview:C}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const M=l.bufferedTilespaceBounds,B=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,((ee,he,_e,ve)=>Ki(l.bufferedTilespaceGeometry,ee,he,_e,ve)));B.sort(PL);let U=null;u.elevation&&B.length>0&&(U=kg.create(u.elevation,this.tileID));const $={};let Q;for(let ee=0;ee<B.length;ee++){const he=B[ee];if(he===Q)continue;Q=he;const _e=this.featureIndexArray.get(he);let ve=null;this.is3DTile?this.loadMatchingModelFeature($,_e,e,l,u,C):this.loadMatchingFeature($,_e,e,w,C,((De,ke,ze,Je=0)=>(ve||(ve=Sn(De,this.tileID.canonical,f)),ke.queryIntersectsFeature(l,De,ze,ve,this.z,u,m,U,Je))))}return $}loadMatchingFeature(e,i,l,u,f,m){const{featureIndex:w,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:B}=i,U=this.bucketLayerIDs[C],$=l.layers,Q=Object.keys($);if(Q.length&&!gr(Q,U))return;const ee=l.sourceCache,he=this.sourceLayerCoder.decode(M),_e=this.vtLayers[he].feature(w),ve=this.getId(_e,he);for(let De=0;De<U.length;De++){const ke=U[De];if(!$[ke])continue;const{styleLayer:ze,targets:Je}=$[ke];let Qe={};ve!==void 0&&(Qe=ee.getFeatureState(ze.sourceLayer,ve));const st=!m||m(_e,ze,Qe,B);if(!st)continue;const lt=new Fg(_e,this.z,this.x,this.y,ve);lt.tile=this.tileID.canonical,lt.state=Qe;let ft=this.serializedLayersCache.get(ke);ft||(ft=ze.serialize(),ft.id=ke,this.serializedLayersCache.set(ke,ft)),lt.source=ft.source,lt.sourceLayer=ft["source-layer"],lt.layer=Object.assign({},ft),lt.layer.paint=t5(ft.paint,ze.paint,_e,Qe,u),lt.layer.layout=t5(ft.layout,ze.layout,_e,Qe,u);let Ut=!1;for(const vt of Je){this.updateFeatureProperties(lt,vt);const{filter:$t}=vt;if($t){if(_e.properties=lt.properties,$t.needGeometry){const tn=Ht(_e,!0);if(!$t.filter(new ki(this.tileID.overscaledZ,{worldview:f}),tn,this.tileID.canonical))continue}else if(!$t.filter(new ki(this.tileID.overscaledZ,{worldview:f}),_e))continue}Ut=!0,vt.targetId&&this.addFeatureVariant(lt,vt)}Ut&&this.appendToResult(e,ke,w,lt,st)}}loadMatchingModelFeature(e,i,l,u,f,m){const{featureIndex:w,bucketIndex:C}=i,M=this.bucketLayerIDs[C],B=l.layers,U=Object.keys(B);if(!U.length||gr(U,M))for(let $=0;$<M.length;$++){const Q=M[$],{styleLayer:ee,targets:he}=B[Q];if(ee.type!=="model")continue;const _e=u.tile,ve=_e.getBucket(ee);if(!(ve&&ve instanceof Xv))continue;const De=kO(ve,w,u,f);if(!De)continue;const{z:ke,x:ze,y:Je}=_e.tileID.canonical,{feature:Qe,intersectionZ:st,position:lt}=De;let ft={};Qe.id!==void 0&&(ft=l.sourceCache.getFeatureState(ee.sourceLayer,Qe.id));const Ut=new Fg({},ke,ze,Je,Qe.id);Ut.tile=this.tileID.canonical,Ut.state=ft,Ut.properties=Qe.properties,Ut.geometry={type:"Point",coordinates:[lt.lng,lt.lat]};let vt=this.serializedLayersCache.get(Q);vt||(vt=ee.serialize(),vt.id=Q,this.serializedLayersCache.set(Q,vt)),Ut.source=vt.source,Ut.sourceLayer=vt["source-layer"],Ut.layer=Object.assign({},vt);let $t=!1;for(const tn of he){this.updateFeatureProperties(Ut,tn);const{filter:qt}=tn;if(qt){if(Qe.properties=Ut.properties,qt.needGeometry){if(!qt.filter(new ki(this.tileID.overscaledZ,{worldview:m}),Qe,this.tileID.canonical))continue}else if(!qt.filter(new ki(this.tileID.overscaledZ,{worldview:m}),Qe))continue}$t=!0,tn.targetId&&this.addFeatureVariant(Ut,tn)}$t&&this.appendToResult(e,Q,w,Ut,st)}}updateFeatureProperties(e,i,l){if(i.properties){const u={};for(const f in i.properties){const m=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);m!=null&&(u[f]=m)}e.properties=u}}addFeatureVariant(e,i,l){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,l,u,f){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:l,feature:u,intersectionZ:f})}lookupSymbolFeatures(e,i,l,u,f,m){const w={};this.loadVTLayers();for(const C of e)this.loadMatchingFeature(w,{bucketIndex:i,sourceLayerIndex:l,featureIndex:C,layoutVertexArrayOffset:0},u,f,m);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),f=this.vtFeatures[u];if(f[i])return f[i];const m=this.vtLayers[u].feature(i);return f[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const f=Wl(u);if(f.result!=="success"){const m=f.value.map((w=>`${w.key}: ${w.message}`)).join(", ");return void Vr(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new $a),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function t5(o,e,i,l,u){return fr(o,((f,m)=>{const w=e instanceof qu?e.get(m):null;return w&&w.evaluate?w.evaluate(i,l,void 0,u):w}))}function PL(o,e){return e-o}In(e5,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const n5=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class T2{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=n5[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new T2(w,m,f,e)}constructor(e,i=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=n5.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-w%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+w+C),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return C2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:w}=this,C=[0,f.length-1,0],M=[];for(;C.length;){const B=C.pop()||0,U=C.pop()||0,$=C.pop()||0;if(U-$<=w){for(let _e=$;_e<=U;_e++){const ve=m[2*_e],De=m[2*_e+1];ve>=e&&ve<=l&&De>=i&&De<=u&&M.push(f[_e])}continue}const Q=$+U>>1,ee=m[2*Q],he=m[2*Q+1];ee>=e&&ee<=l&&he>=i&&he<=u&&M.push(f[Q]),(B===0?e<=ee:i<=he)&&(C.push($),C.push(Q-1),C.push(1-B)),(B===0?l>=ee:u>=he)&&(C.push(Q+1),C.push(U),C.push(1-B))}return M}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,w=[0,u.length-1,0],C=[],M=l*l;for(;w.length;){const B=w.pop()||0,U=w.pop()||0,$=w.pop()||0;if(U-$<=m){for(let _e=$;_e<=U;_e++)i5(f[2*_e],f[2*_e+1],e,i)<=M&&C.push(u[_e]);continue}const Q=$+U>>1,ee=f[2*Q],he=f[2*Q+1];i5(ee,he,e,i)<=M&&C.push(u[Q]),(B===0?e-l<=ee:i-l<=he)&&(w.push($),w.push(Q-1),w.push(1-B)),(B===0?e+l>=ee:i+l>=he)&&(w.push(Q+1),w.push(U),w.push(1-B))}return C}}function C2(o,e,i,l,u,f){if(u-l<=i)return;const m=l+u>>1;r5(o,e,m,l,u,f),C2(o,e,i,l,m-1,1-f),C2(o,e,i,m+1,u,1-f)}function r5(o,e,i,l,u,f){for(;u>l;){if(u-l>600){const M=u-l+1,B=i-l+1,U=Math.log(M),$=.5*Math.exp(2*U/3),Q=.5*Math.sqrt(U*$*(M-$)/M)*(B-M/2<0?-1:1);r5(o,e,i,Math.max(l,Math.floor(i-B*$/M+Q)),Math.min(u,Math.floor(i+(M-B)*$/M+Q)),f)}const m=e[2*i+f];let w=l,C=u;for(f0(o,e,l,i),e[2*u+f]>m&&f0(o,e,l,u);w<C;){for(f0(o,e,w,C),w++,C--;e[2*w+f]<m;)w++;for(;e[2*C+f]>m;)C--}e[2*l+f]===m?f0(o,e,l,C):(C++,f0(o,e,C,u)),C<=i&&(l=C+1),i<=C&&(u=C-1)}}function f0(o,e,i,l){E2(o,i,l),E2(e,2*i,2*l),E2(e,2*i+1,2*l+1)}function E2(o,e,i){const l=o[e];o[e]=o[i],o[i]=l}function i5(o,e,i,l){const u=o-i,f=e-l;return u*u+f*f}r.$=kf,r.A=Ia,r.B=Wd,r.C=2,r.D=Sg,r.E=Uc,r.F=Q_,r.G=ME,r.H=Df,r.I=xa,r.J=Yh,r.K=er,r.L=Pd,r.M=Qc,r.N=Jf,r.O=Qf,r.P=Kt,r.Q=am,r.R=wh,r.S=nu,r.T=Nb,r.U=Wl,r.V=Yv,r.W=xs,r.X=Ld,r.Y=qc,r.Z=Od,r._=is,r.a=function(o){return Oo.API_CDN_URL_REGEX.test(o)},r.a$=qe,r.a0=Ru,r.a1=Sd,r.a2=Xh,r.a3=class extends Yv{},r.a4=ep,r.a5=im,r.a6=yt,r.a7=function(o){const e=o.value;return e?Ru(e)?f2(e,!0)?[]:[new Yv(o.key,e,`invalid url "${e}"`)]:[new Yv(o.key,e,`string expected, "${er(e)}" found`)]:[]},r.a8=hg,r.a9=oo,r.aA=et,r.aB=H,r.aC=Ft,r.aD=d,r.aE=No,r.aF=Fe,r.aG=St,r.aH=function(o,e){const i={};for(let l=0;l<e.length;l++){const u=e[l];u in o&&(i[u]=o[u])}return i},r.aI=Pe,r.aJ=Ze,r.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,i,l){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[f,m]=u.result;return this.scheduler?this.scheduler.add((()=>{l(f,m)}),e):l(f,m),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=i(((f,m)=>{u.result=[f,m];for(const w of u.callbacks)this.scheduler?this.scheduler.add((()=>{w(f,m)}),e):w(f,m);setTimeout((()=>delete this.entries[o]),3e3)}))),()=>{u.result||(u.callbacks=u.callbacks.filter((f=>f!==l)),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},r.aL=function(o,e,i){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(u=>{const f=Au(o.request,((m,w,C,M)=>{m?u(m):w&&u(null,{vectorTile:i?void 0:new Kn(new Rv(w)),rawData:w,cacheControl:C,expires:M})}));return()=>{f.cancel(),u()}}),e)},r.aM=function(o){fc++,fc>Fl&&(o.getActor().send("enforceCacheSizeLimit",ja),fc=0)},r.aN=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},r.aO=W,r.aP=i3,r.aQ=u3,r.aR=ce,r.aS=r3,r.aT=function(o,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<o.length;l++){const u=document.createElement("source");Gp(o[l])||(i.crossOrigin="Anonymous"),u.src=o[l],i.appendChild(u)}return{cancel:()=>{}}},r.aU=W_,r.aV=function(o){return fetch(o).then((e=>e.arrayBuffer())).then((e=>OC(e,0,o)))},r.aW=jC,r.aX=class{constructor(o,e,i,l){this.id=o,this.position=e!=null?new ce(e[0],e[1]):new ce(0,0),this.orientation=i??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Fn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(H(o.matrix,e,o.matrix),o.meshes)for(const i of o.meshes){const l=Fn.applyTransformFast(i.aabb,o.matrix);this.aabb.encapsulate(l)}if(o.children)for(const i of o.children)this._applyTransformations(i,o.matrix)}computeBoundsAndApplyParent(){const o=O([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,i,l,u,f,m=!1){VC(this.matrix,this,o.transform,this.position,e,i,l,u,f,m)}upload(o){if(!this.uploaded){for(const e of this.nodes)jb(e,o);for(const e of this.nodes)Iv(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)Gb(o)}},r.aY=lr,r.aZ=n0,r.a_=Ye,r.aa=ln,r.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return jo(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Qn(o.x,e.x,i),y:Qn(o.y,e.y,i),z:Qn(o.z,e.z,i),azimuthal:Qn(o.azimuthal,e.azimuthal,i),polar:Qn(o.polar,e.polar,i)}}},r.ac=ki,r.ad=Js,r.ae=Pt,r.af=xt,r.ag=ye,r.ah=Ct,r.ai=qu,r.aj=wp,r.ak=Qn,r.al=hn,r.am=hl,r.an=_t,r.ao=mi,r.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([i,l]){const u=jo([1,i,l]);return{x:u.x,y:u.y,z:u.z}})(o.expression.evaluate(e))}interpolate(o,e,i){return{x:Qn(o.x,e.x,i),y:Qn(o.y,e.y,i),z:Qn(o.z,e.z,i)}}},r.aq=function(o,e,i=0,l=!0){const u=new Kt(i,i),f=o.sub(u),m=e.add(u),w=[f,new Kt(m.x,f.y),m,new Kt(f.x,m.y)];return l&&w.push(f.clone()),w},r.ar=function(o,e){const i=[];for(let l=0;l<o.length;l++){const u=dt(l-1,-1,o.length-1),f=dt(l+1,-1,o.length-1),m=o[l],w=o[f],C=o[u].sub(m).unit(),M=w.sub(m).unit(),B=M.angleWithSep(C.x,C.y),U=C.add(M).unit().mult(-1*e/Math.sin(B/2));i.push(m.add(U))}return i},r.as=GE,r.at=Ki,r.au=function(o,e,i=0){return J(((e.x-i)*o.scale-o.x)*hn,(e.y*o.scale-o.y)*hn,We(e.z,e.y))},r.av=mt,r.aw=nt,r.ax=Xr,r.ay=eE,r.az=function(o){let e=1/0,i=1/0,l=-1/0,u=-1/0;for(const f of o)e=Math.min(e,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),u=Math.max(u,f.y);return{min:new Kt(e,i),max:new Kt(l,u)}},r.b=function(o){return Oo.API_FONTS_REGEX.test(o)},r.b$=Ab,r.b0=ou,r.b1=Fo,r.b2=Wt,r.b3=xm,r.b4=Hv,r.b5=function(){Yl.isLoading()||Yl.isLoaded()||sp()!=="deferred"||ju()},r.b6=Zu,r.b7=Ht,r.b8=Fg,r.b9=ai,r.bA=O,r.bB=se,r.bC=D,r.bD=function(o,e){const{x:i,y:l}=o.point,u=pv(i,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return H(u,u,ws(Qa(e)))},r.bE=I,r.bF=cn,r.bG=function(o,e){var i=e[0]-o[0],l=e[1]-o[1],u=e[2]-o[2];return Math.sqrt(i*i+l*l+u*u)},r.bH=Oe,r.bI=ct,r.bJ=$e,r.bK=J_,r.bL=Rl,r.bM=e2,r.bN=function(o,e,i,l,u){const f=5*e+2;o.float32[f+0]=i,o.float32[f+1]=l,o.float32[f+2]=u},r.bO=$v,r.bP=Pr,r.bQ=Br,r.bR=ni,r.bS=Yr,r.bT=dt,r.bU=function(o,e,i,l){var u=new A(4);return u[0]=o,u[1]=e,u[2]=i,u[3]=l,u},r.bV=Sv,r.bW=Xi,r.bX=Ss,r.bY=QT,r.bZ=d3,r.b_=rC,r.ba=Wb,r.bb=Tb,r.bc=Sn,r.bd=iu,r.be=gp,r.bf=Yn,r.bg=Pi,r.bh=bg,r.bi=d2,r.bj=function(o,e){const i=wp(e.zoom);if(i===0)return Qa(o);const l=_n(o),u=nr(l),f=Fe(l.getWest())*e.worldSize,m=Fe(l.getEast())*e.worldSize,w=Ze(l.getNorth())*e.worldSize,C=Ze(l.getSouth())*e.worldSize,M=[f,w,0],B=[m,w,0],U=[f,C,0],$=[m,C,0],Q=N([],e.globeMatrix);return xt(M,M,Q),xt(B,B,Q),xt(U,U,Q),xt($,$,Q),u[0]=za(u[0],U,i),u[1]=za(u[1],$,i),u[2]=za(u[2],B,i),u[3]=za(u[3],M,i),Fn.fromPoints(u)},r.bk=eo,r.bl=N,r.bm=$r,r.bn=za,r.bo=ks,r.bp=gn,r.bq=ge,r.br=j,r.bs=r1,r.bt=Rv,r.bu=Au,r.bv=function(o,e){const i=[];for(const l in o)l in e||i.push(l);return i},r.bw=Rt,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=yo,r.bz=function(o){var e=new A(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},r.c=vf,r.c$=function(o){return o*o*o*o*o},r.c0=Qb,r.c1=zE,r.c2=i2,r.c3=T2,r.c4=Ee,r.c5=Ue,r.c6=dn,r.c7=function(o,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],w=Math.sin(i),C=Math.cos(i);return o[0]=l*C+u*w,o[1]=u*C-l*w,o[2]=f*C+m*w,o[3]=m*C-f*w,o},r.c8=An,r.c9=yi,r.cA=Zn,r.cB=zC,r.cC=x,r.cD=Xt,r.cE=function(o,e,i,l,u,f,m,w,C){if(C.name==="globe")return Xt(o,e,new x(i,l,u),!1);const M=n0({z:i,x:l,y:u},C);return new Fn([(f+M.x/M.scale)*e,e*(M.y/M.scale),m],[(f+M.x2/M.scale)*e,e*(M.y2/M.scale),w])},r.cF=function(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o[3]=Math.min(e[3],i[3]),o},r.cG=function(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o[3]=Math.max(e[3],i[3]),o},r.cH=function(o){const e=Math.round((o+45+360)%360/90)%4;return Ie[e]},r.cI=Xe,r.cJ=gt,r.cK=b,r.cL=function(o){const e=O(new Float64Array(16));H(e,o.pixelMatrix,o.globeMatrix);const i=[0,G,0],l=[0,q,0];return xt(i,i,e),xt(l,l,e),[i[0]>0&&i[0]<=o.width&&i[1]>0&&i[1]<=o.height&&!gb(o,new ce(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!gb(o,new ce(o.center.lat,-90))]},r.cM=function(o,e){const{scale:i}=o.tileTransform,l=i*hn/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(u,f,m){var w=f[1],C=f[2],M=f[3],B=m[0],U=m[1];return u[0]=f[0]*B,u[1]=w*B,u[2]=C*U,u[3]=M*U,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},r.cN=Pv,r.cO=fe,r.cP=LC,r.cQ=function(o){const e=LC(o,!0);return I([],[e[0],e[1],e[4],e[5]])},r.cR=V,r.cS=ei,r.cT=Z,r.cU=function(o){const{x:e,y:i}=o.point,{lng:l,lat:u}=o._center;return pv(e,i,o.worldSize,l,u)},r.cV=xe,r.cW=we,r.cX=ie,r.cY=Ji,r.cZ=_,r.c_=function(o,e,i){let l=0;for(let u=0;u<2;++u)o[u]>0&&(l+=(o[u]-0)*(o[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},r.ca=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},r.cb=oe,r.cc=function(o,e,i,l,u){var f=1/Math.tan(e/2);if(o[0]=f/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=f,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,u!=null&&u!==1/0){var m=1/(l-u);o[10]=(u+l)*m,o[14]=2*u*l*m}else o[10]=-1,o[14]=-2*l;return o},r.cd=function(o,e,i,l,u,f,m){var w=1/(e-i),C=1/(l-u),M=1/(f-m);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*C,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*M,o[11]=0,o[12]=(e+i)*w,o[13]=(u+l)*C,o[14]=(m+f)*M,o[15]=1,o},r.ce=He,r.cf=function(o,e,i){o[4*e+0]=i[0],o[4*e+1]=i[1],o[4*e+2]=i[2],o[4*e+3]=i[3]},r.cg=Tl,r.ch=Fs,r.ci=Bi,r.cj=Ka,r.ck=nf,r.cl=ZE,r.cm=function(){var o=new A(4);return A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},r.cn=function(o,e,i){var l=e[0],u=e[1],f=e[2],m=e[3],w=Math.sin(i),C=Math.cos(i);return o[0]=l*C+f*w,o[1]=u*C+m*w,o[2]=l*-w+f*C,o[3]=u*-w+m*C,o},r.co=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},r.cp=Se,r.cq=function(o){var e=o[0],i=o[1],l=o[2],u=o[3];return Math.sqrt(e*e+i*i+l*l+u*u)},r.cr=On,r.cs=jt,r.ct=L,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=At,r.cz=pe,r.d=function(o){return Oo.API_TILEJSON_REGEX.test(o)},r.d$=iE,r.d0=Le,r.d1=45,r.d2=uu,r.d3=function(o,e,i){const l=Math.sqrt(o*o+e*e+i*i),u=l>0?Math.acos(i/l)*Va:0;let f=o!==0||e!==0?Math.atan2(-e,-o)*Va+90:0;return f<0&&(f+=360),[l,f,u]},r.d4=J,r.d5=jo,r.d6=bt,r.d7=Ae,r.d8=Fn,r.d9=ne,r.dA=function(o,e,i){const l=wp(i.zoom),u=o.style.map._antialias,f=o.terrain&&o.terrain.exaggeration()>0;return l===0&&!u&&!f},r.dB=function(o){const e=o.pixelsPerMeter,i=e/He(1,o.center.lat),l=O(new Float64Array(16));return j(l,l,[o.point.x,o.point.y,0]),V(l,l,[i,i,e]),Float32Array.from(l)},r.dC=_n,r.dD=function(o){const e=Xe-5;o=et(o,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(_t(o))),3);return Math.round(i*(k.length-1))},r.dE=function(o,e,i,l){const u=e.getNorth(),f=e.getSouth(),m=e.getWest(),w=e.getEast(),C=1<<o.z,M=w-m,B=u-f,U=M/P,$=-B/k[i],Q=[0,U,0,$,0,0,u,m,0];if(o.z>0){const ee=180/l;R(Q,Q,[ee/M+1,0,0,0,ee/B+1,0,-.5*ee/U,.5*ee/$,1])}return Q[2]=C,Q[5]=o.x,Q[8]=o.y,Q},r.dF=Qa,r.dG=function(o,e,i){const l=O(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return X(l,i.globeMatrix,u),Float32Array.from(l)},r.dH=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,u=Math.floor(o.x),f=Math.floor((o.x-u)*l),m=Math.floor(o.y*l),w=this.findDEMTileFor(new W(i,u,i,f,m));return!(!w||!w.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const u=l.getSource().maxzoom,f=1<<u,m=Math.floor(o.x),w=o.x-m,C=new W(u,m,u,Math.floor(w*f),Math.floor(o.y*f)),M=this.findDEMTileFor(C);if(!M||!M.dem)return e;const B=M.dem,U=1<<M.tileID.canonical.z,$=(w*U-M.tileID.canonical.x)*B.dim,Q=(o.y*U-M.tileID.canonical.y)*B.dim,ee=Math.floor($),he=Math.floor(Q);return(i?this.exaggeration():1)*Qn(Qn(B.get(ee,he),B.get(ee,he+1),Q-he),Qn(B.get(ee+1,he),B.get(ee+1,he+1),Q-he),$-ee)}getAtTileOffset(o,e,i){const l=1<<o.canonical.z;return this.getAtPointOrZero(new Pt(o.wrap+(o.canonical.x+e/hn)/l,(o.canonical.y+i/hn)/l))}getAtTileOffsetFunc(o,e,i,l){return u=>{const f=this.getAtTileOffset(o,u.x,u.y),m=l.upVector(o.canonical,u.x,u.y);return Ee(m,m,f*l.upVectorScale(o.canonical,e,i).metersToTile),m}}getForTilePoints(o,e,i,l){if(this.isUsingMockSource())return!1;const u=kg.create(this,o,l);return!!u&&(e.forEach((f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,u=1<<o.canonical.z-l.canonical.z;let f=o.canonical.x/u-l.canonical.x,m=o.canonical.y/u-l.canonical.y,w=0;for(let C=0;C<o.canonical.z-l.canonical.z&&!i.leaves[w];C++){f*=2,m*=2;const M=2*Math.floor(m)+Math.floor(f);w=i.childOffsets[w]+M,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of o){const f=this.getMinMaxForTile(u.tileID);f&&(i=Math.min(i,f.min),l=Math.max(l,f.max),e=!0)}return e?{min:i,max:l}:null}},r.dI=LT,r.dJ=or,r.dK=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},r.dL=F,r.dM=function(o,e){var i=Math.sin(e),l=Math.cos(e);return o[0]=l,o[1]=i,o[2]=0,o[3]=-i,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},r.dN=It,r.dO=td,r.dP=rs,r.dQ=$s,r.dR=256,r.dS=function(o,e){const i=[0,0,0];return xt(i,i,eo(Qa(e.canonical))),xt(i,i,o),i},r.dT=o=>({u_matrix:new nf(o),u_texsize:new Ka(o),u_pixels_to_tile_units:new Bo(o),u_device_pixel_ratio:new Bi(o),u_width_scale:new Bi(o),u_floor_width_scale:new Bi(o),u_image:new Tl(o),u_units_to_pixels:new Ka(o),u_tile_units_to_pixels:new Bi(o),u_alpha_discard_threshold:new Bi(o),u_trim_offset:new Ka(o),u_trim_fade_range:new Ka(o),u_trim_color:new uu(o),u_emissive_strength:new Bi(o),u_zbias_factor:new Bi(o),u_tile_to_meter:new Bi(o),u_ground_shadow_factor:new Fs(o),u_pattern_transition:new Bi(o)}),r.dU=o=>({u_matrix:new nf(o),u_pixels_to_tile_units:new Bo(o),u_device_pixel_ratio:new Bi(o),u_width_scale:new Bi(o),u_floor_width_scale:new Bi(o),u_units_to_pixels:new Ka(o),u_dash_image:new Tl(o),u_gradient_image:new Tl(o),u_image_height:new Bi(o),u_texsize:new Ka(o),u_tile_units_to_pixels:new Bi(o),u_alpha_discard_threshold:new Bi(o),u_trim_offset:new Ka(o),u_trim_fade_range:new Ka(o),u_trim_color:new uu(o),u_emissive_strength:new Bi(o),u_zbias_factor:new Bi(o),u_tile_to_meter:new Bi(o),u_ground_shadow_factor:new Fs(o)}),r.dV=o=>({u_camera_to_center_distance:new Bi(o),u_extrude_scale:new Bo(o),u_device_pixel_ratio:new Bi(o),u_matrix:new nf(o),u_inv_rot_matrix:new nf(o),u_merc_center:new Ka(o),u_tile_id:new Fs(o),u_zoom_transition:new Bi(o),u_up_dir:new Fs(o),u_emissive_strength:new Bi(o)}),r.dW=mp,r.dX=Uk,r.dY=class{constructor(o,e,i,l){this.context=o,this.format=l,this.size=i,this.texture=o.gl.createTexture();const[u,f,m]=this.size,{gl:w}=o;w.bindTexture(w.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&w.texImage3D(w.TEXTURE_3D,0,this.format,u,f,m,0,Fb(this.format),Bb(this.format),e.data)}bind(o,e){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},r.dZ=CT,r.d_=(o,e,i,l,u,f)=>{const m=o.transform,w=m.projection.name==="globe";let C;if(f.paint.get("circle-pitch-alignment")==="map")if(w){const B=td(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;C=Float32Array.from([B,0,0,B])}else C=m.calculatePixelsToTileUnitsMatrix(i);else C=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(m.projection),u_matrix:o.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ua.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:a6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(w){M.u_inv_rot_matrix=l,M.u_merc_center=u,M.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],M.u_zoom_transition=wp(m.zoom);const B=u[0]*hn,U=u[1]*hn;M.u_up_dir=m.projection.upVector(new x(0,0,0),B,U)}return M},r.da=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},r.db=f2,r.dc=function(o,e){return o.readFields(zO,{icons:[]},e)},r.dd=Tv,r.de=Ig,r.df=n2,r.dg=Sh,r.dh=dg,r.di=wf,r.dj=Pf,r.dk=Ir,r.dl=function(o){const e=o.indexOf(Kh);return e>=0?o.slice(0,e):o},r.dm=function(o){return o.indexOf(Kh)>=0},r.dn=function(o){const e=o.lastIndexOf(Kh);return e>=0?o.slice(e+1):""},r.dp=function(o){const e=[],i=o.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dq=function(o,e,i,l){return o.type==="custom"?new IO(o,e):new OO[o.type](o,e,i,l)},r.dr=Nr,r.ds=function(o){const e=o.indexOf(Kh);return e>=0?o.slice(e+1):""},r.dt=class extends Fg{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},r.du=dm,r.dv=Wr,r.dw=function(o){return o({pluginStatus:Qs,pluginURL:tu}),dm.on("pluginStateChange",o),o},r.dx=du,r.dy=class extends Ci{constructor(o){super(o),this.current=I_}set(o,e,i){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dz=Ge,r.e=Oo,r.e$=function(){const o=$_;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(Db),$_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e0=Ys,r.e1=(o,e,i,l,u,f,m,w,C,M)=>{const B=o.transform,U=B.pitch<15?tE(.07,.7,et((14-B.zoom)/5,0,1)):.07,$=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:rE(o,e,i,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:B.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:f,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:nE(e,B),u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor($?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:bt(e.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:M}},r.e2=(o,e,i,l,u,f,m,w,C,M)=>{const B=o.transform,U=B.calculatePixelsToTileUnitsMatrix(e),$=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Q=B.pitch<15?tE(.07,.7,et((14-B.zoom)/5,0,1)):.07;return{u_matrix:rE(o,e,i,l),u_pixels_to_tile_units:U,u_device_pixel_ratio:f,u_width_scale:m,u_floor_width_scale:w,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:oE(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:nE(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor($?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:Q,u_tile_to_meter:bt(e.tileID.canonical,0),u_ground_shadow_factor:M}},r.e3=qn,r.e4=D_,r.e5=We,r.e6=be,r.e7=wv,r.e8=mC,r.e9=Tp,r.eA=zo,r.eB=Pc,r.eC=function(o,e,i,l,u,f,m,w,C,M,B,U,$,Q,ee,he){var _e=new A(16);return _e[0]=o,_e[1]=e,_e[2]=i,_e[3]=l,_e[4]=u,_e[5]=f,_e[6]=m,_e[7]=w,_e[8]=C,_e[9]=M,_e[10]=B,_e[11]=U,_e[12]=$,_e[13]=Q,_e[14]=ee,_e[15]=he,_e},r.eD=re,r.eE=lu,r.eF=Xu,r.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Kt(1/0,1/0),max:new Kt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const i=tC(new Kt(0,0),new Kt(hn,hn),o),l=[];if(e&&!Cb(i,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!Cb(i,u))continue;const f=L6(u.min,u.max,o);l.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(o){this._setSources(o.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const i=o.getOrder(),l=o.getClipMask(),u=o.getClipScope();for(const f of e){if(!f.footprint)continue;const m=tC(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:l,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||vv(e.min,i.min)||vv(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(l,u){const f=(m,w)=>m+w;return l.length-u.length||l.reduce(f,"").localeCompare(u.reduce(f,""))})(e.clipScope,i.clipScope)));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const i=this._activeRegions[e],l=this._prevRegions[e];o=i.priority!==l.priority||!eC(i,l)||i.order!==l.order||i.clipMask!==l.clipMask||!yo(i.clipScope,l.clipScope),++e}}if(o){++this._updateTime;for(const i of this._activeRegions)i.order!==B_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const l=this._activeRegions;if(i>=l.length)return i;const u=l[i].priority;for(;i<l.length&&l[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,l=e(i);for(;i!==l;){let u=i;const f=i;for(;u!==l;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let w=0;w<f;w++){const C=this._activeRegions[w];if(!C.hiddenByOverlap&&m.order===B_&&Cb(m,C)&&(m.hiddenByOverlap=nC(m.footprint,m.tileId,C.footprint,C.tileId),m.hiddenByOverlap))break}++u}i=l,l=e(i)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},r.eH=B_,r.eI=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const i=new iu,l=new Fo,u=[],f=o+1+2,m=e[0]+1,w=e[0]+1+(1+e.length),C=(M,B,U)=>{let $=M===f-1?M-2:M===0?M:M-1;return $+=U?24575:0,[$,B]};for(let M=0;M<f;++M)i.emplaceBack(...C(M,0,!0));for(let M=0;M<m;++M)for(let B=0;B<f;++B)i.emplaceBack(...C(B,M,(B===0||B===f-1)&&!0));for(let M=0;M<e.length;++M){const B=e[M];for(let U=0;U<f;++U)i.emplaceBack(...C(U,B,!0))}for(let M=0;M<e.length;++M){const B=l.length,U=e[M]+1+2,$=new Fo;for(let he=0;he<U-1;he++){const _e=he===U-2,ve=_e?f*(w-e.length+M-he):f;for(let De=0;De<f-1;De++){const ke=he*f+De;he===0||_e||De===0||De===f-2?($.emplaceBack(ke+1,ke,ke+ve),$.emplaceBack(ke+ve,ke+ve+1,ke+1)):(l.emplaceBack(ke+1,ke,ke+ve),l.emplaceBack(ke+ve,ke+ve+1,ke+1))}}const Q=Pi.simpleSegment(0,B,i.length,l.length-B);for(let he=0;he<$.uint16.length;he+=3)l.emplaceBack($.uint16[he],$.uint16[he+1],$.uint16[he+2]);const ee=Pi.simpleSegment(0,B,i.length,l.length-B);u.push({withoutSkirts:Q,withSkirts:ee})}return{vertices:i,indices:l,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(P,k);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Yn.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new Fo;for(let m=0;m<=P;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const i=new Yu,l=new Yu,u=new Yu,f=new Yu;this._poleSegments=[];for(let m=0,w=0;m<_;m++){const C=360/(1<<m);i.emplaceBack(0,-d,0,.5,0),l.emplaceBack(0,-d,0,.5,1),u.emplaceBack(0,-d,0,.5,.5),f.emplaceBack(0,-d,0,.5,.5);for(let M=0;M<=P;M++){let B=M/P,U=0;const $=Qn(0,C,B),[Q,ee,he]=te(o6,s6,$,d);i.emplaceBack(Q,ee,he,B,U),l.emplaceBack(Q,ee,he,B,1-U);const _e=_t($);B=.5+.5*Math.sin(_e),U=.5+.5*Math.cos(_e),u.emplaceBack(Q,ee,he,B,U),f.emplaceBack(Q,ee,he,B,1-U)}this._poleSegments.push(Pi.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(i,kt,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,kt,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,kt,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(f,kt,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},r.eJ=JT,r.eK=it,r.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eM=tt,r.eN=Lt,r.eO=function(o,e,i){return o[0]=e[0]/i[0],o[1]=e[1]/i[1],o[2]=e[2]/i[2],o},r.eP=Ke,r.eQ=Y,r.eR=at,r.eS=de,r.eT=function([o,e,i]){const l=Math.hypot(o,e,i),u=Math.atan2(o,i),f=.5*Math.PI-Math.acos(-e/l);return new ce(we(u),we(f))},r.eU=Ot,r.eV=Vb,r.eW=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(i){if(io==null){const l=i.navigator?i.navigator.userAgent:null;io=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return io})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eX=function(o,e){ja=o,Fl=e},r.eY=gb,r.eZ=ST,r.e_=function(o){const e=[0,0,0],i=O(new Float64Array(16));return H(i,o.pixelMatrix,o.globeMatrix),xt(e,e,i),new Kt(e[0],e[1])},r.ea=450,r.eb=7,r.ec=ht,r.ed=function(o,e){if(o===e){var i=e[1],l=e[2],u=e[3],f=e[6],m=e[7],w=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=i,o[6]=e[9],o[7]=e[13],o[8]=l,o[9]=f,o[11]=e[14],o[12]=u,o[13]=m,o[14]=w}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},r.ee=MO,r.ef=jr,r.eg=Ku,r.eh=256,r.ei=ws,r.ej=ea,r.ek=X,r.el=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},r.em=Yu,r.en=ym,r.eo=Hh,r.ep=function(o,e,i,l,u){return et((o-e)/(i-e)*(u-l)+l,l,u)},r.eq=Gt,r.er=function(o,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=e[4],w=e[5],C=e[6],M=e[7],B=e[8],U=B*m-w*M,$=-B*f+w*C,Q=M*f-m*C,ee=i*U+l*$+u*Q;return ee?(o[0]=U*(ee=1/ee),o[1]=(-B*l+u*M)*ee,o[2]=(w*l-u*m)*ee,o[3]=$*ee,o[4]=(B*i-u*C)*ee,o[5]=(-w*i+u*f)*ee,o[6]=Q*ee,o[7]=(-M*i+l*C)*ee,o[8]=(m*i-l*f)*ee,o):null},r.es=2,r.et=ut,r.eu=Ub,r.ev=[1,1,1],r.ew=kg,r.ex=je,r.ey=function(o,e,i,l){var u=e[0],f=e[1],m=e[2],w=e[3];return o[0]=u+l*(i[0]-u),o[1]=f+l*(i[1]-f),o[2]=m+l*(i[2]-m),o[3]=w+l*(i[3]-w),o},r.ez=Ag,r.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},r.f0=function(){Tv().acquire(Db)},r.f1=sp,r.f2=function(o,e,i=!1){if(Qs===ba.deferred||Qs===ba.loading||Qs===ba.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");tu=Ua.resolveURL(o),Qs=ba.deferred,Uu=e,um(),i||ju()},r.f3=function(o){Tg=Ua.resolveURL(o),Cg||(Cg=new Sg(Tv(),new Uc)),Cg.broadcast("setMeshoptUrl",Tg)},r.f4=PC,r.f5=function(o){Ob=Ua.resolveURL(o),Cg||(Cg=new Sg(Tv(),new Uc)),Cg.broadcast("setDracoUrl",Ob)},r.f6=AC,r.f7=G_,r.f8=function(o){const e=Sf();if(!e)return;const i=e.delete(va);o&&i.then((()=>o())).catch(o)},r.f9=Cm,r.fA=function(o){_d(),Is?.then((e=>{e.keys().then((i=>{for(let l=0;l<i.length-o;l++)e.delete(i[l]).catch((u=>Vr(u.message)))})).catch((i=>Vr(i.message)))})).catch((e=>Vr(e.message)))},r.fa=In,r.fb=Sp,r.fc=rd,r.fd=Q3,r.fe=e5,r.ff=KC,r.fg=dr,r.fh="hd_road_elevation",r.fi=Ii,r.fj=fr,r.fk=of,r.fl=t2,r.fm=Pm,r.fn=function(o,e,i,l,u,f,m,w=1,C,M,B){o.createArrays(),o.tilePixelRatio=hn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const U=o.layers[0].layout,$=o.layers[0]._unevaluatedLayout._values,Q={};Q.scaleFactor=w,Q.textSizeScaleRange=U.get("text-size-scale-range"),Q.iconSizeScaleRange=U.get("icon-size-scale-range");const[ee,he]=Q.textSizeScaleRange,[_e,ve]=Q.iconSizeScaleRange;Q.textScaleFactor=et(Q.scaleFactor,ee,he),Q.iconScaleFactor=et(Q.scaleFactor,_e,ve);const De=$["text-size"],ke=$["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:ft,maxZoom:Ut}=o.textSizeData;Q.compositeTextSizes=[De.possiblyEvaluate(new ki(ft,{worldview:B}),f),De.possiblyEvaluate(new ki(Ut,{worldview:B}),f)]}if(o.iconSizeData.kind==="composite"){const{minZoom:ft,maxZoom:Ut}=o.iconSizeData;Q.compositeIconSizes=[ke.possiblyEvaluate(new ki(ft,{worldview:B}),f),ke.possiblyEvaluate(new ki(Ut,{worldview:B}),f)]}Q.layoutTextSize=De.possiblyEvaluate(new ki(m+1,{worldview:B}),f),Q.layoutIconSize=ke.possiblyEvaluate(new ki(m+1,{worldview:B}),f),Q.textMaxSize=De.possiblyEvaluate(new ki(18,{worldview:B}),f);const ze=U.get("symbol-placement"),Je=U.get("text-rotation-alignment")==="map"&&ze!=="point",Qe=U.get("text-size");let st=!1;const lt=[];for(const ft of o.features){const Ut=U.get("text-font").evaluate(ft,{},f).join(","),vt=Qe.evaluate(ft,{},f)*Q.textScaleFactor,$t=Q.layoutTextSize.evaluate(ft,{},f)*Q.textScaleFactor,tn=Q.layoutIconSize.evaluate(ft,{},f)*Q.iconScaleFactor,qt={horizontal:{},vertical:void 0},Jt=ft.text;let on,Bt=[0,0];if(Jt){const Hn=Jt.toString(),cr=U.get("text-letter-spacing").evaluate(ft,{},f)*Ss,xr=U.get("text-line-height").evaluate(ft,{},f)*Ss,kr=Vu(Hn)?cr:0,Cr=U.get("text-anchor").evaluate(ft,{},f),Ln=U.get("text-variable-anchor");if(!Ln){const Mt=U.get("text-radial-offset").evaluate(ft,{},f);if(Mt)Bt=zE(Cr,[Mt*Ss,r2]);else{const Vt=U.get("text-offset").evaluate(ft,{},f);Bt=[Vt[0]*Ss,Vt[1]*Ss]}}let Sr=Je?"center":U.get("text-justify").evaluate(ft,{},f);const Kr=ze==="point",Ne=Kr?U.get("text-max-width").evaluate(ft,{},f)*Ss:1/0,Ve=Mt=>{o.allowVerticalPlacement&&cm(Hn)&&(qt.vertical=Jb(Jt,e,i,u,Ut,Ne,xr,Cr,Mt,kr,Bt,Rl.vertical,!0,$t,vt,C))};if(!Je&&Ln){const Mt=Sr==="auto"?Ln.map((xn=>i2(xn))):[Sr];let Vt=!1;for(let xn=0;xn<Mt.length;xn++){const vn=Mt[xn];if(!qt.horizontal[vn])if(Vt)qt.horizontal[vn]=qt.horizontal[0];else{const Dn=Jb(Jt,e,i,u,Ut,Ne,xr,"center",vn,kr,Bt,Rl.horizontal,!1,$t,vt,C);Dn&&(qt.horizontal[vn]=Dn,Vt=Dn.positionedLines.length===1)}}Ve("left")}else{if(Sr==="auto"&&(Sr=i2(Cr)),Kr||U.get("text-writing-mode").indexOf("horizontal")>=0||!cm(Hn)){const Mt=Jb(Jt,e,i,u,Ut,Ne,xr,Cr,Sr,kr,Bt,Rl.horizontal,!1,$t,vt,C);Mt&&(qt.horizontal[Sr]=Mt)}Ve(Kr?"left":Sr)}}let Qt,Dt,Et,an,rn,Xn,Rn=!1;const Un=U.get("icon-text-fit").evaluate(ft,{},f);if(ft.icon&&ft.icon.hasPrimary()){const Hn=BE(ft.icon,o.iconSizeData,$["icon-size"],f,o.zoom,ft,C,Q.iconScaleFactor,B);Qt=Hn.iconPrimary,Et=Hn.iconSecondary;const cr=Qt.toString();if(Dt=l.get(cr),Dt&&(rn=U.get("icon-offset").evaluate(ft,{},f),Xn=U.get("icon-anchor").evaluate(ft,{},f),on=oO(u.get(cr),Et?u.get(Et.toString()):void 0,rn,Xn),Rn=Dt.sdf,o.sdfIcons===void 0?o.sdfIcons=Dt.sdf:o.sdfIcons!==Dt.sdf&&Vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Dt.pixelRatio!==o.pixelRatio||U.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),Et){const xr=Et.toString();an=l.get(xr)}}st=st||!(!ft.icon||!ft.icon.hasSecondary());const mn=o2(qt.horizontal)||qt.vertical;o.iconsInText||(o.iconsInText=!!mn&&mn.iconsInText);const Wn=$t*Q.textScaleFactor/Ss,{defaultShapedIcon:pr,verticallyShapedIcon:bn}=mO(o,on,U,ft,f,qt,Wn,rn,Un);Un!=="none"&&on&&(xE(on)||bE(on))&&(zv(0,Dt,Qt,on,pr,Un,M,l,u),zv(0,an,Et,on,pr,Un,M,l,u),bn&&(zv(0,Dt,Qt,on,bn,Un,M,l,u),zv(0,an,Et,on,bn,Un,M,l,u))),on=pr,lt.push({feature:ft,shapedTextOrientations:qt,shapedText:mn,shapedIcon:on,iconPrimary:Qt,iconSecondary:Et,iconOffset:rn,iconAnchor:Xn,verticallyShapedIcon:bn,layoutTextSize:$t,layoutIconSize:tn,textOffset:Bt,isSDFIcon:Rn,iconTextFit:Un})}return{featureData:lt,sizes:Q,hasAnySecondaryIcon:st,textAlongLine:Je,symbolPlacement:ze}},r.fo=IE,r.fp=function(o,e,i,l,u,f,m,w,C,M){const{featureData:B,hasAnySecondaryIcon:U,sizes:$,textAlongLine:Q,symbolPlacement:ee}=e;for(const he of B){const{shapedIcon:_e,verticallyShapedIcon:ve,feature:De,shapedTextOrientations:ke,shapedText:ze,layoutTextSize:Je,textOffset:Qe,isSDFIcon:st,iconPrimary:lt,iconSecondary:ft,iconTextFit:Ut,iconOffset:vt}=he;NE(_e,M.iconPositions,lt,ft),NE(ve,M.iconPositions,lt,ft),pO(ke,M.iconPositions),fO(lt,ft,M.iconPositions),(ze||_e)&&gO(o,De,ke,_e,ve,C,$,Je,0,Qe,st,l,u,m,w,U,Ut,vt,Q,ee)}i&&o.generateCollisionDebugBuffers(f,o.collisionBoxArray,$.textScaleFactor)},r.fq=Kn,r.fr=n1,r.fs=en,r.ft=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==IC){const i=new Uint32Array(o,0,7),[,,l,u,f,m]=i;e=i.byteLength+u+f+m+f,(l!==o.byteLength||e>=o.byteLength)&&Vr("Invalid b3dm header information.")}return OC(o,e)},r.fu=function(o,e){const i=jC(o);for(const l of i){for(const u of l.meshes)hk(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(fk(l.lights,e)))}return i},r.fv=Xv,r.fw=bi,r.fx=CC,r.fy=Yl,r.fz=ba,r.g=function(o,e){return Wr(Object.assign(o,{method:"GET"}),e)},r.h=function(o){return o.indexOf("mapbox:")===0},r.i=function(o){return Oo.API_STYLE_REGEX.test(o)&&!vf(o)},r.j=dc,r.k=bh,r.l=function(o){return decodeURIComponent(atob(o).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},r.m=function(o,e){return Wr(Object.assign(o,{type:"json"}),e)},r.n=Vc,r.o=Ua,r.p=function(o,e){return Wr(Object.assign(o,{method:"POST"}),e)},r.q=ia,r.r=xf,r.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return kb||(kb=new Cm),kb},r.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},r.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},r.w=Vr,r.x=x2,r.y=gc,r.z=Ga})),v(["./shared"],(function(r){function E(_t){const we=_t?_t.url.toString():void 0;return we?performance.getEntriesByName(we):[]}function A(_t){if(typeof _t=="number"||typeof _t=="boolean"||typeof _t=="string"||_t==null)return JSON.stringify(_t);if(Array.isArray(_t)){let Ie="[";for(const Ge of _t)Ie+=`${A(Ge)},`;return`${Ie}]`}let we="{";for(const Ie of Object.keys(_t).sort())we+=`${Ie}:${A(_t[Ie])},`;return`${we}}`}function I(_t){let we="";for(const Ie of r.bx)we+=`/${A(_t[Ie])}`;return we}class F{constructor(we){this.keyCache={},this._layers={},this._layerConfigs={},we&&this.replace(we)}replace(we,Ie){this._layerConfigs={},this._layers={},this.update(we,[],Ie)}update(we,Ie,Ge){this._options=Ge;for(const tt of we)this._layerConfigs[tt.id]=tt,(this._layers[tt.id]=r.dq(tt,this.scope,null,this._options)).compileFilter(Ge),this.keyCache[tt.id]&&delete this.keyCache[tt.id];for(const tt of Ie)delete this.keyCache[tt],delete this._layerConfigs[tt],delete this._layers[tt];this.familiesBySource={};const it=(function(tt,et){const Ct={};for(let Rt=0;Rt<tt.length;Rt++){const un=tt[Rt];let Wt=et&&et[un.id];Wt||(un.type==="symbol"?Wt=un.id:(Wt=I(un),un.type==="line"&&un.paint&&(function lr(fr){return typeof fr=="string"&&fr==="line-progress"||(Array.isArray(fr)?fr.some(lr):!(!fr||typeof fr!="object")&&Object.values(fr).some(lr))})(un.paint["line-width"])&&(Wt+=`/${A(un.paint["line-width"])}`))),et&&(et[un.id]=Wt);let qn=Ct[Wt];qn||(qn=Ct[Wt]=[]),qn.push(un)}const dt=[];for(const Rt in Ct)dt.push(Ct[Rt]);return dt})(Object.values(this._layerConfigs),this.keyCache);for(const tt of it){const et=tt.map((qn=>this._layers[qn.id])),Ct=et[0];if(Ct.visibility==="none")continue;const dt=Ct.source||"";let Rt=this.familiesBySource[dt];Rt||(Rt=this.familiesBySource[dt]={});const un=Ct.sourceLayer||"_geojsonTileLayer";let Wt=Rt[un];Wt||(Wt=Rt[un]=[]),Wt.push(et)}}}const z=1*r.fc;class R{constructor(we){const Ie={},Ge=[];for(const Ct in we){const dt=we[Ct],Rt=Ie[Ct]={};for(const un in dt.glyphs){const Wt=dt.glyphs[+un];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const qn=Wt.metrics.localGlyph?z:1,lr={x:0,y:0,w:Wt.bitmap.width+2*qn,h:Wt.bitmap.height+2*qn};Ge.push(lr),Rt[un]=lr}}const{w:it,h:tt}=r.G(Ge),et=new r.fb({width:it||1,height:tt||1});for(const Ct in we){const dt=we[Ct];for(const Rt in dt.glyphs){const un=dt.glyphs[+Rt];if(!un||un.bitmap.width===0||un.bitmap.height===0)continue;const Wt=Ie[Ct][Rt],qn=un.metrics.localGlyph?z:1;r.fb.copy(un.bitmap,et,{x:0,y:0},{x:Wt.x+qn,y:Wt.y+qn},un.bitmap)}}this.image=et,this.positions=Ie}}r.fa(R,"GlyphAtlas");class D{constructor(we){this.tileID=new r.aO(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.lut=we.lut,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.scope=we.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.request&&we.request.collectResourceTiming,this.promoteId=we.promoteId,this.isSymbolTile=we.isSymbolTile,this.tileTransform=r.aZ(we.tileID.canonical,we.projection),this.projection=we.projection,this.worldview=we.worldview,this.localizableLayerIds=we.localizableLayerIds,this.brightness=we.brightness,this.extraShadowCaster=!!we.extraShadowCaster,this.tessellationStep=we.tessellationStep,this.scaleFactor=we.scaleFactor,this.worldview=we.worldview}parse(we,Ie,Ge,it,tt,et){this.status="parsing",this.data=we,this.collisionBoxArray=new r.b3;const Ct=new r.fd(Object.keys(we.layers).sort()),dt=new r.fe(this.tileID,this.promoteId);dt.bucketLayerIDs=[];const Rt={},un=new r.ff(256,256),Wt={featureIndex:dt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:un,availableImages:Ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},qn=[],lr=Ie.familiesBySource[this.source];for(const Nr in lr){const Ir=we.layers[Nr];if(!Ir)continue;let gr=!1,wi=!1,Vr=!1;for(const bi of lr[Nr])bi[0].type==="symbol"?gr=!0:wi=!0,bi[0].is3D()&&bi[0].type!=="model"&&(Vr=!0);if(this.extraShadowCaster&&!Vr||this.isSymbolTile===!0&&!gr||this.isSymbolTile===!1&&!wi)continue;Ir.version===1&&r.w(`Vector tile source "${this.source}" layer "${Nr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fo=Ct.encode(Nr),ko=[];let jo=!1;for(let bi=0,ai=0;bi<Ir.length;bi++){const io=Ir.feature(bi),yi=dt.getId(io,Nr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Nr)){const Hr=io.properties?io.properties.worldview:null;if(this.worldview&&typeof Hr=="string")if(Hr==="all")io.properties.$localized=!0;else{if(!Hr.split(",").includes(this.worldview))continue;io.properties.$localized=!0,io.properties.worldview=this.worldview}}!jo&&io.properties&&io.properties.hasOwnProperty(r.fg)&&(jo=!0),ko.push({feature:io,id:yi,index:ai,sourceLayerIndex:fo}),ai++}jo&&!Wt.elevationFeatures&&we.layers.hasOwnProperty(r.fh)&&(Wt.elevationFeatures=r.fi.parseFrom(we.layers[r.fh],this.canonical));for(const bi of lr[Nr]){const ai=bi[0];if(this.extraShadowCaster&&(!ai.is3D()||ai.type==="model")||this.isSymbolTile!==void 0&&ai.type==="symbol"!==this.isSymbolTile||ai.minzoom&&this.zoom<Math.floor(ai.minzoom)||ai.maxzoom&&this.zoom>=ai.maxzoom||ai.visibility==="none")continue;O(bi,this.zoom,Wt.brightness,Ge,this.worldview);const io=Rt[ai.id]=ai.createBucket({index:dt.bucketLayerIDs.length,layers:bi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:it,worldview:this.worldview});dt.bucketLayerIDs.push(bi.map((Hr=>r.B(Hr.id,Hr.scope))));let yi=io.prepare?io.prepare():null;yi!=null?(yi=yi.then((()=>io.populate(ko,Wt,this.tileID.canonical,this.tileTransform))),qn.push(yi)):io.populate(ko,Wt,this.tileID.canonical,this.tileTransform)}}const fr=()=>{let Nr,Ir,gr,wi,Vr,fo;un.trim();const ko={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},jo=()=>{if(Nr)return this.status="done",et(Nr);if(this.extraShadowCaster)this.status="done",et(null,{buckets:Object.values(Rt).filter((ai=>!ai.isEmpty())),featureIndex:dt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Wt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ir&&gr&&wi){const ai=new R(Ir),io=new Map;for(const[ts,rs]of gr.entries()){const{imagePosition:$s}=r.fl(ts,rs,r.fm);io.set(ts,$s)}const yi={};for(const ts in Rt){const rs=Rt[ts];rs instanceof r.b4&&(O(rs.layers,this.zoom,Wt.brightness,Ge,this.worldview),yi[ts]=r.fn(rs,Ir,ai.positions,gr,io,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Vr,this.worldview))}const Hr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(tt,gr,Vr,(()=>{Hr.iconsPending=!1,bi(yi,ai,Hr)})),this.rasterizeIfNeeded(tt,wi,fo,(()=>{Hr.patternsPending=!1,bi(yi,ai,Hr)}))}},bi=(ai,io,yi,Hr)=>{if(yi.iconsPending||yi.patternsPending)return;const ts=new r.fo(gr,wi,this.lut);for(const rs in Rt){const $s=Rt[rs];if(rs in ai)r.fp($s,ai[rs],this.showCollisionBoxes,Ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,gr,ts);else if($s.hasPattern&&($s instanceof r.ba||$s instanceof r.bb||$s instanceof r.e7)){O($s.layers,this.zoom,Wt.brightness,Ge,this.worldview);const ul=Object.fromEntries(ts.patternPositions);$s.addFeatures(Wt,this.tileID.canonical,ul,Ge,this.tileTransform,this.brightness)}}this.status="done",et(null,{buckets:Object.values(Rt).filter((rs=>!rs.isEmpty())),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:io.image,lineAtlas:un,imageAtlas:ts,brightness:Wt.brightness})};if(!this.extraShadowCaster){const ai=r.fj(Wt.glyphDependencies,(Hr=>Object.keys(Hr).map(Number)));Object.keys(ai).length?tt.send("getGlyphs",{uid:this.uid,stacks:ai},((Hr,ts)=>{Nr||(Nr=Hr,Ir=ts,jo())}),void 0,!1,ko):Ir={};const io=Array.from(Wt.iconDependencies.keys()).map((Hr=>r.I.parse(Hr)));io.length?tt.send("getImages",{images:io,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Hr,ts)=>{Nr||(Nr=Hr,gr=new Map,Vr=this.updateImageMapAndGetImageTaskQueue(gr,ts,Wt.iconDependencies),jo())}),void 0,!1,ko):(gr=new Map,Vr=new Map);const yi=Array.from(Wt.patternDependencies.keys()).map((Hr=>r.I.parse(Hr)));yi.length?tt.send("getImages",{images:yi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Hr,ts)=>{Nr||(Nr=Hr,wi=new Map,fo=this.updateImageMapAndGetImageTaskQueue(wi,ts,Wt.patternDependencies),jo())}),void 0,!1,ko):(wi=new Map,fo=new Map)}if(Wt.elevationFeatures&&Wt.elevationFeatures.length>0){const ai=[];for(const yi of Object.values(Rt))if(yi instanceof r.bb){const Hr=yi.getUnevaluatedPortalGraph();Hr&&ai.push(Hr)}const io=r.fk.evaluate(ai);for(const yi of Object.values(Rt))if(yi instanceof r.bb){const Hr=we.layers[Ct.decode(yi.sourceLayerIndex)];yi.setEvaluatedPortalGraph(io,Hr,this.tileID.canonical,Wt.availableImages,Wt.brightness)}}jo()};qn.length>0?Promise.allSettled(qn).then(fr).catch(et):fr()}rasterizeIfNeeded(we,Ie,Ge,it){Array.from(Ie.values()).some((tt=>tt.usvg))?this.rasterize(we,Ie,Ge,it):it()}updateImageMapAndGetImageTaskQueue(we,Ie,Ge){const it=new Map;for(const tt of Ie.keys()){const et=Ge.get(tt)||[];for(const Ct of et){const dt=Ct.toString(),Rt=Ie.get(Ct.id.toString());Rt.usvg?it.has(dt)||(it.set(dt,Ct),we.set(dt,Object.assign({},Rt))):we.set(dt,Rt)}}return it}rasterize(we,Ie,Ge,it){this.rasterizeTask=we.send("rasterizeImages",{scope:this.scope,tasks:Ge},((tt,et)=>{if(!tt)for(const[Ct,dt]of et.entries()){const Rt=Object.assign(Ie.get(Ct),{data:dt});Ie.set(Ct,Rt)}it()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function O(_t,we,Ie,Ge,it){const tt=new r.ac(we,{brightness:Ie,worldview:it});for(const et of _t)et.recalculate(tt,Ge)}class N extends r.E{constructor(we,Ie,Ge,it,tt,et,Ct){super(),this.actor=we,this.layerIndex=Ie,this.availableImages=Ge,this.availableModels=it,this.loadVectorData=et||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(we.scheduler),this.isSpriteLoaded=tt,this.scheduler=we.scheduler,this.brightness=Ct}loadTile(we,Ie){const Ge=we.uid,it=we&&we.request,tt=it&&it.collectResourceTiming,et=this.loading[Ge]=new D(we);et.abort=this.loadVectorData(we,((Ct,dt)=>{const Rt=!this.loading[Ge];if(delete this.loading[Ge],et.cancelRasterize(),Rt||Ct||!dt)return et.status="done",Rt||(this.loaded[Ge]=et),Ie(Ct);const un=dt.rawData,Wt={};dt.expires&&(Wt.expires=dt.expires),dt.cacheControl&&(Wt.cacheControl=dt.cacheControl),et.vectorTile=dt.vectorTile||new r.fq(new r.bt(un));const qn=()=>{et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((lr,fr)=>{if(lr||!fr)return Ie(lr);const Nr={};if(tt){const Ir=E(it);Ir.length>0&&(Nr.resourceTiming=JSON.parse(JSON.stringify(Ir)))}Ie(null,Object.assign({rawTileData:un.slice(0)},fr,Wt,Nr))}))};this.isSpriteLoaded?qn():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(qn,{type:"parseTile",isSymbolTile:we.isSymbolTile,zoom:we.tileZoom}):qn()})),this.loaded=this.loaded||{},this.loaded[Ge]=et}))}reloadTile(we,Ie){const Ge=this.loaded,it=we.uid;if(Ge&&Ge[it]){const tt=Ge[it];tt.scaleFactor=we.scaleFactor,tt.showCollisionBoxes=we.showCollisionBoxes,tt.projection=we.projection,tt.brightness=we.brightness,tt.tileTransform=r.aZ(we.tileID.canonical,we.projection),tt.extraShadowCaster=we.extraShadowCaster,tt.lut=we.lut,tt.worldview=we.worldview;const et=(Ct,dt)=>{const Rt=tt.reloadCallback;Rt&&(delete tt.reloadCallback,tt.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Rt)),Ie(Ct,dt)};tt.status==="parsing"?tt.reloadCallback=et:tt.status==="done"&&(tt.vectorTile?tt.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,et):et())}else Ie(null,void 0)}abortTile(we,Ie){const Ge=we.uid,it=this.loading[Ge];it&&(it.abort&&it.abort(),delete this.loading[Ge]),Ie()}removeTile(we,Ie){const Ge=this.loaded,it=we.uid;Ge&&Ge[it]&&delete Ge[it],Ie()}}class H{loadTile(we,Ie){const{uid:Ge,encoding:it,rawImageData:tt,padding:et}=we,Ct=ImageBitmap&&tt instanceof ImageBitmap?this.getImageData(tt,et):tt;Ie(null,new r.fr(Ge,Ct,it,et<1))}reloadTile(we,Ie){Ie(null,null)}abortTile(we,Ie){Ie()}removeTile(we,Ie){Ie()}getImageData(we,Ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(we.width,we.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=we.width,this.offscreenCanvas.height=we.height,this.offscreenCanvasContext.drawImage(we,0,0,we.width,we.height);const Ge=this.offscreenCanvasContext.getImageData(-Ie,-Ie,we.width+2*Ie,we.height+2*Ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ge}}r.bs.setPbf(r.bt);class j{constructor(we){this._mrt=new r.bs(we.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=we.uid,this.tileID=we.tileID,this.source=we.source}parse(we,Ie){const Ge=this._mrt;this.status="parsing",this._entireBuffer=we;try{Ge.parseHeader(we),this._isHeaderLoaded=!0;const it=[];for(const tt in Ge.layers){const et=Ge.getLayer(tt),Ct=et.getDataRange(et.getBandList()),dt=Ge.createDecodingTask(Ct),Rt=we.slice(Ct.firstByte,Ct.lastByte+1),un=r.bs.performDecoding(Rt,dt).then((Wt=>dt.complete(null,Wt))).catch((Wt=>dt.complete(Wt,null)));it.push(un)}Promise.allSettled(it).then((()=>Ie(null,Ge))).catch((tt=>Ie(tt)))}catch(it){Ie(it)}}}class V{constructor(we){this.actor=we,this.loading={},this.loaded={}}loadTile(we,Ie){const Ge=we.uid,it=we.request,tt=this.loading[Ge]=new j(we),{cancel:et}=r.bu(it,((Ct,dt,Rt,un)=>{const Wt=!this.loading[Ge];if(delete this.loading[Ge],Wt||Ct||!dt)return tt.status="done",Wt||(this.loaded[Ge]=tt),Ie(Ct);tt.parse(dt,((qn,lr)=>{if(qn||!lr)return Ie(qn);Ie(null,lr,Rt,un)})),this.loaded[Ge]=tt}));tt.abort=et}reloadTile(we,Ie){Ie(null,void 0)}abortTile(we,Ie){const Ge=we.uid,it=this.loading[Ge];it&&(it.abort&&it.abort(),delete this.loading[Ge]),Ie()}removeTile(we,Ie){const Ge=we.uid;this.loaded[Ge]&&delete this.loaded[Ge],Ie()}decodeRasterArray(we,Ie){r.bs.performDecoding(we.buffer,we.task).then((Ge=>Ie(null,Ge))).catch((Ge=>Ie(Ge)))}}const Z=r.fs.prototype.toGeoJSON;class X{constructor(we){this._feature=we,this.extent=r.al,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Ie of this._feature.geometry)we.push([new r.P(Ie[0],Ie[1])]);return we}{const we=[];for(const Ie of this._feature.geometry){const Ge=[];for(const it of Ie)Ge.push(new r.P(it[0],it[1]));we.push(Ge)}return we}}toGeoJSON(we,Ie,Ge){return Z.call(this,we,Ie,Ge)}}class se{constructor(we,Ie){this.name=we,this.extent=r.al,this.length=Ie.length,this._jsonFeatures=Ie}feature(we){return new X(this._jsonFeatures[we])}}class ge{constructor(we){this.layers={},this.extent=r.al;for(const Ie of Object.keys(we))this.layers[Ie]=new se(Ie,we[Ie])}}const ae=64/4096,oe=128;class fe{constructor(){this.features=new Map}clear(){this.features.clear()}load(we=[],Ie){for(const Ge of we){const it=Ge.id;if(it==null)continue;let tt=this.features.get(it);tt&&this.updateCache(tt,Ie),Ge.geometry?(tt=K(Ge),this.updateCache(tt,Ie),this.features.set(it,tt)):this.features.delete(it),this.updateCache(tt,Ie)}}updateCache(we,Ie){for(const{canonical:Ge,uid:it}of Object.values(Ie)){const{z:tt,x:et,y:Ct}=Ge;pe(we,Math.pow(2,tt),et,Ct)&&delete Ie[it]}}getTile(we,Ie,Ge){const it=Math.pow(2,we),tt=[];for(const et of this.features.values())pe(et,it,Ie,Ge)&&tt.push(Ae(et,it,Ie,Ge));return{features:tt}}getFeatures(){return[...this.features.values()]}}function pe({minX:_t,minY:we,maxX:Ie,maxY:Ge},it,tt,et){return _t<(tt+1+ae)/it&&we<(et+1+ae)/it&&Ie>(tt-ae)/it&&Ge>(et-ae)/it}function K(_t){const{id:we,geometry:Ie,properties:Ge}=_t;if(!Ie)return;if(Ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:it,coordinates:tt}=Ie,et={id:we,type:1,geometry:[],tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ct=et.geometry;if(it==="Point")ye(tt,Ct,et);else if(it==="MultiPoint")for(const dt of tt)ye(dt,Ct,et);else if(it==="LineString")et.type=2,J(tt,Ct,et);else if(it==="MultiLineString")et.type=2,de(tt,Ct,et);else if(it==="Polygon")et.type=3,de(tt,Ct,et,!0);else{if(it!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");et.type=3;for(const dt of tt)de(dt,Ct,et,!0)}return et}function ye([_t,we],Ie,Ge){const it=r.aF(_t);let tt=r.aJ(we);tt=tt<0?0:tt>1?1:tt,Ie.push(it,tt),Ge.minX=Math.min(Ge.minX,it),Ge.minY=Math.min(Ge.minY,tt),Ge.maxX=Math.max(Ge.maxX,it),Ge.maxY=Math.max(Ge.maxY,tt)}function J(_t,we,Ie,Ge=!1,it=!1){const tt=[];for(const et of _t)ye(et,tt,Ie);we.push(tt),Ge&&(function(et,Ct){let dt=0;for(let Rt=0,un=et.length,Wt=un-2;Rt<un;Wt=Rt,Rt+=2)dt+=(et[Rt]-et[Wt])*(et[Rt+1]+et[Wt+1]);if(dt>0===Ct)for(let Rt=0,un=et.length;Rt<un/2;Rt+=2){const Wt=et[Rt],qn=et[Rt+1];et[Rt]=et[un-2-Rt],et[Rt+1]=et[un-1-Rt],et[un-2-Rt]=Wt,et[un-1-Rt]=qn}})(tt,it)}function de(_t,we,Ie,Ge=!1){for(let it=0;it<_t.length;it++)J(_t[it],we,Ie,Ge,it===0)}function Ae(_t,we,Ie,Ge){const{id:it,type:tt,geometry:et,tags:Ct}=_t,dt=[];if(tt===1)(function(Rt,un,Wt,qn,lr){for(let fr=0;fr<Rt.length;fr+=2){const Nr=Math.round(r.al*(Rt[fr+0]*un-Wt)),Ir=Math.round(r.al*(Rt[fr+1]*un-qn));lr.push([Nr,Ir])}})(et,we,Ie,Ge,dt);else for(const Rt of et)ne(Rt,we,Ie,Ge,dt);return{id:it,type:tt,geometry:dt,tags:Ct}}function ne(_t,we,Ie,Ge,it){const tt=-oe,et=r.al+oe;let Ct;for(let dt=0;dt<_t.length-2;dt+=2){let Rt=Math.round(r.al*(_t[dt+0]*we-Ie)),un=Math.round(r.al*(_t[dt+1]*we-Ge)),Wt=Math.round(r.al*(_t[dt+2]*we-Ie)),qn=Math.round(r.al*(_t[dt+3]*we-Ge));const lr=Wt-Rt,fr=qn-un;Rt<tt&&Wt<tt||(Rt<tt?(un+=Math.round(fr*((tt-Rt)/lr)),Rt=tt):Wt<tt&&(qn=un+Math.round(fr*((tt-Rt)/lr)),Wt=tt),un<tt&&qn<tt||(un<tt?(Rt+=Math.round(lr*((tt-un)/fr)),un=tt):qn<tt&&(Wt=Rt+Math.round(lr*((tt-un)/fr)),qn=tt),Rt>=et&&Wt>=et||(Rt>=et?(un+=Math.round(fr*((et-Rt)/lr)),Rt=et):Wt>=et&&(qn=un+Math.round(fr*((et-Rt)/lr)),Wt=et),un>=et&&qn>=et||(un>=et?(Rt+=Math.round(lr*((et-un)/fr)),un=et):qn>=et&&(Wt=Rt+Math.round(lr*((et-un)/fr)),qn=et),Ct&&Rt===Ct[Ct.length-1][0]&&un===Ct[Ct.length-1][1]||(Ct=[[Rt,un]],it.push(Ct)),Ct.push([Wt,qn])))))}}function xe({name:_t,features:we},Ie){Ie.writeStringField(1,_t),Ie.writeVarintField(5,r.al);const Ge=new Map,it=new Map,tt={keys:Ge,values:it,feature:null};for(const et of we)tt.feature=et,Ie.writeMessage(2,Ce,tt);for(const et of Ge.keys())Ie.writeStringField(3,et);for(const et of it.keys())Ie.writeMessage(4,at,et)}function Ce(_t,we){const Ie=_t.feature;Ie.id!==void 0&&Number.isSafeInteger(+Ie.id)&&we.writeVarintField(1,+Ie.id),Ie.tags&&we.writeMessage(2,Re,_t),we.writeVarintField(3,Ie.type),we.writeMessage(4,Be,Ie)}function Re({keys:_t,values:we,feature:Ie},Ge){for(const it of Object.keys(Ie.tags)){let tt=Ie.tags[it];if(tt===null)continue;let et=_t.get(it);et===void 0&&(et=_t.size,_t.set(it,et)),Ge.writeVarint(et);const Ct=typeof tt;Ct!=="string"&&Ct!=="boolean"&&Ct!=="number"&&(tt=JSON.stringify(tt));let dt=we.get(tt);dt===void 0&&(dt=we.size,we.set(tt,dt)),Ge.writeVarint(dt)}}function Ee(_t,we){return(we<<3)+(7&_t)}function Oe(_t){return _t<<1^_t>>31}function Be(_t,we){const{geometry:Ie,type:Ge}=_t;let it=0,tt=0;if(Ge===1){we.writeVarint(Ee(1,Ie.length));for(const et of Ie){const Ct=et[0]-it,dt=et[1]-tt;we.writeVarint(Oe(Ct)),we.writeVarint(Oe(dt)),it+=Ct,tt+=dt}}else for(const et of Ie){we.writeVarint(Ee(1,1));const Ct=et.length-(Ge===3?1:0);for(let dt=0;dt<Ct;dt++){dt===1&&we.writeVarint(Ee(2,Ct-1));const Rt=et[dt][0]-it,un=et[dt][1]-tt;we.writeVarint(Oe(Rt)),we.writeVarint(Oe(un)),it+=Rt,tt+=un}Ge===3&&we.writeVarint(Ee(7,1))}}function at(_t,we){const Ie=typeof _t;Ie==="string"?we.writeStringField(1,_t):Ie==="boolean"?we.writeBooleanField(7,_t):Ie==="number"&&(_t%1!=0?we.writeDoubleField(3,_t):_t<0?we.writeSVarintField(6,_t):we.writeVarintField(5,_t))}const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_t=>_t},nt=Math.fround||($e=new Float32Array(1),_t=>($e[0]=+_t,$e[0]));var $e;const ct=3,At=5,xt=6;class It{constructor(we){this.options=Object.assign(Object.create(ut),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:Ie,minZoom:Ge,maxZoom:it}=this.options;Ie&&console.time("total time");const tt=`prepare ${we.length} points`;Ie&&console.time(tt),this.points=we;const et=[];for(let dt=0;dt<we.length;dt++){const Rt=we[dt];if(!Rt.geometry)continue;const[un,Wt]=Rt.geometry.coordinates,qn=nt(Se(un)),lr=nt(mt(Wt));et.push(qn,lr,1/0,dt,-1,1),this.options.reduce&&et.push(0)}let Ct=this.trees[it+1]=this._createTree(et);Ie&&console.timeEnd(tt);for(let dt=it;dt>=Ge;dt--){const Rt=+Date.now();Ct=this.trees[dt]=this._createTree(this._cluster(Ct,dt)),Ie&&console.log("z%d: %d clusters in %dms",dt,Ct.numItems,+Date.now()-Rt)}return Ie&&console.timeEnd("total time"),this}getClusters(we,Ie){let Ge=((we[0]+180)%360+360)%360-180;const it=Math.max(-90,Math.min(90,we[1]));let tt=we[2]===180?180:((we[2]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)Ge=-180,tt=180;else if(Ge>tt){const Wt=this.getClusters([Ge,it,180,et],Ie),qn=this.getClusters([-180,it,tt,et],Ie);return Wt.concat(qn)}const Ct=this.trees[this._limitZoom(Ie)],dt=Ct.range(Se(Ge),mt(et),Se(tt),mt(it)),Rt=Ct.data,un=[];for(const Wt of dt){const qn=this.stride*Wt;un.push(Rt[qn+At]>1?jt(Rt,qn,this.clusterProps):this.points[Rt[qn+ct]])}return un}getChildren(we){const Ie=this._getOriginId(we),Ge=this._getOriginZoom(we),it="No cluster with the specified id.",tt=this.trees[Ge];if(!tt)throw new Error(it);const et=tt.data;if(Ie*this.stride>=et.length)throw new Error(it);const Ct=this.options.radius/(this.options.extent*Math.pow(2,Ge-1)),dt=tt.within(et[Ie*this.stride],et[Ie*this.stride+1],Ct),Rt=[];for(const un of dt){const Wt=un*this.stride;et[Wt+4]===we&&Rt.push(et[Wt+At]>1?jt(et,Wt,this.clusterProps):this.points[et[Wt+ct]])}if(Rt.length===0)throw new Error(it);return Rt}getLeaves(we,Ie,Ge){const it=[];return this._appendLeaves(it,we,Ie=Ie||10,Ge=Ge||0,0),it}getTile(we,Ie,Ge){const it=this.trees[this._limitZoom(we)],tt=Math.pow(2,we),{extent:et,radius:Ct}=this.options,dt=Ct/et,Rt=(Ge-dt)/tt,un=(Ge+1+dt)/tt,Wt={features:[]};return this._addTileFeatures(it.range((Ie-dt)/tt,Rt,(Ie+1+dt)/tt,un),it.data,Ie,Ge,tt,Wt),Ie===0&&this._addTileFeatures(it.range(1-dt/tt,Rt,1,un),it.data,tt,Ge,tt,Wt),Ie===tt-1&&this._addTileFeatures(it.range(0,Rt,dt/tt,un),it.data,-1,Ge,tt,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(we){let Ie=this._getOriginZoom(we)-1;for(;Ie<=this.options.maxZoom;){const Ge=this.getChildren(we);if(Ie++,Ge.length!==1)break;we=Ge[0].properties.cluster_id}return Ie}_appendLeaves(we,Ie,Ge,it,tt){const et=this.getChildren(Ie);for(const Ct of et){const dt=Ct.properties;if(dt&&dt.cluster?tt+dt.point_count<=it?tt+=dt.point_count:tt=this._appendLeaves(we,dt.cluster_id,Ge,it,tt):tt<it?tt++:we.push(Ct),we.length===Ge)break}return tt}_createTree(we){const Ie=new r.c3(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ge=0;Ge<we.length;Ge+=this.stride)Ie.add(we[Ge],we[Ge+1]);return Ie.finish(),Ie.data=we,Ie}_addTileFeatures(we,Ie,Ge,it,tt,et){for(const Ct of we){const dt=Ct*this.stride,Rt=Ie[dt+At]>1;let un,Wt,qn;if(Rt)un=cn(Ie,dt,this.clusterProps),Wt=Ie[dt],qn=Ie[dt+1];else{const Nr=this.points[Ie[dt+ct]];un=Nr.properties;const[Ir,gr]=Nr.geometry.coordinates;Wt=Se(Ir),qn=mt(gr)}const lr={type:1,geometry:[[Math.round(this.options.extent*(Wt*tt-Ge)),Math.round(this.options.extent*(qn*tt-it))]],tags:un};let fr;fr=Rt||this.options.generateId?Ie[dt+ct]:this.points[Ie[dt+ct]].id,fr!==void 0&&(lr.id=fr),et.features.push(lr)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,Ie){const{radius:Ge,extent:it,reduce:tt,minPoints:et}=this.options,Ct=Ge/(it*Math.pow(2,Ie)),dt=we.data,Rt=[],un=this.stride;for(let Wt=0;Wt<dt.length;Wt+=un){if(dt[Wt+2]<=Ie)continue;dt[Wt+2]=Ie;const qn=dt[Wt],lr=dt[Wt+1],fr=we.within(dt[Wt],dt[Wt+1],Ct),Nr=dt[Wt+At];let Ir=Nr;for(const gr of fr){const wi=gr*un;dt[wi+2]>Ie&&(Ir+=dt[wi+At])}if(Ir>Nr&&Ir>=et){let gr,wi=qn*Nr,Vr=lr*Nr,fo=-1;const ko=(Wt/un<<5)+(Ie+1)+this.points.length;for(const jo of fr){const bi=jo*un;if(dt[bi+2]<=Ie)continue;dt[bi+2]=Ie;const ai=dt[bi+At];wi+=dt[bi]*ai,Vr+=dt[bi+1]*ai,dt[bi+4]=ko,tt&&(gr||(gr=this._map(dt,Wt,!0),fo=this.clusterProps.length,this.clusterProps.push(gr)),tt(gr,this._map(dt,bi)))}dt[Wt+4]=ko,Rt.push(wi/Ir,Vr/Ir,1/0,ko,-1,Ir),tt&&Rt.push(fo)}else{for(let gr=0;gr<un;gr++)Rt.push(dt[Wt+gr]);if(Ir>1)for(const gr of fr){const wi=gr*un;if(!(dt[wi+2]<=Ie)){dt[wi+2]=Ie;for(let Vr=0;Vr<un;Vr++)Rt.push(dt[wi+Vr])}}}}return Rt}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,Ie,Ge){if(we[Ie+At]>1){const et=this.clusterProps[we[Ie+xt]];return Ge?Object.assign({},et):et}const it=this.points[we[Ie+ct]].properties,tt=this.options.map(it);return Ge&&tt===it?Object.assign({},tt):tt}}function jt(_t,we,Ie){return{type:"Feature",id:_t[we+ct],properties:cn(_t,we,Ie),geometry:{type:"Point",coordinates:[(Ge=_t[we],360*(Ge-.5)),Ke(_t[we+1])]}};var Ge}function cn(_t,we,Ie){const Ge=_t[we+At],it=Ge>=1e4?`${Math.round(Ge/1e3)}k`:Ge>=1e3?Math.round(Ge/100)/10+"k":Ge,tt=_t[we+xt],et=tt===-1?{}:Object.assign({},Ie[tt]);return Object.assign(et,{cluster:!0,cluster_id:_t[we+ct],point_count:Ge,point_count_abbreviated:it})}function Se(_t){return _t/360+.5}function mt(_t){const we=Math.sin(_t*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Ke(_t){const we=(180-360*_t)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function Ue(_t,we,Ie,Ge){let it=Ge;const tt=we+(Ie-we>>1);let et,Ct=Ie-we;const dt=_t[we],Rt=_t[we+1],un=_t[Ie],Wt=_t[Ie+1];for(let qn=we+3;qn<Ie;qn+=3){const lr=je(_t[qn],_t[qn+1],dt,Rt,un,Wt);if(lr>it)et=qn,it=lr;else if(lr===it){const fr=Math.abs(qn-tt);fr<Ct&&(et=qn,Ct=fr)}}it>Ge&&(et-we>3&&Ue(_t,we,et,Ge),_t[et+2]=it,Ie-et>3&&Ue(_t,et,Ie,Ge))}function je(_t,we,Ie,Ge,it,tt){let et=it-Ie,Ct=tt-Ge;if(et!==0||Ct!==0){const dt=((_t-Ie)*et+(we-Ge)*Ct)/(et*et+Ct*Ct);dt>1?(Ie=it,Ge=tt):dt>0&&(Ie+=et*dt,Ge+=Ct*dt)}return et=_t-Ie,Ct=we-Ge,et*et+Ct*Ct}function gt(_t,we,Ie,Ge){const it={id:_t??null,type:we,geometry:Ie,tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(we==="Point"||we==="MultiPoint"||we==="LineString")Ot(it,Ie);else if(we==="Polygon")Ot(it,Ie[0]);else if(we==="MultiLineString")for(const tt of Ie)Ot(it,tt);else if(we==="MultiPolygon")for(const tt of Ie)Ot(it,tt[0]);return it}function Ot(_t,we){for(let Ie=0;Ie<we.length;Ie+=3)_t.minX=Math.min(_t.minX,we[Ie]),_t.minY=Math.min(_t.minY,we[Ie+1]),_t.maxX=Math.max(_t.maxX,we[Ie]),_t.maxY=Math.max(_t.maxY,we[Ie+1])}function Ft(_t,we,Ie,Ge){if(!we.geometry)return;const it=we.geometry.coordinates;if(it&&it.length===0)return;const tt=we.geometry.type,et=Math.pow(Ie.tolerance/((1<<Ie.maxZoom)*Ie.extent),2);let Ct=[],dt=we.id;if(Ie.promoteId?dt=we.properties[Ie.promoteId]:Ie.generateId&&(dt=Ge||0),tt==="Point")pt(it,Ct);else if(tt==="MultiPoint")for(const Rt of it)pt(Rt,Ct);else if(tt==="LineString")dn(it,Ct,et,!1);else if(tt==="MultiLineString"){if(Ie.lineMetrics){for(const Rt of it)Ct=[],dn(Rt,Ct,et,!1),_t.push(gt(dt,"LineString",Ct,we.properties));return}An(it,Ct,et,!1)}else if(tt==="Polygon")An(it,Ct,et,!0);else{if(tt!=="MultiPolygon"){if(tt==="GeometryCollection"){for(const Rt of we.geometry.geometries)Ft(_t,{id:dt,geometry:Rt,properties:we.properties},Ie,Ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Rt of it){const un=[];An(Rt,un,et,!0),Ct.push(un)}}_t.push(gt(dt,tt,Ct,we.properties))}function pt(_t,we){we.push(Gt(_t[0]),Yt(_t[1]),0)}function dn(_t,we,Ie,Ge){let it,tt,et=0;for(let dt=0;dt<_t.length;dt++){const Rt=Gt(_t[dt][0]),un=Yt(_t[dt][1]);we.push(Rt,un,0),dt>0&&(et+=Ge?(it*un-Rt*tt)/2:Math.sqrt(Math.pow(Rt-it,2)+Math.pow(un-tt,2))),it=Rt,tt=un}const Ct=we.length-3;we[2]=1,Ue(we,0,Ct,Ie),we[Ct+2]=1,we.size=Math.abs(et),we.start=0,we.end=we.size}function An(_t,we,Ie,Ge){for(let it=0;it<_t.length;it++){const tt=[];dn(_t[it],tt,Ie,Ge),we.push(tt)}}function Gt(_t){return _t/360+.5}function Yt(_t){const we=Math.sin(_t*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function zn(_t,we,Ie,Ge,it,tt,et,Ct){if(Ge/=we,tt>=(Ie/=we)&&et<Ge)return _t;if(et<Ie||tt>=Ge)return null;const dt=[];for(const Rt of _t){const un=Rt.geometry;let Wt=Rt.type;const qn=it===0?Rt.minX:Rt.minY,lr=it===0?Rt.maxX:Rt.maxY;if(qn>=Ie&&lr<Ge){dt.push(Rt);continue}if(lr<Ie||qn>=Ge)continue;let fr=[];if(Wt==="Point"||Wt==="MultiPoint")$n(un,fr,Ie,Ge,it);else if(Wt==="LineString")On(un,fr,Ie,Ge,it,!1,Ct.lineMetrics);else if(Wt==="MultiLineString")kn(un,fr,Ie,Ge,it,!1);else if(Wt==="Polygon")kn(un,fr,Ie,Ge,it,!0);else if(Wt==="MultiPolygon")for(const Nr of un){const Ir=[];kn(Nr,Ir,Ie,Ge,it,!0),Ir.length&&fr.push(Ir)}if(fr.length){if(Ct.lineMetrics&&Wt==="LineString"){for(const Nr of fr)dt.push(gt(Rt.id,Wt,Nr,Rt.tags));continue}Wt!=="LineString"&&Wt!=="MultiLineString"||(fr.length===1?(Wt="LineString",fr=fr[0]):Wt="MultiLineString"),Wt!=="Point"&&Wt!=="MultiPoint"||(Wt=fr.length===3?"Point":"MultiPoint"),dt.push(gt(Rt.id,Wt,fr,Rt.tags))}}return dt.length?dt:null}function $n(_t,we,Ie,Ge,it){for(let tt=0;tt<_t.length;tt+=3){const et=_t[tt+it];et>=Ie&&et<=Ge&&Pr(we,_t[tt],_t[tt+1],_t[tt+2])}}function On(_t,we,Ie,Ge,it,tt,et){let Ct=Bn(_t);const dt=it===0?mr:ni;let Rt,un,Wt=_t.start;for(let Ir=0;Ir<_t.length-3;Ir+=3){const gr=_t[Ir],wi=_t[Ir+1],Vr=_t[Ir+2],fo=_t[Ir+3],ko=_t[Ir+4],jo=it===0?gr:wi,bi=it===0?fo:ko;let ai=!1;et&&(Rt=Math.sqrt(Math.pow(gr-fo,2)+Math.pow(wi-ko,2))),jo<Ie?bi>Ie&&(un=dt(Ct,gr,wi,fo,ko,Ie),et&&(Ct.start=Wt+Rt*un)):jo>Ge?bi<Ge&&(un=dt(Ct,gr,wi,fo,ko,Ge),et&&(Ct.start=Wt+Rt*un)):Pr(Ct,gr,wi,Vr),bi<Ie&&jo>=Ie&&(un=dt(Ct,gr,wi,fo,ko,Ie),ai=!0),bi>Ge&&jo<=Ge&&(un=dt(Ct,gr,wi,fo,ko,Ge),ai=!0),!tt&&ai&&(et&&(Ct.end=Wt+Rt*un),we.push(Ct),Ct=Bn(_t)),et&&(Wt+=Rt)}let qn=_t.length-3;const lr=_t[qn],fr=_t[qn+1],Nr=it===0?lr:fr;Nr>=Ie&&Nr<=Ge&&Pr(Ct,lr,fr,_t[qn+2]),qn=Ct.length-3,tt&&qn>=3&&(Ct[qn]!==Ct[0]||Ct[qn+1]!==Ct[1])&&Pr(Ct,Ct[0],Ct[1],Ct[2]),Ct.length&&we.push(Ct)}function Bn(_t){const we=[];return we.size=_t.size,we.start=_t.start,we.end=_t.end,we}function kn(_t,we,Ie,Ge,it,tt){for(const et of _t)On(et,we,Ie,Ge,it,tt,!1)}function Pr(_t,we,Ie,Ge){_t.push(we,Ie,Ge)}function mr(_t,we,Ie,Ge,it,tt){const et=(tt-we)/(Ge-we);return Pr(_t,tt,Ie+(it-Ie)*et,1),et}function ni(_t,we,Ie,Ge,it,tt){const et=(tt-Ie)/(it-Ie);return Pr(_t,we+(Ge-we)*et,tt,1),et}function tr(_t,we){const Ie=[];for(let Ge=0;Ge<_t.length;Ge++){const it=_t[Ge],tt=it.type;let et;if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")et=Br(it.geometry,we);else if(tt==="MultiLineString"||tt==="Polygon"){et=[];for(const Ct of it.geometry)et.push(Br(Ct,we))}else if(tt==="MultiPolygon"){et=[];for(const Ct of it.geometry){const dt=[];for(const Rt of Ct)dt.push(Br(Rt,we));et.push(dt)}}Ie.push(gt(it.id,tt,et,it.tags))}return Ie}function Br(_t,we){const Ie=[];Ie.size=_t.size,_t.start!==void 0&&(Ie.start=_t.start,Ie.end=_t.end);for(let Ge=0;Ge<_t.length;Ge+=3)Ie.push(_t[Ge]+we,_t[Ge+1],_t[Ge+2]);return Ie}function Tr(_t,we){if(_t.transformed)return _t;const Ie=1<<_t.z,Ge=_t.x,it=_t.y;for(const tt of _t.features){const et=tt.geometry,Ct=tt.type;if(tt.geometry=[],Ct===1)for(let dt=0;dt<et.length;dt+=2)tt.geometry.push(Fr(et[dt],et[dt+1],we,Ie,Ge,it));else for(let dt=0;dt<et.length;dt++){const Rt=[];for(let un=0;un<et[dt].length;un+=2)Rt.push(Fr(et[dt][un],et[dt][un+1],we,Ie,Ge,it));tt.geometry.push(Rt)}}return _t.transformed=!0,_t}function Fr(_t,we,Ie,Ge,it,tt){return[Math.round(Ie*(_t*Ge-it)),Math.round(Ie*(we*Ge-tt))]}function di(_t,we,Ie,Ge,it){const tt=we===it.maxZoom?0:it.tolerance/((1<<we)*it.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:_t.length,source:null,x:Ie,y:Ge,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ct of _t)Mo(et,Ct,tt,it);return et}function Mo(_t,we,Ie,Ge){const it=we.geometry,tt=we.type,et=[];if(_t.minX=Math.min(_t.minX,we.minX),_t.minY=Math.min(_t.minY,we.minY),_t.maxX=Math.max(_t.maxX,we.maxX),_t.maxY=Math.max(_t.maxY,we.maxY),tt==="Point"||tt==="MultiPoint")for(let Ct=0;Ct<it.length;Ct+=3)et.push(it[Ct],it[Ct+1]),_t.numPoints++,_t.numSimplified++;else if(tt==="LineString")ds(et,it,_t,Ie,!1,!1);else if(tt==="MultiLineString"||tt==="Polygon")for(let Ct=0;Ct<it.length;Ct++)ds(et,it[Ct],_t,Ie,tt==="Polygon",Ct===0);else if(tt==="MultiPolygon")for(let Ct=0;Ct<it.length;Ct++){const dt=it[Ct];for(let Rt=0;Rt<dt.length;Rt++)ds(et,dt[Rt],_t,Ie,!0,Rt===0)}if(et.length){let Ct=we.tags||null;if(tt==="LineString"&&Ge.lineMetrics){Ct={};for(const Rt in we.tags)Ct[Rt]=we.tags[Rt];Ct.mapbox_clip_start=it.start/it.size,Ct.mapbox_clip_end=it.end/it.size}const dt={geometry:et,type:tt==="Polygon"||tt==="MultiPolygon"?3:tt==="LineString"||tt==="MultiLineString"?2:1,tags:Ct};we.id!==null&&(dt.id=we.id),_t.features.push(dt)}}function ds(_t,we,Ie,Ge,it,tt){const et=Ge*Ge;if(Ge>0&&we.size<(it?et:Ge))return void(Ie.numPoints+=we.length/3);const Ct=[];for(let dt=0;dt<we.length;dt+=3)(Ge===0||we[dt+2]>et)&&(Ie.numSimplified++,Ct.push(we[dt],we[dt+1])),Ie.numPoints++;it&&(function(dt,Rt){let un=0;for(let Wt=0,qn=dt.length,lr=qn-2;Wt<qn;lr=Wt,Wt+=2)un+=(dt[Wt]-dt[lr])*(dt[Wt+1]+dt[lr+1]);if(un>0===Rt)for(let Wt=0,qn=dt.length;Wt<qn/2;Wt+=2){const lr=dt[Wt],fr=dt[Wt+1];dt[Wt]=dt[qn-2-Wt],dt[Wt+1]=dt[qn-1-Wt],dt[qn-2-Wt]=lr,dt[qn-1-Wt]=fr}})(Ct,tt),_t.push(Ct)}const Yr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class co{constructor(we,Ie){const Ge=(Ie=this.options=(function(tt,et){for(const Ct in et)tt[Ct]=et[Ct];return tt})(Object.create(Yr),Ie)).debug;if(Ge&&console.time("preprocess data"),Ie.maxZoom<0||Ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ie.promoteId&&Ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let it=(function(tt,et){const Ct=[];if(tt.type==="FeatureCollection")for(let dt=0;dt<tt.features.length;dt++)Ft(Ct,tt.features[dt],et,dt);else Ft(Ct,tt.type==="Feature"?tt:{geometry:tt},et);return Ct})(we,Ie);this.tiles={},this.tileCoords=[],Ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ie.indexMaxZoom,Ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),it=(function(tt,et){const Ct=et.buffer/et.extent;let dt=tt;const Rt=zn(tt,1,-1-Ct,Ct,0,-1,2,et),un=zn(tt,1,1-Ct,2+Ct,0,-1,2,et);return(Rt||un)&&(dt=zn(tt,1,-Ct,1+Ct,0,-1,2,et)||[],Rt&&(dt=tr(Rt,1).concat(dt)),un&&(dt=dt.concat(tr(un,-1)))),dt})(it,Ie),it.length&&this.splitTile(it,0,0,0),Ge&&(it.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(we,Ie,Ge,it,tt,et,Ct){const dt=[we,Ie,Ge,it],Rt=this.options,un=Rt.debug;for(;dt.length;){it=dt.pop(),Ge=dt.pop(),Ie=dt.pop(),we=dt.pop();const Wt=1<<Ie,qn=ya(Ie,Ge,it);let lr=this.tiles[qn];if(!lr&&(un>1&&console.time("creation"),lr=this.tiles[qn]=di(we,Ie,Ge,it,Rt),this.tileCoords.push({z:Ie,x:Ge,y:it}),un)){un>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ie,Ge,it,lr.numFeatures,lr.numPoints,lr.numSimplified),console.timeEnd("creation"));const ai=`z${Ie}`;this.stats[ai]=(this.stats[ai]||0)+1,this.total++}if(lr.source=we,tt==null){if(Ie===Rt.indexMaxZoom||lr.numPoints<=Rt.indexMaxPoints)continue}else{if(Ie===Rt.maxZoom||Ie===tt)continue;if(tt!=null){const ai=tt-Ie;if(Ge!==et>>ai||it!==Ct>>ai)continue}}if(lr.source=null,we.length===0)continue;un>1&&console.time("clipping");const fr=.5*Rt.buffer/Rt.extent,Nr=.5-fr,Ir=.5+fr,gr=1+fr;let wi=null,Vr=null,fo=null,ko=null,jo=zn(we,Wt,Ge-fr,Ge+Ir,0,lr.minX,lr.maxX,Rt),bi=zn(we,Wt,Ge+Nr,Ge+gr,0,lr.minX,lr.maxX,Rt);we=null,jo&&(wi=zn(jo,Wt,it-fr,it+Ir,1,lr.minY,lr.maxY,Rt),Vr=zn(jo,Wt,it+Nr,it+gr,1,lr.minY,lr.maxY,Rt),jo=null),bi&&(fo=zn(bi,Wt,it-fr,it+Ir,1,lr.minY,lr.maxY,Rt),ko=zn(bi,Wt,it+Nr,it+gr,1,lr.minY,lr.maxY,Rt),bi=null),un>1&&console.timeEnd("clipping"),dt.push(wi||[],Ie+1,2*Ge,2*it),dt.push(Vr||[],Ie+1,2*Ge,2*it+1),dt.push(fo||[],Ie+1,2*Ge+1,2*it),dt.push(ko||[],Ie+1,2*Ge+1,2*it+1)}}getTile(we,Ie,Ge){we=+we,Ie=+Ie,Ge=+Ge;const it=this.options,{extent:tt,debug:et}=it;if(we<0||we>24)return null;const Ct=1<<we,dt=ya(we,Ie=Ie+Ct&Ct-1,Ge);if(this.tiles[dt])return Tr(this.tiles[dt],tt);et>1&&console.log("drilling down to z%d-%d-%d",we,Ie,Ge);let Rt,un=we,Wt=Ie,qn=Ge;for(;!Rt&&un>0;)un--,Wt>>=1,qn>>=1,Rt=this.tiles[ya(un,Wt,qn)];return Rt&&Rt.source?(et>1&&(console.log("found parent tile z%d-%d-%d",un,Wt,qn),console.time("drilling down")),this.splitTile(Rt.source,un,Wt,qn,we,Ie,Ge),et>1&&console.timeEnd("drilling down"),this.tiles[dt]?Tr(this.tiles[dt],tt):null):null}}function ya(_t,we,Ie){return 32*((1<<_t)*Ie+we)+_t}function cl(_t,we){const Ie=_t.tileID.canonical;if(!this._geoJSONIndex)return void we(null,null);const Ge=this._geoJSONIndex.getTile(Ie.z,Ie.x,Ie.y);if(!Ge)return void we(null,null);const it=Rt=>Rt.tags&&"3d_elevation_id"in Rt.tags&&"source"in Rt.tags&&Rt.tags.source==="elevation",tt=Ge.features.filter((Rt=>it(Rt)));let et={_geojsonTileLayer:Ge.features};tt.length>0&&(et={_geojsonTileLayer:Ge.features.filter((Rt=>!it(Rt))),hd_road_elevation:tt});const Ct=new ge(et),dt=(function(Rt){const un=new r.bt;for(const Wt of Object.keys(Rt))un.writeMessage(3,xe,{name:Wt,features:Rt[Wt]});return un.finish()})(et).buffer;we(null,{vectorTile:Ct,rawData:dt})}class Kt extends N{constructor(we,Ie,Ge,it,tt,et,Ct){super(we,Ie,Ge,it,tt,cl,Ct),et&&(this.loadGeoJSON=et),this._dynamicIndex=new fe}loadData(we,Ie){const Ge=we&&we.request,it=Ge&&Ge.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(we,((tt,et)=>{if(tt||!et)return Ie(tt);if(typeof et!="object")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));{try{if(we.filter){const dt=r.U(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(dt.result==="error")throw new Error(dt.value.map((Rt=>`${Rt.key}: ${Rt.message}`)).join(", "));et.features=et.features.filter((Rt=>dt.value.evaluate({zoom:0},Rt)))}we.dynamic?(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),we.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(et.features,this.loaded),we.cluster&&(et.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=we.cluster?new It((function({superclusterOptions:dt,clusterProperties:Rt}){if(!Rt||!dt)return dt;const un={},Wt={},qn={accumulated:null,zoom:0},lr={properties:null},fr=Object.keys(Rt);for(const Nr of fr){const[Ir,gr]=Rt[Nr],wi=r.U(gr),Vr=r.U(typeof Ir=="string"?[Ir,["accumulated"],["get",Nr]]:Ir);un[Nr]=wi.value,Wt[Nr]=Vr.value}return dt.map=Nr=>{lr.properties=Nr;const Ir={};for(const gr of fr)Ir[gr]=un[gr].evaluate(qn,lr);return Ir},dt.reduce=(Nr,Ir)=>{lr.properties=Ir;for(const gr of fr)qn.accumulated=Nr[gr],Nr[gr]=Wt[gr].evaluate(qn,lr)},dt})(we)).load(et.features):we.dynamic?this._dynamicIndex:(function(dt,Rt){return new co(dt,Rt)})(et,we.geojsonVtOptions)}catch(dt){return Ie(dt)}const Ct={};if(it){const dt=E(Ge);dt&&(Ct.resourceTiming={},Ct.resourceTiming[we.source]=JSON.parse(JSON.stringify(dt)))}Ie(null,Ct)}}))}reloadTile(we,Ie){const Ge=this.loaded;return Ge&&Ge[we.uid]?we.partial?Ie(null,void 0):super.reloadTile(we,Ie):this.loadTile(we,Ie)}loadGeoJSON(we,Ie){if(we.request)r.m(we.request,Ie);else{if(typeof we.data!="string")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return Ie(null,JSON.parse(we.data))}catch{return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(we,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(we.clusterId))}catch(Ge){Ie(Ge)}}getClusterChildren(we,Ie){try{Ie(null,this._geoJSONIndex.getChildren(we.clusterId))}catch(Ge){Ie(Ge)}}getClusterLeaves(we,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset))}catch(Ge){Ie(Ge)}}}class yo{constructor(we,Ie,Ge){this.tileID=new r.aO(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=we.projection,this.brightness=Ie,this.worldview=Ge}parse(we,Ie,Ge,it){this.status="parsing";const tt=new r.aO(Ge.tileID.overscaledZ,Ge.tileID.wrap,Ge.tileID.canonical.z,Ge.tileID.canonical.x,Ge.tileID.canonical.y),et=[],Ct=Ie.familiesBySource[Ge.source],dt=new r.fe(tt,Ge.promoteId);dt.bucketLayerIDs=[],dt.is3DTile=!0,r.ft(we).then((Rt=>{if(!Rt)return it(new Error("Could not parse tile"));const un=Rt.json.extensionsUsed&&Rt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Rt.json.asset.extras&&Rt.json.asset.extras.MAPBOX_mesh_features,Wt=Rt.json.extensionsUsed&&Rt.json.extensionsUsed.includes("EXT_meshopt_compression"),qn=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const lr in Ct)for(const fr of Ct[lr]){const Nr=fr[0];dt.bucketLayerIDs.push(fr.map((wi=>r.B(wi.id,wi.scope)))),Nr.recalculate(qn,[]);const Ir=r.fu(Rt,1/r.d6(Ge.tileID.canonical)),gr=new r.fv(fr,Ir,tt,un,Wt,this.brightness,dt,this.worldview);un||(gr.needsUpload=!0),et.push(gr),gr.evaluate(Nr)}this.status="done",it(null,{buckets:et,featureIndex:dt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Rt=>it(new Error(Rt.message))))}}class ca{constructor(we,Ie,Ge,it,tt,et,Ct,dt){this.actor=we,this.layerIndex=Ie,this.availableImages=Ge,this.availableModels=it,this.brightness=Ct,this.loading={},this.loaded={},this.worldview=dt}loadTile(we,Ie){const Ge=we.uid,it=this.loading[Ge]=new yo(we,this.brightness,this.worldview);r.bu(we.request,((tt,et)=>{const Ct=!this.loading[Ge];return delete this.loading[Ge],Ct||tt?(it.status="done",Ct||(this.loaded[Ge]=it),Ie(tt)):et&&et.byteLength!==0?void it.parse(et,this.layerIndex,we,((dt,Rt)=>{it.status="done",this.loaded=this.loaded||{},this.loaded[Ge]=it,dt||!Rt?Ie(dt):Ie(null,Rt)})):(it.status="done",this.loaded[Ge]=it,Ie())}))}reloadTile(we,Ie){const Ge=this.loaded,it=we.uid;if(Ge&&Ge[it]){const tt=Ge[it];tt.projection=we.projection,tt.brightness=we.brightness;const et=(Ct,dt)=>{tt.reloadCallback&&(delete tt.reloadCallback,this.loadTile(we,Ie)),Ie(Ct,dt)};tt.status==="parsing"?tt.reloadCallback=et:tt.status==="done"&&this.loadTile(we,Ie)}}abortTile(we,Ie){const Ge=we.uid;this.loading[Ge]&&delete this.loading[Ge],Ie()}removeTile(we,Ie){const Ge=this.loaded,it=we.uid;Ge&&Ge[it]&&delete Ge[it],Ie()}}class Va{constructor(we){this.self=we,this.actor=new r.fx(we,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:N,geojson:Kt,"raster-dem":H,"raster-array":V,"batched-model":ca},this.workerSources={},this.self.registerWorkerSource=(Ie,Ge)=>{if(this.workerSourceTypes[Ie])throw new Error(`Worker source with name "${Ie}" already registered.`);this.workerSourceTypes[Ie]=Ge},this.self.registerRTLTextPlugin=Ie=>{if(r.fy.isParsed())throw new Error("RTL text plugin already registered.");r.fy.setState({pluginStatus:r.fz.parsed,pluginURL:r.fy.getPluginURL()}),r.fy.applyArabicShaping=Ie.applyArabicShaping,r.fy.processBidirectionalText=Ie.processBidirectionalText,r.fy.processStyledBidirectionalText=Ie.processStyledBidirectionalText;for(const Ge of this.rtlPluginParsingListeners)Ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(we,Ie,Ge){delete this.layerIndexes[we],delete this.availableImages[we],delete this.availableModels[we],delete this.workerSources[we],Ge()}checkIfReady(we,Ie,Ge){Ge()}setReferrer(we,Ie){this.referrer=Ie}spriteLoaded(we,Ie){this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={});const{scope:Ge,isLoaded:it}=Ie;if(this.isSpriteLoaded[we][Ge]=it,this.workerSources[we]&&this.workerSources[we][Ge])for(const tt in this.workerSources[we][Ge]){const et=this.workerSources[we][Ge][tt];for(const Ct in et){const dt=et[Ct];dt instanceof N&&(dt.isSpriteLoaded=it,dt.fire(new r.z("isSpriteLoaded")))}}}setImages(we,Ie,Ge){this.availableImages[we]||(this.availableImages[we]={});const{scope:it,images:tt}=Ie;if(this.availableImages[we][it]=tt,this.workerSources[we]&&this.workerSources[we][it]){for(const et in this.workerSources[we][it]){const Ct=this.workerSources[we][it][et];for(const dt in Ct)Ct[dt].availableImages=tt}Ge()}else Ge()}setModels(we,{scope:Ie,models:Ge},it){if(this.availableModels[we]||(this.availableModels[we]={}),this.availableModels[we][Ie]=Ge,this.workerSources[we]&&this.workerSources[we][Ie]){for(const tt in this.workerSources[we][Ie]){const et=this.workerSources[we][Ie][tt];for(const Ct in et)et[Ct].availableModels=Ge}it()}else it()}setProjection(we,Ie){this.projections[we]=r.cl(Ie)}setBrightness(we,Ie,Ge){this.brightness=Ie,Ge()}setWorldview(we,Ie,Ge){this.worldview=Ie,Ge()}setLayers(we,Ie,Ge){this.getLayerIndex(we,Ie.scope).replace(Ie.layers,Ie.options),Ge()}updateLayers(we,Ie,Ge){this.getLayerIndex(we,Ie.scope).update(Ie.layers,Ie.removedIds,Ie.options),Ge()}loadTile(we,Ie,Ge){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).loadTile(Ie,Ge)}decodeRasterArray(we,Ie,Ge){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).decodeRasterArray(Ie,Ge)}reloadTile(we,Ie,Ge){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).reloadTile(Ie,Ge)}abortTile(we,Ie,Ge){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).abortTile(Ie,Ge)}removeTile(we,Ie,Ge){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).removeTile(Ie,Ge)}removeSource(we,Ie,Ge){if(!(this.workerSources[we]&&this.workerSources[we][Ie.scope]&&this.workerSources[we][Ie.scope][Ie.type]&&this.workerSources[we][Ie.scope][Ie.type][Ie.source]))return;const it=this.workerSources[we][Ie.scope][Ie.type][Ie.source];delete this.workerSources[we][Ie.scope][Ie.type][Ie.source],it.removeSource!==void 0?it.removeSource(Ie,Ge):Ge()}loadWorkerSource(we,Ie,Ge){try{this.self.importScripts(Ie.url),Ge()}catch(it){Ge(it.toString())}}syncRTLPluginState(we,Ie,Ge){if(r.fy.isParsed())Ge(null,!0);else if(r.fy.isParsing())this.rtlPluginParsingListeners.push(Ge);else try{r.fy.setState(Ie);const it=r.fy.getPluginURL();!r.fy.isLoaded()||r.fy.isParsed()||r.fy.isParsing()||it==null||(r.fy.setState({pluginStatus:r.fz.parsing,pluginURL:r.fy.getPluginURL()}),this.self.importScripts(it),r.fy.isParsed()?Ge(null,!0):this.rtlPluginParsingListeners.push(Ge))}catch(it){Ge(it.toString())}}setDracoUrl(we,Ie){this.dracoUrl=Ie}getAvailableImages(we,Ie){this.availableImages[we]||(this.availableImages[we]={});let Ge=this.availableImages[we][Ie];return Ge||(Ge=[]),Ge}getAvailableModels(we,Ie){this.availableModels[we]||(this.availableModels[we]={});let Ge=this.availableModels[we][Ie];return Ge||(Ge={}),Ge}getLayerIndex(we,Ie){this.layerIndexes[we]||(this.layerIndexes[we]={});let Ge=this.layerIndexes[we][Ie];return Ge||(Ge=this.layerIndexes[we][Ie]=new F,Ge.scope=Ie),Ge}getWorkerSource(we,Ie,Ge,it){const tt=this.workerSources;return tt[we]||(tt[we]={}),tt[we][it]||(tt[we][it]={}),tt[we][it][Ie]||(tt[we][it][Ie]={}),this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),tt[we][it][Ie][Ge]||(tt[we][it][Ie][Ge]=new this.workerSourceTypes[Ie]({send:(et,Ct,dt,Rt,un,Wt)=>this.actor.send(et,Ct,dt,we,un,Wt),scheduler:this.actor.scheduler},this.getLayerIndex(we,it),this.getAvailableImages(we,it),this.getAvailableModels(we,it),this.isSpriteLoaded[we][it],void 0,this.brightness,this.worldview)),tt[we][it][Ie][Ge]}rasterizeImagesWorker(we,Ie,Ge){const it=new Map;for(const[tt,{image:et,imageVariant:Ct}]of Ie.tasks.entries()){const dt=this.imageRasterizer.rasterize(Ct,et,Ie.scope,we);it.set(tt,dt)}Ge(void 0,it)}removeRasterizedImages(we,Ie,Ge){this.imageRasterizer.removeImagesFromCacheByIds(Ie.imageIds,Ie.scope,we),Ge()}enforceCacheSizeLimit(we,Ie){r.fA(Ie)}getWorkerPerformanceMetrics(we,Ie,Ge){Ge(void 0,void 0)}}return r.fw(self)&&(self.worker=new Va(self)),Va})),v(["./shared"],(function(r){var E="3.15.0";const A={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(h){performance.mark(h)},measure(h,n,a){performance.measure(h,n,a)}};function F(h){const n=h.name.split("?")[0];return r.a(n)&&n.includes("mapbox-gl.js")?"javascript":r.a(n)&&n.includes("mapbox-gl.css")?"css":r.b(n)?"fontRange":r.c(n)?"sprite":r.i(n)?"style":r.d(n)?"tilejson":"other"}var z,R={},D=(function(){if(z)return R;function h(d){return!n(d)}function n(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,P=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(P);try{T=new Worker(k),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(k),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var P=T.getImageData(0,0,1,1);return P&&P.width===b.width})()?(a[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(a[_]=(function(b){var T,P=(function(k){var G=document.createElement("canvas"),q=Object.create(h.webGLContextAttributes);return q.failIfMajorPerformanceCaveat=k,G.getContext("webgl2",q)})(b);if(!P)return!1;try{T=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!T||P.isContextLost())&&(P.shaderSource(T,"void main() {}"),P.compileShader(T),P.getShaderParameter(T,P.COMPILE_STATUS)===!0)})(_)),a[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}z=1,R.supported=h,R.notSupportedReason=n;var a={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},R})();function O(h,n,a){const d=document.createElement(h);return n!=null&&(d.className=n),a&&a.appendChild(d),d}function N(h,n,a){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(n))d.setAttributeNS(null,_,String(n[_]));return a&&a.appendChild(d),d}const H=typeof document<"u"?document.documentElement&&document.documentElement.style:null,j=H&&H.userSelect!==void 0?"userSelect":"WebkitUserSelect";let V;function Z(){H&&j&&(V=H[j],H[j]="none")}function X(){H&&j&&(H[j]=V)}function se(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",se,!0)}function ge(){window.addEventListener("click",se,!0),window.setTimeout((()=>{window.removeEventListener("click",se,!0)}),0)}function ae(h,n){const a=h.getBoundingClientRect();return pe(h,a,n)}function oe(h,n){const a=h.getBoundingClientRect(),d=[];for(let _=0;_<n.length;_++)d.push(pe(h,a,n[_]));return d}function fe(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function pe(h,n,a){const d=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new r.P((a.clientX-n.left)*d,(a.clientY-n.top)*d)}const K="01",ye="NO_ACCESS_TOKEN";class J{constructor(n,a,d){this._transformRequestFn=n,this._customAccessToken=a,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const n=(function(){let a="";for(let d=0;d<10;d++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",K,a].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}normalizeStyleURL(n,a){if(!r.h(n))return n;const d=Ae(n);return d.params.push(`sdk=js-${E}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeGlyphsURL(n,a){if(!r.h(n))return n;const d=Ae(n);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeModelURL(n,a){if(!r.h(n))return n;const d=Ae(n);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeSourceURL(n,a,d,_){if(!r.h(n))return n;const b=Ae(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),_&&b.params.push(`worldview=${_}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(n,a){const d=Ae(n);return r.h(n)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||a)):ne(d)}normalizeSpriteURL(n,a,d,_){const b=Ae(n);return r.h(n)?(b.path=`/styles/v1${b.path}/sprite${a}${d}`,this._makeAPIURL(b,this._customAccessToken||_)):(b.path+=`${a}${d}`,ne(b))}normalizeTileURL(n,a,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!r.h(n))return n;const _=Ae(n);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||d&&_.authority!=="raster"&&d===512?"@2x":""}${r.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${r.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${r.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${r.e.TILE_URL_VERSION}${_.path}`);const b=this._customAccessToken||(function(T){for(const P of T){const k=P.match(/^access_token=(.*)$/);if(k)return k[1]}return null})(_.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,b)}canonicalizeTileURL(n,a){const d=Ae(n);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return n;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return a&&(b=b.filter((T=>!T.match(/^access_token=/)))),b.length&&(_+=`?${b.join("&")}`),_}canonicalizeTileset(n,a){const d=!!a&&r.h(a),_=[];for(const b of n.tiles||[])r.j(b)?_.push(this.canonicalizeTileURL(b,d)):_.push(b);return _}_makeAPIURL(n,a){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Ae(r.e.API_URL);if(n.protocol=_.protocol,n.authority=_.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(_.path!=="/"&&(n.path=`${_.path}${n.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return ne(n);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return n.params=n.params.filter((b=>b.indexOf("access_token")===-1)),n.params.push(`access_token=${a||""}`),ne(n)}}const de=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ae(h){const n=h.match(de);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ne(h){const n=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${n}`}const xe="mapbox.eventData";function Ce(h){if(!h)return null;const n=h.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(r.l(n[1]))}catch{return null}}class Re{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=Ce(r.e.ACCESS_TOKEN);let d="";return d=a&&a.u?r.f(a.u):r.e.ACCESS_TOKEN||"",n?`${xe}.${n}:${d}`:`${xe}:${d}`}fetchEventData(){const n=r.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid");if(n)try{const _=localStorage.getItem(a);_&&(this.eventData=JSON.parse(_));const b=localStorage.getItem(d);b&&(this.anonId=b)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const n=r.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(n&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,d,_){if(!r.e.EVENTS_URL)return;const b=Ae(r.e.EVENTS_URL);b.params.push(`access_token=${_||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(n).toISOString()},P=a?Object.assign(T,a):T,k={url:ne(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=r.p(k,(G=>{this.pendingRequest=null,d(G),this.saveEventData(),this.processRequests(_)}))}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const Ee=new class extends Re{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,n){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some((a=>r.h(a)||r.j(a)))&&this.queueRequest(Date.now(),n)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Ce(r.e.ACCESS_TOKEN),a=n?n.u:r.e.ACCESS_TOKEN;let d=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(_),P=(_-this.eventData.lastSuccess)/864e5;d=d||P>=1||P<-1||b.getDate()!==T.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:K,"enabled.telemetry":!1,userId:this.anonId},(b=>{b||(this.eventData.lastSuccess=_,this.eventData.tokenU=a)}),h):this.processRequests()}},Oe=Ee.postTurnstileEvent.bind(Ee),Be=new class extends Re{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,n,a,d){this.skuToken=n,this.errorCb=d,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(ye)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:K,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):n&&(this.success[n]=!0)}),h))}remove(){this.errorCb=null}},at=Be.postMapLoadEvent.bind(Be),ut=new class extends Re{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let n=this.mapInstanceIdMap.get(h);return n||(n=r.u(),this.mapInstanceIdMap.set(h,n)),n}getEventId(h){const n=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,n+1),n}postStyleLoadEvent(h,n){const{map:a,style:d,importedStyles:_}=n;if(!r.e.EVENTS_URL||!h&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),T={mapInstanceId:b,eventId:this.getEventId(b),style:d};_.length&&(T.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:T},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,(()=>{}),h)}},nt=ut.postStyleLoadEvent.bind(ut),$e=new class extends Re{constructor(){super("gljs.performance")}postPerformanceEvent(h,n){r.e.EVENTS_URL&&(h||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:a}=this.queue.shift(),d=(function(_){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),P=(function(re){const le={};if(re){for(const ce in re)if(ce!=="other")for(const Pe of re[ce]){const me=`${ce}ResolveRangeMin`,Me=`${ce}ResolveRangeMax`,Le=`${ce}RequestCount`,Fe=`${ce}RequestCachedCount`;le[me]=Math.min(le[me]||1/0,Pe.startTime),le[Me]=Math.max(le[Me]||-1/0,Pe.responseEnd);const Ze=He=>{le[He]===void 0&&(le[He]=0),++le[He]};Pe.transferSize!==void 0&&Pe.transferSize===0&&Ze(Fe),Ze(Le)}}return le})((function(re,le){const ce={};if(re)for(const Pe of re){const me=le(Pe);ce[me]===void 0&&(ce[me]=[]),ce[me].push(Pe)}return ce})(b,F)),k=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,q=G?G.effectiveType:void 0,te={counters:[],metadata:[],attributes:[]},Y=(re,le,ce)=>{ce!=null&&re.push({name:le,value:ce.toString()})};for(const re in P)Y(te.counters,re,P[re]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(Y(te.counters,"interactionRangeMin",_.interactionRange[0]),Y(te.counters,"interactionRangeMax",_.interactionRange[1])),T)for(const re of Object.keys(A)){const le=A[re],ce=T.find((Pe=>Pe.name===le));ce&&Y(te.counters,le,ce.startTime)}return Y(te.counters,"visibilityHidden",_.visibilityHidden),Y(te.attributes,"style",(function(re){if(re)for(const le of re){const ce=le.name.split("?")[0];if(r.i(ce)){const Pe=ce.split("/").slice(-2);if(Pe.length===2)return`mapbox://styles/${Pe[0]}/${Pe[1]}`}}})(b)),Y(te.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),Y(te.attributes,"fogEnabled",_.fogEnabled?"true":"false"),Y(te.attributes,"projection",_.projection),Y(te.attributes,"zoom",_.zoom),Y(te.metadata,"devicePixelRatio",k),Y(te.metadata,"connectionEffectiveType",q),Y(te.metadata,"navigatorUserAgent",navigator.userAgent),Y(te.metadata,"screenWidth",window.screen.width),Y(te.metadata,"screenHeight",window.screen.height),Y(te.metadata,"windowWidth",window.innerWidth),Y(te.metadata,"windowHeight",window.innerHeight),Y(te.metadata,"mapWidth",_.width/k),Y(te.metadata,"mapHeight",_.height/k),Y(te.metadata,"webglRenderer",_.renderer),Y(te.metadata,"webglVendor",_.vendor),Y(te.metadata,"sdkVersion",E),Y(te.metadata,"sdkIdentifier","mapbox-gl-js"),te})(a);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(n,d,(()=>{}),h)}},ct=$e.postPerformanceEvent.bind($e),At=new class extends Re{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,n,a,d){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const _=Ae(r.e.API_URL+r.e.SESSION_PATH);_.params.push(`sku=${n||""}`),_.params.push(`access_token=${d||r.e.ACCESS_TOKEN||""}`);const b={url:ne(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,(T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(h,n,a,d){this.skuToken=n,this.errorCb=d,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(ye)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,(d=>{d?this.errorCb(d):n&&(this.success[n]=!0)}),h)}remove(){this.errorCb=null}},xt=At.getSessionAPI.bind(At),It=new Set;function jt(h,n){n?It.add(h):It.delete(h)}class cn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(r.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Se(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class mt extends r.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new r.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const a=this.atlasTexture.get(n);a&&(a.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(n.id,n)}removeImageProvider(n,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(n)}getPendingImageProviders(){const n=[];for(const a of this.imageProviders.values())for(const d of a.values())d.hasPendingRequests()&&n.push(d);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,a){if(this.loaded.get(a)!==n&&(this.loaded.set(a,n),n)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,a,_);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images.get(a).get(n.toString())}addImage(n,a,d){this._validate(n,d)&&this.images.get(a).set(n.toString(),d)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new r.y(new Error(`Image "${n.name}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const _ of n){if(_[0]<d||_[1]<_[0]||a<_[1])return!1;d=_[1]}return!0}_validateContent(n,a){return n?n.length!==4||!a.usvg&&(n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,a,d){const _=this.images.get(a).get(n.toString());d.version=_.version+1,this.images.get(a).set(n.toString(),d),this.updatedImages.get(a).add(n),this.removeFromImageRasterizerCache(n,a)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,a){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([n],a))}removeImage(n,a){const d=this.images.get(a),_=d.get(n.toString());d.delete(n.toString()),this.patterns.get(a).delete(n.toString()),this.removeFromImageRasterizerCache(n,a),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map((a=>r.I.from(a)))}getImages(n,a,d){const _=[],b=[],T=this.imageProviders.get(a);for(const q of n){if(!q.iconsetId){_.push(q);continue}const te=T.get(q.iconsetId);te&&(this.getImage(q,a)?b.push(q):te.addPendingRequest(q))}if(_.length===0)return void this._notify(b,a,d);let P=!0;const k=!!this.loaded.get(a),G=this.images.get(a);if(!k)for(const q of _)G.has(q.toString())||(P=!1);k||P?this._notify(_,a,d):this.requestors.push({ids:_,scope:a,callback:d})}rasterizeImages(n,a){const d=new Map,{tasks:_,scope:b}=n;for(const[T,P]of _.entries()){const k=this.getImage(P.id,b);k&&d.set(T,{image:k,imageVariant:P})}this._rasterizeImages(b,d,a)}_rasterizeImages(n,a,d){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:n},d);else{const _=new Map;for(const[b,{image:T,imageVariant:P}]of a.entries())_.set(b,this.imageRasterizer.rasterize(P,T,n,0));d(void 0,_)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,a,d){const _=this.images.get(a),b=new Map;for(const T of n){if(!_.get(T.toString())){if(T.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:T.name}))}const P=_.get(T.toString());if(!P){r.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const k={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(k,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),b.set(r.I.toString(T),k)}d(null,b)}getPixelSize(n){const{width:a,height:d}=this.atlasImage.get(n);return{width:a,height:d}}getPattern(n,a,d){const _=n.toString(),b=this.patterns.get(a),T=b.get(_),P=this.getImage(n,a);if(!P)return null;if(T){if(T.position.version===P.version)return T.position;T.position.version=P.version}else{if(P.usvg&&!P.data){const k=this.getPatternInFlightId(_,a);if(this.patternsInFlight.has(k))return null;this.patternsInFlight.add(k);const G=new r.A(n).scaleSelf(r.o.devicePixelRatio),q=new Map([[G.toString(),{image:P,imageVariant:G}]]);return this._rasterizeImages(a,q,((te,Y)=>this.storePatternImage(G,a,P,d,Y))),null}this.storePattern(n,a,P)}return this._updatePatternAtlas(a,d),b.get(_).position}getPatternInFlightId(n,a){return r.B(n,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,a,d,_,b){const T=n.toString(),P=b?b.get(T):void 0;P&&(d.data=P,this.storePattern(n.id,a,d),this._updatePatternAtlas(a,_),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),a)))}storePattern(n,a,d){const _={w:d.data.width+2*r.C,h:d.data.height+2*r.C,x:0,y:0},b=new r.F(_,d,r.C);this.patterns.get(a).set(n.toString(),{bin:_,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,a){const d=n.gl;let _=this.atlasTexture.get(a);_?this.dirty&&(_.update(this.atlasImage.get(a)),this.dirty=!1):(_=new r.T(n,this.atlasImage.get(a),d.RGBA8),this.atlasTexture.set(a,_)),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(n,a){const d=this.patterns.get(n),_=Array.from(d.values()).map((({bin:G})=>G)),{w:b,h:T}=r.G(_),P=this.atlasImage.get(n);P.resize({width:b||1,height:T||1});const k=this.images.get(n);for(const[G,{bin:q,position:te}]of d.entries()){let Y=te.padding;const re=q.x+Y,le=q.y+Y,ce=k.get(G).data,Pe=ce.width,me=ce.height;Y=Y>1?Y-1:Y,r.q.copy(ce,P,{x:0,y:0},{x:re,y:le},{width:Pe,height:me},a),r.q.copy(ce,P,{x:0,y:me-Y},{x:re,y:le-Y},{width:Pe,height:Y},a),r.q.copy(ce,P,{x:0,y:0},{x:re,y:le+me},{width:Pe,height:Y},a),r.q.copy(ce,P,{x:Pe-Y,y:0},{x:re-Y,y:le},{width:Y,height:me},a),r.q.copy(ce,P,{x:0,y:0},{x:re+Pe,y:le},{width:Y,height:me},a),r.q.copy(ce,P,{x:Pe-Y,y:me-Y},{x:re-Y,y:le-Y},{width:Y,height:Y},a),r.q.copy(ce,P,{x:0,y:me-Y},{x:re+Pe,y:le-Y},{width:Y,height:Y},a),r.q.copy(ce,P,{x:0,y:0},{x:re+Pe,y:le+me},{width:Y,height:Y},a),r.q.copy(ce,P,{x:Pe-Y,y:0},{x:re-Y,y:le+me},{width:Y,height:Y},a)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,a){const d=this.images.get(a);for(const _ of n){if(this.callbackDispatchedThisFrame.get(a).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(_.toString());const b=d.get(_.toString());Se(b)&&this.updateImage(_,a,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ke(h){const n=h.value,a=h.valueSpec,d=h.style,_=h.styleSpec,b=h.key,T=h.arrayElementValidator||Fr;if(!Array.isArray(n))return[new r.V(b,n,`array expected, ${r.K(n)} found`)];if(a.length&&n.length!==a.length)return[new r.V(b,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new r.V(b,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let P={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};_.$version<7&&(P.function=a.function),r.H(a.value)&&(P=a.value);let k=[];for(let G=0;G<n.length;G++)k=k.concat(T({array:n,arrayIndex:G,value:n[G],valueSpec:P,style:d,styleSpec:_,key:`${b}[${G}]`},!0));return k}function Ue(h){const n=h.key,a=h.value,d=h.valueSpec;if(!r.L(a))return[new r.V(n,a,`number expected, ${r.K(a)} found`)];if(a!=a)return[new r.V(n,a,"number expected, NaN found")];if("minimum"in d){let _=d.minimum;if(Array.isArray(d.minimum)&&(_=d.minimum[h.arrayIndex]),a<_)return[new r.V(n,a,`${a} is less than the minimum value ${_}`)]}if("maximum"in d){let _=d.maximum;if(Array.isArray(d.maximum)&&(_=d.maximum[h.arrayIndex]),a>_)return[new r.V(n,a,`${a} is greater than the maximum value ${_}`)]}return[]}function je(h){const n=h.key,a=h.value;if(!r.H(a))return[new r.V(n,a,`object expected, ${r.K(a)} found`)];const d=h.valueSpec,_=r.J(a.type);let b,T,P,k={};const G=_!=="categorical"&&a.property===void 0,q=!G,te=(function(ce){const Pe=ce.stops;return Array.isArray(Pe)&&Array.isArray(Pe[0])&&r.H(Pe[0][0])})(a),Y=di({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(ce){if(_==="identity")return[new r.V(ce.key,ce.value,'identity function may not have a "stops" property')];let Pe=[];const me=ce.value;return Pe=Pe.concat(Ke({key:ce.key,value:me,valueSpec:ce.valueSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:re})),Array.isArray(me)&&me.length===0&&Pe.push(new r.V(ce.key,me,"array must have at least one stop")),Pe},default:function(ce){return Fr({key:ce.key,value:ce.value,valueSpec:d,style:ce.style,styleSpec:ce.styleSpec})}}});return _==="identity"&&G&&Y.push(new r.V(h.key,h.value,'missing required property "property"')),_==="identity"||a.stops||Y.push(new r.V(h.key,h.value,'missing required property "stops"')),_==="exponential"&&d.expression&&!r.M(d)&&Y.push(new r.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(q&&!r.N(d)?Y.push(new r.V(h.key,h.value,"property functions not supported")):G&&!r.O(d)&&Y.push(new r.V(h.key,h.value,"zoom functions not supported"))),_!=="categorical"&&!te||a.property!==void 0||Y.push(new r.V(h.key,h.value,'"property" property is required')),Y;function re(ce){let Pe=[];const me=ce.value,Me=ce.key;if(!Array.isArray(me))return[new r.V(Me,me,`array expected, ${r.K(me)} found`)];if(me.length!==2)return[new r.V(Me,me,`array length 2 expected, length ${me.length} found`)];if(te){if(!r.H(me[0]))return[new r.V(Me,me,`object expected, ${r.K(me[0])} found`)];const Le=me[0];if(Le.zoom===void 0)return[new r.V(Me,me,"object stop key must have zoom")];if(Le.value===void 0)return[new r.V(Me,me,"object stop key must have value")];const Fe=r.J(Le.zoom);if(typeof Fe!="number")return[new r.V(Me,Le.zoom,"stop zoom values must be numbers")];if(P&&P>Fe)return[new r.V(Me,Le.zoom,"stop zoom values must appear in ascending order")];Fe!==P&&(P=Fe,T=void 0,k={}),Pe=Pe.concat(di({key:`${Me}[0]`,value:me[0],valueSpec:{zoom:{}},style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:Ue,value:le}}))}else Pe=Pe.concat(le({key:`${Me}[0]`,value:me[0],style:ce.style,styleSpec:ce.styleSpec},me));return r.Q(r.S(me[1]))?Pe.concat([new r.V(`${Me}[1]`,me[1],"expressions are not allowed in function stops.")]):Pe.concat(Fr({key:`${Me}[1]`,value:me[1],valueSpec:d,style:ce.style,styleSpec:ce.styleSpec}))}function le(ce,Pe){const me=r.K(ce.value),Me=r.J(ce.value),Le=ce.value!==null?ce.value:Pe;if(b){if(me!==b)return[new r.V(ce.key,Le,`${me} stop domain type must match previous stop domain type ${b}`)]}else b=me;if(me!=="number"&&me!=="string"&&me!=="boolean"&&typeof Me!="number"&&typeof Me!="string"&&typeof Me!="boolean")return[new r.V(ce.key,Le,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&_!=="categorical"){let Fe=`number expected, ${me} found`;return r.N(d)&&_===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(ce.key,Le,Fe)]}return _!=="categorical"||me!=="number"||typeof Me=="number"&&isFinite(Me)&&Math.floor(Me)===Me?_!=="categorical"&&me==="number"&&typeof Me=="number"&&typeof T=="number"&&T!==void 0&&Me<T?[new r.V(ce.key,Le,"stop domain values must appear in ascending order")]:(T=Me,_==="categorical"&&Me in k?[new r.V(ce.key,Le,"stop domain values must be unique")]:(k[Me]=!0,[])):[new r.V(ce.key,Le,`integer expected, found ${String(Me)}`)]}}function gt(h){const n=(h.expressionContext==="property"?r.W:r.U)(r.S(h.value),h.valueSpec);if(n.result==="error")return n.value.map((d=>new r.V(`${h.key}${d.key}`,h.value,d.message)));const a=n.value.expression||n.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!r.Z(a))return[new r.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Ot(a,h);if(h.expressionContext==="appearance")return Ft(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!r.X(a,["zoom","feature-state"]))return[new r.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!r.Y(a))return[new r.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ot(h,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)a.delete(_);if(a.size===0)return[];const d=[];return h instanceof r._&&a.has(h.name)?[new r.V(n.key,n.value,`["${h.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(h.eachChild((_=>{d.push(...Ot(_,n))})),d)}function Ft(h,n){const a=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)a.add(_);if(a.size===0)return[];const d=[];return h instanceof r._&&!a.has(h.name)?[new r.V(n.key,n.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild((_=>{d.push(...Ft(_,n))})),d)}function pt(h){const n=h.key,a=h.value,d=h.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(r.J(a))===-1&&_.push(new r.V(n,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(r.J(a))===-1&&_.push(new r.V(n,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),_}function dn(h){return r.a2(r.S(h.value))?gt(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):An(h)}function An(h){const n=h.value,a=h.key;if(!Array.isArray(n))return[new r.V(a,n,`array expected, ${r.K(n)} found`)];if(n.length<1)return[new r.V(a,n,"filter array must have at least 1 element")];const d=h.styleSpec;let _=pt({key:`${a}[0]`,value:n[0],valueSpec:d.filter_operator});switch(r.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.J(n[1])==="$type"&&_.push(new r.V(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&_.push(new r.V(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(r.a0(n[1])||_.push(new r.V(`${a}[1]`,n[1],`string expected, ${r.K(n[1])} found`)));for(let b=2;b<n.length;b++)r.J(n[1])==="$type"?_=_.concat(pt({key:`${a}[${b}]`,value:n[b],valueSpec:d.geometry_type})):r.a0(n[b])||r.L(n[b])||r.$(n[b])||_.push(new r.V(`${a}[${b}]`,n[b],`string, number, or boolean expected, ${r.K(n[b])} found.`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)_=_.concat(An({key:`${a}[${b}]`,value:n[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":n.length!==2?_.push(new r.V(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):r.a0(n[1])||_.push(new r.V(`${a}[1]`,n[1],`string expected, ${r.K(n[1])} found`))}return _}function Gt(h,n){const a=h.key,d=h.style,_=h.layer,b=h.styleSpec,T=h.value,P=h.objectKey,k=b[`${n}_${h.layerType}`];if(!k)return[];const G=P.match(/^(.*)-use-theme$/);if(G&&k[G[1]])return r.Q(T)?[].concat(Fr({key:h.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:P})):Fr({key:a,value:T,valueSpec:{type:"string"},style:d,styleSpec:b});const q=P.match(/^(.*)-transition$/);if(n==="paint"&&q&&k[q[1]]&&k[q[1]].transition)return Fr({key:a,value:T,valueSpec:b.transition,style:d,styleSpec:b});const te=h.valueSpec||k[P];if(!te)return[new r.a3(a,T,`unknown property "${P}"`)];let Y;if(r.a0(T)&&r.N(te)&&!te.tokens&&(Y=/^{([^}]+)}$/.exec(T))){const le=`\`{ "type": "identity", "property": ${Y?JSON.stringify(Y[1]):'"_"'} }\``;return[new r.V(a,T,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const re=[];if(h.layerType==="symbol")P!=="text-field"||!d||d.glyphs||d.imports||re.push(new r.V(a,T,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&r.a4(r.S(T))&&r.J(T.type)==="identity"&&re.push(new r.V(a,T,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.N(te)&&(r.a5(te)||r.O(te))){const le=r.W(r.S(T),te),ce=le.value.expression||le.value._styleExpression.expression;ce&&!r.X(ce,["measure-light"])&&(P==="model-emissive-strength"&&r.Y(ce)&&r.Z(ce)||re.push(new r.V(a,T,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return re.concat(Fr({key:h.key,value:T,valueSpec:te,style:d,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:P}))}function Yt(h){return Gt(h,"paint")}function zn(h){return Gt(h,"layout")}function $n(h){let n=[];const a=h.value,d=h.key,_=h.style,b=h.styleSpec;if(!r.H(a))return[new r.V(d,a,"object expected")];a.type||a.ref||n.push(new r.V(d,a,'either "type" or "ref" is required'));let T=r.J(a.type);const P=r.J(a.ref);if(a.id){const k=r.J(a.id);for(let G=0;G<h.arrayIndex;G++){const q=_.layers[G];r.J(q.id)===k&&n.push(new r.V(d,a.id,`duplicate layer id "${k}", previously used at line ${q.id.__line__}`))}}if("ref"in a){let k;["type","source","source-layer","filter","layout"].forEach((G=>{G in a&&n.push(new r.V(d,a[G],`"${G}" is prohibited for ref layers`))})),_.layers.forEach((G=>{r.J(G.id)===P&&(k=G)})),k?k.ref?n.push(new r.V(d,a.ref,"ref cannot reference another ref layer")):T=r.J(k.type):typeof P=="string"&&n.push(new r.V(d,a.ref,`ref layer "${P}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source)if(r.a0(a.source)){const k=_.sources&&_.sources[a.source],G=k&&r.J(k.type);k?G==="vector"&&T==="raster"?n.push(new r.V(d,a.source,`layer "${a.id}" requires a raster source`)):G==="raster"&&T!=="raster"?n.push(new r.V(d,a.source,`layer "${a.id}" requires a vector source`)):G!=="vector"||a["source-layer"]?G==="raster-dem"&&T!=="hillshade"?n.push(new r.V(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&G==="geojson"&&!k.lineMetrics?n.push(new r.V(d,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&G!=="raster-array"&&n.push(new r.V(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new r.V(d,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new r.V(d,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new r.V(d,a.source,`source "${a.source}" not found`))}else n.push(new r.V(`${d}.source`,a.source,'"source" must be a string'));else n.push(new r.V(d,a,'missing required property "source"'));return n=n.concat(di({key:d,value:a,valueSpec:b.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fr({key:`${d}.type`,value:a.type,valueSpec:b.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:k=>dn(Object.assign({layerType:T},k)),layout:k=>di({layer:a,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":G=>zn(Object.assign({layerType:T},G))}}),paint:k=>di({layer:a,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":G=>Yt(Object.assign({layerType:T,layer:a},G))}}),appearances(k){const G=Ke({key:k.key,value:k.value,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:Y=>(function(re){const{key:le,layer:ce,layerType:Pe}=re,me=r.J(re.value),Me=r.J(me.name),Le=r.J(me.condition),Fe=di({key:le,value:me,valueSpec:re.styleSpec.appearance,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{condition:Ze=>(function(He){const Ye=[];return Ye.push(...gt({key:He.key,value:He.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Ye})(Object.assign({layer:ce,layerType:Pe},Ze)),properties:Ze=>(function(He){const Ye=[],{styleSpec:qe,layer:We,layerType:Xe}=He,Tt=qe[`paint_${Xe}`],ht=qe[`layout_${Xe}`],Lt=He.object[He.objectKey];for(const bt in Lt){const Pt=bt in Tt?"paint":bt in ht?"layout":void 0;if(!Pt){Ye.push(new r.V(He.key,bt,`unknown property "${bt}" for layer type "${Xe}"`));continue}const nn=Object.assign({},He,{key:`${He.key}.${bt}`,object:Lt,objectKey:bt,layer:We,layerType:Xe,value:Lt[bt],valueSpec:Pt==="paint"?Tt[bt]:ht[bt]});Ye.push(...Gt(nn,Pt))}return Ye})(Object.assign({layer:ce,layerType:Pe},Ze))}});return Me==="hidden"||Le||Fe.push(new r.V(re.key,"name",'Appearance with name different than "hidden" must have a condition')),Fe})(Object.assign({layerType:T,layer:a},Y))}),q=Array.isArray(k.value)?k.value:[],te=new Set;return q.forEach(((Y,re)=>{const le=r.J(Y.name);if(le)if(te.has(le)){const ce=r.J(a.id);G.push(new r.V(k.key,le,`Duplicated appearance name "${le}" for layer "${ce}"`))}else te.add(le)})),G}}})),n}function On({key:h,value:n}){return r.a0(n)?[]:[new r.V(h,n,`string expected, ${r.K(n)} found`)]}const Bn={promoteId:function h({key:n,value:a}){if(r.a0(a))return On({key:n,value:a});if(Array.isArray(a)){const _=[],b=r.S(a),T=r.U(b);return T.result==="error"&&T.value.forEach((P=>{_.push(new r.V(`${n}${P.key}`,null,`${P.message}`))})),r.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new r.V(`${n}`,null,"promoteId expression should be only feature dependent")),_}if(!r.H(a))return[new r.V(n,a,`string, expression or object expected, "${r.K(a)}" found`)];const d=[];for(const _ in a)d.push(...h({key:`${n}.${_}`,value:a[_]}));return d}};function kn(h){const n=h.value,a=h.key,d=h.styleSpec,_=h.style;if(!r.H(n))return[new r.V(a,n,`object expected, ${r.K(n)} found`)];if(!("type"in n))return[new r.V(a,n,'"type" is required')];const b=r.J(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||T.push(new r.a3(a,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(di({key:a,value:n,valueSpec:d[`source_${b.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Bn})),T;case"geojson":if(T=di({key:a,value:n,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:Bn}),"cluster"in n&&"clusterProperties"in n){if(!r.H(n.clusterProperties))return[new r.V(`${a}.clusterProperties`,n,`object expected, ${r.K(n)} found`)];for(const P in n.clusterProperties){const k=n.clusterProperties[P];if(!Array.isArray(k))return[new r.V(`${a}.clusterProperties.${P}`,k,"array expected")];const[G,q]=k,te=typeof G=="string"?[G,["accumulated"],["get",P]]:G;T.push(...gt({key:`${a}.${P}.map`,value:q,expressionContext:"cluster-map"})),T.push(...gt({key:`${a}.${P}.reduce`,value:te,expressionContext:"cluster-reduce"}))}}return T;case"video":return di({key:a,value:n,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return di({key:a,value:n,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pt({key:`${a}.type`,value:n.type,valueSpec:{values:Pr(d)}})}}function Pr(h){return h.source.reduce(((n,a)=>{const d=h[a];return d.type.type==="enum"&&(n=n.concat(Object.keys(d.type.values))),n}),[])}function mr(h){const n=h.value,a=h.styleSpec,d=a.light,_=h.style;if(n===void 0)return[];if(!r.H(n))return[new r.V("light",n,`object expected, ${r.K(n)} found`)];let b=[];for(const T in n){const P=T.match(/^(.*)-transition$/),k=T.match(/^(.*)-use-theme$/);b=b.concat(k&&d[k[1]]?Fr({key:T,value:n[T],valueSpec:{type:"string"},style:_,styleSpec:a}):P&&d[P[1]]&&d[P[1]].transition?Fr({key:T,value:n[T],valueSpec:a.transition,style:_,styleSpec:a}):d[T]?Fr({key:T,value:n[T],valueSpec:d[T],style:_,styleSpec:a}):[new r.V(T,n[T],`unknown property "${T}"`)])}return b}function ni(h){const n=h.value;if(!n)return[];const a=h.key;if(!r.H(n))return[new r.V(a,n,`object expected, ${r.K(n)} found`)];let d=[];const _=h.styleSpec,b=_["light-3d"],T=h.style,P=h.style.lights;for(const q of["type","id"])if(!(q in n))return d=d.concat([new r.V(a,n,`missing property "${q}"`)]),d;if(!r.a0(n.type))return d=d.concat([new r.V(`${a}.type`,n.type,"string expected")]),d;if(P)for(let q=0;q<h.arrayIndex;q++){const te=r.J(n.type),Y=P[q];r.J(Y.type)===te&&d.push(new r.V(a,n.id,`duplicate light type "${n.type}", previously defined at line ${Y.id.__line__}`))}const k=`properties_light_${n.type}`;if(!(k in _))return d=d.concat([new r.V(`${a}.type`,n,`Invalid light type ${n.type}`)]),d;const G=_[k];for(const q in n)if(q==="properties"){const te=n[q];if(!r.H(te))return d=d.concat([new r.V("properties",te,`object expected, ${r.K(te)} found`)]),d;for(const Y in te){const re=Y.match(/^(.*)-transition$/),le=Y.match(/^(.*)-use-theme$/);d=d.concat(le&&G[le[1]]?Fr({key:q,value:te[Y],valueSpec:{type:"string"},style:T,styleSpec:_}):re&&G[re[1]]&&G[re[1]].transition?Fr({key:q,value:n[q],valueSpec:_.transition,style:T,styleSpec:_}):G[Y]?Fr({key:Y,value:te[Y],valueSpec:G[Y],style:T,styleSpec:_}):[new r.a3(h.key,te[Y],`unknown property "${Y}"`)])}}else d=d.concat(b[q]?Fr({key:q,value:n[q],valueSpec:b[q],style:T,styleSpec:_}):[new r.a3(q,n[q],`unknown property "${q}"`)]);return d}function tr(h){const n=h.value,a=h.key,d=h.style,_=h.styleSpec,b=_.terrain;if(n==null)return[];if(!r.H(n))return[new r.V("terrain",n,`object expected, ${r.K(n)} found`)];let T=[];for(const P in n){const k=P.match(/^(.*)-transition$/),G=P.match(/^(.*)-use-theme$/);T=T.concat(G&&b[G[1]]?Fr({key:P,value:n[P],valueSpec:{type:"string"},style:d,styleSpec:_}):k&&b[k[1]]&&b[k[1]].transition?Fr({key:P,value:n[P],valueSpec:_.transition,style:d,styleSpec:_}):b[P]?Fr({key:P,value:n[P],valueSpec:b[P],style:d,styleSpec:_}):[new r.a3(P,n[P],`unknown property "${P}"`)])}if(n.source)if(r.a0(n.source)){const P=d.sources&&d.sources[n.source],k=P&&r.J(P.type);P?k!=="raster-dem"&&T.push(new r.V(`${a}.source`,n.source,`terrain cannot be used with a source of type ${k}, it only be used with a "raster-dem" source type`)):T.push(new r.V(`${a}.source`,n.source,`source "${n.source}" not found`))}else T.push(new r.V(`${a}.source`,n.source,"source must be a string"));else T.push(new r.V(a,n,'terrain is missing required property "source"'));return T}function Br(h){const n=h.value,a=h.style,d=h.styleSpec,_=d.fog;if(n===void 0)return[];if(!r.H(n))return[new r.V("fog",n,`object expected, ${r.K(n)} found`)];let b=[];for(const T in n){const P=T.match(/^(.*)-transition$/),k=T.match(/^(.*)-use-theme$/);b=b.concat(k&&_[k[1]]?Fr({key:T,value:n[T],valueSpec:{type:"string"},style:a,styleSpec:d}):P&&_[P[1]]&&_[P[1]].transition?Fr({key:T,value:n[T],valueSpec:d.transition,style:a,styleSpec:d}):_[T]?Fr({key:T,value:n[T],valueSpec:_[T],style:a,styleSpec:d}):[new r.a3(T,n[T],`unknown property "${T}"`)])}return b}const Tr={"*":()=>[],array:Ke,boolean:function(h){const n=h.value,a=h.key;return r.$(n)?[]:[new r.V(a,n,`boolean expected, ${r.K(n)} found`)]},number:Ue,color:function({key:h,value:n}){return r.a0(n)?r.a1.parseCSSColor(n)===null?[new r.V(h,n,`color expected, "${n}" found`)]:[]:[new r.V(h,n,`color expected, ${r.K(n)} found`)]},enum:pt,filter:dn,function:je,layer:$n,object:di,source:kn,model:r.a7,light:mr,"light-3d":ni,terrain:tr,fog:Br,string:On,formatted:function(h){return On(h).length===0?[]:gt(h)},resolvedImage:function(h){return On(h).length===0?[]:gt(h)},projection:function(h){const n=h.value,a=h.styleSpec,d=a.projection,_=h.style;if(r.H(n)){let b=[];for(const T in n)b=b.concat(Fr({key:T,value:n[T],valueSpec:d[T],style:_,styleSpec:a}));return b}return r.a0(n)?[]:[new r.V("projection",n,`object or string expected, ${r.K(n)} found`)]},import:function(h){const n=h.key,{value:a,styleSpec:d}=h;if(!r.H(a))return[new r.V(n,a,"import must be an object")];const{data:_,...b}=a;Object.defineProperty(b,"__line__",{value:a.__line__,enumerable:!1});let T=di(Object.assign({},h,{value:b,valueSpec:d.import}));return r.J(b.id)===""&&T.push(new r.V(`${h.key}.id`,b,"import id can't be an empty string")),_&&(T=T.concat(ds(_,d,{key:`${h.key}.data`}))),T},iconset:function(h){const n=h.value,a=h.key,d=h.styleSpec,_=h.style;if(!r.H(n))return[new r.V(a,n,"object expected")];if(!n.type)return[new r.V(a,n,'"type" is required')];const b=r.J(n.type);let T=[];if(T=T.concat(di({key:a,value:n,valueSpec:d[`iconset_${b}`],style:_,styleSpec:d})),(function(P,k){return!(P!=="source"||!k.source)})(b,n)){const P=_.sources&&_.sources[n.source],k=P&&r.J(P.type);P?k!=="raster-array"&&T.push(new r.V(a,n.source,`iconset cannot be used with a source of type ${String(k)}, it only be used with a "raster-array" source type`)):T.push(new r.V(a,n.source,`source "${n.source}" not found`))}return T}};function Fr(h,n=!1){const a=h.value,d=h.valueSpec,_=h.styleSpec;if(d.expression){if(r.a4(r.J(a)))return je(h);if(r.Q(r.S(a)))return gt(h)}if(d.type&&Tr[d.type]){const b=Tr[d.type](h);return n===!0&&b.length>0&&Array.isArray(h.value)?gt(h):b}return di(Object.assign({},h,{valueSpec:d.type?_[d.type]:d}))}function di(h){const n=h.key,a=h.value,d=h.valueSpec||{},_=h.objectElementValidators||{},b=h.style,T=h.styleSpec;if(!r.H(a))return[new r.V(n,a,`object expected, ${r.K(a)} found`)];let P=[];for(const k in a){const G=k.split(".")[0];let q;_[G]?q=_[G]:d[G]?q=Fr:_["*"]?q=_["*"]:d["*"]&&(q=Fr),q?P=P.concat(q({key:(n&&`${n}.`)+k,value:a[k],valueSpec:d[G]||d["*"],style:b,styleSpec:T,object:a,objectKey:k},a)):P.push(new r.a3(n,a[k],`unknown property "${k}"`))}for(const k in d)_[k]||d[k].required&&d[k].default===void 0&&a[k]===void 0&&P.push(new r.V(n,a,`missing required property "${k}"`));return P}function Mo({key:h,value:n}){const a=On({key:h,value:n});if(a.length)return a;const d=n;return d.indexOf("{fontstack}")===-1&&a.push(new r.V(h,n,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&a.push(new r.V(h,n,'"glyphs" url must include a "{range}" token')),a}function ds(h,n=r.a6,a={}){return di({key:a.key||"",value:h,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:h,objectElementValidators:{glyphs:Mo}})}function Yr(h,n=r.a6){return tt(ds(h,n))}const co=h=>tt(kn(h)),ya=h=>tt(mr(h)),cl=h=>tt(ni(h)),Kt=h=>tt(tr(h)),yo=h=>tt(Br(h)),ca=h=>tt((function(n){const a=n.value,d=n.style,_=n.styleSpec,b=_.snow;if(a===void 0)return[];if(!r.H(a))return[new r.V("snow",a,`object expected, ${r.K(a)} found`)];let T=[];for(const P in a){const k=P.match(/^(.*)-transition$/);T=T.concat(k&&b[k[1]]&&b[k[1]].transition?Fr({key:P,value:a[P],valueSpec:_.transition,style:d,styleSpec:_}):b[P]?Fr({key:P,value:a[P],valueSpec:b[P],style:d,styleSpec:_}):[new r.a3(P,a[P],`unknown property "${P}"`)])}return T})(h)),Va=h=>tt((function(n){const a=n.value,d=n.style,_=n.styleSpec,b=_.rain;if(a===void 0)return[];if(!r.H(a))return[new r.V("rain",a,`object expected, ${r.K(a)} found`)];let T=[];for(const P in a){const k=P.match(/^(.*)-transition$/);T=T.concat(k&&b[k[1]]&&b[k[1]].transition?Fr({key:P,value:a[P],valueSpec:_.transition,style:d,styleSpec:_}):b[P]?Fr({key:P,value:a[P],valueSpec:b[P],style:d,styleSpec:_}):[new r.a3(P,a[P],`unknown property "${P}"`)])}return T})(h)),_t=h=>tt($n(h)),we=h=>tt(dn(h)),Ie=h=>tt(Yt(h)),Ge=h=>tt(zn(h)),it=h=>tt(r.a7(h));function tt(h){return h.slice().sort(((n,a)=>n.line&&a.line?n.line-a.line:0))}function et(h,n){let a=!1;if(n&&n.length)for(const d of n)d instanceof r.a3?r.w(d.message):(h.fire(new r.y(new Error(d.message))),a=!0);return a}let Ct;class dt extends r.E{constructor(n,a="flat"){super(),this._transitionable=new r.a8(Ct||(Ct=new r.a9({anchor:new r.aa(r.a6.light.anchor),position:new r.ab(r.a6.light.position),color:new r.aa(r.a6.light.color),intensity:new r.aa(r.a6.light.intensity)}))),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,d={}){this._validate(ya,n,d)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&et(this,n.call(Yr,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Rt=class extends r.E{constructor(h,n,a,d,_){super(),this.scope=a,this._transitionable=new r.a8(new r.a9({source:new r.aa(r.a6.terrain.source),exaggeration:new r.aa(r.a6.terrain.exaggeration)}),a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=_}get(){return this._transitionable.serialize()}set(h,n){this._transitionable.setTransitionOrValue(h,n)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new r.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const n=h.value.expression;if(!n)return null;let a=-1,d=-1,_=1;for(const b of n.zoomStops)_=n.evaluate(new r.ac(b,{worldview:this.worldview})),_>.01?(a=b,d=-1):d=b;return _<.01&&a>0&&d>a?[a,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof r.ad}};const un=45,Wt=65,qn=.05;function lr(h,n,a,d){const _=r.ah(un,Wt,a),[b,T]=fr(h,d);let P=1-Math.min(1,Math.exp((n-b)/(T-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*_*h.alpha}function fr(h,n){const a=.5/Math.tan(.5*n);return[h.range[0]+a,h.range[1]+a]}function Nr(h,n,a,d,_){const b=r.af([],[n,a,d],_.mercatorFogMatrix);return lr(h,r.ag(b),_.pitch,_._fov)}function Ir(h,n,a,d,_,b,T){const P=[[a,d,0],[_,d,0],[_,b,0],[a,b,0]];let k=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const q of P){const te=r.af([],q,n),Y=r.ag(te);k=Math.min(k,Y),G=Math.max(G,Y)}return[lr(h,k,T.pitch,T._fov),lr(h,G,T.pitch,T._fov)]}class gr extends r.E{constructor(n,a,d,_){super();const b=new r.a9({range:new r.aa(r.a6.fog.range),color:new r.aa(r.a6.fog.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(r.a6.fog["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(r.a6.fog["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(r.a6.fog["horizon-blend"]),"star-intensity":new r.aa(r.a6.fog["star-intensity"]),"vertical-range":new r.aa(r.a6.fog["vertical-range"])});this._transitionable=new r.a8(b,d,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ai(b),this.scope=d}get state(){const n=this._transform,a=n.projection.name==="globe",d=r.aj(n.zoom),_=this.properties.get("range"),b=[.5,3];return{range:a?[r.ak(b[0],_[0],d),r.ak(b[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,d={}){if(this._validate(yo,n,d))return;const _=Object.assign({},n);for(const b of Object.keys(r.a6.fog))_[b]===void 0&&(_[b]=r.a6.fog[b].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(un,Wt,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?(function(d,_,b){const T=r.ae.fromLngLat(_),P=b.elevation?b.elevation.getAtPointOrZero(T):0;return Nr(d,T.x,T.y,P,b)})(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Ir(this.state,a,0,0,r.al,r.al,this._transform)}getOpacityForBounds(n,a,d,_,b){return this._transform.projection.supportsFog?Ir(this.state,n,a,d,_,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?fr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const d of a){const _=n.points[d];let b;if(_[2]>=0)b=_;else{const T=n.points[d-4];b=r.am(T,_,T[2]/(T[2]-_[2]))}if(Nr(this.state,b[0],b[1],0,this._transform)>=qn)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&et(this,n.call(Yr,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let wi,Vr,fo,ko,jo=class extends r.E{constructor(h,n,a,d){super();const _=wi||(wi=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(_,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=a}get state(){const h=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),d=r.an(a[0]),_=-Math.max(r.an(a[1]),.01),b=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],T=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(n.r,n.g,n.b,n.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(h,n,a={}){if(this._validate(ca,h,a))return;const d=Object.assign({},h);for(const _ of Object.keys(r.a6.snow))d[_]===void 0&&(d[_]=r.a6.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,n,a){return(!a||a.validate!==!1)&&et(this,h.call(Yr,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},bi=class extends r.E{constructor(h,n,a,d){super();const _=Vr||(Vr=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(_,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(_),this.scope=a}get state(){const h=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),d=r.an(a[0]),_=-Math.max(r.an(a[1]),.01),b=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(n.r,n.g,n.b,n.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(h,n,a={}){if(this._validate(Va,h,a))return;const d=Object.assign({},h);for(const _ of Object.keys(r.a6.rain))d[_]===void 0&&(d[_]=r.a6.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,n,a){return(!a||a.validate!==!1)&&et(this,h.call(Yr,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class ai extends r.E{constructor(n,a,d,_){super(),this.scope=d,this._options=n,this.properties=new r.ai(a),this._transitionable=new r.a8(a,d,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class io{constructor(n,a,d){this.screenBounds=n,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,a){let d,_;if(n instanceof r.P||typeof n[0]=="number"){const b=r.P.convert(n);d=[b],_=a.isPointAboveHorizon(b)}else{const b=r.P.convert(n[0]),T=r.P.convert(n[1]),P=b.add(T)._div(2);d=[b,T],_=r.aq(b,T).every((k=>a.isPointAboveHorizon(k)))&&a.isPointAboveHorizon(P)}return new io(d,_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),r.ar(_,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.aq(a,d,n),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>d.y))+((b.x>a.x)+(b.x>d.x))){case 0:_[0]=b,_[4]=b.clone();break;case 1:_.splice(1,0,b);break;case 2:_[1]=b;break;case 3:_.splice(4,0,b);break;case 5:_.splice(2,0,b);break;case 6:_[3]=b;break;case 7:_.splice(3,0,b);break;case 8:_[2]=b}return _}containsTile(n,a,d,_=0){const b=n.queryPadding/a._pixelsPerMercatorPixel+1,T=d?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let P=n.tileID.wrap+(T.unwrapped?_:0);const k=T.polygon.map((Pe=>r.as(n.tileTransform,Pe,P)));if(!r.at(k,0,0,r.al,r.al))return;P=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const G=this.screenGeometryMercator.polygon.map((Pe=>r.au(n.tileTransform,Pe,P))),q=G.map((Pe=>new r.P(Pe[0],Pe[1]))),te=a.getFreeCameraOptions().position||new r.ae(0,0,0),Y=r.au(n.tileTransform,te,P),re=G.map((Pe=>{const me=r.av(Pe,Pe,Y);return r.aw(me,me),new r.ax(Y,me)})),le=r.ay(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:re,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(ce=r.az(k),ce.min.x=r.aA(ce.min.x,0,r.al),ce.min.y=r.aA(ce.min.y,0,r.al),ce.max.x=r.aA(ce.max.x,0,r.al),ce.max.y=r.aA(ce.max.y,0,r.al),ce),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:le};var ce}_bufferedScreenMercator(n,a){const d=ts(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(n,a){const d=ts(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(n,a){const d=(function(b,T){const P=r.aB([],T.pixelMatrix,T.globeMatrix),k=[0,-r.aD,0,1],G=[0,r.aD,0,1],q=[0,0,0,1];r.aC(k,k,P),r.aC(G,G,P),r.aC(q,q,P);const te=new r.P(k[0]/k[3],k[1]/k[3]),Y=new r.P(G[0]/G[3],G[1]/G[3]),re=r.aE(b,te)&&k[3]<q[3],le=r.aE(b,Y)&&G[3]<q[3];if(!re&&!le)return null;const ce=(function(Ye,qe,We){for(let Xe=1;Xe<Ye.length;Xe++){const Tt=Hr(qe.pointCoordinate3D(Ye[Xe-1]).x),ht=Hr(qe.pointCoordinate3D(Ye[Xe]).x);if(We<0){if(Tt<ht)return{idx:Xe,t:-Tt/(ht-1-Tt)}}else if(ht<Tt)return{idx:Xe,t:(1-Tt)/(ht+1-Tt)}}return null})(b,T,re?-1:1);if(!ce)return null;const{idx:Pe,t:me}=ce;let Me=Pe>1?yi(b.slice(0,Pe),T):[],Le=Pe<b.length?yi(b.slice(Pe),T):[];Me=Me.map((Ye=>new r.P(Hr(Ye.x),Ye.y))),Le=Le.map((Ye=>new r.P(Hr(Ye.x),Ye.y)));const Fe=[...Me];Fe.length===0&&Fe.push(Le[Le.length-1]);const Ze=r.ak(Fe[Fe.length-1].y,(Le.length===0?Me[0]:Le[0]).y,me);let He;return He=re?[new r.P(0,Ze),new r.P(0,0),new r.P(1,0),new r.P(1,Ze)]:[new r.P(1,Ze),new r.P(1,1),new r.P(0,1),new r.P(0,Ze)],Fe.push(...He),Le.length===0?Fe.push(Me[0]):Fe.push(...Le),{polygon:Fe.map((Ye=>new r.ae(Ye.x,Ye.y))),unwrapped:!1}})(n,a);if(d)return d;const _=(function(b,T){let P=!1,k=-1/0,G=0;for(let te=0;te<b.length-1;te++)b[te].x>k&&(k=b[te].x,G=te);for(let te=0;te<b.length-1;te++){const Y=(G+te)%(b.length-1),re=b[Y],le=b[Y+1];Math.abs(re.x-le.x)>.5&&(re.x<le.x?(re.x+=1,Y===0&&(b[b.length-1].x+=1)):(le.x+=1,Y+1===b.length-1&&(b[0].x+=1)),P=!0)}const q=r.aF(T.center.lng);return P&&q<Math.abs(q-1)&&b.forEach((te=>{te.x-=1})),{polygon:b,unwrapped:P}})(yi(n,a).map((b=>new r.P(Hr(b.x),b.y))),a);return{polygon:_.polygon.map((b=>new r.ae(b.x,b.y))),unwrapped:_.unwrapped}}}function yi(h,n){return r.aG(h,(a=>{const d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y}),1/256)}function Hr(h){return h<0?1+h%1:h%1}function ts(h){return 100*h|0}function rs(h,n,a,d,_){const b=function(P,k){if(P)return _(P);if(k){if(h.url&&k.tiles&&h.tiles&&delete h.tiles,k.variants){if(!Array.isArray(k.variants))return _(new Error("variants must be an array"));for(const q of k.variants){if(q==null||typeof q!="object"||q.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(q.capabilities))return _(new Error("capabilities must be an array"));if(q.capabilities.length===1&&q.capabilities[0]==="meshopt"){k=Object.assign(k,q);break}}}const G=r.aH(Object.assign({},k,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=n.canonicalizeTileset(G,h.url),_(null,G)}},T=(function(P,k,G){if(!P)return null;if(!k&&!G)return P;G=G||P.worldview_default;const q=Object.values(P.language||{});if(q.length===0)return null;const te=Object.values(P.worldview||{});if(te.length===0)return null;const Y=q.every((le=>le===k)),re=te.every((le=>le===G));return Y&&re?P:k in(P.language_options||{})||G in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null})(h.data,a,d);return T?r.o.frame((()=>b(null,T))):h.url?r.m(n.transformRequest(n.normalizeSourceURL(h.url,null,a,d),r.R.Source),b):r.o.frame((()=>{const{data:P,...k}=h;b(null,k)}))}function $s(h,n){const a=Math.pow(2,n.z),d=Math.floor(r.aF(h.getWest())*a),_=Math.floor(r.aJ(h.getNorth())*a),b=Math.ceil(r.aF(h.getEast())*a),T=Math.ceil(r.aJ(h.getSouth())*a);return n.x>=d&&n.x<b&&n.y>=_&&n.y<T}class ul{constructor(n,a,d){this.bounds=n?r.aI.convert(this.validateBounds(n)):null,this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const a of n)this.extraBounds.push(r.aI.convert(this.validateBounds(a)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!$s(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if($s(a,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const a=new ul(n.bounds,n.minzoom,n.maxzoom);return a.addExtraBounds(n.extra_bounds),a}}class Oo extends r.E{constructor(n,a,d,_){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.aK}load(n){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=rs(this._options,this.map._requestManager,a,d,((_,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new r.y(_));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=ul.fromTileJSON(b),Oe(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(_)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,a){const d=n.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(_,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,P=T?{image:T.image.clone()}:null,k={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.h(d)&&(k.localizableLayerIds=this.localizableLayerIds),k.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",k,G.bind(this));else if(n.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",k,G.bind(this),void 0,!0);else{const q=r.aL.call({deduped:this._deduped},k,((te,Y)=>{te||!Y?G.call(this,te):(k.data={cacheControl:Y.cacheControl,expires:Y.expires,rawData:Y.rawData.slice(0)},n.actor&&n.actor.send("loadTile",k,G.bind(this),void 0,!0))}),!0);n.request={cancel:q}}function G(q,te){return delete n.request,n.aborted?a(null):q&&q.status!==404?a(q):(te&&te.resourceTiming&&(n.resourceTiming=te.resourceTiming),this.map._refreshExpiredTiles&&te&&n.setExpiryData(te),n.loadVectorData(te,this.map.painter),r.aM(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dc extends r.E{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,r.aH(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=rs(this._options,this.map._requestManager,null,a,((d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new r.y(d)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map((b=>b.id))),this.tileBounds=ul.fromTileJSON(_),Oe(_.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(d)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const d=r.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=r.n(this.map._requestManager.transformRequest(_,r.R.Tile),((b,T,P,k)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):b?(n.state="errored",a(b)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:P,expires:k}),n.setTexture(T,this.map.painter),n.state="loaded",r.aM(this.dispatcher),void a(null)):a(null))))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a&&a()}unloadTile(n,a){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function vf([h,n],a,d,{scaled:_=!0}={}){const{tileSize:b,buffer:T}=d,{x:P,y:k,z:G}=a;if(!isFinite(P)||!isFinite(k)||!isFinite(G))throw new Error("Invalid MRT header");const q=2**G,te=q*r.aF(h),Y=q*r.aJ(n);return(function([re,le],ce,{scaled:Pe=!0}={}){if(!ce)throw new Error("bandView is undefined");const{data:me,tileSize:Me,buffer:Le,offset:Fe,scale:Ze,dimension:He}=ce;if(re<-Le||re>Me+Le||le<-Le||le>Me+Le)throw new Error(`Point (${re}, ${le}) out of bounds for tileSize=${Me}, buffer=${Le}`);const Ye=(le+Le)*(Me+2*Le)+(re+Le);if(new Uint32Array(me.buffer)[Ye]===4294967295)return null;let qe=[];qe=Pe?[]:new ce.data.constructor(He);for(let We=0;We<He;We++)qe[We]=Math.round(1e12*(me[He*Ye+We]*Ze+Fe))/1e12;return qe})([Math.min(Math.max(-T,Math.floor((te-P)*b)),b-1+T),Math.min(Math.max(-T,Math.floor((Y-k)*b)),b-1+T)],d,{scaled:_})}class zl extends dc{constructor(n,a,d,_){super(n,a,d,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,r.R.Tile),b={request:_,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor());const T=(P,k,G,q)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(P)return P.name==="AbortError"?void 0:(n.state="errored",a(P));if(this.map._refreshExpiredTiles&&k&&n.setExpiryData({cacheControl:G,expires:q}),this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!k)return a(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=k}a(null)};n.request=this.partial?n.fetchHeader(void 0,T.bind(this)):n.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){const d=n.texturePerLayer;if(n.flushAllQueues(),d.size){n.destroy(!0);for(const _ of d.values())this.map.painter.saveTileTexture(_)}else n.destroy()}prepareTile(n,a,d,_){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(a,d,_,((b,T)=>{if(b)return n.state="errored",this.fire(new r.y(b)),void this.triggerRepaint(n);T&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(d,T,this.map.painter),n.state="loaded",this.triggerRepaint(n))})))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find((({id:b})=>b===n)),d=a&&a.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(n,a,d){if(!n)return;const _=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let b=null;a instanceof r.aP?b=a.paint.get("raster-array-band"):a instanceof r.aQ&&(b=a.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(_);if(T==null)return;if(!n.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(n,_,a.id,T);if(n.updateNeeded(a.id,T)&&!d)return;const P=n.textureDescriptorPerLayer.get(a.id);return Object.assign({},P,{texture:n.texturePerLayer.get(a.id)})}getImages(n,a){const d=new Map;for(const _ of n)for(const b of a){const[T,P]=b.split("/"),k=_.getLayer(T);if(!k||!k.hasBand(P)||!k.hasDataForBand(P))continue;const{bytes:G,tileSize:q,buffer:te}=k.getBandView(P),Y=q+2*te,re={data:new r.q({width:Y,height:Y},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(b,re)}return d}queryRasterArrayValueByBandId(n,a,d){const _=a._mrt;return new Promise((b=>{const T={},P=new Set;for(const[k,G]of Object.entries(_.layers)){if(d.layerName&&k!==d.layerName)continue;const q={};T[k]=q;for(const{bands:te}of G.dataIndex)for(const Y of te)d.bands&&!d.bands.includes(Y)||(P.add(r.B(k,Y)),a.fetchBand(k,null,Y,(re=>{r.o.frame((()=>{q[Y]=re?null:vf([n.lng,n.lat],_,G.getBandView(Y)),P.delete(r.B(k,Y)),P.size===0&&b(T)}))}),!1))}P.size===0&&b(T)}))}_loadTileForQuery(n,a){if(this._loadTileLoaded[n.uid])return void a(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(a);this._loadTilePending[n.uid]=[a];const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,r.R.Tile);n.actor.send("loadTile",{request:_,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((b,T,P,k)=>b?(this._loadTilePending[n.uid].forEach((G=>G(b,null))),void delete this._loadTilePending[n.uid]):T?(this.map._refreshExpiredTiles&&T&&n.setExpiryData({cacheControl:P,expires:k}),n._mrt=T,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach((G=>G(null,T))),this._loadTileLoaded[n.uid]=!0,void delete this._loadTilePending[n.uid]):(this._loadTilePending[n.uid].forEach((G=>G(null,null))),void delete this._loadTilePending[n.uid])),void 0,!0)}queryRasterArrayValueByAllBands(n,a,d){return new Promise(((_,b)=>{this._loadTileForQuery(a,((T,P)=>{T?b(T):_(P?this.queryRasterArrayValueByBandId(n,a,d):null)}))}))}queryRasterArrayValue(n,a){const d=r.aR.convert(n),_=this.findLoadedParent(d);return _&&_._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(d,_,a):this.queryRasterArrayValueByAllBands(d,_,a):Promise.resolve(null)}findLoadedParent(n){const a=r.ae.fromLngLat(n,this.map.transform.tileSize),d=this.maxzoom+1,_=1<<d,b=Math.floor(a.x),T=Math.floor((a.x-b)*_),P=Math.floor(a.y*_),k=this.map.style.getSourceCache(this.id),G=new r.aO(d,b,d,T,P);return k.findLoadedParent(G,this.minzoom)}}const Cu={vector:Oo,raster:dc,"raster-dem":class extends dc{constructor(h,n,a,d){super(h,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,b){_&&(h.state="errored",n(_)),b&&(h.dem=b,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=r.n(this.map._requestManager.transformRequest(a,r.R.Tile),(function(_,b,T,P){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(_)h.state="errored",n(_);else if(b){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:P});const k=ImageBitmap&&b instanceof ImageBitmap&&r.r(),G=1-(b.width-r.aN(b.width))/2;G<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const q=k?b:r.o.getImageData(b,G),te={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:q,encoding:this.encoding,padding:G};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",te,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,_=n.x===0?h.wrap-1:h.wrap,b=(n.x+1+a)%a,T=n.x+1===a?h.wrap+1:h.wrap,P={};return P[new r.aO(h.overscaledZ,_,n.z,d,n.y).key]={backfilled:!1},P[new r.aO(h.overscaledZ,T,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(P[new r.aO(h.overscaledZ,_,n.z,d,n.y-1).key]={backfilled:!1},P[new r.aO(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},P[new r.aO(h.overscaledZ,T,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<a&&(P[new r.aO(h.overscaledZ,_,n.z,d,n.y+1).key]={backfilled:!1},P[new r.aO(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},P[new r.aO(h.overscaledZ,T,n.z,b,n.y+1).key]={backfilled:!1}),P}},"raster-array":zl,geojson:class extends r.E{constructor(h,n,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:r.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const a of this._data.features)n.set(a.id,a);for(const a of h.features)n.set(a.id,a);this._data.features=[...n.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},n),this}getClusterLeaves(h,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:n,offset:a},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:h},this.workerOptions);n.scope=this.scope;const a=this._data;typeof a=="string"?(n.request=this.map._requestManager.transformRequest(r.o.resolveURL(a),r.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,((d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new r.y(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const h=r.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,n){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview()};h.request=this.actor.send(a,T,((P,k)=>b&&!k?(h.state="loaded",n(null)):(delete h.request,h.destroy(),h.aborted?n(null):P?n(P):(h.loadVectorData(k,this.map.painter,a==="reloadTile"),n(null)))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,n){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aS{constructor(h,n,a,d){super(h,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.aT(this.urls,((n,a)=>{this._loaded=!0,n?this.fire(new r.y(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(h,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aS,model:class extends r.E{constructor(h,n,a,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const h=[];for(const n in this._options.models){const a=this._options.models[n],d=r.aV(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then((_=>{if(!_)return;const b=r.aW(_),T=new r.aX(n,a.position,a.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)})).catch((_=>{this.fire(new r.y(new Error(`Could not load model ${n} from ${a.uri}: ${_.message}`)))}));h.push(d)}Promise.allSettled(h).then((()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new r.y(new Error(`Could not load models: ${n.message}`)))}))}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,n){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(h,n,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(h)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=rs(this._options,this.map._requestManager,n,a,((d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.y(d))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new ul(_.bounds,this.minzoom,this.maxzoom)),Oe(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)}))}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=n;else{if(h.buckets){const b=Object.values(h.buckets);for(const T of b)T.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,_.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(b,T){return h.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&T&&h.setExpiryData(T),h.loadModelData(T,this.map.painter),h.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aS{constructor(h,n,a,d){super(h,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((b=>typeof b!="number"))))||this.fire(new r.y(new r.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof r.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends r.E{constructor(h,n,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ul(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:a,y:d,z:_}=h.tileID.canonical,b=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:_},{signal:b.signal})).then((function(T){return delete h.request,h.aborted?(h.state="unloaded",n(null)):T===void 0?(h.state="errored",n(null)):T===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):(function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement})(T)?(this.loadTileData(h,T),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((T=>{T.name!=="AbortError"&&(h.state="errored",n(T))})),h.request.cancel=()=>b.abort()}loadTileData(h,n){h.setTexture(n,this.map.painter)}unloadTile(h,n){if(h.texture&&h.texture instanceof r.T?(h.destroy(!0),h.texture&&h.texture instanceof r.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:d,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:_})}n&&n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z})))}_clearTiles(){const h=r.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},pd=function(h,n,a,d){const _=new Cu[n.type](h,n,a,d);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return r.aY(["load","abort","unload","serialize","prepare"],_),_};function md(h,n,a=""){return`${a}:${n.id||""}:${n.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:_,importId:b}=d;return`featureset:${_}${b?`:import:${b}`:""}`}})(h.target)}`}function hc(h,n,a,d=""){if(h.uniqueFeatureID){const _=md(h,n,d);if(a.has(_))return!0;a.add(_)}return!1}function gd(h,n,a,d,_=!1){const b=n.sourceCache.transform,T=n.sourceCache.tilesIn(h,n.has3DLayers,_);T.sort(bf);const P=[];for(const k of T){const G=k.tile.queryRenderedFeatures(n,k,a,d,b,_);Object.keys(G).length&&P.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:G})}return P.length===0?{}:(function(k){const G={},q={};for(const te of k){const Y=te.queryResults,re=te.wrappedTileID,le=q[re]=q[re]||{};for(const ce in Y){const Pe=Y[ce],me=le[ce]=le[ce]||{},Me=G[ce]=G[ce]||[];for(const Le of Pe)me[Le.featureIndex]||(me[Le.featureIndex]=!0,Me.push(Le))}}return G})(P)}function xf(h,n,a,d,_,b){const T={},P=d.queryRenderedSymbols(h),k=[];for(const G of Object.keys(P).map(Number))k.push(_[G]);k.sort(bf);for(const G of k){const q=G.featureIndex.lookupSymbolFeatures(P[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,n,a,b);for(const te in q){const Y=T[te]=T[te]||[],re=q[te];re.sort(((le,ce)=>{const Pe=G.featureSortOrder;if(Pe){const me=Pe.indexOf(le.featureIndex);return Pe.indexOf(ce.featureIndex)-me}return ce.featureIndex-le.featureIndex}));for(const le of re)Y.push(le)}}return T}function Ua(h,n){const a=h.getRenderableIds().map((b=>h.getTileByID(b))),d=[],_={};for(let b=0;b<a.length;b++){const T=a[b],P=T.tileID.canonical.key;_[P]||(_[P]=!0,T.querySourceFeatures(d,n))}return d}function bf(h,n){const a=h.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function wf(h,n){const a={};if(!n)return a;for(const d of h){const _=d.layerIds.map((b=>n.getLayer(b))).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((b=>_.filter((T=>T.id===b))[0])));for(const b of _)a[b.fqid]=d}}return a}const va=32,ja=33,Fl=new Uint16Array(8184);for(let h=0;h<2046;h++){let n=h+2,a=0,d=0,_=0,b=0,T=0,P=0;for(1&n?_=b=T=va:a=d=P=va;(n>>=1)>1;){const G=a+_>>1,q=d+b>>1;1&n?(_=a,b=d,a=T,d=P):(a=_,d=b,_=T,b=P),T=G,P=q}const k=4*h;Fl[k+0]=a,Fl[k+1]=d,Fl[k+2]=_,Fl[k+3]=b}const Pa=new Uint16Array(2178),Is=new Uint8Array(1089),Nc=new Uint16Array(1089);function Sf(h){return h===0?-.03125:h===32?.03125:0}const _d={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class fc{constructor(n,a,d,_,b,T){this.tileID=n,this.uid=r.b2(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=T}registerFadeDuration(n){const a=n+this.timeAdded;a<r.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,d){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=wf(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof r.b4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof r.b4&&b.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const _ in this.buckets){const b=this.buckets[_],T=a.style.getOwnLayer(_);if(!T)continue;const P=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,P)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,a,d){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,wf(n.buckets,a.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(n)}const a=n.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new r.T(n,d.image,a.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=a.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(n,a,d,_,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=(function(k,G){const q=r.bq([],[.5*k.width,.5*-k.height,1]);return r.br(q,q,[1,-1,0]),r.aB(q,q,k.calculateProjMatrix(G.toUnwrapped())),Float32Array.from(q)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:a,pixelPosMatrix:P,transform:_,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),b=a?a.sourceLayer:"",T=_._geojsonTileLayer||_[b];if(!T)return;const P=r.b6(a&&a.filter),{z:k,x:G,y:q}=this.tileID.canonical,te={z:k,x:G,y:q};for(let Y=0;Y<T.length;Y++){const re=T.feature(Y);if(P.needGeometry){const Pe=r.b7(re,!0);if(!P.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Pe,this.tileID.canonical))continue}else if(!P.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re))continue;const le=d.getId(re,b),ce=new r.b8(re,k,G,q,le);ce.tile=te,n.push(ce)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const d=r.b9(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(a)if(this.expirationTime<a)_=!0;else{const b=this.expirationTime-a;b?this.expirationTime=d+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,a){if(!this.latestFeatureIndex||!n.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=n.style.listImages(),b=n.style.getBrightness();for(const T in this.buckets){if(!n.style.hasLayer(T))continue;const P=this.buckets[T],k=P.layers[0],G=k.sourceLayer||"_geojsonTileLayer",q=d[G],te=n.style.getLayerSourceCache(k);let Y={};te&&(Y=te._state.getState(G,void 0));const re=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(Y).length>0&&!a;(le&&P.stateDependentLayers.length!==0||a)&&P.update(Y,q,_,re,le?P.stateDependentLayers:P.layers,a,b),(P instanceof r.ba||P instanceof r.bb)&&n._terrain&&n._terrain.enabled&&te&&P.uploadPending()&&n._terrain._clearRenderCacheForTile(te.id,this.tileID);const ce=n&&n.style&&n.style.getOwnLayer(T);ce&&(this.queryPadding=Math.max(this.queryPadding,ce.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.o.now()+n}setTexture(n,a){const d=a.context,_=d.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n):(this.texture=new r.T(d,n,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,a){const d={};for(const _ of a)d[_]=!0;this.dependencies[n]=d}hasDependency(n,a){for(const d of n){const _=this.dependencies[d];if(_){for(const b of a)if(_[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const d=r.bc(_d,this.tileID.canonical,this.tileTransform)[0],_=new r.bd,b=new r.be;for(let T=0;T<d.length;T++){const{x:P,y:k}=d[T];_.emplaceBack(P,k),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(_,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,_.length,b.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const d=r.bc(_d,this.tileID.canonical,this.tileTransform)[0];let _,b;if(this.isRaster){const T=(function(P,k){const G=r.aZ(P,k),q=Math.pow(2,P.z);for(let Pe=0;Pe<ja;Pe++)for(let me=0;me<ja;me++){const Me=r.a_((P.x+(me+Sf(me))/va)/q),Le=r.a$((P.y+(Pe+Sf(Pe))/va)/q),Fe=k.project(Me,Le),Ze=Pe*ja+me;Pa[2*Ze+0]=Math.round((Fe.x*G.scale-G.x)*r.al),Pa[2*Ze+1]=Math.round((Fe.y*G.scale-G.y)*r.al)}Is.fill(0),Nc.fill(0);for(let Pe=2045;Pe>=0;Pe--){const me=4*Pe,Me=Fl[me+0],Le=Fl[me+1],Fe=Fl[me+2],Ze=Fl[me+3],He=Me+Fe>>1,Ye=Le+Ze>>1,qe=He+Ye-Le,We=Ye+Me-He,Xe=Le*ja+Me,Tt=Ze*ja+Fe,ht=Ye*ja+He,Lt=Math.hypot((Pa[2*Xe+0]+Pa[2*Tt+0])/2-Pa[2*ht+0],(Pa[2*Xe+1]+Pa[2*Tt+1])/2-Pa[2*ht+1])>=16;Is[ht]=Is[ht]||(Lt?1:0),Pe<1022&&(Is[ht]=Is[ht]||Is[(Le+We>>1)*ja+(Me+qe>>1)]||Is[(Ze+We>>1)*ja+(Fe+qe>>1)])}const te=new r.b0,Y=new r.b1;let re=0;function le(Pe,me){const Me=me*ja+Pe;return Nc[Me]===0&&(te.emplaceBack(Pa[2*Me+0],Pa[2*Me+1],Pe*r.al/va,me*r.al/va),Nc[Me]=++re),Nc[Me]-1}function ce(Pe,me,Me,Le,Fe,Ze){const He=Pe+Me>>1,Ye=me+Le>>1;if(Math.abs(Pe-Fe)+Math.abs(me-Ze)>1&&Is[Ye*ja+He])ce(Fe,Ze,Pe,me,He,Ye),ce(Me,Le,Fe,Ze,He,Ye);else{const qe=le(Pe,me),We=le(Me,Le),Xe=le(Fe,Ze);Y.emplaceBack(qe,We,Xe)}}return ce(0,0,va,va,va,0),ce(va,va,0,0,0,va),{vertices:te,indices:Y}})(this.tileID.canonical,a);_=T.vertices,b=T.indices}else{_=new r.b0,b=new r.b1;for(const{x:P,y:k}of d)_.emplaceBack(P,k,0,0);const T=r.bh(_.int16.subarray(0,4*_.length),void 0,4);for(let P=0;P<T.length;P+=3)b.emplaceBack(T[P],T[P+1],T[P+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,r.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=r.bg.simpleSegment(0,0,_.length,b.length)}_makeGlobeTileDebugBuffers(n,a){const d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;const _=this.tileID.canonical,b=r.bj(_,a),T=r.bk(b),P=r.aj(a.zoom);let k;P>0&&(k=r.bl(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,a,T,k,P),this._makeGlobeTileDebugTextBuffer(n,_,a,T,k,P)}_globePoint(n,a,d,_,b,T,P){let k=r.bm(n,a,d);if(T){const G=1<<d.z,q=r.aF(_.center.lng),te=r.aJ(_.center.lat),Y=(d.x+.5)/G-q;let re=0;Y>.5?re=-1:Y<-.5&&(re=1);let le=(n/r.al+d.x)/G+re,ce=(a/r.al+d.y)/G;le=(le-q)*_._pixelsPerMercatorPixel+q,ce=(ce-te)*_._pixelsPerMercatorPixel+te;const Pe=[le*_.worldSize,ce*_.worldSize,0];r.af(Pe,Pe,T),k=r.bn(k,Pe,P)}return r.af(k,k,b)}_makeGlobeTileDebugBorderBuffer(n,a,d,_,b,T){const P=new r.bd,k=new r.be,G=new r.bo,q=(Y,re,le,ce,Pe)=>{const me=(le-Y)/(Pe-1),Me=(ce-re)/(Pe-1),Le=P.length;for(let Fe=0;Fe<Pe;Fe++){const Ze=Y+Fe*me,He=re+Fe*Me;P.emplaceBack(Ze,He);const Ye=this._globePoint(Ze,He,a,d,_,b,T);G.emplaceBack(Ye[0],Ye[1],Ye[2]),k.emplaceBack(Le+Fe)}},te=r.al;q(0,0,te,0,16),q(te,0,te,te,16),q(te,te,0,te,16),q(0,te,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(k),this._tileDebugBuffer=n.createVertexBuffer(P,r.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(G,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,P.length,k.length)}_makeGlobeTileDebugTextBuffer(n,a,d,_,b,T){const P=r.al/4,k=new r.bd,G=new r.b1,q=new r.bo,te=25;G.reserve(32),k.reserve(te),q.reserve(te);const Y=(re,le)=>te*re+le;for(let re=0;re<te;re++){const le=re*P;for(let ce=0;ce<te;ce++){const Pe=ce*P;k.emplaceBack(Pe,le);const me=this._globePoint(Pe,le,a,d,_,b,T);q.emplaceBack(me[0],me[1],me[2])}}for(let re=0;re<4;re++)for(let le=0;le<4;le++){const ce=Y(re,le),Pe=Y(re,le+1),me=Y(re+1,le),Me=Y(re+1,le+1);G.emplaceBack(ce,Pe,me),G.emplaceBack(me,Pe,Me)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(G),this._tileDebugTextBuffer=n.createVertexBuffer(k,r.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(q,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,te,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class bh extends fc{constructor(n,a,d,_,b){super(n,a,d,_,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,a,d){const _=d.context,b=_.gl;let T=this.texturePerLayer.get(n)||d.getTileTexture(a.width);T&&T instanceof r.T?T.update(a,{premultiply:!1}):T=new r.T(_,a,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,T)}flushQueues(n){const a=this._workQueuePerLayer.get(n)||[],d=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}}fetchHeader(n=16384,a){const d=this._mrt=new r.bs(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.bu(_,((b,T,P,k)=>{if(b)a(b);else try{const G=d.getHeaderLength(T);if(G>n)return void(this.request=this.fetchHeader(G,a));d.parseHeader(T),this._isHeaderLoaded=!0;let q=0;for(const te of Object.values(d.layers))q=Math.max(q,te.dataIndex[te.dataIndex.length-1].lastByte);T.byteLength>=q&&(this.entireBuffer=T),a(null,this.entireBuffer||T,P,k)}catch(G){a(G)}})),this.request}fetchBandForRender(n,a,d,_){this.fetchBand(n,a,d,(b=>{if(b)return void _(b);this.updateTextureDescriptor(n,a,d);const T=this.textureDescriptorPerLayer.get(a);_(null,T?T.img:null)}))}fetchBand(n,a,d,_,b=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void _(new Error("Tile header is not ready"));const P=this.actor;if(!P)return void _(new Error("Can't fetch tile band without an actor"));let k;const G=r.B(String(d),r.B(this.tileID.key,n));let q=this._taskQueue.get(G);q?q.add(_):(q=new Set,q.add(_),this._taskQueue.set(G,q));const te=(ce,Pe)=>{k.complete(ce,Pe),ce?_(ce):(q.values().forEach((me=>me(null,Pe))),this._taskQueue.delete(G))},Y=(ce,Pe)=>{if(ce)return _(ce);const me=P.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Pe,task:k},te,void 0,!0);if(a!==null){const Me=this._workQueuePerLayer.get(a)||[];Me.push((()=>{me&&me.cancel(),k.cancel()})),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,Me)}};let re;try{re=T.getLayer(n)}catch(ce){if(this.state==="reloading")return;throw ce}if(!re)return void _(new Error(`Unknown sourceLayer "${n}"`));if(re.hasDataForBand(d))return q.values().forEach((ce=>ce(null,null))),void this._taskQueue.delete(G);const le=re.getDataRange([d]);if(k=T.createDecodingTask(le),!k||k.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)Y(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const ce=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),Pe=r.bu(ce,Y);if(a!==null){const me=this._fetchQueuePerLayer.get(a)||[];me.push((()=>{Pe.cancel(),k.cancel()})),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,me)}}}updateNeeded(n,a){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,a,d){if(!this._mrt)return;const _=this._mrt.getLayer(n);if(!_||!_.hasBand(d)||!_.hasDataForBand(d))return;const{bytes:b,tileSize:T,buffer:P,offset:k,scale:G}=_.getBandView(d),q=T+2*P,te=new r.q({width:q,height:q},b),Y=this.texturePerLayer.get(a);Y&&Y instanceof r.T&&Y.update(te,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:n,band:d,img:te,buffer:P,offset:k,tileSize:T,format:_.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const a of this.texturePerLayer.values())a&&a instanceof r.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class yd{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,d){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const b={value:a,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout((()=>{this.remove(n,b)}),d)),this.data[_].push(b),this.order.push(_),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const d=n.wrapped().key,_=a===void 0?0:this.data[d].indexOf(a),b=this.data[d][_];return this.data[d].splice(_,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const d in this.data)for(const _ of this.data[d])n(_.value)||a.push(_);for(const d of a)this.remove(d.value.tileID,d)}}class dl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,d){const _=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},Object.assign(this.stateChanges[n][_],d),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==_&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const b in this.state[n][_])d[b]||(this.deletedStates[n][_][b]=null)}else for(const b in d)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][b]===null&&delete this.deletedStates[n][_][b]}removeFeatureState(n,a,d){if(this.deletedStates[n]===null)return;const _=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&a!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][d]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(d in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][d]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,a){const d=this.state[n]||{},_=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(a!==void 0){const P=String(a),k=Object.assign({},d[P],_[P]);if(b){const G=b[a];if(G===null)return{};for(const q in G)delete k[q]}return k}const T=Object.assign({},d,_);if(b)for(const P in b)delete T[P];return T}initializeTileState(n,a){n.refreshFeatureState(a)}coalesceChanges(n,a){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const b={};for(const T in this.stateChanges[_])this.state[_][T]||(this.state[_][T]={}),Object.assign(this.state[_][T],this.stateChanges[_][T]),b[T]=this.state[_][T];d[_]=b}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const b={};if(this.deletedStates[_]===null)for(const T in this.state[_])b[T]={},this.state[_][T]={};else for(const T in this.deletedStates[_]){if(this.deletedStates[_][T]===null)this.state[_][T]={};else if(this.state[_][T])for(const P of Object.keys(this.deletedStates[_][T]))delete this.state[_][T][P];b[T]=this.state[_][T]}d[_]=d[_]||{},Object.assign(d[_],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in n)n[_].refreshFeatureState(a)}}class Hs extends r.E{constructor(n,a,d){super(),this.id=n,this._onlySymbols=d,a.on("data",(_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),a.on("error",(()=>{this._sourceErrored=!0})),this._source=a,this._tiles={},this._cache=new yd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new dl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(n),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(Tf).map((n=>n.key))}getRenderableIds(n,a){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,a)&&d.push(this._tiles[_]);return n?d.sort(((_,b)=>{const T=_.tileID,P=b.tileID,k=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),G=new r.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||G.y-k.y||G.x-k.x})).map((_=>_.tileID.key)):d.map((_=>_.tileID)).sort(Tf).map((_=>_.key))}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(d||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const d=this._tiles[n];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,n,a)))}_tileLoaded(n,a,d,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new r.y(_,{tile:n}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.o.now(),d==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let _=0;_<a.length;_++){const b=a[_];if(n.neighboringTiles&&n.neighboringTiles[b]){const T=this.getTileByID(b);d(n,T),d(T,n)}}function d(_,b){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-_.tileID.canonical.x;const P=b.tileID.canonical.y-_.tileID.canonical.y,k=Math.pow(2,_.tileID.canonical.z),G=b.tileID.key;T===0&&P===0||Math.abs(P)>1||(Math.abs(T)>1&&(Math.abs(T+k)===1?T+=k:Math.abs(T-k)===1&&(T-=k)),b.dem&&_.dem&&(_.dem.backfillBorder(b.dem,T,P),_.neighboringTiles&&_.neighboringTiles[G]&&(_.neighboringTiles[G].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,d,_){for(const b in this._tiles){let T=this._tiles[b];if(_[b]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>d)continue;let P=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const G=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[G.key],T&&T.hasData()&&(P=G)}let k=P;for(;k.overscaledZ>a;)if(k=k.scaledTo(k.overscaledZ-1),n[k.key]){_[P.key]=P;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const d=this._loadedParentTiles[n.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=n.overscaledZ-1;d>=a;d--){const _=n.scaledTo(d),b=this._getLoadedTile(_);if(b)return b}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const d=Math.ceil(n.width/a)+1,_=Math.ceil(n.height/a)+1,b=Math.floor(d*_*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(P)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const d={};for(const _ in this._tiles){const b=this._tiles[_];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),d[b.tileID.key]=b}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,a,d,_,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let P,k=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const Y=G.attenuationRange()[0],re=Math.floor(Y)-Math.log2(G.getDemUpscale());k>re&&(k=re)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((Y=>new r.aO(Y.canonical.z,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y)));else if(this.tileCoverLift!==0){const Y=n.clone();Y.tileCoverLift=this.tileCoverLift,P=Y.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&n.projection.name==="globe"&&(P.push(new r.aO(1,0,1,0,0)),P.push(new r.aO(1,0,1,1,0)),P.push(new r.aO(1,0,1,0,1)),P.push(new r.aO(1,0,1,1,1)))}else if(P=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const Y=this._source.hasTile.bind(this._source);P=P.filter((re=>Y(re)))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Eu(this._source.type)){const Y=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),re=Math.min(Y,this._source.maxzoom);if(T){const le=n.extendTileCover(P,re);for(const ce of le)P.push(ce)}else if(b){const le=n.extendTileCoverToNearPlane(P,this.transform.getFrustum(re),re);for(const ce of le)P.push(ce)}else if(this.castsShadows&&_){const le=n.extendTileCover(P,re,_);for(const ce of le)this._shadowCasterTiles[ce.key]=!0,P.push(ce)}}const q=this._updateRetainedTiles(P);if(Eu(this._source.type)&&P.length!==0){const Y={},re={},le=Object.keys(q);for(const Pe of le){const me=q[Pe],Me=this._tiles[Pe];if(!Me||Me.fadeEndTime&&Me.fadeEndTime<=r.o.now())continue;const Le=this.findLoadedParent(me,Math.max(me.overscaledZ-Hs.maxOverzooming,this._source.minzoom));Le&&(this._addTile(Le.tileID),Y[Le.tileID.key]=Le.tileID),re[Pe]=me}const ce=P[P.length-1].overscaledZ;for(const Pe in this._tiles){const me=this._tiles[Pe];if(q[Pe]||!me.hasData())continue;let Me=me.tileID;for(;Me.overscaledZ>ce;){Me=Me.scaledTo(Me.overscaledZ-1);const Le=this._tiles[Me.key];if(Le&&Le.hasData()&&re[Me.key]){q[Pe]=me.tileID;break}}}for(const Pe in Y)q[Pe]||(this._coveredTiles[Pe]=!0,q[Pe]=Y[Pe])}for(const Y in q)this._tiles[Y].clearFadeHold();const te=r.bv(this._tiles,q);for(const Y of te){const re=this._tiles[Y];re.hasSymbolBuckets&&!re.holdingForFade()?re.setHoldDuration(this.map._fadeDuration):re.hasSymbolBuckets&&!re.symbolFadeFinished()||this._removeTile(+Y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const d={},_=n.reduce(((G,q)=>Math.min(G,q.overscaledZ)),1/0),b=n[0].overscaledZ,T=Math.max(b-Hs.maxOverzooming,this._source.minzoom),P=Math.max(b+Hs.maxUnderzooming,this._source.minzoom),k={};for(const G of n){const q=this._addTile(G);a[G.key]=G,q.hasData()||_<this._source.maxzoom&&(k[G.key]=G)}this._retainLoadedChildren(k,_,P,a);for(const G of n){let q=this._tiles[G.key];if(q.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const Y=G.children(this._source.maxzoom)[0],re=this.getTile(Y);if(re&&re.hasData()){a[Y.key]=Y;continue}}else{const Y=G.children(this._source.maxzoom);if(a[Y[0].key]&&a[Y[1].key]&&a[Y[2].key]&&a[Y[3].key])continue}let te=q.wasRequested();for(let Y=G.overscaledZ-1;Y>=T;--Y){const re=G.scaledTo(Y);if(d[re.key]||(d[re.key]=!0,q=this.getTile(re),!q&&te&&(q=this._addTile(re)),q&&(a[re.key]=re,te=q.wasRequested(),q.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let d,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}a.push(_.key);const b=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;_=b}for(const b of a)this._loadedParentTiles[b]=d}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const d=!!a;if(!d){const _=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new bh(n,b,this.transform.tileZoom,_,this._isRaster):new fc(n,b,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a.uses++,this._tiles[n.key]=a,d||this._source.fire(new r.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const d=a.getExpiryTimeout();d&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),d))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,d){const _=[],b=this.transform;if(!b)return _;const T=b.projection.name==="globe",P=r.aF(b.center.lng);for(const k in this._tiles){const G=this._tiles[k];if(d&&G.clearQueryDebugViz(),G.holdingForFade())continue;let q;if(T){const te=G.tileID.canonical;if(te.z===0){const Y=[Math.abs(r.aA(P,...Bl(te,-1))-P),Math.abs(r.aA(P,...Bl(te,1))-P)];q=[0,2*Y.indexOf(Math.min(...Y))-1]}else{const Y=[Math.abs(r.aA(P,...Bl(te,-1))-P),Math.abs(r.aA(P,...Bl(te,0))-P),Math.abs(r.aA(P,...Bl(te,1))-P)];q=[Y.indexOf(Math.min(...Y))-1]}}else q=[0];for(const te of q){const Y=n.containsTile(G,b,a,te);Y&&_.push(Y)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const d=this.getRenderableIds(n,a).map((b=>this._tiles[b].tileID)),_=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=_?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(n){const a=n.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),b={};for(const T of a){const P=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*P+T.wrap-d[0])*_[0]+((T.canonical.y+.5)*P-d[1])*_[1]-d[2]*_[2]}return a.sort(((T,P)=>b[T.key]-b[P.key])),a}hasTransition(){if(this._source.hasTransition())return!0;if(Eu(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(n,a,d){this._state.updateState(n=n||"_geojsonTileLayer",a,d)}removeFeatureState(n,a,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,d)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,d){const _=this._tiles[n];_&&_.setDependencies(a,d)}reloadTilesForDependencies(n,a){for(const d in this._tiles)this._tiles[d].hasDependency(n,a)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(n,a)))}_preloadTiles(n,a){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(n,a))};return void this._source.on("data",k)}const d=new Map,_=Array.isArray(n)?n:[n],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const k of _){const G=k.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const q of G)d.set(q.key,q);this.usedForTerrain&&k.updateElevation(!1)}const P=Array.from(d.values());r.bw(P,((k,G)=>{const q=new fc(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(q,(te=>{this._source.type==="raster-dem"&&q.dem&&this._backfillDEM(q),G(te,q)}))}),a)}}function Tf(h,n){const a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return h.overscaledZ-n.overscaledZ||d-a||n.canonical.y-h.canonical.y||n.canonical.x-h.canonical.x}function Eu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Bl(h,n){const a=1<<h.z;return[h.x/a+n,(h.x+1)/a+n]}Hs.maxOverzooming=10,Hs.maxUnderzooming=3;class wh{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:n,visibilityChanged:a});else if(_.type==="model"){const b=this.style.getLayerSource(_);b&&b.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const d=a.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(n)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?_=!d.isHidden(n)&&d.paint.get("building-opacity")>0:d.type==="model"&&(_=!d.isHidden(n)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&a.visible,a.visible=_}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const _ of this.layers){const b=_.layer,T=this.style.getLayerSourceCache(b);let P=1;b.type==="fill-extrusion"?P=_.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(P=_.visible?b.paint.get("building-vertical-scale"):0);let k=T?T.getTile(a):null;if(!k&&T)for(const G in T._tiles){const q=T._tiles[G];if(a.canonical.isChildOf(q.tileID.canonical)){k=q;break}}this.currentBuildingBuckets.push({bucket:k?k.getBucket(b):null,tileID:k?k.tileID:a,verticalScale:P})}n.hasAnyZOffset=!1;let d=!1;for(let _=0;_<n.symbolInstances.length;_++){const b=n.symbolInstances.get(_),T=b.zOffset,P=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=P!==Number.NEGATIVE_INFINITY?P:T,d||T===b.zOffset||(d=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}d&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,d,_){let b=a,T=d;if(n.canonical.z!==_.canonical.z){const P=_.canonical,k=1/(1<<n.canonical.z-P.z);b=(a+n.canonical.x*r.al)*k-P.x*r.al|0,T=(d+n.canonical.y*r.al)*k-P.y*r.al|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(n,a,d){let _,b;for(let T=0;T<this.layers.length;++T){const P=this.layers[T].layer;if(P.type!=="fill-extrusion"&&P.type!=="building")continue;const{bucket:k,tileID:G,verticalScale:q}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:te,tileY:Y}=this._mapCoordToOverlappingTile(n,a,d,G),re=k.getHeightAtTileCoord(te,Y);re&&re.height!==void 0&&(re.hidden?_=re.height:b=Math.max(re.height*q,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const P=this.layers[T];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:k,tileID:G}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:q,tileY:te}=this._mapCoordToOverlappingTile(n,a,d,G),Y=k.getHeightAtTileCoord(q,te);if(Y&&!Y.hidden)return Y.height===void 0&&_!==void 0?Math.min(Y.maxHeight,_)*Y.verticalScale:Y.height?Y.height*Y.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Cf(h,n){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return r.bx.forEach((d=>{d in n&&(a[d]=n[d])})),a}function Sh(h){h=h.slice();const n=Object.create(null);for(let a=0;a<h.length;a++)n[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Cf(h[a],n[h[a].ref]));return h}const Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Au(h,n,a){a.push({command:Wr.addSource,args:[h,n[h]]})}function Gp(h,n,a){n.push({command:Wr.removeSource,args:[h]}),a[h]=!0}function Ef(h,n,a,d){Gp(h,a,d),Au(h,n,a)}function Th(h,n,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!r.by(h[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!r.by(h[a][d],n[a][d]))return!1;return!0}function pc(h,n,a,d,_,b){let T;for(T in n=n||{},h=h||{})h.hasOwnProperty(T)&&(r.by(h[T],n[T])||a.push({command:b,args:[d,T,n[T],_]}));for(T in n)n.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(r.by(h[T],n[T])||a.push({command:b,args:[d,T,n[T],_]}))}function Vc(h){return h.id}function vd(h,n){return h[n.id]=n,h}function Ch(h,n,a){const d=n.createTileMatrix(h,h.worldSize,a.toUnwrapped());return r.aB(new Float32Array(16),h.projMatrix,d)}function $p(h,n,a){if(n.projection.name===a.projection.name)return h.projMatrix;const d=a.clone();return d.setProjection(n.projection),Ch(d,n.getProjection(),h)}function mc(h,n,a){return n.name===a.projection.name?h.projMatrix:Ch(a,n,h)}class Hp{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.aA(n,0,1);let a=1,d=this._distances[a];const _=n*this.paddedLength+this.padding;for(;d<_&&a<this._distances.length;)d=this._distances[++a];const b=a-1,T=this._distances[b],P=d-T,k=P>0?(_-T)/P:0;return this.points[b].mult(1-k).add(this.points[a].mult(k))}}class Af{constructor(n,a,d){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,_,b){this._forEachCell(a,d,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(n,a,d,_){this._forEachCell(a-_,d-_,a+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(_)}_insertBoxCell(n,a,d,_,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,a,d,_,b,T){this.circleCells[b].push(T)}_query(n,a,d,_,b,T){if(d<0||n>this.width||_<0||a>this.height)return!b&&[];const P=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=_){if(b)return!0;for(let k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const G=this.circles[3*k],q=this.circles[3*k+1],te=this.circles[3*k+2];P.push({key:this.circleKeys[k],x1:G-te,y1:q-te,x2:G+te,y2:q+te})}return T?P.filter(T):P}return this._forEachCell(n,a,d,_,this._queryCell,P,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?P.length>0:P}_queryCircle(n,a,d,_,b){const T=n-d,P=n+d,k=a-d,G=a+d;if(P<0||T>this.width||G<0||k>this.height)return!_&&[];const q=[];return this._forEachCell(T,k,P,G,this._queryCellCircle,q,{hitTest:_,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},b),_?q.length>0:q}query(n,a,d,_,b){return this._query(n,a,d,_,!1,b)}hitTest(n,a,d,_,b){return this._query(n,a,d,_,!0,b)}hitTestCircle(n,a,d,_){return this._queryCircle(n,a,d,!0,_)}_queryCell(n,a,d,_,b,T,P,k){const G=P.seenUids,q=this.boxCells[b];if(q!==null){const Y=this.bboxes;for(const re of q)if(!G.box[re]){G.box[re]=!0;const le=4*re;if(n<=Y[le+2]&&a<=Y[le+3]&&d>=Y[le+0]&&_>=Y[le+1]&&(!k||k(this.boxKeys[re]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[re],x1:Y[le],y1:Y[le+1],x2:Y[le+2],y2:Y[le+3]})}}}const te=this.circleCells[b];if(te!==null){const Y=this.circles;for(const re of te)if(!G.circle[re]){G.circle[re]=!0;const le=3*re;if(this._circleAndRectCollide(Y[le],Y[le+1],Y[le+2],n,a,d,_)&&(!k||k(this.circleKeys[re]))){if(P.hitTest)return T.push(!0),!0;{const ce=Y[le],Pe=Y[le+1],me=Y[le+2];T.push({key:this.circleKeys[re],x1:ce-me,y1:Pe-me,x2:ce+me,y2:Pe+me})}}}}}_queryCellCircle(n,a,d,_,b,T,P,k){const G=P.circle,q=P.seenUids,te=this.boxCells[b];if(te!==null){const re=this.bboxes;for(const le of te)if(!q.box[le]){q.box[le]=!0;const ce=4*le;if(this._circleAndRectCollide(G.x,G.y,G.radius,re[ce+0],re[ce+1],re[ce+2],re[ce+3])&&(!k||k(this.boxKeys[le])))return T.push(!0),!0}}const Y=this.circleCells[b];if(Y!==null){const re=this.circles;for(const le of Y)if(!q.circle[le]){q.circle[le]=!0;const ce=3*le;if(this._circlesCollide(re[ce],re[ce+1],re[ce+2],G.x,G.y,G.radius)&&(!k||k(this.circleKeys[le])))return T.push(!0),!0}}}_forEachCell(n,a,d,_,b,T,P,k){const G=this._convertToXCellCoord(n),q=this._convertToYCellCoord(a),te=this._convertToXCellCoord(d),Y=this._convertToYCellCoord(_);for(let re=G;re<=te;re++)for(let le=q;le<=Y;le++)if(b.call(this,n,a,d,_,this.xCellCount*le+re,T,P,k))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,_,b,T){const P=_-n,k=b-a,G=d+T;return G*G>P*P+k*k}_circleAndRectCollide(n,a,d,_,b,T,P){const k=(T-_)/2,G=Math.abs(n-(_+k));if(G>k+d)return!1;const q=(P-b)/2,te=Math.abs(a-(b+q));if(te>q+d)return!1;if(G<=k||te<=q)return!0;const Y=G-k,re=te-q;return Y*Y+re*re<=d*d}}const xd={unknown:0,flipRequired:1,flipNotRequired:2},Pf=Math.tan(85*Math.PI/180);function Ga(h,n,a,d,_,b,T){const P=r.bC();if(a)if(b.name==="globe"){const k=r.bD(_,n);r.aB(P,P,k)}else{const k=r.bE([],T);P[0]=k[0],P[1]=k[1],P[4]=k[2],P[5]=k[3],d||r.bB(P,P,_.angle)}else r.aB(P,_.labelPlaneMatrix,h);return P}function gc(h,n,a,d,_,b,T){const P=Ga(h,n,a,d,_,b,T);return b.name==="globe"&&a||(P[2]=P[6]=P[10]=P[14]=0),P}function bd(h,n,a,d,_,b,T){if(a){if(b.name==="globe"){const P=Ga(h,n,a,d,_,b,T);return r.bl(P,P),r.aB(P,h,P),P}{const P=r.bz(h),k=r.bA([]);return k[0]=T[0],k[1]=T[1],k[4]=T[2],k[5]=T[3],r.aB(P,P,k),d||r.bB(P,P,-_.angle),P}}return _.glCoordMatrix}function qs(h,n,a,d){const _=[h,n,a,1];a?r.aC(_,_,d):hl(_,_,d);const b=_[3];return _[0]/=b,_[1]/=b,_[2]/=b,_}function Uc(h,n){return Math.min(.5+h/n*.5,1.5)}function xa(h,n){const a=h[0]/h[3],d=h[1]/h[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function wd(h,n,a,d,_,b,T,P,k,G){const q=a.transform,te=d?h.textSizeData:h.iconSizeData,Y=r.bK(te,a.transform.zoom),re=q.projection.name==="globe",le=[256/a.width*2+1,256/a.height*2+1],ce=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ce.clear();let Pe=null;re&&(Pe=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const me=h.lineVertexArray,Me=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Le=a.transform.width/a.transform.height;let Fe,Ze=!1;for(let He=0;He<Me.length;He++){const Ye=Me.get(He),{numGlyphs:qe,writingMode:We}=Ye;if(We!==r.bL.vertical||Ze||Fe===r.bL.horizontal||(Ze=!0),Fe=We,(Ye.hidden||We===r.bL.vertical)&&!Ze){Qn(qe,ce);continue}Ze=!1;const Xe=new r.P(Ye.tileAnchorX,Ye.tileAnchorY);let{x:Tt,y:ht,z:Lt}=q.projection.projectTilePoint(Xe.x,Xe.y,G.canonical);if(k){const[en,Nn,En]=k(Xe);Tt+=en,ht+=Nn,Lt+=En}const bt=[Tt,ht,Lt,1];if(r.aC(bt,bt,n),!xa(bt,le)){Qn(qe,ce);continue}const Pt=bt[3],nn=Uc(a.transform.getCameraToCenterDistance(q.projection),Pt),St=r.bM(te,Y,Ye),rt=T?St/nn:St*nn,zt=qs(Tt,ht,Lt,_);if(zt[3]<=0){Qn(qe,ce);continue}let wt={};const Zt=r.an(h.layers[0].layout.get("text-max-angle")),sn=Math.cos(Zt),Sn=T?null:k,Ht=mi(Ye,rt,!1,P,n,_,b,h.glyphOffsetArray,me,ce,Pe,zt,Xe,wt,Le,Sn,q.projection,G,T,sn);Ze=Ht.useVertical,Sn&&Ht.needsFlipping&&(wt={}),(Ht.notEnoughRoom||Ze||Ht.needsFlipping&&mi(Ye,rt,!0,P,n,_,b,h.glyphOffsetArray,me,ce,Pe,zt,Xe,wt,Le,Sn,q.projection,G,T,sn).notEnoughRoom)&&Qn(qe,ce)}d?(h.text.dynamicLayoutVertexBuffer.updateData(ce),Pe&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(Pe)):(h.icon.dynamicLayoutVertexBuffer.updateData(ce),Pe&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(Pe))}function jc(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe){const{lineStartIndex:me,glyphStartIndex:Me,segment:Le}=P,Fe=Me+P.numGlyphs,Ze=me+P.lineLength,He=n.getoffsetX(Me),Ye=n.getoffsetX(Fe-1),qe=Eh(h*He,a,d,_,b,T,Le,me,Ze,k,G,q,te,Y,!0,re,le,ce,Pe);if(!qe)return null;const We=Eh(h*Ye,a,d,_,b,T,Le,me,Ze,k,G,q,te,Y,!0,re,le,ce,Pe);return We?{first:qe,last:We}:null}function Sd(h,n,a,d){return h===r.bL.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===r.bL.vertical?d>0?{needsFlipping:!0}:null:n!==xd.unknown&&(function(_,b){return _===0||Math.abs(b/_)>Pf})(a,d)?n===xd.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function mi(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me,Le){const Fe=n/24,Ze=h.lineOffsetX*Fe,He=h.lineOffsetY*Fe,{lineStartIndex:Ye,glyphStartIndex:qe,numGlyphs:We,segment:Xe,writingMode:Tt,flipState:ht}=h,Lt=Ye+h.lineLength,bt=Pt=>{if(q){const[zt,wt,Zt]=Pt.up,sn=G.length;r.bN(q,sn+0,zt,wt,Zt),r.bN(q,sn+1,zt,wt,Zt),r.bN(q,sn+2,zt,wt,Zt),r.bN(q,sn+3,zt,wt,Zt)}const[nn,St,rt]=Pt.point;r.bO(G,nn,St,rt,Pt.angle)};if(We>1){const Pt=jc(Fe,P,Ze,He,a,te,Y,h,k,b,re,ce,!1,Pe,me,Me,Le);if(!Pt)return{notEnoughRoom:!0};if(d&&!a){let[nn,St,rt]=Pt.first.point,[zt,wt,Zt]=Pt.last.point;[nn,St]=qs(nn,St,rt,T),[zt,wt]=qs(zt,wt,Zt,T);const sn=Sd(Tt,ht,(zt-nn)*le,wt-St);if(h.flipState=sn&&sn.needsFlipping?xd.flipRequired:xd.flipNotRequired,sn)return sn}bt(Pt.first);for(let nn=qe+1;nn<qe+We-1;nn++){const St=Eh(Fe*P.getoffsetX(nn),Ze,He,a,te,Y,Xe,Ye,Lt,k,b,re,ce,!1,!1,Pe,me,Me,Le);if(!St)return G.length-=4*(nn-qe),{notEnoughRoom:!0};bt(St)}bt(Pt.last)}else{if(d&&!a){const nn=qs(Y.x,Y.y,0,_),St=Ye+Xe+1,rt=new r.P(k.getx(St),k.gety(St)),zt=qs(rt.x,rt.y,0,_),wt=zt[3]>0?zt:_c(Y,rt,nn,1,_,void 0,Pe,me.canonical),Zt=Sd(Tt,ht,(wt[0]-nn[0])*le,wt[1]-nn[1]);if(h.flipState=Zt&&Zt.needsFlipping?xd.flipRequired:xd.flipNotRequired,Zt)return Zt}const Pt=Eh(Fe*P.getoffsetX(qe),Ze,He,a,te,Y,Xe,Ye,Lt,k,b,re,ce,!1,!1,Pe,me,Me,Le);if(!Pt)return{notEnoughRoom:!0};bt(Pt)}return{}}function Mf(h,n,a,d,_){const{x:b,y:T,z:P}=d.projectTilePoint(h.x,h.y,n);if(!_)return qs(b,T,P,a);const[k,G,q]=_(h);return qs(b+k,T+G,P+q,a)}function _c(h,n,a,d,_,b,T,P){const k=Mf(h.sub(n)._unit()._add(h),P,_,T,b);return r.av(k,a,k),r.aw(k,k),r.bH(k,a,k,d)}function Eh(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me){const Le=d?h-n:h+n;let Fe=Le>0?1:-1,Ze=0;d&&(Fe*=-1,Ze=Math.PI),Fe<0&&(Ze+=Math.PI);let He=P+T+(Fe>0?0:1)|0,Ye=_,qe=_,We=0,Xe=0;const Tt=Math.abs(Le),ht=[],Lt=[];let bt=b,Pt=bt,nn=r.bF([]);const St=()=>_c(Pt,bt,qe,Tt-We+1,q,Y,ce,Pe.canonical);for(;We+Xe<=Tt;){if(He+=Fe,He<P||He>=k)return null;if(qe=Ye,Pt=bt,ht.push(qe),re&&Lt.push(Pt),bt=new r.P(G.getx(He),G.gety(He)),Ye=te[He],!Ye){const En=Mf(bt,Pe.canonical,q,ce,Y);Ye=En[3]>0?te[He]=En:St()}We+=Xe;const en=r.av([],Ye,qe),Nn=r.bG(qe,Ye);if(a&&Nn>0&&Xe>0&&r.bJ(nn,en)/(Xe*Nn)<Me)return null;Xe=Nn,nn=en}le&&Y&&(te[He]&&(Ye=St(),Xe=r.bG(qe,Ye),nn=r.av([],Ye,qe)),te[He]=Ye);const rt=(Tt-We)/Xe,zt=bt.sub(Pt)._mult(rt)._add(Pt),wt=r.bH([],qe,nn,rt);let Zt=[0,0,1],sn=nn[0],Sn=nn[1];if(me&&(Zt=ce.upVector(Pe.canonical,zt.x,zt.y),Zt[0]!==0||Zt[1]!==0||Zt[2]!==1)){const en=[Zt[2],0,-Zt[0]],Nn=r.bI([],Zt,en);r.aw(en,en),r.aw(Nn,Nn),sn=r.bJ(nn,en),Sn=r.bJ(nn,Nn)}if(a){const en=r.bI([],Zt,nn);r.aw(en,en),r.bH(wt,wt,en,a*Fe)}const Ht=Ze+Math.atan2(Sn,sn);return ht.push(wt),re&&Lt.push(zt),{point:wt,angle:Ht,path:ht,tilePath:Lt,up:Zt}}function Qn(h,n){const a=n.length,d=a+4*h;n.resize(d),n.float32.fill(-1/0,4*a,4*d)}function hl(h,n,a){const d=n[0],_=n[1];return h[0]=a[0]*d+a[4]*_+a[12],h[1]=a[1]*d+a[5]*_+a[13],h[3]=a[3]*d+a[7]*_+a[15],h}const Ws=100;class Ma{constructor(n,a,d=new Af(n.width+200,n.height+200,25),_=new Af(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ws,this.screenBottomBoundary=n.height+Ws,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,_,b,T,P,k,G,q,te){let Y=d.projectedAnchorX,re=d.projectedAnchorY,le=d.projectedAnchorZ;const ce=d.tileAnchorX,Pe=d.tileAnchorY,me=d.elevation,Me=d.tileID,Le=n.getProjection();if(me&&Me){const[Lt,bt,Pt]=Le.upVector(Me.canonical,d.tileAnchorX,d.tileAnchorY),nn=Le.upVectorScale(Me.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Y+=Lt*me*nn,re+=bt*me*nn,le+=Pt*me*nn}const Fe=n.projection.name==="globe",Ze=n.projection.name==="globe"?r.aj(this.transform.zoom):0;if(Me&&Fe&&Ze<1&&!T){const Lt=1<<Me.canonical.z,bt=r.bP(ce,Pe);r.bQ(bt,bt,1/r.al),r.bR(bt,bt,r.bP(Me.canonical.x,Me.canonical.y)),r.bQ(bt,bt,1/Lt),r.bS(bt,bt,r.bP(_[0],_[1])),bt[0]=r.bT(bt[0],-.5,.5),r.bQ(bt,bt,r.al);const Pt=r.bU(bt[0],bt[1],r.al/(2*Math.PI),1);r.aC(Pt,Pt,b),Y=r.ak(Y,Pt[0],Ze),re=r.ak(re,Pt[1],Ze),le=r.ak(le,Pt[2],Ze)}const He=this.projectAndGetPerspectiveRatio(q,Y,re,le,d.tileID,Le.name==="globe"||!!me||this.transform.pitch>0,Le),Ye=G*He.perspectiveRatio,qe=(d.x1*a+P.x-d.padding)*Ye+He.point.x,We=(d.y1*a+P.y-d.padding)*Ye+He.point.y,Xe=(d.x2*a+P.x+d.padding)*Ye+He.point.x,Tt=(d.y2*a+P.y+d.padding)*Ye+He.point.y,ht=He.perspectiveRatio<=.55||He.occluded;return!this.isInsideGrid(qe,We,Xe,Tt)||!k&&this.grid.hitTest(qe,We,Xe,Tt,te)||ht?{box:[],offscreen:!1,occluded:He.occluded}:{box:[qe,We,Xe,Tt],offscreen:this.isOffscreen(qe,We,Xe,Tt),occluded:!1}}placeCollisionCircles(n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce){const Pe=[],me=this.transform.elevation,Me=n.getProjection(),Le=me?me.getAtTileOffsetFunc(ce,this.transform.center.lat,this.transform.worldSize,Me):null,Fe=new r.P(d.tileAnchorX,d.tileAnchorY);let{x:Ze,y:He,z:Ye}=Me.projectTilePoint(Fe.x,Fe.y,ce.canonical);if(Le){const[Zt,sn,Sn]=Le(Fe);Ze+=Zt,He+=sn,Ye+=Sn}const qe=Me.name==="globe",We=this.projectAndGetPerspectiveRatio(P,Ze,He,Ye,ce,qe||!!me||this.transform.pitch>0,Me),{perspectiveRatio:Xe}=We,Tt=(te?T/Xe:T*Xe)/r.bX,ht=qs(Ze,He,Ye,k),Lt=d.lineOffsetX*Tt,bt=d.lineOffsetY*Tt,Pt=r.an(n.layers[0].layout.get("text-max-angle")),nn=Math.cos(Pt),St=We.signedDistanceFromCamera>0?jc(Tt,b,Lt,bt,!1,ht,Fe,d,_,k,{},me&&!te?Le:null,te&&!!me,Me,ce,te,nn):null;let rt=!1,zt=!1,wt=!0;if(St&&!We.occluded){const Zt=.5*re*Xe+le,sn=new r.P(-100,-100),Sn=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new Hp,{first:en,last:Nn}=St,En=en.path.length;let Gn=[];for(let ir=En-1;ir>=1;ir--)Gn.push(en.path[ir]);for(let ir=1;ir<Nn.path.length;ir++)Gn.push(Nn.path[ir]);const Vn=2.5*Zt;G&&(Gn=Gn.map((([ir,dr,qr],hr)=>(Le&&!qe&&(qr=Le(hr<En-1?en.tilePath[En-1-hr]:Nn.tilePath[hr-En+2])[2]),qs(ir,dr,qr,G)))),Gn.some((ir=>ir[3]<=0))&&(Gn=[]));let Kn=[];if(Gn.length>0){let ir=1/0,dr=-1/0,qr=1/0,hr=-1/0;for(const ri of Gn)ir=Math.min(ir,ri[0]),qr=Math.min(qr,ri[1]),dr=Math.max(dr,ri[0]),hr=Math.max(hr,ri[1]);dr>=sn.x&&ir<=Sn.x&&hr>=sn.y&&qr<=Sn.y&&(Kn=[Gn.map((ri=>new r.P(ri[0],ri[1])))],(ir<sn.x||dr>Sn.x||qr<sn.y||hr>Sn.y)&&(Kn=r.bV(Kn,sn.x,sn.y,Sn.x,Sn.y)))}for(const ir of Kn){Ht.reset(ir,.25*Zt);let dr=0;dr=Ht.length<=.5*Zt?1:Math.ceil(Ht.paddedLength/Vn)+1;for(let qr=0;qr<dr;qr++){const hr=qr/Math.max(dr-1,1),ri=Ht.lerp(hr),si=ri.x+Ws,Mi=ri.y+Ws;Pe.push(si,Mi,Zt,0);const yr=si-Zt,Qr=Mi-Zt,Xr=si+Zt,ei=Mi+Zt;if(wt=wt&&this.isOffscreen(yr,Qr,Xr,ei),zt=zt||this.isInsideGrid(yr,Qr,Xr,ei),!a&&this.grid.hitTestCircle(si,Mi,Zt,Y)&&(rt=!0,!q))return{circles:[],offscreen:!1,collisionDetected:rt,occluded:!1}}}}return{circles:!q&&rt||!zt?[]:Pe,offscreen:wt,collisionDetected:rt,occluded:We.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,_=1/0,b=-1/0,T=-1/0;for(const q of n){const te=new r.P(q.x+Ws,q.y+Ws);d=Math.min(d,te.x),_=Math.min(_,te.y),b=Math.max(b,te.x),T=Math.max(T,te.y),a.push(te)}const P=this.grid.query(d,_,b,T).concat(this.ignoredGrid.query(d,_,b,T)),k={},G={};for(const q of P){const te=q.key;if(k[te.bucketInstanceId]===void 0&&(k[te.bucketInstanceId]={}),k[te.bucketInstanceId][te.featureIndex])continue;const Y=[new r.P(q.x1,q.y1),new r.P(q.x2,q.y1),new r.P(q.x2,q.y2),new r.P(q.x1,q.y2)];r.bW(a,Y)&&(k[te.bucketInstanceId][te.featureIndex]=!0,G[te.bucketInstanceId]===void 0&&(G[te.bucketInstanceId]=[]),G[te.bucketInstanceId].push(te.featureIndex))}return G}insertCollisionBox(n,a,d,_,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,_,b){const T=a?this.ignoredGrid:this.grid,P={bucketInstanceId:d,featureIndex:_,collisionGroupID:b};for(let k=0;k<n.length;k+=4)T.insertCircle(P,n[k],n[k+1],n[k+2])}projectAndGetPerspectiveRatio(n,a,d,_,b,T,P){const k=[a,d,_,1];let G=!1;_||this.transform.pitch>0?(r.aC(k,k,n),this.fogState&&b&&P.name!=="globe"&&(G=(function(Y,re,le,ce,Pe,me){const Me=me.calculateFogTileMatrix(Pe),Le=[re,le,ce];return r.af(Le,Le,Me),lr(Y,r.ag(Le),me.pitch,me._fov)})(this.fogState,a,d,_,b.toUnwrapped(),this.transform)>.9)):hl(k,k,n);const q=k[3];return{point:new r.P((k[0]/q+1)/2*this.transform.width+Ws,(-k[1]/q+1)/2*this.transform.height+Ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/q*.5,1.5),signedDistanceFromCamera:q,occluded:T&&k[2]>q||G}}isOffscreen(n,a,d,_){return d<Ws||n>=this.screenRightBoundary||_<Ws||a>this.screenBottomBoundary}isInsideGrid(n,a,d,_){return d>=0&&n<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=r.bA([]);return r.br(n,n,[-100,-100,0]),n}}class Ah{constructor(n,a,d,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class fl{constructor(n,a,d,_,b,T=!1){this.text=new Ah(n?n.text:null,a,d,b),this.icon=new Ah(n?n.icon:null,a,_,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jn{constructor(n,a,d,_=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=_}}class li{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class gi{constructor(n,a,d,_,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=b}}class Zs{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Gc(h,n,a,d,_){const{horizontalAlign:b,verticalAlign:T}=r.c0(h),P=-(b-.5)*n,k=-(T-.5)*a,G=r.c1(h,d);return new r.P(P+G[0]*_,k+G[1]*_)}function ci(h,n,a,d,_){const b=new r.P(h,n);return a&&b._rotate(d?_:-_),b}class If{constructor(n,a,d,_,b,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ma(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Zs(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,_,b=1){const T=d.getBucket(a),P=d.latestFeatureIndex;if(!T||!P||a.fqid!==T.layerIds[0])return;const k=T.layers[0].layout,G=T.layers[0].paint,q=d.collisionBoxArray,te=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),Y=d.tileSize/r.al,re=d.tileID.toUnwrapped();this.transform.setProjection(T.projection);const le=(ce=d.tileID,Pe=T.getProjection(),me=this.transform,Pe.name===this.projection?me.calculateProjMatrix(ce.toUnwrapped()):Ch(me,Pe,ce));var ce,Pe,me;const Me=k.get("text-pitch-alignment")==="map",Le=k.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const Fe=a.dynamicFilter(),Ze=a.dynamicFilterNeedsFeature(),He=this.transform.calculatePixelsToTileUnitsMatrix(d),Ye=gc(le,d.tileID.canonical,Me,Le,this.transform,T.getProjection(),He);let qe=null;const We=T.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(Me){const rt=bd(le,d.tileID.canonical,Me,Le,this.transform,T.getProjection(),He);qe=r.aB([],this.transform.labelPlaneMatrix,rt)}let Xe=null;Fe&&d.latestFeatureIndex&&(Xe={unwrappedTileID:re,dynamicFilter:Fe,dynamicFilterNeedsFeature:Ze}),this.retainedQueryData[T.bucketInstanceId]=new gi(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,d.tileID);const[Tt,ht]=T.layers[0].layout.get("text-size-scale-range"),Lt=r.aA(b,Tt,ht),[bt,Pt]=k.get("icon-size-scale-range"),nn=r.aA(b,bt,Pt),St={bucket:T,layout:k,paint:G,posMatrix:le,invMatrix:We,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ye,labelToScreenMatrix:qe,clippingData:Xe,scale:te,textPixelRatio:Y,holdingForFade:d.holdingForFade(),collisionBoxArray:q,partiallyEvaluatedTextSize:r.bK(T.textSizeData,this.transform.zoom,Lt),partiallyEvaluatedIconSize:r.bK(T.iconSizeData,this.transform.zoom,nn),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const rt of T.sortKeyRanges){const{sortKey:zt,symbolInstanceStart:wt,symbolInstanceEnd:Zt}=rt;n.push({sortKey:zt,symbolInstanceStart:wt,symbolInstanceEnd:Zt,parameters:St})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:St})}attemptAnchorPlacement(n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me,Le,Fe,Ze){const{textOffset0:He,textOffset1:Ye,crossTileID:qe}=ce,We=[He,Ye],Xe=Gc(n,T,P,We,k),Tt=this.collisionIndex.placeCollisionBox(me,k,a,d,_,b,ci(Xe.x,Xe.y,G,q,this.transform.angle),le,te,Y,re.predicate);if(Le){const ht=me.getSymbolInstanceIconSize(Ze,this.transform.zoom,ce.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(me,ht,Le,d,_,b,ci(Xe.x,Xe.y,G,q,this.transform.angle),le,te,Y,re.predicate).box.length===0)return}if(Tt.box.length>0){let ht;return this.prevPlacement&&this.prevPlacement.variableOffsets[qe]&&this.prevPlacement.placements[qe]&&this.prevPlacement.placements[qe].text&&(ht=this.prevPlacement.variableOffsets[qe].anchor),this.variableOffsets[qe]={textOffset:We,width:T,height:P,anchor:n,textScale:k,prevAnchor:ht},this.markUsedJustification(me,n,ce,Me),me.allowVerticalPlacement&&(this.markUsedOrientation(me,Me,ce),this.placedOrientations[qe]=Me),{shift:Xe,placedGlyphBoxes:Tt}}}placeLayerBucketPart(n,a,d,_,b=1){const{bucket:T,layout:P,paint:k,posMatrix:G,textLabelPlaneMatrix:q,labelToScreenMatrix:te,clippingData:Y,textPixelRatio:re,mercatorCenter:le,invMatrix:ce,holdingForFade:Pe,collisionBoxArray:me,partiallyEvaluatedTextSize:Me,partiallyEvaluatedIconSize:Le,collisionGroup:Fe,latestFeatureIndex:Ze}=n.parameters,He=P.get("text-optional"),Ye=P.get("icon-optional"),qe=P.get("text-allow-overlap"),We=P.get("icon-allow-overlap"),Xe=P.get("text-rotation-alignment")==="map",Tt=P.get("icon-rotation-alignment")==="map",ht=P.get("text-pitch-alignment")==="map",Lt=k.get("symbol-z-offset"),bt=P.get("symbol-elevation-reference")==="sea",Pt=P.get("symbol-placement"),[nn,St]=P.get("text-size-scale-range"),[rt,zt]=P.get("icon-size-scale-range"),wt=r.aA(b,nn,St),Zt=r.aA(b,rt,zt),sn=P.get("text-variable-anchor"),Sn=Xe&&Pt!=="point",Ht=Tt&&Pt!=="point",en=sn&&T.hasTextData(),Nn=T.hasIconTextFit()&&en&&T.hasIconData();this.transform.setProjection(T.projection);const En=en||Sn,Gn=Ht||Nn;let Vn=qe&&(We||!T.hasIconData()||Ye),Kn=We&&(qe||!T.hasTextData()||He);const ir=!Lt.isConstant();!T.collisionArrays&&me&&T.deserializeCollisionBoxes(me),d&&_&&T.updateCollisionDebugBuffers(this.transform.zoom,me,wt,Zt);const dr=(hr,ri,si)=>{const{crossTileID:Mi,numVerticalGlyphVertices:yr}=hr;let Qr=null;if(Y&&Y.dynamicFilterNeedsFeature||ir){const vi=this.retainedQueryData[T.bucketInstanceId];Qr=Ze.loadFeature({featureIndex:hr.featureIndex,bucketIndex:vi.bucketIndex,sourceLayerIndex:vi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Y&&!(0,Y.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Qr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(hr.tileAnchorX,hr.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[Mi]=new jn(!1,!1,!1,!0),void a.add(Mi);const Xr=Lt.evaluate(Qr,{});if(a.has(Mi))return;if(Pe)return void(this.placements[Mi]=new jn(!1,!1,!1));let ei=!1,$i=!1,Dr=!0,hi=!1,wr=!1,Zn=null,Fn={box:null,offscreen:null,occluded:null},Gr={box:null},Oi=null,Ii=null,xo=null,bo=0,Xi=0,ss=0;si.textFeatureIndex?bo=si.textFeatureIndex:hr.useRuntimeCollisionCircles&&(bo=hr.featureIndex),si.verticalTextFeatureIndex&&(Xi=si.verticalTextFeatureIndex);const as=vi=>{vi.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const uo=this.transform.elevation;vi.elevation=bt?Xr:Xr+(uo?uo.getAtTileOffset(vi.tileID,vi.tileAnchorX,vi.tileAnchorY):0),vi.elevation+=hr.zOffset},na=si.textBox;if(na){as(na);const vi=Ni=>{let wo=r.bL.horizontal;if(T.allowVerticalPlacement&&!Ni&&this.prevPlacement){const No=this.prevPlacement.placedOrientations[Mi];No&&(this.placedOrientations[Mi]=No,wo=No,this.markUsedOrientation(T,wo,hr))}return wo},uo=(Ni,wo)=>{if(T.allowVerticalPlacement&&yr>0&&si.verticalTextBox){for(const No of T.writingModes)if(No===r.bL.vertical?(Fn=wo(),Gr=Fn):Fn=Ni(),Fn&&Fn.box&&Fn.box.length)break}else Fn=Ni()};if(sn){let Ni=sn;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Mi]){const Ki=this.prevPlacement.variableOffsets[Mi];Ni.indexOf(Ki.anchor)>0&&(Ni=Ni.filter((Ji=>Ji!==Ki.anchor)),Ni.unshift(Ki.anchor))}const wo=(Ki,Ji,Ns)=>{const Ta=T.getSymbolInstanceTextSize(Me,hr,this.transform.zoom,ri),ra=(Ki.x2-Ki.x1)*Ta+2*Ki.padding,Ql=(Ki.y2-Ki.y1)*Ta+2*Ki.padding,ec=hr.hasIconTextFit&&!We?Ji:null;ec&&as(ec);let Pl={box:[],offscreen:!1,occluded:!1};const tc=qe?2*Ni.length:Ni.length;for(let Ml=0;Ml<tc;++Ml){const y=this.attemptAnchorPlacement(Ni[Ml%Ni.length],Ki,le,ce,En,ra,Ql,Ta,Xe,ht,re,G,Fe,Ml>=Ni.length,hr,ri,T,Ns,ec,Me,Le);if(y&&(Pl=y.placedGlyphBoxes,Pl&&Pl.box&&Pl.box.length)){ei=!0,Zn=y.shift;break}}return Pl};uo((()=>wo(na,si.iconBox,r.bL.horizontal)),(()=>{const Ki=si.verticalTextBox;return Ki&&as(Ki),T.allowVerticalPlacement&&!(Fn&&Fn.box&&Fn.box.length)&&yr>0&&Ki?wo(Ki,si.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}})),Fn&&(ei=Fn.box,Dr=Fn.offscreen,hi=Fn.occluded);const No=vi(!(!Fn||!Fn.box));if(!ei&&this.prevPlacement){const Ki=this.prevPlacement.variableOffsets[Mi];Ki&&(this.variableOffsets[Mi]=Ki,this.markUsedJustification(T,Ki.anchor,hr,No))}}else{const Ni=(wo,No)=>{const Ki=T.getSymbolInstanceTextSize(Me,hr,this.transform.zoom,ri),Ji=this.collisionIndex.placeCollisionBox(T,Ki,wo,le,ce,En,new r.P(0,0),qe,re,G,Fe.predicate);return Ji&&Ji.box&&Ji.box.length&&(this.markUsedOrientation(T,No,hr),this.placedOrientations[Mi]=No),Ji};uo((()=>Ni(na,r.bL.horizontal)),(()=>{const wo=si.verticalTextBox;return T.allowVerticalPlacement&&yr>0&&wo?(as(wo),Ni(wo,r.bL.vertical)):{box:null,offscreen:null,occluded:null}})),vi(!!(Fn&&Fn.box&&Fn.box.length))}}if(Oi=Fn,ei=Oi&&Oi.box&&Oi.box.length>0,Dr=Oi&&Oi.offscreen,hi=Oi&&Oi.occluded,hr.useRuntimeCollisionCircles){const vi=T.text.placedSymbolArray.get(hr.centerJustifiedTextSymbolIndex>=0?hr.centerJustifiedTextSymbolIndex:hr.verticalPlacedTextSymbolIndex),uo=r.bM(T.textSizeData,Me,vi),Ni=P.get("text-padding");Ii=this.collisionIndex.placeCollisionCircles(T,qe,vi,T.lineVertexArray,T.glyphOffsetArray,uo,G,q,te,d,ht,Fe.predicate,hr.collisionCircleDiameter*uo/r.bX,Ni,this.retainedQueryData[T.bucketInstanceId].tileID),ei=qe||Ii.circles.length>0&&!Ii.collisionDetected,Dr=Dr&&Ii.offscreen,hi=Ii.occluded}if(si.iconFeatureIndex&&(ss=si.iconFeatureIndex),si.iconBox){const vi=uo=>{as(uo);const Ni=hr.hasIconTextFit&&Zn?ci(Zn.x,Zn.y,Xe,ht,this.transform.angle):new r.P(0,0),wo=T.getSymbolInstanceIconSize(Le,this.transform.zoom,hr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,wo,uo,le,ce,Gn,Ni,We,re,G,Fe.predicate)};Gr&&Gr.box&&Gr.box.length&&si.verticalIconBox?(xo=vi(si.verticalIconBox),$i=xo.box.length>0):(xo=vi(si.iconBox),$i=xo.box.length>0),Dr=Dr&&xo.offscreen,wr=xo.occluded}const Co=He||hr.numHorizontalGlyphVertices===0&&yr===0,Bs=Ye||hr.numIconVertices===0;if(Co||Bs?Bs?Co||($i=$i&&ei):ei=$i&&ei:$i=ei=$i&&ei,ei&&Oi&&Oi.box&&this.collisionIndex.insertCollisionBox(Oi.box,P.get("text-ignore-placement"),T.bucketInstanceId,Gr&&Gr.box&&Xi?Xi:bo,Fe.ID),$i&&xo&&this.collisionIndex.insertCollisionBox(xo.box,P.get("icon-ignore-placement"),T.bucketInstanceId,ss,Fe.ID),Ii&&(ei&&this.collisionIndex.insertCollisionCircles(Ii.circles,P.get("text-ignore-placement"),T.bucketInstanceId,bo,Fe.ID),d)){const vi=T.bucketInstanceId;let uo=this.collisionCircleArrays[vi];uo===void 0&&(uo=this.collisionCircleArrays[vi]=new li);for(let Ni=0;Ni<Ii.circles.length;Ni+=4)uo.circles.push(Ii.circles[Ni+0]),uo.circles.push(Ii.circles[Ni+1]),uo.circles.push(Ii.circles[Ni+2]),uo.circles.push(Ii.collisionDetected?1:0)}const ga=T.projection.name!=="globe";Vn=Vn&&(ga||!hi),Kn=Kn&&(ga||!wr),this.placements[Mi]=new jn(ei||Vn,$i||Kn,Dr||T.justReloaded),a.add(Mi)},qr=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,qr),T.elevationType==="road"&&T.updateRoadElevation(qr.canonical),T.updateZOffset(),T.sortFeaturesByY){const hr=T.getSortedSymbolIndexes(this.transform.angle);for(let ri=hr.length-1;ri>=0;--ri){const si=hr[ri];dr(T.symbolInstances.get(si),si,T.collisionArrays[si])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const hr=T.getSortedIndexesByZOffset();for(let ri=0;ri<hr.length;++ri){const si=hr[ri];dr(T.symbolInstances.get(si),si,T.collisionArrays[si])}}else for(let hr=n.symbolInstanceStart;hr<n.symbolInstanceEnd;hr++)dr(T.symbolInstances.get(hr),hr,T.collisionArrays[hr]);if(d&&T.bucketInstanceId in this.collisionCircleArrays){const hr=this.collisionCircleArrays[T.bucketInstanceId];r.bl(hr.invProjMatrix,G),hr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,a,d,_){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:k,crossTileID:G}=d,q=r.c2(a),te=_===r.bL.vertical?k:q==="left"?b:q==="center"?T:q==="right"?P:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=te>=0&&b!==te?0:G),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=te>=0&&T!==te?0:G),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=te>=0&&P!==te?0:G),k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=te>=0&&k!==te?0:G)}markUsedOrientation(n,a,d){const _=a===r.bL.horizontal||a===r.bL.horizontalOnly?a:0,b=a===r.bL.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:G}=d,q=n.text.placedSymbolArray;T>=0&&(q.get(T).placedOrientation=_),P>=0&&(q.get(P).placedOrientation=_),k>=0&&(q.get(k).placedOrientation=_),G>=0&&(q.get(G).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},P=a?a.placedOrientations:{};for(const k in this.placements){const G=this.placements[k],q=b[k];q?(this.opacities[k]=new fl(q,_,G.text,G.icon,null,G.clipped),d=d||G.text!==q.text.placed||G.icon!==q.icon.placed):(this.opacities[k]=new fl(null,_,G.text,G.icon,G.skipFade,G.clipped),d=d||G.text||G.icon)}for(const k in b){const G=b[k];if(!this.opacities[k]){const q=new fl(G,_,!1,!1);q.isHidden()||(this.opacities[k]=q,d=d||G.text.placed||G.icon.placed)}}for(const k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(const k in P)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=P[k]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a,d,_){const b=new Set;for(const T of a){const P=T.getBucket(n);P&&T.latestFeatureIndex&&n.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,b,T,T.collisionBoxArray,d,_,T.tileID,n.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,T.tileID),P.elevationType==="road"&&P.updateRoadElevation(T.tileID.canonical),P.updateZOffset())}}updateBucketOpacities(n,a,d,_,b,T,P,k){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const G=n.layers[0].layout,q=n.layers[0].paint,te=!!n.layers[0].dynamicFilter(),Y=new fl(null,0,!1,!1,!0),re=G.get("text-allow-overlap"),le=G.get("icon-allow-overlap"),ce=G.get("text-variable-anchor"),Pe=G.get("text-rotation-alignment")==="map",me=G.get("text-pitch-alignment")==="map",Me=q.get("symbol-z-offset"),Le=G.get("symbol-elevation-reference")==="sea",Fe=!Me.isConstant(),Ze=new fl(null,0,re&&(le||!n.hasIconData()||G.get("icon-optional")),le&&(re||!n.hasTextData()||G.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const He=(qe,We,Xe)=>{for(let Tt=0;Tt<We/4;Tt++)qe.opacityVertexArray.emplaceBack(Xe)};let Ye=0;T&&n.updateReplacement(P,T);for(let qe=0;qe<n.symbolInstances.length;qe++){const We=n.symbolInstances.get(qe),{numHorizontalGlyphVertices:Xe,numVerticalGlyphVertices:Tt,crossTileID:ht,numIconVertices:Lt,tileAnchorX:bt,tileAnchorY:Pt}=We;let nn=null;const St=this.retainedQueryData[n.bucketInstanceId];Fe&&We&&St&&(nn=d.latestFeatureIndex.loadFeature({featureIndex:We.featureIndex,bucketIndex:St.bucketIndex,sourceLayerIndex:St.sourceLayerIndex,layoutVertexArrayOffset:0}));const rt=Me.evaluate(nn,{}),zt=a.has(ht);let wt=this.opacities[ht];zt?wt=Y:wt||(wt=Ze,this.opacities[ht]=wt),a.add(ht);const Zt=Xe>0||Tt>0,sn=Lt>0,Sn=this.placedOrientations[ht],Ht=Sn===r.bL.vertical,en=Sn===r.bL.horizontal||Sn===r.bL.horizontalOnly;!Zt&&!sn||wt.isHidden()||Ye++;let Nn=!1;if((Zt||sn)&&T)for(const En of n.activeReplacements){if(r.bY(En,b,r.bZ.Symbol,k)||En.min.x>bt||bt>En.max.x||En.min.y>Pt||Pt>En.max.y)continue;const Gn=r.b_(bt,Pt,P.canonical,En.footprintTileId.canonical);if(Nn=r.b$(Gn,En.footprint),Nn)break}if(Zt){const En=Nn?yc:Ad(wt.text);He(n.text,Xe,Ht?yc:En),He(n.text,Tt,en?yc:En);const Gn=wt.text.isHidden(),{leftJustifiedTextSymbolIndex:Vn,centerJustifiedTextSymbolIndex:Kn,rightJustifiedTextSymbolIndex:ir,verticalPlacedTextSymbolIndex:dr}=We,qr=n.text.placedSymbolArray,hr=Gn||Ht?1:0;Vn>=0&&(qr.get(Vn).hidden=hr),Kn>=0&&(qr.get(Kn).hidden=hr),ir>=0&&(qr.get(ir).hidden=hr),dr>=0&&(qr.get(dr).hidden=Gn||en?1:0);const ri=this.variableOffsets[ht];ri&&this.markUsedJustification(n,ri.anchor,We,Sn);const si=this.placedOrientations[ht];si&&(this.markUsedJustification(n,"left",We,si),this.markUsedOrientation(n,si,We))}if(sn){const En=Nn?yc:Ad(wt.icon),{placedIconSymbolIndex:Gn,verticalPlacedIconSymbolIndex:Vn}=We,Kn=n.icon.placedSymbolArray,ir=wt.icon.isHidden()?1:0;Gn>=0&&(He(n.icon,Lt,Ht?yc:En),Kn.get(Gn).hidden=ir),Vn>=0&&(He(n.icon,We.numVerticalIconVertices,en?yc:En),Kn.get(Vn).hidden=ir)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const En=n.collisionArrays[qe];if(En){let Gn=new r.P(0,0),Vn=!0;if(En.textBox||En.verticalTextBox){if(ce){const ir=this.variableOffsets[ht];ir?(Gn=Gc(ir.anchor,ir.width,ir.height,ir.textOffset,ir.textScale),Pe&&Gn._rotate(me?this.transform.angle:-this.transform.angle)):Vn=!1}te&&(Vn=!wt.clipped),En.textBox&&Go(n.textCollisionBox.collisionVertexArray,wt.text.placed,!Vn||Ht,rt,Le,Gn.x,Gn.y),En.verticalTextBox&&Go(n.textCollisionBox.collisionVertexArray,wt.text.placed,!Vn||en,rt,Le,Gn.x,Gn.y)}const Kn=Vn&&!!(!en&&En.verticalIconBox);En.iconBox&&Go(n.iconCollisionBox.collisionVertexArray,wt.icon.placed,Kn,rt,Le,We.hasIconTextFit?Gn.x:0,We.hasIconTextFit?Gn.y:0),En.verticalIconBox&&Go(n.iconCollisionBox.collisionVertexArray,wt.icon.placed,!Kn,rt,Le,We.hasIconTextFit?Gn.x:0,We.hasIconTextFit?Gn.y:0)}}}if(n.fullyClipped=Ye===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=qe.invProjMatrix,n.placementViewportMatrix=qe.viewportMatrix,n.collisionCircleArray=qe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Go(h,n,a,d,_,b,T){h.emplaceBack(n?1:0,a?1:0,b||0,T||0,d,_?1:0),h.emplaceBack(n?1:0,a?1:0,b||0,T||0,d,_?1:0),h.emplaceBack(n?1:0,a?1:0,b||0,T||0,d,_?1:0),h.emplaceBack(n?1:0,a?1:0,b||0,T||0,d,_?1:0)}const Td=Math.pow(2,25),ys=Math.pow(2,24),Lo=Math.pow(2,17),Qm=Math.pow(2,16),Cd=Math.pow(2,9),Ed=Math.pow(2,8),Pu=Math.pow(2,1);function Ad(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Td+n*ys+a*Lo+n*Qm+a*Cd+n*Ed+a*Pu+n}const yc=0;class Ph{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,d,_,b,T){const P=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(P,_,n[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(((k,G)=>k.sortKey-G.sortKey)));this._currentPartIndex<P.length;){const k=P[this._currentPartIndex];if(a.placeLayerBucketPart(k,this._seenCrossTileIDs,d,k.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class vs{constructor(n,a,d,_,b,T,P,k,G){this.placement=new If(n,b,T,P,k,G),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d,_,b){const T=r.o.now(),P=()=>{const k=r.o.now()-T;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=a[n[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=G)&&(!k.maxzoom||k.maxzoom>G)){const q=k,te=q.layout.get("symbol-z-elevate"),Y=q.layout.get("symbol-sort-key").constantOr(1)!==void 0,re=q.layout.get("symbol-z-order"),le=re==="viewport-y"||re==="auto"&&!(re!=="viewport-y"&&Y),ce=q.layout.get("text-allow-overlap")||q.layout.get("icon-allow-overlap")||q.layout.get("text-ignore-placement")||q.layout.get("icon-ignore-placement"),Pe=le&&ce,me=this._inProgressLayer=this._inProgressLayer||new Ph(q),Me=r.B(k.source,k.scope);if(me.continuePlacement(te||Pe?_[Me]:d[Me],this.placement,this._showCollisionBoxes,k,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ia=512/r.al/2;class Ys{constructor(n,a,d){this.tileID=n,this.bucketInstanceId=d,this.index=new r.c3(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*r.al,b=n.canonical.y*r.al;for(let T=0;T<a.length;T++){const{key:P,crossTileID:k,tileAnchorX:G,tileAnchorY:q}=a.get(T),te=Math.floor((_+G)*Ia),Y=Math.floor((b+q)*Ia);this.index.add(te,Y),this.keys.push(P),this.crossTileIDs.push(k)}this.index.finish()}findMatches(n,a,d){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Ia/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*r.al,P=a.canonical.y*r.al;for(let k=0;k<n.length;k++){const G=n.get(k);if(G.crossTileID)continue;const{key:q,tileAnchorX:te,tileAnchorY:Y}=G,re=Math.floor((T+te)*b),le=Math.floor((P+Y)*b),ce=this.index.range(re-_,le-_,re+_,le+_).sort(((Pe,me)=>Pe-me));for(const Pe of ce){const me=this.crossTileIDs[Pe];if(this.keys[Pe]===q&&!d.has(me)){d.add(me),G.crossTileID=me;break}}}}}class Rf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const _=this.indexes[d],b={};for(const T in _){const P=_[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+a),b[P.tileID.key]=P}this.indexes[d]=b}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const P in T){const k=T[P];k.tileID.isChildOf(n)&&k.findMatches(a.symbolInstances,n,_)}else{const P=T[n.scaledTo(Number(b)).key];P&&P.findMatches(a.symbolInstances,n,_)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=d.generate(),_.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ys(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[n].delete(d)}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const _=this.indexes[d];for(const b in _)n[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[b]),delete _[b],a=!0)}return a}}class $o{constructor(){this.layerIndexes={},this.crossTileIDs=new Rf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,_){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new vc);let T=!1;const P={};_.name!=="globe"&&b.handleWrapJump(d);for(const k of a){const G=k.getBucket(n);G&&n.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,G,this.crossTileIDs)&&(T=!0),P[G.bucketInstanceId]=!0)}return b.removeStaleBuckets(P)&&(T=!0),T}pruneUnusedLayers(n){const a={};n.forEach((d=>{a[d]=!0}));for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Xs=771;class br{constructor(n,a,d,_){this.blendFunction=n,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=_}}br.Replace=[1,0,1,0],br.disabled=new br(br.Replace,r.ao.transparent,[!1,!1,!1,!1]),br.unblended=new br(br.Replace,r.ao.transparent,[!0,!0,!0,!0]),br.alphaBlended=new br([1,Xs,1,Xs],r.ao.transparent,[!0,!0,!0,!0]),br.alphaBlendedNonPremultiplied=new br([770,Xs,770,Xs],r.ao.transparent,[!0,!0,!0,!0]),br.multiply=new br([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]);class Pn{constructor(n,a,d){this.func=n,this.mask=a,this.range=d}}Pn.ReadOnly=!1,Pn.ReadWrite=!0,Pn.disabled=new Pn(519,Pn.ReadOnly,[0,1]);const Ra=7680;class sr{constructor(n,a,d,_,b,T){this.test=n,this.ref=a,this.mask=d,this.fail=_,this.depthFail=b,this.pass=T}}sr.disabled=new sr({func:519,mask:0},0,0,Ra,Ra,Ra);const Mu=1029,Iu=2305;class er{constructor(n,a,d){this.enable=n,this.mode=a,this.frontFace=d}}function Df(h,n){const a=r.c9(h,3);r.cb(h,n),r.cf(h,3,a)}function Ru(h,n){const a=r.c6([]);return r.c7(a,a,-n),r.c8(a,a,-h),a}function Pd(h,n){const a=[h[0],h[1],0],d=[n[0],n[1],0];if(r.ag(a)>=1e-15){const T=r.aw([],a);r.c4(d,T,r.bJ(d,T)),n[0]=d[0],n[1]=d[1]}const _=r.bI([],n,h);if(r.c5(_)<1e-15)return null;const b=Math.atan2(-_[1],_[0]);return Ru(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),b)}er.disabled=new er(!1,Mu,Iu),er.backCCW=new er(!0,Mu,Iu),er.backCW=new er(!0,Mu,2304),er.frontCW=new er(!0,1028,2304),er.frontCCW=new er(!0,1028,Iu);class kf{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof r.ae?n:new r.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=r.bT(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(n)):0,b=r.ae.fromLngLat(n,_),T=[b.x-d.x,b.y-d.y,b.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Pd(T,a)}setPitchBearing(n,a){this.orientation=Ru(r.an(n),r.an(-a))}}class Md{constructor(n,a){this._transform=r.bA([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new r.ae(n[0],n[1],n[2])}get position(){const n=r.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&r.cf(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.c6([]),n&&Df(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Ru(n,a),Df(this._transform,this._orientation)}forward(){const n=r.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const d=new Float64Array(16);return r.bl(d,this.getWorldToCamera(n,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,d){const _=this.position;r.c4(_,_,-n);const b=new Float64Array(16);return r.bq(b,[d,d,d]),r.br(b,b,_),b[10]*=a,b}getWorldToCamera(n,a){const d=new Float64Array(16),_=new Float64Array(4),b=this.position;return r.ca(_,this._orientation),r.c4(b,b,-n),r.cb(d,_),r.br(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,_){const b=new Float64Array(16);return r.cc(b,n,a,d,_),b}getCameraToClipOrthographic(n,a,d,_,b,T){const P=new Float64Array(16);return r.cd(P,n,a,d,_,b,T),P}getDistanceToElevation(n,a=!1){const d=n===0?0:r.ce(n,a?r.a$(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new Md([...this.position],[...this.orientation])}}const vo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Of{constructor(n=0,a=0,d=0,_=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=_}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=r.ak(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=r.ak(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=r.ak(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=r.ak(n.right,a.right,d)),this}getCenter(n,a){const d=r.aA((this.left+n-this.right)/2,0,n),_=r.aA((this.top+a-this.bottom)/2,0,a);return new r.P(d,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Of(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $a=15;class is{constructor(n,a,d,_,b,T,P){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(T),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new r.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Of,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Md,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new is(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<$a}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(n||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const d=this.getProjection(),_=!r.by(a,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=r.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,b=0;for(let T=0;T<a.length;T++){const P=new r.P(a[T][0]*this.width,d+a[T][1]*(this.height-d)),k=n.pointCoordinate(P);if(!k)continue;const G=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);_+=k[3]*G,b+=G}return b===0?NaN:_/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-d,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const _=r.ag(r.av([],this._camera.position,d));return r.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!r.co(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];r.cp(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new kf;return a.position=new r.ae(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!r.cq(n))return!1;r.cr(n,n);const a=r.cs([],[0,0,-1],n),d=r.cs([],[0,-1,0],n);if(d[2]<0)return!1;const _=Pd(a,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=r.aA(n[2],_/d,_/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new r.ct(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),P=Math.floor(Math.min(d.x,_.x,b.x,T.x)),k=Math.floor(Math.max(d.x,_.x,b.x,T.x)),G=1;for(let q=P-G;q<=k+G;q++)q!==0&&a.push(new r.ct(q,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,a,d){let _=[];const b=d!=null,T=!b;if(T&&this.zoom<a||b&&d[0]===0&&d[1]===0)return _;const P=new Set,k=(q,te,Y,re,le)=>{const ce=r.cX(te,q,Y,re,le);P.has(ce)||(_.push(new r.aO(q,te,Y,re,le)),P.add(ce))};for(let q=0;q<n.length;q++){const te=n[q];if(T&&te.canonical.z!==a)continue;const Y=te.canonical,re=te.overscaledZ,le=te.wrap,ce=1<<Y.z,Pe=Y.x+1<ce,me=Y.x>0,Me=Y.y+1<ce,Le=Y.y>0,Fe=te.wrap-(me?0:1),Ze=te.wrap+(Pe?0:1),He=me?Y.x-1:ce-1,Ye=Pe?Y.x+1:0;if(b)d[0]<0?(k(re,Ze,Y.z,Ye,Y.y),d[1]<0&&Me&&(k(re,le,Y.z,Y.x,Y.y+1),k(re,Ze,Y.z,Ye,Y.y+1)),d[1]>0&&Le&&(k(re,le,Y.z,Y.x,Y.y-1),k(re,Ze,Y.z,Ye,Y.y-1))):d[0]>0?(k(re,Fe,Y.z,He,Y.y),d[1]<0&&Me&&(k(re,le,Y.z,Y.x,Y.y+1),k(re,Fe,Y.z,He,Y.y+1)),d[1]>0&&Le&&(k(re,le,Y.z,Y.x,Y.y-1),k(re,Fe,Y.z,He,Y.y-1))):d[1]<0&&Me?k(re,le,Y.z,Y.x,Y.y+1):Le&&k(re,le,Y.z,Y.x,Y.y-1);else{const qe=te.visibleQuadrants;1&qe&&(k(re,Fe,Y.z,He,Y.y),Le&&(k(re,le,Y.z,Y.x,Y.y-1),k(re,Fe,Y.z,He,Y.y-1))),2&qe&&(k(re,Ze,Y.z,Ye,Y.y),Le&&(k(re,le,Y.z,Y.x,Y.y-1),k(re,Ze,Y.z,Ye,Y.y-1))),4&qe&&(k(re,Fe,Y.z,He,Y.y),Me&&(k(re,le,Y.z,Y.x,Y.y+1),k(re,Fe,Y.z,He,Y.y+1))),8&qe&&(k(re,Ze,Y.z,Ye,Y.y),Me&&(k(re,le,Y.z,Y.x,Y.y+1),k(re,Ze,Y.z,Ye,Y.y+1)))}}const G=[];for(const q of _)_.some((te=>q.isChildOf(te)))||G.push(q);if(_=G.filter((q=>!n.some((te=>!!(q.overscaledZ<a&&te.isChildOf(q))||q.equals(te)||q.isChildOf(te))))),T){const q=1<<a,te=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=[q*te.x,q*te.y],re=4,le=re*re;_=_.filter((ce=>{const Pe=ce.canonical.x+.5-Y[0],me=ce.canonical.y+.5-Y[1];return Pe*Pe+me*me<le}))}return _}extendTileCoverToNearPlane(n,a,d){const _=[],b=new Set;for(const Me of n)b.add(Me.key);const T=(Me,Le,Fe,Ze,He)=>{const Ye=r.cX(Le,Me,Fe,Ze,He);b.has(Ye)||(_.push(new r.aO(Me,Le,Fe,Ze,He)),b.add(Ye))},P=n.reduce(((Me,Le)=>Math.max(Me,Le.overscaledZ)),d),k=1<<d,G=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],q=new r.P(0,0),te=new r.P(0,0),Y=(Me,Le)=>{const Fe=Math.floor(Me[0]),Ze=Math.floor(Me[1]),He=(Me[0]-Fe)*r.al,Ye=(Me[1]-Ze)*r.al,qe=Math.floor(Le[0]),We=Math.floor(Le[1]),Xe=(Le[0]-qe)*r.al,Tt=(Le[1]-We)*r.al;for(let ht=-1;ht<=1;ht++){const Lt=Fe+ht;if(!(Lt<0||Lt>=k)){q.x=He-ht*r.al,te.x=Xe-(Lt-qe)*r.al;for(let bt=-1;bt<=1;bt++){const Pt=Ze+bt;q.y=Ye-bt*r.al,te.y=Tt-(Pt-We)*r.al,r.cY(q,te,G)&&T(P,0,d,Lt,Pt)}}}},re=a.points,le=re[r.cu],ce=re[r.cv],Pe=this._projectToGround(le,re[r.cw]),me=this._projectToGround(ce,re[r.cx]);return Y(le,Pe),Y(ce,me),_}_projectToGround(n,a){return r.cy(r.cz(),n,a,n[2]/(n[2]-a[2]))}coveringTiles(n){let a=this.coveringZoomLevel(n);const d=a,_=this.elevation&&this.elevation.exaggeration(),b=_&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const P=this.locationCoordinate(this.center),k=this.center.lat,G=1<<a,q=[G*P.x,G*P.y,0],te=this.projection.name==="globe",Y=!te,re=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,Y),le=te?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ce=G*r.ce(1,this.center.lat),Pe=this._camera.position[2]/r.ce(1,this.center.lat),me=[G*le.x,G*le.y,Pe*(Y?1:ce)],Me=te||_,Le=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Fe=this.isLODDisabled(!0)?a:0;let Ze;if(this._elevation&&n.isTerrainDEM)Ze=1e4*this._elevation.exaggeration();else if(this._elevation){const rt=this._elevation.getMinMaxForVisibleTiles();Ze=rt?rt.max:this._centerAltitude}else Ze=this._centerAltitude;const He=n.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ye=this.projection.isReprojectedInTileSpace?r.cB(this):1,qe=rt=>{const wt=new r.ae(rt.x+25e-6,rt.y,rt.z),Zt=new r.ae(rt.x,rt.y+25e-6,rt.z),sn=rt.toLngLat(),Sn=wt.toLngLat(),Ht=Zt.toLngLat(),en=this.locationCoordinate(sn),Nn=this.locationCoordinate(Sn),En=this.locationCoordinate(Ht),Gn=Math.hypot(Nn.x-en.x,Nn.y-en.y),Vn=Math.hypot(En.x-en.x,En.y-en.y);return Math.sqrt(Gn*Vn)*Ye/25e-6},We=rt=>{const zt=Ze,wt=He;return{aabb:r.cE(this,G,0,0,0,rt,wt,zt,this.projection),zoom:0,x:0,y:0,minZ:wt,maxZ:zt,wrap:rt,fullyVisible:!1}},Xe=[];let Tt=[];const ht=a,Lt=n.reparseOverscaled?d:a,bt=(Pe-this._centerAltitude)*ce,Pt=rt=>{if(!this._elevation||!rt.tileID||!T)return;const zt=this._elevation.getMinMaxForTile(rt.tileID),wt=rt.aabb;zt?(wt.min[2]=zt.min,wt.max[2]=zt.max,wt.center[2]=(wt.min[2]+wt.max[2])/2):(rt.shouldSplit=St(rt),rt.shouldSplit||(wt.min[2]=wt.max[2]=wt.center[2]=this._centerAltitude))},nn=(rt,zt)=>{if(.707*zt<rt)return 1;const wt=zt/rt;return wt/(1.4144271570014144+(Math.pow(1.1,wt-1.4144271570014144+1)-1)/(1.1-1)-1)},St=rt=>{if(rt.zoom<Fe)return!0;if(rt.zoom===ht)return!1;if(rt.shouldSplit!=null)return rt.shouldSplit;const zt=rt.aabb.distanceX(me),wt=rt.aabb.distanceY(me);let Zt=bt,sn=1;if(te){Zt=rt.aabb.distanceZ(me);const Vn=Math.pow(2,rt.zoom),Kn=r.a$((rt.y+1)/Vn),ir=r.a$(rt.y/Vn),dr=Math.min(Math.max(k,Kn),ir),qr=r.d0(dr)/r.d0(k);if(sn=dr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qr/this._mercatorScaleRatio),this.zoom<=r.cZ&&rt.zoom===ht-1&&qr>=.9)return!0}else if(b&&(Zt=rt.aabb.distanceZ(me)*ce),this.projection.isReprojectedInTileSpace&&d<=5){const Vn=Math.pow(2,rt.zoom),Kn=qe(new r.ae((rt.x+.5)/Vn,(rt.y+.5)/Vn));sn=Kn>.85?1:Kn}if(!T){const Vn=Math.sqrt(zt*zt+wt*wt+Zt*Zt);let Kn=(1<<ht-rt.zoom)*Le*sn;return Kn*=nn(Math.max(Zt,bt),Vn),Vn<Kn}let Sn=Number.MAX_VALUE,Ht=0;const en=rt.aabb.getCorners(),Nn=[];for(const Vn of en){r.av(Nn,Vn,me),te||(b?Nn[2]*=ce:Nn[2]=bt);const Kn=r.bJ(Nn,this._camera.forward());Kn<Sn&&(Sn=Kn,Ht=Math.abs(Nn[2]))}let En=(1<<ht-rt.zoom)*Le*sn;if(En*=nn(Math.max(Ht,bt),Sn),Sn<En)return!0;const Gn=rt.aabb.closestPoint(q);return Gn[0]===q[0]&&Gn[1]===q[1]};if(this.renderWorldCopies)for(let rt=1;rt<=3;rt++)Xe.push(We(-rt)),Xe.push(We(rt));for(Xe.push(We(0));Xe.length>0;){const rt=Xe.pop(),zt=rt.x,wt=rt.y;let Zt=rt.fullyVisible;const sn=()=>this.projection.name==="globe"&&(rt.y===0||rt.y===(1<<rt.zoom)-1);if(!Zt){let Sn=Me?rt.aabb.intersects(re):rt.aabb.intersectsFlat(re);if(Sn===0&&sn()){const Ht=new r.cC(rt.zoom,zt,wt);Sn=r.cD(this,G,Ht,!0).intersects(re)}if(Sn===0)continue;Zt=Sn===2}if(rt.zoom!==ht&&St(rt))for(let Sn=0;Sn<4;Sn++){const Ht=(zt<<1)+Sn%2,en=(wt<<1)+(Sn>>1),Nn={aabb:T?rt.aabb.quadrant(Sn):r.cE(this,G,rt.zoom+1,Ht,en,rt.wrap,rt.minZ,rt.maxZ,this.projection),zoom:rt.zoom+1,x:Ht,y:en,wrap:rt.wrap,fullyVisible:Zt,tileID:void 0,shouldSplit:void 0,minZ:rt.minZ,maxZ:rt.maxZ};b&&!te&&(Nn.tileID=new r.aO(rt.zoom+1===ht?Lt:rt.zoom+1,rt.wrap,rt.zoom+1,Ht,en),Pt(Nn)),Xe.push(Nn)}else{const Sn=rt.zoom===ht?Lt:rt.zoom;if(n.minzoom&&n.minzoom>Sn)continue;let Ht=0;if(!Zt){let Gn=Me?rt.aabb.intersectsPrecise(re):rt.aabb.intersectsPreciseFlat(re);if(Gn===0&&sn()){const Vn=new r.cC(rt.zoom,zt,wt);Gn=r.cD(this,G,Vn,!0).intersectsPrecise(re)}if(Gn===0)continue;if(n.calculateQuadrantVisibility)if(re.containsPoint(rt.aabb.center))Ht=15;else for(let Vn=0;Vn<4;Vn++)rt.aabb.quadrant(Vn).intersects(re)!==0&&(Ht|=1<<Vn)}const en=q[0]-(.5+zt+(rt.wrap<<rt.zoom))*(1<<a-rt.zoom),Nn=q[1]-.5-wt,En=rt.tileID?rt.tileID:new r.aO(Sn,rt.wrap,rt.zoom,zt,wt);n.calculateQuadrantVisibility&&(En.visibleQuadrants=Ht),Tt.push({tileID:En,distanceSq:en*en+Nn*Nn})}}if(this.fogCullDistSq){const rt=this.fogCullDistSq,zt=this.horizonLineFromTop();Tt=Tt.filter((wt=>{const Zt=[0,0,0,1],sn=[r.al,r.al,0,1],Sn=this.calculateFogTileMatrix(wt.tileID.toUnwrapped());r.aC(Zt,Zt,Sn),r.aC(sn,sn,Sn);const Ht=r.cF([],Zt,sn),en=r.cG([],Zt,sn),Nn=r.c_(Ht,en);if(Nn===0)return!0;let En=!1;const Gn=this._elevation;if(Gn&&Nn>rt&&zt!==0){const Vn=this.calculateProjMatrix(wt.tileID.toUnwrapped());let Kn;n.isTerrainDEM||(Kn=Gn.getMinMaxForTile(wt.tileID)),Kn||(Kn={min:He,max:Ze});const ir=r.cH(this.rotation),dr=[ir[0]*r.al,ir[1]*r.al,Kn.max];r.af(dr,dr,Vn),En=(1-dr[1])*this.height*.5<zt}return Nn<rt||En}))}return Tt.sort(((rt,zt)=>rt.distanceSq-zt.distanceSq)).map((rt=>rt.tileID))}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const a=r.aA(n.lat,-r.cI,r.cI),d=this.projection.project(n.lng,a);return new r.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let d,_;const b=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;d=(a.x-b.x)/P,_=(a.y-b.y)/P}else{const P=this.pointCoordinate(a),k=this.pointCoordinate(b);d=P.x-k.x,_=P.y-k.y}const T=this.locationCoordinate(n);this.setLocation(new r.ae(T.x-d,T.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,a){return this.projection.locationPoint(this,n,a)}locationPoint3D(n,a){return this.projection.locationPoint(this,n,a,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,a){return this.coordinateLocation(this.pointCoordinate3D(n,a))}locationCoordinate(n,a){const d=a?r.ce(a,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new r.ae(_.x,_.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const d=a??this._centerAltitude,_=[n.x,n.y,0,1],b=[n.x,n.y,1,1];r.aC(_,_,this.pixelMatrixInverse),r.aC(b,b,this.pixelMatrixInverse);const T=b[3];r.cJ(_,_,1/_[3]),r.cJ(b,b,1/T);const P=_[2],k=b[2];return{p0:_,p1:b,t:P===k?0:(d-P)/(k-P)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return r.aC(a,a,this.pixelMatrixInverse),r.aC(d,d,this.pixelMatrixInverse),r.cJ(a,a,1/a[3]),r.cJ(d,d,1/d[3]),a[2]=r.ce(a[2],this._center.lat)*this.worldSize,d[2]=r.ce(d[2],this._center.lat)*this.worldSize,r.cJ(a,a,1/this.worldSize),r.cJ(d,d,1/this.worldSize),new r.ax([a[0],a[1],a[2]],r.aw([],r.av([],d,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:d,t:_}=n,b=r.ce(a[2],this._center.lat),T=r.ce(d[2],this._center.lat);return new r.ae(r.ak(a[0],d[0],_)/this.worldSize,r.ak(a[1],d[1],_)/this.worldSize,r.ak(b,T,_))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n,a){if(!this.elevation)return this.pointCoordinate(n,a);let d=this.projection.pointCoordinate3D(this,n.x,n.y);if(d)return new r.ae(d[0],d[1],d[2]);let _=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,a);const T=.02*b,P=n.clone();for(let k=0;k<10&&b-_>T;k++){P.y=r.ak(_,b,.66);const G=this.projection.pointCoordinate3D(this,P.x,P.y);G?(b=P.y,d=G):_=P.y}return d?new r.ae(d[0],d[1],d[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return r.aC(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(a,n)),T=this.pointLocation3D(new r.P(_,n)),P=this.pointLocation3D(new r.P(_,d)),k=this.pointLocation3D(new r.P(a,d));let G=Math.min(b.lng,T.lng,P.lng,k.lng),q=Math.max(b.lng,T.lng,P.lng,k.lng),te=Math.min(b.lat,T.lat,P.lat,k.lat),Y=Math.max(b.lat,T.lat,P.lat,k.lat);const re=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,ce=(Pe,me,Me,Le,Fe)=>{const Ze=(Pe+Me)/2,He=(me+Le)/2,Ye=new r.P(Ze,He),{lng:qe,lat:We}=this.pointLocation3D(Ye),Xe=Math.max(0,G-qe,te-We,qe-q,We-Y);G=Math.min(G,qe),q=Math.max(q,qe),te=Math.min(te,We),Y=Math.max(Y,We),(Fe<le||Xe>re)&&(ce(Pe,me,Ze,He,Fe+1),ce(Ze,He,Me,Le,Fe+1))};if(ce(a,n,_,n,1),ce(_,n,_,d,1),ce(_,d,a,d,1),ce(a,d,a,n,1),this.projection.name==="globe"){const[Pe,me]=r.cL(this);Pe?(Y=90,q=180,G=-180):me&&(te=-90,q=180,G=-180)}return new r.aI(new r.aR(G,te),new r.aR(q,Y))}_getBoundsRectangular(n,a){const{top:d,left:_}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,P=new r.P(_,d),k=new r.P(T,d),G=new r.P(T,b),q=new r.P(_,b);let te=this.pointCoordinate(P,n),Y=this.pointCoordinate(k,n);const re=this.pointCoordinate(G,a),le=this.pointCoordinate(q,a),ce=(Pe,me)=>(me.y-Pe.y)/(me.x-Pe.x);return te.y>1&&Y.y>=0?te=new r.ae((1-le.y)/ce(le,te)+le.x,1):te.y<0&&Y.y<=1&&(te=new r.ae(-le.y/ce(le,te)+le.x,0)),Y.y>1&&te.y>=0?Y=new r.ae((1-re.y)/ce(re,Y)+re.x,1):Y.y<0&&te.y<=1&&(Y=new r.ae(-re.y/ce(re,Y)+re.x,0)),new r.aI().extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce(((d,_)=>{if(_.dem){const b=_.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];const _=n.canonical,b=1/this.height,T=this.cameraWorldSize,P=T/this.zoomScale(_.z),k=(_.x+Math.pow(2,_.z)*n.wrap)*P,G=_.y*P,q=this.point;q.x*=T/this.worldSize,q.y*=T/this.worldSize;const te=this.angle,Y=Math.sin(-te),re=-Math.cos(-te);return d[a]={bearing:[Y,re],center:[(q.x-k)*b,(q.y-G)*b],scale:P/r.al*b},d[a]}calculateFogTileMatrix(n){const a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.aB(_,this.worldToFogMatrix,_),d[a]=new Float32Array(_),d[a]}calculateProjMatrix(n,a=!1,d=!1){const _=n.key;let b;if(b=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[_])return b[_];const T=this.calculatePosMatrix(n,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.aB(T,P,T),b[_]=new Float32Array(T),b[_]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const _=r.cM(n,this);return d[a]=_,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=r.bq([],[n,n,n]);return r.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=r.ce(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=this._camera.forward(),b=r.ce(1,this._center.lat);d[2]/=b,_[2]/=b,r.aw(_,_);const T=n.raycast(d,_,n.exaggeration());if(T){const P=r.bH([],d,_,T),k=new r.ae(P[0],P[1],r.ce(P[2],r.a$(P[1]))),G=(k.z+r.ag([k.x-d[0],k.y-d[1],k.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,d=r.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=a.getAtPointOrZero(new r.ae(..._)),T=this.pixelsPerMeter/this.worldSize*b,P=this._minimumHeightOverTerrain(),k=_[2]-T;if(k<=P)if(k<0||n){const G=this.locationCoordinate(this._center,this._centerAltitude),q=[_[0],_[1],G.z-_[2]],te=r.ag(q);q[2]-=(P-k)/this._pixelsPerMercatorPixel;const Y=r.ag(q);if(Y===0)return;r.c4(q,q,te/Y*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],G.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const Y=this.center;return Y.lat=r.aA(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(Y.lng=r.aA(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:_}=this.point;let b=0,T=d,P=_;const k=this.width/2,G=this.height/2,q=this.worldMinY*this.scale,te=this.worldMaxY*this.scale;if(_-G<q&&(P=q+G),_+G>te&&(P=te-G),te-q<this.height&&(b=Math.max(b,this.height/(te-q)),P=(te+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,le=this.worldSize/2-(Y+re)/2;T=(d+le+this.worldSize)%this.worldSize-le,T-k<Y&&(T=Y+k),T+k>re&&(T=re-k),re-Y<this.width&&(b=Math.max(b,this.width/(re-Y)),T=(re+Y)/2)}T===d&&P===_||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(T,P))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const _=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,T=this._camera.getWorldToCamera(this.worldSize,b);let P;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-n.x/this.width,k[9]=2*n.y/this.height,this.isOrthographic){let We=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Xe=We*this.aspect,Tt=-Xe,ht=-We;Xe-=n.x,Tt-=n.x,We+=n.y,ht+=n.y,P=this._camera.getCameraToClipOrthographic(Tt,Xe,ht,We,this._nearZ,this._farZ),((Lt,bt,Pt,nn)=>{for(let St=0;St<16;St++)Lt[St]=r.ak(bt[St],Pt[St],nn)})(P,P,k,r.c$(this.pitch>=$a?1:this.pitch/$a))}else P=k;const G=r.cO([],k,T);let q=r.cO([],P,T);if(this.projection.isReprojectedInTileSpace){const We=this.locationCoordinate(this.center),Xe=r.bA([]);r.br(Xe,Xe,[We.x*this.worldSize,We.y*this.worldSize,0]),r.aB(Xe,Xe,r.cP(this)),r.br(Xe,Xe,[-We.x*this.worldSize,-We.y*this.worldSize,0]),r.aB(q,q,Xe),r.aB(G,G,Xe),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],q,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=q,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),a){const We=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);We[8]=2*-n.x/this.width,We[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.cO([],We,T)}else this.expandedFarZProjMatrix=this.projMatrix;const te=r.bl([],P);this.frustumCorners=r.cS.fromInvProjectionMatrix(te,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const Y=new Float32Array(16);r.bA(Y),r.cR(Y,Y,[1,-1,1]),r.cT(Y,Y,this._pitch),r.bB(Y,Y,this.angle);const re=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(re);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;re[8]=2*-n.x/this.width,re[9]=2*(n.y+le)/this.height,this.skyboxMatrix=r.aB(Y,re,Y);const ce=this.point,Pe=ce.x,me=ce.y,Me=this.width%2/2,Le=this.height%2/2,Fe=Math.cos(this.angle),Ze=Math.sin(this.angle),He=Pe-Math.round(Pe)+Fe*Me+Ze*Le,Ye=me-Math.round(me)+Fe*Le+Ze*Me,qe=new Float64Array(q);if(r.br(qe,qe,[He>.5?He-1:He,Ye>.5?Ye-1:Ye,0]),this.alignedProjMatrix=qe,q=r.bC(),r.cR(q,q,[this.width/2,-this.height/2,1]),r.br(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=r.bC(),r.cR(q,q,[1,-1,1]),r.br(q,q,[-1,-1,0]),r.cR(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},q=r.bl(new Float64Array(16),this.pixelMatrix),!q)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=q,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const We=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(We,We,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=q;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,a];r.c4(b,b,_),r.c4(d,d,-1),r.cV(d,d,b);const T=r.bC();r.br(T,T,d),r.cR(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,_)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*b,_.y/this.worldSize-d[1]*b,n/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(b=Math.min((a-d)/_,1)),this._camera.position=r.bH([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),b=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),P=Math.max((n[2]-b)/Math.cos(d),T),k=this._zoomFromMercatorZ(P);r.bH(n,n,a,P),this._pitch=r.aA(d,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(_,-Math.PI,Math.PI),this._setZoom(r.aA(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,d=r.cK,_=0,b=1/0;for(;d-a>1e-6&&d>a;){const T=a+.5*(d-a),P=this.tileSize*Math.pow(2,T),k=this.getCameraToCenterDistance(this.projection,T,P),G=this.scaleZoom(k/(Math.max(0,n)*this.tileSize)),q=Math.abs(T-G);q<b&&(b=q,_=T),T<G?a=T:d=T}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const d=Math.min(n.x,a.x),_=Math.max(n.x,a.x),b=Math.min(n.y,a.y),T=Math.max(n.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new r.P(d,b),new r.P(_,T),new r.P(d,T),new r.P(_,b)],k=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const q of P){const te=this.pointRayIntersection(q);if(te.t<0)return!0;const Y=this.rayIntersectionCoordinate(te);if(Y.x<k||Y.y<0||Y.x>G||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,a){const d=r.ag(r.av([],this._camera.position,n)),_=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([a,d,_],b){const T=[a,d,_,1];r.aC(T,T,b);const P=T[3]=Math.max(T[3],1e-6);return T[0]/=P,T[1]/=P,T[2]/=P,T})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,d=this.worldSize){const _=r.cN(n,a,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,d,_);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=r.ak(1,T,r.c$(this.pitch>=$a?1:this.pitch/$a))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(n,n,this.globeMatrix),n}getFrustum(n){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const po=(h,n)=>{if(n>0&&h.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),_=a.isLODDisabled(!1)?r.ah(60,45,a.pitch):r.ah(30,15,a.pitch),b=a._farZ-a._nearZ,T=n*a.height,P=((1-(k=_))*a.cameraToCenterDistance+k*(a._farZ+T))*d;var k;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(P-a._nearZ)/b,(P-T-a._nearZ)/b]}}},hs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class eg{constructor(n,a){this.aabb=n,this.lastCascade=a}}class Id{add(n,a){const d=this.receivers[n.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[n.key]=new eg(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,d){const _=r.d8.fromPoints(n.points);let b=0;for(const T in this.receivers){const P=this.receivers[T];if(!P||!_.intersectsAabb(P.aabb))continue;P.aabb.min=_.closestPoint(P.aabb.min),P.aabb.max=_.closestPoint(P.aabb.max);const k=P.aabb.getCorners();for(let G=0;G<d.length;G++){let q=!0;for(const te of k){const Y=[te[0]*a,te[1]*a,te[2]];if(r.af(Y,Y,d[G].matrix),Y[0]<-1||Y[0]>1||Y[1]<-1||Y[1]>1){q=!1;break}}if(P.lastCascade=G,b=Math.max(b,G),q)break}}return b+1}}class Mh{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Id,this._depthMode=new Pn(n.context.gl.LEQUAL,Pn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),n.tp.registerParameter(hs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(hs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(hs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const _=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce(((le,ce)=>{const Pe=d.style._mergedLayers[ce];return le+(Pe.hasShadowPass()&&!Pe.isHidden(n.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,T=hs.shadowMapResolution,P=hs.shadowMapResolution;if(this._cascades.length===0||hs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<hs.cascadeCount;++le){const ce=d._shadowMapDebug,Pe=b.gl,me=b.createFramebuffer(T,P,ce,"texture"),Me=new r.T(b,{width:T,height:P,data:null},Pe.DEPTH_COMPONENT16);if(me.depthAttachment.set(Me.texture),ce){const Le=new r.T(b,{width:T,height:P,data:null},Pe.RGBA8);me.colorAttachment.set(Le.texture)}this._cascades.push({framebuffer:me,texture:Me,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=Du(a);let k=0;if(n.elevation){const le=n.elevation,ce=[1e4,-1e4];le.visibleDemTiles.filter((Pe=>Pe.dem)).forEach((Pe=>{const me=Pe.dem.tree;ce[0]=Math.min(ce[0],me.minimums[0]),ce[1]=Math.max(ce[1],me.maximums[0])})),ce[0]!==1e4&&(k=(ce[1]-ce[0])*le.exaggeration())}const G=1.5*n.cameraToCenterDistance,q=3*G,te=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ce=this._cascades[le];let Pe=n.height/50,me=1;hs.cascadeCount===1?me=q:le===0?me=G:(Pe=G,me=q);const[Me,Le]=Ih(n,this.shadowDirection,Pe,me,hs.shadowMapResolution,k);ce.scale=n.scale,ce.matrix=Me,ce.boundingSphereRadius=Le,r.bl(te,ce.matrix),ce.frustum=r.cA.fromInvProjectionMatrix(te,1,0,!0),ce.far=me}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/hs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=hs.shadowMapResolution,this._uniformValues.u_shadowmap_0=vo.ShadowMap0,this._uniformValues.u_shadowmap_1=vo.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const re=d.transform.elevation;for(const le of this._groundShadowTiles){let ce={min:0,max:0};if(re){const Pe=re.getMinMaxForTile(le);Pe&&(ce=Pe)}this.addShadowReceiver(le.toUnwrapped(),ce.min,ce.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,hs.shadowMapResolution,hs.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,_.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),_.clear({color:r.ao.white,depth:1});for(const T of n.order){const P=n._mergedLayers[T];if(!P.hasShadowPass()||P.isHidden(d.transform.zoom))continue;const k=n.getLayerSourceCache(P),G=k?a[k.id]:void 0;(P.type==="model"||G&&G.length)&&d.renderLayer(d,k,P,G)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,a=n.style,d=n.context,_=d.gl,b=a.directionalLight,T=a.ambientLight;if(!b||!T)return;const P=[],k=po(n,n.longestCutoffRange);k.shouldRenderCutoff&&P.push("RENDER_CUTOFF"),P.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&P.push("NORMAL_OFFSET");const G=Ha(a,b,T),q=new Pn(_.LEQUAL,Pn.ReadOnly,n.depthRangeFor3D),te=new sr({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const Y of this._groundShadowTiles){const re=Y.toUnwrapped(),le=n.isTileAffectedByFog(Y),ce=n.getOrCreateProgram("groundShadow",{defines:P,overrideFog:le});this.setupShadows(re,ce),n.uploadCommonUniforms(d,ce,re,null,k);const Pe={u_matrix:n.transform.calculateProjMatrix(re),u_ground_shadow_factor:G};ce.draw(n,_.TRIANGLES,q,te,br.multiply,er.disabled,Pe,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?br.unblended:br.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,d=a.calculatePosMatrix(n,a.worldSize);return r.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(n){return r.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,d){if(!this.enabled)return;const _=this.painter.transform,b=this.painter.context,T=b.gl,P=this._uniformValues,k=new Float64Array(16),G=_.calculatePosMatrix(n,_.worldSize);for(let q=0;q<this._cascades.length;q++)r.aB(k,this._cascades[q].matrix,G),P[q===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),b.activeTexture.set(T.TEXTURE0+vo.ShadowMap0+q),this._cascades[q].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const q=r.d6(n.canonical),te=2/_.tileSize*r.al/hs.shadowMapResolution,Y=te*this._cascades[0].boundingSphereRadius,re=te*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(d==="vector-tile"?1:3)*(function(ce,Pe,me,Me,Le){const Fe=r.aA((ce-22)/-22,0,1);return .125*(1-Fe)+4*Fe})(_.zoom);P.u_shadow_normal_offset=[q,Y*le,re*le],P.u_shadow_bias=[1e-4,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,P)}setupShadowsFromMatrix(n,a,d=!1){if(!this.enabled)return;const _=this.painter.context,b=_.gl,T=this._uniformValues,P=new Float64Array(16);for(let k=0;k<hs.cascadeCount;k++)r.aB(P,this._cascades[k].matrix,n),T[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),_.activeTexture.set(b.TEXTURE0+vo.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=d,d){const k=hs.normalOffset;T.u_shadow_normal_offset=[1,k,k],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,d,_){if(_[2]>=0)return{};const b=(function(k,G,q){const te=q/(1<<k.canonical.z);return new r.d8([k.canonical.x*te+k.wrap*q,k.canonical.y*te+k.wrap*q,0],[(k.canonical.x+1)*te+k.wrap*q,(k.canonical.y+1)*te+k.wrap*q,G])})(n,a,d).getCorners(),T=a/-_[2];_[0]<0?(r.d7(b[0],b[0],[_[0]*T,0,0]),r.d7(b[3],b[3],[_[0]*T,0,0])):_[0]>0&&(r.d7(b[1],b[1],[_[0]*T,0,0]),r.d7(b[2],b[2],[_[0]*T,0,0])),_[1]<0?(r.d7(b[0],b[0],[0,_[1]*T,0]),r.d7(b[1],b[1],[0,_[1]*T,0])):_[1]>0&&(r.d7(b[2],b[2],[0,_[1]*T,0]),r.d7(b[3],b[3],[0,_[1]*T,0]));const P={};return P.vertices=b,P.planes=[pl(b[1],b[0],b[4]),pl(b[2],b[1],b[5]),pl(b[3],b[2],b[6]),pl(b[0],b[3],b[7])],P}addShadowReceiver(n,a,d){this._receivers.add(n,r.d8.fromTileIdAndHeight(n,a,d))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function pl(h,n,a){const d=r.av([],a,n),_=r.av([],h,n),b=r.bI([],d,_),T=r.ag(b);return T===0?[0,0,1,0]:(r.c4(b,b,1/T),[b[0],b[1],b[2],-r.bJ(b,n)])}function Du(h){const n=h.properties.get("direction"),a=r.d3(n.x,n.y,n.z);a[2]=r.aA(a[2],0,75);const d=r.d5([a[0],a[1],a[2]]);return r.d4(d.x,d.y,d.z)}function Ha(h,n,a){const d=n.properties.get("color-use-theme")==="none",_=n.properties.get("color"),b=n.properties.get("intensity"),T=n.properties.get("direction"),P=[T.x,T.y,T.z],k=a.properties.get("color-use-theme")==="none",G=a.properties.get("color"),q=a.properties.get("intensity"),te=Math.max(r.bJ([0,0,1],P),0),Y=[0,0,0];r.c4(Y,G.toPremultipliedRenderColor(k?null:h.getLut(n.scope)).toArray01Linear().slice(0,3),q);const re=[0,0,0];return r.c4(re,_.toPremultipliedRenderColor(d?null:h.getLut(a.scope)).toArray01Linear().slice(0,3),te*b),r.da([Y[0]>0?Y[0]/(Y[0]+re[0]):0,Y[1]>0?Y[1]/(Y[1]+re[1]):0,Y[2]>0?Y[2]/(Y[2]+re[2]):0])}function Ih(h,n,a,d,_,b){const T=h.zoom,P=h.scale,k=h.worldSize,G=1/k,q=h.aspect,te=Math.sqrt(1+q*q)*Math.tan(.5*h.fovX),Y=te*te,re=d-a,le=d+a;let ce,Pe;Y>re/le?(ce=d,Pe=d*te):(ce=.5*le*(1+Y),Pe=.5*Math.sqrt(re*re+2*(d*d+a*a)*Y+le*le*Y*Y));const me=h.projection.pixelsPerMeter(h.center.lat,k),Me=h._camera.getCameraToWorldMercator(),Le=[0,0,-ce*G];r.af(Le,Le,Me);let Fe=Pe*G;const Ze=h._edgeInsets;if(!(Ze.left===0&&Ze.top===0&&Ze.right===0&&Ze.bottom===0||Ze.left===Ze.right&&Ze.top===Ze.bottom)){const Zt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?me:1),sn=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);sn[8]=2*-h.centerOffset.x/h.width,sn[9]=2*h.centerOffset.y/h.height;const Sn=new Float64Array(16);r.cO(Sn,sn,Zt);const Ht=new Float64Array(16);r.bl(Ht,Sn);const en=r.cA.fromInvProjectionMatrix(Ht,k,T,!0);for(const Nn of en.points){const En=((He=Nn)[0]/=P,He[1]/=P,He[2]=r.ce(He[2],h._center.lat),He);Fe=Math.max(Fe,r.c5(r.d9([],Le,En)))}}var He;Fe*=_/(_-1);const Ye=Math.acos(n[2]),qe=Math.atan2(-n[0],-n[1]),We=new Md;We.position=Le,We.setPitchBearing(Ye,qe);const Xe=We.getWorldToCamera(k,me),Tt=Fe*k,ht=Math.min(h._mercatorZfromZoom(17)*k*-2,-2*Tt),Lt=We.getCameraToClipOrthographic(-Tt,Tt,-Tt,Tt,ht,(Tt+b*me)/n[2]),bt=new Float64Array(16);r.aB(bt,Lt,Xe);const Pt=r.d4(Math.floor(1e6*Le[0])/1e6*k,Math.floor(1e6*Le[1])/1e6*k,0),nn=.5*_,St=[0,0,0];r.af(St,Pt,bt),r.c4(St,St,nn);const rt=[Math.floor(St[0]),Math.floor(St[1]),Math.floor(St[2])],zt=[0,0,0];r.av(zt,St,rt),r.c4(zt,zt,-1/nn);const wt=new Float64Array(16);return r.bA(wt),r.br(wt,wt,zt),r.aB(bt,wt,bt),[bt,Tt]}class ua extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,a){return r.aV(this.requestManager.transformRequest(a,r.R.Model).url).then((d=>{if(!d)return;const _=r.aW(d),b=new r.aX(n,void 0,void 0,_);return b.computeBoundsAndApplyParent(),b})).catch((d=>{if(d&&d.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${n} from ${a}: ${d.message}`)))}))}load(n,a,d={forceReload:!1}){this.models[a]||(this.models[a]={});const _=Object.keys(n),b=[],T=[];for(const P of _){const k=n[P];this.hasURLBeenRequested(k)&&!d.forceReload||(this.modelByURL[k]={modelId:P,scope:a},b.push(this.loadModel(P,k)),T.push(P)),this.models[a][P]||(this.models[a][P]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+T.length,Promise.allSettled(b).then((P=>{for(let k=0;k<P.length;k++){const{status:G}=P[k];if(G==="rejected")continue;const{value:q}=P[k];this.models[a][T[k]]||(this.models[a][T[k]]={model:null,numReferences:1}),this.models[a][T[k]].model=q}this.numModelsLoading[a]-=T.length,this.fire(new r.z("data",{dataType:"style"}))})).catch((P=>{this.fire(new r.y(new Error(`Could not load models: ${P.message}`)))}))}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(n,a):this.getModelByURL(this.modelUris[a][n]))}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]?this.models[a][n].model:void 0}getModelByURL(n){if(!n)return null;const a=this.modelByURL[n];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(n,a){return this.models[a]&&this.models[a][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.requestManager.normalizeModelURL(a);if((this.hasModel(n,d,{exactIdMatch:!0})||this.hasModelBeenAdded(n,d))&&this.modelUris[d][n]===_)this.models[d][n].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:b,modelId:T}=this.modelByURL[_];this.models[b][T].numReferences++}else this.modelUris[d][n]=_,this.load({[n]:this.modelUris[d][n]},d)}addModelURLs(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d=this.modelUris[a];for(const _ in n)d[_]=this.requestManager.normalizeModelURL(n[_])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d={};for(const _ of n)this.hasModel(_,a,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[a][_].numReferences++:this.modelUris[a][_]&&!this.hasURLBeenRequested(_)?d[_]=this.modelUris[a][_]:!this.hasURLBeenRequested(_)&&r.db(_,!1)&&(this.modelUris[a][_]=this.requestManager.normalizeModelURL(_),d[_]=this.modelUris[a][_]);this.load(d,a)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,a,d=!1,_=!1){if(this.models[a]&&this.models[a][n]&&(this.models[a][n].numReferences--,this.models[a][n].numReferences===0||_)){const b=this.modelUris[a][n];d||delete this.modelUris[a][n],delete this.modelByURL[b];const T=this.models[a][n].model;if(!T)return;delete this.models[a][n],T.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const a of Object.keys(this.models[n])){const d=this.models[n][a].model;delete this.models[n][a],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const d in this.models[a])this.models[a][d].model&&this.models[a][d].model.upload(n.context)}}const qp=new r.a9({data:new r.aa(r.a6.colorTheme.data)});function Rd(h){if(!h.metadata||!h.metadata.content_area)return;const n=r.o.devicePixelRatio,{left:a,top:d,width:_,height:b}=h.metadata.content_area,T=a*n,P=d*n;return[T,P,T+_*n,P+b*n]}function Rh(h){if(h)return h.map((([n,a])=>[n*r.o.devicePixelRatio,a*r.o.devicePixelRatio]))}class Nl{constructor(n,a,d){this.id=n,this.scope=a,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return n;const d=this.sourceCache.getSource();if(!(d instanceof zl))return n;const _=a.map((T=>this.sourceCache.getTile(T))),b=d.getImages(_,Array.from(this.pendingRequests));for(const[T,P]of b)n.set(r.I.from({name:T,iconsetId:this.id}),P),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),n}}const xc=(h,n)=>et(h,n&&n.filter((a=>a.identifier!=="source.canvas"))),Lf=r.aH(Wr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),tg=r.aH(Wr,["setCenter","setZoom","setBearing","setPitch"]),Dh=new Set(["background","sky","slot","custom"]),ng={version:8,layers:[],sources:{}},kh={duration:300,delay:0};class Da extends r.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},kh),this._buildingIndex=new wh(this),this.crossTileSymbolIndex=new $o,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new cn,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.dd(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new mt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.de(n._requestManager,a.localFontFamily?r.df.all:a.localIdeographFontFamily?r.df.ideographs:r.df.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new ua(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.dg());const d=this;this._rtlTextPluginCallback=Da.registerForPluginStateChange((_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},((b,T)=>{if(r.dh(b),T&&T.every((P=>P)))for(const P in d._sourceCaches){const k=d._sourceCaches[P],G=k.getSource().type;G!=="vector"&&G!=="geojson"||k.reload()}}))})),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.getOwnSource(_.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===b.id&&this._validateLayer(P)}}))}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(r.h(n))return n;const a=r.di(n);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.dj(JSON.stringify(n))}`}_diffStyle(n,a,d){this.globalId=this._getGlobalId(n);const _=(b,T)=>{try{T(null,this.setState(b,d))}catch(P){T(P,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),T=this.map._requestManager.transformRequest(b,r.R.Style);r.m(T,((P,k)=>{P?this.fire(new r.y(P)):k&&_(k,a)}))}else typeof n=="object"&&_(n,a)}loadURL(n,a={}){this.fire(new r.z("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!r.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,d);const b=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.m(b,((T,P)=>{if(this._request=null,T)this.fire(new r.y(T));else if(P)return this.importsCache.set(n,P),this._load(P,d)}))}loadJSON(n,a={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=r.o.frame((()=>{this._request=null,this._load(n,a.validate!==!1)}))}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(ng,!1)}_loadImports(n,a,d){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const b of n){const T=this._createFragmentStyle(b),P=new Promise((q=>{T.once("style.import.load",q),T.once("error",q)})).then((()=>this.mergeAll()));if(_.push(P),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const k=b.data||this.importsCache.get(b.url);k?(T.loadJSON(k,{validate:a}),this._isInternalStyle(k)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:a}):T.loadEmpty();const G={style:T,id:b.id,config:b.config};if(d){const q=this.fragments.findIndex((({id:te})=>te===d));this.fragments=this.fragments.slice(0,q).concat(G).concat(this.fragments.slice(q))}else this.fragments.push(G)}return Promise.allSettled(_)}getImportGlobalIds(n=this,a=new Set){for(const d of n.fragments)d.style.globalId&&a.add(d.style.globalId),this.getImportGlobalIds(d.style,a);return[...a.values()]}_createFragmentStyle(n){const a=this.scope?r.B(n.id,this.scope):n.id;let d;const _=this._initialConfig&&this._initialConfig[a];(n.config||_)&&(d=Object.assign({},n.config,_));const b=new Da(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,a){if(this._isInternalStyle(n)){const b=Object.assign({},ng,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(b,a)}if(this.updateConfig(this._config,n.schema),a&&xc(this,Yr(n)))return;this._loaded=!0,this.stylesheet=r.dk(n);const d=()=>{for(const k in n.sources)this.addSource(k,n.sources[k],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const k in n.iconsets)this.addIconset(k,n.iconsets[k]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=Sh(this.stylesheet.layers);if(this._order=b.map((k=>k.id)),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new dt(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new dt(this.stylesheet.light)),this._layers={};for(const k of b){const G=r.dq(k,this.scope,this._styleColorTheme.lut,this.options);G.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const q=this.getOwnLayerSourceCache(G),te=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&G.canCastShadows()&&te&&(q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const P=this.isRootStyle();n.imports?this._loadImports(n.imports,a).then((()=>{this._reloadImports(),this.fire(new r.z(P?"style.load":"style.import.load"))})).catch((k=>{this.fire(new r.y(new Error("Failed to load imports",k))),this.fire(new r.z(P?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new r.z(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const b=this._evaluateColorThemeData(_);this._loadColorTheme(b).then((()=>{d()})).catch((T=>{r.w(`Couldn't load color theme from the stylesheet: ${T}`),d()}))}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,d,_,b,T,P,k,G,q;const te={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((Y=>{if(Y.stylesheet){if(Y.light!=null&&(n=Y.light),Y.stylesheet.lights)for(const re of Y.stylesheet.lights)re.type==="ambient"&&Y.ambientLight!=null&&(a=Y.ambientLight),re.type==="directional"&&Y.directionalLight!=null&&(d=Y.directionalLight);_=this._prioritizeTerrain(_,Y.terrain,Y.stylesheet.terrain),Y.stylesheet.fog&&Y.fog!=null&&(b=Y.fog),Y.stylesheet.snow&&Y.snow!=null&&(T=Y.snow),Y.stylesheet.rain&&Y.rain!=null&&(P=Y.rain),Y.stylesheet.camera!=null&&(q=Y.stylesheet.camera),Y.stylesheet.projection!=null&&(k=Y.stylesheet.projection),Y.stylesheet.transition!=null&&(G=Y.stylesheet.transition),te[Y.scope]=Y._styleColorTheme}})),this.light=n,this.ambientLight=a,this.directionalLight=d,this.fog=b,this.snow=T,this.rain=P,this._styleColorThemeForScope=te,_===null?delete this.terrain:this.terrain=_,this.camera=q||{"camera-projection":"perspective"},this.projection=k||{name:"mercator"},this.transition=Object.assign({},kh,G),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=d=>{for(const _ of d.fragments)a(_.style);n(d)};a(this)}_prioritizeTerrain(n,a,d){const _=n&&n.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:_?n:null:a!=null&&(!n||_||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)})),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle((a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)})),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},d={};this.forEachFragmentStyle((_=>{for(const b in _._sourceCaches){const T=r.B(b,_.scope);n[T]=_._sourceCaches[b]}for(const b in _._otherSourceCaches){const T=r.B(b,_.scope);a[T]=_._otherSourceCaches[b]}for(const b in _._symbolSourceCaches){const T=r.B(b,_.scope);d[T]=_._symbolSourceCaches[b]}})),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeLayers(){const n={},a=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((T=>{for(const P of T._order){const k=T._layers[P];if(k.type==="slot"){const G=r.dl(P);if(n[G])continue;n[G]=[]}k.slot&&n[k.slot]?n[k.slot].push(k):a.push(k)}})),this._mergedOrder=[];let _=-1;const b=(T=[])=>{for(const P of T)if(P.type==="slot"){const k=r.dl(P.id);n[k]&&b(n[k]),this._mergedSlots.push(k)}else{const k=r.B(P.id,P.scope);this._mergedOrder.push(k),d[k]=P,P.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),P.type==="circle"&&(this._hasCircleLayers=!0),P.type==="symbol"&&(this._hasSymbolLayers=!0),P.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(a),this._has3DLayers){const T={};for(let P=0;P<this._mergedOrder.length;++P){const k=this._mergedOrder[P];T[k]=P===_?1:P<_?d[k].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((P,k)=>T[P]-T[k]))}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(a,d,_,b){const T=Object.assign({},d);for(const k of Object.keys(r.a6.colorTheme))T[k]===void 0&&(T[k]=r.a6.colorTheme[k].default);const P=new r.a8(qp,a,new Map(_));return P.setTransitionOrValue(T,_),P.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,_)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let T=n;T.startsWith(b)||(T=b+T);const P=r.I.from("mapbox-reserved-lut"),k=new Image;k.src=T,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void d();this._styleColorTheme.lutLoading=!1;const{width:G,height:q,data:te}=r.o.getImageData(k);if(q>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==q*q)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new r.q({width:G,height:q},te),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Y=this.imageManager.getImage(P,this.scope);Y?(this._styleColorTheme.lut={image:Y.data,data:n},d()):_(new Error("Missing LUT image."))}}))}getLut(n){const a=this._styleColorThemeForScope[n];return a?a.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(a,d,_){let b,T,P;const k=r.o.devicePixelRatio>1?"@2x":"";let G=r.m(d.transformRequest(d.normalizeSpriteURL(a,k,".json"),r.R.SpriteJSON),((Y,re)=>{G=null,P||(P=Y,b=re,te())})),q=r.n(d.transformRequest(d.normalizeSpriteURL(a,k,".png"),r.R.SpriteImage),((Y,re)=>{q=null,P||(P=Y,T=re,te())}));function te(){if(P)_(P);else if(b&&T){const Y=r.o.getImageData(T),re={};for(const le in b){const{width:ce,height:Pe,x:me,y:Me,sdf:Le,pixelRatio:Fe,stretchX:Ze,stretchY:He,content:Ye}=b[le],qe=new r.q({width:ce,height:Pe});r.q.copy(Y,qe,{x:me,y:Me},{x:0,y:0},{width:ce,height:Pe},null),re[le]={data:qe,pixelRatio:Fe!==void 0?Fe:1,sdf:Le!==void 0&&Le,stretchX:Ze,stretchY:He,content:Ye,usvg:!1,version:0}}_(null,re)}}return{cancel(){G&&(G.cancel(),G=null),q&&(q.cancel(),q=null)}}})(n,this.map._requestManager,((a,d)=>{if(this._spriteRequest=null,a)this.fire(new r.y(a));else if(d){const _=new Map;for(const b in d)_.set(r.I.from(b),d[b]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))}))}addIconset(n,a){if(a.type==="sprite")return void this._loadSprite(a.url);const d=this.getOwnSourceCache(a.source);if(!d)return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const _=d.getSource();if(_.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const b=new Nl(n,this.scope,d);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!r.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const a=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(b,T)=>{if(this._spriteRequest=null,b)a?this._loadSprite(n):this.fire(new r.y(b));else if(T){const P=new Map;for(const k in T)P.set(r.I.from(k),T[k]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(n),r.R.Iconset),((b,T)=>{if(b)return void _(b);const P={},k=r.dc(new r.bt(T));for(const G of k.icons){const q={version:1,pixelRatio:r.o.devicePixelRatio,content:Rd(G),stretchX:G.metadata?Rh(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?Rh(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};P[G.name]=q}_(null,P)})))}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new r.y(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((n,a)=>{const d=this.fragments[a];return d&&d.style&&(n.data=d.style.serialize()),n}))}_serializeSources(){const n={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return n}_serializeLayers(n){const a=[];for(const d of n){const _=this._layers[d];_&&_.type!=="custom"&&a.push(_.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new r.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new r.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,a){const d=this.map.painter;if(d)for(let _=n.minzoom||0;_<(n.maxzoom||25.5);_++){const b=n.getProgramIds();if(b)for(const T of b){const P=n.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);P&&(d.style=this,this.fog&&(d._fogVisible=!0,P.overrideFog=!0,d.getOrCreateProgram(T,P)),d._fogVisible=!1,P.overrideFog=!1,d.getOrCreateProgram(T,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,d.getOrCreateProgram(T,P)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const k in P){const{updatedIds:G,removedIds:q}=P[k];(G||q)&&(this._updateWorkerLayers(k,G,q),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const P in this._mergedSourceCaches){const k=this._mergedSourceCaches[P];b[P]=k.used,k.used=!1,k.tileCoverLift=0}for(const P of this._mergedOrder){const k=this._mergedLayers[P];if(k.recalculate(n,this._availableImages),!k.isHidden(n.zoom)){const G=this.getLayerSourceCache(k);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(k,n)})):this.precompilePrograms(k,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const P of T)P.sourceCache.used=!0;for(const P in b){const k=this._mergedSourceCaches[P];b[P]!==k.used&&k.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const a of n){const d=a.resolvePendingRequests(),_=this.getFragmentStyle(a.scope);_&&_.addImages(d)}}_updateTilesForChangedImages(){const n={};for(const a in this._mergedSourceCaches){const d=this._mergedSourceCaches[a].getSource().scope;n[d]=n[d]||this._changes.getUpdatedImages(d),n[d].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n[d])}for(const a in n)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(n,a,d){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:a?_._serializeLayers(a):[],scope:n,removedIds:d||[],options:_.options})}setState(n,a){if(this._checkLoaded(),xc(this,Yr(n)))return!1;(n=r.dk(n)).layers=Sh(n.layers);const d=(function(T,P){if(!T)return[{command:Wr.setStyle,args:[P]}];let k=[];try{if(!r.by(T.version,P.version))return[{command:Wr.setStyle,args:[P]}];if(r.by(T.center,P.center)||k.push({command:Wr.setCenter,args:[P.center]}),r.by(T.zoom,P.zoom)||k.push({command:Wr.setZoom,args:[P.zoom]}),r.by(T.bearing,P.bearing)||k.push({command:Wr.setBearing,args:[P.bearing]}),r.by(T.pitch,P.pitch)||k.push({command:Wr.setPitch,args:[P.pitch]}),r.by(T.sprite,P.sprite)||k.push({command:Wr.setSprite,args:[P.sprite]}),r.by(T.glyphs,P.glyphs)||k.push({command:Wr.setGlyphs,args:[P.glyphs]}),r.by(T.imports,P.imports)||(function(re=[],le=[],ce){le=le||[];const Pe=(re=re||[]).map(Vc),me=le.map(Vc),Me=re.reduce(vd,{}),Le=le.reduce(vd,{}),Fe=Pe.slice();let Ze,He,Ye,qe;for(Ze=0,He=0;Ze<Pe.length;Ze++)Ye=Pe[Ze],Le.hasOwnProperty(Ye)?He++:(ce.push({command:Wr.removeImport,args:[Ye]}),Fe.splice(Fe.indexOf(Ye,He),1));for(Ze=0,He=0;Ze<me.length;Ze++)Ye=me[me.length-1-Ze],Fe[Fe.length-1-Ze]!==Ye&&(Me.hasOwnProperty(Ye)?(ce.push({command:Wr.removeImport,args:[Ye]}),Fe.splice(Fe.lastIndexOf(Ye,Fe.length-He),1)):He++,qe=Fe[Fe.length-Ze],ce.push({command:Wr.addImport,args:[Le[Ye],qe]}),Fe.splice(Fe.length-Ze,0,Ye));for(const We of le){const Xe=Me[We.id];Xe&&(delete Xe.data,r.by(Xe,We)||ce.push({command:Wr.updateImport,args:[We.id,We]}))}})(T.imports,P.imports,k),r.by(T.transition,P.transition)||k.push({command:Wr.setTransition,args:[P.transition]}),r.by(T.light,P.light)||k.push({command:Wr.setLight,args:[P.light]}),r.by(T.fog,P.fog)||k.push({command:Wr.setFog,args:[P.fog]}),r.by(T.snow,P.snow)||k.push({command:Wr.setSnow,args:[P.snow]}),r.by(T.rain,P.rain)||k.push({command:Wr.setRain,args:[P.rain]}),r.by(T.projection,P.projection)||k.push({command:Wr.setProjection,args:[P.projection]}),r.by(T.lights,P.lights)||k.push({command:Wr.setLights,args:[P.lights]}),r.by(T.camera,P.camera)||k.push({command:Wr.setCamera,args:[P.camera]}),r.by(T.iconsets,P.iconsets)||(function(re,le,ce){let Pe;for(Pe in le=le||{},re=re||{})re.hasOwnProperty(Pe)&&(le.hasOwnProperty(Pe)||ce.push({command:Wr.removeIconset,args:[Pe]}));for(Pe in le){if(!le.hasOwnProperty(Pe))continue;const me=le[Pe];re.hasOwnProperty(Pe)?r.by(re[Pe],me)||(ce.push({command:Wr.removeIconset,args:[Pe]}),ce.push({command:Wr.addIconset,args:[Pe,me]})):ce.push({command:Wr.addIconset,args:[Pe,me]})}})(T.iconsets,P.iconsets,k),!r.by(T["color-theme"],P["color-theme"]))return[{command:Wr.setStyle,args:[P]}];const G={},q=[];(function(re,le,ce,Pe){let me;for(me in le=le||{},re=re||{})re.hasOwnProperty(me)&&(le.hasOwnProperty(me)||Gp(me,ce,Pe));for(me in le){if(!le.hasOwnProperty(me))continue;const Me=le[me];re.hasOwnProperty(me)?r.by(re[me],Me)||(re[me].type==="geojson"&&Me.type==="geojson"&&Th(re,le,me)?ce.push({command:Wr.setGeoJSONSourceData,args:[me,Me.data]}):Ef(me,le,ce,Pe)):Au(me,le,ce)}})(T.sources,P.sources,q,G);const te=[];T.layers&&T.layers.forEach((re=>{re.source&&G[re.source]?k.push({command:Wr.removeLayer,args:[re.id]}):te.push(re)}));let Y=T.terrain;Y&&G[Y.source]&&(k.push({command:Wr.setTerrain,args:[void 0]}),Y=void 0),k=k.concat(q),r.by(Y,P.terrain)||k.push({command:Wr.setTerrain,args:[P.terrain]}),(function(re,le,ce){le=le||[];const Pe=(re=re||[]).map(Vc),me=le.map(Vc),Me=re.reduce(vd,{}),Le=le.reduce(vd,{}),Fe=Pe.slice(),Ze=Object.create(null);let He,Ye,qe,We,Xe,Tt,ht;for(He=0,Ye=0;He<Pe.length;He++)qe=Pe[He],Le.hasOwnProperty(qe)?Ye++:(ce.push({command:Wr.removeLayer,args:[qe]}),Fe.splice(Fe.indexOf(qe,Ye),1));for(He=0,Ye=0;He<me.length;He++)qe=me[me.length-1-He],Fe[Fe.length-1-He]!==qe&&(Me.hasOwnProperty(qe)?(ce.push({command:Wr.removeLayer,args:[qe]}),Fe.splice(Fe.lastIndexOf(qe,Fe.length-Ye),1)):Ye++,Tt=Fe[Fe.length-He],ce.push({command:Wr.addLayer,args:[Le[qe],Tt]}),Fe.splice(Fe.length-He,0,qe),Ze[qe]=!0);for(He=0;He<me.length;He++)if(qe=me[He],We=Me[qe],Xe=Le[qe],!Ze[qe]&&!r.by(We,Xe))if(r.by(We.source,Xe.source)&&r.by(We["source-layer"],Xe["source-layer"])&&r.by(We.type,Xe.type)){for(ht in pc(We.layout,Xe.layout,ce,qe,null,Wr.setLayoutProperty),pc(We.paint,Xe.paint,ce,qe,null,Wr.setPaintProperty),r.by(We.slot,Xe.slot)||ce.push({command:Wr.setSlot,args:[qe,Xe.slot]}),r.by(We.filter,Xe.filter)||ce.push({command:Wr.setFilter,args:[qe,Xe.filter]}),r.by(We.minzoom,Xe.minzoom)&&r.by(We.maxzoom,Xe.maxzoom)||ce.push({command:Wr.setLayerZoomRange,args:[qe,Xe.minzoom,Xe.maxzoom]}),We)We.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&ht!=="slot"&&(ht.indexOf("paint.")===0?pc(We[ht],Xe[ht],ce,qe,ht.slice(6),Wr.setPaintProperty):r.by(We[ht],Xe[ht])||ce.push({command:Wr.setLayerProperty,args:[qe,ht,Xe[ht]]}));for(ht in Xe)Xe.hasOwnProperty(ht)&&!We.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&ht!=="slot"&&(ht.indexOf("paint.")===0?pc(We[ht],Xe[ht],ce,qe,ht.slice(6),Wr.setPaintProperty):r.by(We[ht],Xe[ht])||ce.push({command:Wr.setLayerProperty,args:[qe,ht,Xe[ht]]}))}else ce.push({command:Wr.removeLayer,args:[qe]}),Tt=Fe[Fe.lastIndexOf(qe)+1],ce.push({command:Wr.addLayer,args:[Xe,Tt]})})(te,P.layers,k)}catch(G){console.warn("Unable to compute style diff:",G),k=[{command:Wr.setStyle,args:[P]}]}return k})(this.serialize(),n).filter((T=>!(T.command in tg)));if(d.length===0)return!1;const _=d.filter((T=>!(T.command in Lf)));if(_.length>0)throw new Error(`Unimplemented: ${_.map((T=>T.command)).join(", ")}.`);const b=[];return d.forEach((T=>{b.push(this[T.command](...T.args))})),a&&Promise.all(b).then(a).catch(a),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[a,d]of n.entries()){if(this.getImage(a))return this.fire(new r.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,d),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(n,a){return this.getImage(n)?this.fire(new r.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,a),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(n,a,d=!1){this.imageManager.updateImage(n,this.scope,a),d&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(n,a,d={}){return this._checkLoaded(),this._validate(it,`models.${n}`,a,null,d)||(this.modelManager.addModel(n,a,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,d={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(co,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=pd(n,a,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id})));const b=T=>{const P=(T?"symbol:":"other:")+_.id,k=r.B(P,this.scope),G=this._sourceCaches[P]=new Hs(k,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=G,G.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new r.y(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find((([b,T])=>T.type==="source"&&T.source===n));if(_)return this.fire(new r.y(new Error(`Source "${n}" cannot be removed while iconset "${_[0]}" is using it.`)))}const d=this.getOwnSourceCaches(n);for(const _ of d){const b=r.dl(_.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const d=this.getOwnSourceCache(a);d&&n.push(d.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const d=n[a]._tiles;for(const _ in d){const b=d[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of n){if(this._validate(cl,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(a)}else this.ambientLight=new ai(b,fo||(fo=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(a)}else this.directionalLight=new ai(b,ko||(ko=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(a,{worldview:this.map.getWorldview()}),_=new r.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const d=Y=>.2126*(Y[0]<=.03928?Y[0]/12.92:Math.pow((Y[0]+.055)/1.055,2.4))+.7152*(Y[1]<=.03928?Y[1]/12.92:Math.pow((Y[1]+.055)/1.055,2.4))+.0722*(Y[2]<=.03928?Y[2]/12.92:Math.pow((Y[2]+.055)/1.055,2.4)),_=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),T=n.properties.get("direction"),P=1-r.d3(T.x,T.y,T.z)[2]/90,k=d(_)*b*P,G=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),q=a.properties.get("intensity"),te=d(G)*q;return Number(((k+te)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(r.dm(n)){const a=r.dn(n),d=this.fragments.find((({id:b})=>b===a));if(!d)return;const _=r.dl(n);return d.style.getFragmentStyle(_)}{const a=this.fragments.find((({id:d})=>d===n));return a?a.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const a={},d=(_,b="")=>`${_}::${b}`;this._featuresetSelectors={};for(const _ in n){const b=this._featuresetSelectors[_]=[];for(const T of n[_].selectors){if(T.featureNamespace){const k=this.getOwnLayer(T.layer);if(!k){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const G=d(k.source,k.sourceLayer);if(G in a&&a[G]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}a[G]=T.featureNamespace}let P;if(T.properties)for(const k in T.properties){const G=r.U(T.properties[k]);G.result==="success"&&(P=P||{},P[k]=G.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:P,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const a=this.getFragmentStyle(n);if(!a||!a.stylesheet.featuresets)return[];const d=[];for(const _ in a.stylesheet.featuresets)d.push({featuresetId:_,importId:a.scope?a.scope:void 0});return d}getFeaturesetLayers(n,a){const d=this.getFragmentStyle(a),_=d.stylesheet.featuresets;if(!_||!_[n])return this.fire(new r.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of _[n].selectors){const P=d.getOwnLayer(T.layer);P&&b.push(P)}return b}getConfigProperty(n,a){const d=this.getFragmentStyle(n);if(!d)return null;const _=r.B(a,d.scope),b=d.options.get(_),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(n,a,d){const _=this.getFragmentStyle(n);if(!_)return;const b=_.stylesheet.schema;if(!b||!b[a])return;const T=r.U(d);if(T.result!=="success")return void xc(this,T.value);const P=T.value.expression,k=r.B(a,_.scope),G=_.options.get(k);if(!G)return;let q;const{minValue:te,maxValue:Y,stepValue:re,type:le,values:ce}=b[a],Pe=r.U(b[a].default);Pe.result==="success"&&(q=Pe.value.expression),q?(this.options.set(k,Object.assign({},G,{value:P,default:q,minValue:te,maxValue:Y,stepValue:re,type:le,values:ce})),this.updateConfigDependencies(a)):this.fire(new r.y(new Error(`No schema defined for the config option "${a}" in the "${n}" fragment.`)))}getConfig(n){const a=this.getFragmentStyle(n);if(!a)return null;const d=a.stylesheet.schema;if(!d)return null;const _={};for(const b in d){const T=r.B(b,a.scope),P=a.options.get(T),k=P?P.value||P.default:null;_[b]=k?k.serialize():null}return _}setConfig(n,a){const d=this.getFragmentStyle(n);d&&(d.updateConfig(a,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const a=this.getFragmentStyle(n);return a?a.stylesheet.schema:null}setSchema(n,a){const d=this.getFragmentStyle(n);d&&(d.stylesheet.schema=a,d.updateConfig(d._config,a),this.updateConfigDependencies())}updateConfig(n,a){if(this._config=n,n||a)if(a)for(const d in a){let _,b;const T=r.U(a[d].default);if(T.result==="success"&&(_=T.value.expression),n&&n[d]!==void 0){const Y=r.U(n[d]);Y.result==="success"&&(b=Y.value.expression)}const{minValue:P,maxValue:k,stepValue:G,type:q,values:te}=a[d];if(_){const Y=r.B(d,this.scope);this.options.set(Y,{default:_,value:b,minValue:P,maxValue:k,stepValue:G,type:q,values:te})}else this.fire(new r.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const a of this._configDependentLayers){const d=this.getLayer(a);if(d){if(n&&!d.configDependencies.has(n))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((a=>{const d=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(d){const _=a._evaluateColorThemeData(d);(!a._styleColorTheme.lut&&_!==""||a._styleColorTheme.lut&&_!==a._styleColorTheme.lut.data)&&a.setColorTheme(d)}})),this._changes.setDirty()}addLayer(n,a,d={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new r.y(new Error(`Layer with id "${_}" already exists on this map`)));let b;if(n.type==="custom"){if(xc(this,r.dp(n)))return;b=r.dq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=r.dk(n),n=Object.assign(n,{source:_})),this._validate(_t,`layers.${_}`,n,{arrayIndex:-1},d))return;b=r.dq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(a){const q=this._order.indexOf(a);if(q===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?T=q:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=b;const P=this.getOwnLayerSourceCache(b),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&b.canCastShadows()&&k&&(P.castsShadows=!0);const G=this._changes.getRemovedLayer(b);if(G&&b.source&&P&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const q=r.B(b.source,b.scope);G.type!==b.type?this._changes.updateSourceCache(q,"clear"):(this._changes.updateSourceCache(q,"reload"),P.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const d=this._checkLayer(n);if(!d||n===a)return;const _=this._order.indexOf(n);this._order.splice(_,1);let b=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?b=T:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const d=this._order.indexOf(n);this._order.splice(d,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const _=this.getOwnLayerSourceCache(a);if(_&&_.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){b=!0;break}_.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===a&&_.maxzoom===d||(a!=null&&(_.minzoom=a),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,a){this._checkLoaded();const d=this._checkLayer(n);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(n,a,d={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!r.by(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(we,`layers.${_.id}.filter`,a,{layerType:_.type},d)||(_.filter=r.dk(a),this._updateLayer(_)))}getFilter(n){const a=this._checkLayer(n);if(a)return r.dk(a.filter)}setLayoutProperty(n,a,d,_={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!r.by(b.getLayoutProperty(a),d)){if(d!=null&&(!_||_.validate!==!1)&&xc(b,Ge.call(Yr,{key:`layers.${n}.layout.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,d),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(n,a){const d=this._checkLayer(n);if(d)return d.getLayoutProperty(a)}setPaintProperty(n,a,d,_={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||r.by(b.getPaintProperty(a),d)||d!=null&&(!_||_.validate!==!1)&&xc(b,Ie.call(Yr,{key:`layers.${n}.paint.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:r.a6})))return;const T=b.setPaintProperty(a,d);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,a){const d=this._checkLayer(n);if(d)return d.getPaintProperty(a)}setFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:k,importId:G}=n.target,q=this.getFragmentStyle(G),te=q.getFeaturesetLayers(k);for(const{source:Y,sourceLayer:re}of te)q.setFeatureState({id:n.id,source:Y,sourceLayer:re},a)}else if("layerId"in n.target){const{layerId:k}=n.target,G=this.getLayer(k);this.setFeatureState({id:n.id,source:G.source,sourceLayer:G.sourceLayer},a)}return}const d=n.source,_=n.sourceLayer,b=this._checkSource(d);if(!b)return;const T=b.type;if(T==="geojson"&&_)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(d);for(const k of P)k.setFeatureState(_,n.id,a)}removeFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:k,importId:G}=n.target,q=this.getFragmentStyle(G),te=q.getFeaturesetLayers(k);for(const{source:Y,sourceLayer:re}of te)q.removeFeatureState({id:n.id,source:Y,sourceLayer:re},a)}else if("layerId"in n.target){const{layerId:k}=n.target,G=this.getLayer(k);this.removeFeatureState({id:n.id,source:G.source,sourceLayer:G.sourceLayer},a)}return}const d=n.source,_=this._checkSource(d);if(!_)return;const b=_.type,T=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(d);for(const k of P)k.removeFeatureState(T,n.id,a)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:T,importId:P}=n.target,k=this.getFragmentStyle(P),G=k.getFeaturesetLayers(T);for(const{source:q,sourceLayer:te}of G){const Y=k.getFeatureState({id:n.id,source:q,sourceLayer:te});if(Y&&!b)b=Y;else if(!r.by(b,Y))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:T}=n.target,P=this.getLayer(T);b=this.getFeatureState({id:n.id,source:P.source,sourceLayer:P.sourceLayer})}return b}const a=n.source,d=n.sourceLayer,_=this._checkSource(a);if(_){if(_.type!=="vector"||d)return n.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(n){for(const a of Object.values(this._mergedLayers))n(a)&&this._updateLayer(a)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),d=r.B(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=P=>this._mergedLayers[P].is3D(!!this.terrain),d=this.order,_={},b=[];for(let P=d.length-1;P>=0;P--){const k=d[P];if(a(k)){_[k]=P;for(const G of n){const q=G[k];if(q)for(const te of q)b.push(te)}}}b.sort(((P,k)=>k.intersectionZ-P.intersectionZ));const T=[];for(let P=d.length-1;P>=0;P--){const k=d[P];if(a(k))for(let G=b.length-1;G>=0;G--){const q=b[G].feature;if(q.layer&&_[q.layer.id]<P)break;T.push(q),b.pop()}else for(const G of n){const q=G[k];if(q)for(const te of q)T.push(te.feature)}}return T}queryRasterValue(n,a,d){const _=this.getOwnSource(n);return _?_.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(a,d):(this.fire(new r.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,a,d){let _;a&&!Array.isArray(a)&&a.filter&&(this._validate(we,"queryRenderedFeatures.filter",a.filter,null,a),_=r.b6(a.filter));const b={},T=q=>{if(Dh.has(q.type))return;const te=this.getOwnLayerSourceCache(q),Y=b[te.id]=b[te.id]||{sourceCache:te,layers:{},has3DLayers:!1};q.is3D(!!this.terrain)&&(Y.has3DLayers=!0),Y.layers[q.fqid]=Y.layers[q.fqid]||{styleLayer:q,targets:[]},Y.layers[q.fqid].targets.push({filter:_})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const q of a.layers){const te=this._layers[q];if(!te)return this.fire(new r.y(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];T(te)}}else for(const q in this._layers)T(this._layers[q]);const P=this._queryRenderedFeatures(n,b,d),k=this._flattenAndSortRenderedFeatures(P),G=[];for(const q of k)r.ds(q.layer.id)===this.scope&&G.push(q);return G}queryRenderedFeatureset(n,a,d){let _;a&&!Array.isArray(a)&&a.filter&&(this._validate(we,"queryRenderedFeatures.filter",a.filter,null,a),_=r.b6(a.filter));const b="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:b,filter:_}));else{const q=this.getFeaturesetDescriptors();for(const te of q)T.push({targetId:b,filter:_,target:te});for(const{style:te}of this.fragments){const Y=te.getFeaturesetDescriptors();for(const re of Y)T.push({targetId:b,filter:_,target:re})}}const P=this.queryRenderedTargets(n,T,d),k=[],G=new Set;for(const q of P)for(const te of q.variants[b])hc(te,q,G)||k.push(new r.dt(q,te));return k}queryRenderedTargets(n,a,d){const _={},b=(P,k,G,q)=>{const te=_[k.id]=_[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};if(te.layers[P.fqid]=te.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(te.has3DLayers=!0),!q)return G.uniqueFeatureID=!1,void te.layers[P.fqid].targets.push(G);te.layers[P.fqid].targets.push(Object.assign({},G,{namespace:q.namespace,properties:q.properties,uniqueFeatureID:q.uniqueFeatureID}))};for(const P of a)if("featuresetId"in P.target){const{featuresetId:k,importId:G}=P.target,q=this.getFragmentStyle(G);if(!q||!q._featuresetSelectors)continue;const te=q._featuresetSelectors[k];if(!te){this.fire(new r.y(new Error(`The featureset '${k}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Y of te){const re=q.getOwnLayer(Y.layerId);re&&!Dh.has(re.type)&&b(re,q.getOwnLayerSourceCache(re),P,Y)}}else if("layerId"in P.target){const{layerId:k}=P.target,G=this.getLayer(k);if(!G||Dh.has(G.type))continue;b(G,this.getLayerSourceCache(G),P)}const T=this._queryRenderedFeatures(n,_,d);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(n,a,d){const _=[],b=!!this.map._showQueryGeometry,T=io.createFromScreenPoints(n,d);for(const P in a){const k=gd(T,a[P],this._availableImages,d,b);Object.keys(k).length&&_.push(k)}if(this.placement)for(const P in a){if(!a[P].sourceCache._onlySymbols)continue;const k=xf(T.screenGeometry,a[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(k).length&&_.push(k)}return _}querySourceFeatures(n,a){const d=a&&a.filter;d&&this._validate(we,"querySourceFeatures.filter",d,null,a);let _=[];const b=this.getOwnSourceCaches(n);for(const T of b)_=_.concat(Ua(T,a));return _}addSourceType(n,a,d){return Da.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Da.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const P in n)if(!r.by(n[P],_[P])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(n,a,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=n;const _=n.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const P="terrain-dem-src";this.addSource(P,d.source),d=r.dk(d),d=Object.assign(d,{source:P})}const b=Object.assign({},d),T={};if(this.terrain&&_){b.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(T.style=P.serialize())}if(this._validate(Kt,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const P of Object.keys(r.a6.terrain))!d.hasOwnProperty(P)&&r.a6.terrain[P].default&&(d[P]=r.a6.terrain[P].default);for(const P in n)if(!r.by(n[P],T[P])){b.set(n,this.options),this.stylesheet.terrain=n;const k=this._getTransitionParameters({duration:0});b.updateTransitions(k),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new gr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createSnow(n){const a=this.snow=new jo(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createRain(n){const a=this.rain=new bi(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.by(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.by(a.get(),n)){a.set(n,this.options),this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.by(a.get(),n)){a.set(n,this.options),this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void n();const d=this._evaluateColorThemeData(a);this._loadColorTheme(d).then((()=>{this.fire(new r.z("colorthemeset")),n()})).catch((_=>{r.w(`Couldn't set color theme: ${_}`)}))}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,a){const d=this.getFragmentStyle(n);d&&(d._styleColorTheme.colorThemeOverride=a,d._reloadColorTheme())}_getTransitionParameters(n){return{now:r.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?n.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const d=this.terrain=new Rt(n,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,_,b={}){if(b&&b.validate===!1)return!1;const T=Object.assign({},this.serialize());return xc(this,n.call(Yr,Object.assign({key:a,style:T,value:d,styleSpec:r.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const d of a)d.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const a=this._mergedLayers[n];a._clear&&a._clear()}}reloadSource(n){const a=this.getSourceCaches(n);for(const d of a)d.resume(),d.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((n=>{n.modelManager.reloadModels(n.scope)}))}updateSources(n){let a;this.directionalLight&&(a=Du(this.directionalLight));const d=new Set;for(const _ in this._mergedLayers){const b=this._mergedLayers[_];b.hasElevation()&&!d.has(b.source)&&d.add(b.source)}for(const _ in this._mergedSourceCaches){const b=this._mergedSourceCaches[_],T=d.has(b._source.id);b.update(n,void 0,void 0,a,T)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,_,b,T,P=!1){let k=!1,G=!1;const q={},te={};for(const Y of this._mergedOrder){const re=this._mergedLayers[Y];if(re.type!=="symbol")continue;const le=r.B(re.source,re.scope);let ce=q[le];if(!ce){const me=this.getLayerSourceCache(re);if(!me)continue;const Me=me.getRenderableIds(!0).map((Le=>me.getTileByID(Le)));te[le]=Me.slice(),ce=q[le]=Me.sort(((Le,Fe)=>Fe.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Fe.tileID)?-1:1)))}const Pe=this.crossTileSymbolIndex.addLayer(re,ce,a.center.lng,a.projection);k=k||Pe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),a.zoom))&&(this.pauseablePlacement=new vs(a,this._mergedOrder,P,d,_,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,q,te,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),G=!0),k&&this.pauseablePlacement.placement.setStale()),G||k){this._buildingIndex.onNewFrame(a.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const re=this._mergedLayers[this._mergedOrder[Y]];if(re.type!=="symbol")continue;const le=this.isLayerClipped(re);this.placement.updateLayerOpacities(re,q[r.B(re.source,re.scope)],Y,le?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:b})=>b===n.id))!==-1)return void this.fire(new r.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return d.push(n),this._loadImports([n],!0);const _=d.findIndex((({id:b})=>b===a));return _===-1&&this.fire(new r.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(n).concat(d.slice(_)),this._loadImports([n],!0,a)}updateImport(n,a){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==d[_].url&&this.setImportUrl(n,a.url),r.by(a.config,d[_].config)||this.setImportConfig(n,a.config,a.data.schema),r.by(a.data,d[_].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const T=d[_],P=this.fragments[_];return d=d.filter((({id:k})=>k!==n)),this.fragments=this.fragments.filter((({id:k})=>k!==n)),this.stylesheet.imports=d.slice(0,b).concat(T).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(P).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;d[_].url=a;const b=this.fragments[_];return b.style=this._createFragmentStyle(d[_]),b.style.on("style.import.load",(()=>this.mergeAll())),b.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const d=this.getImportIndex(n),_=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(n,_[d].url))}setImportConfig(n,a,d){this._checkLoaded();const _=this.getImportIndex(n),b=this.stylesheet.imports||[];if(_===-1)return this;a?b[_].config=a:delete b[_].config;const T=this.fragments[_];d&&T.style.stylesheet&&(T.style.stylesheet.schema=d);const P=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,P),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],d=this.getImportIndex(n);d!==-1&&(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex((d=>d.id===n));return a===-1&&this.fire(new r.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[a];d&&n.push(d.getSource())}return n}getSource(n,a){const d=this.getSourceCache(n,a);return d&&d.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const d=r.B(n,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(n){const a=r.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const d=n[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const d of a){const _=this.getLayer(d);_&&_.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,a,d){this.imageManager.getImages(a.images,a.scope,d),this._updateTilesForChangedImages();const _=T=>{if(T){const P=a.images.map((k=>r.I.toString(k)));T.setDependencies(a.tileID.key,a.type,P)}},b=r.B(a.source,a.scope);_(this._mergedOtherSourceCaches[b]),_(this._mergedSymbolSourceCaches[b]),a.images.some((T=>T.iconsetId))&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(n,a,d){this.imageManager.rasterizeImages(a,d)}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(n,a,d){return r.dv(a,d)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${n}'`))),!1):a.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,a){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const d=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),_=n.type==="building";if(n.is3D(!!this.terrain)){if(d||_||a&&a.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((n=>{n.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Da.getSourceType=function(h){return Cu[h]},Da.setSourceType=function(h,n){Cu[h]=n},Da.registerForPluginStateChange=r.dw;class qa{execute(n){const a=this._makeBuildingsQueryArea(n),d=this._makeFloorsQueryArea(n),_=n.queryRenderedFeatures(a).reduce(((G,q)=>{const te=q.properties.id;return q.properties.type!=="building"||G.some((Y=>Y.properties.id===te))||G.push(q),G}),[]),b=n.queryRenderedFeatures(d).reduce(((G,q)=>{const te=q.properties.id;return q.properties.type!=="floor"||G.some((Y=>Y.properties.id===te))||G.push(q),G}),[]),T=[n.getCenter().lng,n.getCenter().lat],P=this._findBuildingAtCenter(T,_),k=_.length>0?_[0]:null;return{floors:b.map((G=>({id:G.properties.id,name:G.properties.name,isDefault:G.properties.is_default,zIndex:G.properties.z_index,connectedFloorIds:G.properties.connected_floor_ids,conflictedFloorIds:G.properties.conflicted_floor_ids,buildingIds:G.properties.building_ids}))),building:P?{id:P.properties.id,name:P.properties.name}:{id:k.properties.id,name:k.properties.name}}}_makeBuildingsQueryArea(n){const a=n.transform.width,d=n.transform.height,_=Math.min(a,d)*(1/8),b=.5*(a-_),T=.5*(d-_);return[new r.P(b,T),new r.P(b+_,T+_)]}_makeFloorsQueryArea(n){const a=n.transform.width,d=n.transform.height;return[new r.P(0,0),new r.P(a,d)]}_findBuildingAtCenter(n,a){for(const d of a)if(d.geometry.type==="Polygon"&&this._pointInPolygon(n,d.geometry.coordinates[0]))return d;return null}_pointInPolygon(n,a){let d=!1;for(let _=0,b=a.length-1;_<a.length;b=_++){const T=a[_][0],P=a[_][1],k=a[b][1];P>n[1]!=k>n[1]&&n[0]<(a[b][0]-T)*(n[1]-P)/(k-P)+T&&(d=!d)}return d}}class zf{constructor(){this._floors=new Map,this._buildings=new Map}append(n){const a=n.building;let d=!1;if(a){const _=a.id;_&&(this._buildings.set(_,a),d||this._buildings.has(_)||(d=!0))}return n.floors.forEach((_=>{const b=_.id;d||this._floors.has(b)||(d=!0),this._floors.set(b,_)})),d}clear(){this._floors.clear(),this._buildings.clear()}getFloors(n=null){const a=Array.from(this._floors.values());return n?a.filter((d=>{const _=d.buildingIds;return!!_&&_.split(";").includes(n)})):a}}class Wp{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new zf}setIndoorData(n){const a=this._featuresStorage.append(n);return this._selectedBuildingId=n.building?n.building.id:null,a}setFloorId(n){const a=this._selectedFloorId!==n;return a&&(this._selectedFloorId=n),a}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const n=this._featuresStorage.getFloors(this._selectedBuildingId),a=this.getActiveFloors().find((d=>{const _=d.buildingIds;if(!_)return!1;const b=_.split(";");return!!this._selectedBuildingId&&b.includes(this._selectedBuildingId)}));return{selectedFloorId:a?a.id:null,floors:n}}getActiveFloors(n=!1){const a=this._featuresStorage.getFloors(),d=a.find((k=>k.id===this._selectedFloorId)),_=a.filter((k=>k.isDefault===!0));let b=[];if(d)return b=this._calculateCurrentActiveFloors(a,d,_,n),b;if(_.length===0){const k=this._featuresStorage.getFloors(this._selectedBuildingId);b=k.length>0?[k[0]]:[]}else b=_;const T=this._getNonConflictingLastActiveFloors(b),P=[...b,...T];return this._lastActiveFloors=P,P}hasBuildingChanged(n){return this._selectedBuildingId!==(n.building?n.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(n,a,d,_){if(!a)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,d);const b=this._getConnectedFloors(a,n);return _?this._buildExplicitSelectionFloors(a,b,d):this._buildImplicitSelectionFloors(b,d)}_getConnectedFloors(n,a){const d=n.connectedFloorIds;if(!d)return[];const _=new Set(d.split(";"));return a.filter((b=>_.has(b.id)))}_buildExplicitSelectionFloors(n,a,d){const _=[n,...a],b=this._getNonConflictingLastActiveFloors(_),T=[..._,...b],P=this._deduplicateFloors(T),k=this._getConflictingFloorIdsFrom(P),G=d.filter((te=>!k.has(te.id))),q=[...P,...G];return this._lastActiveFloors=q,q}_buildImplicitSelectionFloors(n,a){const d=this._getConflictingFloorIdsFrom(this._lastActiveFloors),_=a.filter((T=>!d.has(T.id))),b=this._deduplicateFloors([...this._lastActiveFloors,..._]);return this._lastActiveFloors=b,b}_getNonConflictingDefaultFloors(n,a){const d=this._getConflictingFloorIdsFrom(n),_=a.filter((T=>!d.has(T.id))),b=this._deduplicateFloors([...n,..._]);return this._lastActiveFloors=b,b}_deduplicateFloors(n){const a=new Set;return n.filter((d=>{const _=d.id;return!a.has(_)&&(a.add(_),!0)}))}_getConflictingFloorIdsFrom(n){const a=new Set;return n.forEach((d=>{const _=d.conflictedFloorIds;_&&_.split(";").forEach((b=>a.add(b)))})),a}_getNonConflictingLastActiveFloors(n){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const a=new Set(n.map((_=>_.id))),d=this._getConflictingFloorIdsFrom(n);return this._lastActiveFloors.filter((_=>{const b=_.id;return!a.has(b)&&!d.has(b)}))}_isFloorConflicted(n,a){const d=n.id;return a.some((_=>{const b=_.conflictedFloorIds;return!!b&&b.split(";").includes(d)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class ku extends r.E{constructor(n){super(),r.aY(["_onLoad","_onMove"],this),this._map=n,this._floorSelectionState=new Wp,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(n){this._floorSelectionState.setFloorId(n)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((n=>{n.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=n.scope,this._indoorDataQuery=new qa))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const n=this._indoorDataQuery.execute(this._map);if(!n||n.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(n)){if(!n.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(n),n.building&&this._updateIndoorSelector()}else this._setIndoorData(n)}_setIndoorData(n){this._floorSelectionState.setIndoorData(n)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const n=this._floorSelectionState.getCurrentBuildingSelection(),a=n.floors.map((d=>({id:d.id,name:d.name,shortName:d.zIndex.toString(),levelOrder:d.zIndex})));this.fire(new r.z("indoorupdate",{selectedFloorId:n.selectedFloorId,floors:a}))}_updateIndoorConfig(n=!1){const a=this._floorSelectionState.getActiveFloors(n).map((d=>d.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",a])}}var Ou=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Rs=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ff=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,fs="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Vl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ul=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,os=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Dd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,hn=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Wa=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const zu=[];Ks(Ou,zu),Ks(Ff,zu),Ks(Rs,zu);const ml={"_prelude_fog.vertex.glsl":Vl,"_prelude_terrain.vertex.glsl":Lu,"_prelude_shadow.vertex.glsl":hn,"_prelude_fog.fragment.glsl":Ul,"_prelude_shadow.fragment.glsl":Wa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":os,"_prelude_raster_particle.glsl":Dd},bc={};Ur("",Lu),Ur(Ul,Vl),Ur(Wa,hn),Ur(os,""),Ur(Dd,"");const gl=Ur(Rs,Ff),_l=Ou;var Oh={background:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Ur(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ur("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ur(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ur("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ur("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ur(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ur(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ur(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ur(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ur(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ur("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ur("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ur(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ur(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ur("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ur(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fs),skyboxGradient:Ur(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fs),skyboxCapture:Ur(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ur(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ur(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ur("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ur("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ur("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ur("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ks(h,n){const a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const b of _)n.includes(b)||n.push(b)}}function Ur(h,n){const a=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_={},b=[],T=[];if(h=h.replace(a,((k,G)=>(T.push(G),""))),(n=n.replace(a,((k,G)=>(b.push(G),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...zu];Ks(h,P),Ks(n,P);for(const k of[...b,...T])ml[k]||console.error(`Undefined include: ${k}`),bc[k]||(bc[k]=[],Ks(ml[k],bc[k])),P=[...P,...bc[k]];return{fragmentSource:h=h.replace(d,((k,G,q,te,Y)=>(_[Y]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
in ${q} ${te} ${Y};
#else
uniform ${q} ${te} u_${Y};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${Y}
    ${q} ${te} ${Y} = u_${Y};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${q} ${te} ${Y};
#endif
`:G==="initialize-attribute"?"":void 0))),vertexSource:n=n.replace(d,((k,G,q,te,Y)=>{const re=te==="float"?"vec2":te,le=Y.match(/color/)?"color":re;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
in ${q} ${te} a_${Y};
#endif
`:_[Y]?G==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${q} ${re} a_${Y};
out ${q} ${te} ${Y};
#else
uniform ${q} ${te} u_${Y};
#endif
`:G==="initialize"?le==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${q} ${te} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${le}(a_${Y}, u_${Y}_t);
#else
    ${q} ${te} ${Y} = u_${Y};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${q} ${te} a_${Y};
    out ${q} ${te} ${Y};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${Y} = a_${Y};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${q} ${re} a_${Y};
#else
uniform ${q} ${te} u_${Y};
#endif
`:G==="define-instanced"?le==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Y}0;
in vec4 a_${Y}1;
in vec4 a_${Y}2;
in vec4 a_${Y}3;
#else
uniform ${q} ${te} u_${Y};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${q} ${re} a_${Y};
#else
uniform ${q} ${te} u_${Y};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${q} ${te} ${Y} = a_${Y};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${q} ${te} ${Y} = a_${Y};
#else
    ${q} ${te} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${q} ${te} ${Y} = unpack_mix_${le}(a_${Y}, u_${Y}_t);
#else
    ${q} ${te} ${Y} = u_${Y};
#endif
`})),usedDefines:P,vertexIncludes:b,fragmentIncludes:T}}class wc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,_,b,T,P,k){this.context=n;let G=this.boundPaintVertexBuffers.length!==_.length;for(let te=0;!G&&te<_.length;te++)this.boundPaintVertexBuffers[te]!==_[te]&&(G=!0);let q=this.boundDynamicVertexBuffers.length!==P.length;for(let te=0;!q&&te<P.length;te++)this.boundDynamicVertexBuffers[te]!==P[te]&&(q=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||G||q||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(a,d,_,b,T,P,k);else{n.bindVertexArrayOES.set(this.vao);for(const te of P)te&&(te.bind(),k&&te.instanceCount&&te.setVertexAttribDivisor(n.gl,a,k));b&&b.dynamicDraw&&b.bind()}}freshBind(n,a,d,_,b,T,P){const k=this.context,G=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,a.enableAttributes(G,n),a.bind(),a.setVertexAttribPointers(G,n,b);for(const q of d)q.enableAttributes(G,n),q.bind(),q.setVertexAttribPointers(G,n,b);for(const q of T)q&&(q.enableAttributes(G,n),q.bind(),q.setVertexAttribPointers(G,n,b),P&&q.instanceCount&&q.setVertexAttribDivisor(G,n,P));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function rg(h,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new r.ae(0,d/a).toLngLat().lat,new r.ae(0,(d+1)/a).toLngLat().lat]}function Zp(h,n,a,d,_,b,T){const P=h.context,k=P.gl,G=a.hillshadeFBO;if(!G)return;h.prepareDrawTile();const q=h.isTileAffectedByFog(n),te=h.getOrCreateProgram("hillshade",{overrideFog:q});P.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,G.colorAttachment.get());const Y=((Pe,me,Me,Le)=>{const Fe=Me.paint.get("hillshade-shadow-color"),Ze=Me.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",He=Me.paint.get("hillshade-highlight-color"),Ye=Me.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",qe=Me.paint.get("hillshade-accent-color"),We=Me.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Xe=Me.paint.get("hillshade-emissive-strength");let Tt=r.an(Me.paint.get("hillshade-illumination-direction"));if(Me.paint.get("hillshade-illumination-anchor")==="viewport")Tt-=Pe.transform.angle;else if(Pe.style&&Pe.style.enable3dLights()&&Pe.style.directionalLight){const Lt=Pe.style.directionalLight.properties.get("direction"),bt=r.d3(Lt.x,Lt.y,Lt.z);Tt=r.an(bt[1])}const ht=!Pe.options.moving;return{u_matrix:Le||Pe.transform.calculateProjMatrix(me.tileID.toUnwrapped(),ht),u_image:0,u_latrange:rg(0,me.tileID),u_light:[Me.paint.get("hillshade-exaggeration"),Tt],u_shadow:Fe.toPremultipliedRenderColor(Ze?null:Me.lut),u_highlight:He.toPremultipliedRenderColor(Ye?null:Me.lut),u_emissive_strength:Xe,u_accent:qe.toPremultipliedRenderColor(We?null:Me.lut)}})(h,a,d,h.terrain?n.projMatrix:null);h.uploadCommonUniforms(P,te,n.toUnwrapped());const{tileBoundsBuffer:re,tileBoundsIndexBuffer:le,tileBoundsSegments:ce}=h.getTileBoundsBuffers(a);te.draw(h,k.TRIANGLES,_,b,T,er.disabled,Y,d.id,re,le,ce)}function kd(h,n,a){if(!n.needsDEMTextureUpload)return;const d=h.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(a.stride);const b=a.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new r.T(d,b,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Yp(h,n,a){const d=h.context,_=d.gl;if(!n.dem)return;const b=n.dem;if(d.activeTexture.set(_.TEXTURE1),kd(h,n,b),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const T=b.dim;d.activeTexture.set(_.TEXTURE0);let P=n.hillshadeFBO;if(!P){const Y=new r.T(d,{width:T,height:T,data:null},_.RGBA8);Y.bind(_.LINEAR,_.CLAMP_TO_EDGE),P=n.hillshadeFBO=d.createFramebuffer(T,T,!0,"renderbuffer"),P.colorAttachment.set(Y.texture)}d.bindFramebuffer.set(P.framebuffer),d.viewport.set([0,0,T,T]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:G,tileBoundsSegments:q}=h.getMercatorTileBoundsBuffers(),te=[];h.linearFloatFilteringSupported()&&te.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:te}).draw(h,_.TRIANGLES,Pn.disabled,sr.disabled,br.unblended,er.disabled,((Y,re)=>{const le=re.stride,ce=r.bC();return r.cd(ce,0,r.al,-r.al,0,0,1),r.br(ce,ce,[0,-r.al,0]),{u_matrix:ce,u_image:1,u_dimension:[le,le],u_zoom:Y.overscaledZ}})(n.tileID,b),a.id,k,G,q),n.needsHillshadePrepare=!1}class Yi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bf extends Yi{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class da extends Yi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class ig extends Yi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ka extends Yi{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class og extends Yi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class sg extends Yi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ag extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class $c extends Yi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Lh extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Xp extends Yi{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Fu extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Nf extends Yi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class zh extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Vf extends Yi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Hc extends Yi{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class qc extends Yi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Od extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Uf extends Yi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ld extends Yi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let lg=class extends Yi{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class jf extends Yi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Kp extends Yi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class yl extends Yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Bu extends Yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Fh extends Yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Gf extends Yi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Bh extends Yi{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class zd extends Yi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Jp extends Yi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Qp extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Fd extends Yi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Sc extends Yi{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class em extends Sc{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class mo extends Sc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class tm extends Sc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class w_ extends mo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $f=(h,n,a)=>({u_matrix:h,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),Hf=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:P,u_frustum_br:k,u_frustum_bl:G,u_globe_pos:q,u_globe_radius:te,u_viewport:Y,u_grid_matrix:ce?Float32Array.from(ce):new Float32Array(9),u_skirt_height:re,u_far_z_cutoff:le});function qf(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const Wc=new class{constructor(){this.operations={}}newMorphing(h,n,a,d,_){if(h in this.operations){const b=this.operations[h];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:_,from:n,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const a=this.operations[n];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},nm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Nh(h,n,a){if(n===0)return 0;const d=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-h)*Math.max(n,1)*d}function Tc(h,n){const a=1<<h.z;return!n&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const Zc=h=>({u_matrix:h});function jl(h,n,a,d,_){if(_>0){const b=r.o.now(),T=(b-h.timeAdded)/_,P=n?(b-n.timeAdded)/_:-1,k=a.getSource(),G=d.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),q=!n||Math.abs(n.tileID.overscaledZ-G)>Math.abs(h.tileID.overscaledZ-G),te=q&&h.refreshedUponExpiration?1:r.aA(q?T:1-P,0,1);return n?{opacity:1,mix:1-te,isFading:T<1}:{opacity:te,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Yc extends Hs{constructor(n){const a=pd("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class ha extends Hs{constructor(n){const a=pd("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const P=new fc(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);P.state="loaded",this._tiles[T.key]=P}return b}),{});for(const b in this._tiles)b in _||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bd extends r.aO{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class Vh extends r.dH{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,b]=(function(k){const G=new r.bd,q=new r.b1,te=131;G.reserve(17161),q.reserve(33800);const Y=r.al/128,re=r.al+Y/2,le=re+Y;for(let Pe=-Y;Pe<le;Pe+=Y)for(let me=-Y;me<le;me+=Y){const Me=me<0||me>re||Pe<0||Pe>re?24575:0,Le=r.aA(Math.round(me),0,r.al),Fe=r.aA(Math.round(Pe),0,r.al);G.emplaceBack(Le+Me,Fe)}const ce=(Pe,me)=>{const Me=me*te+Pe;q.emplaceBack(Me+1,Me,Me+te),q.emplaceBack(Me+te,Me+te+1,Me+1)};for(let Pe=1;Pe<129;Pe++)for(let me=1;me<129;me++)ce(me,Pe);return[0,129].forEach((Pe=>{for(let me=0;me<130;me++)ce(me,Pe),ce(Pe,me)})),[G,q,32768]})(),T=n.context;this.gridBuffer=T.createVertexBuffer(d,r.bf.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=r.bg.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ha(a.map),this.orthoMatrix=r.bC(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const P=T.gl;this._overlapStencilMode=new sr({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Yc(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,b=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const P=n.terrain&&n.terrain.scope,k=_.get("source"),G=b?this._mockSourceCache:n.getSourceCache(k,P);if(!G)return void r.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=G,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):_.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const q=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const te=this.getScaledDemTileSize();this.sourceCache.update(a,te,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,q(),this._initializing=!0),q(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const a=this._previousCameraAltitude,d=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=d;const _=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const b=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let P=b-this._previousZoom;const k=this._previousUpdateTimestamp;let G=b;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(b-G)>.5&&(P=.5*(b-G+P)),P*_<0&&(G+=P)),this._evaluationZoom=G;const q=T.getExaggeration(G),te=q===T.getExaggeration(Math.max(0,G-.1));if(te&&Math.abs(q-this._exaggeration)<.01)return q;let Y=Math.min(.1,.00375*(this._updateTimestamp-k));return(te||q<.1||Math.abs(P)<1e-4)&&(Y=Math.min(.2,4*Y)),r.ak(this._exaggeration,q,Y)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map((k=>{const G=a.getTileByID(k).tileID;return G.projMatrix=d.calculateProjMatrix(G.toUnwrapped()),G}));(function(k,G){const q=G.transform.pointCoordinate(G.transform.getCameraPoint()),te=new r.P(q.x,q.y);k.sort(((Y,re)=>{if(re.overscaledZ-Y.overscaledZ)return re.overscaledZ-Y.overscaledZ;const le=new r.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ce=new r.P(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),Pe=te.mult(1<<Y.canonical.z);return Pe.x-=.5,Pe.y-=.5,Pe.distSqr(le)-Pe.distSqr(ce)}))})(_,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},_.forEach((k=>{this.proxyToSource[k.key]={}})),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const k in T){const G=T[k];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,n[k],b),G.usedForTerrain))continue;const q=n[k];G.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[a.id]=_.map((k=>new Bd(k,k.key,this.orthoMatrix))),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const G=this.terrainTileForTile[k.key];if(!G)continue;const q=G.tileID.key;q in P||(this._visibleDemTiles.push(G),P[q]=q)}}_assignTerrainTiles(n){this._initializing||n.forEach((a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)}))}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],b=_.dem;!b||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),kd(this.painter,_,b))}}_prepareDemTileUniforms(n,a,d,_){if(!a||a.demTexture==null)return!1;const b=n.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-b.z),P=_||"";return d[`u_dem_tl${P}`]=[b.x*T%1,b.y*T%1],d[`u_dem_scale${P}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const a=this._visibleDemTiles.reduce(((d,_)=>{if(!_.dem)return d;const b=_.dem.tree.minimums[0];return b>0&&n++,d+b}),0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new r.dI({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(_,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(n,_,a.R32F,{premultiply:!1}),b}setupElevationDraw(n,a,d){const _=this.painter.context,b=_.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let P=null,k=null,G=1;if(d&&d.morphing&&this._useVertexMorphing){const re=d.morphing.srcDemTile,le=d.morphing.dstDemTile;G=d.morphing.phase,re&&le&&(this._prepareDemTileUniforms(n,re,T,"_prev")&&(k=re),this._prepareDemTileUniforms(n,le,T)&&(P=le))}const q=re=>re&&re.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let te=null;var Y;if(this.enabled?k&&P?(te=P.demTexture,_.activeTexture.set(b.TEXTURE4),k.demTexture.bind(q(k),b.CLAMP_TO_EDGE),T.u_dem_lerp=G):(P=this.terrainTileForTile[n.tileID.key],te=this._prepareDemTileUniforms(n,P,T)?P.demTexture:this.emptyDEMTexture):te=this.emptyDEMTexture,_.activeTexture.set(b.TEXTURE2),te&&(T.u_dem_size=(Y=te).size[0]===1?1:Y.size[0]-2,te.bind(q(P),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,a,T),d&&d.useMeterToDem&&P){const re=(1<<P.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=re}if(d&&d.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const re=this.globeUniformValues(this.painter.transform,n.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(_,re)}}globeUniformValues(n,a,d){const _=n.projection;return{u_tile_tl_up:_.upVector(a,0,0),u_tile_tr_up:_.upVector(a,r.al,0),u_tile_br_up:_.upVector(a,r.al,r.al),u_tile_bl_up:_.upVector(a,0,r.al),u_tile_up_scale:d?r.dJ(1):_.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,b,T,P,k){if(_.transform.projection.name==="globe")(function(G,q,te,Y,re){const le=G.context,ce=le.gl;let Pe,me;const Me=G.transform,Le=r.dA(G,le,Me),Fe=(Lt,bt)=>{if(me===bt)return;const Pt=[nm[bt],"PROJECTION_GLOBE_VIEW"];Le&&Pt.push("CUSTOM_ANTIALIASING");const nn=G.isTileAffectedByFog(Lt);Pe=G.getOrCreateProgram("globeRaster",{defines:Pt,overrideFog:nn}),me=bt},Ze=G.colorModeForRenderPass(),He=new Pn(ce.LEQUAL,Pn.ReadWrite,G.depthRangeFor3D);Wc.update(re);const Ye=r.dB(Me),qe=[r.aF(Me.center.lng),r.aJ(Me.center.lat)],We=G.globeSharedBuffers,Xe=[Me.width*r.o.devicePixelRatio,Me.height*r.o.devicePixelRatio],Tt=Float32Array.from(Me.globeMatrix),ht={useDenormalizedUpVectorScale:!0};{const Lt=G.transform,bt=Nh(Lt.zoom,q.exaggeration(),q.sourceCache._source.tileSize);me=-1;const Pt=ce.TRIANGLES;for(const nn of Y){const St=te.getTile(nn),rt=sr.disabled,zt=q.prevTerrainTileForTile[nn.key],wt=q.terrainTileForTile[nn.key];qf(zt,wt)&&Wc.newMorphing(nn.key,zt,wt,re,250),le.activeTexture.set(ce.TEXTURE0),St.texture&&St.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Zt=Wc.getMorphValuesForProxy(nn.key),sn=Zt?1:0;Zt&&Object.assign(ht,{morphing:{srcDemTile:Zt.from,dstDemTile:Zt.to,phase:r.dz(Zt.phase)}});const Sn=r.dC(nn.canonical),Ht=r.dD(Sn.getCenter().lat),en=r.dE(nn.canonical,Sn,Ht,Lt.worldSize/Lt._pixelsPerMercatorPixel),Nn=r.bk(r.dF(nn.canonical)),En=Hf(Lt.expandedFarZProjMatrix,Tt,Ye,Nn,r.aj(Lt.zoom),qe,Lt.frustumCorners.TL,Lt.frustumCorners.TR,Lt.frustumCorners.BR,Lt.frustumCorners.BL,Lt.globeCenterInViewSpace,Lt.globeRadius,Xe,bt,Lt._farZ,en);if(Fe(nn,sn),Pe&&(q.setupElevationDraw(St,Pe,ht),G.uploadCommonUniforms(le,Pe,nn.toUnwrapped()),We)){const[Gn,Vn,Kn]=We.getGridBuffers(Ht,bt!==0);Pe.draw(G,Pt,He,rt,Ze,er.backCCW,En,"globe_raster",Gn,Vn,Kn)}}}if(We&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const Lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Le&&Lt.push("CUSTOM_ANTIALIASING"),Pe=G.getOrCreateProgram("globeRaster",{defines:Lt});for(const bt of Y){const{x:Pt,y:nn,z:St}=bt.canonical,rt=nn===0,zt=nn===(1<<St)-1,[wt,Zt,sn,Sn]=We.getPoleBuffers(St,!1);if(Sn&&(rt||zt)){const Ht=te.getTile(bt);le.activeTexture.set(ce.TEXTURE0),Ht.texture&&Ht.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let en=r.dG(St,Pt,Me);const Nn=r.bk(r.dF(bt.canonical)),En=(Gn,Vn)=>Gn.draw(G,ce.TRIANGLES,He,sr.disabled,Ze,er.disabled,Hf(Me.expandedFarZProjMatrix,en,en,Nn,0,qe,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,Xe,0,Me._farZ),"globe_pole_raster",Vn,sn,Sn);q.setupElevationDraw(Ht,Pe,ht),G.uploadCommonUniforms(le,Pe,bt.toUnwrapped()),rt&&G.renderDefaultNorthPole&&En(Pe,wt),zt&&G.renderDefaultSouthPole&&(en=r.cR(r.bC(),en,[1,-1,1]),En(Pe,Zt))}}}})(_,b,T,P,k);else{const G=_.context,q=G.gl;let te,Y;const re=_.shadowRenderer,le=po(_,_.longestCutoffRange),ce=Ze=>{if(Y===Ze)return;const He=[];He.push(nm[Ze]),le.shouldRenderCutoff&&He.push("RENDER_CUTOFF"),re&&(He.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&He.push("NORMAL_OFFSET")),te=_.getOrCreateProgram("terrainRaster",{defines:He}),Y=Ze},Pe=_.colorModeForRenderPass(),me=new Pn(q.LEQUAL,Pn.ReadWrite,_.depthRangeFor3D);Wc.update(k);const Me=_.transform,Le=Nh(Me.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Fe=[0,0,0];if(re){const Ze=_.style.directionalLight,He=_.style.ambientLight;Ze&&He&&(Fe=Ha(_.style,Ze,He))}{Y=-1;const Ze=q.TRIANGLES,[He,Ye]=[b.gridIndexBuffer,b.gridSegments];for(const qe of P){const We=T.getTile(qe),Xe=sr.disabled,Tt=b.prevTerrainTileForTile[qe.key],ht=b.terrainTileForTile[qe.key];qf(Tt,ht)&&Wc.newMorphing(qe.key,Tt,ht,k,250),G.activeTexture.set(q.TEXTURE0),We.texture&&We.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const Lt=Wc.getMorphValuesForProxy(qe.key),bt=Lt?1:0;let Pt;Lt&&(Pt={morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:r.dz(Lt.phase)}});const nn=$f(qe.projMatrix,Tc(qe.canonical,Me.renderWorldCopies)?Le/10:Le,Fe);if(ce(bt),!te)continue;b.setupElevationDraw(We,te,Pt);const St=qe.toUnwrapped();re&&re.setupShadows(St,te),_.uploadCommonUniforms(G,te,St,null,le),te.draw(_,Ze,me,Xe,Pe,er.backCCW,nn,"terrain_raster",b.gridBuffer,He,Ye)}}}})(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,_=this.proxySourceCache,b=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),P=a.style.order,k=[];let G=0;for(const q of b){const te=_.getTileByID(q.proxyTileKey),Y=_.proxyCachedFBO[q.key]?_.proxyCachedFBO[q.key][n]:void 0,re=Y!==void 0?_.renderCache[Y]:this.pool[G++],le=Y!==void 0;if(te.texture=re.tex,le&&!re.dirty){k.push(te.tileID);continue}let ce;d.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(d.clear({color:r.ao.transparent,stencil:0}),re.dirty=!1);for(let Pe=T.start;Pe<=T.end;++Pe){const me=a.style._mergedLayers[P[Pe]];if(me.isHidden(a.transform.zoom))continue;const Me=a.style.getLayerSourceCache(me),Le=Me?this.proxyToSource[q.key][Me.id]:[q];if(!Le)continue;const Fe=Le;d.viewport.set([0,0,re.fb.width,re.fb.height]),ce!==(Me?Me.id:null)&&(this._setupStencil(re,Le,me,Me),ce=Me?Me.id:null),a.renderLayer(a,Me,me,Fe)}if(this._drapedRenderBatches.length===0)for(const Pe of this._pendingGroundEffectLayers){const me=a.style._mergedLayers[P[Pe]];if(me.isHidden(a.transform.zoom))continue;const Me=a.style.getLayerSourceCache(me),Le=Me?this.proxyToSource[q.key][Me.id]:[q];if(!Le)continue;const Fe=Le;d.viewport.set([0,0,re.fb.width,re.fb.height]),ce!==(Me?Me.id:null)&&(this._setupStencil(re,Le,me,Me),ce=Me?Me.id:null),a.renderLayer(a,Me,me,Fe)}this.renderedToTile?(re.dirty=!0,k.push(te.tileID)):le||--G,G===5&&(G=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let d=-1,_=a;for(let b=0;b<a;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?d=Math.max(d,b):_=Math.min(_,b);return _>d}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{n=Math.min(n,a.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const T=b.tileID,P=1<<T.overscaledZ,{x:k,y:G}=T.canonical,q=k/P,te=(k+1)/P,Y=G/P,re=(G+1)/P;return{minx:q,miny:Y,maxx:te,maxy:re,t:b.dem.tree.raycastRoot(q,Y,te,re,n,a,d),tile:b}}));_.sort(((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE)));for(const b of _){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,a,d);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const _=new r.T(n,{width:d[0],height:d[1],data:null},a.RGBA8);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=n.createFramebuffer(d[0],d[1],!0,null);return b.colorAttachment.set(_.texture),b.depthAttachment=new w_(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const a=this._style._mergedLayers[n],d=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const d of this._style.getSources())if(d instanceof Oo){n=!0;break}if(!n)return;const a={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(_);if(b&&!a[b.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.ad){a[b.id]=!0;for(const T of this.proxyCoords){const P=this.proxyToSource[T.key][b.id];if(P)for(const k of P)this._clearRenderCacheForTile(b.id,k)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof dc){n=!0;break}if(!n)return;const a={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(_);if(!b||a[b.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const T=_.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const k=this.proxyToSource[P.key][b.id];if(k)for(const G of k){const q=jl(b.getTile(G),b.findLoadedParent(G,0),b,this.painter.transform,T);(q.opacity!==1||q.mix!==0)&&this._clearRenderCacheForTile(b.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,a=n.length;if(a===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,b=0,T=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<a;)T=this._style._mergedLayers[n[b]];for(;b<a;++b){const P=this._style._mergedLayers[n[b]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?_===void 0&&(_=b):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),_!==void 0&&(d.push({start:_,end:b-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:b-1}),d.length!==0){const P=d[d.length-1];this._pendingGroundEffectLayers.every((k=>k>P.end))||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let P=0;P<T.length;++P){const k=Object.values(T[P]);a.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let T=d.length-1;T>=0;T--){const P=d[T];if(a.getTileByID(P.key),a.proxyCachedFBO[P.key]!==void 0){const k=n[P.key],G=this.proxyToSource[P.key];let q=0;for(const te in G){const Y=G[te],re=k[te];if(!re||re.length!==Y.length||Y.some(((le,ce)=>le!==re[ce]||_[te]&&_[te].hasOwnProperty(le.key)))){q=-1;break}++q}for(const te in a.proxyCachedFBO[P.key])a.renderCache[a.proxyCachedFBO[P.key][te]].dirty=q<0||q!==Object.values(k).length}}const b=[...this._drapedRenderBatches];b.sort(((T,P)=>P.end-P.start-(T.end-T.start)));for(const T of b)for(const P of d){if(a.proxyCachedFBO[P.key])continue;let k=a.renderCachePool.pop();k===void 0&&a.renderCache.length<50&&(k=a.renderCache.length,a.renderCache.push(this._createFBO())),k!==void 0&&(a.proxyCachedFBO[P.key]={},a.proxyCachedFBO[P.key][T.start]=k,a.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let P;if(d.isTileClipped())P=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):sr.disabled}_renderTileClippingMasks(n,a){const d=this.painter,_=this.painter.context,b=_.gl;d._tileClippingMaskIDs={},_.setColorMode(br.disabled),_.setDepthMode(Pn.disabled);const T=d.getOrCreateProgram("clippingMask");for(const P of n){const k=d._tileClippingMaskIDs[P.key]=--a;T.draw(d,b.TRIANGLES,Pn.disabled,new sr({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),br.disabled,er.disabled,Zc(P.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const d=[n.x,n.y,1,1];r.aC(d,d,a.pixelMatrixInverse),r.cJ(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const _=a._camera.position,b=r.ce(1,a.center.lat),T=[_[0],_[1],_[2]/b,0],P=r.d9([],d.slice(0,3),T);r.aw(P,P);const k=this.raycast(T,P,this._exaggeration);return k!==null&&k?(r.bH(T,T,P,k),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof r.aS)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let k=0;k<b.length;k++){const G=b[k],q=this._findTileCoveringTileID(G,n);if(q){const te=this._createProxiedId(G,q,d[G.key]&&d[G.key][n.id]);_.push(te),this.proxyToSource[G.key][n.id]=[te]}}let T=!1;const P=new Set;for(let k=0;k<a.length;k++){const G=n.getTile(a[k]);if(!G||!G.hasData())continue;const q=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==G.tileID.canonical.z){const te=this.proxyToSource[q.tileID.key][n.id],Y=this._createProxiedId(q.tileID,G,d[q.tileID.key]&&d[q.tileID.key][n.id]);te?te.splice(te.length-1,0,Y):this.proxyToSource[q.tileID.key][n.id]=[Y];const re=this.proxyToSource[q.tileID.key][n.id];P.has(re)||P.add(re),_.push(Y),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const k of P)k.sort(((G,q)=>q.overscaledZ-G.overscaledZ))}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],b=this.proxyCoords,T=n.getSource(),P=T.tileID;if(!P)return;const k=new r.P(P.x,P.y)._div(1<<P.z),G=T.coordinates.map(r.ae.fromLngLat).reduce(((te,Y)=>(te.min.x=Math.min(te.min.x,Y.x-k.x),te.min.y=Math.min(te.min.y,Y.y-k.y),te.max.x=Math.max(te.max.x,Y.x-k.x),te.max.y=Math.max(te.max.y,Y.y-k.y),te)),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(te,Y)=>{const re=te.wrap+te.canonical.x/(1<<te.canonical.z),le=te.canonical.y/(1<<te.canonical.z),ce=r.al/(1<<te.canonical.z),Pe=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),me=Y.canonical.y/(1<<Y.canonical.z);return re+ce<Pe+G.min.x||re>Pe+G.max.x||le+ce<me+G.min.y||le>me+G.max.y};for(let te=0;te<b.length;te++){const Y=b[te];for(let re=0;re<a.length;re++){const le=n.getTile(a[re]);if(!le||!le.hasData()||q(Y,le.tileID))continue;const ce=this._createProxiedId(Y,le,d[Y.key]&&d[Y.key][n.id]),Pe=this.proxyToSource[Y.key][n.id];Pe?Pe.push(ce):this.proxyToSource[Y.key][n.id]=[ce],_.push(ce)}}}_createProxiedId(n,a,d){let _=this.orthoMatrix;if(d){const b=d.find((T=>T.key===a.tileID.key));if(b)return b}if(a.tileID.key!==n.key){const b=n.canonical.z-a.tileID.canonical.z;let T,P,k;_=r.bC();const G=a.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(T=r.al>>b,P=T*((a.tileID.canonical.x<<b)-n.canonical.x+G),k=T*((a.tileID.canonical.y<<b)-n.canonical.y)):(T=r.al<<-b,P=r.al*(a.tileID.canonical.x-(n.canonical.x+G<<-b)),k=r.al*(a.tileID.canonical.y-(n.canonical.y<<-b))),r.cd(_,0,T,0,T,0,1),r.br(_,_,[P,k,0])}return new Bd(a.tileID,n.key,_)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[a.id],b=_[n.key];if(d=b?a.getTileByID(b):null,d&&d.hasData()||b===null)return d;let T=d?d.tileID:n,P=T.overscaledZ;const k=a.getSource().minzoom,G=[];if(!b){const te=a.getSource().maxzoom;if(n.canonical.z>=te){const Y=n.canonical.z-te;a.getSource().reparseOverscaled?(P=Math.max(n.canonical.z+2,a.transform.tileZoom),T=new r.aO(P,n.wrap,te,n.canonical.x>>Y,n.canonical.y>>Y)):Y!==0&&(P=te,T=new r.aO(P,n.wrap,te,n.canonical.x>>Y,n.canonical.y>>Y))}T.key!==n.key&&(G.push(T.key),d=a.getTile(T))}const q=te=>{G.forEach((Y=>{_[Y]=te})),G.length=0};for(P-=1;P>=k&&(!d||!d.hasData());P--){d&&q(d.tileID.key);const te=T.calculateScaledKey(P);if(d=a.getTileByID(te),d&&d.hasData())break;const Y=_[te];if(Y===null)break;Y===void 0?G.push(te):d=a.getTileByID(Y)}return q(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}}function Uh(h,n,a){const d=(function(P,k,G){const q=r.bJ(k,P),te=r.bJ(G,[.2126,.7152,.0722]),Y=(le,ce,Pe)=>(1-Pe)*le+Pe*ce,re=Y(1-.3*Math.min(te,1),1,Math.min(q+1,1));return Y(.92,1,Math.asin(r.aA(k[2],-1,1))/Math.PI+.5)*re})(h,[0,0,1],n),_=[0,0,0];r.c4(_,a.slice(0,3),d);const b=[0,0,0];r.c4(b,n.slice(0,3),h[2]);const T=[0,0,0];return r.d7(T,_,b),r.da(T)}const Wf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Zf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class jh{static cacheKey(n,a,d,_){let b=`${a}${_?_.cacheKey:""}`;for(const T of d)n.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(n,a,d,_,b,T){const P=n.gl;this.program=P.createProgram(),this.configuration=_,this.name=a,this.fixedDefines=[...T];let k=_?_.defines():[];k=k.concat(T.map((le=>`#define ${le}`)));const G=`#version 300 es
`;let q=G+k.concat("precision mediump float;",_l,gl.fragmentSource).join(`
`);for(const le of d.fragmentIncludes)q+=`
${ml[le]}`;q+=`
${d.fragmentSource}`;let te=G+k.concat("precision highp float;",_l,gl.vertexSource).join(`
`);for(const le of d.vertexIncludes)te+=`
${ml[le]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(te+=`
uniform int u_instanceID;
`),te+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(te=te.replaceAll("gl_InstanceID","u_instanceID"));const Y=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(Y,q),P.compileShader(Y),P.attachShader(this.program,Y);const re=P.createShader(P.VERTEX_SHADER);P.isContextLost()?this.failedToCreate=!0:(P.shaderSource(re,te),P.compileShader(re),P.attachShader(this.program,re),this.attributes={},P.linkProgram(this.program),P.deleteShader(re),P.deleteShader(Y),this.fixedUniforms=b(n),this.binderUniforms=_?_.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new r.cg(le)}))(n)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new r.cg(le),u_dem_prev:new r.cg(le),u_dem_tl:new r.cj(le),u_dem_scale:new r.ci(le),u_dem_tl_prev:new r.cj(le),u_dem_scale_prev:new r.ci(le),u_dem_size:new r.ci(le),u_dem_lerp:new r.ci(le),u_exaggeration:new r.ci(le),u_depth:new r.cg(le),u_depth_size_inv:new r.cj(le),u_depth_range_unpack:new r.cj(le),u_occluder_half_size:new r.ci(le),u_occlusion_depth_offset:new r.ci(le),u_meter_to_dem:new r.ci(le),u_label_plane_matrix_inv:new r.ck(le)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new r.ch(le),u_tile_tr_up:new r.ch(le),u_tile_br_up:new r.ch(le),u_tile_bl_up:new r.ch(le),u_tile_up_scale:new r.ci(le)}))(n)),T.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new r.ck(le),u_fog_range:new r.cj(le),u_fog_color:new r.d2(le),u_fog_horizon_blend:new r.ci(le),u_fog_vertical_limit:new r.cj(le),u_fog_temporal_offset:new r.ci(le),u_frustum_tl:new r.ch(le),u_frustum_tr:new r.ch(le),u_frustum_br:new r.ch(le),u_frustum_bl:new r.ch(le),u_globe_pos:new r.ch(le),u_globe_radius:new r.ci(le),u_globe_transition:new r.ci(le),u_is_globe:new r.cg(le),u_viewport:new r.cj(le)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new r.d2(le)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new r.ch(le),u_lighting_directional_dir:new r.ch(le),u_lighting_directional_color:new r.ch(le),u_ground_radiance:new r.ch(le)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new r.ck(le),u_light_matrix_1:new r.ck(le),u_fade_range:new r.cj(le),u_shadow_normal_offset:new r.ch(le),u_shadow_intensity:new r.ci(le),u_shadow_texel_size:new r.ci(le),u_shadow_map_resolution:new r.ci(le),u_shadow_direction:new r.ch(le),u_shadow_bias:new r.ch(le),u_shadowmap_0:new r.cg(le),u_shadowmap_1:new r.cg(le)}))(n)))}getAttributeLocation(n,a){let d=this.attributes[a];return d===void 0&&(d=this.attributes[a]=n.getAttribLocation(this.program,a)),d}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_]&&d[_].set(this.program,_,a[_])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_]&&d[_].set(this.program,_,a[_])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}_drawDebugWireframe(n,a,d,_,b,T,P,k,G,q){const te=n.options.wireframe;if(te.terrain===!1&&te.layers2D===!1&&te.layers3D===!1)return;const Y=n.context;if(!(!(!te.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!te.layers2D||n._terrain&&n._terrain.renderingToTexture||!Wf.includes(this.name))||!(!te.layers3D||!Zf.includes(this.name))))return;const re=Y.gl,le=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,Y);if(!le)return;const ce=[...this.fixedDefines];ce.push("DEBUG_WIREFRAME");const Pe=n.getOrCreateProgram(this.name,{config:this.configuration,defines:ce});Y.program.set(Pe.program);const me=(Fe,Ze,He)=>{if(Ze[Fe]&&He[Fe])for(const Ye in Ze[Fe])He[Fe][Ye]&&He[Fe][Ye].set(He.program,Ye,Ze[Fe][Ye].current)};G&&G.setUniforms(Pe.program,Y,Pe.binderUniforms,P,{zoom:k}),me("fixedUniforms",this,Pe),me("terrainUniforms",this,Pe),me("globeUniforms",this,Pe),me("fogUniforms",this,Pe),me("lightsUniforms",this,Pe),me("shadowUniforms",this,Pe),le.bind(),Y.setColorMode(new br([re.ONE,re.ONE_MINUS_SRC_ALPHA,re.ZERO,re.ONE],r.ao.transparent,[!0,!0,!0,!1])),Y.setDepthMode(new Pn(a.func===re.LESS?re.LEQUAL:a.func,Pn.ReadOnly,a.range)),Y.setStencilMode(sr.disabled);const Me=3*T.primitiveLength*2,Le=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Fe=q||1;for(let Ze=0;Ze<Fe;++Ze)Pe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ze),re.drawElements(re.LINES,Me,re.UNSIGNED_SHORT,Le)}else q&&q>1?re.drawElementsInstanced(re.LINES,Me,re.UNSIGNED_SHORT,Le,q):re.drawElements(re.LINES,Me,re.UNSIGNED_SHORT,Le);b.bind(),Y.program.set(this.program),Y.setDepthMode(a),Y.setStencilMode(d),Y.setColorMode(_)}checkUniforms(n,a,d){if(this.fixedDefines.includes(a)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${_} not set but required by ${a} being defined`)}}draw(n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe){const me=n.context,Me=me.gl;if(this.failedToCreate)return;me.program.set(this.program),me.setDepthMode(d),me.setStencilMode(_),me.setColorMode(b),me.setCullFace(T);for(const Ze of Object.keys(this.fixedUniforms))this.fixedUniforms[Ze].set(this.program,Ze,P[Ze]);le&&le.setUniforms(this.program,me,this.binderUniforms,Y,{zoom:re});const Le={[Me.POINTS]:1,[Me.LINES]:2,[Me.TRIANGLES]:3,[Me.LINE_STRIP]:1}[a];this.checkUniforms(k,"RENDER_SHADOWS",this.shadowUniforms);const Fe=Pe&&Pe>0?1:void 0;for(const Ze of te.get()){const He=Ze.vaos||(Ze.vaos={});if((He[k]||(He[k]=new wc)).bind(me,this,G,le?le.getPaintVertexBuffers():[],q,Ze.vertexOffset,ce||[],Fe),this.forceManualRenderingForInstanceIDShaders){const Ye=Pe||1;for(let qe=0;qe<Ye;++qe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",qe),q?Me.drawElements(a,Ze.primitiveLength*Le,Me.UNSIGNED_SHORT,Ze.primitiveOffset*Le*2):Me.drawArrays(a,Ze.vertexOffset,Ze.vertexLength)}else Pe&&Pe>1?Me.drawElementsInstanced(a,Ze.primitiveLength*Le,Me.UNSIGNED_SHORT,Ze.primitiveOffset*Le*2,Pe):q?Me.drawElements(a,Ze.primitiveLength*Le,Me.UNSIGNED_SHORT,Ze.primitiveOffset*Le*2):Me.drawArrays(a,Ze.vertexOffset,Ze.vertexLength);a===Me.TRIANGLES&&q&&this._drawDebugWireframe(n,d,_,b,q,Ze,Y,re,le,Pe)}}}function Nd(h,n,a=0){const d=Math.pow(2,n.tileID.overscaledZ),_=n.tileSize*Math.pow(2,h.transform.tileZoom)/d,b=_*(n.tileID.canonical.x+n.tileID.wrap*d),T=_*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(n,1,h.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T],u_pattern_transition:a}}const Xc={terrain:0,flat:1},Ai=r.bC(),Gh=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me)=>{const Me=n.style.light,Le=Me.properties.get("position"),Fe=[Le.x,Le.y,Le.z],Ze=r.dL();Me.properties.get("anchor")==="viewport"&&(r.dM(Ze,-n.transform.angle),r.dN(Fe,Fe,Ze));const He=Me.properties.get("color").toPremultipliedRenderColor(null),Ye=n.transform,qe={u_matrix:h,u_lightpos:Fe,u_lightintensity:Me.properties.get("intensity"),u_lightcolor:[He.r,He.g,He.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ai,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Xc[G],u_base_type:Xc[q],u_ao:_,u_edge_radius:b,u_width_scale:T,u_flood_light_color:le,u_vertical_scale:ce,u_flood_light_intensity:Pe,u_ground_shadow_factor:me};return Ye.projection.name==="globe"&&(qe.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],qe.u_zoom_transition=te,qe.u_inv_rot_matrix=re,qe.u_merc_center=Y,qe.u_up_dir=Ye.projection.upVector(new r.cC(0,0,0),Y[0]*r.al,Y[1]*r.al),qe.u_height_lift=k),qe},fa=(h,n,a,d,_,b)=>({u_matrix:h,u_edge_radius:n,u_width_scale:a,u_vertical_scale:d,u_height_type:Xc[_],u_base_type:Xc[b]}),Yf=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me)=>{const Me=Gh(h,n,a,d,_,b,T,P,G,q,te,Y,re,le,ce,Pe,1,[0,0,0]),Le={u_height_factor:-Math.pow(2,P.overscaledZ)/k.tileSize/8};return Object.assign(Me,Nd(n,k,me),Le)},rm=(h,n,a)=>({u_matrix:h,u_emissive_strength:n,u_ground_shadow_factor:a}),Gl=(h,n,a,d,_,b=0)=>Object.assign(rm(h,n,_),Nd(a,d,b)),Vd=(h,n,a,d)=>({u_matrix:h,u_world:a,u_emissive_strength:n,u_ground_shadow_factor:d}),Ud=(h,n,a,d,_,b,T=0)=>Object.assign(Gl(h,n,a,d,b,T),{u_world:_}),cg=(h,n)=>({u_matrix:h,u_ground_shadow_factor:n}),jd=(h,n,a,d,_)=>({u_matrix:h,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:a,u_height_scale:d,u_reset_depth:_}),S_=(h,n,a,d,_,b,T)=>({u_matrix:h,u_normal_matrix:n,u_opacity:a,u_faux_facade_ao_intensity:d,u_camera_pos:_,u_tile_to_meter:b,u_facade_emissive_chance:T}),ug=h=>({u_matrix:h}),$l=h=>({u_matrix:h}),$h=(h,n,a,d,_,b,T,P)=>{const k=r.al/b.tileSize;return{u_matrix:h,u_inv_rot_matrix:n,u_camera_to_center_distance:a.getCameraToCenterDistance(P),u_extrude_scale:[a.pixelsToGLUnits[0]/k,a.pixelsToGLUnits[1]/k],u_zoom_transition:d,u_tile_id:T,u_merc_center:_}},Hh=(h,n,a=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:a}),Kc=r.bC(),Xf=(h,n,a,d,_,b,T)=>{const P=h.transform,k=P.projection.name==="globe",G=k?r.dO(P.zoom,n.canonical)*P._pixelsPerMercatorPixel:r.ay(a,1,b),q={u_matrix:n.projMatrix,u_extrude_scale:G,u_intensity:T,u_inv_rot_matrix:Kc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){q.u_inv_rot_matrix=d,q.u_merc_center=_,q.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],q.u_zoom_transition=r.aj(P.zoom);const te=_[0]*r.al,Y=_[1]*r.al;q.u_up_dir=P.projection.upVector(new r.cC(0,0,0),te,Y)}return q};function Hl(h,[n,a,d,_],[b,T]){if(b===T)return[0,0,0,0];const P=255*(h-1)/(h*(T-b));return[n*P,a*P,d*P,_*P]}function qh(h,n,[a,d]){return a===d?0:.5/h+(n-a)*(h-1)/(h*(d-a))}const Kf=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me,Le,Fe)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:b,u_scale_parent:G,u_fade_t:q.mix,u_opacity:q.opacity*te.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:te.paint.get("raster-brightness-min"),u_brightness_high:te.paint.get("raster-brightness-max"),u_saturation_factor:r.dQ(te.paint.get("raster-saturation")),u_contrast_factor:r.dP(te.paint.get("raster-contrast")),u_spin_weights:Jc(te.paint.get("raster-hue-rotate")),u_perspective_transform:Y,u_raster_elevation:re,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:k,u_colorization_mix:Hl(r.dR,ce,me),u_colorization_offset:qh(r.dR,Pe,me),u_color_ramp:le,u_texture_offset:[Le/(Me+2*Le),Me/(Me+2*Le)],u_texture_res:[Me+2*Le,Me+2*Le],u_emissive_strength:Fe});function Jc(h){h*=Math.PI/180;const n=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Nu=.05,vl=(h,n,a,d,_,b,T,P,k,G,q,te)=>({u_matrix:h,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:b,u_scale_parent:G,u_fade_t:q.mix,u_opacity:q.opacity,u_image0:0,u_image1:1,u_raster_elevation:te,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:k}),Zr=(h,n,a,d,_,b,T,P,k,G)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_tile_offset:a,u_velocity:d,u_color_ramp:b,u_velocity_res:_,u_max_speed:T,u_uv_offset:P,u_data_scale:[255*k[0],255*k[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nu,Nu]}),Jf=(h,n,a,d,_,b,T,P,k,G)=>({u_particle_texture:h,u_particle_texture_side_len:n,u_velocity:a,u_velocity_res:d,u_max_speed:_,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*k[0],255*k[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nu,Nu]}),im=r.bC(),Qf=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me,Le,Fe,Ze,He,Ye)=>{const qe=_.transform,We={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:qe.getCameraToCenterDistance(Me),u_rotate_symbol:+a,u_aspect_ratio:qe.width/qe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+G,u_elevation_from_sea:k?1:0,u_pitch_with_map:+d,u_texsize:q,u_texsize_icon:te,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:im,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:im,u_up_vector:[0,-1,0],u_color_adj_mat:Ze,u_icon_transition:He||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(Me)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ye||1,u_ground_shadow_factor:Le,u_inv_matrix:r.bl(r.bC(),T),u_normal_scale:Fe,u_lutTexture:vo.LUT};return Me.name==="globe"&&(We.u_tile_id=[re.canonical.x,re.canonical.y,1<<re.canonical.z],We.u_zoom_transition=le,We.u_inv_rot_matrix=Pe,We.u_merc_center=ce,We.u_camera_forward=qe._camera.forward(),We.u_ecef_origin=r.dS(qe.globeMatrix,re.toUnwrapped()),We.u_tile_matrix=Float32Array.from(qe.globeMatrix),We.u_up_vector=me),We},Qc=(h,n,a,d)=>({u_matrix:h,u_emissive_strength:n,u_opacity:a,u_color:d}),ep=(h,n,a,d,_,b,T,P,k)=>Object.assign((function(G,q,te,Y,re,le){const{width:ce,height:Pe}=Y.imageManager.getPixelSize(q),me=Math.pow(2,le.tileID.overscaledZ),Me=le.tileSize*Math.pow(2,Y.transform.tileZoom)/me,Le=Me*(le.tileID.canonical.x+le.tileID.wrap*me),Fe=Me*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:te.tl,u_pattern_br:te.br,u_texsize:[ce,Pe],u_pattern_size:te.displaySize,u_pattern_units_to_pixels:re?[Y.transform.width,-1*Y.transform.height]:[1/r.ay(le,1,Y.transform.tileZoom),1/r.ay(le,1,Y.transform.tileZoom)],u_pixel_coord_upper:[Le>>16,Fe>>16],u_pixel_coord_lower:[65535&Le,65535&Fe]}})(0,b,T,d,P,k),{u_matrix:h,u_emissive_strength:n,u_opacity:a}),om=new Float32Array(r.bA([])),tp=(h,n,a,d,_,b,T,P,k,G,q,te,Y,re=[0,0,0],le)=>{const ce=_.style.light,Pe=ce.properties.get("position"),me=[-Pe.x,-Pe.y,Pe.z],Me=r.dL();ce.properties.get("anchor")==="viewport"&&(r.dM(Me,-_.transform.angle),r.dN(me,me,Me));const Le=q.alphaMode==="MASK",Fe=ce.properties.get("color").toNonPremultipliedRenderColor(null),Ze=Y.paint.get("model-ambient-occlusion-intensity"),He=Y.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return He.a=Y.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:h,u_lighting_matrix:n,u_normal_matrix:a,u_node_matrix:d||om,u_lightpos:me,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Fe.r,Fe.g,Fe.b],u_camera_pos:re,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Le,u_alphaCutoff:q.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:k,u_roughnessFactor:G,u_baseColorTexture:vo.BaseColor,u_metallicRoughnessTexture:vo.MetallicRoughness,u_normalTexture:vo.Normal,u_occlusionTexture:vo.Occlusion,u_emissionTexture:vo.Emission,u_lutTexture:vo.LUT,u_color_mix:He.toArray01(),u_aoIntensity:Ze,u_emissive_strength:te,u_occlusionTextureTransform:le||[0,0,0,0]}},Gd=(h,n=om,a=om)=>({u_matrix:h,u_instance:n,u_node_matrix:a}),T_={fillExtrusion:h=>({u_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_vertical_gradient:new r.ci(h),u_opacity:new r.ci(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_ao:new r.cj(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_up_dir:new r.ch(h),u_height_lift:new r.ci(h),u_flood_light_color:new r.ch(h),u_vertical_scale:new r.ci(h),u_flood_light_intensity:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),fillExtrusionDepth:h=>({u_matrix:new r.ck(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_vertical_scale:new r.ci(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h)}),fillExtrusionPattern:h=>({u_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_vertical_gradient:new r.ci(h),u_height_factor:new r.ci(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_ao:new r.cj(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_up_dir:new r.ch(h),u_height_lift:new r.ci(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_opacity:new r.ci(h),u_pattern_transition:new r.ci(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new r.ck(h),u_opacity:new r.ci(h),u_ao_pass:new r.ci(h),u_meter_to_tile:new r.ci(h),u_ao:new r.cj(h),u_flood_light_intensity:new r.ci(h),u_flood_light_color:new r.ch(h),u_attenuation:new r.ci(h),u_edge_radius:new r.ci(h),u_fb:new r.cg(h),u_fb_size:new r.ci(h),u_dynamic_offset:new r.ci(h)}),fill:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),fillPattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_pattern_transition:new r.ci(h)}),fillOutline:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_world:new r.cj(h),u_ground_shadow_factor:new r.ch(h)}),fillOutlinePattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_world:new r.cj(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_pattern_transition:new r.ci(h)}),building:h=>({u_matrix:new r.ck(h),u_normal_matrix:new r.ck(h),u_opacity:new r.ci(h),u_faux_facade_ao_intensity:new r.ci(h),u_camera_pos:new r.ch(h),u_tile_to_meter:new r.ci(h),u_facade_emissive_chance:new r.ci(h)}),buildingBloom:h=>({u_matrix:new r.ck(h)}),buildingDepth:h=>({u_matrix:new r.ck(h)}),elevatedStructuresDepth:h=>({u_matrix:new r.ck(h),u_depth_bias:new r.ci(h)}),elevatedStructures:h=>({u_matrix:new r.ck(h),u_ground_shadow_factor:new r.ch(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new r.ck(h),u_camera_pos:new r.ch(h),u_depth_bias:new r.ci(h),u_height_scale:new r.ci(h),u_reset_depth:new r.ci(h)}),circle:r.dV,collisionBox:h=>({u_matrix:new r.ck(h),u_inv_rot_matrix:new r.ck(h),u_camera_to_center_distance:new r.ci(h),u_extrude_scale:new r.cj(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_tile_id:new r.ch(h)}),collisionCircle:h=>({u_matrix:new r.ck(h),u_inv_matrix:new r.ck(h),u_camera_to_center_distance:new r.ci(h),u_viewport_size:new r.cj(h)}),debug:h=>({u_color:new r.dx(h),u_matrix:new r.ck(h),u_overlay:new r.cg(h),u_overlay_scale:new r.ci(h)}),clippingMask:h=>({u_matrix:new r.ck(h)}),heatmap:h=>({u_extrude_scale:new r.ci(h),u_intensity:new r.ci(h),u_matrix:new r.ck(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_up_dir:new r.ch(h)}),heatmapTexture:h=>({u_image:new r.cg(h),u_color_ramp:new r.cg(h),u_opacity:new r.ci(h)}),hillshade:h=>({u_matrix:new r.ck(h),u_image:new r.cg(h),u_latrange:new r.cj(h),u_light:new r.cj(h),u_shadow:new r.dx(h),u_highlight:new r.dx(h),u_emissive_strength:new r.ci(h),u_accent:new r.dx(h)}),hillshadePrepare:h=>({u_matrix:new r.ck(h),u_image:new r.cg(h),u_dimension:new r.cj(h),u_zoom:new r.ci(h)}),line:r.dU,linePattern:r.dT,raster:h=>({u_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_grid_matrix:new r.dy(h),u_tl_parent:new r.cj(h),u_scale_parent:new r.ci(h),u_fade_t:new r.ci(h),u_opacity:new r.ci(h),u_image0:new r.cg(h),u_image1:new r.cg(h),u_brightness_low:new r.ci(h),u_brightness_high:new r.ci(h),u_saturation_factor:new r.ci(h),u_contrast_factor:new r.ci(h),u_spin_weights:new r.ch(h),u_perspective_transform:new r.cj(h),u_raster_elevation:new r.ci(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_cutoff_params:new r.d2(h),u_colorization_mix:new r.d2(h),u_colorization_offset:new r.ci(h),u_color_ramp:new r.cg(h),u_texture_offset:new r.cj(h),u_texture_res:new r.cj(h),u_emissive_strength:new r.ci(h)}),rasterParticle:h=>({u_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_grid_matrix:new r.dy(h),u_tl_parent:new r.cj(h),u_scale_parent:new r.ci(h),u_fade_t:new r.ci(h),u_opacity:new r.ci(h),u_image0:new r.cg(h),u_image1:new r.cg(h),u_raster_elevation:new r.ci(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_cutoff_params:new r.d2(h)}),rasterParticleTexture:h=>({u_texture:new r.cg(h),u_opacity:new r.ci(h)}),rasterParticleDraw:h=>({u_particle_texture:new r.cg(h),u_particle_texture_side_len:new r.ci(h),u_tile_offset:new r.cj(h),u_velocity:new r.cg(h),u_color_ramp:new r.cg(h),u_velocity_res:new r.cj(h),u_max_speed:new r.ci(h),u_uv_offset:new r.cj(h),u_data_scale:new r.cj(h),u_data_offset:new r.ci(h),u_particle_pos_scale:new r.ci(h),u_particle_pos_offset:new r.cj(h)}),rasterParticleUpdate:h=>({u_particle_texture:new r.cg(h),u_particle_texture_side_len:new r.ci(h),u_velocity:new r.cg(h),u_velocity_res:new r.cj(h),u_max_speed:new r.ci(h),u_speed_factor:new r.ci(h),u_reset_rate:new r.ci(h),u_rand_seed:new r.ci(h),u_uv_offset:new r.cj(h),u_data_scale:new r.cj(h),u_data_offset:new r.ci(h),u_particle_pos_scale:new r.ci(h),u_particle_pos_offset:new r.cj(h)}),symbol:h=>({u_is_size_zoom_constant:new r.cg(h),u_is_size_feature_constant:new r.cg(h),u_size_t:new r.ci(h),u_size:new r.ci(h),u_camera_to_center_distance:new r.ci(h),u_rotate_symbol:new r.cg(h),u_aspect_ratio:new r.ci(h),u_fade_change:new r.ci(h),u_matrix:new r.ck(h),u_label_plane_matrix:new r.ck(h),u_coord_matrix:new r.ck(h),u_is_text:new r.cg(h),u_elevation_from_sea:new r.cg(h),u_pitch_with_map:new r.cg(h),u_texsize:new r.cj(h),u_texsize_icon:new r.cj(h),u_texture:new r.cg(h),u_texture_icon:new r.cg(h),u_gamma_scale:new r.ci(h),u_device_pixel_ratio:new r.ci(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_camera_forward:new r.ch(h),u_tile_matrix:new r.ck(h),u_up_vector:new r.ch(h),u_ecef_origin:new r.ch(h),u_is_halo:new r.cg(h),u_icon_transition:new r.ci(h),u_color_adj_mat:new r.ck(h),u_scale_factor:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_inv_matrix:new r.ck(h),u_normal_scale:new r.ci(h),u_lutTexture:new r.cg(h)}),background:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_opacity:new r.ci(h),u_color:new r.dx(h)}),backgroundPattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_opacity:new r.ci(h),u_image:new r.cg(h),u_pattern_tl:new r.cj(h),u_pattern_br:new r.cj(h),u_texsize:new r.cj(h),u_pattern_size:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_pattern_units_to_pixels:new r.cj(h)}),terrainRaster:h=>({u_matrix:new r.ck(h),u_image0:new r.cg(h),u_skirt_height:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),skybox:h=>({u_matrix:new r.ck(h),u_sun_direction:new r.ch(h),u_cubemap:new r.cg(h),u_opacity:new r.ci(h),u_temporal_offset:new r.ci(h)}),skyboxGradient:h=>({u_matrix:new r.ck(h),u_color_ramp:new r.cg(h),u_center_direction:new r.ch(h),u_radius:new r.ci(h),u_opacity:new r.ci(h),u_temporal_offset:new r.ci(h)}),skyboxCapture:h=>({u_matrix_3f:new r.dy(h),u_sun_direction:new r.ch(h),u_sun_intensity:new r.ci(h),u_color_tint_r:new r.d2(h),u_color_tint_m:new r.d2(h),u_luminance:new r.ci(h)}),globeRaster:h=>({u_proj_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_image0:new r.cg(h),u_grid_matrix:new r.dy(h),u_skirt_height:new r.ci(h),u_far_z_cutoff:new r.ci(h),u_frustum_tl:new r.ch(h),u_frustum_tr:new r.ch(h),u_frustum_br:new r.ch(h),u_frustum_bl:new r.ch(h),u_globe_pos:new r.ch(h),u_globe_radius:new r.ci(h),u_viewport:new r.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new r.ch(h),u_frustum_tr:new r.ch(h),u_frustum_br:new r.ch(h),u_frustum_bl:new r.ch(h),u_horizon:new r.ci(h),u_transition:new r.ci(h),u_fadeout_range:new r.ci(h),u_atmosphere_fog_color:new r.d2(h),u_high_color:new r.d2(h),u_space_color:new r.d2(h),u_temporal_offset:new r.ci(h),u_horizon_angle:new r.ci(h)}),model:h=>({u_matrix:new r.ck(h),u_lighting_matrix:new r.ck(h),u_normal_matrix:new r.ck(h),u_node_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_camera_pos:new r.ch(h),u_opacity:new r.ci(h),u_baseColorFactor:new r.d2(h),u_emissiveFactor:new r.d2(h),u_metallicFactor:new r.ci(h),u_roughnessFactor:new r.ci(h),u_baseTextureIsAlpha:new r.cg(h),u_alphaMask:new r.cg(h),u_alphaCutoff:new r.ci(h),u_baseColorTexture:new r.cg(h),u_metallicRoughnessTexture:new r.cg(h),u_normalTexture:new r.cg(h),u_occlusionTexture:new r.cg(h),u_emissionTexture:new r.cg(h),u_lutTexture:new r.cg(h),u_color_mix:new r.d2(h),u_aoIntensity:new r.ci(h),u_emissive_strength:new r.ci(h),u_occlusionTextureTransform:new r.d2(h)}),modelDepth:h=>({u_matrix:new r.ck(h),u_instance:new r.ck(h),u_node_matrix:new r.ck(h)}),groundShadow:h=>({u_matrix:new r.ck(h),u_ground_shadow_factor:new r.ch(h)}),stars:h=>({u_matrix:new r.ck(h),u_up:new r.ch(h),u_right:new r.ch(h),u_intensity_multiplier:new r.ci(h)}),snowParticle:h=>({u_modelview:new r.ck(h),u_projection:new r.ck(h),u_time:new r.ci(h),u_cam_pos:new r.ch(h),u_velocityConeAperture:new r.ci(h),u_velocity:new r.ci(h),u_horizontalOscillationRadius:new r.ci(h),u_horizontalOscillationRate:new r.ci(h),u_boxSize:new r.ci(h),u_billboardSize:new r.ci(h),u_simpleShapeParameters:new r.cj(h),u_screenSize:new r.cj(h),u_thinningCenterPos:new r.cj(h),u_thinningShape:new r.ch(h),u_thinningAffectedRatio:new r.ci(h),u_thinningParticleOffset:new r.ci(h),u_particleColor:new r.d2(h),u_direction:new r.ch(h)}),rainParticle:h=>({u_modelview:new r.ck(h),u_projection:new r.ck(h),u_time:new r.ci(h),u_cam_pos:new r.ch(h),u_texScreen:new r.cg(h),u_velocityConeAperture:new r.ci(h),u_velocity:new r.ci(h),u_boxSize:new r.ci(h),u_rainDropletSize:new r.cj(h),u_distortionStrength:new r.ci(h),u_rainDirection:new r.ch(h),u_color:new r.d2(h),u_screenSize:new r.cj(h),u_thinningCenterPos:new r.cj(h),u_thinningShape:new r.ch(h),u_thinningAffectedRatio:new r.ci(h),u_thinningParticleOffset:new r.ci(h),u_shapeDirectionalPower:new r.ci(h),u_shapeNormalPower:new r.ci(h),u_mode:new r.ci(h)}),vignette:h=>({u_vignetteShape:new r.ch(h),u_vignetteColor:new r.d2(h)}),occlusion:h=>({u_matrix:new r.ck(h),u_anchorPos:new r.ch(h),u_screenSizePx:new r.cj(h),u_occluderSizePx:new r.cj(h),u_color:new r.d2(h)})};class ql{constructor(n,a,d,_){this.id=ql.uniqueIdxCounter,ql.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||_||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=ql.uniqueIdxCounter,ql.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ql.uniqueIdxCounter=0;const sm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class np{constructor(n,a,d,_,b,T){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.instanceCount=T,this.context=n;const P=n.gl;this.buffer=P.createBuffer(),n.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const _=a.getAttributeLocation(n,this.attributes[d].name);_!==-1&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,a,d){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],T=a.getAttributeLocation(n,b.name);T!==-1&&n.vertexAttribPointer(T,b.components,n[sm[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(n,a,d){for(let _=0;_<this.attributes.length;_++){const b=a.getAttributeLocation(n,this.attributes[_].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wh{constructor(n,a,d,_,b){this.context=n,this.width=a,this.height=d;const T=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new em(n,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new mo(n,T):new tm(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class am{constructor(n,a){this.gl=n,this.clearColor=new Bf(this),this.clearDepth=new da(this),this.clearStencil=new ig(this),this.colorMask=new ka(this),this.depthMask=new og(this),this.stencilMask=new sg(this),this.stencilFunc=new ag(this),this.stencilOp=new $c(this),this.stencilTest=new Lh(this),this.depthRange=new Xp(this),this.depthTest=new Fu(this),this.depthFunc=new Nf(this),this.blend=new zh(this),this.blendFunc=new Vf(this),this.blendColor=new Hc(this),this.blendEquation=new qc(this),this.cullFace=new Od(this),this.cullFaceSide=new Uf(this),this.frontFace=new Ld(this),this.program=new lg(this),this.activeTexture=new jf(this),this.viewport=new Kp(this),this.bindFramebuffer=new yl(this),this.bindRenderbuffer=new Bu(this),this.bindTexture=new Fh(this),this.bindVertexBuffer=new Gf(this),this.bindElementBuffer=new Bh(this),this.bindVertexArrayOES=new zd(this),this.pixelStoreUnpack=new Jp(this),this.pixelStoreUnpackPremultiplyAlpha=new Qp(this),this.pixelStoreUnpackFlipY=new Fd(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,d){return new ql(this,n,a,d)}createVertexBuffer(n,a,d,_,b){return new np(this,n,a,d,_,b)}createRenderbuffer(n,a,d){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,d,_){return new Wh(this,n,a,d,_)}clear({color:n,depth:a,stencil:d,colorMask:_}){const b=this.gl;let T=0;n&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),a!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){r.by(n.blendFunction,br.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Wl;function xl(h,n,a,d,_,b,T){const P=h.context,k=P.gl,G=h.transform,q=[r.aF(G.center.lng),r.aJ(G.center.lat)],te=a.layout.get("symbol-placement"),Y=a.layout.get("text-variable-anchor"),re=a.layout.get("icon-rotation-alignment")==="map",le=a.layout.get("text-rotation-alignment")==="map",ce=te!=="point",Pe=[];let me=0,Me=0;for(let We=0;We<d.length;We++){const Xe=d[We],Tt=n.getTile(Xe),ht=Tt.getBucket(a);if(!ht)continue;const Lt=ht.getProjection().createInversionMatrix(G,Xe.canonical),bt=[],Pt=$p(Xe,ht,G),nn=!T&&re&&ce,St=T&&le&&ce,rt=Y&&ht.hasTextData(),zt=ht.hasIconTextFit()&&rt&&ht.hasIconData(),wt=nn||St||T&&rt||zt,Zt=ht.projection.name==="globe",sn=Zt?r.aj(G.zoom):0;Zt&&(bt.push("PROJECTION_GLOBE_VIEW"),wt&&bt.push("PROJECTED_POS_ON_VIEWPORT"));const Sn=h.getOrCreateProgram("collisionBox",{defines:bt});let Ht=Pt;_[0]===0&&_[1]===0||(Ht=h.translatePosMatrix(Pt,Tt,_,b));const en=T?ht.textCollisionBox:ht.iconCollisionBox,Nn=ht.collisionCircleArray;if(Nn.length>0){const Gn=r.bC(),Vn=Ht;r.cO(Gn,ht.placementInvProjMatrix,G.glCoordMatrix),r.cO(Gn,Gn,ht.placementViewportMatrix),Pe.push({circleArray:Nn,circleOffset:Me,transform:Vn,invTransform:Gn,projection:ht.getProjection()}),me+=Nn.length/4,Me=me}if(!en)continue;h.terrain&&h.terrain.setupElevationDraw(Tt,Sn);const En=Zt?[Xe.canonical.x,Xe.canonical.y,1<<Xe.canonical.z]:[0,0,0];Sn.draw(h,k.LINES,Pn.disabled,sr.disabled,h.colorModeForRenderPass(),er.disabled,$h(Ht,Lt,G,sn,q,Tt,En,ht.getProjection()),a.id,en.layoutVertexBuffer,en.indexBuffer,en.segments,null,G.zoom,null,[en.collisionVertexBuffer,en.collisionVertexBufferExt])}if(!T||!Pe.length)return;const Le=h.getOrCreateProgram("collisionCircle"),Fe=new r.dW;Fe.resize(4*me),Fe._trim();let Ze=0;for(const We of Pe)for(let Xe=0;Xe<We.circleArray.length/4;Xe++){const Tt=4*Xe,ht=We.circleArray[Tt+0],Lt=We.circleArray[Tt+1],bt=We.circleArray[Tt+2],Pt=We.circleArray[Tt+3];Fe.emplace(Ze++,ht,Lt,bt,Pt,0),Fe.emplace(Ze++,ht,Lt,bt,Pt,1),Fe.emplace(Ze++,ht,Lt,bt,Pt,2),Fe.emplace(Ze++,ht,Lt,bt,Pt,3)}(!Wl||Wl.length<2*me)&&(Wl=(function(We){const Xe=2*We,Tt=new r.b1;Tt.resize(Xe),Tt._trim();for(let ht=0;ht<Xe;ht++){const Lt=6*ht;Tt.uint16[Lt+0]=4*ht+0,Tt.uint16[Lt+1]=4*ht+1,Tt.uint16[Lt+2]=4*ht+2,Tt.uint16[Lt+3]=4*ht+2,Tt.uint16[Lt+4]=4*ht+3,Tt.uint16[Lt+5]=4*ht+0}return Tt})(me));const He=P.createIndexBuffer(Wl,!0),Ye=P.createVertexBuffer(Fe,r.dX.members,!0);for(const We of Pe){const Xe={u_matrix:We.transform,u_inv_matrix:We.invTransform,u_camera_to_center_distance:(qe=G).getCameraToCenterDistance(We.projection),u_viewport_size:[qe.width,qe.height]};Le.draw(h,k.TRIANGLES,Pn.disabled,sr.disabled,h.colorModeForRenderPass(),er.disabled,Xe,a.id,Ye,He,r.bg.simpleSegment(0,2*We.circleOffset,We.circleArray.length,We.circleArray.length/2),null,G.zoom)}var qe;Ye.destroy(),He.destroy()}const Js=r.bC();function xs(h){const n=h._camera.getWorldToCamera(h.worldSize,1),a=r.aB([],n,h.globeMatrix);r.bl(a,a);const d=[0,0,0],_=[0,1,0,0];return r.aC(_,_,a),d[0]=_[0],d[1]=_[1],d[2]=_[2],r.aw(d,d),d}function bl({width:h,height:n,anchor:a,textOffset:d,textScale:_},b){const{horizontalAlign:T,verticalAlign:P}=r.c0(a),k=-(T-.5)*h,G=-(P-.5)*n,q=r.c1(a,d);return new r.P((k/_+q[0])*b,(G/_+q[1])*b)}function pa(h,n,a,d,_,b,T,P,k,G){const q=h.text.placedSymbolArray,te=h.text.dynamicLayoutVertexArray,Y=h.icon.dynamicLayoutVertexArray,re={},le=h.getProjection(),ce=mc(T,le,_),Pe=_.elevation,me=le.upVectorScale(T.canonical,_.center.lat,_.worldSize).metersToTile;te.clear();for(let Me=0;Me<q.length;Me++){const Le=q.get(Me),{tileAnchorX:Fe,tileAnchorY:Ze,numGlyphs:He}=Le,Ye=Le.hidden||!Le.crossTileID||h.allowVerticalPlacement&&!Le.placedOrientation?null:d[Le.crossTileID];if(Ye){let qe=0,We=0,Xe=0;if(Pe){const zt=Pe?Pe.getAtTileOffset(T,Fe,Ze):0,[wt,Zt,sn]=le.upVector(T.canonical,Fe,Ze);qe=zt*wt*me,We=zt*Zt*me,Xe=zt*sn*me}let[Tt,ht,Lt,bt]=qs(Le.projectedAnchorX+qe,Le.projectedAnchorY+We,Le.projectedAnchorZ+Xe,a?ce:b);const Pt=Uc(_.getCameraToCenterDistance(le),bt);let nn=r.bM(h.textSizeData,k,Le)*Pt/r.bX;a&&(nn*=h.tilePixelRatio/P);const St=bl(Ye,nn);a?({x:Tt,y:ht,z:Lt}=le.projectTilePoint(Fe+St.x,Ze+St.y,T.canonical),[Tt,ht,Lt]=qs(Tt+qe,ht+We,Lt+Xe,b)):(n&&St._rotate(-_.angle),Tt+=St.x,ht+=St.y,Lt=0);const rt=h.allowVerticalPlacement&&Le.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let zt=0;zt<He;zt++)r.bO(te,Tt,ht,Lt,rt);G&&Le.associatedIconIndex>=0&&(re[Le.associatedIconIndex]={x:Tt,y:ht,z:Lt,angle:rt})}else Qn(He,te)}if(G){Y.clear();const Me=h.icon.placedSymbolArray;for(let Le=0;Le<Me.length;Le++){const Fe=Me.get(Le),{numGlyphs:Ze}=Fe,He=re[Le];if(Fe.hidden||!He)Qn(Ze,Y);else{const{x:Ye,y:qe,z:We,angle:Xe}=He;for(let Tt=0;Tt<Ze;Tt++)r.bO(Y,Ye,qe,We,Xe)}}h.icon.dynamicLayoutVertexBuffer.updateData(Y)}h.text.dynamicLayoutVertexBuffer.updateData(te)}function Zh(h,n,a,d,_,b,T={}){const P=a.paint.get("icon-translate"),k=a.paint.get("text-translate"),G=a.paint.get("icon-translate-anchor"),q=a.paint.get("text-translate-anchor"),te=a.layout.get("icon-rotation-alignment"),Y=a.layout.get("text-rotation-alignment"),re=a.layout.get("icon-pitch-alignment"),le=a.layout.get("text-pitch-alignment"),ce=a.layout.get("icon-keep-upright"),Pe=a.layout.get("text-keep-upright"),me=a.paint.get("icon-color-saturation"),Me=a.paint.get("icon-color-contrast"),Le=a.paint.get("icon-color-brightness-min"),Fe=a.paint.get("icon-color-brightness-max"),Ze=a.layout.get("symbol-elevation-reference")==="sea",He=a.layout.get("icon-image-use-theme")==="none",Ye=h.context,qe=Ye.gl,We=h.transform,Xe=te==="map",Tt=Y==="map",ht=re==="map",Lt=le==="map",bt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Pt=!1;const nn=h.depthModeForSublayer(0,Pn.ReadOnly),St=new Pn(h.context.gl.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D),rt=[r.aF(We.center.lng),r.aJ(We.center.lat)],zt=a.layout.get("text-variable-anchor"),wt=We.projection.name==="globe",Zt=[],sn=[0,-1,0];for(const Sn of d){const Ht=n.getTile(Sn),en=Ht.getBucket(a);if(!en||en.projection.name==="mercator"&&wt||en.fullyClipped)continue;const Nn=en.projection.name==="globe",En=Nn?r.aj(We.zoom):0,Gn=mc(Sn,en.getProjection(),We),Vn=We.calculatePixelsToTileUnitsMatrix(Ht),Kn=zt&&en.hasTextData(),ir=en.hasIconTextFit()&&Kn&&en.hasIconData(),dr=en.getProjection().createInversionMatrix(We,Sn.canonical),qr=(1<<Ht.tileID.canonical.z)*r.al/h.transform.worldSize,hr=wr=>{let Zn=[0,0,0];if(wr){const Fn=h.style.directionalLight,Gr=h.style.ambientLight;Fn&&Gr&&(Zn=Ha(h.style,Fn,Gr))}return Zn},ri=wr=>{We.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||h.terrain)&&(wr.push("DEPTH_D24"),wr.push("DEPTH_OCCLUSION"))},si=wr=>{a.lut&&!He&&(a.lut.texture||(a.lut.texture=new r.dY(h.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],Ye.gl.RGBA8)),Ye.activeTexture.set(Ye.gl.TEXTURE0+vo.LUT),a.lut.texture&&a.lut.texture.bind(Ye.gl.LINEAR,Ye.gl.CLAMP_TO_EDGE),wr.push("APPLY_LUT_ON_GPU"))},Mi=()=>{const wr=Xe&&a.layout.get("symbol-placement")!=="point",Zn=[];ri(Zn),si(Zn);const Fn=wr||ir,Gr=en.elevationType==="road",Oi=h.shadowRenderer,Ii=Gr&&ht&&!!Oi&&Oi.enabled,xo=hr(Ii),bo=Gr&&ht&&!h.terrain?St:nn,Xi=a.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&ht&&Zn.push("PITCH_WITH_MAP_TERRAIN"),Nn&&(Zn.push("PROJECTION_GLOBE_VIEW"),Fn&&Zn.push("PROJECTED_POS_ON_VIEWPORT")),Xi>0&&en.hasAnySecondaryIcon&&Zn.push("ICON_TRANSITION"),!en.icon.zOffsetVertexBuffer||Gr&&h.terrain||Zn.push("Z_OFFSET"),me===0&&Me===0&&Le===0&&Fe===1||Zn.push("COLOR_ADJUSTMENT"),en.sdfIcons&&Zn.push("RENDER_SDF"),Ii&&Zn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gr&&ht&&!h.terrain&&en.icon.orientationVertexBuffer&&Zn.push("ELEVATED_ROADS");const ss=en.icon.programConfigurations.get(a.id),as=h.getOrCreateProgram("symbol",{config:ss,defines:Zn}),na=Ht.imageAtlasTexture?Ht.imageAtlasTexture.size:[0,0],Co=en.iconSizeData,Bs=r.bK(Co,We.zoom),ga=ht||!We.isOrthographic,vi=Ga(Gn,Ht.tileID.canonical,ht,Xe,We,en.getProjection(),Vn),uo=bd(Gn,Ht.tileID.canonical,ht,Xe,We,en.getProjection(),Vn),Ni=h.translatePosMatrix(uo,Ht,P,G,!0),wo=h.translatePosMatrix(Gn,Ht,P,G),No=Fn?Js:vi,Ki=Xe&&!ht&&!wr;let Ji=sn;!wt&&!We.mercatorFromTransition||Xe||(Ji=xs(We));const Ns=Nn?Ji:sn,Ta=a.getColorAdjustmentMatrix(me,Me,Le,Fe),ra=Qf(Co.kind,Bs,Ki,ht,h,wo,No,Ni,Ze,!1,na,[0,0],0,Sn,En,rt,dr,Ns,en.getProjection(),xo,qr,Ta,Xi,null),Ql=Ht.imageAtlasTexture?Ht.imageAtlasTexture:null,ec=a.layout.get("icon-size").constantOr(0)!==1||en.iconsNeedLinear,Pl=en.sdfIcons||h.options.rotating||h.options.zooming||ec||ga?qe.LINEAR:qe.NEAREST,tc=en.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Ml=h.terrain&&ht&&wr?r.bl(r.bC(),vi):Js;if(wr&&en.icon){const y=We.elevation,x=y?y.getAtTileOffsetFunc(Sn,We.center.lat,We.worldSize,en.getProjection()):null,L=gc(Gn,Ht.tileID.canonical,ht,Xe,We,en.getProjection(),Vn);wd(en,Gn,h,!1,L,uo,ht,ce,x,Sn)}return{program:as,buffers:en.icon,uniformValues:ra,atlasTexture:Ql,atlasTextureIcon:null,atlasInterpolation:Pl,atlasInterpolationIcon:null,isSDF:en.sdfIcons,hasHalo:tc,depthMode:bo,tile:Ht,renderWithShadows:Ii,labelPlaneMatrixInv:Ml}},yr=()=>{const wr=Tt&&a.layout.get("symbol-placement")!=="point",Zn=[],Fn=wr||zt||ir,Gr=en.elevationType==="road",Oi=h.shadowRenderer,Ii=Gr&&Lt&&!!Oi&&Oi.enabled,xo=hr(Ii),bo=Gr&&Lt&&!h.terrain?St:nn;h.terrainRenderModeElevated()&&Lt&&Zn.push("PITCH_WITH_MAP_TERRAIN"),Nn&&(Zn.push("PROJECTION_GLOBE_VIEW"),Fn&&Zn.push("PROJECTED_POS_ON_VIEWPORT")),!en.text.zOffsetVertexBuffer||Gr&&h.terrain||Zn.push("Z_OFFSET"),en.iconsInText&&Zn.push("RENDER_TEXT_AND_SYMBOL"),Zn.push("RENDER_SDF"),Ii&&Zn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gr&&Lt&&!h.terrain&&en.text.orientationVertexBuffer&&Zn.push("ELEVATED_ROADS"),ri(Zn);const Xi=en.text.programConfigurations.get(a.id),ss=h.getOrCreateProgram("symbol",{config:Xi,defines:Zn});let as,na=[0,0],Co=null;const Bs=en.textSizeData;en.iconsInText&&(na=Ht.imageAtlasTexture?Ht.imageAtlasTexture.size:[0,0],Co=Ht.imageAtlasTexture?Ht.imageAtlasTexture:null,as=Lt||!We.isOrthographic||h.options.rotating||h.options.zooming||Bs.kind==="composite"||Bs.kind==="camera"?qe.LINEAR:qe.NEAREST);const ga=Ht.glyphAtlasTexture?Ht.glyphAtlasTexture.size:[0,0],vi=a.layout.get("text-size-scale-range"),uo=r.aA(h.scaleFactor,vi[0],vi[1]),Ni=r.bK(Bs,We.zoom,uo),wo=Ga(Gn,Ht.tileID.canonical,Lt,Tt,We,en.getProjection(),Vn),No=bd(Gn,Ht.tileID.canonical,Lt,Tt,We,en.getProjection(),Vn),Ki=h.translatePosMatrix(No,Ht,k,q,!0),Ji=h.translatePosMatrix(Gn,Ht,k,q),Ns=Fn?Js:wo,Ta=Tt&&!Lt&&!wr;let ra=sn;!wt&&!We.mercatorFromTransition||Tt||(ra=xs(We));const Ql=Qf(Bs.kind,Ni,Ta,Lt,h,Ji,Ns,Ki,Ze,!0,ga,na,0,Sn,En,rt,dr,Nn?ra:sn,en.getProjection(),xo,qr,null,null,uo),ec=Ht.glyphAtlasTexture?Ht.glyphAtlasTexture:null,Pl=qe.LINEAR,tc=a.paint.get("text-halo-width").constantOr(1)!==0,Ml=h.terrain&&Lt&&wr?r.bl(r.bC(),wo):Js;if(wr&&en.text){const y=We.elevation,x=y?y.getAtTileOffsetFunc(Sn,We.center.lat,We.worldSize,en.getProjection()):null,L=gc(Gn,Ht.tileID.canonical,Lt,Tt,We,en.getProjection(),Vn);wd(en,Gn,h,!0,L,No,Lt,Pe,x,Sn)}return{program:ss,buffers:en.text,uniformValues:Ql,atlasTexture:ec,atlasTextureIcon:Co,atlasInterpolation:Pl,atlasInterpolationIcon:as,isSDF:!0,hasHalo:tc,depthMode:bo,tile:Ht,renderWithShadows:Ii,labelPlaneMatrixInv:Ml}},Qr=en.icon.segments.get().length,Xr=en.text.segments.get().length,ei=Qr&&!T.onlyText?Mi():null,$i=Xr&&!T.onlyIcons?yr():null,Dr=a.paint.get("icon-opacity").constantOr(1),hi=a.paint.get("text-opacity").constantOr(1);if(bt&&en.canOverlap){Pt=!0;const wr=Dr&&!T.onlyText?en.icon.segments.get():[],Zn=hi&&!T.onlyIcons?en.text.segments.get():[];for(const Fn of wr)Zt.push({segments:new r.bg([Fn]),sortKey:Fn.sortKey,state:ei});for(const Fn of Zn)Zt.push({segments:new r.bg([Fn]),sortKey:Fn.sortKey,state:$i})}else T.onlyText||Zt.push({segments:Dr?en.icon.segments:new r.bg([]),sortKey:0,state:ei}),T.onlyIcons||Zt.push({segments:hi?en.text.segments:new r.bg([]),sortKey:0,state:$i})}Pt&&Zt.sort(((Sn,Ht)=>Sn.sortKey-Ht.sortKey));for(const Sn of Zt){const Ht=Sn.state;if(Ht)if(h.terrain?h.terrain.setupElevationDraw(Ht.tile,Ht.program,{useDepthForOcclusion:We.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ht.labelPlaneMatrixInv}):h.setupDepthForOcclusion(We.depthOcclusionForSymbolsAndCircles,Ht.program),Ye.activeTexture.set(qe.TEXTURE0),Ht.atlasTexture&&Ht.atlasTexture.bind(Ht.atlasInterpolation,qe.CLAMP_TO_EDGE,!0),Ht.atlasTextureIcon&&(Ye.activeTexture.set(qe.TEXTURE1),Ht.atlasTextureIcon&&Ht.atlasTextureIcon.bind(Ht.atlasInterpolationIcon,qe.CLAMP_TO_EDGE,!0)),Ht.renderWithShadows&&h.shadowRenderer.setupShadows(Ht.tile.tileID.toUnwrapped(),Ht.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,Ht.program),Ht.hasHalo){const en=Ht.uniformValues;en.u_is_halo=1,rp(Ht.buffers,Sn.segments,a,h,Ht.program,Ht.depthMode,_,b,en,2),en.u_is_halo=0}else{if(Ht.isSDF){const en=Ht.uniformValues;Ht.hasHalo&&(en.u_is_halo=1,rp(Ht.buffers,Sn.segments,a,h,Ht.program,Ht.depthMode,_,b,en,1)),en.u_is_halo=0}rp(Ht.buffers,Sn.segments,a,h,Ht.program,Ht.depthMode,_,b,Ht.uniformValues,1)}}}function rp(h,n,a,d,_,b,T,P,k,G){const q=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,b,T,P,er.disabled,k,a.id,h.layoutVertexBuffer,h.indexBuffer,n,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),q,G)}function ps(h,n){const a=1<<h.canonical.z,d=(n.x*a-h.canonical.x-h.wrap*a)*r.al,_=(n.y*a-h.canonical.y)*r.al,b=r.e5(n.z,n.y);return r.d4(d,_,b)}function ma(h,n,a,d,_){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const b=h.context.gl,T=new Pn(h.context.gl.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D),P=new Pn(h.context.gl.GREATER,Pn.ReadWrite,h.depthRangeFor3D),k=(function(re){let le=.01;return re.isOrthographic&&(le=r.ak(1e-4,le,r.c$(re.pitch>=$a?1:re.pitch/$a))),2*le})(h.transform),G=h.transform.getFreeCameraOptions().position,q="elevatedStructuresDepthReconstruct",te=h.getOrCreateProgram(q,{defines:["DEPTH_RECONSTRUCTION"]}),Y=h.getOrCreateProgram(q);for(const re of d){const le=n.getTile(re),ce=le.getBucket(a);if(!ce)continue;const Pe=ce.elevatedStructures;if(!Pe)continue;const me=ce.elevationBufferData.heightRange,Me=ps(re.toUnwrapped(),G),Le=h.translatePosMatrix(re.projMatrix,le,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let Fe,Ze,He,Ye;if(_==="initialize"){if(!me||me.min>=1||Pe.depthSegments.segments[0].primitiveLength===0)continue;Fe=jd(Le,Me,k,1,0),Ze=T,He=Pe.depthSegments,Ye=te}else if(_==="reset"){if(!me||me.min>=0||Pe.maskSegments.segments[0].primitiveLength===0)continue;Fe=jd(Le,Me,0,0,1),Ze=P,He=Pe.maskSegments,Ye=te}else if(_==="geometry"){if(Pe.depthSegments.segments[0].primitiveLength===0)continue;Fe=jd(Le,Me,k,1,0),Ze=T,He=Pe.depthSegments,Ye=Y}Ye.draw(h,b.TRIANGLES,Ze,sr.disabled,br.disabled,er.disabled,Fe,a.id,Pe.vertexBuffer,Pe.indexBuffer,He,a.paint,h.transform.zoom)}}function $d(h,n,a){const{painter:d,sourceCache:_,layer:b,coords:T,colorMode:P,elevationType:k,terrainEnabled:G,pass:q}=h,te=d.context.gl,Y=b.paint.get("fill-pattern"),re=b.paint.get("fill-pattern-cross-fade"),le=Y.constantOr(null);let ce=k;k!=="road"||n&&!G||(ce="none");const Pe=ce==="road",me=h.painter.shadowRenderer,Me=Pe&&!!me&&me.enabled,Le=new Pn(d.context.gl.LEQUAL,Pn.ReadOnly,d.depthRangeFor3D);let Fe=[0,0,0];if(Me){const Ye=d.style.directionalLight,qe=d.style.ambientLight;Ye&&qe&&(Fe=Ha(d.style,Ye,qe))}const Ze=Y&&Y.constantOr(1),He=(Ye,qe)=>{let We,Xe,Tt,ht,Lt;qe?(We=Ze&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Tt=te.LINES):(We=Ze?"fillPattern":"fill",Tt=te.TRIANGLES);for(const bt of T){const Pt=_.getTile(bt);if(Ze&&!Pt.patternsLoaded())continue;const nn=Pt.getBucket(b);if(!nn)continue;const St=n?nn.elevationBufferData:nn.bufferData;if(St.isEmpty())continue;d.prepareDrawTile();const rt=St.programConfigurations.get(b.id),zt=d.isTileAffectedByFog(bt),wt=[],Zt=[];Pe&&(wt.push("ELEVATED_ROADS"),Zt.push(St.elevatedLayoutVertexBuffer)),Me&&wt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ze&&(d.context.activeTexture.set(te.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),rt.updatePaintBuffers());let sn=!1;if(le&&Pt.imageAtlas){const En=Pt.imageAtlas,Gn=r.e0.from(le),Vn=Gn.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Kn=Gn.getSecondary(),ir=En.patternPositions.get(Vn),dr=Kn?En.patternPositions.get(Kn.scaleSelf(r.o.devicePixelRatio).toString()):null;sn=!!ir&&!!dr,ir&&rt.setConstantPatternPositions(ir,dr)}re>0&&(sn||rt.getPatternTransitionVertexBuffer("fill-pattern"))&&wt.push("FILL_PATTERN_TRANSITION");const Sn=d.getOrCreateProgram(We,{config:rt,overrideFog:zt,defines:wt}),Ht=d.translatePosMatrix(bt.projMatrix,Pt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));Me&&me.setupShadows(Pt.tileID.toUnwrapped(),Sn,"vector-tile");const en=b.paint.get("fill-emissive-strength");if(qe){ht=St.lineIndexBuffer,Lt=St.lineSegments;const En=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[te.drawingBufferWidth,te.drawingBufferHeight];Xe=We==="fillOutlinePattern"&&Ze?Ud(Ht,en,d,Pt,En,Fe,re):Vd(Ht,en,En,Fe)}else ht=St.indexBuffer,Lt=St.triangleSegments,Xe=Ze?Gl(Ht,en,d,Pt,Fe,re):rm(Ht,en,Fe);d.uploadCommonUniforms(d.context,Sn,bt.toUnwrapped());let Nn=Ye;(k==="road"&&!G||k==="offset")&&(Nn=Le),Sn.draw(d,Tt,Nn,a||d.stencilModeForClipping(bt),P,er.disabled,Xe,b.id,St.layoutVertexBuffer,ht,Lt,b.paint,d.transform.zoom,rt,Zt)}};d.renderPass===q&&He(d.depthModeForSublayer(1,d.renderPass==="opaque"?Pn.ReadWrite:Pn.ReadOnly),!1),ce==="none"&&d.renderPass==="translucent"&&b.paint.get("fill-antialias")&&He(d.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Pn.ReadOnly),!0)}function In(h,n,a,d,_,b,T,P){a.resetLayerRenderingStats(h);const k=h.context,G=k.gl,q=h.transform,te=a.paint.get("fill-extrusion-pattern"),Y=a.paint.get("fill-extrusion-pattern-cross-fade"),re=te.constantOr(null),le=te.constantOr(1),ce=a.paint.get("fill-extrusion-opacity"),Pe=h.style.enable3dLights(),me=a.paint.get(Pe&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Me=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),me],Le=a.layout.get("fill-extrusion-edge-radius"),Fe=Le>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ze=Fe?0:Le,He=q.projection.name==="globe"?r.e8():0,Ye=q.projection.name==="globe",qe=Ye?r.aj(q.zoom):0,We=[r.aF(q.center.lng),r.aJ(q.center.lat)],Xe=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Tt=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Xe?null:a.lut).toArray01().slice(0,3),ht=a.paint.get("fill-extrusion-flood-light-intensity"),Lt=a.paint.get("fill-extrusion-vertical-scale"),bt=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pt=a.paint.get("fill-extrusion-height-alignment"),nn=a.paint.get("fill-extrusion-base-alignment"),St=po(h,a.paint.get("fill-extrusion-cutoff-fade-range")),rt=[];let zt;Ye&&rt.push("PROJECTION_GLOBE_VIEW"),Me[0]>0&&rt.push("FAUX_AO"),Fe&&rt.push("ZERO_ROOF_RADIUS"),P&&rt.push("HAS_CENTROID"),ht>0&&rt.push("FLOOD_LIGHT"),St.shouldRenderCutoff&&rt.push("RENDER_CUTOFF"),bt&&rt.push("RENDER_WALL_MODE");const wt=h.renderPass==="shadow",Zt=h.shadowRenderer,sn=wt&&!!Zt,Sn=wt?er.disabled:er.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Ht=[0,0,0];if(Zt){const En=h.style.directionalLight,Gn=h.style.ambientLight;En&&Gn&&(Ht=Ha(h.style,En,Gn)),wt||(rt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Zt.useNormalOffset&&rt.push("NORMAL_OFFSET")),zt=rt.concat(["SHADOWS_SINGLE_CASCADE"])}const en=sn?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",Nn=a.getLayerRenderingStats();for(const En of d){const Gn=n.getTile(En),Vn=Gn.getBucket(a);if(!Vn||Vn.projection.name!==q.projection.name)continue;let Kn=!1;Zt&&(Kn=Zt.getMaxCascadeForTile(En.toUnwrapped())===0);const ir=h.isTileAffectedByFog(En),dr=Vn.programConfigurations.get(a.id);let qr=!1;if(re&&Gn.imageAtlas){const Xr=Gn.imageAtlas,ei=r.e0.from(re),$i=ei.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Dr=ei.getSecondary(),hi=Xr.patternPositions.get($i),wr=Dr?Xr.patternPositions.get(Dr.scaleSelf(r.o.devicePixelRatio).toString()):null;qr=!!hi&&!!wr,hi&&dr.setConstantPatternPositions(hi,wr)}Y>0&&(qr||dr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&rt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const hr=h.getOrCreateProgram(en,{config:dr,defines:Kn?zt:rt,overrideFog:ir});if(h.terrain&&h.terrain.setupElevationDraw(Gn,hr,{useMeterToDem:!0}),!Vn.centroidVertexBuffer){const Xr=hr.getAttributeLocation(G,"a_centroid_pos");Xr!==-1&&G.vertexAttrib2f(Xr,0,0)}!wt&&Zt&&Zt.setupShadows(Gn.tileID.toUnwrapped(),hr,"vector-tile"),le&&(h.context.activeTexture.set(G.TEXTURE0),Gn.imageAtlasTexture&&Gn.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),dr.updatePaintBuffers());const ri=a.paint.get("fill-extrusion-vertical-gradient"),si=1/Vn.tileToMeter;let Mi;if(wt&&Zt){if(Vu(Gn.tileID,Vn.maxHeight,h))continue;const Xr=Zt.calculateShadowPassMatrixFromTile(Gn.tileID.toUnwrapped());Mi=fa(Xr,Ze,si,Lt,Pt,nn)}else{const Xr=h.translatePosMatrix(En.expandedProjMatrix,Gn,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ei=q.projection.createInversionMatrix(q,En.canonical);Mi=le?Yf(Xr,h,ri,ce,Me,Ze,si,En,Gn,He,Pt,nn,qe,We,ei,Tt,Lt,Y):Gh(Xr,h,ri,ce,Me,Ze,si,En,He,Pt,nn,qe,We,ei,Tt,Lt,ht,Ht)}h.uploadCommonUniforms(k,hr,En.toUnwrapped(),null,St);let yr=Vn.segments;if(q.projection.name==="mercator"&&!wt&&(yr=Vn.getVisibleSegments(Gn.tileID,h.terrain,h.transform.getFrustum(0)),!yr.get().length))continue;if(Nn)if(wt)for(const Xr of yr.get())Nn.numRenderedVerticesInShadowPass+=Xr.primitiveLength;else for(const Xr of yr.get())Nn.numRenderedVerticesInTransparentPass+=Xr.primitiveLength;const Qr=[];(h.terrain||P)&&Qr.push(Vn.centroidVertexBuffer),Ye&&Qr.push(Vn.layoutVertexExtBuffer),bt&&Qr.push(Vn.wallVertexBuffer),hr.draw(h,k.gl.TRIANGLES,_,b,T,Sn,Mi,a.id,Vn.layoutVertexBuffer,Vn.indexBuffer,yr,a.paint,h.transform.zoom,dr,Qr)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class lm{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Cc(h,n,a,d,_,b,T,P,k,G,q,te,Y,re,le,ce,Pe,me,Me,Le){const Fe=n.context,Ze=Fe.gl,He=n.transform,Ye=n.transform.zoom,qe=[],We=h.translate,Xe=h.translateAnchor,Tt=h.edgeRadius,ht=po(n,h.cutoffFadeRange);q==="clear"?(qe.push("CLEAR_SUBPASS"),Le&&(qe.push("CLEAR_FROM_TEXTURE"),Fe.activeTexture.set(Ze.TEXTURE0),Le.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE))):q==="sdf"&&qe.push("SDF_SUBPASS"),me&&qe.push("HAS_CENTROID"),ht.shouldRenderCutoff&&qe.push("RENDER_CUTOFF");const Lt=(bt,Pt,nn,St,rt)=>{const zt=Pt.programConfigurations.get(d.id),wt=n.isTileAffectedByFog(bt),Zt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:zt,defines:qe,overrideFog:wt}),sn=((Ht,en,Nn,En,Gn,Vn,Kn,ir,dr,qr,hr)=>({u_matrix:en,u_opacity:Nn,u_ao_pass:En?1:0,u_meter_to_tile:Gn,u_ao:Vn,u_flood_light_intensity:Kn,u_flood_light_color:ir,u_attenuation:dr,u_edge_radius:qr,u_fb:0,u_fb_size:hr,u_dynamic_offset:1}))(0,St,te,G,rt,[Y,re*rt],le,ce,Pe,Ye>=17?0:Tt*rt,Le?Le.size[0]:0),Sn=[];me&&Sn.push(Pt.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(Fe,Zt,bt.toUnwrapped(),null,ht),Zt.draw(n,Fe.gl.TRIANGLES,b,T,P,k,sn,d.id,Pt.vertexBuffer,Pt.indexBuffer,nn,d.paint,Ye,zt,Sn)};for(const bt of _){const Pt=a.getTile(bt),nn=Pt.getBucket(d);if(!nn||nn.projection.name!==He.projection.name||!nn.groundEffect||nn.groundEffect&&!nn.groundEffect.hasData())continue;const St=nn.groundEffect,rt=1/nn.tileToMeter;{const zt=n.translatePosMatrix(bt.projMatrix,Pt,We,Xe),wt=St.getDefaultSegment();Lt(bt,St,wt,zt,rt)}if(Me)for(let zt=0;zt<4;zt++){const wt=r.e6[zt](bt),Zt=a.getTile(wt);if(!Zt)continue;const sn=Zt.getBucket(d);if(!sn||sn.projection.name!==He.projection.name||!sn.groundEffect||sn.groundEffect&&!sn.groundEffect.hasData())continue;const Sn=sn.groundEffect;let Ht,en;zt===0?(Ht=[-r.al,0,0],en=1):zt===1?(Ht=[r.al,0,0],en=0):zt===2?(Ht=[0,-r.al,0],en=3):(Ht=[0,r.al,0],en=2);const Nn=Sn.regionSegments[en];if(!Nn)continue;const En=new Float32Array(16);r.br(En,bt.projMatrix,Ht),Lt(bt,Sn,Nn,n.translatePosMatrix(En,Pt,We,Xe),rt)}}}function Ec(h,n,a,d,_,b,T){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const P=b?b.findDEMTileFor(a):null;if(!(P&&P.dem||T))return;b&&P&&P.dem&&d.selfDEMTileTimestamp!==P.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=P.dem._timestamp);const k=me=>new r.P(Math.ceil((me+r.ea)*r.eb),0),G=me=>{const Me=n.getSource().minzoom,Le=Ze=>{const He=n.getTileByID(Ze);if(He&&He.hasData())return He.getBucket(_)},Fe=[0,-1,1];for(const Ze of Fe){if(me.overscaledZ+Ze<Me)continue;const He=Le(me.calculateScaledKey(me.overscaledZ+Ze));if(He)return He}},q=[0,0,0],te=(me,Me)=>(q[0]=Math.min(me.min.y,Me.min.y),q[1]=Math.max(me.max.y,Me.max.y),q[2]=r.al-Me.min.x>me.max.x?Me.min.x-r.al:me.max.x,q),Y=(me,Me)=>(q[0]=Math.min(me.min.x,Me.min.x),q[1]=Math.max(me.max.x,Me.max.x),q[2]=r.al-Me.min.y>me.max.y?Me.min.y-r.al:me.max.y,q),re=[(me,Me)=>te(me,Me),(me,Me)=>te(Me,me),(me,Me)=>Y(me,Me),(me,Me)=>Y(Me,me)],le=(me,Me,Le,Fe,Ze,He,Ye)=>{if(!b)return 0;const qe=[[He?Le:me,He?me:Le,0],[He?Le:Me,He?Me:Le,0]],We=Ye<0?r.al+Ye:Ye,Xe=[He?We:(me+Me)/2,He?(me+Me)/2:We,0];return Le===0&&Ye<0||Le!==0&&Ye>0?b.getForTilePoints(Ze,[Xe],!0,Fe):qe.push(Xe),b.getForTilePoints(a,qe,!0,P),Math.max(qe[0][2],qe[1][2],Xe[2])/b.exaggeration()};for(let me=0;me<4;me++){const Me=d.borderFeatureIndices[me];if(Me.length===0)continue;const Le=r.e6[me](a),Fe=G(Le);if(!(Fe&&Fe instanceof r.e7))continue;const Ze=b?b.findDEMTileFor(Le):null;if(!(Ze&&Ze.dem||T)||(b&&Ze&&Ze.dem&&d.borderDEMTileTimestamp[me]!==Ze.dem._timestamp&&(d.borderDoneWithNeighborZ[me]=-1,d.borderDEMTileTimestamp[me]=Ze.dem._timestamp),d.borderDoneWithNeighborZ[me]===Fe.canonical.z))continue;Fe.centroidVertexArray.length===0&&Fe.createCentroidsBuffer();const He=(me<2?1:5)-me,Ye=Fe.borderDoneWithNeighborZ[He]!==d.canonical.z,qe=Fe.borderFeatureIndices[He];let We=0;if(d.canonical.z!==Fe.canonical.z){for(const Xe of Me)d.showCentroid(d.featuresOnBorder[Xe]);if(Ye)for(const Xe of qe)Fe.showCentroid(Fe.featuresOnBorder[Xe]);d.borderDoneWithNeighborZ[me]=Fe.canonical.z,Fe.borderDoneWithNeighborZ[He]=d.canonical.z}for(const Xe of Me){const Tt=d.featuresOnBorder[Xe],ht=d.centroidData[Tt.centroidDataIndex],Lt=Tt.borders[me];let bt;for(;We<qe.length;){bt=Fe.featuresOnBorder[qe[We]];const Pt=bt.borders[He];if(Pt[1]>Lt[0]+3||Pt[0]>Lt[0]-3)break;Fe.showCentroid(bt),We++}if(bt&&We<qe.length){const Pt=We;let nn=0;for(;!(bt.borders[He][0]>Lt[1]-3)&&(nn++,++We!==qe.length);)bt=Fe.featuresOnBorder[qe[We]];bt=Fe.featuresOnBorder[qe[Pt]];let St=!1;if(nn>=1){const wt=bt.borders[He];Math.abs(Lt[0]-wt[0])<3&&Math.abs(Lt[1]-wt[1])<3&&(nn=1,St=!0,We=Pt+1)}else if(nn===0){d.showCentroid(Tt);continue}const rt=Fe.centroidData[bt.centroidDataIndex];T&&St&&(((ce=ht).flags|(Pe=rt).flags)&r.e9?(ce.flags|=r.e9,Pe.flags|=r.e9):(ce.flags&=~r.e9,Pe.flags&=~r.e9));const zt=Tt.intersectsCount()>1||bt.intersectsCount()>1;if(nn>1)We=Pt,ht.centroidXY=rt.centroidXY=new r.P(0,0);else if(Ze&&Ze.dem&&!zt){const wt=re[me](ht,rt),Zt=me%2?r.al-1:0,sn=le(wt[0],Math.min(r.al-1,wt[1]),Zt,Ze,Le,me<2,wt[2]);ht.centroidXY=rt.centroidXY=k(sn)}else zt?ht.centroidXY=rt.centroidXY=new r.P(0,0):(ht.centroidXY=d.encodeBorderCentroid(Tt),rt.centroidXY=Fe.encodeBorderCentroid(bt));d.writeCentroidToBuffer(ht),Fe.writeCentroidToBuffer(rt)}else d.showCentroid(Tt)}d.borderDoneWithNeighborZ[me]=Fe.canonical.z,Fe.borderDoneWithNeighborZ[He]=d.canonical.z}var ce,Pe;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const eu=[1,0,0],rr=[0,1,0],cm=[0,0,1];function Vu(h,n,a){const d=a.transform,_=a.shadowRenderer;if(!_)return!0;const b=h.toUnwrapped(),T=d.tileSize*_._cascades[a.currentShadowCascade].scale;let P=n;if(d.elevation){const ce=d.elevation.getMinMaxForTile(h);ce&&(P+=ce.max)}const k=[..._.shadowDirection];k[2]=-k[2];const G=_.computeSimplifiedTileShadowVolume(b,P,T,k);if(!G)return!1;const q=[eu,rr,cm,k,[k[0],0,k[2]],[0,k[1],k[2]]],te=d.projection.name==="globe",Y=d.scaleZoom(T),re=r.cA.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,Y,!te),le=_.getCurrentCascadeFrustum();return re.intersectsPrecise(G.vertices,G.planes,q)===0||le.intersectsPrecise(G.vertices,G.planes,q)===0}function Zl(h){const{painter:n,source:a,layer:d,coords:_}=h;let b=h.defines;const T=n.context,P=n.renderPass==="shadow",k=n.renderPass==="light-beam",G=n.shadowRenderer,q=r.ec(n.transform.center.lat,n.transform.zoom),te=po(n,d.paint.get("building-cutoff-fade-range"));te.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF"));for(const Y of _){const re=a.getTile(Y),le=re.getBucket(d);if(!le)continue;G&&G.getMaxCascadeForTile(Y.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const ce=le.programConfigurations.get(d.id);let Pe,me,Me,Le=n.translatePosMatrix(Y.expandedProjMatrix,re,[0,0],"map");if(Le=r.cR(r.bC(),Le,[1,1,h.verticalScale]),P&&G){if(Vu(re.tileID,le.maxHeight*q,n))continue;let Ze=G.calculateShadowPassMatrixFromTile(re.tileID.toUnwrapped());Ze=r.cR(r.bC(),Ze,[1,1,h.verticalScale]),Me=$l(Ze),Pe=me=n.getOrCreateProgram("buildingDepth",{config:ce,defines:b,overrideFog:!1})}else if(k)Pe=me=n.getOrCreateProgram("buildingBloom",{config:ce,defines:b,overrideFog:!1}),Me=ug(Le);else{const Ze=n.transform.calculatePosMatrix(Y.toUnwrapped(),n.transform.worldSize);r.cR(Ze,Ze,[1,1,h.verticalScale]);const He=r.bC();r.cR(He,Ze,[1,-1,1/q]),r.bl(He,He),r.ed(He,He);const Ye=n.transform.getFreeCameraOptions().position,qe=1<<Y.canonical.z;Me=S_(Le,He,h.opacity,h.facadeAOIntensity,[((Ye.x-Y.wrap)*qe-Y.canonical.x)*r.al,(Ye.y*qe-Y.canonical.y)*r.al,Ye.z*qe*r.al],le.tileToMeter,h.facadeEmissiveChance),me=n.getOrCreateProgram("building",{config:ce,defines:b,overrideFog:!1});const We=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);Pe=n.getOrCreateProgram("building",{config:ce,defines:We,overrideFog:!1}),G&&(G.setupShadowsFromMatrix(Ze,me,!0),G.setupShadowsFromMatrix(Ze,Pe,!0))}const Fe=(Ze,He)=>{if(k){const Ye=Ze.entranceBloom;He.draw(n,T.gl.TRIANGLES,h.depthMode,sr.disabled,h.blendMode,er.disabled,Me,d.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segmentsBucket,d.paint,n.transform.zoom,ce,[Ye.layoutAttenuationBuffer,Ye.layoutColorBuffer])}else{const Ye=Ze.segmentsBucket;let qe=[Ze.layoutNormalBuffer,Ze.layoutCentroidBuffer,Ze.layoutColorBuffer];Ze.layoutFacadePaintBuffer&&(qe=qe.concat([Ze.layoutFacadeDataBuffer,Ze.layoutFacadeVerticalRangeBuffer,Ze.layoutFacadePaintBuffer])),He.draw(n,T.gl.TRIANGLES,h.depthMode,sr.disabled,h.blendMode,P?er.disabled:er.backCW,Me,d.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ye,d.paint,n.transform.zoom,ce,qe)}};n.uploadCommonUniforms(T,me,Y.toUnwrapped(),null,te),le.buildingWithoutFacade&&Fe(le.buildingWithoutFacade,me),Pe!==me&&n.uploadCommonUniforms(T,Pe,Y.toUnwrapped(),null,te),le.buildingWithFacade&&Fe(le.buildingWithFacade,Pe)}}function ip(h){return[h[0]*r.ee,h[1]*r.ee,h[2]*r.ee,0]}function op(h,n,a,d,_,b,T,P,k){const G=d.getSource(),q=a.globeSharedBuffers;if(!q)return;let te,Y,re;if(n&&(te=d.getTile(n)),G instanceof r.aS?(Y=G.texture,re=r.dG(0,0,a.transform)):te&&n&&(Y=te.texture,re=r.dG(n.canonical.z,n.canonical.x,a.transform)),!Y||!re)return;h||(re=r.cR(r.bC(),re,[1,-1,1]));const le=a.context,ce=le.gl,Pe=_.paint.get("raster-resampling")==="nearest"?ce.NEAREST:ce.LINEAR,me=a.colorModeForDrapableLayerRenderPass(b),Me=T.defines;Me.push("GLOBE_POLES");const Le=new Pn(ce.LEQUAL,Pn.ReadWrite,a.depthRangeFor3D),Fe=Float32Array.from(a.transform.expandedFarZProjMatrix),Ze=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),le.activeTexture.set(ce.TEXTURE0),Y.bind(Pe,ce.CLAMP_TO_EDGE),le.activeTexture.set(ce.TEXTURE1),Y.bind(Pe,ce.CLAMP_TO_EDGE),"useMipmap"in Y&&le.extTextureFilterAnisotropic&&a.transform.pitch>20&&ce.texParameterf(ce.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[He,Ye,qe,We]=n?q.getPoleBuffers(n.canonical.z,!1):q.getPoleBuffers(0,!0),Xe=_.paint.get("raster-elevation");let Tt;h?(Tt=He,a.renderDefaultNorthPole=Xe!==0):(Tt=Ye,a.renderDefaultSouthPole=Xe!==0);const ht=ip(T.mix),Lt=((Pt,nn,St,rt,zt,wt,Zt,sn,Sn,Ht,en,Nn,En)=>Kf(Pt,nn,St,new Float32Array(16),new Float32Array(9),[0,0],rt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},wt,[0,0],sn,2,Ht,en,Nn,1,0,En))(Fe,Ze,re,r.aj(a.transform.zoom),0,_,0,Xe,0,ht,T.offset,T.range,b),bt=a.getOrCreateProgram("raster",{defines:Me});a.uploadCommonUniforms(le,bt,null),bt.draw(a,ce.TRIANGLES,Le,k,me,P,Lt,_.id,Tt,qe,We)}function C_(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-n,_=.2*h.height,b=n+_;return[n,a,(b-_-n)/d,(b-n)/d]}function Hd(h,n,a,d){if(h)return n instanceof zl&&h instanceof bh?n.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:ip(d.mix),offset:d.offset,buffer:0,tileSize:1}}var E_=r.ef([{name:"a_index",type:"Int16",components:1}]);class A_{constructor(n,a,d,_){const b={width:d[0],height:d[1],data:null},T=n.gl;this.targetColorTexture=new r.T(n,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,b,T.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(a,_),this.lastInvalidatedAt=0}updateParticleTexture(n,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=a.width*a.height;this.particleTexture0=new r.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.eg;b.reserve(_);for(let T=0;T<_;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,E_.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ba(h,n,a){if(!h)return null;const d=n.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:_,mix:b,offset:T,tileSize:P,buffer:k,format:G}=d;if(!_||!G)return null;let q=!1;return G==="uint32"&&(q=!0,b[3]=0,b=Hl(r.eh,b,[0,a.paint.get("raster-particle-max-speed")]),T=qh(r.eh,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[k/(P+2*k),P/(P+2*k)],tileSize:P,scalarData:q,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function Uu(h){const n=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-n,_=.2*h.height,b=n+_;return[n,a,(b-_-n)/d,(b-n)/d]}const Qs=new r.ao(1,0,0,1),tu=new r.ao(0,1,0,1),dg=new r.ao(0,0,1,1),um=new r.ao(1,0,1,1),dm=new r.ao(0,1,1,1);function sp(h,n,a,d,_,b){for(let T=0;T<a.length;T++)if(_){const G=new r.ao(d.r*.8,d.g*.8,d.b*.8,1);ju(h,n,a[T],d,-1,-1,b),ju(h,n,a[T],d,-1,1,b),ju(h,n,a[T],d,1,1,b),ju(h,n,a[T],d,1,-1,b),ju(h,n,a[T],G,0,0,b)}else ju(h,n,a[T],d,0,0,b)}function ju(h,n,a,d,_,b,T){const P=h.context,k=h.transform,G=P.gl,q=k.projection.name==="globe",te=q?["PROJECTION_GLOBE_VIEW"]:[];let Y=r.bz(a.projMatrix);if(q&&r.aj(k.zoom)>0){const ht=r.bj(a.canonical,k),Lt=r.ei(ht);Y=r.aB(new Float32Array(16),k.globeMatrix,Lt),r.aB(Y,k.projMatrix,Y)}const re=r.bC();re[12]+=2*_/(r.o.devicePixelRatio*k.width),re[13]+=2*b/(r.o.devicePixelRatio*k.height),r.aB(Y,re,Y);const le=h.getOrCreateProgram("debug",{defines:te}),ce=n.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(ce,le);const Pe=Pn.disabled,me=sr.disabled,Me=h.colorModeForRenderPass(),Le="$debug";P.activeTexture.set(G.TEXTURE0),h.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),q?ce._makeGlobeTileDebugBuffers(h.context,k):ce._makeDebugTileBoundsBuffers(h.context,k.projection);const Fe=ce._tileDebugBuffer||h.debugBuffer,Ze=ce._tileDebugIndexBuffer||h.debugIndexBuffer,He=ce._tileDebugSegments||h.debugSegments;if(le.draw(h,G.LINE_STRIP,Pe,me,Me,er.disabled,Hh(Y,d.toPremultipliedRenderColor(null)),Le,Fe,Ze,He,null,null,null,[ce._globeTileDebugBorderBuffer]),T){const ht=ce.latestRawTileData,Lt=Math.floor((ht&&ht.byteLength||0)/1024);let bt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(bt+=` => ${a.overscaledZ}`),bt+=` ${ce.state}`,bt+=` ${Lt}kb`,(function(Pt,nn){Pt.initDebugOverlayCanvas();const St=Pt.debugOverlayCanvas,rt=Pt.context.gl,zt=Pt.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,St.width,St.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(nn,5,5),zt.strokeText(nn,5,5),Pt.debugOverlayTexture.update(St),Pt.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)})(h,bt)}const Ye=n.getTile(a).tileSize,qe=512/Math.min(Ye,512)*(a.overscaledZ/k.zoom)*.5,We=ce._tileDebugTextBuffer||h.debugBuffer,Xe=ce._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Tt=ce._tileDebugTextSegments||h.debugSegments;le.draw(h,G.TRIANGLES,Pe,me,br.alphaBlended,er.disabled,Hh(Y,r.ao.transparent.toPremultipliedRenderColor(null),qe),Le,We,Xe,Tt,null,null,null,[ce._globeTileDebugTextBuffer])}function Yl(h,n,a,d){Gu(h,0,n+a/2,h.transform.width,a,d)}function ki(h,n,a,d){Gu(h,n-a/2,0,a,h.transform.height,d)}function Gu(h,n,a,d,_,b){const T=h.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(n*r.o.devicePixelRatio,a*r.o.devicePixelRatio,d*r.o.devicePixelRatio,_*r.o.devicePixelRatio),T.clear({color:b}),P.disable(P.SCISSOR_TEST)}const hm=r.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:hg}=hm;function Xl(h,n,a,d){h.emplaceBack(n,a,d)}class fm{constructor(n){this.vertexArray=new r.ej,this.indices=new r.b1,Xl(this.vertexArray,-1,-1,1),Xl(this.vertexArray,1,-1,1),Xl(this.vertexArray,-1,1,1),Xl(this.vertexArray,1,1,1),Xl(this.vertexArray,-1,-1,-1),Xl(this.vertexArray,1,-1,-1),Xl(this.vertexArray,-1,1,-1),Xl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,hg),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function $u(h,n,a,d,_,b){const T=h.context.gl,P=n.paint.get("sky-atmosphere-color"),k=n.paint.get("sky-atmosphere-halo-color"),G=n.paint.get("sky-atmosphere-sun-intensity"),q=((te,Y,re,le,ce)=>({u_matrix_3f:te,u_sun_direction:Y,u_sun_intensity:re,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[ce.r,ce.g,ce.b,ce.a],u_luminance:5e-5}))(r.el(r.dL(),d),_,G,P.toPremultipliedRenderColor(null),k.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),a.draw(h,T.TRIANGLES,Pn.disabled,sr.disabled,br.unblended,er.frontCW,q,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Hu=r.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qu{constructor(n){const a=new r.em;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new r.b1;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,Hu.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ln=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wu{constructor(n){this.colorModeAlphaBlendedWriteRGB=new br([1,Xs,1,Xs],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new br([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new wn,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new qu(a);const d=this.params.sizeRange,_=this.params.intensityRange,b=(function(q){const te=r.eo(30),Y=[];for(let re=0;re<q;++re){const le=2*Math.PI*te(),ce=Math.acos(1-2*te())-.5*Math.PI;Y.push(r.d4(Math.cos(ce)*Math.cos(le),Math.cos(ce)*Math.sin(le),Math.sin(ce)))}return Y})(this.params.starsCount),T=r.eo(300),P=new r.en,k=new r.b1;let G=0;for(let q=0;q<b.length;++q){const te=r.c4([],b[q],200),Y=Math.max(0,1+.01*d*(1*T()-.5)),re=Math.max(0,1+.01*_*(1*T()-.5));P.emplaceBack(te[0],te[1],te[2],-1,-1,Y,re),P.emplaceBack(te[0],te[1],te[2],1,-1,Y,re),P.emplaceBack(te[0],te[1],te[2],1,1,Y,re),P.emplaceBack(te[0],te[1],te[2],-1,1,Y,re),k.emplaceBack(G+0,G+1,G+2),k.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=a.createVertexBuffer(P,ln.members),this.starsIdx=a.createIndexBuffer(k),this.starsSegments=r.bg.simpleSegment(0,0,P.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const d=n.context,_=d.gl,b=n.transform,T=new Pn(_.LEQUAL,Pn.ReadOnly,[0,1]),P=r.aj(b.zoom),k=n.style.getLut(a.scope),G=a.properties.get("color-use-theme")==="none",q=a.properties.get("color").toNonPremultipliedRenderColor(G?null:k),te=a.properties.get("high-color-use-theme")==="none",Y=a.properties.get("high-color").toNonPremultipliedRenderColor(te?null:k),re=a.properties.get("space-color-use-theme")==="none",le=a.properties.get("space-color").toNonPremultipliedRenderColor(re?null:k),ce=5e-4,Pe=r.ep(a.properties.get("horizon-blend"),0,1,ce,.25),me=r.dA(n,d,b)&&Pe===ce?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Me=n.frameCounter/1e3%1,Le=r.ag(b.globeCenterInViewSpace),Fe=Math.sqrt(Math.pow(Le,2)-Math.pow(me,2)),Ze=Math.acos(Fe/Le),He=Ye=>{const qe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ye&&qe.push("ALPHA_PASS");const We=n.getOrCreateProgram("globeAtmosphere",{defines:qe}),Xe=((ht,Lt,bt,Pt,nn,St,rt,zt,wt,Zt,sn,Sn)=>({u_frustum_tl:ht,u_frustum_tr:Lt,u_frustum_br:bt,u_frustum_bl:Pt,u_horizon:nn,u_transition:St,u_fadeout_range:rt,u_atmosphere_fog_color:zt.toArray01(),u_high_color:wt.toArray01(),u_space_color:Zt.toArray01(),u_temporal_offset:sn,u_horizon_angle:Sn}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,P,Pe,q,Y,le,Me,Ze);n.uploadCommonUniforms(d,We);const Tt=this.atmosphereBuffer;Tt&&We.draw(n,_.TRIANGLES,T,sr.disabled,Ye?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,er.backCW,Xe,Ye?"atmosphere_glow_alpha":"atmosphere_glow",Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)};He(!1),He(!0)}drawStars(n,a){const d=r.aA(a.properties.get("star-intensity"),0,1);if(d===0)return;const _=n.context,b=_.gl,T=n.transform,P=n.getOrCreateProgram("stars"),k=r.c6([]);r.c8(k,k,-T._pitch),r.c7(k,k,-T.angle),r.c8(k,k,r.an(T._center.lat)),r.eq(k,k,-r.an(T._center.lng));const G=r.cb(new Float32Array(16),k),q=r.aB([],T.starsProjMatrix,G),te=r.el([],G),Y=r.er([],te),re=[0,1,0];r.dN(re,re,Y),r.c4(re,re,this.params.sizeMultiplier);const le=[1,0,0];r.dN(le,le,Y),r.c4(le,le,this.params.sizeMultiplier);const ce=(Pe=re,me=le,Me=d,{u_matrix:Float32Array.from(q),u_up:Pe,u_right:me,u_intensity_multiplier:Me});var Pe,me,Me;n.uploadCommonUniforms(_,P),this.starsVx&&this.starsIdx&&P.draw(n,b.TRIANGLES,Pn.disabled,sr.disabled,this.colorModeAlphaBlendedWriteRGB,er.disabled,ce,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class oo{constructor(){this.visibleTiles=[]}updateBorders(n,a){const d=[],_=[],b=n._getRenderableCoordinates(!1,!0);for(const k of b){const G=n.getTile(k);if(!G.hasData())continue;const q=G.getBucket(a);q&&(q.isEmpty()||(d.push(k.key),_.push({bucket:q,tileID:k.canonical})))}let T=d.length!==this.visibleTiles.length;if(!T){d.sort();for(let k=0;k<d.length;k++)if(d[k]!==this.visibleTiles[k]){T=!0;break}}if(!T)return;const P=new Set;this.visibleTiles=d,_.sort(((k,G)=>k.tileID.z-G.tileID.z||k.tileID.x-G.tileID.x||k.tileID.y-G.tileID.y));for(const k of _){const G=new Array,q=new Array,te=k.bucket;for(const Y of te.featuresOnBorder)P.has(Y.featureId)?q.push(Y.footprintIndex):(P.add(Y.featureId),G.push(Y.footprintIndex));te.updateFootprintHiddenFlags(G,r.es,!1),te.updateFootprintHiddenFlags(q,r.es,!0)}}}function yt(h,n){const a=[...h],d=n.cameraWorldSizeForFog/n.worldSize,_=r.bA([]);return r.cR(_,_,[d,d,1]),r.aB(a,_,a),r.aB(a,n.worldToFogMatrix,a),a}function Yh(h,n,a,d,_){const b=a.material,T=d.context,{baseColorTexture:P,metallicRoughnessTexture:k}=b.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:q,emissionTexture:te}=b;function Y(le,ce,Pe){if(le&&(h.push(ce),T.activeTexture.set(T.gl.TEXTURE0+Pe),le.gfxTexture)){const{minFilter:me,magFilter:Me,wrapS:Le,wrapT:Fe}=le.sampler;le.gfxTexture.bindExtraParam(me,Me,Le,Fe)}}Y(P,"HAS_TEXTURE_u_baseColorTexture",vo.BaseColor),Y(k,"HAS_TEXTURE_u_metallicRoughnessTexture",vo.MetallicRoughness),Y(G,"HAS_TEXTURE_u_normalTexture",vo.Normal),Y(q,"HAS_TEXTURE_u_occlusionTexture",vo.Occlusion),Y(te,"HAS_TEXTURE_u_emissionTexture",vo.Emission),_&&(_.texture||(_.texture=new r.dY(d.context,_.image,[_.image.height,_.image.height,_.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+vo.LUT),_.texture&&_.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||h.push("DIFFUSE_SHADED");const re=d.shadowRenderer;re&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&h.push("NORMAL_OFFSET"))}function nu(h,n,a,d,_,b){const T=a.paint.get("model-opacity").constantOr(1),P=n.context,k=new Pn(n.context.gl.LEQUAL,Pn.ReadWrite,n.depthRangeFor3D),G=n.transform,q=h.mesh,te=q.material,Y=te.pbrMetallicRoughness,re=n.style.fog;let le;le=n.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:r.aB([],d.zScaleMatrix,h.nodeModelMatrix),r.aB(le,d.negCameraPosMatrix,le);const ce=r.bl([],le);r.ed(ce,ce);const Pe=a.paint.get("model-color-use-theme").constantOr("default")==="none",me=a.paint.get("model-emissive-strength").constantOr(0),Me=tp(new Float32Array(h.worldViewProjection),new Float32Array(le),new Float32Array(ce),null,n,T,Y.baseColorFactor,te.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,te,me,a),Le={defines:[]},Fe=[],Ze=n.shadowRenderer;Ze&&(Ze.useNormalOffset=!1),Yh(Le.defines,Fe,q,n,Pe?null:a.lut);let He=null;if(re){const We=yt(h.nodeModelMatrix,n.transform);if(He=new Float32Array(We),G.projection.name!=="globe"){const Xe=q.aabb.min,Tt=q.aabb.max,[ht,Lt]=re.getOpacityForBounds(We,Xe[0],Xe[1],Tt[0],Tt[1]);Le.overrideFog=ht>=qn||Lt>=qn}}const Ye=po(n,a.paint.get("model-cutoff-fade-range"));Ye.shouldRenderCutoff&&Le.defines.push("RENDER_CUTOFF");const qe=n.getOrCreateProgram("model",Le);n.uploadCommonUniforms(P,qe,null,He,Ye),n.renderPass!=="shadow"&&Ze&&Ze.setupShadowsFromMatrix(h.nodeModelMatrix,qe),qe.draw(n,P.gl.TRIANGLES,k,_,b,q.material.doubleSided?er.disabled:er.backCCW,Me,a.id,q.vertexBuffer,q.indexBuffer,q.segments,a.paint,n.transform.zoom,void 0,Fe)}function Xh(h,n,a,d,_,b,T){let P;P=h.projection.name==="globe"?r.eu(a,h):[...a],r.aB(P,P,n.matrix);const k=r.aB([],d,P);if(n.meshes)for(const G of n.meshes){if(G.material.alphaMode!=="BLEND"){T.push({mesh:G,depth:0,modelIndex:_,worldViewProjection:k,nodeModelMatrix:P});continue}const q=r.af([],G.centroid,k);!h.isOrthographic&&q[2]<=0||b.push({mesh:G,depth:q[2],modelIndex:_,worldViewProjection:k,nodeModelMatrix:P})}if(n.children)for(const G of n.children)Xh(h,G,a,d,_,b,T)}function Zu(h,n,a,d){const _=a.shadowRenderer;if(!_)return;const b=_.getShadowPassDepthMode(),T=_.getShadowPassColorMode(),P=_.calculateShadowPassMatrixFromMatrix(n),k=Gd(P);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,sr.disabled,T,er.backCCW,k,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function ap(h,n,a){const d=n.updateZoomBasedPaintProperties(),_=(function(b,T,P){let k,G,q,te=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&te>0){const Y=b.terrain,re=Y.findDEMTileFor(P);re&&re.dem?k=r.ew.create(Y,P,re):te=0}if(te===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),te===T.validForExaggeration&&(te===0||k&&k._demTile&&k._demTile.tileID===T.validForDEMTile.id&&k._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const Y in T.instancesPerModel){const re=T.instancesPerModel[Y];for(let le=0;le<re.instancedDataArray.length;++le){const ce=(k?te*k.getElevationAt(0|re.instancedDataArray.float32[16*le],0|re.instancedDataArray.float32[16*le+1],!0,!0):0)+re.instancesEvaluatedElevation[le];re.instancedDataArray.float32[16*le+6]=ce,G=G?Math.min(T.terrainElevationMin,ce):ce,q=q?Math.max(T.terrainElevationMax,ce):ce}}return T.terrainElevationMin=G||0,T.terrainElevationMax=q||0,T.validForExaggeration=te,T.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0})(h,n,a);(d||_)&&(n.uploaded=!1,n.upload(h.context))}const wl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function qd(h,n){const a=1<<h.canonical.z,d=n.getFreeCameraOptions().position,_=n.elevation,b=h.canonical.x/a,T=(h.canonical.x+1)/a,P=h.canonical.y/a,k=(h.canonical.y+1)/a;let G=n._centerAltitude;if(_){const re=_.getMinMaxForTile(h);re&&re.max>G&&(G=re.max)}const q=r.aA(d.x,b,T)-d.x,te=r.aA(d.y,P,k)-d.y,Y=r.ce(G,n.center.lat)-d.z;return n._zoomFromMercatorZ(Math.sqrt(q*q+te*te+Y*Y))}function fg(h,n,a,d,_,b,T){const P=h.context,k=h.renderPass==="shadow",G=h.shadowRenderer,q=k&&G?G.getShadowPassDepthMode():new Pn(P.gl.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D),te=h.isTileAffectedByFog(b);if(a.meshes)for(const Y of a.meshes){const re=["MODEL_POSITION_ON_GPU"],le=[];let ce,Pe,me;d.instancedDataArray.length>20&&re.push("INSTANCED_ARRAYS");const Me=po(h,n.paint.get("model-cutoff-fade-range"));if(Me.shouldRenderCutoff&&re.push("RENDER_CUTOFF"),k&&G)ce=h.getOrCreateProgram("modelDepth",{defines:re}),Pe=Gd(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.matrix)),me=G.getShadowPassColorMode();else{Yh(re,le,Y,h,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),ce=h.getOrCreateProgram("model",{defines:re,overrideFog:te});const Fe=Y.material,Ze=Fe.pbrMetallicRoughness,He=n.paint.get("model-opacity").constantOr(1),Ye=n.paint.get("model-emissive-strength").constantOr(0);Pe=tp(b.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,h,He,Ze.baseColorFactor,Fe.emissiveFactor,Ze.metallicFactor,Ze.roughnessFactor,Fe,Ye,n,_),G&&(T.shadowUniformsInitialized?ce.setShadowUniformValues(P,G.getShadowUniformValues()):(G.setupShadows(b.toUnwrapped(),ce,"model-tile"),T.shadowUniformsInitialized=!0)),me=Me.shouldRenderCutoff||He<1||Fe.alphaMode!=="OPAQUE"?br.alphaBlended:br.unblended}h.uploadCommonUniforms(P,ce,b.toUnwrapped(),null,Me);const Le=Y.material.doubleSided?er.disabled:er.backCCW;if(d.instancedDataArray.length>20)le.push(d.instancedDataBuffer),ce.draw(h,P.gl.TRIANGLES,q,sr.disabled,me,Le,Pe,n.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,n.paint,h.transform.zoom,void 0,le,d.instancedDataArray.length);else{const Fe=k?"u_instance":"u_normal_matrix";for(let Ze=0;Ze<d.instancedDataArray.length;++Ze)Pe[Fe]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ze,16),ce.draw(h,P.gl.TRIANGLES,q,sr.disabled,me,Le,Pe,n.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,n.paint,h.transform.zoom,void 0,le)}}if(a.children)for(const Y of a.children)fg(h,n,Y,d,_,b,T)}const P_=[1,-1,1];function pm(h,n,a,d){if(!a.modelManager)return!0;const _=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,T=n.aabb;let P=!0,k=h.maxHeight;if(k===0){let q=0;for(const te in h.instancesPerModel){const Y=_.getModel(te,d);Y?q=Math.max(q,Math.max(Math.max(Y.aabb.max[0],Y.aabb.max[1]),Y.aabb.max[2])):P=!1}k=h.maxScale*q*1.41+h.maxVerticalOffset,P&&(h.maxHeight=k)}T.max[2]=k,T.min[2]+=h.terrainElevationMin,T.max[2]+=h.terrainElevationMax,r.af(T.min,T.min,n.tileMatrix),r.af(T.max,T.max,n.tileMatrix);const G=T.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=G===2),G===0}function lp(h,n){const a=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],_=h.uniformValues.u_cutoff_params[2],b=h.uniformValues.u_cutoff_params[3];return d===a||b===_?1:r.aA(((n-a)/(d-a)-_)/(b-_),0,1)}function mm(h,n,a,d){if(n.pitch<20)return 1;const _=n.getWorldToCameraMatrix();r.aB(_,_,h);const b=r.bU(a.min[0],a.min[1],a.min[2],1);let T=r.aC(r.ex(),b,_),P=T,k=T;b[1]=a.max[1],T=r.aC(r.ex(),b,_),P=T[1]<P[1]?T:P,k=T[1]>k[1]?T:k,b[0]=a.max[0],T=r.aC(r.ex(),b,_),P=T[1]<P[1]?T:P,k=T[1]>k[1]?T:k,b[1]=a.min[1],T=r.aC(r.ex(),b,_),P=T[1]<P[1]?T:P,k=T[1]>k[1]?T:k;const G=r.aA(d[0],0,1),q=100*n.pixelsPerMeter*r.aA(d[1],0,1),te=r.aA(d[2],0,1),Y=r.ey(r.ex(),P,k,G),re=Math.tan(.5*n.fovX),le=-Y[2]*re;if(q===0)return Y[1]<-Math.abs(le)?te:1;const ce=(-Math.abs(le)-Y[1])/q,Pe=(Me,Le,Fe)=>(1-Fe)*Me+Fe*Le,me=r.aA(Pe(1,te,ce),te,1);return Pe(1,me,r.aA((n.pitch-20)/20,0,1))}class pg{}class mg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,d){{const te=this._storage.get(a.id);if(te)return te.lastUsedFrameIdx=n,te.buf}const _=d.gl,b=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),T=new ArrayBuffer(b),P=new Int16Array(T);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const k=new r.eA;for(let te=0;te<b/2;te+=3){const Y=P[te],re=P[te+1],le=P[te+2];k.emplaceBack(Y,re),k.emplaceBack(re,le),k.emplaceBack(le,Y)}const G=d.bindVertexArrayOES.current,q=new pg;return q.buf=new ql(d,k),q.lastUsedFrameIdx=n,this._storage.set(a.id,q),d.bindVertexArrayOES.set(G),q.buf}update(n){for(const[a,d]of this._storage)n-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class cp{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Kh=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Wd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gm{constructor(n,a){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const gg=r.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class M_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,a){const d=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.eB,P=new r.b1;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(T,gg.members),this.vignetteIdx=n.context.createIndexBuffer(P)}const _=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,d);const T={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(n,n.context.gl.TRIANGLES,Pn.disabled,sr.disabled,br.alphaBlended,er.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,_)}var b}}class _g{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,a){const d=n.getFreeCameraOptions().position,_=d.toAltitude(),b=d.toLngLat(),T=r.an(b.lng),P=r.an(b.lat),k=n.pixelsPerMeter/a,G=T*r.eD,q=r.eD*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const te=-this._offsetYPrev+q,Y=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*k,this._accumulatedOffsetY+=te*k,this._accumulatedElevation+=Y*k,this._offsetXPrev=G,this._offsetYPrev=q,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function yg(h,n){return[-(h[0]-Math.floor(h[0]/n)*n),-(h[1]-Math.floor(h[1]/n)*n),-(h[2]-Math.floor(h[2]/n)*n)]}function Ds(h){const n=r.eo(1323123451230),a=[];for(let d=0;d<h;++d){const _=2*n()-1,b=2*n()-1,T=2*n()-1;a.push(r.d4(_,b,T))}return a}function ru(h,n,a,d,_){const b=r.aA((_-a)/(d-a),0,1);return(1-b)*h+b*n}class Zd{constructor(n){this._movement=new _g,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new M_,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,a){const d=n.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,b=r.c6([]);r.c8(b,b,r.an(90)-d._pitch),r.c7(b,b,-d.angle);const T=r.cb(new Float32Array(16),b),P=r.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),k=r.ed([],P),G=r.aB([],k,T),q=Date.now()/1e3;return this._accumulatedTimeFromStart+=(q-this._prevTime)*a,this._prevTime=q,{projectionMatrix:_,modelviewMatrix:G}}}class Fi extends Zd{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gm(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const d=Ds(this.particlesCount),_=new r.eE,b=new r.b1;let T=0;const P=r.eo(1323123451230);for(let k=0;k<d.length;++k){const G=d[k],q=[2*P()-1,P(),P(),P()];_.emplaceBack(G[0],G[1],G[2],-1,-1,...q),_.emplaceBack(G[0],G[1],G[2],1,-1,...q),_.emplaceBack(G[0],G[1],G[2],1,1,...q),_.emplaceBack(G[0],G[1],G[2],-1,1,...q),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(_,Kh.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=n.transform.zoom;if(a.revealStart>d)return;const _=ru(0,1,a.revealStart,a.revealStart+a.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.aw(T,T);const P=structuredClone(this._vignetteParams);P.strength*=_,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),T=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(n.style.rain.state.vignetteColor));const k=this.updateOnRender(n,b.timeFactor),G=n.context,q=G.gl,te=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new r.T(G,{width:n.width,height:n.height,data:null},q.RGBA8)),b.distortionStrength>0&&(G.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),q.copyTexSubImage2D(q.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const Y=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(G,Y),G.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const re=[b.color.r,b.color.g,b.color.b,b.color.a],le=(ce,Pe)=>{const me=yg(this._movement.getPosition(),ce),Me=b.dropletSizeX,Le=b.dropletSizeX*b.dropletSizeYScale,Fe=n.width/2,Ze=n.height/2,He=ru(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ye=ru(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),qe=ru(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),We=(Xe={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ce,rainDropletSize:[Me,Le],distortionStrength:b.distortionStrength,rainDirection:T,color:re,screenSize:[te.width,te.height],thinningCenterPos:[Fe,Ze],thinningShape:[He,Ye,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:qe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:Pe?0:1},{u_modelview:Float32Array.from(Xe.modelview),u_projection:Float32Array.from(Xe.projection),u_time:Xe.time,u_cam_pos:Xe.camPos,u_texScreen:0,u_velocityConeAperture:Xe.velocityConeAperture,u_velocity:Xe.velocity,u_boxSize:Xe.boxSize,u_rainDropletSize:Xe.rainDropletSize,u_distortionStrength:Xe.distortionStrength,u_rainDirection:Xe.rainDirection,u_color:Xe.color,u_screenSize:Xe.screenSize,u_thinningCenterPos:Xe.thinningCenterPos,u_thinningShape:Xe.thinningShape,u_thinningAffectedRatio:Xe.thinningAffectedRatio,u_thinningParticleOffset:Xe.thinningParticleOffset,u_shapeDirectionalPower:Xe.shapeDirectionalPower,u_shapeNormalPower:Xe.shapeNormalPower,u_mode:Xe.mode});var Xe;const Tt=Math.round(b.intensity*this.particlesCount),ht=r.bg.simpleSegment(0,0,4*Tt,2*Tt);Y.draw(n,q.TRIANGLES,Pn.disabled,sr.disabled,br.alphaBlended,er.disabled,We,"rain_particles",this.particlesVx,this.particlesIdx,ht)};b.distortionStrength>0&&le(b.boxSize,!0),le(b.boxSize,!1),this._vignette.draw(n,P)}}const jr=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class vg extends Zd{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gm(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const d=Ds(this.particlesCount),_=new r.eF,b=new r.b1;let T=0;const P=r.eo(1323123451230);for(let k=0;k<d.length;++k){const G=d[k],q=P(),te=P(),Y=P(),re=[k/d.length,q,te,Y],le=[P(),P()];_.emplaceBack(G[0],G[1],G[2],-1,-1,...re,...le),_.emplaceBack(G[0],G[1],G[2],1,-1,...re,...le),_.emplaceBack(G[0],G[1],G[2],1,1,...re,...le),_.emplaceBack(G[0],G[1],G[2],-1,1,...re,...le),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(_,jr.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const a=structuredClone(this._params);let d=[-a.direction.x,a.direction.y,-100];r.aw(d,d);const _=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=n.transform.zoom;if(b.revealStart>T)return;const P=ru(0,1,b.revealStart,b.revealStart+b.revealRange,T);_.strength*=P,a.overrideStyleParameters||(a.intensity=n.style.snow.state.density,a.timeFactor=n.style.snow.state.intensity,a.color=structuredClone(n.style.snow.state.color),d=structuredClone(n.style.snow.state.direction),a.screenThinning.intensity=n.style.snow.state.centerThinning,a.billboardSize=2.79*n.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(n.style.snow.state.vignetteColor));const k=this.updateOnRender(n,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=n.context,q=G.gl,te=n.transform,Y=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(G,Y),((re,le,ce)=>{const Pe=yg(this._movement.getPosition(),re),me=te.width/2,Me=te.height/2,Le=ru(0,ce.screenThinning.start,0,1,ce.screenThinning.intensity),Fe=ru(.001,ce.screenThinning.range,0,1,ce.screenThinning.intensity),Ze=ru(0,ce.screenThinning.particleOffset,0,1,ce.screenThinning.intensity),He=(Ye={modelview:k.modelviewMatrix,projection:k.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Pe,velocityConeAperture:ce.velocityConeAperture,velocity:ce.velocity,horizontalOscillationRadius:ce.horizontalOscillationRadius,horizontalOscillationRate:ce.horizontalOscillationRate,boxSize:re,billboardSize:1*ce.billboardSize,simpleShapeParameters:[ce.shapeFadeStart,ce.shapeFadePower],screenSize:[te.width,te.height],thinningCenterPos:[me,Me],thinningShape:[Le,Fe,Math.pow(10,ce.screenThinning.fadePower)],thinningAffectedRatio:ce.screenThinning.affectedRatio,thinningParticleOffset:Ze,color:[ce.color.r,ce.color.g,ce.color.b,ce.color.a],direction:d},{u_modelview:Float32Array.from(Ye.modelview),u_projection:Float32Array.from(Ye.projection),u_time:Ye.time,u_cam_pos:Ye.camPos,u_velocityConeAperture:Ye.velocityConeAperture,u_velocity:Ye.velocity,u_horizontalOscillationRadius:Ye.horizontalOscillationRadius,u_horizontalOscillationRate:Ye.horizontalOscillationRate,u_boxSize:Ye.boxSize,u_billboardSize:Ye.billboardSize,u_simpleShapeParameters:Ye.simpleShapeParameters,u_screenSize:Ye.screenSize,u_thinningCenterPos:Ye.thinningCenterPos,u_thinningShape:Ye.thinningShape,u_thinningAffectedRatio:Ye.thinningAffectedRatio,u_thinningParticleOffset:Ye.thinningParticleOffset,u_particleColor:Ye.color,u_direction:Ye.direction});var Ye;const qe=Math.round(ce.intensity*this.particlesCount),We=r.bg.simpleSegment(0,0,4*qe,2*qe);this.particlesVx&&this.particlesIdx&&Y.draw(n,q.TRIANGLES,Pn.disabled,sr.disabled,br.alphaBlended,er.disabled,He,"snow_particles",this.particlesVx,this.particlesIdx,We)})(a.boxSize,0,a),this._vignette.draw(n,_)}}const iu={symbol:function(h,n,a,d,_){if(h.renderPass!=="translucent")return;const b=sr.disabled,T=h.colorModeForRenderPass(),P=a.layout.get("text-variable-anchor"),k=a.layout.get("text-size-scale-range"),G=r.aA(h.scaleFactor,k[0],k[1]);P&&(function(Y,re,le,ce,Pe,me,Me,Le){const Fe=re.transform,Ze=Pe==="map",He=me==="map";for(const Ye of Y){const qe=ce.getTile(Ye),We=qe.getBucket(le);if(!We||!We.text||!We.text.segments.get().length)continue;const Xe=r.bK(We.textSizeData,Fe.zoom,Le),Tt=mc(Ye,We.getProjection(),Fe),ht=Fe.calculatePixelsToTileUnitsMatrix(qe),Lt=Ga(Tt,qe.tileID.canonical,He,Ze,Fe,We.getProjection(),ht),bt=We.hasIconTextFit()&&We.hasIconData();Xe&&pa(We,Ze,He,Me,Fe,Lt,Ye,Math.pow(2,Fe.zoom-qe.tileID.overscaledZ),Xe,bt)}})(d,h,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_,G);const q=a.paint.get("icon-opacity").constantOr(1)!==0,te=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(q||te)?Zh(h,n,a,d,b,T):(q&&Zh(h,n,a,d,b,T,{onlyIcons:!0}),te&&Zh(h,n,a,d,b,T,{onlyText:!0})),n.map.showCollisionBoxes&&(xl(h,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),xl(h,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,a,d){if(h.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),P=a.layout.get("circle-sort-key").constantOr(1)!==void 0,k=a.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const G=h.context,q=G.gl,te=h.transform,Y=!(!h.terrain||!h.terrain.enabled),re=a.layout.get("circle-elevation-reference"),le=h.depthModeForSublayer(0,Pn.ReadOnly),ce=new Pn(h.context.gl.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D),Pe=re==="none"||Y?le:ce,me=sr.disabled,Me=h.colorModeForDrapableLayerRenderPass(k),Le=te.projection.name==="globe",Fe=[r.aF(te.center.lng),r.aJ(te.center.lat)],Ze=[];for(let Ye=0;Ye<d.length;Ye++){const qe=d[Ye],We=n.getTile(qe),Xe=We.getBucket(a);if(!Xe||Xe.projection.name!==te.projection.name)continue;const Tt=Xe.programConfigurations.get(a.id),ht=Xe.layoutVertexBuffer,Lt=Xe.globeExtVertexBuffer,bt=Xe.indexBuffer,Pt=r.dZ(a),nn=[Lt],St=h.isTileAffectedByFog(qe);Le&&Pt.push("PROJECTION_GLOBE_VIEW"),Pt.push("DEPTH_D24"),h.terrain&&te.depthOcclusionForSymbolsAndCircles&&Pt.push("DEPTH_OCCLUSION"),Xe.hasElevation&&!h.terrain&&(Pt.push("ELEVATED_ROADS"),nn.push(Xe.elevatedLayoutVertexBuffer));const rt=h.getOrCreateProgram("circle",{config:Tt,defines:Pt,overrideFog:St}),zt=te.projection.createInversionMatrix(te,qe.canonical),wt={programConfiguration:Tt,program:rt,layoutVertexBuffer:ht,dynamicBuffers:nn,indexBuffer:bt,uniformValues:r.d_(h,qe,We,zt,Fe,a),tile:We};if(P){const Zt=Xe.segments.get();for(const sn of Zt)Ze.push({segments:new r.bg([sn]),sortKey:sn.sortKey,state:wt})}else Ze.push({segments:Xe.segments,sortKey:0,state:wt})}P&&Ze.sort(((Ye,qe)=>Ye.sortKey-qe.sortKey));const He={useDepthForOcclusion:te.depthOcclusionForSymbolsAndCircles};for(const Ye of Ze){const{programConfiguration:qe,program:We,layoutVertexBuffer:Xe,dynamicBuffers:Tt,indexBuffer:ht,uniformValues:Lt,tile:bt}=Ye.state,Pt=Ye.segments;h.terrain&&h.terrain.setupElevationDraw(bt,We,He),h.uploadCommonUniforms(G,We,bt.tileID.toUnwrapped()),We.draw(h,q.TRIANGLES,Pe,me,Me,er.disabled,Lt,a.id,Xe,ht,Pt,a.paint,te.zoom,qe,Tt)}},heatmap:function(h,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,b=_.gl,T=sr.disabled,P=new br([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(re,le,ce,Pe){const me=re.gl,Me=le.width*Pe,Le=le.height*Pe;re.activeTexture.set(me.TEXTURE1),re.viewport.set([0,0,Me,Le]);let Fe=ce.heatmapFbo;if(!Fe||Fe&&(Fe.width!==Me||Fe.height!==Le)){Fe&&Fe.destroy();const Ze=me.createTexture();me.bindTexture(me.TEXTURE_2D,Ze),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Fe=ce.heatmapFbo=re.createFramebuffer(Me,Le,!0,null),(function(He,Ye,qe,We,Xe,Tt){const ht=He.gl;ht.texImage2D(ht.TEXTURE_2D,0,He.extRenderToTextureHalfFloat?ht.RGBA16F:ht.RGBA,Xe,Tt,0,ht.RGBA,He.extRenderToTextureHalfFloat?ht.HALF_FLOAT:ht.UNSIGNED_BYTE,null),We.colorAttachment.set(qe)})(re,0,Ze,Fe,Me,Le)}else me.bindTexture(me.TEXTURE_2D,Fe.colorAttachment.get()),re.bindFramebuffer.set(Fe.framebuffer)})(_,h,a,h.transform.projection.name==="globe"?.5:.25),_.clear({color:r.ao.transparent});const k=h.transform,G=k.projection.name==="globe",q=G?["PROJECTION_GLOBE_VIEW"]:[],te=G?er.frontCCW:er.disabled,Y=[r.aF(k.center.lng),r.aJ(k.center.lat)];for(let re=0;re<d.length;re++){const le=d[re];if(n.hasRenderableParent(le))continue;const ce=n.getTile(le),Pe=ce.getBucket(a);if(!Pe||Pe.projection.name!==k.projection.name)continue;const me=h.isTileAffectedByFog(le),Me=Pe.programConfigurations.get(a.id),Le=h.getOrCreateProgram("heatmap",{config:Me,defines:q,overrideFog:me}),{zoom:Fe}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ce,Le),h.uploadCommonUniforms(_,Le,le.toUnwrapped());const Ze=k.projection.createInversionMatrix(k,le.canonical);Le.draw(h,b.TRIANGLES,Pn.disabled,T,P,te,Xf(h,le,ce,Ze,Y,Fe,a.paint.get("heatmap-intensity")),a.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,a.paint,h.transform.zoom,Me,G?[Pe.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),(function(_,b){const T=_.context,P=T.gl,k=b.heatmapFbo;if(!k)return;T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,k.colorAttachment.get()),T.activeTexture.set(P.TEXTURE1);let G=b.colorRampTexture;G||(G=b.colorRampTexture=new r.T(T,b.colorRamp,P.RGBA8)),G.bind(P.LINEAR,P.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,P.TRIANGLES,Pn.disabled,sr.disabled,_.colorModeForRenderPass(),er.disabled,((q,te,Y,re)=>({u_image:0,u_color_ramp:1,u_opacity:te.paint.get("heatmap-opacity")}))(0,b),b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)})(h,a))},line:function(h,n,a,d){if(h.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(_.constantOr(1)===0||b.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),P=a.paint.get("line-occlusion-opacity"),k=a.layout.get("line-elevation-reference"),G=a.layout.get("line-width-unit")==="meters",q=k==="sea",te=!(!h.terrain||!h.terrain.enabled),Y=h.context,re=Y.gl;if(a.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const le=a.layout.get("line-cross-slope"),ce=le!==void 0,Pe=le<1,me=h.colorModeForDrapableLayerRenderPass(T),Me=h.terrain&&h.terrain.renderingToTexture,Le=Me?1:r.o.devicePixelRatio,Fe=a.paint.get("line-dasharray"),Ze=Fe.constantOr(1),He=a.layout.get("line-cap"),Ye=Fe.constantOr(null),qe=He.constantOr(null),We=a.paint.get("line-pattern"),Xe=We.constantOr(1),Tt=a.paint.get("line-pattern-cross-fade"),ht=We.constantOr(null),Lt=a.paint.get("line-opacity").constantOr(1);let bt=!Xe&&Lt!==1||h.depthOcclusion&&P>0&&P<1;const Pt=a.paint.get("line-gradient"),nn=Xe?"linePattern":"line",St=r.d$(a);let rt;if(Me&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(bt=!1),P!==0&&h.depthOcclusion){const sn=a.paint._values["line-opacity"];sn&&sn.value&&sn.value.kind==="constant"?rt=sn.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&St.push("VARIABLE_LINE_WIDTH");const zt=(sn,Sn,Ht,en,Nn,En)=>{for(const Gn of sn){const Vn=n.getTile(Gn);if(Xe&&!Vn.patternsLoaded())continue;const Kn=Vn.getBucket(a);if(!Kn||Kn.elevationType!=="none"&&!Nn||Kn.elevationType==="none"&&Nn)continue;h.prepareDrawTile();const ir=[...Sn],dr=h.shadowRenderer,qr=Kn.elevationType==="road"&&!!dr&&dr.enabled;let hr=[0,0,0];if(qr){const Zn=h.style.directionalLight,Fn=h.style.ambientLight;Zn&&Fn&&(hr=Ha(h.style,Zn,Fn)),ir.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ri=Kn.programConfigurations.get(a.id);let si=!1;if(ht&&Vn.imageAtlas){const Zn=r.e0.from(ht),Fn=Zn.getPrimary().scaleSelf(Le).toString(),Gr=Vn.imageAtlas.patternPositions.get(Fn),Oi=Zn.getSecondary(),Ii=Oi?Vn.imageAtlas.patternPositions.get(Oi.scaleSelf(Le).toString()):null;si=!!Gr&&!!Ii,Gr&&ri.setConstantPatternPositions(Gr,Ii)}Tt>0&&(si||ri.getPatternTransitionVertexBuffer("line-pattern"))&&ir.push("LINE_PATTERN_TRANSITION");const Mi=h.isTileAffectedByFog(Gn),yr=h.getOrCreateProgram(nn,{config:ri,defines:ir,overrideFog:Mi});if(!Xe&&Ye&&qe&&Vn.lineAtlas){const Zn=Vn.lineAtlas.getDash(Ye,qe);Zn&&ri.setConstantPatternPositions(Zn)}qr&&dr.setupShadows(Vn.tileID.toUnwrapped(),yr,"vector-tile");let[Qr,Xr]=a.paint.get("line-trim-offset");(qe==="round"||qe==="square")&&Qr!==Xr&&(Qr===0&&(Qr-=1),Xr===1&&(Xr+=1));const ei=Me?Gn.projMatrix:null,$i=G?1/Kn.tileToMeter/r.ay(Vn,1,h.transform.zoom):1,Dr=G?1/Kn.tileToMeter/r.ay(Vn,1,Math.floor(h.transform.zoom)):1,hi=Xe?r.e1(h,Vn,a,ei,Le,$i,Dr,[Qr,Xr],hr,Tt):r.e2(h,Vn,a,ei,Kn.lineClipsArray.length,Le,$i,Dr,[Qr,Xr],hr);if(Pt){const Zn=Kn.gradients[a.id];let Fn=Zn.texture;if(a.gradientVersion!==Zn.version){let Gr=256;if(a.stepInterpolant){const Oi=n.getSource().maxzoom,Ii=Gn.canonical.z===Oi?Math.ceil(1<<h.transform.maxZoom-Gn.canonical.z):1;Gr=r.aA(r.e3(Kn.maxLineLength/r.al*1024*Ii),256,Y.maxTextureSize)}Zn.gradient=r.e4({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Gr,image:Zn.gradient||void 0,clips:Kn.lineClipsArray}),Zn.texture?Zn.texture.update(Zn.gradient):Zn.texture=new r.T(Y,Zn.gradient,re.RGBA8),Zn.version=a.gradientVersion,Fn=Zn.texture}Y.activeTexture.set(re.TEXTURE1),Fn.bind(a.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}Ze&&(Y.activeTexture.set(re.TEXTURE0),Vn.lineAtlasTexture&&Vn.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),ri.updatePaintBuffers()),Xe&&(Y.activeTexture.set(re.TEXTURE0),Vn.imageAtlasTexture&&Vn.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ri.updatePaintBuffers()),Nn&&!q&&h.terrain.setupElevationDraw(Vn,yr),h.uploadCommonUniforms(Y,yr,Gn.toUnwrapped());const wr=Zn=>{rt!=null&&(rt.value=Lt*P),yr.draw(h,re.TRIANGLES,Ht,Zn,me,er.disabled,hi,a.id,Kn.layoutVertexBuffer,Kn.indexBuffer,Kn.segments,a.paint,h.transform.zoom,ri,[Kn.layoutVertexBuffer2,Kn.patternVertexBuffer,Kn.zOffsetVertexBuffer]),rt!=null&&(rt.value=Lt)};if(bt&&!Nn){const Zn=h.stencilModeForClipping(Gn).ref;Zn===0&&Me&&Y.clear({stencil:0});const Fn={func:re.EQUAL,mask:255};hi.u_alpha_discard_threshold=.8,wr(new sr(Fn,Zn,255,re.KEEP,re.KEEP,re.INVERT)),hi.u_alpha_discard_threshold=0,wr(new sr(Fn,Zn,255,re.KEEP,re.KEEP,re.KEEP))}else hi.u_alpha_discard_threshold=bt&&Nn&&En?.8:0,wr(Nn?en:h.stencilModeForClipping(Gn))}};let wt=h.depthModeForSublayer(0,Pn.ReadOnly);const Zt=new Pn(h.depthOcclusion?re.GREATER:re.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D);if(a.hasNonElevatedBuckets){const sn=!Me&&h.terrain;P!==0&&sn?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):sn?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):zt(d,St,wt,sr.disabled,!1,!0)}if(a.hasElevatedBuckets){k==="hd-road-markup"?te||(wt=Zt,St.push("ELEVATED_ROADS")):(St.push("ELEVATED"),wt=Zt,ce&&St.push(Pe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),q&&St.push("ELEVATION_REFERENCE_SEA"));const sn=bt?h.stencilModeFor3D():sr.disabled;h.forceTerrainMode=!0,zt(d,St,wt,sn,!0,!0),bt&&zt(d,St,wt,sn,!0,!1),h.forceTerrainMode=!1}bt&&(h.resetStencilClippingMasks(),Me&&Y.clear({stencil:0})),P===0||h.depthOcclusion||Me||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,n,a,d){const _=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=a.paint.get("fill-emissive-strength"),P=h.colorModeForDrapableLayerRenderPass(T),k=a.paint.get("fill-pattern"),G=h.opaquePassEnabledForLayer()&&!k.constantOr(1)&&_.constantOr(r.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let q="none";a.layout.get("fill-elevation-reference")!=="none"?q="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(q="offset");const te=!(!h.terrain||!h.terrain.enabled),Y={painter:h,sourceCache:n,layer:a,coords:d,colorMode:P,elevationType:q,terrainEnabled:te,pass:G};if(h.renderPass!=="shadow")if(q!=="offset"){if($d(Y,!1),q==="road"){const re=!te&&h.renderPass==="translucent";re&&ma(h,n,a,d,"geometry"),$d(Y,!0,sr.disabled),re&&(function(le){const{painter:ce,sourceCache:Pe,layer:me,coords:Me,colorMode:Le}=le,Fe=ce.context.gl,Ze=le.painter.shadowRenderer,He=!!Ze&&Ze.enabled,Ye=new Pn(ce.context.gl.LEQUAL,Pn.ReadOnly,ce.depthRangeFor3D);let qe=[0,0,0];if(He){const Xe=ce.style.directionalLight,Tt=ce.style.ambientLight;Xe&&Tt&&(qe=Ha(ce.style,Xe,Tt))}const We=Xe=>{for(const Tt of Me){const ht=Pe.getTile(Tt),Lt=ht.getBucket(me);if(!Lt)continue;const bt=Lt.elevatedStructures;if(!bt)continue;let Pt,nn;if(Xe?(Pt=bt.renderableBridgeSegments,nn=bt.bridgeProgramConfigurations.get(me.id)):(Pt=bt.renderableTunnelSegments,nn=bt.tunnelProgramConfigurations.get(me.id)),!Pt||Pt.segments[0].primitiveLength===0)continue;nn.updatePaintBuffers(),ce.prepareDrawTile();const St=ce.isTileAffectedByFog(Tt),rt=[];He&&rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const zt=ce.getOrCreateProgram("elevatedStructures",{config:nn,overrideFog:St,defines:rt}),wt=ce.translatePosMatrix(Tt.projMatrix,ht,me.paint.get("fill-translate"),me.paint.get("fill-translate-anchor"));He&&Ze.setupShadows(ht.tileID.toUnwrapped(),zt,"vector-tile");const Zt=cg(wt,qe);ce.uploadCommonUniforms(ce.context,zt,Tt.toUnwrapped()),zt.draw(ce,Fe.TRIANGLES,Ye,sr.disabled,Le,er.backCCW,Zt,me.id,bt.vertexBuffer,bt.indexBuffer,Pt,me.paint,ce.transform.zoom,nn,[bt.vertexBufferNormal])}};We(!0),We(!1)})(Y)}}else $d(Y,!1,h.stencilModeFor3D());else h.shadowRenderer&&q==="road"&&!te&&(function(re){const{painter:le,sourceCache:ce,layer:Pe,coords:me}=re,Me=le.context.gl,Le=re.painter.shadowRenderer;for(const Fe of me){const Ze=ce.getTile(Fe),He=Ze.getBucket(Pe);if(!He)continue;const Ye=He.elevatedStructures;if(!Ye||!Ye.shadowCasterSegments||Ye.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const qe=He.bufferData.programConfigurations.get(Pe.id),We=le.isTileAffectedByFog(Fe),Xe=le.getOrCreateProgram("elevatedStructuresDepth",{config:qe,overrideFog:We}),Tt=Le.calculateShadowPassMatrixFromTile(Ze.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,Xe,Fe.toUnwrapped());const ht={u_matrix:Tt,u_depth_bias:0};Xe.draw(le,Me.TRIANGLES,Le.getShadowPassDepthMode(),sr.disabled,Le.getShadowPassColorMode(),er.disabled,ht,Pe.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.shadowCasterSegments,Pe.paint,le.transform.zoom,qe)}})(Y)},"fill-extrusion":function(h,n,a,d){const _=a.paint.get("fill-extrusion-opacity"),b=h.context,T=b.gl,P=h.terrain,k=P&&P.renderingToTexture;if(_===0)return;const G=h.conflationActive&&h.style.isLayerClipped(a,n.getSource()),q=h.style.order.indexOf(a.fqid);if(G&&(function(te,Y,re,le,ce){for(const Pe of le){const me=Y.getTile(Pe).getBucket(re);me&&(me.updateReplacement(Pe,te.replacementSource,ce),me.uploadCentroid(te.context))}})(h,n,a,d,q),P||G)for(const te of d){const Y=n.getTile(te).getBucket(a);Y&&Ec(h.context,n,te,Y,a,P,G)}if(h.renderPass==="shadow"&&h.shadowRenderer){const te=h.shadowRenderer;if(P&&_<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const Y=te.getShadowPassDepthMode(),re=te.getShadowPassColorMode();In(h,n,a,d,Y,sr.disabled,re,G)}else if(h.renderPass==="translucent"){const te=!a.paint.get("fill-extrusion-pattern").constantOr(1),Y=a.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!k&&Y.a!==0){const re=new Pn(h.context.gl.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D);_===1&&te?In(h,n,a,d,re,sr.disabled,br.unblended,G):(In(h,n,a,d,re,sr.disabled,br.disabled,G),In(h,n,a,d,re,h.stencilModeFor3D(),h.colorModeForRenderPass(),G),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&te&&(!P&&h.transform.projection.name!=="globe"||k)){const re=a.paint.get("fill-extrusion-opacity"),le=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),ce=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Pe=a.paint.get("fill-extrusion-flood-light-intensity"),me=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(me?null:a.lut).toArray01().slice(0,3),Le=le>0&&ce>0,Fe=Pe>0,Ze=(qe,We,Xe)=>(1-Xe)*qe+Xe*We,He=new lm;He.translate=a.paint.get("fill-extrusion-translate"),He.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),He.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),He.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const Ye=qe=>{const We=h.depthModeForSublayer(1,Pn.ReadOnly,T.LEQUAL,!0),Xe=a.paint.get(qe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Tt=Ze(.1,3,Xe),ht=h._showOverdrawInspector;if(!ht){const Lt=new sr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),bt=new br([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Cc(He,h,n,a,d,We,Lt,bt,er.disabled,qe,"sdf",re,le,ce,Pe,Me,Tt,G,!1)}{const Lt=ht?sr.disabled:new sr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),bt=ht?h.colorModeForRenderPass():new br([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.ao.transparent,[!0,!0,!0,!0]);Cc(He,h,n,a,d,We,Lt,bt,er.disabled,qe,"color",re,le,ce,Pe,Me,Tt,G,!1)}};if(k){const qe=(We,Xe,Tt)=>{const ht=h.depthModeForSublayer(1,Pn.ReadOnly,T.LEQUAL,!1),Lt=a.paint.get(We?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),bt=Ze(.1,3,Lt);{const Pt=new br([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0]);Cc(He,h,n,a,d,ht,sr.disabled,Pt,er.disabled,We,"clear",re,le,ce,Pe,Me,bt,G,Xe)}{const Pt=new sr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),nn=new br([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Cc(He,h,n,a,d,ht,Pt,nn,er.disabled,We,"sdf",re,le,ce,Pe,Me,bt,G,Xe)}{const Pt=We?T.ZERO:T.ONE_MINUS_DST_ALPHA,nn=new sr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),St=new br([Pt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Cc(He,h,n,a,d,ht,nn,St,er.disabled,We,"color",re,le,ce,Pe,Me,bt,G,Xe)}{const Pt=new br([T.ONE,T.ONE,T.ONE,We?T.ZERO:T.ONE],r.ao.transparent,[!1,!1,!1,!0],We?T.FUNC_ADD:T.MAX);Cc(He,h,n,a,d,ht,sr.disabled,Pt,er.disabled,We,"clear",re,le,ce,Pe,Me,bt,G,Xe,Tt)}};if(Le||Fe){let We;if(h.prepareDrawTile(),P){const Xe=P.drapeBufferSize[0],Tt=P.drapeBufferSize[1];We=P.framebufferCopyTexture,We&&(!We||We.size[0]===Xe&&We.size[1]===Tt)||(We&&We.destroy(),We=P.framebufferCopyTexture=new r.T(b,new r.q({width:Xe,height:Tt}),T.RGBA8)),We.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Xe,Tt)}Le&&qe(!0,!1,We),Fe&&qe(!1,!0,We)}}else Le&&Ye(!0),Fe&&Ye(!1),(Le||Fe)&&h.resetStencilClippingMasks()}}},building:function(h,n,a,d){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const _=a.paint.get("building-ambient-occlusion-ground-intensity"),b=a.paint.get("building-ambient-occlusion-ground-radius"),T=a.paint.get("building-ambient-occlusion-ground-attenuation"),P=a.paint.get("building-opacity");if(P<=0)return;let k=_>0&&b>0,G=!0;const q=a.paint.get("building-vertical-scale");(!h.shadowRenderer||q<1)&&(G=!1);const te=h.conflationActive&&h.style.isLayerClipped(a,n.getSource()),Y=h.style.order.indexOf(a.fqid);if((function(re,le,ce,Pe,me,Me){for(const Le of Me){const Fe=le.getTile(Le).getBucket(ce);Fe&&(me&&Fe.updateReplacement(Le,re.replacementSource,Pe),Fe.uploadUpdatedIndexBuffer(re.context))}})(h,n,a,Y,te,d),(function(re,le,ce,Pe){for(const me of Pe){const Me=le.getTile(me).getBucket(ce);Me&&Me.needsEvaluation()&&Me.uploadUpdatedColorBuffer(re.context)}})(h,n,a,d),a.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const re=h.shadowRenderer,le=[],ce=re.getShadowPassDepthMode();Zl({painter:h,source:n,layer:a,coords:d,defines:le,blendMode:re.getShadowPassColorMode(),depthMode:ce,opacity:P,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(h.renderPass==="translucent"){let re=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(re=re.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(re=re.concat("NORMAL_OFFSET"));const le=a.paint.get("building-facade-emissive-chance"),ce=a.paint.get("building-ambient-occlusion-intensity"),Pe=new Pn(h.context.gl.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D);P<1&&Zl({painter:h,source:n,layer:a,coords:d,defines:re,blendMode:br.disabled,depthMode:Pe,opacity:P,verticalScale:q,facadeEmissiveChance:le,facadeAOIntensity:ce});const me=h.colorModeForRenderPass();Zl({painter:h,source:n,layer:a,coords:d,defines:re,blendMode:me,depthMode:Pe,opacity:P,verticalScale:q,facadeEmissiveChance:le,facadeAOIntensity:ce}),k&&(function(Me,Le,Fe,Ze,He,Ye,qe,We,Xe,Tt,ht,Lt,bt){const Pt=Me.context.gl,nn=Me.depthModeForSublayer(1,Pn.ReadOnly,Pt.LEQUAL,!0),St=.1*(1-(rt=ht))+3*rt;var rt;const zt=Me._showOverdrawInspector,wt=Lt,Zt=new lm;zt||Cc(Zt,Me,Le,Fe,Ze,nn,new sr({func:Pt.ALWAYS,mask:255},255,255,Pt.KEEP,Pt.KEEP,Pt.REPLACE),new br([Pt.ONE,Pt.ONE,Pt.ONE,Pt.ONE],r.ao.transparent,[!1,!1,!1,!0],Pt.MIN),er.disabled,He,"sdf",Ye,qe,We,0,Tt,St,wt,!1);{const sn=zt?sr.disabled:new sr({func:Pt.EQUAL,mask:255},255,255,Pt.KEEP,Pt.DECR,Pt.DECR),Sn=zt?Me.colorModeForRenderPass():new br([Pt.ONE_MINUS_DST_ALPHA,Pt.DST_ALPHA,Pt.ONE,Pt.ONE],r.ao.transparent,[!0,!0,!0,!0]);Cc(Zt,Me,Le,Fe,Ze,nn,sn,Sn,er.disabled,He,"color",Ye,qe,We,0,Tt,St,wt,!1)}})(h,n,a,d,!0,P,_,b,0,[0,0,0],T,te)}else if(h.renderPass==="light-beam"){const re=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Pn(h.context.gl.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D);Zl({painter:h,source:n,layer:a,coords:d,defines:re,blendMode:br.alphaBlended,depthMode:le,opacity:P,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,n,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const _=h.context,b=h.terrain&&h.terrain.renderingToTexture,[T,P]=h.renderPass!=="translucent"||b?[{},d]:h.stencilConfigForOverlap(d);for(const k of P){const G=n.getTile(k);if(G.needsHillshadePrepare&&h.renderPass==="offscreen")Yp(h,G,a);else if(h.renderPass==="translucent"){const q=h.depthModeForSublayer(0,Pn.ReadOnly),te=a.paint.get("hillshade-emissive-strength"),Y=h.colorModeForDrapableLayerRenderPass(te),re=b&&h.terrain?h.terrain.stencilModeForRTTOverlap(k):T[k.overscaledZ];Zp(h,k,G,a,q,re,Y)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,a,d,_,b){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=h.transform.projection.name==="globe",P=a.paint.get("raster-elevation")!==0,k=P&&T;if(h.renderElevatedRasterBackface&&!k)return;const G=h.context,q=G.gl,te=n.getSource(),Y=(function(He,Ye,qe,We){const Xe=Ye.paint.get("raster-color"),Tt=He.type==="raster-array",ht=[],Lt=Ye.paint.get("raster-resampling"),bt=Ye.paint.get("raster-color-mix");let Pt=Ye.paint.get("raster-color-range");const nn=[bt[0],bt[1],bt[2],0],St=bt[3];let rt=Lt==="nearest"?We.NEAREST:We.LINEAR;if(Tt&&(ht.push("RASTER_ARRAY"),Xe||ht.push("RASTER_COLOR"),Lt==="linear"&&ht.push("RASTER_ARRAY_LINEAR"),rt=We.NEAREST,!Pt&&He.rasterLayers)){const zt=He.rasterLayers.find((({id:wt})=>wt===Ye.sourceLayer));zt&&zt.fields&&zt.fields.range&&(Pt=zt.fields.range)}if(Pt=Pt||[0,1],Xe){ht.push("RASTER_COLOR"),qe.activeTexture.set(We.TEXTURE2),Ye.updateColorRamp(Pt);let zt=Ye.colorRampTexture;zt||(zt=Ye.colorRampTexture=new r.T(qe,Ye.colorRamp,We.RGBA8)),zt.bind(We.LINEAR,We.CLAMP_TO_EDGE)}return{mix:nn,range:Pt,offset:St,defines:ht,resampling:rt}})(te,a,G,q);if(te instanceof r.aS&&!d.length&&!T)return;const re=a.paint.get("raster-emissive-strength"),le=h.colorModeForDrapableLayerRenderPass(re),ce=h.terrain&&h.terrain.renderingToTexture,Pe=!h.options.moving,me=a.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;if(te instanceof r.aS&&!d.length&&(te.onNorthPole||te.onSouthPole)){const He=P?h.stencilModeFor3D():sr.disabled;return void op(!!te.onNorthPole,null,h,n,a,re,Y,er.disabled,He)}if(!d.length)return;const[Me,Le]=te instanceof r.aS||ce?[{},d]:h.stencilConfigForOverlap(d),Fe=Le[Le.length-1].overscaledZ;k&&Y.defines.push("PROJECTION_GLOBE_VIEW"),P&&Y.defines.push("RENDER_CUTOFF");const Ze=(He,Ye,qe)=>{for(const We of He){const Xe=We.toUnwrapped(),Tt=n.getTile(We);if(ce&&(!Tt||!Tt.hasData()))continue;G.activeTexture.set(q.TEXTURE0);const ht=Hd(Tt,te,a,Y);if(!ht||!ht.texture)continue;const{texture:Lt,mix:bt,offset:Pt,tileSize:nn,buffer:St}=ht;let rt,zt;ce?(rt=Pn.disabled,zt=We.projMatrix):P?(rt=new Pn(q.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D),zt=T?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Xe,Pe)):(rt=h.depthModeForSublayer(We.overscaledZ-Fe,a.paint.get("raster-opacity")===1?Pn.ReadWrite:Pn.ReadOnly,q.LESS),zt=h.transform.calculateProjMatrix(Xe,Pe));const wt=h.terrain&&ce?h.terrain.stencilModeForRTTOverlap(We):Me[We.overscaledZ],Zt=b?0:a.paint.get("raster-fade-duration");Tt.registerFadeDuration(Zt);const sn=n.findLoadedParent(We,0),Sn=jl(Tt,sn,n,h.transform,Zt);let Ht,en;!Sn.isFading&&Tt.refreshedUponExpiration&&(Tt.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),G.activeTexture.set(q.TEXTURE0),Lt.bind(me,q.CLAMP_TO_EDGE),G.activeTexture.set(q.TEXTURE1),sn?(sn.texture&&sn.texture.bind(me,q.CLAMP_TO_EDGE),Ht=Math.pow(2,sn.tileID.overscaledZ-Tt.tileID.overscaledZ),en=[Tt.tileID.canonical.x*Ht%1,Tt.tileID.canonical.y*Ht%1]):Lt.bind(me,q.CLAMP_TO_EDGE),"useMipmap"in Lt&&G.extTextureFilterAnisotropic&&h.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const Nn=h.transform;let En;const Gn=P?C_(Nn):[0,0,0,0];let Vn,Kn,ir,dr,qr,hr=0;if(k&&te instanceof r.aS&&te.coordinates.length>3)Vn=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0)))),Kn=Float32Array.from(Nn.globeMatrix),ir=Float32Array.from(r.dB(Nn)),dr=[r.aF(Nn.center.lng),r.aJ(Nn.center.lat)],En=te.elevatedGlobePerspectiveTransform,qr=te.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const yr=r.dC(We.canonical);hr=r.dD(yr.getCenter().lat),Vn=Float32Array.from(r.bk(r.dF(We.canonical))),Kn=Float32Array.from(Nn.globeMatrix),ir=Float32Array.from(r.dB(Nn)),dr=[r.aF(Nn.center.lng),r.aJ(Nn.center.lat)],En=[0,0],qr=Float32Array.from(r.dE(We.canonical,yr,hr,Nn.worldSize/Nn._pixelsPerMercatorPixel))}else En=te instanceof r.aS?te.perspectiveTransform:[0,0],Vn=new Float32Array(16),Kn=new Float32Array(9),ir=new Float32Array(16),dr=[0,0],qr=new Float32Array(9);const ri=Kf(zt,Vn,Kn,ir,qr,en||[0,0],r.aj(h.transform.zoom),dr,Gn,Ht||1,Sn,a,En,P?a.paint.get("raster-elevation"):0,2,bt,Pt,Y.range,nn,St,re),si=h.isTileAffectedByFog(We),Mi=h.getOrCreateProgram("raster",{defines:Y.defines,overrideFog:si});if(h.uploadCommonUniforms(G,Mi,Xe),te instanceof r.aS){const yr=te.elevatedGlobeVertexBuffer,Qr=te.elevatedGlobeIndexBuffer;if(ce||!T)te.boundsBuffer&&te.boundsSegments&&Mi.draw(h,q.TRIANGLES,rt,sr.disabled,le,er.disabled,ri,a.id,te.boundsBuffer,h.quadTriangleIndexBuffer,te.boundsSegments);else if(yr&&Qr){const Xr=Nn.zoom<=r.cZ?te.elevatedGlobeSegments:te.getSegmentsForLongitude(Nn.center.lng);Xr&&Mi.draw(h,q.TRIANGLES,rt,sr.disabled,le,Ye,ri,a.id,yr,Qr,Xr)}}else if(k){rt=new Pn(q.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D);const yr=h.globeSharedBuffers;if(yr){const[Qr,Xr,ei]=yr.getGridBuffers(hr,!1);Mi.draw(h,q.TRIANGLES,rt,qe||wt,h.colorModeForRenderPass(),Ye,ri,a.id,Qr,Xr,ei)}}else{const{tileBoundsBuffer:yr,tileBoundsIndexBuffer:Qr,tileBoundsSegments:Xr}=h.getTileBoundsBuffers(Tt);Mi.draw(h,q.TRIANGLES,rt,wt,le,er.disabled,ri,a.id,yr,Qr,Xr)}}if(!(te instanceof r.aS)&&k)for(const We of He){const Xe=We.canonical.y===(1<<We.canonical.z)-1;We.canonical.y===0&&op(!0,We,h,n,a,re,Y,Ye,qe||sr.disabled),Xe&&op(!1,We,h,n,a,re,Y,Ye===er.frontCW?er.backCW:er.frontCW,qe||sr.disabled)}};k?Ze(Le,h.renderElevatedRasterBackface?er.backCW:er.frontCW,h.stencilModeFor3D()):Ze(Le,er.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,n,a,d,_,b){h.renderPass==="offscreen"&&(function(T,P,k,G){if(!G.length)return;const q=T.context,te=q.gl,Y=P.getSource();if(!(Y instanceof zl))return;const re=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let le=k.particlePositionRGBAImage;if(!le||le.width!==re){const Le=(function(Fe){const Ze=Fe*Fe,He=new Uint8Array(4*Ze),Ye=function(We){return We|=0,We=Math.imul(2747636419^We,2654435769),We=Math.imul(We^We>>>16,2654435769),((We=Math.imul(We^We>>>16,2654435769))>>>0)/4294967296},qe=1/1.1;for(let We=0;We<Ze;We++){const Xe=qe*(Ye(2*We+0)+Nu),Tt=qe*(Ye(2*We+1)+Nu),ht=255*Xe%1,Lt=255*Tt%1,bt=ht,Pt=Tt-Lt/255,nn=Lt;He[4*We+0]=255*(Xe-ht/255),He[4*We+1]=255*bt,He[4*We+2]=255*Pt,He[4*We+3]=255*nn}return He})(re);le=k.particlePositionRGBAImage=new r.q({width:re,height:re},Le)}let ce=k.particleFramebuffer;ce?ce.width!==re&&(ce.destroy(),ce=k.particleFramebuffer=q.createFramebuffer(re,re,!0,null)):ce=k.particleFramebuffer=q.createFramebuffer(re,re,!0,null);const Pe=[];for(const Le of G){const Fe=P.getTile(Le);if(!(Fe instanceof bh))continue;const Ze=ba(Fe,Y,k);if(!Ze)continue;const He=[Fe.tileSize,Fe.tileSize];let Ye=k.tileFramebuffer;Ye||(Ye=k.tileFramebuffer=q.createFramebuffer(He[0],He[1],!0,null));let qe=Fe.rasterParticleState;qe||(qe=Fe.rasterParticleState=new A_(q,Le,He,le));const We=qe.update(k.lastInvalidatedAt);qe.particleTextureDimension!==re&&qe.updateParticleTexture(Le,le);const Xe=qe.targetColorTexture;qe.targetColorTexture=qe.backgroundColorTexture,qe.backgroundColorTexture=Xe;const Tt=qe.particleTexture0;qe.particleTexture0=qe.particleTexture1,qe.particleTexture1=Tt,Pe.push([Le,Ze,qe,We])}if(Pe.length===0)return;const me=r.o.now(),Me=k.previousDrawTimestamp?.001*(me-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=me,k.hasColorMap()){q.activeTexture.set(te.TEXTURE0+2);let Le=k.colorRampTexture;Le||(Le=k.colorRampTexture=new r.T(q,k.colorRamp,te.RGBA8)),Le.bind(te.LINEAR,te.CLAMP_TO_EDGE)}q.bindFramebuffer.set(k.tileFramebuffer.framebuffer),(function(Le,Fe,Ze){const He=Le.context,Ye=He.gl,qe=Fe.tileFramebuffer;He.activeTexture.set(Ye.TEXTURE0);const We={u_texture:0,u_opacity:1.05*(Tt=Fe.paint.get("raster-particle-fade-opacity-factor"))/(Tt+.05)},Xe=Le.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Tt;for(const ht of Ze){const[,,Lt,bt]=ht;qe.colorAttachment.set(Lt.targetColorTexture.texture),He.viewport.set([0,0,qe.width,qe.height]),He.clear({color:r.ao.transparent}),bt&&(Lt.backgroundColorTexture.bind(Ye.NEAREST,Ye.CLAMP_TO_EDGE),Xe.draw(Le,Ye.TRIANGLES,Pn.disabled,sr.disabled,br.alphaBlended,er.disabled,We,Fe.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments))}})(T,k,Pe),(function(Le,Fe,Ze,He){const Ye=Le.context,qe=Ye.gl,We=Ze.tileFramebuffer,Xe=Le.transform.projection.name==="globe",Tt=Ze.paint.get("raster-particle-max-speed");for(const ht of He){const[Lt,bt,Pt]=ht;Ye.activeTexture.set(qe.TEXTURE0+0),bt.texture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE),We.colorAttachment.set(Pt.targetColorTexture.texture);const nn=Le.getOrCreateProgram("rasterParticleDraw",{defines:bt.defines,overrideFog:!1});Ye.activeTexture.set(qe.TEXTURE0+1);const St=bt.scalarData?[]:[0,1,2,3].map((wt=>r.e6[wt](Lt)));St.push(Lt);const rt=Lt.canonical.x,zt=Lt.canonical.y;for(const wt of St){const Zt=Fe.getTile(Xe?wt.wrapped():wt);if(!Zt)continue;const sn=Zt.rasterParticleState;if(!sn)continue;const Sn=wt.canonical.x+(1<<wt.canonical.z)*(wt.wrap-Lt.wrap),Ht=wt.canonical.y;sn.particleTexture0.bind(qe.NEAREST,qe.CLAMP_TO_EDGE);const en=Zr(1,sn.particleTexture0.size[0],[Sn-rt,Ht-zt],0,bt.texture.size,2,Tt,bt.textureOffset,bt.scale,bt.offset);nn.draw(Le,qe.POINTS,Pn.disabled,sr.disabled,br.alphaBlended,er.disabled,en,Ze.id,sn.particleIndexBuffer,void 0,sn.particleSegment)}}})(T,P,k,Pe),q.bindFramebuffer.set(k.particleFramebuffer.framebuffer),(function(Le,Fe,Ze,He){const Ye=Le.context,qe=Ye.gl,We=Fe.paint.get("raster-particle-max-speed"),Xe=He*Fe.paint.get("raster-particle-speed-factor")*.15,Tt=(function(Lt){return Math.pow(Lt,6)})(.01+1*Fe.paint.get("raster-particle-reset-rate-factor")),ht=Fe.particleFramebuffer;Ye.viewport.set([0,0,ht.width,ht.height]);for(const Lt of Ze){const[,bt,Pt]=Lt;Ye.activeTexture.set(qe.TEXTURE0+0),bt.texture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE),Ye.activeTexture.set(qe.TEXTURE0+1);const nn=Pt.particleTexture0;nn.bind(qe.NEAREST,qe.CLAMP_TO_EDGE);const St=Jf(1,nn.size[0],0,bt.texture.size,We,Xe,Tt,bt.textureOffset,bt.scale,bt.offset);ht.colorAttachment.set(Pt.particleTexture1.texture),Ye.clear({color:r.ao.transparent}),Le.getOrCreateProgram("rasterParticleUpdate",{defines:bt.defines}).draw(Le,qe.TRIANGLES,Pn.disabled,sr.disabled,br.unblended,er.disabled,St,Fe.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments)}})(T,k,Pe,Me)})(h,n,a,d),h.renderPass==="translucent"&&((function(T,P,k,G,q){const te=T.context,Y=te.gl,re=P.getSource().tileSize,le=5*(1-r.ah(r.cK,r.cK+1,T.transform.zoom))*re+k.paint.get("raster-particle-elevation"),ce=!T.options.moving,Pe=T.transform.projection.name==="globe";if(!G.length)return;const[me,Me]=T.stencilConfigForOverlap(G),Le=[];Pe&&Le.push("PROJECTION_GLOBE_VIEW");const Fe=T.stencilModeFor3D();for(const Ze of Me){const He=Ze.toUnwrapped(),Ye=P.getTile(Ze);if(!Ye.rasterParticleState)continue;const qe=Ye.rasterParticleState,We=100;Ye.registerFadeDuration(We);const Xe=P.findLoadedParent(Ze,0),Tt=jl(Ye,Xe,P,T.transform,We);let ht,Lt;T.terrain&&T.terrain.prepareDrawTile(),te.activeTexture.set(Y.TEXTURE0),qe.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),te.activeTexture.set(Y.TEXTURE1),Xe&&Xe.rasterParticleState?(Xe.rasterParticleState.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),ht=Math.pow(2,Xe.tileID.overscaledZ-Ye.tileID.overscaledZ),Lt=[Ye.tileID.canonical.x*ht%1,Ye.tileID.canonical.y*ht%1]):qe.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const bt=Pe?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(He,ce),Pt=T.transform,nn=Uu(Pt),St=r.dC(Ze.canonical),rt=r.dD(St.getCenter().lat);let zt,wt,Zt,sn,Sn;Pe?(zt=Float32Array.from(r.bk(r.dF(Ze.canonical))),wt=Float32Array.from(Pt.globeMatrix),Zt=Float32Array.from(r.dB(Pt)),sn=[r.aF(Pt.center.lng),r.aJ(Pt.center.lat)],Sn=Float32Array.from(r.dE(Ze.canonical,St,rt,Pt.worldSize/Pt._pixelsPerMercatorPixel))):(zt=new Float32Array(16),wt=new Float32Array(9),Zt=new Float32Array(16),sn=[0,0],Sn=new Float32Array(9));const Ht=vl(bt,zt,wt,Zt,Sn,Lt||[0,0],r.aj(T.transform.zoom),sn,nn,ht||1,Tt,le),en=T.isTileAffectedByFog(Ze),Nn=T.getOrCreateProgram("rasterParticle",{defines:Le,overrideFog:en});if(T.uploadCommonUniforms(te,Nn,He),Pe){const En=new Pn(Y.LEQUAL,Pn.ReadOnly,T.depthRangeFor3D),Gn=0,Vn=T.globeSharedBuffers;if(Vn){const[Kn,ir,dr]=Vn.getGridBuffers(rt,Gn!==0);Nn.draw(T,Y.TRIANGLES,En,Fe,br.alphaBlended,T.renderElevatedRasterBackface?er.frontCCW:er.backCCW,Ht,k.id,Kn,ir,dr)}}else{const En=T.depthModeForSublayer(0,Pn.ReadOnly),Gn=me[Ze.overscaledZ],{tileBoundsBuffer:Vn,tileBoundsIndexBuffer:Kn,tileBoundsSegments:ir}=T.getTileBoundsBuffers(Ye);Nn.draw(T,Y.TRIANGLES,En,Gn,br.alphaBlended,er.disabled,Ht,k.id,Vn,Kn,ir)}}T.resetStencilClippingMasks()})(h,n,a,d),h.style.map.triggerRepaint())},background:function(h,n,a,d){const _=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),P=a.paint.get("background-emissive-strength"),k=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const G=h.context,q=G.gl,te=h.transform,Y=te.tileSize,re=a.paint.get("background-pattern");let le;if(re!==void 0&&(re===null||(le=h.imageManager.getPattern(r.I.from(re.toString()),a.scope,h.style.getLut(a.scope)),!le)))return;const ce=!re&&_.a===1&&T===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==ce)return;const Pe=sr.disabled,me=h.depthModeForSublayer(0,ce==="opaque"?Pn.ReadWrite:Pn.ReadOnly),Me=h.colorModeForDrapableLayerRenderPass(P),Le=re?"backgroundPattern":"background";let Fe,Ze=d;if(Ze||(Fe=h.getBackgroundTiles(),Ze=Object.values(Fe).map((He=>He.tileID))),re&&(G.activeTexture.set(q.TEXTURE0),h.imageManager.bind(h.context,a.scope)),k){const He=h.getOrCreateProgram(Le,{overrideFog:!1,overrideRtt:!0}),Ye=new Float32Array(r.bA([])),qe=new r.aO(0,0,0,0,0),We=re?ep(Ye,P,T,h,0,a.scope,le,k,{tileID:qe,tileSize:Y}):Qc(Ye,P,T,_.toPremultipliedRenderColor(b?null:a.lut));He.draw(h,q.TRIANGLES,me,Pe,Me,er.disabled,We,a.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const He of Ze){const Ye=h.isTileAffectedByFog(He),qe=h.getOrCreateProgram(Le,{overrideFog:Ye}),We=He.toUnwrapped(),Xe=d?He.projMatrix:h.transform.calculateProjMatrix(We);h.prepareDrawTile();const Tt=n?n.getTile(He):Fe?Fe[He.key]:new fc(He,Y,te.zoom,h),ht=re?ep(Xe,P,T,h,0,a.scope,le,k,{tileID:He,tileSize:Y}):Qc(Xe,P,T,_.toPremultipliedRenderColor(b?null:a.lut));h.uploadCommonUniforms(G,qe,We);const{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:bt,tileBoundsSegments:Pt}=h.getTileBoundsBuffers(Tt);qe.draw(h,q.TRIANGLES,me,Pe,Me,er.disabled,ht,a.id,Lt,bt,Pt)}},sky:function(h,n,a){const d=h._atmosphere?r.aj(h.transform.zoom):1,_=a.paint.get("sky-opacity")*d;if(_===0)return;const b=h.context,T=a.paint.get("sky-type"),P=new Pn(b.gl.LEQUAL,Pn.ReadOnly,[0,1]),k=h.frameCounter/1e3%1;T==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&((function(G,q,te,Y){const re=G.context,le=re.gl;let ce=q.skyboxFbo;if(!ce){ce=q.skyboxFbo=re.createFramebuffer(32,32,!0,null),q.skyboxGeometry=new fm(re),q.skyboxTexture=re.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,q.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Le=0;Le<6;++Le)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(ce.framebuffer),re.viewport.set([0,0,32,32]);const Pe=q.getCenter(G,!0),me=G.getOrCreateProgram("skyboxCapture"),Me=new Float64Array(16);r.bA(Me),r.ek(Me,Me,.5*-Math.PI),$u(G,q,me,Me,Pe,0),r.bA(Me),r.ek(Me,Me,.5*Math.PI),$u(G,q,me,Me,Pe,1),r.bA(Me),r.cT(Me,Me,.5*-Math.PI),$u(G,q,me,Me,Pe,2),r.bA(Me),r.cT(Me,Me,.5*Math.PI),$u(G,q,me,Me,Pe,3),r.bA(Me),$u(G,q,me,Me,Pe,4),r.bA(Me),r.ek(Me,Me,Math.PI),$u(G,q,me,Me,Pe,5),re.viewport.set([0,0,G.width,G.height])})(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&(function(G,q,te,Y,re){const le=G.context,ce=le.gl,Pe=G.transform,me=G.getOrCreateProgram("skybox");le.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,q.skyboxTexture);const Me=((Le,Fe,Ze,He,Ye)=>({u_matrix:Le,u_sun_direction:Fe,u_cubemap:0,u_opacity:He,u_temporal_offset:Ye}))(Pe.skyboxMatrix,q.getCenter(G,!1),0,Y,re);G.uploadCommonUniforms(le,me),me.draw(G,ce.TRIANGLES,te,sr.disabled,G.colorModeForRenderPass(),er.backCW,Me,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)})(h,a,P,_,k):T==="gradient"&&h.renderPass==="sky"&&(function(G,q,te,Y,re){const le=G.context,ce=le.gl,Pe=G.transform,me=G.getOrCreateProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new fm(le)),le.activeTexture.set(ce.TEXTURE0);let Me=q.colorRampTexture;Me||(Me=q.colorRampTexture=new r.T(le,q.colorRamp,ce.RGBA8)),Me.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Le=((Fe,Ze,He,Ye,qe)=>({u_matrix:Fe,u_color_ramp:0,u_center_direction:Ze,u_radius:r.an(He),u_opacity:Ye,u_temporal_offset:qe}))(Pe.skyboxMatrix,q.getCenter(G,!1),q.paint.get("sky-gradient-radius"),Y,re);G.uploadCommonUniforms(le,me),me.draw(G,ce.TRIANGLES,te,sr.disabled,G.colorModeForRenderPass(),er.backCW,Le,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)})(h,a,P,_,k)},custom:function(h,n,a,d){const _=h.context,b=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isDraped(n)){if(h.renderPass==="offscreen"){const T=b.prerender;if(T){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const P=h.transform.pointMerc;T.call(b,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.aj(h.transform.zoom),[P.x,P.y],h.transform.pixelsPerMeterRatio)}else T.call(b,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const P=b.renderToTile;if(P){const k=d[0].canonical,G={x:k.x+d[0].wrap*(b.wrapTileId?0:1<<k.z),y:k.y,z:k.z};_.setDepthMode(Pn.disabled),_.setStencilMode(sr.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),P.call(b,_.gl,G),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(sr.disabled);const T=b.renderingMode==="3d"?new Pn(h.context.gl.LEQUAL,Pn.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Pn.ReadOnly);if(_.setDepthMode(T),h.transform.projection.name==="globe"){const P=h.transform.pointMerc;b.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.aj(h.transform.zoom),[P.x,P.y],h.transform.pixelsPerMeterRatio)}else b.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,n,a,d){if(h.renderPass==="opaque")return;const _=a.paint.get("model-opacity").constantOr(1);if(_===0)return;const b=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!b||h.terrain&&_<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const T=h.shadowRenderer,P=a.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,P||(T.enabled=!1));const k=()=>{T&&(T.useNormalOffset=!0,P||(T.enabled=!0))},G=n.getSource();if(h.renderPass==="light-beam"&&G.type!=="batched-model")return;if(G.type==="vector"||G.type==="geojson")return(function(me,Me,Le,Fe,Ze){const He=me.transform;if(He.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${He.projection.name} projection is not yet implemented`);const Ye=He.getFreeCameraOptions().position;if(!me.modelManager)return;const qe=me.modelManager;Le.modelManager=qe;const We=me.shadowRenderer;if(!Le._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Xe=Le._unevaluatedLayout._values["model-id"],Tt=Object.assign({},Le.layout.get("model-id").parameters),ht=me.style.order.indexOf(Le.fqid);for(const Lt of Fe){const bt=Me.getTile(Lt).getBucket(Le);if(!bt||bt.projection.name!==He.projection.name)continue;const Pt=bt.getModelUris();Pt&&!bt.modelsRequested&&(qe.addModelsFromBucket(Pt,Ze),bt.modelsRequested=!0);const nn=qd(Lt,He);Tt.zoom=nn;const St=Xe.possiblyEvaluate(Tt);if(ap(me,bt,Lt),wl.shadowUniformsInitialized=!1,wl.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(Lt.toUnwrapped())===0,me.renderPass==="shadow"&&We){if(me.currentShadowCascade===1&&bt.isInsideFirstShadowMapFrustum)continue;const wt=He.calculatePosMatrix(Lt.toUnwrapped(),He.worldSize);if(wl.tileMatrix.set(wt),wl.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix(wt)),wl.aabb.min=[0,0,0],wl.aabb.max[0]=wl.aabb.max[1]=r.al,wl.aabb.max[2]=0,pm(bt,wl,me,Le.scope))continue}const rt=1<<Lt.canonical.z,zt=[((Ye.x-Lt.wrap)*rt-Lt.canonical.x)*r.al,(Ye.y*rt-Lt.canonical.y)*r.al,Ye.z*rt*r.al];me.conflationActive&&Object.keys(bt.instancesPerModel).length>0&&me.style.isLayerClipped(Le,Me.getSource())&&bt.updateReplacement(Lt,me.replacementSource,ht,Ze)&&(bt.uploaded=!1,bt.upload(me.context));for(let wt in bt.instancesPerModel){const Zt=bt.instancesPerModel[wt];Zt.features.length>0&&(wt=St.evaluate(Zt.features[0].feature,{}));const sn=qe.getModel(wt,Ze);if(sn||qe.hasURLBeenRequested(wt)||bt.modelUris.includes(wt)||(bt.modelUris.push(wt),bt.modelsRequested=!1),sn&&sn.uploaded)for(const Sn of sn.nodes)fg(me,Le,Sn,Zt,zt,Lt,wl)}}})(h,n,a,d,G.type==="vector"?a.scope:""),void k();if(!G.loaded())return;if(G.type==="batched-model")return(function(me,Me,Le,Fe){Le.resetLayerRenderingStats(me);const Ze=me.context,He=me.transform,Ye=me.style.fog,qe=me.shadowRenderer;if(He.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${He.projection.name} projection is not yet implemented`);const We=me.transform.getFreeCameraOptions().position,Xe=r.c4([],[We.x,We.y,We.z],me.transform.worldSize),Tt=r.et([],Xe),ht=r.bA([]),Lt=r.ec(He.center.lat,He.zoom),bt=r.bq([],[1,1,1/Lt]);r.br(ht,ht,Tt);const Pt=Le.paint.get("model-opacity").constantOr(1),nn=new Pn(Ze.gl.LEQUAL,Pn.ReadWrite,me.depthRangeFor3D),St=new Pn(Ze.gl.LEQUAL,Pn.ReadOnly,me.depthRangeFor3D),rt=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),zt=me.renderPass==="shadow",wt=zt&&qe?qe.getCurrentCascadeFrustum():He.getFrustum(He.scaleZoom(He.worldSize)),Zt=Le.paint.get("model-front-cutoff"),sn=Zt[2]<1,Sn=po(me,Le.paint.get("model-cutoff-fade-range")),Ht=Le.getLayerRenderingStats();(function(en,Nn,En,Gn){const Vn=en.terrain?en.terrain.exaggeration():0,Kn=en.transform.zoom;for(const ir of Gn){const dr=Nn.getTile(ir).getBucket(En);dr&&(dr.setFilter(En.filter),en.conflationActive&&dr.updateReplacement(ir,en.replacementSource),dr.evaluateTransform(en,En),en.terrain&&Vn>0&&dr.elevationUpdate(en.terrain,Vn,ir,En.source),dr.needsReEvaluation(en,Kn,En)&&dr.evaluate(En))}})(me,Me,Le,Fe),(function(){let en,Nn,En;sn?(en=Fe.length-1,Nn=-1,En=-1):(en=0,Nn=Fe.length,En=1);const Gn=new Float64Array(16),Vn=r.cz(),Kn=new r.P(0,0);for(let ir=en;ir!==Nn;ir+=En){const dr=Fe[ir],qr=Me.getTile(dr).getBucket(Le);if(!qr||!qr.uploaded)continue;let hr=!1;qe&&(hr=qe.getMaxCascadeForTile(dr.toUnwrapped())===0);const ri=He.calculatePosMatrix(dr.toUnwrapped(),He.worldSize),si=qr.modelTraits;!zt&&sn&&(r.bl(Gn,ri),r.af(Vn,Xe,Gn),Kn.x=Vn[0],Kn.y=Vn[1]);const Mi=[];qr.setFilter(Le.filter);for(const yr of qr.getNodesInfo()){if(yr.hiddenByReplacement||!yr.node.meshes)continue;const Qr=yr.node;let Xr=0;me.terrain&&Qr.elevation&&(Xr=Qr.elevation*me.terrain.exaggeration());const ei=(()=>{const bo=yr.aabb;return rt.min=[...bo.min],rt.max=[...bo.max],rt.min[2]+=Xr,rt.max[2]+=Xr,r.af(rt.min,rt.min,ri),r.af(rt.max,rt.max,ri),rt})(),$i=yr.evaluatedScale;if($i[0]<=1&&$i[1]<=1&&$i[2]<=1&&ei.intersects(wt)===0)continue;if(!zt&&sn){const bo=.16666666666666666;yr.cameraCollisionOpacity=Xe[0]>ei.min[0]&&Xe[0]<ei.max[0]&&Xe[1]>ei.min[1]&&Xe[1]<ei.max[1]&&Xe[2]*Lt<ei.max[2]&&Qr.footprint&&r.b$(Kn,Qr.footprint)?Math.max(yr.cameraCollisionOpacity-bo,0):Math.min(1,yr.cameraCollisionOpacity+bo)}const Dr=[...ri],hi=1/r.d6(dr.canonical),wr=Qr.anchor?Qr.anchor[0]:0,Zn=Qr.anchor?Qr.anchor[1]:0;r.br(Dr,Dr,[wr*($i[0]-1)+yr.evaluatedTranslation[0]*hi,Zn*($i[1]-1)+yr.evaluatedTranslation[1]*hi,Xr+yr.evaluatedTranslation[2]]),r.cp($i,r.ev)||r.cR(Dr,Dr,$i);const Fn=r.aB([],Dr,Qr.matrix),Gr=r.aB([],He.expandedFarZProjMatrix,Fn),Oi=r.aB([],He.expandedFarZProjMatrix,Dr),Ii=r.aC([],[wr,Zn,Xr,1],Gr)[2];Qr.hidden=!1;let xo=Pt;zt||(sn&&(xo*=yr.cameraCollisionOpacity,xo*=mm(Dr,He,yr.aabb,Zt)),xo*=lp(Sn,Ii)),xo!==0?Mi.push({nodeInfo:yr,depth:Ii,opacity:xo,wvpForNode:Gr,wvpForTile:Oi,nodeModelMatrix:Fn,tileModelMatrix:Dr}):Qr.hidden=!0}zt||Mi.sort(((yr,Qr)=>!sn||yr.opacity===1&&Qr.opacity===1?yr.depth<Qr.depth?-1:1:yr.opacity===1?-1:Qr.opacity===1?1:yr.depth>Qr.depth?-1:1));for(const yr of Mi){const Qr=yr.nodeInfo,Xr=Qr.node;let ei=r.aB([],bt,yr.tileModelMatrix);r.aB(ei,ht,ei);const $i=r.bl([],ei);r.ed($i,$i),r.cR($i,$i,P_),ei=r.aB(ei,ei,Xr.matrix);const Dr=me.renderPass==="light-beam",hi=Le.paint.get("model-color-use-theme").constantOr("default")==="none",wr=si&r.ez.HasMapboxMeshFeatures,Zn=wr?0:Qr.evaluatedRMEA[0][2];for(let Fn=0;Fn<Xr.meshes.length;++Fn){const Gr=Xr.meshes[Fn],Oi=Fn===Xr.lightMeshIndex;let Ii=yr.wvpForNode;if(Oi){if(!Dr&&!me.terrain&&me.shadowRenderer){me.currentLayer<me.firstLightBeamLayer&&(me.firstLightBeamLayer=me.currentLayer);continue}Ii=yr.wvpForTile}else if(Dr)continue;const xo={defines:[]},bo=[];if(!zt&&qe&&(qe.useNormalOffset=!!Gr.normalBuffer),Yh(xo.defines,bo,Gr,me,hi?null:Le.lut),wr||xo.defines.push("DIFFUSE_SHADED"),hr&&xo.defines.push("SHADOWS_SINGLE_CASCADE"),Ht&&(zt?Ht.numRenderedVerticesInShadowPass+=Gr.vertexArray.length:Ht.numRenderedVerticesInTransparentPass+=Gr.vertexArray.length),zt){Zu(Gr,yr.nodeModelMatrix,me,Le);continue}let Xi=null;if(Ye){const ga=yt(yr.nodeModelMatrix,me.transform);if(Xi=new Float32Array(ga),He.projection.name!=="globe"){const vi=Gr.aabb.min,uo=Gr.aabb.max,[Ni,wo]=Ye.getOpacityForBounds(ga,vi[0],vi[1],uo[0],uo[1]);xo.overrideFog=Ni>=qn||wo>=qn}}const ss=Gr.material;let as;ss.occlusionTexture&&ss.occlusionTexture.offsetScale&&(as=ss.occlusionTexture.offsetScale,xo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const na=me.getOrCreateProgram("model",xo);!zt&&qe&&qe.setupShadowsFromMatrix(yr.tileModelMatrix,na,qe.useNormalOffset),me.uploadCommonUniforms(Ze,na,null,Xi);const Co=ss.pbrMetallicRoughness;Co.metallicFactor=.9,Co.roughnessFactor=.5;const Bs=tp(new Float32Array(Ii),new Float32Array(ei),new Float32Array($i),new Float32Array(Xr.matrix),me,yr.opacity,Co.baseColorFactor,ss.emissiveFactor,Co.metallicFactor,Co.roughnessFactor,ss,Zn,Le,[0,0,0],as);!Oi&&(Qr.hasTranslucentParts||yr.opacity<1)&&na.draw(me,Ze.gl.TRIANGLES,nn,sr.disabled,br.disabled,er.backCCW,Bs,Le.id,Gr.vertexBuffer,Gr.indexBuffer,Gr.segments,Le.paint,me.transform.zoom,void 0,bo),na.draw(me,Ze.gl.TRIANGLES,Oi?St:nn,sr.disabled,Oi||yr.opacity<1||Qr.hasTranslucentParts?br.alphaBlended:br.unblended,er.backCCW,Bs,Le.id,Gr.vertexBuffer,Gr.indexBuffer,Gr.segments,Le.paint,me.transform.zoom,void 0,bo)}}}})()})(h,n,a,d),void k();if(G.type!=="model")return;const q=G.getModels(),te=[],Y=h.transform.getFreeCameraOptions().position,re=r.c4([],[Y.x,Y.y,Y.z],h.transform.worldSize);r.et(re,re);const le=[],ce=[];let Pe=0;for(const me of q){const Me=a.paint.get("model-rotation").constantOr(null),Le=a.paint.get("model-scale").constantOr(null),Fe=a.paint.get("model-translation").constantOr(null);me.computeModelMatrix(h,Me,Le,Fe,!0,!0,!1);const Ze=r.bA([]),He=r.ec(me.position.lat,h.transform.zoom),Ye=r.bq([],[1,1,1/He]);r.br(Ze,Ze,re),te.push({zScaleMatrix:Ye,negCameraPosMatrix:Ze});for(const qe of me.nodes)Xh(h.transform,qe,me.matrix,h.transform.expandedFarZProjMatrix,Pe,le,ce);Pe++}if(le.sort(((me,Me)=>Me.depth-me.depth)),h.renderPass!=="shadow"){if(_===1)for(const me of ce)nu(me,h,a,te[me.modelIndex],sr.disabled,h.colorModeForRenderPass());else{for(const me of ce)nu(me,h,a,te[me.modelIndex],sr.disabled,br.disabled);for(const me of ce)nu(me,h,a,te[me.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const me of le)nu(me,h,a,te[me.modelIndex],sr.disabled,h.colorModeForRenderPass());k()}else{for(const me of ce)Zu(me.mesh,me.nodeModelMatrix,h,a);for(const me of le)Zu(me.mesh,me.nodeModelMatrix,h,a);k()}}},ks={line:function(h,n,a){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const d=n.getVisibleCoordinates();for(const _ of d){const b=n.getTile(_).getBucket(h);if(b&&(b.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,n,a){const d=n.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const b of _)b.upload(a.context)},raster:function(h,n,a){const d=n.getSource();if(!(d instanceof zl&&d.loaded()))return;const _=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const b=h.paint.get("raster-array-band")||d.getInitialBand(_);if(b==null)return;const T=n.getIds().map((P=>n.getTileByID(P)));for(const P of T)P.updateNeeded(h.id,b)&&d.prepareTile(P,_,h.id,b)},"raster-particle":function(h,n,a){const d=n.getSource();if(!(d instanceof zl&&d.loaded()))return;const _=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const b=h.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(b==null)return;const T=n.getIds().map((P=>n.getTileByID(P)));for(const P of T)P.updateNeeded(h.id,b)&&d.prepareTile(P,_,h.id,b)}},ou={fill:ma},Kl={fill:function(h,n,a,d){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const _=h.context.gl,b=new Pn(_.LEQUAL,Pn.ReadOnly,h.depthRangeFor3D),T=new sr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),P=h.transform.getFreeCameraOptions().position,k=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of d){const q=n.getTile(G),te=q.getBucket(a);if(!te)continue;const Y=te.elevatedStructures;if(!Y||Y.depthSegments.segments[0].primitiveLength===0)continue;const re=ps(G.toUnwrapped(),P),le=h.translatePosMatrix(G.projMatrix,q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ce=jd(le,re,0,1,0);k.draw(h,_.TRIANGLES,b,T,br.disabled,er.disabled,ce,a.id,Y.vertexBuffer,Y.indexBuffer,Y.depthSegments,a.paint,h.transform.zoom)}}};class up{constructor(n,a,d,_,b,T){this.context=new am(n,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const P=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of P)this._debugParams.enabledLayers[G]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of P)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new cp(b),this.setup(),this.numSublayers=Hs.maxUnderzooming+Hs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Mh(this),this._wireframeDebugCache=new mg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,k,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=T}updateTerrain(n,a){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vh(this,n));const _=this._terrain;this.transform.elevation=d?_:null,_.update(n,this.transform,a),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=a.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const b=d+.78*(_-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Vh(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*r.o.devicePixelRatio,this.height=a*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const n=this.context,a=new r.bd;a.emplaceBack(0,0),a.emplaceBack(r.al,0),a.emplaceBack(0,r.al),a.emplaceBack(r.al,r.al),this.tileExtentBuffer=n.createVertexBuffer(a,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const d=new r.bd;d.emplaceBack(0,0),d.emplaceBack(r.al,0),d.emplaceBack(0,r.al),d.emplaceBack(r.al,r.al),this.debugBuffer=n.createVertexBuffer(d,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const _=new r.bd;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const b=new r.b0;b.emplaceBack(0,0,0,0),b.emplaceBack(r.al,0,r.al,0),b.emplaceBack(0,r.al,0,r.al),b.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const T=new r.b1;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const P=new r.be;for(const G of[0,1,3,2,0])P.emplaceBack(G);this.debugIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new r.T(n,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=r.bC();const k=this.context.gl;this.stencilClearMode=new sr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Pn.disabled,this.stencilClearMode,br.disabled,er.disabled,Zc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const k of d)if(this._tileClippingMaskIDs[k.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=a.id;const _=this.context,b=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(br.disabled),_.setDepthMode(Pn.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const k=a.getTile(P),G=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:te,tileBoundsSegments:Y}=this.getTileBoundsBuffers(k);T.draw(this,b.TRIANGLES,Pn.disabled,new sr({func:b.ALWAYS,mask:0},G,255,b.KEEP,b.KEEP,b.REPLACE),br.disabled,er.disabled,Zc(P.projMatrix),"$clipping",q,te,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new sr({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new sr({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,d=n.sort(((T,P)=>P.overscaledZ-T.overscaledZ)),_=d[d.length-1].overscaledZ,b=d[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let P=0;P<b;P++)T[P+_]=new sr({func:a.GEQUAL,mask:255},P+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,d]}return[{[_]:sr.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new br([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?br.unblended:br.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new br([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,d,_=!1){if(this.depthOcclusion)return new Pn(this.context.gl.GREATER,Pn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Pn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Pn(d||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,a=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&d!==0&&(this.depthFBO=new Wh(this.context,a,d,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:d,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,a,d,0,0,a,d,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((n,a)=>n+a/this._fpsHistory.length),0))}render(n,a){const d=r.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=a;const _=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter((St=>{const rt=_[St];return!(rt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[rt.type]}));let P=T(),k=!1,G=!1,q=null;for(const St of P){const rt=_[St];rt.type==="circle"?k=!0:rt.type==="building"?q=rt:rt.type==="symbol"&&(rt.hasOcclusionOpacityProperties?G=!0:k=!0)}let te=P.map((St=>_[St]));const Y=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let re=0,le=!1;for(const St in Y){const rt=Y[St];rt.used&&(rt.prepare(this.context),rt.getSource().usedInConflation&&++re)}let ce=!1;for(const St of te)St.isHidden(this.transform.zoom)||(St.type==="clip"&&(ce=!0),this.prepareLayer(St));const Pe={},me={},Me={},Le={},Fe={};for(const St in Y){const rt=Y[St];Pe[St]=rt.getVisibleCoordinates(),me[St]=Pe[St].slice().reverse(),Me[St]=rt.getVisibleCoordinates(!0).reverse(),Le[St]=rt.getShadowCasterCoordinates(),Fe[St]=rt.sortCoordinatesByDistance(Pe[St])}const Ze=St=>{const rt=this.style.getLayerSourceCache(St);return rt&&rt.used?rt.getSource():null};if(re||ce||this._clippingActiveLastFrame){const St=[],rt=[];let zt=0;for(const wt of te)this.isSourceForClippingOrConflation(wt,Ze(wt))&&(St.push(wt),rt.push(zt)),zt++;if(St&&(ce||St.length>1)||this._clippingActiveLastFrame){ce=!1;const wt=[];for(let Zt=0;Zt<St.length;Zt++){const sn=St[Zt],Sn=rt[Zt],Ht=this.style.getLayerSourceCache(sn);if(!Ht||!Ht.used||!Ht.getSource().usedInConflation&&sn.type!=="clip"&&sn.type!=="building")continue;let en=r.eH,Nn=r.bZ.None;const En=[];let Gn=!0;if(sn.type==="building")en=r.eJ;else if(sn.type==="clip"){en=Sn;for(const Vn of sn.layout.get("clip-layer-types"))Nn|=Vn==="model"?r.bZ.Model:Vn==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const Vn of sn.layout.get("clip-layer-scope"))En.push(Vn);sn.isHidden(this.transform.zoom)?Gn=!1:ce=!0}Gn&&wt.push({layer:sn.fqid,cache:Ht,order:en,clipMask:Nn,clipScope:En})}this.replacementSource.setSources(wt),le=!0}}this._clippingActiveLastFrame=ce,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let St=0;St<te.length;St++){const rt=te[St],zt=rt.cutoffRange();if(this.longestCutoffRange=Math.max(zt,this.longestCutoffRange),zt>0){const wt=Ze(rt);wt&&(this.minCutoffZoom=Math.max(wt.minzoom,this.minCutoffZoom)),rt.minzoom&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom))}rt.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=St),this._lastOcclusionLayer=St)}const He=this.style&&this.style.fog;He?(this._fogVisible=He.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=He.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Me),this.opaquePassCutoff=0,P=T(),te=P.map((St=>_[St])));const Ye=this._shadowRenderer;if(Ye){Ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const St in Y)for(const rt of Pe[St]){let zt={min:0,max:0};this.terrain&&(zt=this.terrain.getMinMaxForTile(rt)||zt),Ye.addShadowReceiver(rt.toUnwrapped(),zt.min,zt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const qe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),We=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(qe&&!this._snow&&(this._snow=new vg(this)),!qe&&this._snow&&(this._snow.destroy(),delete this._snow),We&&!this._rain&&(this._rain=new Fi(this)),!We&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),q){this.buildingTileBorderManager||(this.buildingTileBorderManager=new oo);const St=this.style.getLayerSourceCache(q);this.buildingTileBorderManager.updateBorders(St,q)}if(!It.has(this.context.gl))return;this.renderPass="offscreen";for(const St of te){const rt=n.getLayerSourceCache(St);if(!St.hasOffscreenPass()||St.isHidden(this.transform.zoom))continue;const zt=rt?me[rt.id]:void 0;(St.type==="custom"||St.type==="raster"||St.type==="raster-particle"||St.isSky()||zt&&zt.length)&&this.renderLayer(this,rt,St,zt)}this.depthRangeFor3D=[0,1-(te.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Tt=(()=>{if(a.showOverdrawInspector)return r.ao.black;const St=this.style.fog;if(St&&this.transform.projection.supportsFog){const rt=this.style.getLut(St.scope);if(!Xe){const zt=St.properties.get("color-use-theme")==="none",wt=St.properties.get("color").toNonPremultipliedRenderColor(zt?null:rt).toArray01();return new r.ao(...wt)}if(Xe){const zt=St.properties.get("space-color-use-theme")==="none",wt=St.properties.get("space-color").toNonPremultipliedRenderColor(zt?null:rt).toArray01();return new r.ao(...wt)}}return r.ao.transparent})();if(this.context.clear({color:Tt,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const St=te[this.currentLayer],rt=n.getLayerSourceCache(St);if(St.isSky())continue;const zt=rt?(St.is3D(b)?Fe:me)[rt.id]:void 0;this._renderTileClippingMasks(St,rt,zt),this.renderLayer(this,rt,St,zt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const St=te[this.currentLayer],rt=n.getLayerSourceCache(St);St.isSky()&&this.renderLayer(this,rt,St,rt?me[rt.id]:void 0)}function ht(St,rt){let zt;return rt&&(zt=(St.type==="symbol"?Me:St.is3D(b)?Fe:me)[rt.id]),zt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const St=te[this.currentLayer];if(St.type==="raster"||St.type==="raster-particle"){const rt=n.getLayerSourceCache(St);this.renderLayer(this,rt,St,ht(St,rt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Lt=0;Ye&&(Lt=Ye.getShadowCastingLayerCount());let bt=!1,Pt=-1;for(let St=0;St<P.length;++St){const rt=te[St];rt.isHidden(this.transform.zoom)||rt.is3D(b)&&(Pt=St)}G&&Pt===-1&&(k=!0);let nn=!1;for(;this.currentLayer<P.length;){const St=te[this.currentLayer],rt=n.getLayerSourceCache(St);if(St.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(St)){if(St.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!nn&&St.is3D(b)&&!b){const zt=this.currentLayer,wt=Zt=>{for(this.currentLayer=0;this.currentLayer<te.length;this.currentLayer++){const sn=te[this.currentLayer];if(ou[sn.type]){const Sn=this.style.getLayerSourceCache(sn);ou[sn.type](this,Sn,sn,ht(sn,Sn),Zt)}}};wt("initialize"),wt("reset"),this.currentLayer=zt,nn=!0}if(k&&!bt&&this.terrain&&!this.transform.isOrthographic&&(bt=!0,this.blitDepth()),G&&Pt!==-1&&this.currentLayer===Pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(St,rt,rt?Pe[rt.id]:void 0),this.renderLayer(this,rt,St,ht(St,rt)),!this.terrain&&Ye&&Lt>0&&St.hasShadowPass()&&--Lt==0){{this.clearStencil(),this.resetStencilClippingMasks();const zt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<te.length;this.currentLayer++){const wt=te[this.currentLayer];if(Kl[wt.type]){const Zt=this.style.getLayerSourceCache(wt);Kl[wt.type](this,Zt,wt,ht(wt,Zt))}}this.currentLayer=zt}if(Ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const zt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=zt;this.currentLayer++){const wt=te[this.currentLayer];if(!wt.hasLightBeamPass())continue;const Zt=n.getLayerSourceCache(wt);this.renderLayer(this,Zt,wt,Zt?me[Zt.id]:void 0)}this.currentLayer=zt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const zt=this.currentLayer;this.depthOcclusion=!0;for(const wt of this.layersWithOcclusionOpacity){this.currentLayer=wt;const Zt=te[this.currentLayer],sn=n.getLayerSourceCache(Zt),Sn=sn?me[sn.id]:void 0;this.terrain||this._renderTileClippingMasks(Zt,sn,sn?Pe[sn.id]:void 0),this.renderLayer(this,sn,Zt,Sn)}this.depthOcclusion=!1,this.currentLayer=zt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let St=null;te.forEach((rt=>{const zt=n.getLayerSourceCache(rt);zt&&!rt.isHidden(this.transform.zoom)&&zt.getVisibleCoordinates().length&&(!St||St.getSource().maxzoom<zt.getSource().maxzoom)&&(St=zt)})),St&&this.options.showTileBoundaries&&sp(this,St,St.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&sp(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(St){const rt=St.transform.padding;Yl(St,St.transform.height-(rt.top||0),3,Qs),Yl(St,rt.bottom||0,3,tu),ki(St,rt.left||0,3,dg),ki(St,St.transform.width-(rt.right||0),3,um);const zt=St.transform.centerPoint;(function(wt,Zt,sn,Sn){Gu(wt,Zt-1,sn-10,2,20,Sn),Gu(wt,Zt-10,sn-1,20,2,Sn)})(St,zt.x,St.transform.height-zt.y,dm)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(n.type);if(ks[n.type]&&(d||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);ks[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,a,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(d.type)&&(!n.terrain||d.type!=="custom")||d.type==="clip"||iu[d.type](n,a,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(n.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const d in n){const _=n[d],b=this.context.extTimerQuery,T=b.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(_.query),a[d]=T}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let d=0;for(const _ of n)d+=a.getQueryParameter(_,a.QUERY_RESULT)/1e6,a.deleteQuery(_);return d}translatePosMatrix(n,a,d,_,b){if(!d[0]&&!d[1])return n;const T=b?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const G=Math.sin(T),q=Math.cos(T);d=[d[0]*q-d[1]*G,d[0]*G+d[1]*q]}const P=[b?d[0]:r.ay(a,d[0],this.transform.zoom),b?d[1]:r.ay(a,d[1],this.transform.zoom),0],k=new Float32Array(16);return r.br(k,n,P),k}saveTileTexture(n){if(n.context!==this.context)return;const a=n.size[0],d=this._tileTextures[a];d?d.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||_||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),_&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,a){this.cache=this.cache||{};const d=a&&a.defines||[],_=a&&a.config,b=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(d),T=jh.cacheKey(Oh[n],n,b,_);return this.cache[T]||(this.cache[T]=new jh(this.context,n,Oh[n],_,T_[n],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const b=((T,P,k)=>{const G=T.properties.get("direction"),q=T.properties.get("color-use-theme")==="none",te=T.properties.get("color").toNonPremultipliedRenderColor(q?null:k.getLut(T.scope)).toArray01(),Y=T.properties.get("intensity"),re=P.properties.get("color-use-theme")==="none",le=P.properties.get("color").toNonPremultipliedRenderColor(re?null:k.getLut(P.scope)).toArray01(),ce=P.properties.get("intensity"),Pe=[G.x,G.y,G.z],me=r.dK(le,ce),Me=r.dK(te,Y);return{u_lighting_ambient_color:me,u_lighting_directional_dir:Pe,u_lighting_directional_color:Me,u_ground_radiance:Uh(Pe,Me,me)}})(d,_,this.style);a.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,a,d,_,b){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const P=T.getOpacity(this.transform.pitch),k=((G,q,te,Y,re,le,ce,Pe,me,Me,Le,Fe)=>{const Ze=G.transform,He=q.properties.get("color-use-theme")==="none",Ye=q.properties.get("color").toNonPremultipliedRenderColor(He?null:G.style.getLut(q.scope)).toArray01();Ye[3]=Y;const qe=G.frameCounter/1e3%1,[We,Xe]=q.properties.get("vertical-range");return{u_fog_matrix:te?Ze.calculateFogTileMatrix(te):Fe||G.identityMat,u_fog_range:q.getFovAdjustedRange(Ze._fov),u_fog_color:Ye,u_fog_horizon_blend:q.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(We,Xe),Xe],u_fog_temporal_offset:qe,u_frustum_tl:re,u_frustum_tr:le,u_frustum_br:ce,u_frustum_bl:Pe,u_globe_pos:me,u_globe_radius:Me,u_viewport:Le,u_globe_transition:r.aj(Ze.zoom),u_is_globe:+(Ze.projection.name==="globe")}})(this,T,d,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],_);a.setFogUniformValues(n,k)}b&&a.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)a[_.key]=n[_.key]||new fc(_,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,a){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=qn||a[1]>=qn}setupDepthForOcclusion(n,a,d){const _=this.context,b=_.gl,T=!!d;var P;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),_.activeTexture.set(b.TEXTURE0),T||a.setTerrainUniformValues(_,d)}}function Jh(h,n){let a=!1,d=null;const _=()=>{d=null,a&&(h(),d=setTimeout(_,n),a=!1)};return()=>(a=!0,d||_(),d)}class dp{constructor(n){this._hashName=n&&encodeURIComponent(n),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jh(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=hp(n);if(this._hashName){const d=this._hashName;let _=!1;const b=location.hash.slice(1).split("&").map((T=>{const P=T.split("=")[0];return P===d?(_=!0,`${P}=${a}`):T})).filter((T=>T));return _||b.push(`${d}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(a=d)})),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((d=>isNaN(Number(d))))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function hp(h,n){const a=h.getCenter(),d=Math.round(100*h.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),T=Math.round(a.lng*b)/b,P=Math.round(a.lat*b)/b,k=h.getBearing(),G=h.getPitch();let q=n?`/${T}/${P}/${d}`:`${d}/${P}/${T}`;return(k||G)&&(q+="/"+Math.round(10*k)/10),G&&(q+=`/${Math.round(G)}`),q}const ea={linearity:.3,easing:r.eK(0,0,.3,1)},Ac=Object.assign({deceleration:2500,maxSpeed:1400},ea),Yd=Object.assign({deceleration:20,maxSpeed:1400},ea),fp=Object.assign({deceleration:1e3,maxSpeed:360},ea),_m=Object.assign({deceleration:1e3,maxSpeed:90},ea);class pp{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=r.o.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const b=Ho(a.pan.mag(),d,Object.assign({},Ac,n||{}));_.offset=a.pan.mult(b.amount/a.pan.mag()),_.center=this._map.transform.center,Sl(_,b)}if(a.zoom){const b=Ho(a.zoom,d,Yd);_.zoom=this._map.transform.zoom+b.amount,Sl(_,b)}if(a.bearing){const b=Ho(a.bearing,d,fp);_.bearing=this._map.transform.bearing+r.aA(b.amount,-179,179),Sl(_,b)}if(a.pitch){const b=Ho(a.pitch,d,_m);_.pitch=this._map.transform.pitch+b.amount,Sl(_,b)}if(_.zoom||_.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Sl(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function Ho(h,n,a){const{maxSpeed:d,linearity:_,deceleration:b}=a,T=r.aA(h*_/(n/1e3),-d,d),P=Math.abs(T)/(b*_);return{easing:a.easing,duration:1e3*P,amount:T*(P/2)}}class zo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,_={}){const b=ae(a.getCanvasContainer(),d),T=a.unproject(b);super(n,Object.assign({point:b,lngLat:T,originalEvent:d},_)),this._defaultPrevented=!1,this.target=a}}class Xd extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const _=n==="touchend"?d.changedTouches:d.touches,b=oe(a.getCanvasContainer(),_),T=b.map((k=>a.unproject(k))),P=b.reduce(((k,G,q,te)=>k.add(G.div(te.length))),new r.P(0,0));super(n,{points:b,point:P,lngLats:T,lngLat:a.unproject(P),originalEvent:d}),this._defaultPrevented=!1}}class Qh extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class mp{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Qh(this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new zo(n.type,this._map,n))}mouseup(n){this._map.fire(new zo(n.type,this._map,n))}preclick(n){const a=new MouseEvent("preclick",n);this._map.fire(new zo(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new zo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new zo(n.type,this._map,n))}mouseover(n){this._map.fire(new zo(n.type,this._map,n))}mouseout(n){this._map.fire(new zo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Xd(n.type,this._map,n))}touchmove(n){this._map.fire(new Xd(n.type,this._map,n))}touchend(n){this._map.fire(new Xd(n.type,this._map,n))}touchcancel(n){this._map.fire(new Xd(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class su{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new zo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new zo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fo{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Z(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a,_=this._startPos,b=this._lastPos;if(!_||!b||b.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=O("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(_.x,d.x),P=Math.max(_.x,d.x),k=Math.min(_.y,d.y),G=Math.max(_.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${T}px,${k}px)`,this._box.style.width=P-T+"px",this._box.style.height=G-k+"px")}))}mouseupWindow(n,a){if(!this._active)return;const d=this._startPos,_=a;if(d&&n.button===0){if(this.reset(),ge(),d.x!==_.x||d.y!==_.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),X(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new r.z(n,{originalEvent:a}))}}function Jl(h,n){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=n[d];return a}class au{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=(function(_){const b=new r.P(0,0);for(const T of _)b._add(T);return b.div(_.length)})(a),this.touches=Jl(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const _=Jl(d,a);for(const b in this.touches){const T=_[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Os{constructor(n){this.singleTap=new au(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const _=this.singleTap.touchend(n,a,d);if(_){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Yu{constructor(){this._zoomIn=new Os({numTouches:1,numTaps:2}),this._zoomOut=new Os({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const _=this._zoomIn.touchend(n,a,d),b=this._zoomOut.touchend(n,a,d);return _?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ym={0:1,2:2},Xu={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class lu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const d=fe(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&(function(_,b){const T=ym[b];return _.buttons===void 0||(_.buttons&T)!==T})(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&fe(n)===this._eventButton&&(this._moved&&ge(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pc extends lu{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Kd extends lu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Xu[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class gp extends lu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Xu[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class vm{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!r.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const _=Jl(d,a),b=new r.P(0,0),T=new r.P(0,0);let P=0;for(const G in _){const q=_[G],te=this._touches[G];te&&(b._add(q),T._add(q.sub(te)),P++,_[G]=q)}if(this._touches=_,P<this._minTouches||!T.mag())return;const k=T.div(P);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class ta{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[b,T]=_,P=Ku(d,a,b),k=Ku(d,a,T);if(!P||!k)return;const G=this._aroundCenter?null:P.add(k).div(2);return this._move([P,k],G,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,T=Ku(d,a,_),P=Ku(d,a,b);T&&P||(this._active&&ge(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ku(h,n,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return n[d]}function _p(h,n){return Math.log2(h/n)}class yp extends ta{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(_p(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_p(this._distance,d),pinchAround:a}}}function xm(h,n){return 180*h.angleWith(n)/Math.PI}class xg extends ta{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const d=this._vector;if(this._vector=n[0].sub(n[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xm(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=xm(n,d);return Math.abs(_)<a}}function vp(h){return Math.abs(h.y)>Math.abs(h.x)}class Jd extends ta{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,vp(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){const _=this._lastPoints;if(!_)return;const b=n[0].sub(_[0]),T=n[1].sub(_[1]);return this._map._cooperativeGestures&&!r.eL()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,b=a.mag()>=2;if(!_&&!b)return;if(!_||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=n.y>0==a.y>0;return vp(n)&&vp(a)&&T}}const wa={panStep:100,bearingStep:15,pitchStep:10};class xp{constructor(){const n=wa;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,_=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:P=>{const k=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:bm,zoom:a?Math.round(k)+a*(n.shiftKey?2:1):k,bearing:P.getBearing()+d*this._bearingStep,pitch:P.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:P.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bm(h){return h*(2-h)}const ef=4.000244140625,wm=1/450;class Ju{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=wm,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=r.o.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%ef==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ae(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>ef?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&q!==0&&(q=1/q);const te=a(),Y=Math.pow(2,te),re=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):Y;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(re*q))),this._type==="wheel"&&(this._startZoom=te,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,b=this._easing;let T,P=!1;if(this._type==="wheel"&&_&&b){const G=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),q=b(G);T=r.ak(_,d,q),G<1?this._frameId||(this._frameId=!0):P=!0}else T=d,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let k=T-a();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=r.eM;if(this._prevEase){const d=this._prevEase,_=(r.o.now()-d.start)/d.duration,b=d.easing(_+.01)-d.easing(_),T=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-T*T);a=r.eK(T,P,.25,1)}return this._prevEase={start:r.o.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Qu{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bp{constructor(){this._tap=new Os({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=a[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ya{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pi{constructor(n,a,d,_){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oa=h=>h.zoom||h.drag||h.pitch||h.rotate;class Mc extends r.z{}class Ls{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const d=r.av([],a,n);this.radius=r.ag(d[2]<0?r.eO([],d,this.constants):[d[0],d[1],0])}projectRay(n){r.eO(n,n,this.constants),r.aw(n,n),r.eP(n,n,this.constants);const a=r.c4([],n,this.radius);if(a[2]>0){const d=r.c4([],[0,0,1],r.bJ(a,[0,0,1])),_=r.c4([],r.aw([],[a[0],a[1],0]),this.radius),b=r.d7([],a,r.c4([],r.av([],r.d7([],_,d),a),2));a[0]=b[0],a[1]=b[1]}return a}}function cu(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Xa{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pp(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ls,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,b,T]of this._listeners){const P=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(b,P,T)}}destroy(){for(const[n,a,d]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,_,d)}}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new mp(a,n));const _=a.boxZoom=new Fo(a,n);this._add("boxZoom",_);const b=new Yu,T=new tf;a.doubleClickZoom=new Qu(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const P=new bp;this._add("tapDragZoom",P);const k=a.touchPitch=new Jd(a);this._add("touchPitch",k);const G=new Kd(n),q=new gp(n);a.dragRotate=new Ya(n,G,q),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const te=new Pc(n),Y=new vm(a,n);a.dragPan=new Za(d,te,Y),this._add("mousePan",te),this._add("touchPan",Y,["touchZoom","touchRotate"]);const re=new xg,le=new yp;a.touchZoomRotate=new Pi(d,le,re,P),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new su(a));const ce=a.scrollZoom=new Ju(a,this);this._add("scrollZoom",ce,["mousePan"]);const Pe=a.keyboard=new xp;this._add("keyboard",Pe);for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[me]&&a[me].enable(n[me])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oa(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,d){for(const _ in n)if(_!==d&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;const d=n.type==="renderFrame",_=d?void 0:n,b={needsRenderFrame:!1},T={},P={},k=n.touches?this._getMapTouches(n.touches):void 0,G=k?oe(this._el,k):d?void 0:ae(this._el,n);for(const{handlerName:Y,handler:re,allowed:le}of this._handlers){if(!re.isEnabled())continue;let ce;this._blockedByActive(P,le,Y)?re.reset():re[a||n.type]&&(ce=re[a||n.type](n,G,k),this.mergeHandlerResult(b,T,ce,Y,_),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||re.isActive())&&(P[Y]=re)}const q={};for(const Y in this._previousActiveHandlers)P[Y]||(q[Y]=_);this._previousActiveHandlers=P,(Object.keys(q).length||cu(b))&&(this._changes.push([b,T,q]),this._triggerRenderFrame()),(Object.keys(P).length||cu(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=b;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))}mergeHandlerResult(n,a,d,_,b){if(!d)return;Object.assign(n,d);const T={handlerName:_,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(a.zoom=T),d.panDelta!==void 0&&(a.drag=T),d.pitchDelta!==void 0&&(a.pitch=T),d.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const n={},a={},d={};for(const[_,b,T]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),Object.assign(a,b),Object.assign(d,T);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const _=this._map,b=_.transform,T=Me=>[Me.x,Me.y,Me.z];if((Me=>{const Le=this._eventsInProgress.drag;return Le&&!this._handlersById[Le.handlerName].isActive()})()&&!cu(n)){const Me=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Me!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&_._stop(!0),!cu(n))return void this._fireEvents(a,d,!0);let{panDelta:P,zoomDelta:k,bearingDelta:G,pitchDelta:q,around:te,aroundCoord:Y,pinchAround:re}=n;b._isCameraConstrained&&(k>0&&(k=0),b._isCameraConstrained=!1),re!==void 0&&(te=re),(k||(Me=>a[Me]&&!this._eventsInProgress[Me])("drag"))&&te&&(this._dragOrigin=T(b.pointCoordinate3D(te)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",_._stop(!0),te=te||_.transform.centerPoint,G&&(b.bearing+=G),q&&(b.pitch+=q),b._updateCameraState();const le=[0,0,0];if(P)if(b.projection.name==="mercator"){const Me=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(te).dir),Le=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(te.sub(P)).dir);le[0]=Le[0]-Me[0],le[1]=Le[1]-Me[1]}else{const Me=b.pointCoordinate(te);if(b.projection.name==="globe"){P=P.rotate(-b.angle);const Le=b._pixelsPerMercatorPixel/b.worldSize;le[0]=-P.x*r.eN(r.a$(Me.y))*Le,le[1]=-P.y*r.eN(b.center.lat)*Le}else{const Le=b.pointCoordinate(te.sub(P));Me&&Le&&(le[0]=Le.x-Me.x,le[1]=Le.y-Me.y)}}const ce=b.zoom,Pe=[0,0,0];if(k){const Me=T(Y||b.pointCoordinate3D(te)),Le={dir:r.aw([],r.av([],Me,b._camera.position))};if(Le.dir[2]<0){const Fe=b.zoomDeltaToMovement(Me,k);r.c4(Pe,Le.dir,Fe)}}const me=r.d7(le,le,Pe);b._translateCameraConstrained(me),k&&Math.abs(b.zoom-ce)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){const _=Oa(this._eventsInProgress),b=Oa(n),T={};for(const q in n){const{originalEvent:te}=n[q];this._eventsInProgress[q]||(T[`${q}start`]=te),this._eventsInProgress[q]=n[q]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in T)this._fireEvent(q,T[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in n){const{originalEvent:te}=n[q];this._fireEvent(q,te)}const P={};let k;for(const q in this._eventsInProgress){const{handlerName:te,originalEvent:Y}=this._eventsInProgress[q];this._handlersById[te].isActive()||(delete this._eventsInProgress[q],k=a[te]||Y,P[`${q}end`]=k)}for(const q in P)this._fireEvent(q,P[q]);const G=Oa(this._eventsInProgress);if(d&&(_||b)&&!G){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;q?(te(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:k})):(this._map.fire(new r.z("moveend",{originalEvent:k})),te(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new r.z(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new Mc("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class zs extends r.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},a),d)}panTo(n,a,d){return this.easeTo(Object.assign({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(Object.assign({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(Object.assign({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,Object.assign({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=r.aI.convert(n);const d=a&&a.bearing||0,_=a&&a.pitch||0,b=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,b,T,d,_,a)}_extendPadding(n){const a={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},a,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},a,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,a){const d=a.max[0]-a.min[0],_=a.max[1]-a.min[1];return d/_>n.aspect?d/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,d,_,b,T){const P=n.clone(),k=this._extendCameraOptions(T);P.bearing=_,P.pitch=b;const G=r.aR.convert(a),q=r.aR.convert(d),te=.5*(G.lat+q.lat),Y=.5*(G.lng+q.lng),re=r.eQ(te,Y),le=r.aw([],re),ce=r.aw([],r.bI([],le,[0,1,0])),Pe=r.bI([],ce,le),me=[ce[0],ce[1],ce[2],0,Pe[0],Pe[1],Pe[2],0,le[0],le[1],le[2],0,0,0,0,1],Me=[re,r.eQ(G.lat,G.lng),r.eQ(q.lat,G.lng),r.eQ(q.lat,q.lng),r.eQ(G.lat,q.lng),r.eQ(te,G.lng),r.eQ(te,q.lng),r.eQ(G.lat,Y),r.eQ(q.lat,Y)];let Le=r.d8.fromPoints(Me.map((wt=>[r.bJ(ce,wt),r.bJ(Pe,wt),r.bJ(le,wt)])));const Fe=r.af([],Le.center,me);r.eR(Fe)===0&&r.eS(Fe,0,0,1),r.aw(Fe,Fe),r.c4(Fe,Fe,r.aD),P.center=r.eT(Fe);const Ze=P.getWorldToCameraMatrix(),He=r.bl(new Float64Array(16),Ze);Le=r.d8.applyTransform(Le,r.aB([],Ze,me));const Ye=this._extendAABB(Le,P,k,_);if(!Ye)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Le=Ye,r.af(Fe,Fe,Ze);const qe=.5*(Le.max[2]-Le.min[2]),We=this._minimumAABBFrustumDistance(P,Le),Xe=r.c4([],[0,0,1],qe),Tt=r.d7(Xe,Fe,Xe),ht=We+(P.pitch===0?0:r.bG(Fe,Tt)),Lt=P.globeCenterInViewSpace,bt=r.av([],Fe,[Lt[0],Lt[1],Lt[2]]);r.aw(bt,bt),r.c4(bt,bt,ht);const Pt=r.d7([],Fe,bt);r.af(Pt,Pt,He);const nn=r.eD/r.aD,St=r.ag(Pt),rt=r.ce(Math.max(St*nn-r.eD,Number.EPSILON),0),zt=Math.min(P.zoomFromMercatorZAdjusted(rt),k.maxZoom);return zt>.5*(r.cZ+r.cK)?(P.setProjection({name:"mercator"}),P.zoom=zt,this._cameraForBounds(P,a,d,_,b,T)):{center:P.center,zoom:zt,bearing:_,pitch:b}}_extendAABB(n,a,d,_){const b=.5*((d.padding.left||0)+(d.padding.right||0)),T=.5*((d.padding.top||0)+(d.padding.bottom||0)),P=T,k=b,G=b,q=T,te=a.width-(k+G),Y=a.height-(P+q),re=r.av([],n.max,n.min),le=Math.min(te/re[0],Y/re[1]),ce=Math.min(a.scaleZoom(a.scale*le),d.maxZoom);if(isNaN(ce))return null;const Pe=a.scale/a.zoomScale(ce),me=new r.d8([n.min[0]-k*Pe,n.min[1]-q*Pe,n.min[2]],[n.max[0]+G*Pe,n.max[1]+P*Pe,n.max[2]]),Me=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new r.P(d.offset.x,d.offset.y):r.P.convert(d.offset)).rotate(-r.an(_));return me.center[0]-=Me.x*Pe,me.center[1]+=Me.y*Pe,me}queryTerrainElevation(n,a){const d=this.transform.elevation;return d?(a=Object.assign({},{exaggerated:!0},a),d.getAtPoint(r.ae.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,d,_,b,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,d,_,b,T);const P=n.clone(),k=this._extendCameraOptions(T);P.bearing=_,P.pitch=b;const G=r.aR.convert(a),q=r.aR.convert(d),te=new r.aR(G.lng,q.lat),Y=new r.aR(q.lng,G.lat),re=P.project(G),le=P.project(q),ce=this.queryTerrainElevation(G),Pe=this.queryTerrainElevation(q),me=this.queryTerrainElevation(te),Me=this.queryTerrainElevation(Y),Le=[[re.x,re.y,Math.min(ce||0,Pe||0,me||0,Me||0)],[le.x,le.y,Math.max(ce||0,Pe||0,me||0,Me||0)]];let Fe=r.d8.fromPoints(Le);const Ze=P.getWorldToCameraMatrix(),He=r.bl(new Float64Array(16),Ze);Fe=r.d8.applyTransform(Fe,Ze);const Ye=this._extendAABB(Fe,P,k,_);if(!Ye)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Fe=Ye;const qe=.5*r.av([],Fe.max,Fe.min)[2],We=this._minimumAABBFrustumDistance(P,Fe),Xe=[0,0,1,0];r.aC(Xe,Xe,Ze),r.eU(Xe,Xe);const Tt=r.c4([],Xe,We+qe),ht=r.d7([],Fe.center,Tt);r.af(Fe.center,Fe.center,He),r.af(ht,ht,He);const Lt=P.unproject(new r.P(Fe.center[0],Fe.center[1])),bt=r.eV(P.projection,Lt),Pt=Math.pow(2,bt),nn=Math.min(P._zoomFromMercatorZ(ht[2]*P.pixelsPerMeter*Pt/P.worldSize),k.maxZoom);return P.mercatorFromTransition&&nn<.5*(r.cZ+r.cK)?(P.setProjection({name:"globe"}),P.zoom=nn,this._cameraForBounds(P,a,d,_,b,T)):{center:Lt,zoom:nn,bearing:_,pitch:b}}fitBounds(n,a,d){const _=this.cameraForBounds(n,a);return this._fitInternal(_,a,d)}fitScreenCoordinates(n,a,d,_,b){const T=r.P.convert(n),P=r.P.convert(a),k=new r.P(Math.min(T.x,P.x),Math.min(T.y,P.y)),G=new r.P(Math.max(T.x,P.x),Math.max(T.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,P))return this;const q=this.transform.pointLocation3D(k),te=this.transform.pointLocation3D(G),Y=this.transform.pointLocation3D(new r.P(k.x,G.y)),re=this.transform.pointLocation3D(new r.P(G.x,k.y)),le=[Math.min(q.lng,te.lng,Y.lng,re.lng),Math.min(q.lat,te.lat,Y.lat,re.lat)],ce=[Math.max(q.lng,te.lng,Y.lng,re.lng),Math.max(q.lat,te.lat,Y.lat,re.lat)],Pe=_&&_.pitch?_.pitch:this.getPitch(),me=this._cameraForBounds(this.transform,le,ce,d,Pe,_);return this._fitInternal(me,_,b)}_fitInternal(n,a,d){return n?(a=Object.assign(n,a)).linear?this.easeTo(a,d):this.flyTo(a,d):this}jumpTo(n,a){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let _=!1,b=!1,T=!1;"zoom"in n&&d.zoom!==+n.zoom&&(_=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=r.aR.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(b=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(T=!0,d.pitch=+n.pitch);const P=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!d.isPaddingEqual(P))if(n.retainPadding===!1){const k=d.clone();k.padding=P,d.setLocationAtPoint(d.center,k.centerPoint)}else d.padding=P;return n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),_&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),b&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),T&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Qd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return r.w(Qd),this;this.stop();const _=d.zoom,b=d.pitch,T=d.bearing;d.setFreeCameraOptions(n);const P=_!==d.zoom,k=b!==d.pitch,G=T!==d.bearing;return this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),P&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),G&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),k&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:r.eM},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const d=this.transform,_=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),k="zoom"in n?+n.zoom:_,G="bearing"in n?this._normalizeBearing(n.bearing,b):b,q="pitch"in n?+n.pitch:T,te=this._extendPadding(n.padding),Y=r.P.convert(n.offset);let re,le,ce;if(d.projection.name==="globe"){const Xe=r.ae.fromLngLat(d.center),Tt=Y.rotate(-d.angle);Xe.x+=Tt.x/d.worldSize,Xe.y+=Tt.y/d.worldSize;const ht=Xe.toLngLat(),Lt=r.aR.convert(n.center||ht);this._normalizeCenter(Lt),re=d.centerPoint.add(Tt),le=new r.P(Xe.x,Xe.y).mult(d.worldSize),ce=new r.P(r.aF(Lt.lng),r.aJ(Lt.lat)).mult(d.worldSize).sub(le)}else{re=d.centerPoint.add(Y);const Xe=d.pointLocation(re),Tt=r.aR.convert(n.center||Xe);this._normalizeCenter(Tt),le=d.project(Xe),ce=d.project(Tt).sub(le)}const Pe=d.zoomScale(k-_);let me,Me;n.around&&(me=r.aR.convert(n.around),Me=d.locationPoint(me));const Le=this._zooming||k!==_,Fe=this._rotating||b!==G,Ze=this._pitching||q!==T,He=!d.isPaddingEqual(te),Ye=n.retainPadding===!1?d.clone():d,qe=Xe=>Tt=>{if(Le&&(Xe.zoom=r.ak(_,k,Tt)),Fe&&(Xe.bearing=r.ak(b,G,Tt)),Ze&&(Xe.pitch=r.ak(T,q,Tt)),He&&(Ye.interpolatePadding(P,te,Tt),re=Ye.centerPoint.add(Y)),me)Xe.setLocationAtPoint(me,Me);else{const ht=Xe.zoomScale(Xe.zoom-_),Lt=k>_?Math.min(2,Pe):Math.max(.5,Pe),bt=Math.pow(Lt,1-Tt),Pt=Xe.unproject(le.add(ce.mult(Tt*bt)).mult(ht));Xe.setLocationAtPoint(Xe.renderWorldCopies?Pt.wrap():Pt,re)}return n.preloadOnly||this._fireMoveEvents(a),Xe};if(n.preloadOnly){const Xe=this._emulate(qe,n.duration,d);return this._preloadTiles(Xe),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Le,this._rotating=Fe,this._pitching=Ze,this._padding=He,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,We),this._ease(qe(d),(Xe=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,Xe)}),n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new r.z("movestart",n)),this._zooming&&!d.zooming&&this.fire(new r.z("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new r.z("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new r.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.z("move",n)),this._zooming&&this.fire(new r.z("zoom",n)),this._rotating&&this.fire(new r.z("rotate",n)),this._pitching&&this.fire(new r.z("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new r.z("zoomend",n)),_&&this.fire(new r.z("rotateend",n)),b&&this.fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const wt=r.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(wt,a)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eM},n);const d=this.transform,_=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),k="zoom"in n?r.aA(+n.zoom,d.minZoom,d.maxZoom):_,G="bearing"in n?this._normalizeBearing(n.bearing,b):b,q="pitch"in n?+n.pitch:T,te=this._extendPadding(n.padding),Y=d.zoomScale(k-_),re=r.P.convert(n.offset);let le=d.centerPoint.add(re);const ce=d.pointLocation(le),Pe=r.aR.convert(n.center||ce);this._normalizeCenter(Pe);const me=d.project(ce),Me=d.project(Pe).sub(me);let Le=n.curve;const Fe=Math.max(d.width,d.height),Ze=Fe/Y,He=Me.mag();if("minZoom"in n){const wt=r.aA(Math.min(n.minZoom,_,k),d.minZoom,d.maxZoom),Zt=Fe/d.zoomScale(wt-_);Le=Math.sqrt(Zt/He*2)}const Ye=Le*Le;function qe(wt){const Zt=(Ze*Ze-Fe*Fe+(wt?-1:1)*Ye*Ye*He*He)/(2*(wt?Ze:Fe)*Ye*He);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function We(wt){return(Math.exp(wt)-Math.exp(-wt))/2}function Xe(wt){return(Math.exp(wt)+Math.exp(-wt))/2}const Tt=qe(0);let ht=function(wt){return Xe(Tt)/Xe(Tt+Le*wt)},Lt=function(wt){return Fe*((Xe(Tt)*(We(Zt=Tt+Le*wt)/Xe(Zt))-We(Tt))/Ye)/He;var Zt},bt=(qe(1)-Tt)/Le;if(Math.abs(He)<1e-6||!isFinite(bt)){if(Math.abs(Fe-Ze)<1e-6)return this.easeTo(n,a);const wt=Ze<Fe?-1:1;bt=Math.abs(Math.log(Ze/Fe))/Le,Lt=function(){return 0},ht=function(Zt){return Math.exp(wt*Le*Zt)}}n.duration="duration"in n?+n.duration:1e3*bt/("screenSpeed"in n?+n.screenSpeed/Le:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Pt=b!==G,nn=q!==T,St=!d.isPaddingEqual(te),rt=n.retainPadding===!1?d.clone():d,zt=wt=>Zt=>{const sn=Zt*bt,Sn=1/ht(sn);wt.zoom=Zt===1?k:_+wt.scaleZoom(Sn),Pt&&(wt.bearing=r.ak(b,G,Zt)),nn&&(wt.pitch=r.ak(T,q,Zt)),St&&(rt.interpolatePadding(P,te,Zt),le=rt.centerPoint.add(re));const Ht=Zt===1?Pe:wt.unproject(me.add(Me.mult(Lt(sn))).mult(Sn));return wt.setLocationAtPoint(wt.renderWorldCopies?Ht.wrap():Ht,le),wt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),wt};if(n.preloadOnly){const wt=this._emulate(zt,n.duration,d);return this._preloadTiles(wt),this}return this._zooming=!0,this._rotating=Pt,this._pitching=nn,this._padding=St,this._prepareEase(a,!1),this._ease(zt(d),(()=>this._afterEase(a)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=r.o.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=r.bT(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,d){const _=Math.ceil(15*a/1e3),b=[],T=n(d.clone());for(let P=0;P<=_;P++){const k=T(P/_);b.push(k.clone())}return b}_preloadTiles(n,a){}}class Wo{constructor(n={}){this.options=n,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact,d=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=O("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=O("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(n){const d=a.reduce(((_,b,T)=>(b.value&&(_+=`${b.key}=${b.value}${T<a.length-1?"&":""}`),_)),"?");n.href=`${r.e.FEEDBACK_URL}/${d}#${hp(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._mergedSourceCaches;for(const _ in a){const b=a[_];if(b.used){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort(((_,b)=>_.length-b.length)),n=n.filter(((_,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(_)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ci{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=O("div","mapboxgl-ctrl");const a=O("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Tl{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(a=>this._onIndoorUpdate({selectedFloorId:a.selectedFloorId,floors:a.floors}))),this._container}_createButton(n,a){const d=O("button",n,this._container);return d.type="button",d.addEventListener("click",a),d}_createSeparator(){return O("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,a){this._map&&(n.setAttribute("aria-label",a),n.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return void(this._container.style.display="none");const a=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const d=n.floors.sort(((_,b)=>b.levelOrder-_.levelOrder));a?(Array.from(this._container.children).forEach((_=>_.remove())),this.addCurrentFloors(d)):this.addCurrentFloors(d)}addCurrentFloors(n){for(let a=0;a<n.length;a++){const d=n[a],_=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(d.id),this._model&&(this._model.selectedFloorId=d.id),Array.from(this._container.children).forEach((b=>{b.classList.contains("mapboxgl-ctrl-level-button")&&b.classList.remove("mapboxgl-ctrl-level-button-selected")})),_.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(_,d.shortName),this._model&&d.id===this._model.selectedFloorId&&_.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(_),a<n.length-1&&this._createSeparator()}}}class Bi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const _ of d)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ka{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=r.dz((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}const Fs={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class uu extends r.z{constructor(n,a,d,_){const{point:b,lngLat:T,originalEvent:P,target:k}=n;super(n.type,{point:b,lngLat:T,originalEvent:P,target:k}),this.preventDefault=()=>{n.preventDefault()},this.id=a,this.interaction=d,this.feature=_}}class du{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,a){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const d=a.filter;let _=a.type;d&&this.filters.set(n,r.b6(d)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const b=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,a)):b.size===0&&this.map.on(_,this.handleType),b.size===0&&this.interactionsByType.set(_,b),b.set(n,a),this.typeById.set(n,_)}get(n){const a=this.typeById.get(n);if(!a)return;const d=this.interactionsByType.get(a);return d?d.get(n):void 0}remove(n){const a=this.typeById.get(n);if(!a)return;this.typeById.delete(n),this.filters.delete(n);const d=this.interactionsByType.get(a);d&&(d.delete(n),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(a,this.handleType))}queryTargets(n,a){const d=[];for(const[_,b]of a)b.target&&d.push({targetId:_,target:b.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(n,d,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());a.length&&(n.type="mouseenter",this.handleType(n,a));const d=new Map;for(const[_,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||d.set(b.id,b);d.size&&(n.type="mouseleave",this.handleType(n,Array.from(d.values())))}handleOut(n){const a=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));a.length&&(n.type="mouseleave",this.handleType(n,a)),this.hoveredFeatures.clear()}handleType(n,a){const d=n.type==="mouseenter";if(d&&!this.interactionsByType.has(n.type))return void r.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!a;a=a||this.queryTargets(n.point,_);let T=!1;const P=new Set;for(const k of a){for(const[G,q]of _){if(!q.target)continue;const te=k.variants?k.variants[G]:null;if(te){for(const Y of te){if(hc(Y,k,P,G))continue;const re=new r.dt(k,Y),le=md(Y,k,G);b&&(re.state=this.map.getFeatureState(re));const ce=d?this.prevHoveredFeatures.get(le):null,Pe=new uu(n,G,q,re),me=ce?ce.stop:q.handler(Pe);if(d&&this.hoveredFeatures.set(le,{feature:k,stop:me}),me!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[k,G]of _){const{handler:q,target:te}=G;if(!te&&q(new uu(n,k,G,null))!==!1)break}}}function Ic(h,n){if(Array.isArray(h)&&Array.isArray(n)){const a=new Set(h),d=new Set(n);return a.size===d.size&&h.every((_=>d.has(_)))}return r.by(h,n)}const nf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},I_={showCompass:!0,showZoom:!0,visualizePitch:!1};class R_{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Kd({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new gp({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Z()}move(n,a){const d=this.map,_=this.mouseRotate.mousemoveWindow(n,a),b=_&&_.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,a),P=T&&T.pitchDelta;P&&d.setPitch(d.getPitch()+P)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){X(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ae(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ae(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=oe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Bo(h,n,a){if(h=new r.aR(h.lng,h.lat),n){const d=new r.aR(h.lng-360,h.lat),_=new r.aR(h.lng+360,h.lat),b=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),T=a.locationPoint3D(h).distSqr(n),P=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint3D(d).distSqr(n)<T&&(P||Math.abs(d.lng-a.center.lng)<b)?h=d:a.locationPoint3D(_).distSqr(n)<T&&(P||Math.abs(_.lng-a.center.lng)<b)&&(h=_)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const hu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},bs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Rc extends r.E{constructor(n,a){super(),(n instanceof HTMLElement||a)&&(n=Object.assign({element:n},a)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:_="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:P=0,rotation:k=bs.rotation,rotationAlignment:G=bs.rotationAlignment,pitchAlignment:q=bs.pitchAlignment,occludedOpacity:te=bs.occludedOpacity,altitude:Y=bs.altitude}=n||{};this._anchor=d,this._color=_,this._scale=b,this._draggable=T,this._clickTolerance=P,this._rotation=k,this._rotationAlignment=G,this._pitchAlignment=q,this._occludedOpacity=te,this._altitude=Y,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(ce=>{ce.preventDefault()})),this._element.addEventListener("mousedown",(ce=>{ce.preventDefault()}));const re=this._element.classList;for(const ce in hu)re.remove(`mapboxgl-marker-anchor-${ce}`);re.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=n&&n.className?n.className.trim().split(/\s+/):[];re.add(...le),this._popup=null}_createDefaultMarker(){const n=O("div"),a=N("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const d=N("radialGradient",{id:"shadowGradient"},N("defs",{},a));N("stop",{offset:"10%","stop-opacity":.4},d),N("stop",{offset:"100%","stop-opacity":.05},d),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.aR.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||bs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const d=n.unproject(a,this._altitude),_=n.getFreeCameraOptions();if(!_.position)return!1;const b=_.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(a,this._altitude);let _;n._showingGlobe()&&r.eY(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${hu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){const k=a.getPitch();return k?`rotateX(${k}deg)`:""}const _=r.cW(r.eZ(a.transform,this._lngLat)),b=n.sub(r.e_(a.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const P=_/T;return`rotateX(${-b.y*P}deg) rotateY(${b.x*P}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const b=a.project(new r.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=a.project(new r.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);d=r.cW(Math.atan2(T.y,T.x))-90}else d=-a.getBearing();else if(_==="horizon"){const b=r.ah(4,6,a.getZoom()),T=r.e_(a.transform);T.y+=b*a.transform.height;const P=n.sub(T),k=r.cW(Math.atan2(P.y,P.x));d=(k>90?k-270:k+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Bo(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(n.point.dist(d)<b)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,d=this._pos;a&&d&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(d),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||bs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||bs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||bs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||bs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Cl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},El={maxWidth:100,unit:"metric"},Sa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Al={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},La=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ed(h=new r.P(0,0),n="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new r.P(0,h);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-h);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(h,0);case"right":return new r.P(-h,0)}return new r.P(0,0)}return h instanceof r.P||Array.isArray(h)?r.P.convert(h):r.P.convert(h[n]||[0,0])}return{version:E,supported:D.supported,setRTLTextPlugin:r.f2,getRTLTextPluginStatus:r.f1,Map:class extends zs{constructor(h){I.mark(A.create);const n=h;if((h=Object.assign({},nf,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&r.eW(window)&&(h.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new is(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Bi,this._domRenderTaskQueue=new Bi,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},Fs,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ka(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new J(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Wd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Xa(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||r.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new ku(this),h.hash&&(this._hash=new dp(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Wo({customAttribution:h.customAttribution})),this._logoControl=new Ci,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new r.z(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new r.z(`${a.dataType}dataloading`,a))})),this._interactions=new du(this)}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.z("movestart",h)).fire(new r.z("move",h)),this.fire(new r.z("resize",h)),n&&this.fire(new r.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(r.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((n=>n.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map((n=>n==="auto"?navigator.language:n)):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let a;n==="globe"&&h.zoom>=r.cK?(h.setMercatorFromTransition(),a=!0):n==="mercator"&&h.zoom<r.cK&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;return n=h.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,n){return this.transform.locationPoint3D(r.aR.convert(h),n)}unproject(h,n){return this.transform.pointLocation3D(r.P.convert(h),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,a){const d=_=>{let b=[];if(Array.isArray(n)){const T=n.filter((P=>this.getLayer(P)));b=T.length?this.queryRenderedFeatures(_,{layers:T}):[]}else b=this.queryRenderedFeatures(_,{target:n});return b};if(h==="mouseenter"||h==="mouseover"){let _=!1;return{listener:a,targets:n,delegates:{mousemove:T=>{const P=d(T.point);P.length?_||(_=!0,a.call(this,new zo(h,this,T.originalEvent,{features:P}))):_=!1},mouseout:()=>{_=!1}}}}if(h==="mouseleave"||h==="mouseout"){let _=!1;return{listener:a,targets:n,delegates:{mousemove:P=>{d(P.point).length?_=!0:_&&(_=!1,a.call(this,new zo(h,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,a.call(this,new zo(h,this,P.originalEvent)))}}}}{const _=b=>{const T=d(b.point);T.length&&(b.features=T,a.call(this,b),delete b.features)};return{listener:a,targets:n,delegates:{[h]:_}}}}on(h,n,a){if(typeof n=="function"||a===void 0)return super.on(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._createDelegatedListener(h,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(h,n,a){if(typeof n=="function"||a===void 0)return super.once(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._createDelegatedListener(h,n,a);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(h,n,a){if(typeof n=="function"||a===void 0)return super.off(h,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(_=>{for(let b=0;b<_.length;b++){const T=_[b];if(T.listener===a&&Ic(T.targets,n)){for(const P in T.delegates)this.off(P,T.delegates[P]);return _.splice(b,1),this}}})(d),this}queryRenderedFeatures(h,n){if(!this.style)return[];if(h===void 0||h instanceof r.P||Array.isArray(h)||n!==void 0||(n=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(h,void 0,this.transform),T=this.style.queryRenderedFeatureset(h,void 0,this.transform);return b.concat(T)}let a=!0;if(n.target&&(a=this._isTargetValid(n.target),a&&!n.layers))return this.style.queryRenderedFeatureset(h,n,this.transform);let d=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!n.target)return this.style.queryRenderedFeatures(h,n,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(h,n,this.transform))),a&&(_=_.concat(this.style.queryRenderedFeatureset(h,n,this.transform))),_}querySourceFeatures(h,n){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,n)}queryRasterValue(h,n,a){return this._isValidId(h)?this.style.queryRasterValue(h,n,a):Promise.resolve(null)}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(h))}addInteraction(h,n){return this._interactions.add(h,n),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&h&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(h,((a,d)=>{if(a){const _=typeof a=="string"?a:a instanceof Error?a.message:a.error;r.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(h,n)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const a=Object.assign({},n);n&&n.config&&(a.initialConfig=n.config,delete a.config),this.style=new Da(this,a).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Da(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dm(h)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const n of h)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(h)}addSource(h,n){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,n,{pixelRatio:a=1,sdf:d=!1,stretchX:_,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const P=r.I.from(h);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:k,height:G,data:q}=r.o.getImageData(n);this.style.addImage(P,{data:new r.q({width:k,height:G},q),pixelRatio:a,stretchX:_,stretchY:b,content:T,sdf:d,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:G}=n,q=n;this.style.addImage(P,{data:new r.q({width:k,height:G},new Uint8Array(q.data)),pixelRatio:a,stretchX:_,stretchY:b,content:T,sdf:d,usvg:!1,version:0,userImage:q}),q.onAdd&&q.onAdd(this,h)}}updateImage(h,n){this._lazyInitEmptyStyle();const a=r.I.from(h),d=this.style.getImage(a);if(!d)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.o.getImageData(n):n,{width:b,height:T,data:P}=_;if(b===void 0||T===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||T!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const k=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let G=!1;d.usvg?(d.data=new r.q({width:b,height:T},new Uint8Array(P)),d.usvg=!1,d.icon=void 0,G=!0):d.data.replace(P,k),this.style.updateImage(a,d,G)}hasImage(h){return h?!!this.style&&!!this.style.getImage(r.I.from(h)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(r.I.from(h))}loadImage(h,n){r.n(this._requestManager.transformRequest(h,r.R.Image),((a,d)=>{n(a,d instanceof HTMLImageElement?r.o.getImageData(d):d)}))}listImages(){return this.style.listImages().map((h=>h.name))}addModel(h,n){this._lazyInitEmptyStyle(),this.style.addModel(h,n)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,n){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)):this}getSlot(h){const n=this.getLayer(h);return n&&n.slot||null}setSlot(h,n){return this.style.setSlot(h,n),this.style.mergeLayers(),this._update(!0)}addImport(h,n){return this.style.addImport(h,n).catch((a=>this.fire(new r.y(new Error("Failed to add import",a))))),this}updateImport(h,n){return typeof n!="string"&&n.id!==h?(this.removeImport(h),this.addImport(n)):(this.style.updateImport(h,n),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,n){return this.style.moveImport(h,n),this._update(!0)}moveLayer(h,n){return this._isValidId(h)?(this.style.moveLayer(h,n),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const n=this.style.getOwnLayer(h);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,n,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,n,a),this._update(!0)):this}setFilter(h,n,a={}){return this._isValidId(h)?(this.style.setFilter(h,n,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,n,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,n,a,d),this._update(!0)):this}getPaintProperty(h,n){return this._isValidId(h)?this.style.getPaintProperty(h,n):null}setLayoutProperty(h,n,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,n,a,d),this._update(!0)):this}getLayoutProperty(h,n){return this._isValidId(h)?this.style.getLayoutProperty(h,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,n){return this.style.setSchema(h,n),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,n){return this.style.setConfig(h,n),this._update(!0)}getConfigProperty(h,n){return this.style.getConfigProperty(h,n)}setConfigProperty(h,n,a){return this.style.setConfigProperty(h,n,a),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const n=h[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,n),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aR.convert(h),this.transform):0}setFeatureState(h,n){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,n),this._update())}removeFeatureState(h,n){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,n),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.indoor.selectFloor(h)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Tl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,d,_,b=this._container;for(;b&&(!d||!_);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),b=b.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=O("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=O("div","mapboxgl-canvas-container",h);this._canvas=O("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=O("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((_=>{d[_]=O("div",`mapboxgl-ctrl-${_}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const a=r.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=Object.assign({},D.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",h);n?(jt(n,!0),this.painter=new up(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),r.k.testSupport(n)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;this.fire(new r.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,d=r.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,q=this.transform.pitch,te=r.o.now(),Y=new r.ac(G,{now:te,fadeDuration:b,pitch:q,transition:this.style.transition,worldview:this._worldview});this.style.update(Y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(d);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(A.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const G=r.o.now()-d;_.endQuery(a.TIME_ELAPSED_EXT),setTimeout((()=>{const q=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new r.z("gpu-timing-frame",{cpuTime:G,gpuTime:q}))}),50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout((()=>{const q=this.painter.queryGpuTimers(G);this.fire(new r.z("gpu-timing-layer",{layerTimes:q}))}),50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const q=this.painter.queryGpuTimeDeferredRender(G);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:q}))}),50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(k||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(T=this._updateAverageElevation(d,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const q=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,I.mark(A.fullLoad),this._performanceMetricsCollection&&ct(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const a=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=h;const T=Math.abs(_-b);if(T>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,h,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){xt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(h=>{if(h&&(h.message===ye||h.status===401)){const n=this.painter.context.gl;jt(n,!1),this._logoControl instanceof Ci&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),at(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&nt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function _(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(_(h),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(h,n,a){let d=a[1]-a[0];const _=h.length/4;for(let b=0;b<n.length;b++){const T=n[b];let P=0;for(let k=0;k<T.length;k+=4)T[k]===h[k]&&T[k+1]===h[k+1]&&T[k+2]===h[k+2]&&T[k+3]===h[k+3]&&(P+=1);d+=(a[b+2]-a[b+1])*(1-P/_)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),It.delete(this.painter.context.gl),At.remove(),Be.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=r.o.frame((n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)})))}_preloadTiles(h){const n=this.style?this.style.getSourceCaches():[];return r.bw(n,((a,d)=>a._preloadTiles(h,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,n){r.eX(h,n)}get version(){return E}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},I_,h),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),O("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),O("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))})),this._compassIcon=O("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),a=n===h.getMaxZoom(),d=n===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new R_(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const a=O("button",h,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(h,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(h={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Cl,h),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((a=>n(a.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),a=h.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",h)),this._finish()}}_updateCamera(h){const n=new r.aR(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),_=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),_,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new r.aR(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=r.ce(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=O("button","mapboxgl-ctrl-geolocate",this._container),O("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O("div","mapboxgl-user-location"),this._dotElement.appendChild(O("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(O("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Rc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=O("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))}))}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&h()})).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wo,ScaleControl:class{constructor(h={}){this.options=Object.assign({},El,h),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-h/2,_=n.unproject([d,a]),b=n.unproject([d+h,a]),T=_.distanceTo(b);if(this.options.unit==="imperial"){const P=3.2808*T;P>5280?this._setScale(h,P/5280,"mile"):this._setScale(h,P,"foot")}else this.options.unit==="nautical"?this._setScale(h,T/1852,"nautical-mile"):T>=1e3?this._setScale(h,T/1e3,"kilometer"):this._setScale(h,T,"meter")}_setScale(h,n,a){this._map._requestDomTask((()=>{const d=(function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/T;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:(function(k){const G=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*G)/G})(P),T*P})(n),_=d/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${Sa[a]}`,this._container.style.width=h*_+"px"}))}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=O("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Tl,Popup:class extends r.E{constructor(h){super(),this.options=Object.assign(Object.create(Al),h),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=r.aR.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const n=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=O("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const a=this._closeButton=O("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";const _=a.offsetWidth,b=a.offsetHeight,T=d.x<_/2,P=d.x>n.transform.width-_/2;if(d.y+h<b)return T?"top-left":P?"top-right":"top";if(d.y>n.transform.height-b){if(T)return"bottom-left";if(P)return"bottom-right"}return T?"left":P?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=O("div","mapboxgl-popup",n.getContainer()),this._tip=O("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bo(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h instanceof r.P?h:n.project(this._lngLat,this._altitude),b=ed(this.options.offset),T=this._anchor=this._getAnchor(b.y),P=ed(this.options.offset,T),k=_.add(P).round();n._requestDomTask((()=>{this._container&&T&&(this._container.style.transform=`${hu[T]} translate(${k.x}px,${k.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const _=r.eY(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(La);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Rc,Style:Da,LngLat:r.aR,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:kf,Evented:r.E,config:r.e,prewarm:r.f0,clearPrewarmedResources:r.e$,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(h){r.e.ACCESS_TOKEN=h},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(h){r.e.API_URL=h},get workerCount(){return r.f9.workerCount},set workerCount(h){r.f9.workerCount=h},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){r.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){r.f8(h)},get workerUrl(){return r.f7.workerUrl},set workerUrl(h){r.f7.workerUrl=h},get workerClass(){return r.f7.workerClass},set workerClass(h){r.f7.workerClass=h},get workerParams(){return r.f7.workerParams},set workerParams(h){r.f7.workerParams=h},get dracoUrl(){return r.f6()},set dracoUrl(h){r.f5(h)},get meshoptUrl(){return r.f4()},set meshoptUrl(h){r.f3(h)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}}));var S=g;return S}))})(L1)),L1.exports}var GL=jL();const bw=al(GL);bw.accessToken="pk.eyJ1Ijoia2FybGJlcm5hbGRpenp5IiwiYSI6ImNtYWFrb2t6eDB2M3EyanB2cWRoejQwYnMifQ.EqoDaJC6Tk6eTvbAD-bzrA";const $L=({onMapLoad:t,isDarkMode:s})=>{const c=Te.useRef(null),p=Te.useRef(null);return Te.useEffect(()=>{if(!c.current){console.error("Map container reference is not available.");return}if(!bw.accessToken){console.error("Mapbox access token is not defined.");return}if(!p.current){for(;c.current.firstChild;)c.current.removeChild(c.current.firstChild);const g=new bw.Map({container:c.current,projection:"mercator",style:s?"mapbox://styles/karlbernaldizzy/cmfnei5d300a601rf9hsea7qk":"mapbox://styles/karlbernaldizzy/cmf6i7nne000501s2hbmw8phn",center:[120,15.5],minZoom:4,zoom:4.2,maxZoom:12,preserveDrawingBuffer:!0,maxBounds:[[95,-5],[170,40]]});g.fitBounds([[99.79339501828959,3.757304989541903],[153.8595159535438,27.162621752400348]],{padding:{top:200,bottom:100,left:100,right:200}}),g.on("load",()=>{p.current=g,t&&t(g)})}return()=>{p.current&&(p.current.remove(),p.current=null)}},[]),Te.useEffect(()=>{p.current&&p.current.setStyle(s?"mapbox://styles/karlbernaldizzy/cmfnei5d300a601rf9hsea7qk":"mapbox://styles/karlbernaldizzy/cmf6i7nne000501s2hbmw8phn")},[s]),ue.jsx("div",{ref:c,style:{width:"100%",height:"100%",position:"relative"}})};function DM(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(t)}function kM(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(t)}function ww(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(t)}function h5(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(t)}function HL(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(t)}function qL(t){return Ps({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(t)}function OM(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(t)}function WL(t){return Ps({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(t)}function ZL(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z"},child:[]}]})(t)}function Bg(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(t)}function YL(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z"},child:[]}]})(t)}function XL(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"},child:[]}]})(t)}function KL(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(t)}function JL(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(t)}function LM(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(t)}function f5(t){return Ps({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M384 320H256c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32zM192 32c0-17.67-14.33-32-32-32H32C14.33 0 0 14.33 0 32v128c0 17.67 14.33 32 32 32h95.72l73.16 128.04C211.98 300.98 232.4 288 256 288h.28L192 175.51V128h224V64H192V32zM608 0H480c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h128c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32z"},child:[]}]})(t)}function QL(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function ez(t){return Ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(t)}function tz(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M384 64H192C85.961 64 0 149.961 0 256s85.961 192 192 192h192c106.039 0 192-85.961 192-192S490.039 64 384 64zM64 256c0-70.741 57.249-128 128-128 70.741 0 128 57.249 128 128 0 70.741-57.249 128-128 128-70.741 0-128-57.249-128-128zm320 128h-48.905c65.217-72.858 65.236-183.12 0-256H384c70.741 0 128 57.249 128 128 0 70.74-57.249 128-128 128z"},child:[]}]})(t)}function nz(t){return Ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M384 64H192C86 64 0 150 0 256s86 192 192 192h192c106 0 192-86 192-192S490 64 384 64zm0 320c-70.8 0-128-57.3-128-128 0-70.8 57.3-128 128-128 70.8 0 128 57.3 128 128 0 70.8-57.3 128-128 128z"},child:[]}]})(t)}function zM(t){return Ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(t)}function FM(t,s){return function(){return t.apply(s,arguments)}}const{toString:rz}=Object.prototype,{getPrototypeOf:uS}=Object,{iterator:Sx,toStringTag:BM}=Symbol,Tx=(t=>s=>{const c=rz.call(s);return t[c]||(t[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),dd=t=>(t=t.toLowerCase(),s=>Tx(s)===t),Cx=t=>s=>typeof s===t,{isArray:m_}=Array,o_=Cx("undefined");function Wy(t){return t!==null&&!o_(t)&&t.constructor!==null&&!o_(t.constructor)&&sc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const NM=dd("ArrayBuffer");function iz(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&NM(t.buffer),s}const oz=Cx("string"),sc=Cx("function"),VM=Cx("number"),Zy=t=>t!==null&&typeof t=="object",sz=t=>t===!0||t===!1,z1=t=>{if(Tx(t)!=="object")return!1;const s=uS(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(BM in t)&&!(Sx in t)},az=t=>{if(!Zy(t)||Wy(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},lz=dd("Date"),cz=dd("File"),uz=dd("Blob"),dz=dd("FileList"),hz=t=>Zy(t)&&sc(t.pipe),fz=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||sc(t.append)&&((s=Tx(t))==="formdata"||s==="object"&&sc(t.toString)&&t.toString()==="[object FormData]"))},pz=dd("URLSearchParams"),[mz,gz,_z,yz]=["ReadableStream","Request","Response","Headers"].map(dd),vz=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Yy(t,s,{allOwnKeys:c=!1}={}){if(t===null||typeof t>"u")return;let p,g;if(typeof t!="object"&&(t=[t]),m_(t))for(p=0,g=t.length;p<g;p++)s.call(null,t[p],p,t);else{if(Wy(t))return;const v=c?Object.getOwnPropertyNames(t):Object.keys(t),S=v.length;let r;for(p=0;p<S;p++)r=v[p],s.call(null,t[r],r,t)}}function UM(t,s){if(Wy(t))return null;s=s.toLowerCase();const c=Object.keys(t);let p=c.length,g;for(;p-- >0;)if(g=c[p],s===g.toLowerCase())return g;return null}const Um=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,jM=t=>!o_(t)&&t!==Um;function Sw(){const{caseless:t,skipUndefined:s}=jM(this)&&this||{},c={},p=(g,v)=>{const S=t&&UM(c,v)||v;z1(c[S])&&z1(g)?c[S]=Sw(c[S],g):z1(g)?c[S]=Sw({},g):m_(g)?c[S]=g.slice():(!s||!o_(g))&&(c[S]=g)};for(let g=0,v=arguments.length;g<v;g++)arguments[g]&&Yy(arguments[g],p);return c}const xz=(t,s,c,{allOwnKeys:p}={})=>(Yy(s,(g,v)=>{c&&sc(g)?t[v]=FM(g,c):t[v]=g},{allOwnKeys:p}),t),bz=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),wz=(t,s,c,p)=>{t.prototype=Object.create(s.prototype,p),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),c&&Object.assign(t.prototype,c)},Sz=(t,s,c,p)=>{let g,v,S;const r={};if(s=s||{},t==null)return s;do{for(g=Object.getOwnPropertyNames(t),v=g.length;v-- >0;)S=g[v],(!p||p(S,t,s))&&!r[S]&&(s[S]=t[S],r[S]=!0);t=c!==!1&&uS(t)}while(t&&(!c||c(t,s))&&t!==Object.prototype);return s},Tz=(t,s,c)=>{t=String(t),(c===void 0||c>t.length)&&(c=t.length),c-=s.length;const p=t.indexOf(s,c);return p!==-1&&p===c},Cz=t=>{if(!t)return null;if(m_(t))return t;let s=t.length;if(!VM(s))return null;const c=new Array(s);for(;s-- >0;)c[s]=t[s];return c},Ez=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&uS(Uint8Array)),Az=(t,s)=>{const p=(t&&t[Sx]).call(t);let g;for(;(g=p.next())&&!g.done;){const v=g.value;s.call(t,v[0],v[1])}},Pz=(t,s)=>{let c;const p=[];for(;(c=t.exec(s))!==null;)p.push(c);return p},Mz=dd("HTMLFormElement"),Iz=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,p,g){return p.toUpperCase()+g}),p5=(({hasOwnProperty:t})=>(s,c)=>t.call(s,c))(Object.prototype),Rz=dd("RegExp"),GM=(t,s)=>{const c=Object.getOwnPropertyDescriptors(t),p={};Yy(c,(g,v)=>{let S;(S=s(g,v,t))!==!1&&(p[v]=S||g)}),Object.defineProperties(t,p)},Dz=t=>{GM(t,(s,c)=>{if(sc(t)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const p=t[c];if(sc(p)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},kz=(t,s)=>{const c={},p=g=>{g.forEach(v=>{c[v]=!0})};return m_(t)?p(t):p(String(t).split(s)),c},Oz=()=>{},Lz=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function zz(t){return!!(t&&sc(t.append)&&t[BM]==="FormData"&&t[Sx])}const Fz=t=>{const s=new Array(10),c=(p,g)=>{if(Zy(p)){if(s.indexOf(p)>=0)return;if(Wy(p))return p;if(!("toJSON"in p)){s[g]=p;const v=m_(p)?[]:{};return Yy(p,(S,r)=>{const E=c(S,g+1);!o_(E)&&(v[r]=E)}),s[g]=void 0,v}}return p};return c(t,0)},Bz=dd("AsyncFunction"),Nz=t=>t&&(Zy(t)||sc(t))&&sc(t.then)&&sc(t.catch),$M=((t,s)=>t?setImmediate:s?((c,p)=>(Um.addEventListener("message",({source:g,data:v})=>{g===Um&&v===c&&p.length&&p.shift()()},!1),g=>{p.push(g),Um.postMessage(c,"*")}))(`axios@${Math.random()}`,[]):c=>setTimeout(c))(typeof setImmediate=="function",sc(Um.postMessage)),Vz=typeof queueMicrotask<"u"?queueMicrotask.bind(Um):typeof process<"u"&&process.nextTick||$M,Uz=t=>t!=null&&sc(t[Sx]),yn={isArray:m_,isArrayBuffer:NM,isBuffer:Wy,isFormData:fz,isArrayBufferView:iz,isString:oz,isNumber:VM,isBoolean:sz,isObject:Zy,isPlainObject:z1,isEmptyObject:az,isReadableStream:mz,isRequest:gz,isResponse:_z,isHeaders:yz,isUndefined:o_,isDate:lz,isFile:cz,isBlob:uz,isRegExp:Rz,isFunction:sc,isStream:hz,isURLSearchParams:pz,isTypedArray:Ez,isFileList:dz,forEach:Yy,merge:Sw,extend:xz,trim:vz,stripBOM:bz,inherits:wz,toFlatObject:Sz,kindOf:Tx,kindOfTest:dd,endsWith:Tz,toArray:Cz,forEachEntry:Az,matchAll:Pz,isHTMLForm:Mz,hasOwnProperty:p5,hasOwnProp:p5,reduceDescriptors:GM,freezeMethods:Dz,toObjectSet:kz,toCamelCase:Iz,noop:Oz,toFiniteNumber:Lz,findKey:UM,global:Um,isContextDefined:jM,isSpecCompliantForm:zz,toJSONObject:Fz,isAsyncFn:Bz,isThenable:Nz,setImmediate:$M,asap:Vz,isIterable:Uz};function Li(t,s,c,p,g){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),c&&(this.config=c),p&&(this.request=p),g&&(this.response=g,this.status=g.status?g.status:null)}yn.inherits(Li,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:yn.toJSONObject(this.config),code:this.code,status:this.status}}});const HM=Li.prototype,qM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{qM[t]={value:t}});Object.defineProperties(Li,qM);Object.defineProperty(HM,"isAxiosError",{value:!0});Li.from=(t,s,c,p,g,v)=>{const S=Object.create(HM);yn.toFlatObject(t,S,function(I){return I!==Error.prototype},A=>A!=="isAxiosError");const r=t&&t.message?t.message:"Error",E=s==null&&t?t.code:s;return Li.call(S,r,E,c,p,g),t&&S.cause==null&&Object.defineProperty(S,"cause",{value:t,configurable:!0}),S.name=t&&t.name||"Error",v&&Object.assign(S,v),S};const jz=null;function Tw(t){return yn.isPlainObject(t)||yn.isArray(t)}function WM(t){return yn.endsWith(t,"[]")?t.slice(0,-2):t}function m5(t,s,c){return t?t.concat(s).map(function(g,v){return g=WM(g),!c&&v?"["+g+"]":g}).join(c?".":""):s}function Gz(t){return yn.isArray(t)&&!t.some(Tw)}const $z=yn.toFlatObject(yn,{},null,function(s){return/^is[A-Z]/.test(s)});function Ex(t,s,c){if(!yn.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,c=yn.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,N){return!yn.isUndefined(N[O])});const p=c.metaTokens,g=c.visitor||I,v=c.dots,S=c.indexes,E=(c.Blob||typeof Blob<"u"&&Blob)&&yn.isSpecCompliantForm(s);if(!yn.isFunction(g))throw new TypeError("visitor must be a function");function A(D){if(D===null)return"";if(yn.isDate(D))return D.toISOString();if(yn.isBoolean(D))return D.toString();if(!E&&yn.isBlob(D))throw new Li("Blob is not supported. Use a Buffer instead.");return yn.isArrayBuffer(D)||yn.isTypedArray(D)?E&&typeof Blob=="function"?new Blob([D]):Buffer.from(D):D}function I(D,O,N){let H=D;if(D&&!N&&typeof D=="object"){if(yn.endsWith(O,"{}"))O=p?O:O.slice(0,-2),D=JSON.stringify(D);else if(yn.isArray(D)&&Gz(D)||(yn.isFileList(D)||yn.endsWith(O,"[]"))&&(H=yn.toArray(D)))return O=WM(O),H.forEach(function(V,Z){!(yn.isUndefined(V)||V===null)&&s.append(S===!0?m5([O],Z,v):S===null?O:O+"[]",A(V))}),!1}return Tw(D)?!0:(s.append(m5(N,O,v),A(D)),!1)}const F=[],z=Object.assign($z,{defaultVisitor:I,convertValue:A,isVisitable:Tw});function R(D,O){if(!yn.isUndefined(D)){if(F.indexOf(D)!==-1)throw Error("Circular reference detected in "+O.join("."));F.push(D),yn.forEach(D,function(H,j){(!(yn.isUndefined(H)||H===null)&&g.call(s,H,yn.isString(j)?j.trim():j,O,z))===!0&&R(H,O?O.concat(j):[j])}),F.pop()}}if(!yn.isObject(t))throw new TypeError("data must be an object");return R(t),s}function g5(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(p){return s[p]})}function dS(t,s){this._pairs=[],t&&Ex(t,this,s)}const ZM=dS.prototype;ZM.append=function(s,c){this._pairs.push([s,c])};ZM.toString=function(s){const c=s?function(p){return s.call(this,p,g5)}:g5;return this._pairs.map(function(g){return c(g[0])+"="+c(g[1])},"").join("&")};function Hz(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function YM(t,s,c){if(!s)return t;const p=c&&c.encode||Hz;yn.isFunction(c)&&(c={serialize:c});const g=c&&c.serialize;let v;if(g?v=g(s,c):v=yn.isURLSearchParams(s)?s.toString():new dS(s,c).toString(p),v){const S=t.indexOf("#");S!==-1&&(t=t.slice(0,S)),t+=(t.indexOf("?")===-1?"?":"&")+v}return t}class _5{constructor(){this.handlers=[]}use(s,c,p){return this.handlers.push({fulfilled:s,rejected:c,synchronous:p?p.synchronous:!1,runWhen:p?p.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){yn.forEach(this.handlers,function(p){p!==null&&s(p)})}}const XM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qz=typeof URLSearchParams<"u"?URLSearchParams:dS,Wz=typeof FormData<"u"?FormData:null,Zz=typeof Blob<"u"?Blob:null,Yz={isBrowser:!0,classes:{URLSearchParams:qz,FormData:Wz,Blob:Zz},protocols:["http","https","file","blob","url","data"]},hS=typeof window<"u"&&typeof document<"u",Cw=typeof navigator=="object"&&navigator||void 0,Xz=hS&&(!Cw||["ReactNative","NativeScript","NS"].indexOf(Cw.product)<0),Kz=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Jz=hS&&window.location.href||"http://localhost",Qz=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hS,hasStandardBrowserEnv:Xz,hasStandardBrowserWebWorkerEnv:Kz,navigator:Cw,origin:Jz},Symbol.toStringTag,{value:"Module"})),rl={...Qz,...Yz};function eF(t,s){return Ex(t,new rl.classes.URLSearchParams,{visitor:function(c,p,g,v){return rl.isNode&&yn.isBuffer(c)?(this.append(p,c.toString("base64")),!1):v.defaultVisitor.apply(this,arguments)},...s})}function tF(t){return yn.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function nF(t){const s={},c=Object.keys(t);let p;const g=c.length;let v;for(p=0;p<g;p++)v=c[p],s[v]=t[v];return s}function KM(t){function s(c,p,g,v){let S=c[v++];if(S==="__proto__")return!0;const r=Number.isFinite(+S),E=v>=c.length;return S=!S&&yn.isArray(g)?g.length:S,E?(yn.hasOwnProp(g,S)?g[S]=[g[S],p]:g[S]=p,!r):((!g[S]||!yn.isObject(g[S]))&&(g[S]=[]),s(c,p,g[S],v)&&yn.isArray(g[S])&&(g[S]=nF(g[S])),!r)}if(yn.isFormData(t)&&yn.isFunction(t.entries)){const c={};return yn.forEachEntry(t,(p,g)=>{s(tF(p),g,c,0)}),c}return null}function rF(t,s,c){if(yn.isString(t))try{return(s||JSON.parse)(t),yn.trim(t)}catch(p){if(p.name!=="SyntaxError")throw p}return(c||JSON.stringify)(t)}const Xy={transitional:XM,adapter:["xhr","http","fetch"],transformRequest:[function(s,c){const p=c.getContentType()||"",g=p.indexOf("application/json")>-1,v=yn.isObject(s);if(v&&yn.isHTMLForm(s)&&(s=new FormData(s)),yn.isFormData(s))return g?JSON.stringify(KM(s)):s;if(yn.isArrayBuffer(s)||yn.isBuffer(s)||yn.isStream(s)||yn.isFile(s)||yn.isBlob(s)||yn.isReadableStream(s))return s;if(yn.isArrayBufferView(s))return s.buffer;if(yn.isURLSearchParams(s))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let r;if(v){if(p.indexOf("application/x-www-form-urlencoded")>-1)return eF(s,this.formSerializer).toString();if((r=yn.isFileList(s))||p.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return Ex(r?{"files[]":s}:s,E&&new E,this.formSerializer)}}return v||g?(c.setContentType("application/json",!1),rF(s)):s}],transformResponse:[function(s){const c=this.transitional||Xy.transitional,p=c&&c.forcedJSONParsing,g=this.responseType==="json";if(yn.isResponse(s)||yn.isReadableStream(s))return s;if(s&&yn.isString(s)&&(p&&!this.responseType||g)){const S=!(c&&c.silentJSONParsing)&&g;try{return JSON.parse(s,this.parseReviver)}catch(r){if(S)throw r.name==="SyntaxError"?Li.from(r,Li.ERR_BAD_RESPONSE,this,null,this.response):r}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:rl.classes.FormData,Blob:rl.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};yn.forEach(["delete","get","head","post","put","patch"],t=>{Xy.headers[t]={}});const iF=yn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),oF=t=>{const s={};let c,p,g;return t&&t.split(`
`).forEach(function(S){g=S.indexOf(":"),c=S.substring(0,g).trim().toLowerCase(),p=S.substring(g+1).trim(),!(!c||s[c]&&iF[c])&&(c==="set-cookie"?s[c]?s[c].push(p):s[c]=[p]:s[c]=s[c]?s[c]+", "+p:p)}),s},y5=Symbol("internals");function m0(t){return t&&String(t).trim().toLowerCase()}function F1(t){return t===!1||t==null?t:yn.isArray(t)?t.map(F1):String(t)}function sF(t){const s=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=c.exec(t);)s[p[1]]=p[2];return s}const aF=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function P2(t,s,c,p,g){if(yn.isFunction(p))return p.call(this,s,c);if(g&&(s=c),!!yn.isString(s)){if(yn.isString(p))return s.indexOf(p)!==-1;if(yn.isRegExp(p))return p.test(s)}}function lF(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,c,p)=>c.toUpperCase()+p)}function cF(t,s){const c=yn.toCamelCase(" "+s);["get","set","has"].forEach(p=>{Object.defineProperty(t,p+c,{value:function(g,v,S){return this[p].call(this,s,g,v,S)},configurable:!0})})}let ac=class{constructor(s){s&&this.set(s)}set(s,c,p){const g=this;function v(r,E,A){const I=m0(E);if(!I)throw new Error("header name must be a non-empty string");const F=yn.findKey(g,I);(!F||g[F]===void 0||A===!0||A===void 0&&g[F]!==!1)&&(g[F||E]=F1(r))}const S=(r,E)=>yn.forEach(r,(A,I)=>v(A,I,E));if(yn.isPlainObject(s)||s instanceof this.constructor)S(s,c);else if(yn.isString(s)&&(s=s.trim())&&!aF(s))S(oF(s),c);else if(yn.isObject(s)&&yn.isIterable(s)){let r={},E,A;for(const I of s){if(!yn.isArray(I))throw TypeError("Object iterator must return a key-value pair");r[A=I[0]]=(E=r[A])?yn.isArray(E)?[...E,I[1]]:[E,I[1]]:I[1]}S(r,c)}else s!=null&&v(c,s,p);return this}get(s,c){if(s=m0(s),s){const p=yn.findKey(this,s);if(p){const g=this[p];if(!c)return g;if(c===!0)return sF(g);if(yn.isFunction(c))return c.call(this,g,p);if(yn.isRegExp(c))return c.exec(g);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,c){if(s=m0(s),s){const p=yn.findKey(this,s);return!!(p&&this[p]!==void 0&&(!c||P2(this,this[p],p,c)))}return!1}delete(s,c){const p=this;let g=!1;function v(S){if(S=m0(S),S){const r=yn.findKey(p,S);r&&(!c||P2(p,p[r],r,c))&&(delete p[r],g=!0)}}return yn.isArray(s)?s.forEach(v):v(s),g}clear(s){const c=Object.keys(this);let p=c.length,g=!1;for(;p--;){const v=c[p];(!s||P2(this,this[v],v,s,!0))&&(delete this[v],g=!0)}return g}normalize(s){const c=this,p={};return yn.forEach(this,(g,v)=>{const S=yn.findKey(p,v);if(S){c[S]=F1(g),delete c[v];return}const r=s?lF(v):String(v).trim();r!==v&&delete c[v],c[r]=F1(g),p[r]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const c=Object.create(null);return yn.forEach(this,(p,g)=>{p!=null&&p!==!1&&(c[g]=s&&yn.isArray(p)?p.join(", "):p)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,c])=>s+": "+c).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...c){const p=new this(s);return c.forEach(g=>p.set(g)),p}static accessor(s){const p=(this[y5]=this[y5]={accessors:{}}).accessors,g=this.prototype;function v(S){const r=m0(S);p[r]||(cF(g,S),p[r]=!0)}return yn.isArray(s)?s.forEach(v):v(s),this}};ac.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);yn.reduceDescriptors(ac.prototype,({value:t},s)=>{let c=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(p){this[c]=p}}});yn.freezeMethods(ac);function M2(t,s){const c=this||Xy,p=s||c,g=ac.from(p.headers);let v=p.data;return yn.forEach(t,function(r){v=r.call(c,v,g.normalize(),s?s.status:void 0)}),g.normalize(),v}function JM(t){return!!(t&&t.__CANCEL__)}function g_(t,s,c){Li.call(this,t??"canceled",Li.ERR_CANCELED,s,c),this.name="CanceledError"}yn.inherits(g_,Li,{__CANCEL__:!0});function QM(t,s,c){const p=c.config.validateStatus;!c.status||!p||p(c.status)?t(c):s(new Li("Request failed with status code "+c.status,[Li.ERR_BAD_REQUEST,Li.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}function uF(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function dF(t,s){t=t||10;const c=new Array(t),p=new Array(t);let g=0,v=0,S;return s=s!==void 0?s:1e3,function(E){const A=Date.now(),I=p[v];S||(S=A),c[g]=E,p[g]=A;let F=v,z=0;for(;F!==g;)z+=c[F++],F=F%t;if(g=(g+1)%t,g===v&&(v=(v+1)%t),A-S<s)return;const R=I&&A-I;return R?Math.round(z*1e3/R):void 0}}function hF(t,s){let c=0,p=1e3/s,g,v;const S=(A,I=Date.now())=>{c=I,g=null,v&&(clearTimeout(v),v=null),t(...A)};return[(...A)=>{const I=Date.now(),F=I-c;F>=p?S(A,I):(g=A,v||(v=setTimeout(()=>{v=null,S(g)},p-F)))},()=>g&&S(g)]}const ix=(t,s,c=3)=>{let p=0;const g=dF(50,250);return hF(v=>{const S=v.loaded,r=v.lengthComputable?v.total:void 0,E=S-p,A=g(E),I=S<=r;p=S;const F={loaded:S,total:r,progress:r?S/r:void 0,bytes:E,rate:A||void 0,estimated:A&&r&&I?(r-S)/A:void 0,event:v,lengthComputable:r!=null,[s?"download":"upload"]:!0};t(F)},c)},v5=(t,s)=>{const c=t!=null;return[p=>s[0]({lengthComputable:c,total:t,loaded:p}),s[1]]},x5=t=>(...s)=>yn.asap(()=>t(...s)),fF=rl.hasStandardBrowserEnv?((t,s)=>c=>(c=new URL(c,rl.origin),t.protocol===c.protocol&&t.host===c.host&&(s||t.port===c.port)))(new URL(rl.origin),rl.navigator&&/(msie|trident)/i.test(rl.navigator.userAgent)):()=>!0,pF=rl.hasStandardBrowserEnv?{write(t,s,c,p,g,v){const S=[t+"="+encodeURIComponent(s)];yn.isNumber(c)&&S.push("expires="+new Date(c).toGMTString()),yn.isString(p)&&S.push("path="+p),yn.isString(g)&&S.push("domain="+g),v===!0&&S.push("secure"),document.cookie=S.join("; ")},read(t){const s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mF(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function gF(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function eI(t,s,c){let p=!mF(s);return t&&(p||c==!1)?gF(t,s):s}const b5=t=>t instanceof ac?{...t}:t;function Wm(t,s){s=s||{};const c={};function p(A,I,F,z){return yn.isPlainObject(A)&&yn.isPlainObject(I)?yn.merge.call({caseless:z},A,I):yn.isPlainObject(I)?yn.merge({},I):yn.isArray(I)?I.slice():I}function g(A,I,F,z){if(yn.isUndefined(I)){if(!yn.isUndefined(A))return p(void 0,A,F,z)}else return p(A,I,F,z)}function v(A,I){if(!yn.isUndefined(I))return p(void 0,I)}function S(A,I){if(yn.isUndefined(I)){if(!yn.isUndefined(A))return p(void 0,A)}else return p(void 0,I)}function r(A,I,F){if(F in s)return p(A,I);if(F in t)return p(void 0,A)}const E={url:v,method:v,data:v,baseURL:S,transformRequest:S,transformResponse:S,paramsSerializer:S,timeout:S,timeoutMessage:S,withCredentials:S,withXSRFToken:S,adapter:S,responseType:S,xsrfCookieName:S,xsrfHeaderName:S,onUploadProgress:S,onDownloadProgress:S,decompress:S,maxContentLength:S,maxBodyLength:S,beforeRedirect:S,transport:S,httpAgent:S,httpsAgent:S,cancelToken:S,socketPath:S,responseEncoding:S,validateStatus:r,headers:(A,I,F)=>g(b5(A),b5(I),F,!0)};return yn.forEach(Object.keys({...t,...s}),function(I){const F=E[I]||g,z=F(t[I],s[I],I);yn.isUndefined(z)&&F!==r||(c[I]=z)}),c}const tI=t=>{const s=Wm({},t);let{data:c,withXSRFToken:p,xsrfHeaderName:g,xsrfCookieName:v,headers:S,auth:r}=s;if(s.headers=S=ac.from(S),s.url=YM(eI(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),r&&S.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):""))),yn.isFormData(c)){if(rl.hasStandardBrowserEnv||rl.hasStandardBrowserWebWorkerEnv)S.setContentType(void 0);else if(yn.isFunction(c.getHeaders)){const E=c.getHeaders(),A=["content-type","content-length"];Object.entries(E).forEach(([I,F])=>{A.includes(I.toLowerCase())&&S.set(I,F)})}}if(rl.hasStandardBrowserEnv&&(p&&yn.isFunction(p)&&(p=p(s)),p||p!==!1&&fF(s.url))){const E=g&&v&&pF.read(v);E&&S.set(g,E)}return s},_F=typeof XMLHttpRequest<"u",yF=_F&&function(t){return new Promise(function(c,p){const g=tI(t);let v=g.data;const S=ac.from(g.headers).normalize();let{responseType:r,onUploadProgress:E,onDownloadProgress:A}=g,I,F,z,R,D;function O(){R&&R(),D&&D(),g.cancelToken&&g.cancelToken.unsubscribe(I),g.signal&&g.signal.removeEventListener("abort",I)}let N=new XMLHttpRequest;N.open(g.method.toUpperCase(),g.url,!0),N.timeout=g.timeout;function H(){if(!N)return;const V=ac.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),X={data:!r||r==="text"||r==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:V,config:t,request:N};QM(function(ge){c(ge),O()},function(ge){p(ge),O()},X),N=null}"onloadend"in N?N.onloadend=H:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(H)},N.onabort=function(){N&&(p(new Li("Request aborted",Li.ECONNABORTED,t,N)),N=null)},N.onerror=function(Z){const X=Z&&Z.message?Z.message:"Network Error",se=new Li(X,Li.ERR_NETWORK,t,N);se.event=Z||null,p(se),N=null},N.ontimeout=function(){let Z=g.timeout?"timeout of "+g.timeout+"ms exceeded":"timeout exceeded";const X=g.transitional||XM;g.timeoutErrorMessage&&(Z=g.timeoutErrorMessage),p(new Li(Z,X.clarifyTimeoutError?Li.ETIMEDOUT:Li.ECONNABORTED,t,N)),N=null},v===void 0&&S.setContentType(null),"setRequestHeader"in N&&yn.forEach(S.toJSON(),function(Z,X){N.setRequestHeader(X,Z)}),yn.isUndefined(g.withCredentials)||(N.withCredentials=!!g.withCredentials),r&&r!=="json"&&(N.responseType=g.responseType),A&&([z,D]=ix(A,!0),N.addEventListener("progress",z)),E&&N.upload&&([F,R]=ix(E),N.upload.addEventListener("progress",F),N.upload.addEventListener("loadend",R)),(g.cancelToken||g.signal)&&(I=V=>{N&&(p(!V||V.type?new g_(null,t,N):V),N.abort(),N=null)},g.cancelToken&&g.cancelToken.subscribe(I),g.signal&&(g.signal.aborted?I():g.signal.addEventListener("abort",I)));const j=uF(g.url);if(j&&rl.protocols.indexOf(j)===-1){p(new Li("Unsupported protocol "+j+":",Li.ERR_BAD_REQUEST,t));return}N.send(v||null)})},vF=(t,s)=>{const{length:c}=t=t?t.filter(Boolean):[];if(s||c){let p=new AbortController,g;const v=function(A){if(!g){g=!0,r();const I=A instanceof Error?A:this.reason;p.abort(I instanceof Li?I:new g_(I instanceof Error?I.message:I))}};let S=s&&setTimeout(()=>{S=null,v(new Li(`timeout ${s} of ms exceeded`,Li.ETIMEDOUT))},s);const r=()=>{t&&(S&&clearTimeout(S),S=null,t.forEach(A=>{A.unsubscribe?A.unsubscribe(v):A.removeEventListener("abort",v)}),t=null)};t.forEach(A=>A.addEventListener("abort",v));const{signal:E}=p;return E.unsubscribe=()=>yn.asap(r),E}},xF=function*(t,s){let c=t.byteLength;if(c<s){yield t;return}let p=0,g;for(;p<c;)g=p+s,yield t.slice(p,g),p=g},bF=async function*(t,s){for await(const c of wF(t))yield*xF(c,s)},wF=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:c,value:p}=await s.read();if(c)break;yield p}}finally{await s.cancel()}},w5=(t,s,c,p)=>{const g=bF(t,s);let v=0,S,r=E=>{S||(S=!0,p&&p(E))};return new ReadableStream({async pull(E){try{const{done:A,value:I}=await g.next();if(A){r(),E.close();return}let F=I.byteLength;if(c){let z=v+=F;c(z)}E.enqueue(new Uint8Array(I))}catch(A){throw r(A),A}},cancel(E){return r(E),g.return()}},{highWaterMark:2})},S5=64*1024,{isFunction:s1}=yn,SF=(({Request:t,Response:s})=>({Request:t,Response:s}))(yn.global),{ReadableStream:T5,TextEncoder:C5}=yn.global,E5=(t,...s)=>{try{return!!t(...s)}catch{return!1}},TF=t=>{t=yn.merge.call({skipUndefined:!0},SF,t);const{fetch:s,Request:c,Response:p}=t,g=s?s1(s):typeof fetch=="function",v=s1(c),S=s1(p);if(!g)return!1;const r=g&&s1(T5),E=g&&(typeof C5=="function"?(D=>O=>D.encode(O))(new C5):async D=>new Uint8Array(await new c(D).arrayBuffer())),A=v&&r&&E5(()=>{let D=!1;const O=new c(rl.origin,{body:new T5,method:"POST",get duplex(){return D=!0,"half"}}).headers.has("Content-Type");return D&&!O}),I=S&&r&&E5(()=>yn.isReadableStream(new p("").body)),F={stream:I&&(D=>D.body)};g&&["text","arrayBuffer","blob","formData","stream"].forEach(D=>{!F[D]&&(F[D]=(O,N)=>{let H=O&&O[D];if(H)return H.call(O);throw new Li(`Response type '${D}' is not supported`,Li.ERR_NOT_SUPPORT,N)})});const z=async D=>{if(D==null)return 0;if(yn.isBlob(D))return D.size;if(yn.isSpecCompliantForm(D))return(await new c(rl.origin,{method:"POST",body:D}).arrayBuffer()).byteLength;if(yn.isArrayBufferView(D)||yn.isArrayBuffer(D))return D.byteLength;if(yn.isURLSearchParams(D)&&(D=D+""),yn.isString(D))return(await E(D)).byteLength},R=async(D,O)=>{const N=yn.toFiniteNumber(D.getContentLength());return N??z(O)};return async D=>{let{url:O,method:N,data:H,signal:j,cancelToken:V,timeout:Z,onDownloadProgress:X,onUploadProgress:se,responseType:ge,headers:ae,withCredentials:oe="same-origin",fetchOptions:fe}=tI(D),pe=s||fetch;ge=ge?(ge+"").toLowerCase():"text";let K=vF([j,V&&V.toAbortSignal()],Z),ye=null;const J=K&&K.unsubscribe&&(()=>{K.unsubscribe()});let de;try{if(se&&A&&N!=="get"&&N!=="head"&&(de=await R(ae,H))!==0){let Ee=new c(O,{method:"POST",body:H,duplex:"half"}),Oe;if(yn.isFormData(H)&&(Oe=Ee.headers.get("content-type"))&&ae.setContentType(Oe),Ee.body){const[Be,at]=v5(de,ix(x5(se)));H=w5(Ee.body,S5,Be,at)}}yn.isString(oe)||(oe=oe?"include":"omit");const Ae=v&&"credentials"in c.prototype,ne={...fe,signal:K,method:N.toUpperCase(),headers:ae.normalize().toJSON(),body:H,duplex:"half",credentials:Ae?oe:void 0};ye=v&&new c(O,ne);let xe=await(v?pe(ye,fe):pe(O,ne));const Ce=I&&(ge==="stream"||ge==="response");if(I&&(X||Ce&&J)){const Ee={};["status","statusText","headers"].forEach(ut=>{Ee[ut]=xe[ut]});const Oe=yn.toFiniteNumber(xe.headers.get("content-length")),[Be,at]=X&&v5(Oe,ix(x5(X),!0))||[];xe=new p(w5(xe.body,S5,Be,()=>{at&&at(),J&&J()}),Ee)}ge=ge||"text";let Re=await F[yn.findKey(F,ge)||"text"](xe,D);return!Ce&&J&&J(),await new Promise((Ee,Oe)=>{QM(Ee,Oe,{data:Re,headers:ac.from(xe.headers),status:xe.status,statusText:xe.statusText,config:D,request:ye})})}catch(Ae){throw J&&J(),Ae&&Ae.name==="TypeError"&&/Load failed|fetch/i.test(Ae.message)?Object.assign(new Li("Network Error",Li.ERR_NETWORK,D,ye),{cause:Ae.cause||Ae}):Li.from(Ae,Ae&&Ae.code,D,ye)}}},CF=new Map,nI=t=>{let s=t?t.env:{};const{fetch:c,Request:p,Response:g}=s,v=[p,g,c];let S=v.length,r=S,E,A,I=CF;for(;r--;)E=v[r],A=I.get(E),A===void 0&&I.set(E,A=r?new Map:TF(s)),I=A;return A};nI();const Ew={http:jz,xhr:yF,fetch:{get:nI}};yn.forEach(Ew,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const A5=t=>`- ${t}`,EF=t=>yn.isFunction(t)||t===null||t===!1,rI={getAdapter:(t,s)=>{t=yn.isArray(t)?t:[t];const{length:c}=t;let p,g;const v={};for(let S=0;S<c;S++){p=t[S];let r;if(g=p,!EF(p)&&(g=Ew[(r=String(p)).toLowerCase()],g===void 0))throw new Li(`Unknown adapter '${r}'`);if(g&&(yn.isFunction(g)||(g=g.get(s))))break;v[r||"#"+S]=g}if(!g){const S=Object.entries(v).map(([E,A])=>`adapter ${E} `+(A===!1?"is not supported by the environment":"is not available in the build"));let r=c?S.length>1?`since :
`+S.map(A5).join(`
`):" "+A5(S[0]):"as no adapter specified";throw new Li("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return g},adapters:Ew};function I2(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new g_(null,t)}function P5(t){return I2(t),t.headers=ac.from(t.headers),t.data=M2.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),rI.getAdapter(t.adapter||Xy.adapter,t)(t).then(function(p){return I2(t),p.data=M2.call(t,t.transformResponse,p),p.headers=ac.from(p.headers),p},function(p){return JM(p)||(I2(t),p&&p.response&&(p.response.data=M2.call(t,t.transformResponse,p.response),p.response.headers=ac.from(p.response.headers))),Promise.reject(p)})}const iI="1.12.2",Ax={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{Ax[t]=function(p){return typeof p===t||"a"+(s<1?"n ":" ")+t}});const M5={};Ax.transitional=function(s,c,p){function g(v,S){return"[Axios v"+iI+"] Transitional option '"+v+"'"+S+(p?". "+p:"")}return(v,S,r)=>{if(s===!1)throw new Li(g(S," has been removed"+(c?" in "+c:"")),Li.ERR_DEPRECATED);return c&&!M5[S]&&(M5[S]=!0,console.warn(g(S," has been deprecated since v"+c+" and will be removed in the near future"))),s?s(v,S,r):!0}};Ax.spelling=function(s){return(c,p)=>(console.warn(`${p} is likely a misspelling of ${s}`),!0)};function AF(t,s,c){if(typeof t!="object")throw new Li("options must be an object",Li.ERR_BAD_OPTION_VALUE);const p=Object.keys(t);let g=p.length;for(;g-- >0;){const v=p[g],S=s[v];if(S){const r=t[v],E=r===void 0||S(r,v,t);if(E!==!0)throw new Li("option "+v+" must be "+E,Li.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new Li("Unknown option "+v,Li.ERR_BAD_OPTION)}}const B1={assertOptions:AF,validators:Ax},rh=B1.validators;let Hm=class{constructor(s){this.defaults=s||{},this.interceptors={request:new _5,response:new _5}}async request(s,c){try{return await this._request(s,c)}catch(p){if(p instanceof Error){let g={};Error.captureStackTrace?Error.captureStackTrace(g):g=new Error;const v=g.stack?g.stack.replace(/^.+\n/,""):"";try{p.stack?v&&!String(p.stack).endsWith(v.replace(/^.+\n.+\n/,""))&&(p.stack+=`
`+v):p.stack=v}catch{}}throw p}}_request(s,c){typeof s=="string"?(c=c||{},c.url=s):c=s||{},c=Wm(this.defaults,c);const{transitional:p,paramsSerializer:g,headers:v}=c;p!==void 0&&B1.assertOptions(p,{silentJSONParsing:rh.transitional(rh.boolean),forcedJSONParsing:rh.transitional(rh.boolean),clarifyTimeoutError:rh.transitional(rh.boolean)},!1),g!=null&&(yn.isFunction(g)?c.paramsSerializer={serialize:g}:B1.assertOptions(g,{encode:rh.function,serialize:rh.function},!0)),c.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?c.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:c.allowAbsoluteUrls=!0),B1.assertOptions(c,{baseUrl:rh.spelling("baseURL"),withXsrfToken:rh.spelling("withXSRFToken")},!0),c.method=(c.method||this.defaults.method||"get").toLowerCase();let S=v&&yn.merge(v.common,v[c.method]);v&&yn.forEach(["delete","get","head","post","put","patch","common"],D=>{delete v[D]}),c.headers=ac.concat(S,v);const r=[];let E=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(c)===!1||(E=E&&O.synchronous,r.unshift(O.fulfilled,O.rejected))});const A=[];this.interceptors.response.forEach(function(O){A.push(O.fulfilled,O.rejected)});let I,F=0,z;if(!E){const D=[P5.bind(this),void 0];for(D.unshift(...r),D.push(...A),z=D.length,I=Promise.resolve(c);F<z;)I=I.then(D[F++],D[F++]);return I}z=r.length;let R=c;for(;F<z;){const D=r[F++],O=r[F++];try{R=D(R)}catch(N){O.call(this,N);break}}try{I=P5.call(this,R)}catch(D){return Promise.reject(D)}for(F=0,z=A.length;F<z;)I=I.then(A[F++],A[F++]);return I}getUri(s){s=Wm(this.defaults,s);const c=eI(s.baseURL,s.url,s.allowAbsoluteUrls);return YM(c,s.params,s.paramsSerializer)}};yn.forEach(["delete","get","head","options"],function(s){Hm.prototype[s]=function(c,p){return this.request(Wm(p||{},{method:s,url:c,data:(p||{}).data}))}});yn.forEach(["post","put","patch"],function(s){function c(p){return function(v,S,r){return this.request(Wm(r||{},{method:s,headers:p?{"Content-Type":"multipart/form-data"}:{},url:v,data:S}))}}Hm.prototype[s]=c(),Hm.prototype[s+"Form"]=c(!0)});let PF=class oI{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(v){c=v});const p=this;this.promise.then(g=>{if(!p._listeners)return;let v=p._listeners.length;for(;v-- >0;)p._listeners[v](g);p._listeners=null}),this.promise.then=g=>{let v;const S=new Promise(r=>{p.subscribe(r),v=r}).then(g);return S.cancel=function(){p.unsubscribe(v)},S},s(function(v,S,r){p.reason||(p.reason=new g_(v,S,r),c(p.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const c=this._listeners.indexOf(s);c!==-1&&this._listeners.splice(c,1)}toAbortSignal(){const s=new AbortController,c=p=>{s.abort(p)};return this.subscribe(c),s.signal.unsubscribe=()=>this.unsubscribe(c),s.signal}static source(){let s;return{token:new oI(function(g){s=g}),cancel:s}}};function MF(t){return function(c){return t.apply(null,c)}}function IF(t){return yn.isObject(t)&&t.isAxiosError===!0}const Aw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Aw).forEach(([t,s])=>{Aw[s]=t});function sI(t){const s=new Hm(t),c=FM(Hm.prototype.request,s);return yn.extend(c,Hm.prototype,s,{allOwnKeys:!0}),yn.extend(c,s,null,{allOwnKeys:!0}),c.create=function(g){return sI(Wm(t,g))},c}const Us=sI(Xy);Us.Axios=Hm;Us.CanceledError=g_;Us.CancelToken=PF;Us.isCancel=JM;Us.VERSION=iI;Us.toFormData=Ex;Us.AxiosError=Li;Us.Cancel=Us.CanceledError;Us.all=function(s){return Promise.all(s)};Us.spread=MF;Us.isAxiosError=IF;Us.mergeConfig=Wm;Us.AxiosHeaders=ac;Us.formToJSON=t=>KM(yn.isHTMLForm(t)?new FormData(t):t);Us.getAdapter=rI.getAdapter;Us.HttpStatusCode=Aw;Us.default=Us;const{Axios:bne,AxiosError:wne,CanceledError:Sne,isCancel:Tne,CancelToken:Cne,VERSION:Ene,all:Ane,Cancel:Pne,isAxiosError:Mne,spread:Ine,toFormData:Rne,AxiosHeaders:Dne,HttpStatusCode:kne,formToJSON:One,getAdapter:Lne,mergeConfig:zne}=Us,Px="http://34.172.63.27:5000/api/features",I5=async t=>{try{const s=await fetch(`${Px}/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const c=await s.json();throw new Error(c.error||"Failed to delete feature")}return s.json()}catch(s){throw console.error("[ERROR] Failed to delete feature:",s),s}},Mx=async t=>{try{const s=await fetch(`${Px}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}),c=await s.json();if(!s.ok)throw new Error(c.error||"Failed to save feature");return c}catch(s){throw console.error("[ERROR] Failed to save feature:",s.message),s}},RF=async t=>{if(!t)throw new Error("Missing projectId when fetching features");try{const s=await fetch(`${Px}/my-projects/${t}`,{method:"GET",credentials:"include"});if(!s.ok){if(s.status===401||s.status===403){alert("Session expired. Please log in again."),window.location.href="/login";return}const c=await s.json();throw console.error("[ERROR] Failed to fetch features:",s.status,c),new Error("Failed to fetch features")}return await s.json()}catch(s){throw console.error("[ERROR] Error in fetchFeatures:",s),s}};async function DF(t,s){try{return(await Us.patch(`${Px}/${encodeURIComponent(t)}`,{newName:s},{headers:{"Content-Type":"application/json"},withCredentials:!0})).data}catch(c){throw c.response?console.error("API Error:",c.response.data):c.request?console.error("Request Error:",c.request):console.error("Error:",c.message),new Error("Failed to update feature name")}}const kF=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-symbol",type:"symbol",layout:{"text-line-height":1.1,"text-size":15,"text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-anchor":"left","text-justify":"left","text-offset":[.8,.8],"text-field":["get","radius"],"text-max-width":7},paint:{"text-color":"hsl(0, 0%, 95%)","text-halo-color":"hsl(0, 5%, 0%)","text-halo-width":1,"text-halo-blur":1},filter:["==","meta","currentPosition"]}];function OF(t,s,c,p){const g=new FileReader;g.onload=v=>{let S;try{S=JSON.parse(v.target.result)}catch(O){console.error("Invalid JSON:",O);return}const r=Date.now(),E=`geojson-source-${r}`,A=`geojson-fill-${r}`,I=`geojson-line-${r}`;t.addSource(E,{type:"geojson",data:S}),t.addLayer({id:A,type:"fill",source:E,slot:"bottom",paint:{"fill-color":"#0080ff","fill-opacity":.2}}),t.addLayer({id:I,type:"line",source:E,slot:"bottom",paint:{"line-color":"#000","line-width":2}});const F=s.name.replace(/\.[^/.]+$/,"")||"Layer";let z=1,R=F;const D=c.map(O=>O.name);for(;D.includes(R);)R=`${F} ${z++}`;p(O=>[...O,{id:E,name:R,visible:!0,locked:!1,fillId:A,lineId:I}])},g.readAsText(s)}function LF(t,s,c){if(!t||!s)return;const{name:p,id:g,fillId:v,lineId:S,visible:r}=s,E=r?"none":"visible",A=g.endsWith("_dash")?g.slice(0,-5):g,I=`${A}_bg`,F=`${A}_dash`;if(t.getLayer(p)&&t.setLayoutProperty(p,"visibility",E),t.getLayer(I)&&t.setLayoutProperty(I,"visibility",E),t.getLayer(F)&&t.setLayoutProperty(F,"visibility",E),g&&t.getLayer(g)){const z=`${g}-0`,R=`${g}-1`;t.setLayoutProperty(g,"visibility",E),t.getLayer(z)&&t.setLayoutProperty(z,"visibility",E),t.getLayer(R)&&t.setLayoutProperty(R,"visibility",E)}v&&t.getLayer(v)&&t.setLayoutProperty(v,"visibility",E),S&&t.getLayer(S)&&t.setLayoutProperty(S,"visibility",E),c(z=>z.map(R=>R.id===g?{...R,visible:!r}:R))}function zF(t,s){s(c=>c.map(p=>p.id===t.id?{...p,locked:!p.locked}:p))}function FF(t,s,c){if(!t||!s)return;const{name:p,id:g,fillId:v,lineId:S}=s,r=g.endsWith("_dash")?g.slice(0,-5):g,E=`${r}_bg`,A=`${r}_dash`;if(g){const I=`${g}-0`,F=`${g}-1`;t.getLayer(g)&&t.removeLayer(g),t.getLayer(I)&&t.removeLayer(I),t.getLayer(F)&&t.removeLayer(F)}t.getLayer(p)&&t.removeLayer(p),t.getLayer(g)&&t.removeLayer(g),t.getLayer(E)&&t.removeLayer(E),t.getLayer(A)&&t.removeLayer(A),v&&t.getLayer(v)&&t.removeLayer(v),S&&t.getLayer(S)&&t.removeLayer(S),g&&t.getSource(g)&&t.removeSource(g),c(I=>I.filter(F=>F.id!==g))}async function BF(t,s,c,p){t&&typeof t.delete=="function"&&(t.trash(),t.delete(c));try{const g=localStorage.getItem("authToken");if(c){const v=typeof c=="string"&&c.endsWith("_dash")?c.slice(0,-5):c;await I5(v,g)}else await I5(s,g)}catch(g){console.error(`Failed to delete feature ${s} from backend.`,g)}}function NF(t,s,c){c(p=>{const g=s.trim();return g?p.map(S=>{if(S.id===t){if(S.name===g)return Po.fire({icon:"info",title:"No change",text:"The new name is the same as the current one.",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),S;const r={...S,name:g};return DF(S.id,g).then(E=>{Po.fire({icon:"success",title:"Name Updated",text:`Layer name successfully updated to "${g}".`,toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),window.location.reload()}).catch(E=>{Po.fire({icon:"error",title:"Update Failed",text:"Failed to update the feature name in the backend.",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),console.error("Failed to update feature name in the backend:",E)}),r}return S}):(Po.fire({icon:"error",title:"Invalid name",text:"Name cannot be empty.",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),p)})}const VF=(t,s,c,p)=>{c(!0),p(s),t.dataTransfer.setData("text/plain","")},R5=t=>{t.preventDefault()},UF=(t,s,c,p,g,v)=>{if(t.preventDefault(),v(!1),c!==null&&c!==s){const S=[...p],r=S[c];S.splice(c,1),S.splice(s,0,r),g(S)}},jF=({id:t,mapRef:s,draw:c,layers:p,activeLayerId:g,setActiveLayerId:v,setActiveMapboxLayerId:S})=>{const r=p.find(R=>R.id===t);if(!r||!s?.current){console.warn(`Layer with ID ${t} not found or map not ready.`);return}let E=s.current.getLayer(r.id)||s.current.getLayer(r.name);if(!E){console.warn(`Layer ${r.id} or ${r.name} not found on map.`);return}const A=(R,D)=>{const O={typhoon:{original:.07,active:.1},low_pressure:{original:.028,active:.06},high_pressure:{original:.028,active:.06},less_1:{original:.28,active:.6}},N={original:.07,active:.1},H=O[R]||N;return D?H.active:H.original},I=()=>{if(!g||g===E.id)return;const R=s.current.getLayer(g);if(!R)return;const O=p.find(N=>N.id===R.id||N.name===R.id)?.type;if(R.type==="line")s.current.setPaintProperty(R.id,"line-width",3);else if(R.type==="symbol"){const N=A(O,!1);s.current.setLayoutProperty(R.id,"icon-size",N)}},F=()=>{if(E.type==="line")s.current.setPaintProperty(E.id,"line-width",8);else if(E.type==="symbol"){const R=A(r.type,!0);s.current.setLayoutProperty(E.id,"icon-size",R)}},z=()=>{c?.get&&c?.changeMode&&c.get(E.id)&&c.changeMode("simple_select",{featureIds:[E.id]})};I(),F(),z(),v(r.id),S&&S(E.id)},GF=pn.li`
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.4rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 10px;
  padding: 0.4rem 0.6rem;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color: ${({isDarkMode:t})=>t?"#fff":"#222"};
  font-size: 0.8rem;
  cursor: move;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
  user-select: none;

  ${({isActive:t})=>t&&`border-color: #3b82f6;
    background: rgba(59, 130, 246, 0.1);`}
`,$F=pn.span`
  flex-grow: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-weight: ${({isEditing:t})=>t?600:400};
  cursor: ${({isEditing:t})=>t?"text":"pointer"};
`,HF=pn.input`
  border: none;
  outline: none;
  background: transparent;
  color: inherit;
  font-weight: 600;
  width: 100%;
  font-size: 0.8rem;
`,R2=pn.button`
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  font-size: 0.85rem;
  opacity: 0.8;
  padding: 2px;

  &:hover {
    opacity: 1;
    color: ${({danger:t})=>t?"#e11d48":"#3b82f6"};
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
`,qF=({layer:t,toggleLayerVisibility:s,toggleLayerLock:c,removeLayer:p,updateLayerName:g,isActiveLayer:v,setActiveLayer:S,index:r,onDragStart:E,onDragOver:A,onDrop:I,isDarkMode:F,draw:z,mapRef:R,setDragging:D,setDraggedLayerIndex:O,setLayers:N})=>{const[H,j]=Te.useState(!1),[V,Z]=Te.useState(t.name),[X,se]=Te.useState(!1),ge=Te.useRef(null);Te.useEffect(()=>{!V.trim()&&!X&&Z("Untitled Layer")},[V,X]);const ae=J=>{Z(J.target.value),se(!0)},oe=Te.useCallback(()=>{const J=V.trim();J||Z(t.name),j(!1),J&&J!==t.name&&g(t.id,J,N)},[V,t.id,g,N]),fe=()=>{t.locked?window.confirm("Are you sure you want to delete this locked layer?")&&p(t.id):(p(t.id),BF(z,t.id,t.sourceID),Po.fire({icon:"success",title:"Layer Deleted",text:"The layer has been deleted successfully.",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1,background:"#d4edda",color:"#155724"}))},pe=J=>{J.stopPropagation(),s(t.id)},K=J=>{J.stopPropagation(),c(t.id)},ye=()=>{S(t.id)};return ue.jsxs(GF,{isDarkMode:F,isActive:v,draggable:!0,onClick:ye,onDragStart:J=>E(J,r,D,O),onDragOver:A,onDrop:J=>I(J,r),children:[ue.jsx(R2,{onClick:pe,children:t.visible?ue.jsx(OM,{}):ue.jsx(qL,{})}),ue.jsx($F,{isEditing:H,onDoubleClick:()=>j(!0),children:H?ue.jsx(HF,{ref:ge,value:V,onChange:ae,onBlur:oe,onKeyDown:J=>J.key==="Enter"&&oe(),autoFocus:!0}):V||"Untitled Layer"}),ue.jsx(R2,{onClick:K,disabled:t.isMap,children:t.locked?ue.jsx(KL,{}):ue.jsx(XL,{})}),ue.jsx(R2,{onClick:J=>{J.stopPropagation(),fe()},disabled:t.isMap||t.locked,danger:!0,children:ue.jsx(zM,{})})]})},WF=(t,s)=>({position:"fixed",top:"78px",right:"5px",backdropFilter:"blur(12px)",borderRadius:t.borderRadius.xlarge||"1rem",border:`1px solid ${t.colors.textPrimary}`,color:t.colors.textPrimary,padding:s?t.spacing.small:t.spacing.medium,width:"320px",maxWidth:"380px",maxHeight:s?"7rem":"min(90vh, 1400px)",overflowY:s?"hidden":"auto",scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"},fontFamily:t.fonts.regular,transform:s?"scale(0.98)":"scale(1)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:t.isDark?"0 25px 50px -12px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05)":"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05)","&:hover":{transform:"translateY(-4px) scale(1.005)",boxShadow:t.isDark?"0 32px 64px -12px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1)":"0 32px 64px -12px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(0, 0, 0, 0.08)",borderColor:t.isDark?"rgba(59, 130, 246, 0.3)":"rgba(59, 130, 246, 0.2)"},"&:active":{transform:"translateY(-2px) scale(1.005)"},"@media (max-width: 768px)":{width:"calc(100vw - 2rem)",maxWidth:"calc(100vw - 2rem)",maxHeight:s?"3rem":"clamp(320px, 55vh, 500px)",right:"1rem",bottom:t.spacing.medium,padding:s?t.spacing.small:"1.25rem"}}),ZF=(t,s)=>({display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:t.fontWeights.bold||600,fontSize:"clamp(0.875rem, 1.5vw, 1rem)",marginBottom:s?"0":t.spacing.small,cursor:"pointer",color:t.colors.textPrimary,padding:`${t.spacing.xsmall} ${t.spacing.xxsmall||"0.25rem"}`,borderRadius:t.borderRadius.small,transition:"all 0.2s ease",position:"relative",overflow:"hidden","&::after":{content:'""',position:"absolute",bottom:"0",left:"0",width:s?"0":"100%",height:"2px",background:`linear-gradient(90deg, ${t.mainColors.blue||"#01a0da"}, ${t.mainColors.blueHover||"#0ea5e9"})`,transition:"width 0.3s ease"},"&:hover":{backgroundColor:t.colors.hoverBackground||"#f8fafc",transform:"translateY(-1px)","&::after":{width:"100%"}},"&:active":{transform:"translateY(0)"},"@media (max-width: 1200px)":{fontSize:"clamp(0.8rem, 1.4vw, 0.9rem)"},"@media (max-width: 768px)":{fontSize:"clamp(0.75rem, 1.3vw, 0.85rem)"}}),YF=t=>({background:`linear-gradient(135deg, ${t.mainColors.blue||"#01a0da"} 0%, ${t.mainColors.blueHover||"#0ea5e9"} 100%)`,color:t.mainColors.white||"#ffffff",border:"none",padding:`${t.spacing.small} ${t.spacing.medium}`,borderRadius:t.borderRadius.small,cursor:"pointer",width:"100%",fontFamily:t.fonts.medium,fontSize:"clamp(0.75rem, 1.2vw, 0.875rem)",fontWeight:500,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",overflow:"hidden",boxShadow:`
    0 2px 8px rgba(1, 160, 218, 0.3),
    0 1px 3px rgba(1, 160, 218, 0.2)
  `,"&::after":{content:'""',position:"absolute",top:"50%",left:"50%",width:"0",height:"0",background:"rgba(255, 255, 255, 0.3)",borderRadius:"50%",transform:"translate(-50%, -50%)",transition:"width 0.3s ease, height 0.3s ease"},"&:hover":{transform:"translateY(-2px)",boxShadow:`
      0 4px 12px rgba(1, 160, 218, 0.4),
      0 2px 6px rgba(1, 160, 218, 0.3)
    `,background:`linear-gradient(135deg, ${t.mainColors.blueHover||"#0ea5e9"} 0%, ${t.mainColors.blue||"#01a0da"} 100%)`},"&:active":{transform:"translateY(0)",boxShadow:`
      0 2px 4px rgba(1, 160, 218, 0.3),
      0 1px 2px rgba(1, 160, 218, 0.2)
    `,"&::after":{width:"120%",height:"120%"}},"&:disabled":{background:t.colors.disabled||"#f3f4f6",color:t.colors.textSecondary||"#9ca3af",cursor:"not-allowed",transform:"none",boxShadow:"none"},"@media (max-width: 1200px)":{padding:`${t.spacing.xsmall} ${t.spacing.small}`,fontSize:"clamp(0.7rem, 1.1vw, 0.8rem)"},"@media (max-width: 768px)":{padding:`${t.spacing.xsmall} ${t.spacing.small}`,fontSize:"clamp(0.65rem, 1vw, 0.75rem)"}}),XF=t=>({listStyle:"none",margin:0,padding:0,color:t.colors.textPrimary,fontFamily:t.fonts.light,fontSize:"clamp(0.75rem, 1.1vw, 0.875rem)",display:"flex",flexDirection:"column",gap:t.spacing.small,"@media (max-width: 1200px)":{gap:t.spacing.xsmall,fontSize:"clamp(0.7rem, 1vw, 0.8rem)"},"@media (max-width: 768px)":{gap:t.spacing.xxsmall||"0.25rem",fontSize:"clamp(0.65rem, 0.9vw, 0.75rem)"}}),KF=t=>({textAlign:"center",marginTop:t.spacing.medium,paddingTop:t.spacing.small,color:t.colors.textSecondary,fontFamily:t.fonts.thin,fontSize:"clamp(0.625rem, 1vw, 0.75rem)",borderTop:`1px solid ${t.colors.border||"#f0f0f0"}`,opacity:.8,transition:"opacity 0.2s ease","&:hover":{opacity:1},"@media (max-width: 1200px)":{marginTop:t.spacing.small,fontSize:"clamp(0.6rem, 0.9vw, 0.7rem)"},"@media (max-width: 768px)":{fontSize:"clamp(0.55rem, 0.8vw, 0.65rem)"}}),JF=pn.div`
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000; /* Make sure it's higher than the toolbar */
  pointer-events: all;
`,QF=pn(qy.div)`
  background: white;
  padding: 30px 20px;
  border-radius: 16px;
  max-width: 320px;
  width: 100%;
  text-align: center;
  position: relative;
  box-shadow: 0px 12px 30px rgba(0, 0, 0, 0.1);
`,e8=pn.div`
  background: #f1f5f9;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 16px;
`,t8=pn.h2`
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
`,n8=pn.p`
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 24px;
`,r8=pn.button`
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 16px;
  font-weight: 500;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  justify-content: center;

  &:hover {
    background-color: #1d4ed8;
  }
`,i8={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},o8=({isOpen:t,onClose:s})=>ue.jsx(Hy,{children:t&&ue.jsx(JF,{onClick:s,children:ue.jsxs(QF,{variants:i8,initial:"hidden",animate:"visible",exit:"exit",onClick:c=>c.stopPropagation(),children:[ue.jsx(e8,{children:ue.jsx(PM,{size:22,color:"#F59E0B"})}),ue.jsx(t8,{children:"Map Not Ready"}),ue.jsx(n8,{children:"The map is still loading. Please wait a moment while we prepare everything for you."}),ue.jsx(r8,{onClick:s,children:"Got it"})]})})}),s8=({mapRef:t,isDarkMode:s,layers:c,setLayers:p,draw:g})=>{const[v,S]=Te.useState(!1),[r,E]=Te.useState(!1),[A,I]=Te.useState(!1),[F,z]=Te.useState(null),[R,D]=Te.useState(null),[O,N]=Te.useState(!1),[H,j]=Te.useState(null),V=Te.useRef(),[Z,X]=Te.useState(!1),[se,ge]=Te.useState(!1),[ae,oe]=Te.useState(!1),[fe,pe]=Te.useState(!1),[K,ye]=Te.useState(!1),[J,de]=Te.useState(!1),Ae=s?CM:a5;Te.useEffect(()=>{const Be={PAR:localStorage.getItem("PAR")==="true",TCID:localStorage.getItem("TCID")==="true",TCAD:localStorage.getItem("TCAD")==="true",ShippingZonestate:localStorage.getItem("SHIPPING_ZONE")==="true",WindLayer:localStorage.getItem("wind_layer")==="true"};ge(Be.PAR),oe(Be.TCID),pe(Be.TCAD),ye(Be.ShippingZonestate),de(Be.WindLayer),t.current&&t.current.on("load",()=>{t.current.setLayoutProperty("PAR","visibility",Be.PAR?"visible":"none"),t.current.setLayoutProperty("TCID","visibility",Be.TCID?"visible":"none"),t.current.setLayoutProperty("TCAD","visibility",Be.TCAD?"visible":"none"),t.current.setLayoutProperty("graticules","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("graticules_blur","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("country-boundaries","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("ERA5_c1","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("ERA5_c2","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("SHIPPING_ZONE_FILL","visibility",Be.ShippingZonestate?"visible":"none"),t.current.setLayoutProperty("wind-layer","visibility",Be.WindLayer?"visible":"none")})},[t]);const ne=Be=>{const at=Be.target.files[0];!at||!t.current||OF(t.current,at,c,p)},xe=()=>{if(!t.current){console.error("Map is not ready yet."),I(!0);return}V.current.value=null,V.current.click()},Ce=Be=>{jF({id:Be,mapRef:t,draw:g,layers:c,activeLayerId:F,setActiveLayerId:z,setActiveMapboxLayerId:D})},Re=Be=>{if(!localStorage.getItem("projectId")){Po.fire({toast:!0,position:"top-end",icon:"warning",title:"Please select or create a project first.",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:s?"#374151":"#fff",color:s?"#f3f4f6":"#111827",customClass:{popup:"swal-toast-popup",title:"swal-toast-title"}});return}switch(Be){case"PAR":ge(ut=>{const nt=!ut;return localStorage.setItem("PAR",nt.toString()),t.current?.setLayoutProperty("PAR","visibility",nt?"visible":"none"),nt});break;case"TCID":oe(ut=>{const nt=!ut;return localStorage.setItem("TCID",nt.toString()),t.current?.setLayoutProperty("TCID","visibility",nt?"visible":"none"),nt});break;case"TCAD":pe(ut=>{const nt=!ut;return localStorage.setItem("TCAD",nt.toString()),t.current?.setLayoutProperty("TCAD","visibility",nt?"visible":"none"),nt});break;case"SHIPPING_ZONE":ye(ut=>{const nt=!ut;return localStorage.setItem("SHIPPING_ZONE",nt.toString()),t.current?.setLayoutProperty("ERA5_c1","visibility",nt?"visible":"none"),t.current?.setLayoutProperty("ERA5_c2","visibility",nt?"visible":"none"),t.current?.setLayoutProperty("graticules","visibility",nt?"visible":"none"),t.current?.setLayoutProperty("graticules_blur","visibility",nt?"visible":"none"),t.current?.setLayoutProperty("country-boundaries","visibility",nt?"visible":"none"),nt});break;case"Wind Layer":de(ut=>{const nt=!ut;return localStorage.setItem("wind_layer",nt.toString()),t.current?.setLayoutProperty("wind-layer","visibility",nt?"visible":"none"),nt});break}},Ee=({name:Be,isVisible:at,onToggle:ut,description:nt})=>ue.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",margin:"2px 0",borderRadius:Ae.borderRadius.small,backgroundColor:at?`${Ae.colors.primary}15`:Ae.colors.background,border:`1px solid ${at?Ae.colors.primary:Ae.colors.border}`,transition:"all 0.2s ease",cursor:"pointer"},onClick:ut,onMouseEnter:$e=>{$e.target.style.backgroundColor=at?`${Ae.colors.primary}25`:`${Ae.colors.border}20`},onMouseLeave:$e=>{$e.target.style.backgroundColor=at?`${Ae.colors.primary}15`:Ae.colors.background},children:[ue.jsxs("div",{style:{flex:1,minWidth:0},children:[ue.jsx("div",{style:{fontWeight:"500",fontSize:"0.875rem",color:at?Ae.colors.primary:Ae.colors.textPrimary,marginBottom:"2px"},children:Be}),nt&&ue.jsx("div",{style:{fontSize:"0.75rem",color:Ae.colors.textSecondary,opacity:.8},children:nt})]}),ue.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[ue.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:at?"#10b981":"#ef4444",boxShadow:`0 0 0 2px ${at?"#10b98120":"#ef444420"}`}}),at?ue.jsx(nz,{style:{color:Ae.colors.primary,fontSize:"1.2rem"}}):ue.jsx(tz,{style:{color:Ae.colors.textSecondary,fontSize:"1.2rem"}})]})]}),Oe=[{name:"PAR",state:se,key:"PAR",description:"Protected Areas and Reserves"},{name:"TCID",state:ae,key:"TCID",description:"Territorial Coverage ID"},{name:"TCAD",state:fe,key:"TCAD",description:"Territorial Coverage AD"},{name:"Graticules, Wave & Wind",state:K,key:"SHIPPING_ZONE",description:"Graticules and Wave and Wind Elements"},{name:"Wind Layer",state:J,key:"Wind Layer",description:"Wind Speed & Direction"}];return ue.jsxs(ue.Fragment,{children:[ue.jsxs("div",{style:{...WF(Ae,v),...Z&&{transform:"translateY(-4px) scale(1.02)",boxShadow:a5.isDark?"0 32px 64px -12px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1)":"0 32px 64px -12px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(0, 0, 0, 0.08)"}},onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),onDragOver:R5,children:[ue.jsxs("div",{style:{...ZF(Ae,v),display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",borderBottom:v?"none":`1px solid ${Ae.colors.border}`},onClick:()=>S(!v),children:[ue.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[ue.jsx(YL,{style:{color:Ae.colors.primary}}),ue.jsx("span",{style:{fontWeight:"600",fontSize:"1rem"},children:"Layers"}),ue.jsx("div",{style:{backgroundColor:Ae.colors.primary,color:"white",borderRadius:"12px",padding:"2px 8px",fontSize:"0.75rem",fontWeight:"500"},children:c.length+Oe.filter(Be=>Be.state).length})]}),ue.jsx("div",{children:v?ue.jsx(h5,{}):ue.jsx(ww,{})})]}),!v&&ue.jsxs(ue.Fragment,{children:[ue.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:[ue.jsxs("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:Ae.colors.textPrimary,padding:"8px 4px",borderBottom:`1px solid ${Ae.colors.border}`,marginBottom:"8px"},children:["Custom Layers (",c.length,")"]}),ue.jsx("div",{style:{maxHeight:"min(35vh, 350px)",overflowY:"auto"},children:ue.jsx("ul",{style:{...XF(Ae),margin:0,padding:0},children:c.map((Be,at)=>ue.jsx(qF,{layer:Be,toggleLayerVisibility:()=>LF(t.current,Be,p),toggleLayerLock:()=>zF(Be,p),removeLayer:()=>FF(t.current,Be,p),updateLayerName:(ut,nt,$e)=>{NF(Be.id,nt,$e)},isActiveLayer:F===Be.id,setActiveLayer:Ce,index:at,isDarkMode:s,draggable:!0,onDragStart:ut=>VF(ut,at,N,j),onDragOver:R5,onDrop:ut=>UF(ut,at,H,c,p,N),draw:g,mapRef:t.current,setDragging:N,setDraggedLayerIndex:j,setLayers:p},Be.id||`layer-${at}`))})}),ue.jsxs("div",{style:{marginTop:"16px"},children:[ue.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.875rem",fontWeight:"600",color:Ae.colors.textPrimary,padding:"8px 4px",borderBottom:`1px solid ${Ae.colors.border}`,marginBottom:"8px",cursor:"pointer"},onClick:()=>E(!r),children:[ue.jsxs("span",{children:["System Layers (",Oe.filter(Be=>Be.state).length,")"]}),r?ue.jsx(h5,{size:12}):ue.jsx(ww,{size:12})]}),!r&&ue.jsx("div",{style:{paddingLeft:"4px"},children:Oe.map(Be=>ue.jsx(Ee,{name:Be.name,description:Be.description,isVisible:Be.state,onToggle:()=>Re(Be.key)},Be.key))})]})]}),ue.jsx("div",{style:{...KF(Ae),display:"flex",flexDirection:"column",gap:"8px",flexShrink:0,padding:"12px 16px",borderTop:`1px solid ${Ae.colors.border}`},children:ue.jsxs("button",{onClick:xe,style:{...YF(Ae),display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"10px 16px",fontWeight:"500",borderRadius:Ae.borderRadius.medium,transition:"all 0.2s ease"},onMouseEnter:Be=>{Be.target.style.transform="translateY(-1px)",Be.target.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:Be=>{Be.target.style.transform="translateY(0)",Be.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},children:[ue.jsx("input",{type:"file",accept:".geojson,application/geo+json,application/json",ref:V,style:{display:"none"},onChange:ne}),ue.jsx(LM,{}),ue.jsx("span",{children:"Add GeoJSON Layer"})]})})]})]}),A&&ue.jsx(o8,{isOpen:A,onClose:()=>I(!1)})]})};var a1,a8=new Uint8Array(16);function l8(){if(!a1&&(a1=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!a1))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a1(a8)}const c8=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function u8(t){return typeof t=="string"&&c8.test(t)}var Fa=[];for(var D2=0;D2<256;++D2)Fa.push((D2+256).toString(16).substr(1));function d8(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=(Fa[t[s+0]]+Fa[t[s+1]]+Fa[t[s+2]]+Fa[t[s+3]]+"-"+Fa[t[s+4]]+Fa[t[s+5]]+"-"+Fa[t[s+6]]+Fa[t[s+7]]+"-"+Fa[t[s+8]]+Fa[t[s+9]]+"-"+Fa[t[s+10]]+Fa[t[s+11]]+Fa[t[s+12]]+Fa[t[s+13]]+Fa[t[s+14]]+Fa[t[s+15]]).toLowerCase();if(!u8(c))throw TypeError("Stringified UUID is invalid");return c}function fS(t,s,c){t=t||{};var p=t.random||(t.rng||l8)();return p[6]=p[6]&15|64,p[8]=p[8]&63|128,d8(p)}function h8(t){return Ps({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 21h4l13 -13a1.5 1.5 0 0 0 -4 -4l-13 13v4"},child:[]},{tag:"path",attr:{d:"M14.5 5.5l4 4"},child:[]},{tag:"path",attr:{d:"M12 8l-5 -5l-4 4l5 5"},child:[]},{tag:"path",attr:{d:"M7 8l-1.5 1.5"},child:[]},{tag:"path",attr:{d:"M16 12l5 5l-4 4l-5 -5"},child:[]},{tag:"path",attr:{d:"M16 17l-1.5 1.5"},child:[]}]})(t)}const f8="/assets/wave-BCIRDIW2.png",p8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAAClCAYAAAA9Kz3aAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANMSURBVHgB7d3tkdNWFAbgo50UQAcxHUAFOB2QCjAVZFOB5AoSKmDTAalgNxWEDnAJWwHiXsnLGhZYybItIz3PD49/aMa743fOPffowxEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA56oIzkNZP0mvl+kb+fWHx9WxjnWxiQn7JRhfWS9TGN+md4tHj72Iq/S6iQkTyjHl6tiG8WXw2UUwjrLOS/WHEMgHVMpTK+vFtjoug29SKYfIy28OWffjqxTI/0Mgf0il3Ee7MSkjh6uIVTy28eizkUEoeynrlylcf0SfStcu19dBZ0L5mPv5YQ7jk+DohPJ7yvpZCuKr9G4Vxw/jJg3F/0yf91dY4m10Hsj9X1Vfbzckl3H8QP6dAvk8naV5FzRUyiwv0RepKtbNzHAZp/E+Bf8yyuK/4AvzDuVuv1ifrF+8TZ9XpTC+Cb5pnqFsRzS5X8yV8ZSbl5sU/tdRTfuCiqHmFcrd+eJwt5H7wY/xb6djcxj1jZ1MP5T3/WLetCxiuJvt8tu1F8yBfJoCeRt0Mt1QHrZfbKtiHW96h0sYe5teKA+7RPetihzAdELZDrvz8HkZw+xfFTmI6YSy7znph1TFMzH34bmqeIbmGkpV8YzNL5RFGpiXRZfZIiOZXyjreBdVnc87t4Nvy/bZmetVQs9SOK+aG7eq+m2vWxo4urlfupaH6qttOK9jXb8KRjedUOYddDQ36u9r2VTPqlY9RzadUK6L91EVr5vzzG049+0VF6F6jmq6zxJqK93dKcdFDLOJ9rKz4z7HJ1fpx/7WIv1PEx9lzeMBV2W92l4/uYzh8ozzKgXjnzg0oWzM66lr6/pFqnaraG8GG2oTh66eQtmY1+47f5lf9p2b2N8icrgv4kVwUPMcCeXK1obzeXNF+MQfrfezmfecMp/NWRdpDFQ83YbzJhid+77vtOH8bWdpZyRC+bX7pT2HswpL+8kJ5fe04VzvLO2b4CSEsou7vrNo5pxukz0yoeyjHSn9ru88LqHcx27f2e1hBPTgAVdDTPz3bMaiUnJ2hJKzI5QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMF+fADXa7ElmESpnAAAAAElFTkSuQmCC",m8="/assets/LPA-BUIabFDw.png",g8="/assets/HPA-CXIxp5Yn.png",_8="/assets/hurricane-Dmasq-6Z.png",y8=pn.div`
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: ${({theme:t})=>t.colors.loadingBackground||"rgba(0, 0, 0, 0.3)"};
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
`,v8=pn(qy.div)`
  background: ${({theme:t})=>t.colors.lightBackground};
  padding: 30px 20px;
  border-radius: 16px;
  max-width: 320px;
  width: 100%;
  text-align: center;
  position: relative;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
  font-family: ${({theme:t})=>t.fonts.regular};
`,x8=pn.div`
  background: ${({theme:t})=>t.colors.itemBackground||"#f1f5f9"};
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 16px;
`,b8=pn.h2`
  font-size: ${({theme:t})=>t.fontSizes.medium};
  font-weight: ${({theme:t})=>t.fontWeights.bold};
  margin-bottom: ${({theme:t})=>t.spacing.small};
  color: ${({theme:t})=>t.colors.textPrimary};
`,k2=pn.button`
  background-color: ${({theme:t})=>t.mainColors.blue};
  color: ${({theme:t})=>t.mainColors.white};
  border: none;
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  padding: ${({theme:t})=>`${t.spacing.small} ${t.spacing.medium}`};
  font-weight: ${({theme:t})=>t.fontWeights.medium};
  font-family: ${({theme:t})=>t.fonts.medium};
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  justify-content: center;
  margin-bottom: 10px;

  &:hover {
    background-color: ${({theme:t})=>t.mainColors.lightBlue};
  }

  &:last-child {
    margin-bottom: 0;
  }
`,w8={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},S8=({isOpen:t,onClose:s,onSelect:c})=>ue.jsx(Hy,{children:t&&ue.jsx(y8,{onClick:s,children:ue.jsxs(v8,{variants:w8,initial:"hidden",animate:"visible",exit:"exit",onClick:p=>p.stopPropagation(),children:[ue.jsx(x8,{children:ue.jsx(MM,{size:22,color:"#2563eb"})}),ue.jsx(b8,{children:"Select Marker Input Method"}),ue.jsx(k2,{onClick:()=>c("manual"),children:"Enter Latitude & Longitude"}),ue.jsx(k2,{onClick:()=>c("map"),children:"Click on the Map"}),ue.jsx(k2,{onClick:s,children:"Cancel"})]})})}),T8=pn.div`
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: ${({theme:t})=>t.colors.loadingBackground||"rgba(0, 0, 0, 0.4)"};
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: ${({theme:t})=>t.zIndex.loadingScreen||1001};
`,C8=pn(qy.div)`
  background: ${({theme:t})=>t.colors.lightBackground};
  padding: ${({theme:t})=>`${t.spacing.large} ${t.spacing.medium}`};
  border-radius: ${({theme:t})=>t.borderRadius.xlarge};
  width: 90%;
  max-width: 360px;
  text-align: center;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
`,E8=pn.h3`
  margin-bottom: ${({theme:t})=>t.spacing.medium};
  font-size: ${({theme:t})=>t.fontSizes.large};
  font-weight: ${({theme:t})=>t.fontWeights.bold};
  color: ${({theme:t})=>t.colors.textPrimary};
  font-family: ${({theme:t})=>t.fonts.medium};
`,O2=pn.input`
  width: 100%;
  margin-bottom: ${({theme:t})=>t.spacing.medium};
  padding: ${({theme:t})=>t.spacing.small};
  font-size: ${({theme:t})=>t.fontSizes.medium};
  border: 1px solid ${({theme:t})=>t.colors.border||"#d1d5db"};
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  box-sizing: border-box;
  font-family: ${({theme:t})=>t.fonts.regular};
  color: ${({theme:t})=>t.colors.textPrimary};
  background: ${({theme:t})=>t.colors.background};

  &:focus {
    outline: none;
    border-color: ${({theme:t})=>t.colors.highlight};
    box-shadow: 0 0 0 2px ${({theme:t})=>t.colors.highlight}33;
  }
`,A8=pn.button`
  background-color: ${({theme:t})=>t.mainColors.blue};
  color: ${({theme:t})=>t.mainColors.white};
  width: 100%;
  padding: ${({theme:t})=>t.spacing.medium};
  font-size: ${({theme:t})=>t.fontSizes.medium};
  border: none;
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  cursor: pointer;
  font-family: ${({theme:t})=>t.fonts.medium};
  transition: background-color 0.2s ease;

  &:hover {
    background-color: ${({theme:t})=>t.mainColors.lightBlue};
  }
`,D5=t=>typeof t!="string"||t.trim()===""?!1:!isNaN(t)&&!isNaN(parseFloat(t)),P8=({isOpen:t,onClose:s,onSubmit:c})=>{const[p,g]=Te.useState(""),[v,S]=Te.useState(""),[r,E]=Te.useState(""),A=I=>{if(I.preventDefault(),!D5(p))return alert("Please enter a valid latitude number.");if(!D5(v))return alert("Please enter a valid longitude number.");if(!r.trim())return alert("Storm Title is required.");c({lat:parseFloat(p),lng:parseFloat(v),title:r.trim()}),g(""),S(""),E(""),s()};return ue.jsx(Hy,{children:t&&ue.jsx(T8,{onClick:s,children:ue.jsx(C8,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},onClick:I=>I.stopPropagation(),children:ue.jsxs("form",{onSubmit:A,children:[ue.jsx(E8,{children:"Enter Storm Marker"}),ue.jsx(O2,{type:"number",placeholder:"Latitude",value:p,onChange:I=>g(I.target.value)}),ue.jsx(O2,{type:"number",placeholder:"Longitude",value:v,onChange:I=>S(I.target.value)}),ue.jsx(O2,{type:"text",placeholder:"Storm Title",value:r,onChange:I=>E(I.target.value)}),ue.jsx(A8,{type:"submit",children:"Submit"})]})})})})},M8=pn.div`
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000; /* Make sure it's higher than the toolbar */
  pointer-events: all;
`,I8=pn(qy.div)`
  background: white;
  padding: 30px 20px;
  border-radius: 16px;
  max-width: 320px;
  width: 100%;
  text-align: center;
  position: relative;
  box-shadow: 0px 12px 30px rgba(0, 0, 0, 0.1);
`,R8=pn.div`
  background: #f1f5f9;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 16px;
`,D8=pn.h2`
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
`,k8=pn.p`
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 24px;
`,O8=pn.button`
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 16px;
  font-weight: 500;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  justify-content: center;

  &:hover {
    background-color: #1d4ed8;
  }
`,L8={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},z8=({isOpen:t,onClose:s})=>ue.jsx(Hy,{children:t&&ue.jsx(M8,{onClick:s,children:ue.jsxs(I8,{variants:L8,initial:"hidden",animate:"visible",exit:"exit",onClick:c=>c.stopPropagation(),children:[ue.jsx(R8,{children:ue.jsx(PM,{size:22,color:"#F59E0B"})}),ue.jsx(D8,{children:"Coming Soon"}),ue.jsx(k8,{children:"This feature is still in development. Stay tuned itll be available in a future update!"}),ue.jsx(O8,{onClick:s,children:"Got it"})]})})}),Pw=function(t,s){const c={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},p={on(v,S,r){if(c[v]===void 0)throw new Error(`Invalid event type: ${v}`);c[v].push({selector:S,fn:r})},render(v){s.store.featureChanged(v)}},g=function(v,S){const r=c[v];let E=r.length;for(;E--;){const A=r[E];if(A.selector(S)){A.fn.call(p,S)||s.store.render(),s.ui.updateMapClasses();break}}};return t.start.call(p),{render:t.render,stop(){t.stop&&t.stop()},trash(){t.trash&&(t.trash(),s.store.render())},combineFeatures(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures(){t.uncombineFeatures&&t.uncombineFeatures()},drag(v){g("drag",v)},click(v){g("click",v)},mousemove(v){g("mousemove",v)},mousedown(v){g("mousedown",v)},mouseup(v){g("mouseup",v)},mouseout(v){g("mouseout",v)},keydown(v){g("keydown",v)},keyup(v){g("keyup",v)},touchstart(v){g("touchstart",v)},touchmove(v){g("touchmove",v)},touchend(v){g("touchend",v)},tap(v){g("tap",v)}}};var l1={},g0={},k5;function F8(){return k5||(k5=1,g0.RADIUS=6378137,g0.FLATTENING=1/298.257223563,g0.POLAR_RADIUS=63567523142e-4),g0}var O5;function B8(){if(O5)return l1;O5=1;var t=F8();l1.geometry=s,l1.ring=p;function s(v){var S=0,r;switch(v.type){case"Polygon":return c(v.coordinates);case"MultiPolygon":for(r=0;r<v.coordinates.length;r++)S+=c(v.coordinates[r]);return S;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<v.geometries.length;r++)S+=s(v.geometries[r]);return S}}function c(v){var S=0;if(v&&v.length>0){S+=Math.abs(p(v[0]));for(var r=1;r<v.length;r++)S-=Math.abs(p(v[r]))}return S}function p(v){var S,r,E,A,I,F,z,R=0,D=v.length;if(D>2){for(z=0;z<D;z++)z===D-2?(A=D-2,I=D-1,F=0):z===D-1?(A=D-1,I=0,F=1):(A=z,I=z+1,F=z+2),S=v[A],r=v[I],E=v[F],R+=(g(E[0])-g(S[0]))*Math.sin(g(r[1]));R=R*t.RADIUS*t.RADIUS/2}return R}function g(v){return v*Math.PI/180}return l1}var N8=B8();const V8=al(N8),ic={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},gu={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},us={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},oc={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Jr={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},ao={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Ol={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ky={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},ol={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Ea={ACTIVE:"true",INACTIVE:"false"},aI=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],U8=-90,Mw=-85,j8=90,Iw=85,G8=-270,$8=270,lI=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:j8,LAT_MIN:U8,LAT_RENDERED_MAX:Iw,LAT_RENDERED_MIN:Mw,LNG_MAX:$8,LNG_MIN:G8,activeStates:Ea,classes:ic,cursors:us,events:Ol,geojsonTypes:Jr,interactions:aI,meta:ol,modes:ao,sources:gu,types:oc,updateActions:Ky},Symbol.toStringTag,{value:"Module"})),L5={Point:0,LineString:1,MultiLineString:1,Polygon:2};function H8(t,s){const c=L5[t.geometry.type]-L5[s.geometry.type];return c===0&&t.geometry.type===Jr.POLYGON?t.area-s.area:c}function cI(t){return t.map(s=>(s.geometry.type===Jr.POLYGON&&(s.area=V8.geometry({type:Jr.FEATURE,property:{},geometry:s.geometry})),s)).sort(H8).map(s=>(delete s.area,s))}function uI(t,s=0){return[[t.point.x-s,t.point.y-s],[t.point.x+s,t.point.y+s]]}function vu(t){if(this._items={},this._nums={},this._length=t?t.length:0,!!t)for(let s=0,c=t.length;s<c;s++)this.add(t[s]),t[s]!==void 0&&(typeof t[s]=="string"?this._items[t[s]]=s:this._nums[t[s]]=s)}vu.prototype.add=function(t){return this.has(t)?this:(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length,this)};vu.prototype.delete=function(t){return this.has(t)===!1?this:(this._length--,delete this._items[t],delete this._nums[t],this)};vu.prototype.has=function(t){return typeof t!="string"&&typeof t!="number"?!1:this._items[t]!==void 0||this._nums[t]!==void 0};vu.prototype.values=function(){const t=[];return Object.keys(this._items).forEach(s=>{t.push({k:s,v:this._items[s]})}),Object.keys(this._nums).forEach(s=>{t.push({k:JSON.parse(s),v:this._nums[s]})}),t.sort((s,c)=>s.v-c.v).map(s=>s.k)};vu.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const q8=[ol.FEATURE,ol.MIDPOINT,ol.VERTEX],s_={click:W8,touch:Z8};function W8(t,s,c){return dI(t,s,c,c.options.clickBuffer)}function Z8(t,s,c){return dI(t,s,c,c.options.touchBuffer)}function dI(t,s,c,p){if(c.map===null)return[];const g=t?uI(t,p):s,v={};c.options.styles&&(v.layers=c.options.styles.map(A=>A.id).filter(A=>c.map.getLayer(A)!=null));const S=c.map.queryRenderedFeatures(g,v).filter(A=>q8.indexOf(A.properties.meta)!==-1),r=new vu,E=[];return S.forEach(A=>{const I=A.properties.id;r.has(I)||(r.add(I),E.push(A))}),cI(E)}function N1(t,s){const c=s_.click(t,null,s),p={mouse:us.NONE};return c[0]&&(p.mouse=c[0].properties.active===Ea.ACTIVE?us.MOVE:us.POINTER,p.feature=c[0].properties.meta),s.events.currentModeName().indexOf("draw")!==-1&&(p.mouse=us.ADD),s.ui.queueMapClasses(p),s.ui.updateMapClasses(),c[0]}function pS(t,s){const c=t.x-s.x,p=t.y-s.y;return Math.sqrt(c*c+p*p)}const Y8=4,X8=12,K8=500;function Rw(t,s,c={}){const p=c.fineTolerance!=null?c.fineTolerance:Y8,g=c.grossTolerance!=null?c.grossTolerance:X8,v=c.interval!=null?c.interval:K8;t.point=t.point||s.point,t.time=t.time||s.time;const S=pS(t.point,s.point);return S<p||S<g&&s.time-t.time<v}const J8=25,Q8=250;function Dw(t,s,c={}){const p=c.tolerance!=null?c.tolerance:J8,g=c.interval!=null?c.interval:Q8;return t.point=t.point||s.point,t.time=t.time||s.time,pS(t.point,s.point)<p&&s.time-t.time<g}let eB=(t,s=21)=>(c=s)=>{let p="",g=c|0;for(;g--;)p+=t[Math.random()*t.length|0];return p};const tB=eB("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function mS(){return tB()}const Ll=function(t,s){this.ctx=t,this.properties=s.properties||{},this.coordinates=s.geometry.coordinates,this.id=s.id||mS(),this.type=s.geometry.type};Ll.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Ll.prototype.incomingCoords=function(t){this.setCoordinates(t)};Ll.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};Ll.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Ll.prototype.setProperty=function(t,s){this.properties[t]=s};Ll.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Jr.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Ll.prototype.internal=function(t){const s={id:this.id,meta:ol.FEATURE,"meta:type":this.type,active:Ea.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(const c in this.properties)s[`user_${c}`]=this.properties[c];return{type:Jr.FEATURE,properties:s,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Bp=function(t,s){Ll.call(this,t,s)};Bp.prototype=Object.create(Ll.prototype);Bp.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Bp.prototype.updateCoordinate=function(t,s,c){arguments.length===3?this.coordinates=[s,c]:this.coordinates=[t,s],this.changed()};Bp.prototype.getCoordinate=function(){return this.getCoordinates()};const vh=function(t,s){Ll.call(this,t,s)};vh.prototype=Object.create(Ll.prototype);vh.prototype.isValid=function(){return this.coordinates.length>1};vh.prototype.addCoordinate=function(t,s,c){this.changed();const p=parseInt(t,10);this.coordinates.splice(p,0,[s,c])};vh.prototype.getCoordinate=function(t){const s=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[s]))};vh.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)};vh.prototype.updateCoordinate=function(t,s,c){const p=parseInt(t,10);this.coordinates[p]=[s,c],this.changed()};const Bc=function(t,s){Ll.call(this,t,s),this.coordinates=this.coordinates.map(c=>c.slice(0,-1))};Bc.prototype=Object.create(Ll.prototype);Bc.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(t=>t.length>2)};Bc.prototype.incomingCoords=function(t){this.coordinates=t.map(s=>s.slice(0,-1)),this.changed()};Bc.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};Bc.prototype.addCoordinate=function(t,s,c){this.changed();const p=t.split(".").map(v=>parseInt(v,10));this.coordinates[p[0]].splice(p[1],0,[s,c])};Bc.prototype.removeCoordinate=function(t){this.changed();const s=t.split(".").map(p=>parseInt(p,10)),c=this.coordinates[s[0]];c&&(c.splice(s[1],1),c.length<3&&this.coordinates.splice(s[0],1))};Bc.prototype.getCoordinate=function(t){const s=t.split(".").map(p=>parseInt(p,10)),c=this.coordinates[s[0]];return JSON.parse(JSON.stringify(c[s[1]]))};Bc.prototype.getCoordinates=function(){return this.coordinates.map(t=>t.concat([t[0]]))};Bc.prototype.updateCoordinate=function(t,s,c){this.changed();const p=t.split("."),g=parseInt(p[0],10),v=parseInt(p[1],10);this.coordinates[g]===void 0&&(this.coordinates[g]=[]),this.coordinates[g][v]=[s,c]};const nB={MultiPoint:Bp,MultiLineString:vh,MultiPolygon:Bc},Ix=(t,s,c,p,g)=>{const v=c.split("."),S=parseInt(v[0],10),r=v[1]?v.slice(1).join("."):null;return t[S][s](r,p,g)},kl=function(t,s){if(Ll.call(this,t,s),delete this.coordinates,this.model=nB[s.geometry.type],this.model===void 0)throw new TypeError(`${s.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(s.geometry.coordinates)};kl.prototype=Object.create(Ll.prototype);kl.prototype._coordinatesToFeatures=function(t){const s=this.model.bind(this);return t.map(c=>new s(this.ctx,{id:mS(),type:Jr.FEATURE,properties:{},geometry:{coordinates:c,type:this.type.replace("Multi","")}}))};kl.prototype.isValid=function(){return this.features.every(t=>t.isValid())};kl.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()};kl.prototype.getCoordinate=function(t){return Ix(this.features,"getCoordinate",t)};kl.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(t=>t.type===Jr.POLYGON?t.getCoordinates():t.coordinates)))};kl.prototype.updateCoordinate=function(t,s,c){Ix(this.features,"updateCoordinate",t,s,c),this.changed()};kl.prototype.addCoordinate=function(t,s,c){Ix(this.features,"addCoordinate",t,s,c),this.changed()};kl.prototype.removeCoordinate=function(t){Ix(this.features,"removeCoordinate",t),this.changed()};kl.prototype.getFeatures=function(){return this.features};function Gi(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}Gi.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)};Gi.prototype.setSelectedCoordinates=function(t){this._ctx.store.setSelectedCoordinates(t),t.reduce((s,c)=>(s[c.feature_id]===void 0&&(s[c.feature_id]=!0,this._ctx.store.get(c.feature_id).changed()),s),{})};Gi.prototype.getSelected=function(){return this._ctx.store.getSelected()};Gi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};Gi.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)};Gi.prototype.getFeature=function(t){return this._ctx.store.get(t)};Gi.prototype.select=function(t){return this._ctx.store.select(t)};Gi.prototype.deselect=function(t){return this._ctx.store.deselect(t)};Gi.prototype.deleteFeature=function(t,s={}){return this._ctx.store.delete(t,s)};Gi.prototype.addFeature=function(t,s={}){return this._ctx.store.add(t,s)};Gi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};Gi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};Gi.prototype.setActionableState=function(t={}){const s={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(s)};Gi.prototype.changeMode=function(t,s={},c={}){return this._ctx.events.changeMode(t,s,c)};Gi.prototype.fire=function(t,s){return this._ctx.events.fire(t,s)};Gi.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)};Gi.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)};Gi.prototype.featuresAt=function(t,s,c="click"){if(c!=="click"&&c!=="touch")throw new Error("invalid buffer type");return s_[c](t,s,this._ctx)};Gi.prototype.newFeature=function(t){const s=t.geometry.type;return s===Jr.POINT?new Bp(this._ctx,t):s===Jr.LINE_STRING?new vh(this._ctx,t):s===Jr.POLYGON?new Bc(this._ctx,t):new kl(this._ctx,t)};Gi.prototype.isInstanceOf=function(t,s){if(t===Jr.POINT)return s instanceof Bp;if(t===Jr.LINE_STRING)return s instanceof vh;if(t===Jr.POLYGON)return s instanceof Bc;if(t==="MultiFeature")return s instanceof kl;throw new Error(`Unknown feature class: ${t}`)};Gi.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)};Gi.prototype.onSetup=function(){};Gi.prototype.onDrag=function(){};Gi.prototype.onClick=function(){};Gi.prototype.onMouseMove=function(){};Gi.prototype.onMouseDown=function(){};Gi.prototype.onMouseUp=function(){};Gi.prototype.onMouseOut=function(){};Gi.prototype.onKeyUp=function(){};Gi.prototype.onKeyDown=function(){};Gi.prototype.onTouchStart=function(){};Gi.prototype.onTouchMove=function(){};Gi.prototype.onTouchEnd=function(){};Gi.prototype.onTap=function(){};Gi.prototype.onStop=function(){};Gi.prototype.onTrash=function(){};Gi.prototype.onCombineFeature=function(){};Gi.prototype.onUncombineFeature=function(){};Gi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const hI={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},rB=Object.keys(hI);function iB(t){const s=Object.keys(t);return function(c,p={}){let g={};const v=s.reduce((r,E)=>(r[E]=t[E],r),new Gi(c));function S(r){return E=>v[r](g,E)}return{start(){g=v.onSetup(p),rB.forEach(r=>{const E=hI[r];let A=()=>!1;t[E]&&(A=()=>!0),this.on(r,A,S(E))})},stop(){v.onStop(g)},trash(){v.onTrash(g)},combineFeatures(){v.onCombineFeatures(g)},uncombineFeatures(){v.onUncombineFeatures(g)},render(r,E){v.toDisplayFeatures(g,r,E)}}}}function oB(t){const s=Object.keys(t.options.modes).reduce((z,R)=>(z[R]=iB(t.options.modes[R]),z),{});let c={},p={};const g={};let v=null,S=null;g.drag=function(z,R){R({point:z.point,time:new Date().getTime()})?(t.ui.queueMapClasses({mouse:us.DRAG}),S.drag(z)):z.originalEvent.stopPropagation()},g.mousedrag=function(z){g.drag(z,R=>!Rw(c,R))},g.touchdrag=function(z){g.drag(z,R=>!Dw(p,R))},g.mousemove=function(z){if((z.originalEvent.buttons!==void 0?z.originalEvent.buttons:z.originalEvent.which)===1)return g.mousedrag(z);const D=N1(z,t);z.featureTarget=D,S.mousemove(z)},g.mousedown=function(z){c={time:new Date().getTime(),point:z.point};const R=N1(z,t);z.featureTarget=R,S.mousedown(z)},g.mouseup=function(z){const R=N1(z,t);z.featureTarget=R,Rw(c,{point:z.point,time:new Date().getTime()})?S.click(z):S.mouseup(z)},g.mouseout=function(z){S.mouseout(z)},g.touchstart=function(z){if(!t.options.touchEnabled)return;p={time:new Date().getTime(),point:z.point};const R=s_.touch(z,null,t)[0];z.featureTarget=R,S.touchstart(z)},g.touchmove=function(z){if(t.options.touchEnabled)return S.touchmove(z),g.touchdrag(z)},g.touchend=function(z){if(z.originalEvent.preventDefault(),!t.options.touchEnabled)return;const R=s_.touch(z,null,t)[0];z.featureTarget=R,Dw(p,{time:new Date().getTime(),point:z.point})?S.tap(z):S.touchend(z)};const r=z=>!(z===8||z===46||z>=48&&z<=57);g.keydown=function(z){(z.srcElement||z.target).classList.contains(ic.CANVAS)&&((z.keyCode===8||z.keyCode===46)&&t.options.controls.trash?(z.preventDefault(),S.trash()):r(z.keyCode)?S.keydown(z):z.keyCode===49&&t.options.controls.point?E(ao.DRAW_POINT):z.keyCode===50&&t.options.controls.line_string?E(ao.DRAW_LINE_STRING):z.keyCode===51&&t.options.controls.polygon&&E(ao.DRAW_POLYGON))},g.keyup=function(z){r(z.keyCode)&&S.keyup(z)},g.zoomend=function(){t.store.changeZoom()},g.data=function(z){if(z.dataType==="style"){const{setup:R,map:D,options:O,store:N}=t;O.styles.some(j=>D.getLayer(j.id))||(R.addLayers(),N.setDirty(),N.render())}};function E(z,R,D={}){S.stop();const O=s[z];if(O===void 0)throw new Error(`${z} is not valid`);v=z;const N=O(t,R);S=Pw(N,t),D.silent||t.map.fire(Ol.MODE_CHANGE,{mode:z}),t.store.setDirty(),t.store.render()}const A={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function I(z){let R=!1;Object.keys(z).forEach(D=>{if(A[D]===void 0)throw new Error("Invalid action type");A[D]!==z[D]&&(R=!0),A[D]=z[D]}),R&&t.map.fire(Ol.ACTIONABLE,{actions:A})}return{start(){v=t.options.defaultMode,S=Pw(s[v](t),t)},changeMode:E,actionable:I,currentModeName(){return v},currentModeRender(z,R){return S.render(z,R)},fire(z,R){t.map&&t.map.fire(z,R)},addEventListeners(){t.map.on("mousemove",g.mousemove),t.map.on("mousedown",g.mousedown),t.map.on("mouseup",g.mouseup),t.map.on("data",g.data),t.map.on("touchmove",g.touchmove),t.map.on("touchstart",g.touchstart),t.map.on("touchend",g.touchend),t.container.addEventListener("mouseout",g.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",g.keydown),t.container.addEventListener("keyup",g.keyup))},removeEventListeners(){t.map.off("mousemove",g.mousemove),t.map.off("mousedown",g.mousedown),t.map.off("mouseup",g.mouseup),t.map.off("data",g.data),t.map.off("touchmove",g.touchmove),t.map.off("touchstart",g.touchstart),t.map.off("touchend",g.touchend),t.container.removeEventListener("mouseout",g.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",g.keydown),t.container.removeEventListener("keyup",g.keyup))},trash(z){S.trash(z)},combineFeatures(){S.combineFeatures()},uncombineFeatures(){S.uncombineFeatures()},getMode(){return v}}}function Jy(t){return[].concat(t).filter(s=>s!==void 0)}function sB(){const t=this;if(!(t.ctx.map&&t.ctx.map.getSource(gu.HOT)!==void 0))return E();const c=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:c});let p=[],g=[];t.isDirty?g=t.getAllIds():(p=t.getChangedIds().filter(A=>t.get(A)!==void 0),g=t.sources.hot.filter(A=>A.properties.id&&p.indexOf(A.properties.id)===-1&&t.get(A.properties.id)!==void 0).map(A=>A.properties.id)),t.sources.hot=[];const v=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(A=>{const I=A.properties.id||A.properties.parent;return p.indexOf(I)===-1});const S=v!==t.sources.cold.length||g.length>0;p.forEach(A=>r(A,"hot")),g.forEach(A=>r(A,"cold"));function r(A,I){const z=t.get(A).internal(c);t.ctx.events.currentModeRender(z,R=>{R.properties.mode=c,t.sources[I].push(R)})}S&&t.ctx.map.getSource(gu.COLD).setData({type:Jr.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(gu.HOT).setData({type:Jr.FEATURE_COLLECTION,features:t.sources.hot}),E();function E(){t.isDirty=!1,t.clearChangedIds()}}function es(t){this._features={},this._featureIds=new vu,this._selectedFeatureIds=new vu,this._selectedCoordinates=[],this._changedFeatureIds=new vu,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]};let s;this.render=()=>{s||(s=requestAnimationFrame(()=>{s=null,sB.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Ol.SELECTION_CHANGE,{features:this.getSelected().map(c=>c.toGeoJSON()),points:this.getSelectedCoordinates().map(c=>({type:Jr.FEATURE,properties:{},geometry:{type:Jr.POINT,coordinates:c.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Ol.RENDER,{})}))},this.isDirty=!1}es.prototype.createRenderBatch=function(){const t=this.render;let s=0;return this.render=function(){s++},()=>{this.render=t,s>0&&this.render()}};es.prototype.setDirty=function(){return this.isDirty=!0,this};es.prototype.featureCreated=function(t,s={}){if(this._changedFeatureIds.add(t),(s.silent!=null?s.silent:this.ctx.options.suppressAPIEvents)!==!0){const p=this.get(t);this.ctx.events.fire(Ol.CREATE,{features:[p.toGeoJSON()]})}return this};es.prototype.featureChanged=function(t,s={}){return this._changedFeatureIds.add(t),(s.silent!=null?s.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Ol.UPDATE,{action:s.action?s.action:Ky.CHANGE_COORDINATES,features:[this.get(t).toGeoJSON()]}),this};es.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};es.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};es.prototype.getAllIds=function(){return this._featureIds.values()};es.prototype.add=function(t,s={}){return this._features[t.id]=t,this._featureIds.add(t.id),this.featureCreated(t.id,{silent:s.silent}),this};es.prototype.delete=function(t,s={}){const c=[];return Jy(t).forEach(p=>{this._featureIds.has(p)&&(this._featureIds.delete(p),this._selectedFeatureIds.delete(p),s.silent||c.indexOf(this._features[p])===-1&&c.push(this._features[p].toGeoJSON()),delete this._features[p],this.isDirty=!0)}),c.length&&this.ctx.events.fire(Ol.DELETE,{features:c}),fI(this,s),this};es.prototype.get=function(t){return this._features[t]};es.prototype.getAll=function(){return Object.keys(this._features).map(t=>this._features[t])};es.prototype.select=function(t,s={}){return Jy(t).forEach(c=>{this._selectedFeatureIds.has(c)||(this._selectedFeatureIds.add(c),this._changedFeatureIds.add(c),s.silent||(this._emitSelectionChange=!0))}),this};es.prototype.deselect=function(t,s={}){return Jy(t).forEach(c=>{this._selectedFeatureIds.has(c)&&(this._selectedFeatureIds.delete(c),this._changedFeatureIds.add(c),s.silent||(this._emitSelectionChange=!0))}),fI(this,s),this};es.prototype.clearSelected=function(t={}){return this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this};es.prototype.setSelected=function(t,s={}){return t=Jy(t),this.deselect(this._selectedFeatureIds.values().filter(c=>t.indexOf(c)===-1),{silent:s.silent}),this.select(t.filter(c=>!this._selectedFeatureIds.has(c)),{silent:s.silent}),this};es.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this};es.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};es.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};es.prototype.getSelected=function(){return this.getSelectedIds().map(t=>this.get(t))};es.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(s=>({coordinates:this.get(s.feature_id).getCoordinate(s.coord_path)}))};es.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)};es.prototype.setFeatureProperty=function(t,s,c,p={}){this.get(t).setProperty(s,c),this.featureChanged(t,{silent:p.silent,action:Ky.CHANGE_PROPERTIES})};function fI(t,s={}){const c=t._selectedCoordinates.filter(p=>t._selectedFeatureIds.has(p.feature_id));t._selectedCoordinates.length!==c.length&&!s.silent&&(t._emitSelectionChange=!0),t._selectedCoordinates=c}es.prototype.storeMapConfig=function(){aI.forEach(t=>{this.ctx.map[t]&&(this._mapInitialConfig[t]=this.ctx.map[t].isEnabled())})};es.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(t=>{this._mapInitialConfig[t]?this.ctx.map[t].enable():this.ctx.map[t].disable()})};es.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]!==void 0?this._mapInitialConfig[t]:!0};const aB=["mode","feature","mouse"];function lB(t){const s={};let c=null,p={mode:null,feature:null,mouse:null},g={mode:null,feature:null,mouse:null};function v(){S({mode:null,feature:null,mouse:null}),r()}function S(R){g=Object.assign(g,R)}function r(){if(!t.container)return;const R=[],D=[];aB.forEach(O=>{g[O]!==p[O]&&(R.push(`${O}-${p[O]}`),g[O]!==null&&D.push(`${O}-${g[O]}`))}),R.length>0&&t.container.classList.remove(...R),D.length>0&&t.container.classList.add(...D),p=Object.assign(p,g)}function E(R,D={}){const O=document.createElement("button");return O.className=`${ic.CONTROL_BUTTON} ${D.className}`,O.setAttribute("title",D.title),D.container.appendChild(O),O.addEventListener("click",N=>{if(N.preventDefault(),N.stopPropagation(),N.target===c){A(),D.onDeactivate();return}I(R),D.onActivate()},!0),O}function A(){c&&(c.classList.remove(ic.ACTIVE_BUTTON),c=null)}function I(R){A();const D=s[R];D&&D&&R!=="trash"&&(D.classList.add(ic.ACTIVE_BUTTON),c=D)}function F(){const R=t.options.controls,D=document.createElement("div");return D.className=`${ic.CONTROL_GROUP} ${ic.CONTROL_BASE}`,R&&(R[oc.LINE]&&(s[oc.LINE]=E(oc.LINE,{container:D,className:ic.CONTROL_BUTTON_LINE,title:`LineString tool ${t.options.keybindings?"(l)":""}`,onActivate:()=>t.events.changeMode(ao.DRAW_LINE_STRING),onDeactivate:()=>t.events.trash()})),R[oc.POLYGON]&&(s[oc.POLYGON]=E(oc.POLYGON,{container:D,className:ic.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${t.options.keybindings?"(p)":""}`,onActivate:()=>t.events.changeMode(ao.DRAW_POLYGON),onDeactivate:()=>t.events.trash()})),R[oc.POINT]&&(s[oc.POINT]=E(oc.POINT,{container:D,className:ic.CONTROL_BUTTON_POINT,title:`Marker tool ${t.options.keybindings?"(m)":""}`,onActivate:()=>t.events.changeMode(ao.DRAW_POINT),onDeactivate:()=>t.events.trash()})),R.trash&&(s.trash=E("trash",{container:D,className:ic.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{t.events.trash()}})),R.combine_features&&(s.combine_features=E("combineFeatures",{container:D,className:ic.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{t.events.combineFeatures()}})),R.uncombine_features&&(s.uncombine_features=E("uncombineFeatures",{container:D,className:ic.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{t.events.uncombineFeatures()}}))),D}function z(){Object.keys(s).forEach(R=>{const D=s[R];D.parentNode&&D.parentNode.removeChild(D),delete s[R]})}return{setActiveButton:I,queueMapClasses:S,updateMapClasses:r,clearMapClasses:v,addButtons:F,removeButtons:z}}function cB(t){let s=null,c=null;const p={onRemove(){return t.map.off("load",p.connect),clearInterval(c),p.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,s&&s.parentNode&&s.parentNode.removeChild(s),s=null,this},connect(){t.map.off("load",p.connect),clearInterval(c),p.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd(g){if(t.map=g,t.events=oB(t),t.ui=lB(t),t.container=g.getContainer(),t.store=new es(t),s=t.ui.addButtons(),t.options.boxSelect){t.boxZoomInitial=g.boxZoom.isEnabled(),g.boxZoom.disable();const v=g.dragPan.isEnabled();g.dragPan.disable(),g.dragPan.enable(),v||g.dragPan.disable()}return g.loaded()?p.connect():(g.on("load",p.connect),c=setInterval(()=>{g.loaded()&&p.connect()},16)),t.events.start(),s},addLayers(){t.map.addSource(gu.COLD,{data:{type:Jr.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(gu.HOT,{data:{type:Jr.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(g=>{t.map.addLayer(g)}),t.store.setDirty(!0),t.store.render()},removeLayers(){t.options.styles.forEach(g=>{t.map.getLayer(g.id)&&t.map.removeLayer(g.id)}),t.map.getSource(gu.COLD)&&t.map.removeSource(gu.COLD),t.map.getSource(gu.HOT)&&t.map.removeSource(gu.HOT)}};return t.setup=p,p}const L2="#3bb2d0",_0="#fbb03b",z5="#fff",pI=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],_0,L2],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],_0,L2],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":z5}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],_0,L2]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":z5}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":_0}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":_0}}];function Rx(t){return function(s){const c=s.featureTarget;return!c||!c.properties?!1:c.properties.meta===t}}function mI(t){return!t.originalEvent||!t.originalEvent.shiftKey?!1:t.originalEvent.button===0}function Km(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Ea.ACTIVE&&t.featureTarget.properties.meta===ol.FEATURE}function gS(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Ea.INACTIVE&&t.featureTarget.properties.meta===ol.FEATURE}function Dx(t){return t.featureTarget===void 0}function _S(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.meta===ol.FEATURE}function Qy(t){const s=t.featureTarget;return!s||!s.properties?!1:s.properties.meta===ol.VERTEX}function ox(t){return t.originalEvent?t.originalEvent.shiftKey===!0:!1}function kx(t){return t.keyCode===27}function Ox(t){return t.keyCode===13}function uB(){return!0}const dB=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Km,isEnterKey:Ox,isEscapeKey:kx,isFeature:_S,isInactiveFeature:gS,isOfMetaType:Rx,isShiftDown:ox,isShiftMousedown:mI,isTrue:uB,isVertex:Qy,noTarget:Dx},Symbol.toStringTag,{value:"Module"}));function kp(t,s){this.x=t,this.y=s}kp.prototype={clone(){return new kp(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,s){return this.clone()._rotateAround(t,s)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){const s=t.x-this.x,c=t.y-this.y;return s*s+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult(t){const s=t[0]*this.x+t[1]*this.y,c=t[2]*this.x+t[3]*this.y;return this.x=s,this.y=c,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){const t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){const s=Math.cos(t),c=Math.sin(t),p=s*this.x-c*this.y,g=c*this.x+s*this.y;return this.x=p,this.y=g,this},_rotateAround(t,s){const c=Math.cos(t),p=Math.sin(t),g=s.x+c*(this.x-s.x)-p*(this.y-s.y),v=s.y+p*(this.x-s.x)+c*(this.y-s.y);return this.x=g,this.y=v,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:kp};kp.convert=function(t){if(t instanceof kp)return t;if(Array.isArray(t))return new kp(+t[0],+t[1]);if(t.x!==void 0&&t.y!==void 0)return new kp(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};function yS(t,s){const c=s.getBoundingClientRect();return new kp(t.clientX-c.left-(s.clientLeft||0),t.clientY-c.top-(s.clientTop||0))}function a_(t,s,c,p){return{type:Jr.FEATURE,properties:{meta:ol.VERTEX,parent:t,coord_path:c,active:p?Ea.ACTIVE:Ea.INACTIVE},geometry:{type:Jr.POINT,coordinates:s}}}function gI(t,s,c){const p=s.geometry.coordinates,g=c.geometry.coordinates;if(p[1]>Iw||p[1]<Mw||g[1]>Iw||g[1]<Mw)return null;const v={lng:(p[0]+g[0])/2,lat:(p[1]+g[1])/2};return{type:Jr.FEATURE,properties:{meta:ol.MIDPOINT,parent:t,lng:v.lng,lat:v.lat,coord_path:c.properties.coord_path},geometry:{type:Jr.POINT,coordinates:[v.lng,v.lat]}}}function Lx(t,s={},c=null){const{type:p,coordinates:g}=t.geometry,v=t.properties&&t.properties.id;let S=[];p===Jr.POINT?S.push(a_(v,g,c,E(c))):p===Jr.POLYGON?g.forEach((I,F)=>{r(I,c!==null?`${c}.${F}`:String(F))}):p===Jr.LINE_STRING?r(g,c):p.indexOf(Jr.MULTI_PREFIX)===0&&A();function r(I,F){let z="",R=null;I.forEach((D,O)=>{const N=F!=null?`${F}.${O}`:String(O),H=a_(v,D,N,E(N));if(s.midpoints&&R){const V=gI(v,R,H);V&&S.push(V)}R=H;const j=JSON.stringify(D);z!==j&&S.push(H),O===0&&(z=j)})}function E(I){return s.selectedPaths?s.selectedPaths.indexOf(I)!==-1:!1}function A(){const I=p.replace(Jr.MULTI_PREFIX,"");g.forEach((F,z)=>{const R={type:Jr.FEATURE,properties:t.properties,geometry:{type:I,coordinates:F}};S=S.concat(Lx(R,s,z))})}return S}const ld={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},{LAT_MIN:c1,LAT_MAX:u1,LAT_RENDERED_MIN:F5,LAT_RENDERED_MAX:B5,LNG_MIN:N5,LNG_MAX:V5}=lI;function hB(t){const s={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[t.geometry.type],c=[t.geometry.coordinates].flat(s),p=c.map(r=>r[0]),g=c.map(r=>r[1]),v=r=>Math.min.apply(null,r),S=r=>Math.max.apply(null,r);return[v(p),v(g),S(p),S(g)]}function vS(t,s){let c=c1,p=u1,g=c1,v=u1,S=V5,r=N5;t.forEach(A=>{const I=hB(A),F=I[1],z=I[3],R=I[0],D=I[2];F>c&&(c=F),z<p&&(p=z),z>g&&(g=z),F<v&&(v=F),R<S&&(S=R),D>r&&(r=D)});const E=s;return c+E.lat>B5&&(E.lat=B5-c),g+E.lat>u1&&(E.lat=u1-g),p+E.lat<F5&&(E.lat=F5-p),v+E.lat<c1&&(E.lat=c1-v),S+E.lng<=N5&&(E.lng+=Math.ceil(Math.abs(E.lng)/360)*360),r+E.lng>=V5&&(E.lng-=Math.ceil(Math.abs(E.lng)/360)*360),E}function xS(t,s){const c=vS(t.map(p=>p.toGeoJSON()),s);t.forEach(p=>{const g=p.getCoordinates(),v=A=>{const I={lng:A[0]+c.lng,lat:A[1]+c.lat};return[I.lng,I.lat]},S=A=>A.map(I=>v(I)),r=A=>A.map(I=>S(I));let E;p.type===Jr.POINT?E=v(g):p.type===Jr.LINE_STRING||p.type===Jr.MULTI_POINT?E=g.map(v):p.type===Jr.POLYGON||p.type===Jr.MULTI_LINE_STRING?E=g.map(S):p.type===Jr.MULTI_POLYGON&&(E=g.map(r)),p.incomingCoords(E)})}const Yo={};Yo.onSetup=function(t){const s={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(s.initiallySelectedFeatureIds.filter(c=>this.getFeature(c)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),s};Yo.fireUpdate=function(){this.fire(Ol.UPDATE,{action:Ky.MOVE,features:this.getSelected().map(t=>t.toGeoJSON())})};Yo.fireActionable=function(){const t=this.getSelected(),s=t.filter(v=>this.isInstanceOf("MultiFeature",v));let c=!1;if(t.length>1){c=!0;const v=t[0].type.replace("Multi","");t.forEach(S=>{S.type.replace("Multi","")!==v&&(c=!1)})}const p=s.length>0,g=t.length>0;this.setActionableState({combineFeatures:c,uncombineFeatures:p,trash:g})};Yo.getUniqueIds=function(t){return t.length?t.map(c=>c.properties.id).filter(c=>c!==void 0).reduce((c,p)=>(c.add(p),c),new vu).values():[]};Yo.stopExtendedInteractions=function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),(t.canDragMove||t.canBoxSelect)&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1};Yo.onStop=function(){ld.enable(this)};Yo.onMouseMove=function(t,s){return _S(s)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0};Yo.onMouseOut=function(t){return t.dragMoving?this.fireUpdate():!0};Yo.onTap=Yo.onClick=function(t,s){if(Dx(s))return this.clickAnywhere(t,s);if(Rx(ol.VERTEX)(s))return this.clickOnVertex(t,s);if(_S(s))return this.clickOnFeature(t,s)};Yo.clickAnywhere=function(t){const s=this.getSelectedIds();s.length&&(this.clearSelectedFeatures(),s.forEach(c=>this.doRender(c))),ld.enable(this),this.stopExtendedInteractions(t)};Yo.clickOnVertex=function(t,s){this.changeMode(ao.DIRECT_SELECT,{featureId:s.featureTarget.properties.parent,coordPath:s.featureTarget.properties.coord_path,startPos:s.lngLat}),this.updateUIClasses({mouse:us.MOVE})};Yo.startOnActiveFeature=function(t,s){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(s.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=s.lngLat};Yo.clickOnFeature=function(t,s){ld.disable(this),this.stopExtendedInteractions(t);const c=ox(s),p=this.getSelectedIds(),g=s.featureTarget.properties.id,v=this.isSelected(g);if(!c&&v&&this.getFeature(g).type!==Jr.POINT)return this.changeMode(ao.DIRECT_SELECT,{featureId:g});v&&c?(this.deselect(g),this.updateUIClasses({mouse:us.POINTER}),p.length===1&&ld.enable(this)):!v&&c?(this.select(g),this.updateUIClasses({mouse:us.MOVE})):!v&&!c&&(p.forEach(S=>this.doRender(S)),this.setSelected(g),this.updateUIClasses({mouse:us.MOVE})),this.doRender(g)};Yo.onMouseDown=function(t,s){if(t.initialDragPanState=this.map.dragPan.isEnabled(),Km(s))return this.startOnActiveFeature(t,s);if(this.drawConfig.boxSelect&&mI(s))return this.startBoxSelect(t,s)};Yo.startBoxSelect=function(t,s){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=yS(s.originalEvent,this.map.getContainer()),t.canBoxSelect=!0};Yo.onTouchStart=function(t,s){if(Km(s))return this.startOnActiveFeature(t,s)};Yo.onDrag=function(t,s){if(t.canDragMove)return this.dragMove(t,s);if(this.drawConfig.boxSelect&&t.canBoxSelect)return this.whileBoxSelect(t,s)};Yo.whileBoxSelect=function(t,s){t.boxSelecting=!0,this.updateUIClasses({mouse:us.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(ic.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));const c=yS(s.originalEvent,this.map.getContainer()),p=Math.min(t.boxSelectStartLocation.x,c.x),g=Math.max(t.boxSelectStartLocation.x,c.x),v=Math.min(t.boxSelectStartLocation.y,c.y),S=Math.max(t.boxSelectStartLocation.y,c.y),r=`translate(${p}px, ${v}px)`;t.boxSelectElement.style.transform=r,t.boxSelectElement.style.WebkitTransform=r,t.boxSelectElement.style.width=`${g-p}px`,t.boxSelectElement.style.height=`${S-v}px`};Yo.dragMove=function(t,s){t.dragMoving=!0,s.originalEvent.stopPropagation();const c={lng:s.lngLat.lng-t.dragMoveLocation.lng,lat:s.lngLat.lat-t.dragMoveLocation.lat};xS(this.getSelected(),c),t.dragMoveLocation=s.lngLat};Yo.onTouchEnd=Yo.onMouseUp=function(t,s){if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){const c=[t.boxSelectStartLocation,yS(s.originalEvent,this.map.getContainer())],p=this.featuresAt(null,c,"click"),g=this.getUniqueIds(p).filter(v=>!this.isSelected(v));g.length&&(this.select(g),g.forEach(v=>this.doRender(v)),this.updateUIClasses({mouse:us.MOVE}))}this.stopExtendedInteractions(t)};Yo.toDisplayFeatures=function(t,s,c){s.properties.active=this.isSelected(s.properties.id)?Ea.ACTIVE:Ea.INACTIVE,c(s),this.fireActionable(),!(s.properties.active!==Ea.ACTIVE||s.geometry.type===Jr.POINT)&&Lx(s).forEach(c)};Yo.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};Yo.onCombineFeatures=function(){const t=this.getSelected();if(t.length===0||t.length<2)return;const s=[],c=[],p=t[0].type.replace("Multi","");for(let g=0;g<t.length;g++){const v=t[g];if(v.type.replace("Multi","")!==p)return;v.type.includes("Multi")?v.getCoordinates().forEach(S=>{s.push(S)}):s.push(v.getCoordinates()),c.push(v.toGeoJSON())}if(c.length>1){const g=this.newFeature({type:Jr.FEATURE,properties:c[0].properties,geometry:{type:`Multi${p}`,coordinates:s}});this.addFeature(g),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([g.id]),this.fire(Ol.COMBINE_FEATURES,{createdFeatures:[g.toGeoJSON()],deletedFeatures:c})}this.fireActionable()};Yo.onUncombineFeatures=function(){const t=this.getSelected();if(t.length===0)return;const s=[],c=[];for(let p=0;p<t.length;p++){const g=t[p];this.isInstanceOf("MultiFeature",g)&&(g.getFeatures().forEach(v=>{this.addFeature(v),v.properties=g.properties,s.push(v.toGeoJSON()),this.select([v.id])}),this.deleteFeature(g.id,{silent:!0}),c.push(g.toGeoJSON()))}s.length>1&&this.fire(Ol.UNCOMBINE_FEATURES,{createdFeatures:s,deletedFeatures:c}),this.fireActionable()};const _I=Rx(ol.VERTEX),yI=Rx(ol.MIDPOINT),Xo={};Xo.fireUpdate=function(){this.fire(Ol.UPDATE,{action:Ky.CHANGE_COORDINATES,features:this.getSelected().map(t=>t.toGeoJSON())})};Xo.fireActionable=function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})};Xo.startDragging=function(t,s){t.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=s.lngLat};Xo.stopDragging=function(t){t.canDragMove&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null};Xo.onVertex=function(t,s){this.startDragging(t,s);const c=s.featureTarget.properties,p=t.selectedCoordPaths.indexOf(c.coord_path);!ox(s)&&p===-1?t.selectedCoordPaths=[c.coord_path]:ox(s)&&p===-1&&t.selectedCoordPaths.push(c.coord_path);const g=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(g)};Xo.onMidpoint=function(t,s){this.startDragging(t,s);const c=s.featureTarget.properties;t.feature.addCoordinate(c.coord_path,c.lng,c.lat),this.fireUpdate(),t.selectedCoordPaths=[c.coord_path]};Xo.pathsToCoordinates=function(t,s){return s.map(c=>({feature_id:t,coord_path:c}))};Xo.onFeature=function(t,s){t.selectedCoordPaths.length===0?this.startDragging(t,s):this.stopDragging(t)};Xo.dragFeature=function(t,s,c){xS(this.getSelected(),c),t.dragMoveLocation=s.lngLat};Xo.dragVertex=function(t,s,c){const p=t.selectedCoordPaths.map(S=>t.feature.getCoordinate(S)),g=p.map(S=>({type:Jr.FEATURE,properties:{},geometry:{type:Jr.POINT,coordinates:S}})),v=vS(g,c);for(let S=0;S<p.length;S++){const r=p[S];t.feature.updateCoordinate(t.selectedCoordPaths[S],r[0]+v.lng,r[1]+v.lat)}};Xo.clickNoTarget=function(){this.changeMode(ao.SIMPLE_SELECT)};Xo.clickInactive=function(){this.changeMode(ao.SIMPLE_SELECT)};Xo.clickActiveFeature=function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()};Xo.onSetup=function(t){const s=t.featureId,c=this.getFeature(s);if(!c)throw new Error("You must provide a featureId to enter direct_select mode");if(c.type===Jr.POINT)throw new TypeError("direct_select mode doesn't handle point features");const p={featureId:s,feature:c,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(s,p.selectedCoordPaths)),this.setSelected(s),ld.disable(this),this.setActionableState({trash:!0}),p};Xo.onStop=function(){ld.enable(this),this.clearSelectedCoordinates()};Xo.toDisplayFeatures=function(t,s,c){t.featureId===s.properties.id?(s.properties.active=Ea.ACTIVE,c(s),Lx(s,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(c)):(s.properties.active=Ea.INACTIVE,c(s)),this.fireActionable(t)};Xo.onTrash=function(t){t.selectedCoordPaths.sort((s,c)=>c.localeCompare(s,"en",{numeric:!0})).forEach(s=>t.feature.removeCoordinate(s)),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(ao.SIMPLE_SELECT,{}))};Xo.onMouseMove=function(t,s){const c=Km(s),p=_I(s),g=yI(s),v=t.selectedCoordPaths.length===0;return c&&v?this.updateUIClasses({mouse:us.MOVE}):p&&!v?this.updateUIClasses({mouse:us.MOVE}):this.updateUIClasses({mouse:us.NONE}),(p||c||g)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0};Xo.onMouseOut=function(t){return t.dragMoving&&this.fireUpdate(),!0};Xo.onTouchStart=Xo.onMouseDown=function(t,s){if(_I(s))return this.onVertex(t,s);if(Km(s))return this.onFeature(t,s);if(yI(s))return this.onMidpoint(t,s)};Xo.onDrag=function(t,s){if(t.canDragMove!==!0)return;t.dragMoving=!0,s.originalEvent.stopPropagation();const c={lng:s.lngLat.lng-t.dragMoveLocation.lng,lat:s.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,s,c):this.dragFeature(t,s,c),t.dragMoveLocation=s.lngLat};Xo.onClick=function(t,s){if(Dx(s))return this.clickNoTarget(t,s);if(Km(s))return this.clickActiveFeature(t,s);if(gS(s))return this.clickInactive(t,s);this.stopDragging(t)};Xo.onTap=function(t,s){if(Dx(s))return this.clickNoTarget(t,s);if(Km(s))return this.clickActiveFeature(t,s);if(gS(s))return this.clickInactive(t,s)};Xo.onTouchEnd=Xo.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};const mh={};mh.onSetup=function(){const t=this.newFeature({type:Jr.FEATURE,properties:{},geometry:{type:Jr.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:us.ADD}),this.activateUIButton(oc.POINT),this.setActionableState({trash:!0}),{point:t}};mh.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT)};mh.onTap=mh.onClick=function(t,s){this.updateUIClasses({mouse:us.MOVE}),t.point.updateCoordinate("",s.lngLat.lng,s.lngLat.lat),this.fire(Ol.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.point.id]})};mh.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})};mh.toDisplayFeatures=function(t,s,c){const p=s.properties.id===t.point.id;if(s.properties.active=p?Ea.ACTIVE:Ea.INACTIVE,!p)return c(s)};mh.onTrash=mh.stopDrawingAndRemove;mh.onKeyUp=function(t,s){if(kx(s)||Ox(s))return this.stopDrawingAndRemove(t,s)};function sx(t,s){return t.lngLat?t.lngLat.lng===s[0]&&t.lngLat.lat===s[1]:!1}const cd={};cd.onSetup=function(){const t=this.newFeature({type:Jr.FEATURE,properties:{},geometry:{type:Jr.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),ld.disable(this),this.updateUIClasses({mouse:us.ADD}),this.activateUIButton(oc.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};cd.clickAnywhere=function(t,s){if(t.currentVertexPosition>0&&sx(s,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:us.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat)};cd.clickOnVertex=function(t){return this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};cd.onMouseMove=function(t,s){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat),Qy(s)&&this.updateUIClasses({mouse:us.POINTER})};cd.onTap=cd.onClick=function(t,s){return Qy(s)?this.clickOnVertex(t,s):this.clickAnywhere(t,s)};cd.onKeyUp=function(t,s){kx(s)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT)):Ox(s)&&this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};cd.onStop=function(t){this.updateUIClasses({mouse:us.NONE}),ld.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.fire(Ol.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT,{},{silent:!0})))};cd.toDisplayFeatures=function(t,s,c){const p=s.properties.id===t.polygon.id;if(s.properties.active=p?Ea.ACTIVE:Ea.INACTIVE,!p)return c(s);if(s.geometry.coordinates.length===0)return;const g=s.geometry.coordinates[0].length;if(!(g<3)){if(s.properties.meta=ol.FEATURE,c(a_(t.polygon.id,s.geometry.coordinates[0][0],"0.0",!1)),g>3){const v=s.geometry.coordinates[0].length-3;c(a_(t.polygon.id,s.geometry.coordinates[0][v],`0.${v}`,!1))}if(g<=4){const v=[[s.geometry.coordinates[0][0][0],s.geometry.coordinates[0][0][1]],[s.geometry.coordinates[0][1][0],s.geometry.coordinates[0][1][1]]];if(c({type:Jr.FEATURE,properties:s.properties,geometry:{coordinates:v,type:Jr.LINE_STRING}}),g===3)return}return c(s)}};cd.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT)};const ud={};ud.onSetup=function(t){t=t||{};const s=t.featureId;let c,p,g="forward";if(s){if(c=this.getFeature(s),!c)throw new Error("Could not find a feature with the provided featureId");let v=t.from;if(v&&v.type==="Feature"&&v.geometry&&v.geometry.type==="Point"&&(v=v.geometry),v&&v.type==="Point"&&v.coordinates&&v.coordinates.length===2&&(v=v.coordinates),!v||!Array.isArray(v))throw new Error("Please use the `from` property to indicate which point to continue the line from");const S=c.coordinates.length-1;if(c.coordinates[S][0]===v[0]&&c.coordinates[S][1]===v[1])p=S+1,c.addCoordinate(p,...c.coordinates[S]);else if(c.coordinates[0][0]===v[0]&&c.coordinates[0][1]===v[1])g="backwards",p=0,c.addCoordinate(p,...c.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else c=this.newFeature({type:Jr.FEATURE,properties:{},geometry:{type:Jr.LINE_STRING,coordinates:[]}}),p=0,this.addFeature(c);return this.clearSelectedFeatures(),ld.disable(this),this.updateUIClasses({mouse:us.ADD}),this.activateUIButton(oc.LINE),this.setActionableState({trash:!0}),{line:c,currentVertexPosition:p,direction:g}};ud.clickAnywhere=function(t,s){if(t.currentVertexPosition>0&&sx(s,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&sx(s,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:us.ADD}),t.line.updateCoordinate(t.currentVertexPosition,s.lngLat.lng,s.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,s.lngLat.lng,s.lngLat.lat)):t.line.addCoordinate(0,s.lngLat.lng,s.lngLat.lat)};ud.clickOnVertex=function(t){return this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.line.id]})};ud.onMouseMove=function(t,s){t.line.updateCoordinate(t.currentVertexPosition,s.lngLat.lng,s.lngLat.lat),Qy(s)&&this.updateUIClasses({mouse:us.POINTER})};ud.onTap=ud.onClick=function(t,s){if(Qy(s))return this.clickOnVertex(t,s);this.clickAnywhere(t,s)};ud.onKeyUp=function(t,s){Ox(s)?this.changeMode(ao.SIMPLE_SELECT,{featureIds:[t.line.id]}):kx(s)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT))};ud.onStop=function(t){ld.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.fire(Ol.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT,{},{silent:!0})))};ud.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(ao.SIMPLE_SELECT)};ud.toDisplayFeatures=function(t,s,c){const p=s.properties.id===t.line.id;if(s.properties.active=p?Ea.ACTIVE:Ea.INACTIVE,!p)return c(s);s.geometry.coordinates.length<2||(s.properties.meta=ol.FEATURE,c(a_(t.line.id,s.geometry.coordinates[t.direction==="forward"?s.geometry.coordinates.length-2:1],`${t.direction==="forward"?s.geometry.coordinates.length-2:1}`,!1)),c(s))};const vI={simple_select:Yo,direct_select:Xo,draw_point:mh,draw_polygon:cd,draw_line_string:ud},fB={defaultMode:ao.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:pI,modes:vI,controls:{},userProperties:!1,suppressAPIEvents:!0},pB={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},mB={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function U5(t,s){return t.map(c=>c.source?c:Object.assign({},c,{id:`${c.id}.${s}`,source:s==="hot"?gu.HOT:gu.COLD}))}function gB(t={}){let s=Object.assign({},t);return t.controls||(s.controls={}),t.displayControlsDefault===!1?s.controls=Object.assign({},mB,t.controls):s.controls=Object.assign({},pB,t.controls),s=Object.assign({},fB,s),s.styles=U5(s.styles,"cold").concat(U5(s.styles,"hot")),s}var z2,j5;function _B(){return j5||(j5=1,z2=function t(s,c){if(s===c)return!0;if(s&&c&&typeof s=="object"&&typeof c=="object"){if(s.constructor!==c.constructor)return!1;var p,g,v;if(Array.isArray(s)){if(p=s.length,p!=c.length)return!1;for(g=p;g--!==0;)if(!t(s[g],c[g]))return!1;return!0}if(s.constructor===RegExp)return s.source===c.source&&s.flags===c.flags;if(s.valueOf!==Object.prototype.valueOf)return s.valueOf()===c.valueOf();if(s.toString!==Object.prototype.toString)return s.toString()===c.toString();if(v=Object.keys(s),p=v.length,p!==Object.keys(c).length)return!1;for(g=p;g--!==0;)if(!Object.prototype.hasOwnProperty.call(c,v[g]))return!1;for(g=p;g--!==0;){var S=v[g];if(!t(s[S],c[S]))return!1}return!0}return s!==s&&c!==c}),z2}var yB=_B();const G5=al(yB);var F2,$5;function vB(){if($5)return F2;$5=1,F2=s;var t={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function s(c){if(!c||!c.type)return null;var p=t[c.type];if(!p)return null;if(p==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:c}]};if(p==="feature")return{type:"FeatureCollection",features:[c]};if(p==="featurecollection")return c}return F2}var xB=vB();const bB=al(xB);function xI(t,s){return t.length!==s.length?!1:JSON.stringify(t.map(c=>c).sort())===JSON.stringify(s.map(c=>c).sort())}const wB={Polygon:Bc,LineString:vh,Point:Bp,MultiPolygon:kl,MultiLineString:kl,MultiPoint:kl};function SB(t,s){s.modes=ao;const c=t.options.suppressAPIEvents!==void 0?!!t.options.suppressAPIEvents:!0;return s.getFeatureIdsAt=function(p){return s_.click({point:p},null,t).map(v=>v.properties.id)},s.getSelectedIds=function(){return t.store.getSelectedIds()},s.getSelected=function(){return{type:Jr.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(p=>t.store.get(p)).map(p=>p.toGeoJSON())}},s.getSelectedPoints=function(){return{type:Jr.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map(p=>({type:Jr.FEATURE,properties:{},geometry:{type:Jr.POINT,coordinates:p.coordinates}}))}},s.set=function(p){if(p.type===void 0||p.type!==Jr.FEATURE_COLLECTION||!Array.isArray(p.features))throw new Error("Invalid FeatureCollection");const g=t.store.createRenderBatch();let v=t.store.getAllIds().slice();const S=s.add(p),r=new vu(S);return v=v.filter(E=>!r.has(E)),v.length&&s.delete(v),g(),S},s.add=function(p){const v=JSON.parse(JSON.stringify(bB(p))).features.map(S=>{if(S.id=S.id||mS(),S.geometry===null)throw new Error("Invalid geometry: null");if(t.store.get(S.id)===void 0||t.store.get(S.id).type!==S.geometry.type){const r=wB[S.geometry.type];if(r===void 0)throw new Error(`Invalid geometry type: ${S.geometry.type}.`);const E=new r(t,S);t.store.add(E,{silent:c})}else{const r=t.store.get(S.id),E=r.properties;r.properties=S.properties,G5(E,S.properties)||t.store.featureChanged(r.id,{silent:c}),G5(r.getCoordinates(),S.geometry.coordinates)||r.incomingCoords(S.geometry.coordinates)}return S.id});return t.store.render(),v},s.get=function(p){const g=t.store.get(p);if(g)return g.toGeoJSON()},s.getAll=function(){return{type:Jr.FEATURE_COLLECTION,features:t.store.getAll().map(p=>p.toGeoJSON())}},s.delete=function(p){return t.store.delete(p,{silent:c}),s.getMode()===ao.DIRECT_SELECT&&!t.store.getSelectedIds().length?t.events.changeMode(ao.SIMPLE_SELECT,void 0,{silent:c}):t.store.render(),s},s.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:c}),s.getMode()===ao.DIRECT_SELECT?t.events.changeMode(ao.SIMPLE_SELECT,void 0,{silent:c}):t.store.render(),s},s.changeMode=function(p,g={}){return p===ao.SIMPLE_SELECT&&s.getMode()===ao.SIMPLE_SELECT?(xI(g.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(g.featureIds,{silent:c}),t.store.render()),s):(p===ao.DIRECT_SELECT&&s.getMode()===ao.DIRECT_SELECT&&g.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(p,g,{silent:c}),s)},s.getMode=function(){return t.events.getMode()},s.trash=function(){return t.events.trash({silent:c}),s},s.combineFeatures=function(){return t.events.combineFeatures({silent:c}),s},s.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:c}),s},s.setFeatureProperty=function(p,g,v){return t.store.setFeatureProperty(p,g,v,{silent:c}),s},s}const TB=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:dB,ModeHandler:Pw,StringSet:vu,constrainFeatureMovement:vS,createMidPoint:gI,createSupplementaryPoints:Lx,createVertex:a_,doubleClickZoom:ld,euclideanDistance:pS,featuresAt:s_,getFeatureAtAndSetCursors:N1,isClick:Rw,isEventAtCoordinates:sx,isTap:Dw,mapEventToBoundingBox:uI,moveFeatures:xS,sortFeatures:cI,stringSetsAreEqual:xI,theme:pI,toDenseArray:Jy},Symbol.toStringTag,{value:"Module"})),CB=function(t,s){t=gB(t);const c={options:t};s=SB(c,s),c.api=s;const p=cB(c);return s.onAdd=p.onAdd,s.onRemove=p.onRemove,s.types=oc,s.options=t,s};function hf(t){CB(t,this)}hf.modes=vI;hf.constants=lI;hf.lib=TB;var kc=63710088e-1,bI={centimeters:kc*100,centimetres:kc*100,degrees:360/(2*Math.PI),feet:kc*3.28084,inches:kc*39.37,kilometers:kc/1e3,kilometres:kc/1e3,meters:kc,metres:kc,miles:kc/1609.344,millimeters:kc*1e3,millimetres:kc*1e3,nauticalmiles:kc/1852,radians:1,yards:kc*1.0936};function Oy(t,s,c={}){const p={type:"Feature"};return(c.id===0||c.id)&&(p.id=c.id),c.bbox&&(p.bbox=c.bbox),p.properties=s||{},p.geometry=t,p}function EB(t,s,c={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!q5(t[0])||!q5(t[1]))throw new Error("coordinates must contain numbers");return Oy({type:"Point",coordinates:t},s,c)}function AB(t,s,c={}){for(const g of t){if(g.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(g[g.length-1].length!==g[0].length)throw new Error("First and last Position are not equivalent.");for(let v=0;v<g[g.length-1].length;v++)if(g[g.length-1][v]!==g[0][v])throw new Error("First and last Position are not equivalent.")}return Oy({type:"Polygon",coordinates:t},s,c)}function PB(t,s,c={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Oy({type:"LineString",coordinates:t},s,c)}function MB(t,s="kilometers"){const c=bI[s];if(!c)throw new Error(s+" units is invalid");return t*c}function IB(t,s="kilometers"){const c=bI[s];if(!c)throw new Error(s+" units is invalid");return t/c}function H5(t){return t%(2*Math.PI)*180/Math.PI}function jm(t){return t%360*Math.PI/180}function q5(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function kw(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function RB(t,s,c={}){var p=kw(t),g=kw(s),v=jm(g[1]-p[1]),S=jm(g[0]-p[0]),r=jm(p[1]),E=jm(g[1]),A=Math.pow(Math.sin(v/2),2)+Math.pow(Math.sin(S/2),2)*Math.cos(r)*Math.cos(E);return MB(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)),c.units)}function wI(t,s,c){if(t!==null)for(var p,g,v,S,r,E,A,I=0,F=0,z,R=t.type,D=R==="FeatureCollection",O=R==="Feature",N=D?t.features.length:1,H=0;H<N;H++){A=D?t.features[H].geometry:O?t.geometry:t,z=A?A.type==="GeometryCollection":!1,r=z?A.geometries.length:1;for(var j=0;j<r;j++){var V=0,Z=0;if(S=z?A.geometries[j]:A,S!==null){E=S.coordinates;var X=S.type;switch(I=0,X){case null:break;case"Point":if(s(E,F,H,V,Z)===!1)return!1;F++,V++;break;case"LineString":case"MultiPoint":for(p=0;p<E.length;p++){if(s(E[p],F,H,V,Z)===!1)return!1;F++,X==="MultiPoint"&&V++}X==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(p=0;p<E.length;p++){for(g=0;g<E[p].length-I;g++){if(s(E[p][g],F,H,V,Z)===!1)return!1;F++}X==="MultiLineString"&&V++,X==="Polygon"&&Z++}X==="Polygon"&&V++;break;case"MultiPolygon":for(p=0;p<E.length;p++){for(Z=0,g=0;g<E[p].length;g++){for(v=0;v<E[p][g].length-I;v++){if(s(E[p][g][v],F,H,V,Z)===!1)return!1;F++}Z++}V++}break;case"GeometryCollection":for(p=0;p<S.geometries.length;p++)if(wI(S.geometries[p],s)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function DB(t,s){var c,p,g,v,S,r,E,A,I,F,z=0,R=t.type==="FeatureCollection",D=t.type==="Feature",O=R?t.features.length:1;for(c=0;c<O;c++){for(r=R?t.features[c].geometry:D?t.geometry:t,A=R?t.features[c].properties:D?t.properties:{},I=R?t.features[c].bbox:D?t.bbox:void 0,F=R?t.features[c].id:D?t.id:void 0,E=r?r.type==="GeometryCollection":!1,S=E?r.geometries.length:1,g=0;g<S;g++){if(v=E?r.geometries[g]:r,v===null){if(s(null,z,A,I,F)===!1)return!1;continue}switch(v.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(v,z,A,I,F)===!1)return!1;break}case"GeometryCollection":{for(p=0;p<v.geometries.length;p++)if(s(v.geometries[p],z,A,I,F)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}z++}}function kB(t,s){DB(t,function(c,p,g,v,S){var r=c===null?null:c.type;switch(r){case null:case"Point":case"LineString":case"Polygon":return s(Oy(c,g,{bbox:v,id:S}),p,0)===!1?!1:void 0}var E;switch(r){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon";break}for(var A=0;A<c.coordinates.length;A++){var I=c.coordinates[A],F={type:E,coordinates:I};if(s(Oy(F,g),p,A)===!1)return!1}})}function OB(t,s){kB(t,function(c,p,g){var v=0;if(c.geometry){var S=c.geometry.type;if(!(S==="Point"||S==="MultiPoint")){var r,E=0,A=0,I=0;if(wI(c,function(F,z,R,D,O){if(r===void 0||p>E||D>A||O>I){r=F,E=p,A=D,I=O,v=0;return}var N=PB([r,F],c.properties);if(s(N,p,g,O,v)===!1)return!1;v++,r=F})===!1)return!1}}})}function LB(t,s,c){var p=c,g=!1;return OB(t,function(v,S,r,E,A){g===!1&&c===void 0?p=v:p=s(p,v,S,r,E,A),g=!0}),p}function SI(t,s={}){return LB(t,(c,p)=>{const g=p.geometry.coordinates;return c+RB(g[0],g[1],s)},0)}var V1={exports:{}};/*! @preserve
 * numeral.js
 * version : 2.0.6
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */var zB=V1.exports,W5;function FB(){return W5||(W5=1,(function(t){(function(s,c){t.exports?t.exports=c():s.numeral=c()})(zB,function(){var s,c,p="2.0.6",g={},v={},S={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},r={currentLocale:S.currentLocale,zeroFormat:S.zeroFormat,nullFormat:S.nullFormat,defaultFormat:S.defaultFormat,scalePercentBy100:S.scalePercentBy100};function E(A,I){this._input=A,this._value=I}return s=function(A){var I,F,z,R;if(s.isNumeral(A))I=A.value();else if(A===0||typeof A>"u")I=0;else if(A===null||c.isNaN(A))I=null;else if(typeof A=="string")if(r.zeroFormat&&A===r.zeroFormat)I=0;else if(r.nullFormat&&A===r.nullFormat||!A.replace(/[^0-9]+/g,"").length)I=null;else{for(F in g)if(R=typeof g[F].regexps.unformat=="function"?g[F].regexps.unformat():g[F].regexps.unformat,R&&A.match(R)){z=g[F].unformat;break}z=z||s._.stringToNumber,I=z(A)}else I=Number(A)||null;return new E(A,I)},s.version=p,s.isNumeral=function(A){return A instanceof E},s._=c={numberToFormat:function(A,I,F){var z=v[s.options.currentLocale],R=!1,D=!1,O=0,N="",H=1e12,j=1e9,V=1e6,Z=1e3,X="",se=!1,ge,ae,oe,fe,pe,K,ye;if(A=A||0,ae=Math.abs(A),s._.includes(I,"(")?(R=!0,I=I.replace(/[\(|\)]/g,"")):(s._.includes(I,"+")||s._.includes(I,"-"))&&(pe=s._.includes(I,"+")?I.indexOf("+"):A<0?I.indexOf("-"):-1,I=I.replace(/[\+|\-]/g,"")),s._.includes(I,"a")&&(ge=I.match(/a(k|m|b|t)?/),ge=ge?ge[1]:!1,s._.includes(I," a")&&(N=" "),I=I.replace(new RegExp(N+"a[kmbt]?"),""),ae>=H&&!ge||ge==="t"?(N+=z.abbreviations.trillion,A=A/H):ae<H&&ae>=j&&!ge||ge==="b"?(N+=z.abbreviations.billion,A=A/j):ae<j&&ae>=V&&!ge||ge==="m"?(N+=z.abbreviations.million,A=A/V):(ae<V&&ae>=Z&&!ge||ge==="k")&&(N+=z.abbreviations.thousand,A=A/Z)),s._.includes(I,"[.]")&&(D=!0,I=I.replace("[.]",".")),oe=A.toString().split(".")[0],fe=I.split(".")[1],K=I.indexOf(","),O=(I.split(".")[0].split(",")[0].match(/0/g)||[]).length,fe?(s._.includes(fe,"[")?(fe=fe.replace("]",""),fe=fe.split("["),X=s._.toFixed(A,fe[0].length+fe[1].length,F,fe[1].length)):X=s._.toFixed(A,fe.length,F),oe=X.split(".")[0],s._.includes(X,".")?X=z.delimiters.decimal+X.split(".")[1]:X="",D&&Number(X.slice(1))===0&&(X="")):oe=s._.toFixed(A,0,F),N&&!ge&&Number(oe)>=1e3&&N!==z.abbreviations.trillion)switch(oe=String(Number(oe)/1e3),N){case z.abbreviations.thousand:N=z.abbreviations.million;break;case z.abbreviations.million:N=z.abbreviations.billion;break;case z.abbreviations.billion:N=z.abbreviations.trillion;break}if(s._.includes(oe,"-")&&(oe=oe.slice(1),se=!0),oe.length<O)for(var J=O-oe.length;J>0;J--)oe="0"+oe;return K>-1&&(oe=oe.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+z.delimiters.thousands)),I.indexOf(".")===0&&(oe=""),ye=oe+X+(N||""),R?ye=(R&&se?"(":"")+ye+(R&&se?")":""):pe>=0?ye=pe===0?(se?"-":"+")+ye:ye+(se?"-":"+"):se&&(ye="-"+ye),ye},stringToNumber:function(A){var I=v[r.currentLocale],F=A,z={thousand:3,million:6,billion:9,trillion:12},R,D,O;if(r.zeroFormat&&A===r.zeroFormat)D=0;else if(r.nullFormat&&A===r.nullFormat||!A.replace(/[^0-9]+/g,"").length)D=null;else{D=1,I.delimiters.decimal!=="."&&(A=A.replace(/\./g,"").replace(I.delimiters.decimal,"."));for(R in z)if(O=new RegExp("[^a-zA-Z]"+I.abbreviations[R]+"(?:\\)|(\\"+I.currency.symbol+")?(?:\\))?)?$"),F.match(O)){D*=Math.pow(10,z[R]);break}D*=(A.split("-").length+Math.min(A.split("(").length-1,A.split(")").length-1))%2?1:-1,A=A.replace(/[^0-9\.]+/g,""),D*=Number(A)}return D},isNaN:function(A){return typeof A=="number"&&isNaN(A)},includes:function(A,I){return A.indexOf(I)!==-1},insert:function(A,I,F){return A.slice(0,F)+I+A.slice(F)},reduce:function(A,I){if(this===null)throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof I!="function")throw new TypeError(I+" is not a function");var F=Object(A),z=F.length>>>0,R=0,D;if(arguments.length===3)D=arguments[2];else{for(;R<z&&!(R in F);)R++;if(R>=z)throw new TypeError("Reduce of empty array with no initial value");D=F[R++]}for(;R<z;R++)R in F&&(D=I(D,F[R],R,F));return D},multiplier:function(A){var I=A.toString().split(".");return I.length<2?1:Math.pow(10,I[1].length)},correctionFactor:function(){var A=Array.prototype.slice.call(arguments);return A.reduce(function(I,F){var z=c.multiplier(F);return I>z?I:z},1)},toFixed:function(A,I,F,z){var R=A.toString().split("."),D=I-(z||0),O,N,H,j;return R.length===2?O=Math.min(Math.max(R[1].length,D),I):O=D,H=Math.pow(10,O),j=(F(A+"e+"+O)/H).toFixed(O),z>I-O&&(N=new RegExp("\\.?0{1,"+(z-(I-O))+"}$"),j=j.replace(N,"")),j}},s.options=r,s.formats=g,s.locales=v,s.locale=function(A){return A&&(r.currentLocale=A.toLowerCase()),r.currentLocale},s.localeData=function(A){if(!A)return v[r.currentLocale];if(A=A.toLowerCase(),!v[A])throw new Error("Unknown locale : "+A);return v[A]},s.reset=function(){for(var A in S)r[A]=S[A]},s.zeroFormat=function(A){r.zeroFormat=typeof A=="string"?A:null},s.nullFormat=function(A){r.nullFormat=typeof A=="string"?A:null},s.defaultFormat=function(A){r.defaultFormat=typeof A=="string"?A:"0.0"},s.register=function(A,I,F){if(I=I.toLowerCase(),this[A+"s"][I])throw new TypeError(I+" "+A+" already registered.");return this[A+"s"][I]=F,F},s.validate=function(A,I){var F,z,R,D,O,N,H,j;if(typeof A!="string"&&(A+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",A)),A=A.trim(),A.match(/^\d+$/))return!0;if(A==="")return!1;try{H=s.localeData(I)}catch{H=s.localeData(s.locale())}return R=H.currency.symbol,O=H.abbreviations,F=H.delimiters.decimal,H.delimiters.thousands==="."?z="\\.":z=H.delimiters.thousands,j=A.match(/^[^\d]+/),j!==null&&(A=A.substr(1),j[0]!==R)||(j=A.match(/[^\d]+$/),j!==null&&(A=A.slice(0,-1),j[0]!==O.thousand&&j[0]!==O.million&&j[0]!==O.billion&&j[0]!==O.trillion))?!1:(N=new RegExp(z+"{2}"),A.match(/[^\d.,]/g)?!1:(D=A.split(F),D.length>2?!1:D.length<2?!!D[0].match(/^\d+.*\d$/)&&!D[0].match(N):D[0].length===1?!!D[0].match(/^\d+$/)&&!D[0].match(N)&&!!D[1].match(/^\d+$/):!!D[0].match(/^\d+.*\d$/)&&!D[0].match(N)&&!!D[1].match(/^\d+$/)))},s.fn=E.prototype={clone:function(){return s(this)},format:function(A,I){var F=this._value,z=A||r.defaultFormat,R,D,O;if(I=I||Math.round,F===0&&r.zeroFormat!==null)D=r.zeroFormat;else if(F===null&&r.nullFormat!==null)D=r.nullFormat;else{for(R in g)if(z.match(g[R].regexps.format)){O=g[R].format;break}O=O||s._.numberToFormat,D=O(F,z,I)}return D},value:function(){return this._value},input:function(){return this._input},set:function(A){return this._value=Number(A),this},add:function(A){var I=c.correctionFactor.call(null,this._value,A);function F(z,R,D,O){return z+Math.round(I*R)}return this._value=c.reduce([this._value,A],F,0)/I,this},subtract:function(A){var I=c.correctionFactor.call(null,this._value,A);function F(z,R,D,O){return z-Math.round(I*R)}return this._value=c.reduce([A],F,Math.round(this._value*I))/I,this},multiply:function(A){function I(F,z,R,D){var O=c.correctionFactor(F,z);return Math.round(F*O)*Math.round(z*O)/Math.round(O*O)}return this._value=c.reduce([this._value,A],I,1),this},divide:function(A){function I(F,z,R,D){var O=c.correctionFactor(F,z);return Math.round(F*O)/Math.round(z*O)}return this._value=c.reduce([this._value,A],I),this},difference:function(A){return Math.abs(s(this._value).subtract(A).value())}},s.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(A){var I=A%10;return~~(A%100/10)===1?"th":I===1?"st":I===2?"nd":I===3?"rd":"th"},currency:{symbol:"$"}}),(function(){s.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(A,I,F){var z=s._.includes(I," BPS")?" ":"",R;return A=A*1e4,I=I.replace(/\s?BPS/,""),R=s._.numberToFormat(A,I,F),s._.includes(R,")")?(R=R.split(""),R.splice(-1,0,z+"BPS"),R=R.join("")):R=R+z+"BPS",R},unformat:function(A){return+(s._.stringToNumber(A)*1e-4).toFixed(15)}})})(),(function(){var A={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]},I={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},F=A.suffixes.concat(I.suffixes.filter(function(R){return A.suffixes.indexOf(R)<0})),z=F.join("|");z="("+z.replace("B","B(?!PS)")+")",s.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(z)},format:function(R,D,O){var N,H=s._.includes(D,"ib")?I:A,j=s._.includes(D," b")||s._.includes(D," ib")?" ":"",V,Z,X;for(D=D.replace(/\s?i?b/,""),V=0;V<=H.suffixes.length;V++)if(Z=Math.pow(H.base,V),X=Math.pow(H.base,V+1),R===null||R===0||R>=Z&&R<X){j+=H.suffixes[V],Z>0&&(R=R/Z);break}return N=s._.numberToFormat(R,D,O),N+j},unformat:function(R){var D=s._.stringToNumber(R),O,N;if(D){for(O=A.suffixes.length-1;O>=0;O--){if(s._.includes(R,A.suffixes[O])){N=Math.pow(A.base,O);break}if(s._.includes(R,I.suffixes[O])){N=Math.pow(I.base,O);break}}D*=N||1}return D}})})(),(function(){s.register("format","currency",{regexps:{format:/(\$)/},format:function(A,I,F){var z=s.locales[s.options.currentLocale],R={before:I.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:I.match(/([\+|\-|\)|\s|\$]*)$/)[0]},D,O,N;for(I=I.replace(/\s?\$\s?/,""),D=s._.numberToFormat(A,I,F),A>=0?(R.before=R.before.replace(/[\-\(]/,""),R.after=R.after.replace(/[\-\)]/,"")):A<0&&!s._.includes(R.before,"-")&&!s._.includes(R.before,"(")&&(R.before="-"+R.before),N=0;N<R.before.length;N++)switch(O=R.before[N],O){case"$":D=s._.insert(D,z.currency.symbol,N);break;case" ":D=s._.insert(D," ",N+z.currency.symbol.length-1);break}for(N=R.after.length-1;N>=0;N--)switch(O=R.after[N],O){case"$":D=N===R.after.length-1?D+z.currency.symbol:s._.insert(D,z.currency.symbol,-(R.after.length-(1+N)));break;case" ":D=N===R.after.length-1?D+" ":s._.insert(D," ",-(R.after.length-(1+N)+z.currency.symbol.length-1));break}return D}})})(),(function(){s.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(A,I,F){var z,R=typeof A=="number"&&!s._.isNaN(A)?A.toExponential():"0e+0",D=R.split("e");return I=I.replace(/e[\+|\-]{1}0/,""),z=s._.numberToFormat(Number(D[0]),I,F),z+"e"+D[1]},unformat:function(A){var I=s._.includes(A,"e+")?A.split("e+"):A.split("e-"),F=Number(I[0]),z=Number(I[1]);z=s._.includes(A,"e-")?z*=-1:z;function R(D,O,N,H){var j=s._.correctionFactor(D,O),V=D*j*(O*j)/(j*j);return V}return s._.reduce([F,Math.pow(10,z)],R,1)}})})(),(function(){s.register("format","ordinal",{regexps:{format:/(o)/},format:function(A,I,F){var z=s.locales[s.options.currentLocale],R,D=s._.includes(I," o")?" ":"";return I=I.replace(/\s?o/,""),D+=z.ordinal(A),R=s._.numberToFormat(A,I,F),R+D}})})(),(function(){s.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(A,I,F){var z=s._.includes(I," %")?" ":"",R;return s.options.scalePercentBy100&&(A=A*100),I=I.replace(/\s?\%/,""),R=s._.numberToFormat(A,I,F),s._.includes(R,")")?(R=R.split(""),R.splice(-1,0,z+"%"),R=R.join("")):R=R+z+"%",R},unformat:function(A){var I=s._.stringToNumber(A);return s.options.scalePercentBy100?I*.01:I}})})(),(function(){s.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(A,I,F){var z=Math.floor(A/60/60),R=Math.floor((A-z*60*60)/60),D=Math.round(A-z*60*60-R*60);return z+":"+(R<10?"0"+R:R)+":"+(D<10?"0"+D:D)},unformat:function(A){var I=A.split(":"),F=0;return I.length===3?(F=F+Number(I[0])*60*60,F=F+Number(I[1])*60,F=F+Number(I[2])):I.length===2&&(F=F+Number(I[0])*60,F=F+Number(I[1])),Number(F)}})})(),s})})(V1)),V1.exports}var BB=FB();const Z5=al(BB);function TI(t){const s=SI(t)*1e3;let c="m",p="0,0",g,v="ft",S="0,0",r;return g=s,s>=1e3&&(g=s/1e3,c="km",p="0.00"),r=s*3.28084,r>=5280&&(r/=5280,v="mi",S="0.00"),{metric:`${Z5(g).format(p)} ${c}`,standard:`${Z5(r).format(S)} ${v}`}}const NB={...hf.modes.draw_line_string,toDisplayFeatures(t,s,c){const p=s.properties.id===t.line.id;if(s.properties.active=p?"true":"false",!p)return c(s);if(s.geometry.coordinates.length<2)return;s.properties.meta="feature",c({type:"Feature",properties:{meta:"vertex",parent:t.line.id,coord_path:`${t.direction==="forward"?s.geometry.coordinates.length-2:1}`,active:"false"},geometry:{type:"Point",coordinates:s.geometry.coordinates[t.direction==="forward"?s.geometry.coordinates.length-2:1]}}),c(s);const g=TI(s),v={type:"Feature",properties:{meta:"currentPosition",radius:`${g.metric}
${g.standard}`,parent:t.line.id},geometry:{type:"Point",coordinates:s.geometry.coordinates[s.geometry.coordinates.length-1]}};c(v)}},Y5={enable:t=>{setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},VB={onSetup:function(t={}){const{setLayersRef:s,mode:c}=t,g="Rectangle-"+Date.now(),v=this.newFeature({type:"Feature",properties:{layerID:g,featureID:null},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),Y5.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:v,setLayersRef:s,mode:c}},onTap:function(t,s){t.startPoint&&this.onMouseMove(t,s),this.onClick(t,s)},onClick:function(t,s){t.startPoint&&t.startPoint[0]!==s.lngLat.lng&&t.startPoint[1]!==s.lngLat.lat&&(this.updateUIClasses({mouse:"pointer"}),t.endPoint=[s.lngLat.lng,s.lngLat.lat],this.changeMode("simple_select",{featuresId:t.rectangle.id}));const c=[s.lngLat.lng,s.lngLat.lat];t.startPoint=c},onMouseMove:function(t,s){t.startPoint&&(t.rectangle.updateCoordinate("0.0",t.startPoint[0],t.startPoint[1]),t.rectangle.updateCoordinate("0.1",s.lngLat.lng,t.startPoint[1]),t.rectangle.updateCoordinate("0.2",s.lngLat.lng,s.lngLat.lat),t.rectangle.updateCoordinate("0.3",t.startPoint[0],s.lngLat.lat),t.rectangle.updateCoordinate("0.4",t.startPoint[0],t.startPoint[1]))},onKeyUp:function(t,s){if(s.keyCode===27)return this.changeMode("simple_select")},onStop:function(t){if(Y5.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.getFeature(t.rectangle.id)===void 0)return;t.rectangle.properties.featureID=t.rectangle.id;const s=this.getFeature(t.rectangle.id);if(t.rectangle.removeCoordinate("0.4"),t.rectangle.isValid()){const c=t.rectangle.toGeoJSON();if(c.properties.featureID=s.id,this.map.fire("draw.create",{features:[c]}),Mx({geometry:c.geometry,properties:c.properties||{},name:c.properties.layerID,sourceId:c.properties.layerID}).then(()=>{}).catch(p=>{console.error("Error saving feature:",p)}),t.setLayersRef?.current){const p=c.properties.layerID,g="Rectangle Layer";t.setLayersRef.current(v=>{let S=1,r=g;const E=v.map(A=>A.name);for(;E.includes(r);)r=`${g} ${S++}`;return[...v,{id:p,sourceID:c.properties.featureID,name:r,visible:!0,locked:!1}]})}}else this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})},toDisplayFeatures:function(t,s,c){const p=s.properties.id===t.rectangle.id;if(s.properties.active=p?"true":"false",!p)return c(s);if(t.startPoint)return c(s)},onTrash:function(t){this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select")}};function UB(t,s,c,p={}){const g=kw(t),v=jm(g[0]),S=jm(g[1]),r=jm(c),E=IB(s,p.units),A=Math.asin(Math.sin(S)*Math.cos(E)+Math.cos(S)*Math.sin(E)*Math.cos(r)),I=v+Math.atan2(Math.sin(r)*Math.sin(E)*Math.cos(S),Math.cos(E)-Math.sin(S)*Math.sin(A)),F=H5(I),z=H5(A);return EB([F,z],p.properties)}function jB(t,s,c={}){const p=c.steps||64,g=c.properties?c.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},v=[];for(let S=0;S<p;S++)v.push(UB(t,s,S*-360/p,c).geometry.coordinates);return v.push(v[0]),AB([v],g)}function X5(t){const s=t.geometry.coordinates[0],c=SI(t,{units:"kilometers"});return jB(s,c,{steps:64})}const GB={...hf.modes.draw_line_string,clickAnywhere:function(t,s){return t.currentVertexPosition===1?(t.line.addCoordinate(0,s.lngLat.lng,s.lngLat.lat),this.changeMode("simple_select",{featureIds:[t.line.id]})):(t.line.updateCoordinate(t.currentVertexPosition,s.lngLat.lng,s.lngLat.lat),t.direction==="forward"&&(t.currentVertexPosition+=1),null)},onStop:function(t){if(this.activateUIButton(),!!this.getFeature(t.line.id))if(t.line.removeCoordinate(0),t.line.isValid()){const s=t.line.toGeoJSON(),c=X5(s);this.map.fire("draw.create",{features:[c]})}else this.deleteFeature([t.line.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})},toDisplayFeatures:function(t,s,c){if(s.geometry.coordinates.length<2)return;c({type:"Feature",properties:{active:"true"},geometry:{type:"Point",coordinates:s.geometry.coordinates[0]}}),s.properties.active="true",c(s);const p=TI(s);c({type:"Feature",properties:{meta:"currentPosition",radius:`${p.metric} ${p.standard}`,parent:t.line.id},geometry:{type:"Point",coordinates:s.geometry.coordinates[1]}});const g=X5(s);g.properties={active:"true"},c(g)}},$B={...hf.modes.simple_select,onDrag(t,s){const c=this.getSelected(),p=c.length===1&&c[0].type==="Point";if(t.canDragMove&&(s.originalEvent.shiftKey||p))return this.dragMove(t,s);if(this.drawConfig.boxSelect&&t.canBoxSelect)return this.whileBoxSelect(t,s)},toDisplayFeatures(t,s,c){s.properties.active=this.getSelectedIds().indexOf(s.id)!==-1?"true":"false",c(s)}};function Oc(t,s,c){t.hasImage(s)||t.loadImage(c,(p,g)=>{p||t.hasImage(s)||t.addImage(s,g)})}function HB(t){const s=[{name:"typhoon",path:"/hurricane.png"},{name:"low_pressure",path:"/LPA.png"},{name:"high_pressure",path:"/HPA.png"},{name:"less_1",path:"/L1.png"}],c=[{name:"0kts",path:"/barbs/0kts.svg"},{name:"5kts",path:"/barbs/5kts.svg"},{name:"10kts",path:"/barbs/10kts.svg"},{name:"15kts",path:"/barbs/15kts.svg"},{name:"20kts",path:"/barbs/20kts.svg"},{name:"25kts",path:"/barbs/25kts.svg"},{name:"30kts",path:"/barbs/30kts.svg"}];s.forEach(p=>Oc(t,p.name,p.path)),c.forEach(p=>Oc(t,p.name,p.path))}function qB(t){t.getSource("typhoon-points")||t.addSource("typhoon-points",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.getLayer("typhoon-layer")||t.addLayer({id:"typhoon-layer",type:"symbol",source:"typhoon-points",slot:"top",layout:{"icon-image":["get","icon"],"icon-size":["case",["==",["get","markerType"],"low_pressure"],.2,.09],"text-field":["get","title"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":["case",["==",["get","markerType"],"low_pressure"],[0,2],[0,1.25]],"text-anchor":"top","icon-allow-overlap":!0,"text-allow-overlap":!0},paint:{"text-color":"red"},minzoom:0,maxzoom:24})}function WB(t){if(t.drawControl)return t.drawControl;const s=new hf({displayControlsDefault:!1,modes:{...hf.modes,simple_select:$B,direct_select:hf.modes.direct_select,draw_line_string:NB,draw_rectangle:VB,draw_circle:GB},styles:kF});return t.addControl(s),t.drawControl=s,s}const ax=(t,s,c,p)=>g=>{if(!t)return;const{lng:v,lat:S}=t,r={typhoon:"typhoon",low_pressure:"low_pressure",high_pressure:"high_pressure",less_1:"less_1"},E={typhoon:"Typhoon",low_pressure:"LPA"},A=p,I=r[A],F={type:"Feature",geometry:{type:"Point",coordinates:[v,S]},properties:{title:g||E[A],markerType:A,icon:I}},z=s.current;if(!z)return;const R=`${A}_${g}`,D=`${A}_${g}`;if(!z.getSource(R))try{z.addSource(R,{type:"geojson",data:F})}catch(H){console.error(` Failed to add source "${R}":`,H)}const O={"icon-image":["get","icon"],"icon-size":["case",["==",["get","markerType"],"low_pressure"],.028,["==",["get","markerType"],"high_pressure"],.028,["==",["get","markerType"],"less_1"],.28,.07],"icon-allow-overlap":!0};A!=="less_1"&&(O["text-field"]=["get","title"],O["text-font"]=["Open Sans Semibold","Arial Unicode MS Bold"],O["text-offset"]=["case",["==",["get","markerType"],"low_pressure"],[0,1],[0,1.25]],O["text-anchor"]="top",O["text-allow-overlap"]=!0);const N={};if(A!=="less_1"&&(N["text-color"]=["case",["==",["get","markerType"],"low_pressure"],"red",["==",["get","markerType"],"high_pressure"],"blue","purple"],N["text-halo-color"]="#FFFFFF",N["text-halo-width"]=1,N["text-opacity"]=["case",["any",["==",["get","markerType"],"low_pressure"],["==",["get","markerType"],"high_pressure"]],0,1]),!z.getLayer(D))try{z.addLayer({id:D,type:"symbol",source:R,slot:"top",layout:O,paint:N})}catch(H){console.error(` Failed to add layer "${D}":`,H)}c(!1)},ZB=pn.div`
  position: fixed;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: row;
  align-items: center;
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid #d1d5db;
  border-radius: 30px;
  padding: 0.3rem;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* small shadow added */
  z-index: 100;
  gap: 0.75rem;
`,y0=pn.button`
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  color: ${({active:t,theme:s})=>t?s.colors.activeButtonColor:s.colors.buttonColor};
  border: none;
  box-shadow: none;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    transform: scale(1.1);
    background-color: ${({theme:t})=>t.colors.buttonHoverBackground};
  }

  &:active {
    background-color: ${({theme:t})=>t.colors.buttonActiveBackground};
  }
`,YB=pn.button`
  width: 40px;
  height: 40px;
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  box-shadow: none;
  color: ${({theme:t})=>t.colors.buttonColor};
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  opacity: 80%;

  &:hover {
    transform: rotate(90deg);
    color: ${({theme:t})=>t.colors.buttonHoverColor};
    background-color: ${({theme:t})=>t.colors.buttonHoverBackground};
  }
`,K5=(t,s,c)=>{s?.changeMode&&(t==="typhoon"&&(t="draw_point"),s.changeMode(t,{setLayersRef:c}))};function Ow({coords:t,title:s,selectedType:c,setLayersRef:p}){if(typeof p?.current!="function")return;const g={geometry:{type:"Point",coordinates:t}},v=s||"Untitled Layer",S=`${c}_${v}`,r=`${c}_${v}`,E=!1;p.current(A=>{const I=A.map(z=>z.name);JSON.parse(localStorage.getItem("user"));const F=localStorage.getItem("projectId");return I.includes(v)?(Po.fire({toast:!0,position:"top-end",icon:"error",title:`The marker named "${v}" already exists.`,showConfirmButton:!1,timer:3e3}),A):(Mx({geometry:g.geometry,properties:{labelValue:v,closedMode:E,isFront:!1,project:F,title:s,type:c},name:v,sourceId:S}).then(()=>{Po.fire({icon:"success",title:"Feature saved!",text:`"${v}" has been added successfully.`,toast:!0,position:"top-end",showConfirmButton:!1,timer:3500})}).catch(z=>{Po.fire({icon:"error",title:"Failed to save feature",text:z?.message||"An unknown error occurred.",confirmButtonColor:"#d33"})}),[...A,{id:r,sourceID:S,name:v,visible:!0,locked:!1}])})}const XB=(t,s,c)=>{t?U1(s,c):JB(s,c)},KB=(t,s,c)=>{t?j1(s,c):QB(s,c)},JB=(t,s)=>{t(!0),s?.(!0)},QB=(t,s)=>{t(!0),s?.(!0)},U1=(t,s)=>{t(!1),s?.(!1)},j1=(t,s)=>{t(!1),s?.(!1)},eN=t=>{t(s=>!s)},tN=({draw:t,mapRef:s,onToggleCanvas:c,onToggleFlagCanvas:p,isCanvasActive:g,isdarkmode:v,setLayersRef:S,setLayers:r,closedMode:E,setClosedMode:A,setType:I,selectedToolRef:F,title:z})=>{const[R,D]=Te.useState(!1),[O,N]=Te.useState(!1),[H,j]=Te.useState(!0),[V,Z]=Te.useState(null),[X,se]=Te.useState(null),[ge,ae]=Te.useState(!1),[oe,fe]=Te.useState({featureNotAvailable:!1,pointInputChoice:!1,manualInput:!1});Te.useEffect(()=>{S?.current!==r&&(S.current=r)},[S,r]),Te.useEffect(()=>{},[z]);const pe=(xe,Ce)=>{fe(Re=>({...Re,[xe]:Ce}))},K=Te.useMemo(()=>[{id:"low_pressure",icon:ue.jsx("img",{src:m8,alt:"Low Pressure Area",style:{width:16,height:20}}),label:"Low Pressure Area (A)",hotkey:"a",modal:"pointInputChoice"},{id:"high_pressure",icon:ue.jsx("img",{src:g8,alt:"High Pressure Area",style:{width:16,height:20}}),label:"High Pressure Area (H)",hotkey:"h",modal:"pointInputChoice"},{id:"typhoon",icon:ue.jsx("img",{src:_8,alt:"Draw Storm",style:{width:20,height:20}}),label:"Draw Storm (M)",hotkey:"m",modal:"pointInputChoice"}],[]),ye=xe=>{if(F.current=xe.id,Z(xe.id),I&&I(xe.id),R&&U1(D,c),O&&j1(N,p),xe.modal){pe(xe.modal,!0);return}K5(xe.id,t,S)},J=xe=>{pe("pointInputChoice",!1);const Ce=F.current||"typhoon";if(xe==="manual")pe("manualInput",!0);else if(xe==="map"&&["typhoon","low_pressure","high_pressure","less_1"].includes(Ce)){K5("draw_point",t,S);const Re=s.current;if(!Re){console.warn("Map is not ready yet.");return}const Ee=Oe=>{const Be=Oe.features[0],[at,ut]=Be.geometry.coordinates,nt=[at,ut];if(Ce.toLowerCase()==="less_1"){const ct=`Low Waves_${fS()}`;ae(!1),ax({lat:ut,lng:at},s,ae,Ce)(ct),Ow({coords:nt,title:ct,selectedType:Ce,setLayersRef:S})}Re.off("draw.create",Ee)};Re.on("draw.create",Ee)}},de=async xe=>{const Ce=F.current||"typhoon";I&&I(Ce);const Re=[parseFloat(xe.lng),parseFloat(xe.lat)],Ee=xe.title;ax({lat:xe.lat,lng:xe.lng},s,ae,Ce)(Ee),Ow({coords:Re,title:Ee,selectedType:Ce,setLayersRef:S}),se(xe),pe("manualInput",!1)},Ae=Te.useCallback(xe=>{},[K,t,R,O,c,p,S,r]);Te.useEffect(()=>(window.addEventListener("keydown",Ae),()=>window.removeEventListener("keydown",Ae)),[Ae]);const ne=()=>eN(j);return ue.jsxs(ue.Fragment,{children:[ue.jsx(S8,{isOpen:oe.pointInputChoice,onClose:()=>pe("pointInputChoice",!1),onSelect:J}),ue.jsx(z8,{isOpen:oe.featureNotAvailable,onClose:()=>pe("featureNotAvailable",!1)}),ue.jsx(P8,{isOpen:oe.manualInput,onClose:()=>pe("manualInput",!1),onSubmit:de}),ue.jsxs(ZB,{isdarkmode:v,children:[ue.jsx(YB,{title:H?"Expand Toolbar":"Collapse Toolbar",isdarkmode:v,onClick:ne,children:H?ue.jsx(h8,{size:20}):""}),!H&&ue.jsxs(ue.Fragment,{children:[K.map(xe=>ue.jsx(y0,{title:xe.label,isdarkmode:v,onClick:()=>ye(xe),children:xe.icon},xe.id)),ue.jsx(y0,{title:O?"Stop Flag Drawing (X)":"Start Flag Drawing ()",isdarkmode:v,onClick:()=>{R&&U1(D,c),KB(O,N,p)},children:O?"":""}),ue.jsx(y0,{title:"Mark Less than 1 Meter (1)",isdarkmode:v,onClick:()=>{F.current="less_1",Z("less_1"),R&&U1(D,c),O&&j1(N,p),pe("pointInputChoice",!0)},children:ue.jsx("img",{src:p8,alt:"Less than 1 Meter",style:{width:36,height:36}})}),ue.jsx(y0,{title:R?"Stop Wave Height Drawing (X)":"Start Wave Height Drawing ()",$active:g,$isdarkmode:v,onClick:()=>{O&&j1(N,p),XB(R,D,c)},children:R?"":ue.jsx("img",{src:f8,alt:"Wave Height Drawing",style:{width:20,height:20}})}),g&&ue.jsx(y0,{title:E?"Closed Shape Mode (O)":"Open Shape Mode (C)",$active:!0,$isdarkmode:v,onClick:()=>A(xe=>!xe),style:{backgroundColor:E?"#4CAF50":"#F44336",color:"white"},children:ue.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:E?"O":"C"})})]})]})]})};var B2={exports:{}},N2,J5;function nN(){if(J5)return N2;J5=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return N2=t,N2}var V2,Q5;function rN(){if(Q5)return V2;Q5=1;var t=nN();function s(){}function c(){}return c.resetWarningCache=s,V2=function(){function p(S,r,E,A,I,F){if(F!==t){var z=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw z.name="Invariant Violation",z}}p.isRequired=p;function g(){return p}var v={array:p,bigint:p,bool:p,func:p,number:p,object:p,string:p,symbol:p,any:p,arrayOf:g,element:p,elementType:p,instanceOf:g,node:p,objectOf:g,oneOf:g,oneOfType:g,shape:g,exact:g,checkPropTypes:c,resetWarningCache:s};return v.PropTypes=v,v},V2}var eA;function iN(){return eA||(eA=1,B2.exports=rN()()),B2.exports}var oN=iN();const Tn=al(oN);function CI(t){var s,c,p="";if(typeof t=="string"||typeof t=="number")p+=t;else if(typeof t=="object")if(Array.isArray(t)){var g=t.length;for(s=0;s<g;s++)t[s]&&(c=CI(t[s]))&&(p&&(p+=" "),p+=c)}else for(c in t)t[c]&&(p&&(p+=" "),p+=c);return p}function Ar(){for(var t,s,c=0,p="",g=arguments.length;c<g;c++)(t=arguments[c])&&(s=CI(t))&&(p&&(p+=" "),p+=s);return p}function ti(t,s,c=void 0){const p={};for(const g in t){const v=t[g];let S="",r=!0;for(let E=0;E<v.length;E+=1){const A=v[E];A&&(S+=(r===!0?"":" ")+s(A),r=!1,c&&c[A]&&(S+=" "+c[A]))}p[g]=S}return p}const sN=Te.createContext(),Su=()=>Te.useContext(sN)??!1;function So(...t){const s=Te.useRef(void 0),c=Te.useCallback(p=>{const g=t.map(v=>{if(v==null)return null;if(typeof v=="function"){const S=v,r=S(p);return typeof r=="function"?r:()=>{S(null)}}return v.current=p,()=>{v.current=null}});return()=>{g.forEach(v=>v?.())}},t);return Te.useMemo(()=>t.every(p=>p==null)?null:p=>{s.current&&(s.current(),s.current=void 0),p!=null&&(s.current=c(p))},t)}function dh(t){return typeof t=="string"}function EI(t,s,c){return t===void 0||dh(t)?s:{...s,ownerState:{...s.ownerState,...c}}}function Cy(t,s=[]){if(t===void 0)return{};const c={};return Object.keys(t).filter(p=>p.match(/^on[A-Z]/)&&typeof t[p]=="function"&&!s.includes(p)).forEach(p=>{c[p]=t[p]}),c}function tA(t){if(t===void 0)return{};const s={};return Object.keys(t).filter(c=>!(c.match(/^on[A-Z]/)&&typeof t[c]=="function")).forEach(c=>{s[c]=t[c]}),s}function AI(t){const{getSlotProps:s,additionalProps:c,externalSlotProps:p,externalForwardedProps:g,className:v}=t;if(!s){const R=Ar(c?.className,v,g?.className,p?.className),D={...c?.style,...g?.style,...p?.style},O={...c,...g,...p};return R.length>0&&(O.className=R),Object.keys(D).length>0&&(O.style=D),{props:O,internalRef:void 0}}const S=Cy({...g,...p}),r=tA(p),E=tA(g),A=s(S),I=Ar(A?.className,c?.className,v,g?.className,p?.className),F={...A?.style,...c?.style,...g?.style,...p?.style},z={...A,...c,...E,...r};return I.length>0&&(z.className=I),Object.keys(F).length>0&&(z.style=F),{props:z,internalRef:A.ref}}function ad(t,s,c){return typeof t=="function"?t(s,c):t}function ji(t){const{elementType:s,externalSlotProps:c,ownerState:p,skipResolvingSlotProps:g=!1,...v}=t,S=g?{}:ad(c,p),{props:r,internalRef:E}=AI({...v,externalSlotProps:S}),A=So(E,S?.ref,t.additionalProps?.ref);return EI(s,{...r,ref:A},p)}function As(t){return t&&t.ownerDocument||document}function ff(t){const{controlled:s,default:c,name:p,state:g="value"}=t,{current:v}=Te.useRef(s!==void 0),[S,r]=Te.useState(c),E=v?s:S,A=Te.useCallback(I=>{v||r(I)},[]);return[E,A]}const la=typeof window<"u"?Te.useLayoutEffect:Te.useEffect;function _r(t){const s=Te.useRef(t);return la(()=>{s.current=t}),Te.useRef((...c)=>(0,s.current)(...c)).current}function lx(t){try{return t.matches(":focus-visible")}catch{}return!1}const PI={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function Zg(t,s=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER){return Math.max(s,Math.min(t,c))}function aN(t,s,c=(p,g)=>p===g){return t.length===s.length&&t.every((p,g)=>c(p,s[g]))}const lN=2;function Ng(t,s,c,p,g){return c===1?Math.min(t+s,g):Math.max(t-s,p)}function MI(t,s){return t-s}function nA(t,s){const{index:c}=t.reduce((p,g,v)=>{const S=Math.abs(s-g);return p===null||S<p.distance||S===p.distance?{distance:S,index:v}:p},null)??{};return c}function d1(t,s){if(s.current!==void 0&&t.changedTouches){const c=t;for(let p=0;p<c.changedTouches.length;p+=1){const g=c.changedTouches[p];if(g.identifier===s.current)return{x:g.clientX,y:g.clientY}}return!1}return{x:t.clientX,y:t.clientY}}function cx(t,s,c){return(t-s)*100/(c-s)}function cN(t,s,c){return(c-s)*t+s}function uN(t){if(Math.abs(t)<1){const c=t.toExponential().split("e-"),p=c[0].split(".")[1];return(p?p.length:0)+parseInt(c[1],10)}const s=t.toString().split(".")[1];return s?s.length:0}function dN(t,s,c){const p=Math.round((t-c)/s)*s+c;return Number(p.toFixed(uN(s)))}function rA({values:t,newValue:s,index:c}){const p=t.slice();return p[c]=s,p.sort(MI)}function h1({sliderRef:t,activeIndex:s,setActive:c}){const p=As(t.current);(!t.current?.contains(p.activeElement)||Number(p?.activeElement?.getAttribute("data-index"))!==s)&&t.current?.querySelector(`[type="range"][data-index="${s}"]`).focus(),c&&c(s)}function f1(t,s){return typeof t=="number"&&typeof s=="number"?t===s:typeof t=="object"&&typeof s=="object"?aN(t,s):!1}const hN={horizontal:{offset:t=>({left:`${t}%`}),leap:t=>({width:`${t}%`})},"horizontal-reverse":{offset:t=>({right:`${t}%`}),leap:t=>({width:`${t}%`})},vertical:{offset:t=>({bottom:`${t}%`}),leap:t=>({height:`${t}%`})}},fN=t=>t;let p1;function iA(){return p1===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?p1=CSS.supports("touch-action","none"):p1=!0),p1}function pN(t){const{"aria-labelledby":s,defaultValue:c,disabled:p=!1,disableSwap:g=!1,isRtl:v=!1,marks:S=!1,max:r=100,min:E=0,name:A,onChange:I,onChangeCommitted:F,orientation:z="horizontal",rootRef:R,scale:D=fN,step:O=1,shiftStep:N=10,tabIndex:H,value:j}=t,V=Te.useRef(void 0),[Z,X]=Te.useState(-1),[se,ge]=Te.useState(-1),[ae,oe]=Te.useState(!1),fe=Te.useRef(0),pe=Te.useRef(null),[K,ye]=ff({controlled:j,default:c??E,name:"Slider"}),J=I&&((Gt,Yt,zn)=>{const $n=Gt.nativeEvent||Gt,On=new $n.constructor($n.type,$n);Object.defineProperty(On,"target",{writable:!0,value:{value:Yt,name:A}}),pe.current=Yt,I(On,Yt,zn)}),de=Array.isArray(K);let Ae=de?K.slice().sort(MI):[K];Ae=Ae.map(Gt=>Gt==null?E:Zg(Gt,E,r));const ne=S===!0&&O!==null?[...Array(Math.floor((r-E)/O)+1)].map((Gt,Yt)=>({value:E+O*Yt})):S||[],xe=ne.map(Gt=>Gt.value),[Ce,Re]=Te.useState(-1),Ee=Te.useRef(null),Oe=So(R,Ee),Be=Gt=>Yt=>{const zn=Number(Yt.currentTarget.getAttribute("data-index"));lx(Yt.target)&&Re(zn),ge(zn),Gt?.onFocus?.(Yt)},at=Gt=>Yt=>{lx(Yt.target)||Re(-1),ge(-1),Gt?.onBlur?.(Yt)},ut=(Gt,Yt)=>{const zn=Number(Gt.currentTarget.getAttribute("data-index")),$n=Ae[zn],On=xe.indexOf($n);let Bn=Yt;if(ne&&O==null){const kn=xe[xe.length-1];Bn>=kn?Bn=kn:Bn<=xe[0]?Bn=xe[0]:Bn=Bn<$n?xe[On-1]:xe[On+1]}if(Bn=Zg(Bn,E,r),de){g&&(Bn=Zg(Bn,Ae[zn-1]||-1/0,Ae[zn+1]||1/0));const kn=Bn;Bn=rA({values:Ae,newValue:Bn,index:zn});let Pr=zn;g||(Pr=Bn.indexOf(kn)),h1({sliderRef:Ee,activeIndex:Pr})}ye(Bn),Re(zn),J&&!f1(Bn,K)&&J(Gt,Bn,zn),F&&F(Gt,pe.current??Bn)},nt=Gt=>Yt=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(Yt.key)){Yt.preventDefault();const zn=Number(Yt.currentTarget.getAttribute("data-index")),$n=Ae[zn];let On=null;if(O!=null){const Bn=Yt.shiftKey?N:O;switch(Yt.key){case"ArrowUp":On=Ng($n,Bn,1,E,r);break;case"ArrowRight":On=Ng($n,Bn,v?-1:1,E,r);break;case"ArrowDown":On=Ng($n,Bn,-1,E,r);break;case"ArrowLeft":On=Ng($n,Bn,v?1:-1,E,r);break;case"PageUp":On=Ng($n,N,1,E,r);break;case"PageDown":On=Ng($n,N,-1,E,r);break;case"Home":On=E;break;case"End":On=r;break}}else if(ne){const Bn=xe[xe.length-1],kn=xe.indexOf($n),Pr=[v?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],mr=[v?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];Pr.includes(Yt.key)?kn===0?On=xe[0]:On=xe[kn-1]:mr.includes(Yt.key)&&(kn===xe.length-1?On=Bn:On=xe[kn+1])}On!=null&&ut(Yt,On)}Gt?.onKeyDown?.(Yt)};la(()=>{p&&Ee.current.contains(document.activeElement)&&document.activeElement?.blur()},[p]),p&&Z!==-1&&X(-1),p&&Ce!==-1&&Re(-1);const $e=Gt=>Yt=>{Gt.onChange?.(Yt),ut(Yt,Yt.target.valueAsNumber)},ct=Te.useRef(void 0);let At=z;v&&z==="horizontal"&&(At+="-reverse");const xt=({finger:Gt,move:Yt=!1})=>{const{current:zn}=Ee,{width:$n,height:On,bottom:Bn,left:kn}=zn.getBoundingClientRect();let Pr;At.startsWith("vertical")?Pr=(Bn-Gt.y)/On:Pr=(Gt.x-kn)/$n,At.includes("-reverse")&&(Pr=1-Pr);let mr;if(mr=cN(Pr,E,r),O)mr=dN(mr,O,E);else{const tr=nA(xe,mr);mr=xe[tr]}mr=Zg(mr,E,r);let ni=0;if(de){Yt?ni=ct.current:ni=nA(Ae,mr),g&&(mr=Zg(mr,Ae[ni-1]||-1/0,Ae[ni+1]||1/0));const tr=mr;mr=rA({values:Ae,newValue:mr,index:ni}),g&&Yt||(ni=mr.indexOf(tr),ct.current=ni)}return{newValue:mr,activeIndex:ni}},It=_r(Gt=>{const Yt=d1(Gt,V);if(!Yt)return;if(fe.current+=1,Gt.type==="mousemove"&&Gt.buttons===0){jt(Gt);return}const{newValue:zn,activeIndex:$n}=xt({finger:Yt,move:!0});h1({sliderRef:Ee,activeIndex:$n,setActive:X}),ye(zn),!ae&&fe.current>lN&&oe(!0),J&&!f1(zn,K)&&J(Gt,zn,$n)}),jt=_r(Gt=>{const Yt=d1(Gt,V);if(oe(!1),!Yt)return;const{newValue:zn}=xt({finger:Yt,move:!0});X(-1),Gt.type==="touchend"&&ge(-1),F&&F(Gt,pe.current??zn),V.current=void 0,Se()}),cn=_r(Gt=>{if(p)return;iA()||Gt.preventDefault();const Yt=Gt.changedTouches[0];Yt!=null&&(V.current=Yt.identifier);const zn=d1(Gt,V);if(zn!==!1){const{newValue:On,activeIndex:Bn}=xt({finger:zn});h1({sliderRef:Ee,activeIndex:Bn,setActive:X}),ye(On),J&&!f1(On,K)&&J(Gt,On,Bn)}fe.current=0;const $n=As(Ee.current);$n.addEventListener("touchmove",It,{passive:!0}),$n.addEventListener("touchend",jt,{passive:!0})}),Se=Te.useCallback(()=>{const Gt=As(Ee.current);Gt.removeEventListener("mousemove",It),Gt.removeEventListener("mouseup",jt),Gt.removeEventListener("touchmove",It),Gt.removeEventListener("touchend",jt)},[jt,It]);Te.useEffect(()=>{const{current:Gt}=Ee;return Gt.addEventListener("touchstart",cn,{passive:iA()}),()=>{Gt.removeEventListener("touchstart",cn),Se()}},[Se,cn]),Te.useEffect(()=>{p&&Se()},[p,Se]);const mt=Gt=>Yt=>{if(Gt.onMouseDown?.(Yt),p||Yt.defaultPrevented||Yt.button!==0)return;Yt.preventDefault();const zn=d1(Yt,V);if(zn!==!1){const{newValue:On,activeIndex:Bn}=xt({finger:zn});h1({sliderRef:Ee,activeIndex:Bn,setActive:X}),ye(On),J&&!f1(On,K)&&J(Yt,On,Bn)}fe.current=0;const $n=As(Ee.current);$n.addEventListener("mousemove",It,{passive:!0}),$n.addEventListener("mouseup",jt)},Ke=cx(de?Ae[0]:E,E,r),Ue=cx(Ae[Ae.length-1],E,r)-Ke,je=(Gt={})=>{const Yt=Cy(Gt),zn={onMouseDown:mt(Yt||{})},$n={...Yt,...zn};return{...Gt,ref:Oe,...$n}},gt=Gt=>Yt=>{Gt.onMouseOver?.(Yt);const zn=Number(Yt.currentTarget.getAttribute("data-index"));ge(zn)},Ot=Gt=>Yt=>{Gt.onMouseLeave?.(Yt),ge(-1)},Ft=(Gt={})=>{const Yt=Cy(Gt),zn={onMouseOver:gt(Yt||{}),onMouseLeave:Ot(Yt||{})};return{...Gt,...Yt,...zn}},pt=Gt=>({pointerEvents:Z!==-1&&Z!==Gt?"none":void 0});let dn;return z==="vertical"&&(dn=v?"vertical-rl":"vertical-lr"),{active:Z,axis:At,axisProps:hN,dragging:ae,focusedThumbIndex:Ce,getHiddenInputProps:(Gt={})=>{const Yt=Cy(Gt),zn={onChange:$e(Yt||{}),onFocus:Be(Yt||{}),onBlur:at(Yt||{}),onKeyDown:nt(Yt||{})},$n={...Yt,...zn};return{tabIndex:H,"aria-labelledby":s,"aria-orientation":z,"aria-valuemax":D(r),"aria-valuemin":D(E),name:A,type:"range",min:t.min,max:t.max,step:t.step===null&&t.marks?"any":t.step??void 0,disabled:p,...Gt,...$n,style:{...PI,direction:v?"rtl":"ltr",width:"100%",height:"100%",writingMode:dn}}},getRootProps:je,getThumbProps:Ft,marks:ne,open:se,range:de,rootRef:Oe,trackLeap:Ue,trackOffset:Ke,values:Ae,getThumbStyle:pt}}function pf(t,...s){const c=new URL(`https://mui.com/production-error/?code=${t}`);return s.forEach(p=>c.searchParams.append("args[]",p)),`Minified MUI error #${t}; visit ${c} for the full message.`}function ar(t){if(typeof t!="string")throw new Error(pf(7));return t.charAt(0).toUpperCase()+t.slice(1)}var U2={exports:{}},qo={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oA;function mN(){if(oA)return qo;oA=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),S=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),z=Symbol.for("react.view_transition"),R=Symbol.for("react.client.reference");function D(O){if(typeof O=="object"&&O!==null){var N=O.$$typeof;switch(N){case t:switch(O=O.type,O){case c:case g:case p:case E:case A:case z:return O;default:switch(O=O&&O.$$typeof,O){case S:case r:case F:case I:return O;case v:return O;default:return N}}case s:return N}}}return qo.ContextConsumer=v,qo.ContextProvider=S,qo.Element=t,qo.ForwardRef=r,qo.Fragment=c,qo.Lazy=F,qo.Memo=I,qo.Portal=s,qo.Profiler=g,qo.StrictMode=p,qo.Suspense=E,qo.SuspenseList=A,qo.isContextConsumer=function(O){return D(O)===v},qo.isContextProvider=function(O){return D(O)===S},qo.isElement=function(O){return typeof O=="object"&&O!==null&&O.$$typeof===t},qo.isForwardRef=function(O){return D(O)===r},qo.isFragment=function(O){return D(O)===c},qo.isLazy=function(O){return D(O)===F},qo.isMemo=function(O){return D(O)===I},qo.isPortal=function(O){return D(O)===s},qo.isProfiler=function(O){return D(O)===g},qo.isStrictMode=function(O){return D(O)===p},qo.isSuspense=function(O){return D(O)===E},qo.isSuspenseList=function(O){return D(O)===A},qo.isValidElementType=function(O){return typeof O=="string"||typeof O=="function"||O===c||O===g||O===p||O===E||O===A||typeof O=="object"&&O!==null&&(O.$$typeof===F||O.$$typeof===I||O.$$typeof===S||O.$$typeof===v||O.$$typeof===r||O.$$typeof===R||O.getModuleId!==void 0)},qo.typeOf=D,qo}var sA;function gN(){return sA||(sA=1,U2.exports=mN()),U2.exports}var II=gN();function ch(t){if(typeof t!="object"||t===null)return!1;const s=Object.getPrototypeOf(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function RI(t){if(Te.isValidElement(t)||II.isValidElementType(t)||!ch(t))return t;const s={};return Object.keys(t).forEach(c=>{s[c]=RI(t[c])}),s}function sl(t,s,c={clone:!0}){const p=c.clone?{...t}:t;return ch(t)&&ch(s)&&Object.keys(s).forEach(g=>{Te.isValidElement(s[g])||II.isValidElementType(s[g])?p[g]=s[g]:ch(s[g])&&Object.prototype.hasOwnProperty.call(t,g)&&ch(t[g])?p[g]=sl(t[g],s[g],c):c.clone?p[g]=ch(s[g])?RI(s[g]):s[g]:p[g]=s[g]}),p}function Ey(t,s){return s?sl(t,s,{clone:!1}):t}function aA(t,s){if(!t.containerQueries)return s;const c=Object.keys(s).filter(p=>p.startsWith("@container")).sort((p,g)=>{const v=/min-width:\s*([0-9.]+)/;return+(p.match(v)?.[1]||0)-+(g.match(v)?.[1]||0)});return c.length?c.reduce((p,g)=>{const v=s[g];return delete p[g],p[g]=v,p},{...s}):s}function _N(t,s){return s==="@"||s.startsWith("@")&&(t.some(c=>s.startsWith(`@${c}`))||!!s.match(/^@\d/))}function yN(t,s){const c=s.match(/^@([^/]+)?\/?(.+)?$/);if(!c)return null;const[,p,g]=c,v=Number.isNaN(+p)?p||0:+p;return t.containerQueries(g).up(v)}function vN(t){const s=(v,S)=>v.replace("@media",S?`@container ${S}`:"@container");function c(v,S){v.up=(...r)=>s(t.breakpoints.up(...r),S),v.down=(...r)=>s(t.breakpoints.down(...r),S),v.between=(...r)=>s(t.breakpoints.between(...r),S),v.only=(...r)=>s(t.breakpoints.only(...r),S),v.not=(...r)=>{const E=s(t.breakpoints.not(...r),S);return E.includes("not all and")?E.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):E}}const p={},g=v=>(c(p,v),p);return c(g),{...t,containerQueries:g}}const zx={xs:0,sm:600,md:900,lg:1200,xl:1536},lA={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${zx[t]}px)`},xN={containerQueries:t=>({up:s=>{let c=typeof s=="number"?s:zx[s]||s;return typeof c=="number"&&(c=`${c}px`),t?`@container ${t} (min-width:${c})`:`@container (min-width:${c})`}})};function mf(t,s,c){const p=t.theme||{};if(Array.isArray(s)){const v=p.breakpoints||lA;return s.reduce((S,r,E)=>(S[v.up(v.keys[E])]=c(s[E]),S),{})}if(typeof s=="object"){const v=p.breakpoints||lA;return Object.keys(s).reduce((S,r)=>{if(_N(v.keys,r)){const E=yN(p.containerQueries?p:xN,r);E&&(S[E]=c(s[r],r))}else if(Object.keys(v.values||zx).includes(r)){const E=v.up(r);S[E]=c(s[r],r)}else{const E=r;S[E]=s[E]}return S},{})}return c(s)}function bN(t={}){return t.keys?.reduce((c,p)=>{const g=t.up(p);return c[g]={},c},{})||{}}function cA(t,s){return t.reduce((c,p)=>{const g=c[p];return(!g||Object.keys(g).length===0)&&delete c[p],c},s)}function Fx(t,s,c=!0){if(!s||typeof s!="string")return null;if(t&&t.vars&&c){const p=`vars.${s}`.split(".").reduce((g,v)=>g&&g[v]?g[v]:null,t);if(p!=null)return p}return s.split(".").reduce((p,g)=>p&&p[g]!=null?p[g]:null,t)}function ux(t,s,c,p=c){let g;return typeof t=="function"?g=t(c):Array.isArray(t)?g=t[c]||p:g=Fx(t,c)||p,s&&(g=s(g,p,t)),g}function js(t){const{prop:s,cssProperty:c=t.prop,themeKey:p,transform:g}=t,v=S=>{if(S[s]==null)return null;const r=S[s],E=S.theme,A=Fx(E,p)||{};return mf(S,r,F=>{let z=ux(A,g,F);return F===z&&typeof F=="string"&&(z=ux(A,g,`${s}${F==="default"?"":ar(F)}`,F)),c===!1?z:{[c]:z}})};return v.propTypes={},v.filterProps=[s],v}function wN(t){const s={};return c=>(s[c]===void 0&&(s[c]=t(c)),s[c])}const SN={m:"margin",p:"padding"},TN={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},uA={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},CN=wN(t=>{if(t.length>2)if(uA[t])t=uA[t];else return[t];const[s,c]=t.split(""),p=SN[s],g=TN[c]||"";return Array.isArray(g)?g.map(v=>p+v):[p+g]}),bS=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],wS=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...bS,...wS];function ev(t,s,c,p){const g=Fx(t,s,!0)??c;return typeof g=="number"||typeof g=="string"?v=>typeof v=="string"?v:typeof g=="string"?g.startsWith("var(")&&v===0?0:g.startsWith("var(")&&v===1?g:`calc(${v} * ${g})`:g*v:Array.isArray(g)?v=>{if(typeof v=="string")return v;const S=Math.abs(v),r=g[S];return v>=0?r:typeof r=="number"?-r:typeof r=="string"&&r.startsWith("var(")?`calc(-1 * ${r})`:`-${r}`}:typeof g=="function"?g:()=>{}}function SS(t){return ev(t,"spacing",8)}function tv(t,s){return typeof s=="string"||s==null?s:t(s)}function EN(t,s){return c=>t.reduce((p,g)=>(p[g]=tv(s,c),p),{})}function AN(t,s,c,p){if(!s.includes(c))return null;const g=CN(c),v=EN(g,p),S=t[c];return mf(t,S,v)}function DI(t,s){const c=SS(t.theme);return Object.keys(t).map(p=>AN(t,s,p,c)).reduce(Ey,{})}function Ts(t){return DI(t,bS)}Ts.propTypes={};Ts.filterProps=bS;function Cs(t){return DI(t,wS)}Cs.propTypes={};Cs.filterProps=wS;function Bx(...t){const s=t.reduce((p,g)=>(g.filterProps.forEach(v=>{p[v]=g}),p),{}),c=p=>Object.keys(p).reduce((g,v)=>s[v]?Ey(g,s[v](p)):g,{});return c.propTypes={},c.filterProps=t.reduce((p,g)=>p.concat(g.filterProps),[]),c}function _u(t){return typeof t!="number"?t:`${t}px solid`}function Tu(t,s){return js({prop:t,themeKey:"borders",transform:s})}const PN=Tu("border",_u),MN=Tu("borderTop",_u),IN=Tu("borderRight",_u),RN=Tu("borderBottom",_u),DN=Tu("borderLeft",_u),kN=Tu("borderColor"),ON=Tu("borderTopColor"),LN=Tu("borderRightColor"),zN=Tu("borderBottomColor"),FN=Tu("borderLeftColor"),BN=Tu("outline",_u),NN=Tu("outlineColor"),Nx=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const s=ev(t.theme,"shape.borderRadius",4),c=p=>({borderRadius:tv(s,p)});return mf(t,t.borderRadius,c)}return null};Nx.propTypes={};Nx.filterProps=["borderRadius"];Bx(PN,MN,IN,RN,DN,kN,ON,LN,zN,FN,Nx,BN,NN);const Vx=t=>{if(t.gap!==void 0&&t.gap!==null){const s=ev(t.theme,"spacing",8),c=p=>({gap:tv(s,p)});return mf(t,t.gap,c)}return null};Vx.propTypes={};Vx.filterProps=["gap"];const Ux=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const s=ev(t.theme,"spacing",8),c=p=>({columnGap:tv(s,p)});return mf(t,t.columnGap,c)}return null};Ux.propTypes={};Ux.filterProps=["columnGap"];const jx=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const s=ev(t.theme,"spacing",8),c=p=>({rowGap:tv(s,p)});return mf(t,t.rowGap,c)}return null};jx.propTypes={};jx.filterProps=["rowGap"];const VN=js({prop:"gridColumn"}),UN=js({prop:"gridRow"}),jN=js({prop:"gridAutoFlow"}),GN=js({prop:"gridAutoColumns"}),$N=js({prop:"gridAutoRows"}),HN=js({prop:"gridTemplateColumns"}),qN=js({prop:"gridTemplateRows"}),WN=js({prop:"gridTemplateAreas"}),ZN=js({prop:"gridArea"});Bx(Vx,Ux,jx,VN,UN,jN,GN,$N,HN,qN,WN,ZN);function e_(t,s){return s==="grey"?s:t}const YN=js({prop:"color",themeKey:"palette",transform:e_}),XN=js({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:e_}),KN=js({prop:"backgroundColor",themeKey:"palette",transform:e_});Bx(YN,XN,KN);function Lc(t){return t<=1&&t!==0?`${t*100}%`:t}const JN=js({prop:"width",transform:Lc}),TS=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const s=c=>{const p=t.theme?.breakpoints?.values?.[c]||zx[c];return p?t.theme?.breakpoints?.unit!=="px"?{maxWidth:`${p}${t.theme.breakpoints.unit}`}:{maxWidth:p}:{maxWidth:Lc(c)}};return mf(t,t.maxWidth,s)}return null};TS.filterProps=["maxWidth"];const QN=js({prop:"minWidth",transform:Lc}),e7=js({prop:"height",transform:Lc}),t7=js({prop:"maxHeight",transform:Lc}),n7=js({prop:"minHeight",transform:Lc});js({prop:"size",cssProperty:"width",transform:Lc});js({prop:"size",cssProperty:"height",transform:Lc});const r7=js({prop:"boxSizing"});Bx(JN,TS,QN,e7,t7,n7,r7);const nv={border:{themeKey:"borders",transform:_u},borderTop:{themeKey:"borders",transform:_u},borderRight:{themeKey:"borders",transform:_u},borderBottom:{themeKey:"borders",transform:_u},borderLeft:{themeKey:"borders",transform:_u},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:_u},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:Nx},color:{themeKey:"palette",transform:e_},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:e_},backgroundColor:{themeKey:"palette",transform:e_},p:{style:Cs},pt:{style:Cs},pr:{style:Cs},pb:{style:Cs},pl:{style:Cs},px:{style:Cs},py:{style:Cs},padding:{style:Cs},paddingTop:{style:Cs},paddingRight:{style:Cs},paddingBottom:{style:Cs},paddingLeft:{style:Cs},paddingX:{style:Cs},paddingY:{style:Cs},paddingInline:{style:Cs},paddingInlineStart:{style:Cs},paddingInlineEnd:{style:Cs},paddingBlock:{style:Cs},paddingBlockStart:{style:Cs},paddingBlockEnd:{style:Cs},m:{style:Ts},mt:{style:Ts},mr:{style:Ts},mb:{style:Ts},ml:{style:Ts},mx:{style:Ts},my:{style:Ts},margin:{style:Ts},marginTop:{style:Ts},marginRight:{style:Ts},marginBottom:{style:Ts},marginLeft:{style:Ts},marginX:{style:Ts},marginY:{style:Ts},marginInline:{style:Ts},marginInlineStart:{style:Ts},marginInlineEnd:{style:Ts},marginBlock:{style:Ts},marginBlockStart:{style:Ts},marginBlockEnd:{style:Ts},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:Vx},rowGap:{style:jx},columnGap:{style:Ux},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Lc},maxWidth:{style:TS},minWidth:{transform:Lc},height:{transform:Lc},maxHeight:{transform:Lc},minHeight:{transform:Lc},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function i7(...t){const s=t.reduce((p,g)=>p.concat(Object.keys(g)),[]),c=new Set(s);return t.every(p=>c.size===Object.keys(p).length)}function o7(t,s){return typeof t=="function"?t(s):t}function s7(){function t(c,p,g,v){const S={[c]:p,theme:g},r=v[c];if(!r)return{[c]:p};const{cssProperty:E=c,themeKey:A,transform:I,style:F}=r;if(p==null)return null;if(A==="typography"&&p==="inherit")return{[c]:p};const z=Fx(g,A)||{};return F?F(S):mf(S,p,D=>{let O=ux(z,I,D);return D===O&&typeof D=="string"&&(O=ux(z,I,`${c}${D==="default"?"":ar(D)}`,D)),E===!1?O:{[E]:O}})}function s(c){const{sx:p,theme:g={},nested:v}=c||{};if(!p)return null;const S=g.unstable_sxConfig??nv;function r(E){let A=E;if(typeof E=="function")A=E(g);else if(typeof E!="object")return E;if(!A)return null;const I=bN(g.breakpoints),F=Object.keys(I);let z=I;return Object.keys(A).forEach(R=>{const D=o7(A[R],g);if(D!=null)if(typeof D=="object")if(S[R])z=Ey(z,t(R,D,g,S));else{const O=mf({theme:g},D,N=>({[R]:N}));i7(O,D)?z[R]=s({sx:D,theme:g,nested:!0}):z=Ey(z,O)}else z=Ey(z,t(R,D,g,S))}),!v&&g.modularCssLayers?{"@layer sx":aA(g,cA(F,z))}:aA(g,cA(F,z))}return Array.isArray(p)?p.map(r):r(p)}return s}const l_=s7();l_.filterProps=["sx"];const a7=t=>{const s={systemProps:{},otherProps:{}},c=t?.theme?.unstable_sxConfig??nv;return Object.keys(t).forEach(p=>{c[p]?s.systemProps[p]=t[p]:s.otherProps[p]=t[p]}),s};function l7(t){const{sx:s,...c}=t,{systemProps:p,otherProps:g}=a7(c);let v;return Array.isArray(s)?v=[p,...s]:typeof s=="function"?v=(...S)=>{const r=s(...S);return ch(r)?{...p,...r}:p}:v={...p,...s},{...g,sx:v}}function Nt(){return Nt=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var p in c)({}).hasOwnProperty.call(c,p)&&(t[p]=c[p])}return t},Nt.apply(null,arguments)}function c7(t){if(t.sheet)return t.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===t)return document.styleSheets[s]}function u7(t){var s=document.createElement("style");return s.setAttribute("data-emotion",t.key),t.nonce!==void 0&&s.setAttribute("nonce",t.nonce),s.appendChild(document.createTextNode("")),s.setAttribute("data-s",""),s}var d7=(function(){function t(c){var p=this;this._insertTag=function(g){var v;p.tags.length===0?p.insertionPoint?v=p.insertionPoint.nextSibling:p.prepend?v=p.container.firstChild:v=p.before:v=p.tags[p.tags.length-1].nextSibling,p.container.insertBefore(g,v),p.tags.push(g)},this.isSpeedy=c.speedy===void 0?!0:c.speedy,this.tags=[],this.ctr=0,this.nonce=c.nonce,this.key=c.key,this.container=c.container,this.prepend=c.prepend,this.insertionPoint=c.insertionPoint,this.before=null}var s=t.prototype;return s.hydrate=function(p){p.forEach(this._insertTag)},s.insert=function(p){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(u7(this));var g=this.tags[this.tags.length-1];if(this.isSpeedy){var v=c7(g);try{v.insertRule(p,v.cssRules.length)}catch{}}else g.appendChild(document.createTextNode(p));this.ctr++},s.flush=function(){this.tags.forEach(function(p){var g;return(g=p.parentNode)==null?void 0:g.removeChild(p)}),this.tags=[],this.ctr=0},t})(),nl="-ms-",dx="-moz-",Eo="-webkit-",kI="comm",CS="rule",ES="decl",h7="@import",OI="@keyframes",f7="@layer",p7=Math.abs,Gx=String.fromCharCode,m7=Object.assign;function g7(t,s){return Ba(t,0)^45?(((s<<2^Ba(t,0))<<2^Ba(t,1))<<2^Ba(t,2))<<2^Ba(t,3):0}function LI(t){return t.trim()}function _7(t,s){return(t=s.exec(t))?t[0]:t}function Ao(t,s,c){return t.replace(s,c)}function Lw(t,s){return t.indexOf(s)}function Ba(t,s){return t.charCodeAt(s)|0}function Ly(t,s,c){return t.slice(s,c)}function sh(t){return t.length}function AS(t){return t.length}function m1(t,s){return s.push(t),t}function y7(t,s){return t.map(s).join("")}var $x=1,c_=1,zI=0,uc=0,aa=0,__="";function Hx(t,s,c,p,g,v,S){return{value:t,root:s,parent:c,type:p,props:g,children:v,line:$x,column:c_,length:S,return:""}}function v0(t,s){return m7(Hx("",null,null,"",null,null,0),t,{length:-t.length},s)}function v7(){return aa}function x7(){return aa=uc>0?Ba(__,--uc):0,c_--,aa===10&&(c_=1,$x--),aa}function zc(){return aa=uc<zI?Ba(__,uc++):0,c_++,aa===10&&(c_=1,$x++),aa}function hh(){return Ba(__,uc)}function G1(){return uc}function rv(t,s){return Ly(__,t,s)}function zy(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function FI(t){return $x=c_=1,zI=sh(__=t),uc=0,[]}function BI(t){return __="",t}function $1(t){return LI(rv(uc-1,zw(t===91?t+2:t===40?t+1:t)))}function b7(t){for(;(aa=hh())&&aa<33;)zc();return zy(t)>2||zy(aa)>3?"":" "}function w7(t,s){for(;--s&&zc()&&!(aa<48||aa>102||aa>57&&aa<65||aa>70&&aa<97););return rv(t,G1()+(s<6&&hh()==32&&zc()==32))}function zw(t){for(;zc();)switch(aa){case t:return uc;case 34:case 39:t!==34&&t!==39&&zw(aa);break;case 40:t===41&&zw(t);break;case 92:zc();break}return uc}function S7(t,s){for(;zc()&&t+aa!==57;)if(t+aa===84&&hh()===47)break;return"/*"+rv(s,uc-1)+"*"+Gx(t===47?t:zc())}function T7(t){for(;!zy(hh());)zc();return rv(t,uc)}function C7(t){return BI(H1("",null,null,null,[""],t=FI(t),0,[0],t))}function H1(t,s,c,p,g,v,S,r,E){for(var A=0,I=0,F=S,z=0,R=0,D=0,O=1,N=1,H=1,j=0,V="",Z=g,X=v,se=p,ge=V;N;)switch(D=j,j=zc()){case 40:if(D!=108&&Ba(ge,F-1)==58){Lw(ge+=Ao($1(j),"&","&\f"),"&\f")!=-1&&(H=-1);break}case 34:case 39:case 91:ge+=$1(j);break;case 9:case 10:case 13:case 32:ge+=b7(D);break;case 92:ge+=w7(G1()-1,7);continue;case 47:switch(hh()){case 42:case 47:m1(E7(S7(zc(),G1()),s,c),E);break;default:ge+="/"}break;case 123*O:r[A++]=sh(ge)*H;case 125*O:case 59:case 0:switch(j){case 0:case 125:N=0;case 59+I:H==-1&&(ge=Ao(ge,/\f/g,"")),R>0&&sh(ge)-F&&m1(R>32?hA(ge+";",p,c,F-1):hA(Ao(ge," ","")+";",p,c,F-2),E);break;case 59:ge+=";";default:if(m1(se=dA(ge,s,c,A,I,g,r,V,Z=[],X=[],F),v),j===123)if(I===0)H1(ge,s,se,se,Z,v,F,r,X);else switch(z===99&&Ba(ge,3)===110?100:z){case 100:case 108:case 109:case 115:H1(t,se,se,p&&m1(dA(t,se,se,0,0,g,r,V,g,Z=[],F),X),g,X,F,r,p?Z:X);break;default:H1(ge,se,se,se,[""],X,0,r,X)}}A=I=R=0,O=H=1,V=ge="",F=S;break;case 58:F=1+sh(ge),R=D;default:if(O<1){if(j==123)--O;else if(j==125&&O++==0&&x7()==125)continue}switch(ge+=Gx(j),j*O){case 38:H=I>0?1:(ge+="\f",-1);break;case 44:r[A++]=(sh(ge)-1)*H,H=1;break;case 64:hh()===45&&(ge+=$1(zc())),z=hh(),I=F=sh(V=ge+=T7(G1())),j++;break;case 45:D===45&&sh(ge)==2&&(O=0)}}return v}function dA(t,s,c,p,g,v,S,r,E,A,I){for(var F=g-1,z=g===0?v:[""],R=AS(z),D=0,O=0,N=0;D<p;++D)for(var H=0,j=Ly(t,F+1,F=p7(O=S[D])),V=t;H<R;++H)(V=LI(O>0?z[H]+" "+j:Ao(j,/&\f/g,z[H])))&&(E[N++]=V);return Hx(t,s,c,g===0?CS:r,E,A,I)}function E7(t,s,c){return Hx(t,s,c,kI,Gx(v7()),Ly(t,2,-2),0)}function hA(t,s,c,p){return Hx(t,s,c,ES,Ly(t,0,p),Ly(t,p+1,-1),p)}function t_(t,s){for(var c="",p=AS(t),g=0;g<p;g++)c+=s(t[g],g,t,s)||"";return c}function A7(t,s,c,p){switch(t.type){case f7:if(t.children.length)break;case h7:case ES:return t.return=t.return||t.value;case kI:return"";case OI:return t.return=t.value+"{"+t_(t.children,p)+"}";case CS:t.value=t.props.join(",")}return sh(c=t_(t.children,p))?t.return=t.value+"{"+c+"}":""}function P7(t){var s=AS(t);return function(c,p,g,v){for(var S="",r=0;r<s;r++)S+=t[r](c,p,g,v)||"";return S}}function M7(t){return function(s){s.root||(s=s.return)&&t(s)}}function NI(t){var s=Object.create(null);return function(c){return s[c]===void 0&&(s[c]=t(c)),s[c]}}var I7=function(s,c,p){for(var g=0,v=0;g=v,v=hh(),g===38&&v===12&&(c[p]=1),!zy(v);)zc();return rv(s,uc)},R7=function(s,c){var p=-1,g=44;do switch(zy(g)){case 0:g===38&&hh()===12&&(c[p]=1),s[p]+=I7(uc-1,c,p);break;case 2:s[p]+=$1(g);break;case 4:if(g===44){s[++p]=hh()===58?"&\f":"",c[p]=s[p].length;break}default:s[p]+=Gx(g)}while(g=zc());return s},D7=function(s,c){return BI(R7(FI(s),c))},fA=new WeakMap,k7=function(s){if(!(s.type!=="rule"||!s.parent||s.length<1)){for(var c=s.value,p=s.parent,g=s.column===p.column&&s.line===p.line;p.type!=="rule";)if(p=p.parent,!p)return;if(!(s.props.length===1&&c.charCodeAt(0)!==58&&!fA.get(p))&&!g){fA.set(s,!0);for(var v=[],S=D7(c,v),r=p.props,E=0,A=0;E<S.length;E++)for(var I=0;I<r.length;I++,A++)s.props[A]=v[E]?S[E].replace(/&\f/g,r[I]):r[I]+" "+S[E]}}},O7=function(s){if(s.type==="decl"){var c=s.value;c.charCodeAt(0)===108&&c.charCodeAt(2)===98&&(s.return="",s.value="")}};function VI(t,s){switch(g7(t,s)){case 5103:return Eo+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Eo+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Eo+t+dx+t+nl+t+t;case 6828:case 4268:return Eo+t+nl+t+t;case 6165:return Eo+t+nl+"flex-"+t+t;case 5187:return Eo+t+Ao(t,/(\w+).+(:[^]+)/,Eo+"box-$1$2"+nl+"flex-$1$2")+t;case 5443:return Eo+t+nl+"flex-item-"+Ao(t,/flex-|-self/,"")+t;case 4675:return Eo+t+nl+"flex-line-pack"+Ao(t,/align-content|flex-|-self/,"")+t;case 5548:return Eo+t+nl+Ao(t,"shrink","negative")+t;case 5292:return Eo+t+nl+Ao(t,"basis","preferred-size")+t;case 6060:return Eo+"box-"+Ao(t,"-grow","")+Eo+t+nl+Ao(t,"grow","positive")+t;case 4554:return Eo+Ao(t,/([^-])(transform)/g,"$1"+Eo+"$2")+t;case 6187:return Ao(Ao(Ao(t,/(zoom-|grab)/,Eo+"$1"),/(image-set)/,Eo+"$1"),t,"")+t;case 5495:case 3959:return Ao(t,/(image-set\([^]*)/,Eo+"$1$`$1");case 4968:return Ao(Ao(t,/(.+:)(flex-)?(.*)/,Eo+"box-pack:$3"+nl+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Eo+t+t;case 4095:case 3583:case 4068:case 2532:return Ao(t,/(.+)-inline(.+)/,Eo+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(sh(t)-1-s>6)switch(Ba(t,s+1)){case 109:if(Ba(t,s+4)!==45)break;case 102:return Ao(t,/(.+:)(.+)-([^]+)/,"$1"+Eo+"$2-$3$1"+dx+(Ba(t,s+3)==108?"$3":"$2-$3"))+t;case 115:return~Lw(t,"stretch")?VI(Ao(t,"stretch","fill-available"),s)+t:t}break;case 4949:if(Ba(t,s+1)!==115)break;case 6444:switch(Ba(t,sh(t)-3-(~Lw(t,"!important")&&10))){case 107:return Ao(t,":",":"+Eo)+t;case 101:return Ao(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Eo+(Ba(t,14)===45?"inline-":"")+"box$3$1"+Eo+"$2$3$1"+nl+"$2box$3")+t}break;case 5936:switch(Ba(t,s+11)){case 114:return Eo+t+nl+Ao(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Eo+t+nl+Ao(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Eo+t+nl+Ao(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return Eo+t+nl+t+t}return t}var L7=function(s,c,p,g){if(s.length>-1&&!s.return)switch(s.type){case ES:s.return=VI(s.value,s.length);break;case OI:return t_([v0(s,{value:Ao(s.value,"@","@"+Eo)})],g);case CS:if(s.length)return y7(s.props,function(v){switch(_7(v,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return t_([v0(s,{props:[Ao(v,/:(read-\w+)/,":"+dx+"$1")]})],g);case"::placeholder":return t_([v0(s,{props:[Ao(v,/:(plac\w+)/,":"+Eo+"input-$1")]}),v0(s,{props:[Ao(v,/:(plac\w+)/,":"+dx+"$1")]}),v0(s,{props:[Ao(v,/:(plac\w+)/,nl+"input-$1")]})],g)}return""})}},z7=[L7],F7=function(s){var c=s.key;if(c==="css"){var p=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(p,function(O){var N=O.getAttribute("data-emotion");N.indexOf(" ")!==-1&&(document.head.appendChild(O),O.setAttribute("data-s",""))})}var g=s.stylisPlugins||z7,v={},S,r=[];S=s.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+c+' "]'),function(O){for(var N=O.getAttribute("data-emotion").split(" "),H=1;H<N.length;H++)v[N[H]]=!0;r.push(O)});var E,A=[k7,O7];{var I,F=[A7,M7(function(O){I.insert(O)})],z=P7(A.concat(g,F)),R=function(N){return t_(C7(N),z)};E=function(N,H,j,V){I=j,R(N?N+"{"+H.styles+"}":H.styles),V&&(D.inserted[H.name]=!0)}}var D={key:c,sheet:new d7({key:c,container:S,nonce:s.nonce,speedy:s.speedy,prepend:s.prepend,insertionPoint:s.insertionPoint}),nonce:s.nonce,inserted:v,registered:{},insert:E};return D.sheet.hydrate(r),D},j2={exports:{}},Ro={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pA;function B7(){if(pA)return Ro;pA=1;var t=typeof Symbol=="function"&&Symbol.for,s=t?Symbol.for("react.element"):60103,c=t?Symbol.for("react.portal"):60106,p=t?Symbol.for("react.fragment"):60107,g=t?Symbol.for("react.strict_mode"):60108,v=t?Symbol.for("react.profiler"):60114,S=t?Symbol.for("react.provider"):60109,r=t?Symbol.for("react.context"):60110,E=t?Symbol.for("react.async_mode"):60111,A=t?Symbol.for("react.concurrent_mode"):60111,I=t?Symbol.for("react.forward_ref"):60112,F=t?Symbol.for("react.suspense"):60113,z=t?Symbol.for("react.suspense_list"):60120,R=t?Symbol.for("react.memo"):60115,D=t?Symbol.for("react.lazy"):60116,O=t?Symbol.for("react.block"):60121,N=t?Symbol.for("react.fundamental"):60117,H=t?Symbol.for("react.responder"):60118,j=t?Symbol.for("react.scope"):60119;function V(X){if(typeof X=="object"&&X!==null){var se=X.$$typeof;switch(se){case s:switch(X=X.type,X){case E:case A:case p:case v:case g:case F:return X;default:switch(X=X&&X.$$typeof,X){case r:case I:case D:case R:case S:return X;default:return se}}case c:return se}}}function Z(X){return V(X)===A}return Ro.AsyncMode=E,Ro.ConcurrentMode=A,Ro.ContextConsumer=r,Ro.ContextProvider=S,Ro.Element=s,Ro.ForwardRef=I,Ro.Fragment=p,Ro.Lazy=D,Ro.Memo=R,Ro.Portal=c,Ro.Profiler=v,Ro.StrictMode=g,Ro.Suspense=F,Ro.isAsyncMode=function(X){return Z(X)||V(X)===E},Ro.isConcurrentMode=Z,Ro.isContextConsumer=function(X){return V(X)===r},Ro.isContextProvider=function(X){return V(X)===S},Ro.isElement=function(X){return typeof X=="object"&&X!==null&&X.$$typeof===s},Ro.isForwardRef=function(X){return V(X)===I},Ro.isFragment=function(X){return V(X)===p},Ro.isLazy=function(X){return V(X)===D},Ro.isMemo=function(X){return V(X)===R},Ro.isPortal=function(X){return V(X)===c},Ro.isProfiler=function(X){return V(X)===v},Ro.isStrictMode=function(X){return V(X)===g},Ro.isSuspense=function(X){return V(X)===F},Ro.isValidElementType=function(X){return typeof X=="string"||typeof X=="function"||X===p||X===A||X===v||X===g||X===F||X===z||typeof X=="object"&&X!==null&&(X.$$typeof===D||X.$$typeof===R||X.$$typeof===S||X.$$typeof===r||X.$$typeof===I||X.$$typeof===N||X.$$typeof===H||X.$$typeof===j||X.$$typeof===O)},Ro.typeOf=V,Ro}var mA;function N7(){return mA||(mA=1,j2.exports=B7()),j2.exports}var G2,gA;function V7(){if(gA)return G2;gA=1;var t=N7(),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},c={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},p={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},g={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},v={};v[t.ForwardRef]=p,v[t.Memo]=g;function S(D){return t.isMemo(D)?g:v[D.$$typeof]||s}var r=Object.defineProperty,E=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,I=Object.getOwnPropertyDescriptor,F=Object.getPrototypeOf,z=Object.prototype;function R(D,O,N){if(typeof O!="string"){if(z){var H=F(O);H&&H!==z&&R(D,H,N)}var j=E(O);A&&(j=j.concat(A(O)));for(var V=S(D),Z=S(O),X=0;X<j.length;++X){var se=j[X];if(!c[se]&&!(N&&N[se])&&!(Z&&Z[se])&&!(V&&V[se])){var ge=I(O,se);try{r(D,se,ge)}catch{}}}}return D}return G2=R,G2}V7();var U7=!0;function UI(t,s,c){var p="";return c.split(" ").forEach(function(g){t[g]!==void 0?s.push(t[g]+";"):g&&(p+=g+" ")}),p}var PS=function(s,c,p){var g=s.key+"-"+c.name;(p===!1||U7===!1)&&s.registered[g]===void 0&&(s.registered[g]=c.styles)},MS=function(s,c,p){PS(s,c,p);var g=s.key+"-"+c.name;if(s.inserted[c.name]===void 0){var v=c;do s.insert(c===v?"."+g:"",v,s.sheet,!0),v=v.next;while(v!==void 0)}};function j7(t){for(var s=0,c,p=0,g=t.length;g>=4;++p,g-=4)c=t.charCodeAt(p)&255|(t.charCodeAt(++p)&255)<<8|(t.charCodeAt(++p)&255)<<16|(t.charCodeAt(++p)&255)<<24,c=(c&65535)*1540483477+((c>>>16)*59797<<16),c^=c>>>24,s=(c&65535)*1540483477+((c>>>16)*59797<<16)^(s&65535)*1540483477+((s>>>16)*59797<<16);switch(g){case 3:s^=(t.charCodeAt(p+2)&255)<<16;case 2:s^=(t.charCodeAt(p+1)&255)<<8;case 1:s^=t.charCodeAt(p)&255,s=(s&65535)*1540483477+((s>>>16)*59797<<16)}return s^=s>>>13,s=(s&65535)*1540483477+((s>>>16)*59797<<16),((s^s>>>15)>>>0).toString(36)}var G7={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},$7=/[A-Z]|^ms/g,H7=/_EMO_([^_]+?)_([^]*?)_EMO_/g,jI=function(s){return s.charCodeAt(1)===45},_A=function(s){return s!=null&&typeof s!="boolean"},$2=NI(function(t){return jI(t)?t:t.replace($7,"-$&").toLowerCase()}),yA=function(s,c){switch(s){case"animation":case"animationName":if(typeof c=="string")return c.replace(H7,function(p,g,v){return ah={name:g,styles:v,next:ah},g})}return G7[s]!==1&&!jI(s)&&typeof c=="number"&&c!==0?c+"px":c};function Fy(t,s,c){if(c==null)return"";var p=c;if(p.__emotion_styles!==void 0)return p;switch(typeof c){case"boolean":return"";case"object":{var g=c;if(g.anim===1)return ah={name:g.name,styles:g.styles,next:ah},g.name;var v=c;if(v.styles!==void 0){var S=v.next;if(S!==void 0)for(;S!==void 0;)ah={name:S.name,styles:S.styles,next:ah},S=S.next;var r=v.styles+";";return r}return q7(t,s,c)}case"function":{if(t!==void 0){var E=ah,A=c(t);return ah=E,Fy(t,s,A)}break}}var I=c;if(s==null)return I;var F=s[I];return F!==void 0?F:I}function q7(t,s,c){var p="";if(Array.isArray(c))for(var g=0;g<c.length;g++)p+=Fy(t,s,c[g])+";";else for(var v in c){var S=c[v];if(typeof S!="object"){var r=S;s!=null&&s[r]!==void 0?p+=v+"{"+s[r]+"}":_A(r)&&(p+=$2(v)+":"+yA(v,r)+";")}else if(Array.isArray(S)&&typeof S[0]=="string"&&(s==null||s[S[0]]===void 0))for(var E=0;E<S.length;E++)_A(S[E])&&(p+=$2(v)+":"+yA(v,S[E])+";");else{var A=Fy(t,s,S);switch(v){case"animation":case"animationName":{p+=$2(v)+":"+A+";";break}default:p+=v+"{"+A+"}"}}}return p}var vA=/label:\s*([^\s;{]+)\s*(;|$)/g,ah;function iv(t,s,c){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var p=!0,g="";ah=void 0;var v=t[0];if(v==null||v.raw===void 0)p=!1,g+=Fy(c,s,v);else{var S=v;g+=S[0]}for(var r=1;r<t.length;r++)if(g+=Fy(c,s,t[r]),p){var E=v;g+=E[r]}vA.lastIndex=0;for(var A="",I;(I=vA.exec(g))!==null;)A+="-"+I[1];var F=j7(g)+A;return{name:F,styles:g,next:ah}}var W7=function(s){return s()},GI=rx.useInsertionEffect?rx.useInsertionEffect:!1,$I=GI||W7,xA=GI||Te.useLayoutEffect,HI=Te.createContext(typeof HTMLElement<"u"?F7({key:"css"}):null);HI.Provider;var IS=function(s){return Te.forwardRef(function(c,p){var g=Te.useContext(HI);return s(c,g,p)})},qx=Te.createContext({}),RS={}.hasOwnProperty,Fw="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",Z7=function(s,c){var p={};for(var g in c)RS.call(c,g)&&(p[g]=c[g]);return p[Fw]=s,p},Y7=function(s){var c=s.cache,p=s.serialized,g=s.isStringTag;return PS(c,p,g),$I(function(){return MS(c,p,g)}),null},X7=IS(function(t,s,c){var p=t.css;typeof p=="string"&&s.registered[p]!==void 0&&(p=s.registered[p]);var g=t[Fw],v=[p],S="";typeof t.className=="string"?S=UI(s.registered,v,t.className):t.className!=null&&(S=t.className+" ");var r=iv(v,void 0,Te.useContext(qx));S+=s.key+"-"+r.name;var E={};for(var A in t)RS.call(t,A)&&A!=="css"&&A!==Fw&&(E[A]=t[A]);return E.className=S,c&&(E.ref=c),Te.createElement(Te.Fragment,null,Te.createElement(Y7,{cache:s,serialized:r,isStringTag:typeof g=="string"}),Te.createElement(g,E))}),K7=X7,bA=function(s,c){var p=arguments;if(c==null||!RS.call(c,"css"))return Te.createElement.apply(void 0,p);var g=p.length,v=new Array(g);v[0]=K7,v[1]=Z7(s,c);for(var S=2;S<g;S++)v[S]=p[S];return Te.createElement.apply(null,v)};(function(t){var s;s||(s=t.JSX||(t.JSX={}))})(bA||(bA={}));var J7=IS(function(t,s){var c=t.styles,p=iv([c],void 0,Te.useContext(qx)),g=Te.useRef();return xA(function(){var v=s.key+"-global",S=new s.sheet.constructor({key:v,nonce:s.sheet.nonce,container:s.sheet.container,speedy:s.sheet.isSpeedy}),r=!1,E=document.querySelector('style[data-emotion="'+v+" "+p.name+'"]');return s.sheet.tags.length&&(S.before=s.sheet.tags[0]),E!==null&&(r=!0,E.setAttribute("data-emotion",v),S.hydrate([E])),g.current=[S,r],function(){S.flush()}},[s]),xA(function(){var v=g.current,S=v[0],r=v[1];if(r){v[1]=!1;return}if(p.next!==void 0&&MS(s,p.next,!0),S.tags.length){var E=S.tags[S.tags.length-1].nextElementSibling;S.before=E,S.flush()}s.insert("",p,S,!1)},[s,p.name]),null});function DS(){for(var t=arguments.length,s=new Array(t),c=0;c<t;c++)s[c]=arguments[c];return iv(s)}function ov(){var t=DS.apply(void 0,arguments),s="animation-"+t.name;return{name:s,styles:"@keyframes "+s+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}var Q7=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|popover|popoverTarget|popoverTargetAction|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,e9=NI(function(t){return Q7.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),t9=e9,n9=function(s){return s!=="theme"},wA=function(s){return typeof s=="string"&&s.charCodeAt(0)>96?t9:n9},SA=function(s,c,p){var g;if(c){var v=c.shouldForwardProp;g=s.__emotion_forwardProp&&v?function(S){return s.__emotion_forwardProp(S)&&v(S)}:v}return typeof g!="function"&&p&&(g=s.__emotion_forwardProp),g},r9=function(s){var c=s.cache,p=s.serialized,g=s.isStringTag;return PS(c,p,g),$I(function(){return MS(c,p,g)}),null},i9=function t(s,c){var p=s.__emotion_real===s,g=p&&s.__emotion_base||s,v,S;c!==void 0&&(v=c.label,S=c.target);var r=SA(s,c,p),E=r||wA(g),A=!E("as");return function(){var I=arguments,F=p&&s.__emotion_styles!==void 0?s.__emotion_styles.slice(0):[];if(v!==void 0&&F.push("label:"+v+";"),I[0]==null||I[0].raw===void 0)F.push.apply(F,I);else{var z=I[0];F.push(z[0]);for(var R=I.length,D=1;D<R;D++)F.push(I[D],z[D])}var O=IS(function(N,H,j){var V=A&&N.as||g,Z="",X=[],se=N;if(N.theme==null){se={};for(var ge in N)se[ge]=N[ge];se.theme=Te.useContext(qx)}typeof N.className=="string"?Z=UI(H.registered,X,N.className):N.className!=null&&(Z=N.className+" ");var ae=iv(F.concat(X),H.registered,se);Z+=H.key+"-"+ae.name,S!==void 0&&(Z+=" "+S);var oe=A&&r===void 0?wA(V):E,fe={};for(var pe in N)A&&pe==="as"||oe(pe)&&(fe[pe]=N[pe]);return fe.className=Z,j&&(fe.ref=j),Te.createElement(Te.Fragment,null,Te.createElement(r9,{cache:H,serialized:ae,isStringTag:typeof V=="string"}),Te.createElement(V,fe))});return O.displayName=v!==void 0?v:"Styled("+(typeof g=="string"?g:g.displayName||g.name||"Component")+")",O.defaultProps=s.defaultProps,O.__emotion_real=O,O.__emotion_base=g,O.__emotion_styles=F,O.__emotion_forwardProp=r,Object.defineProperty(O,"toString",{value:function(){return"."+S}}),O.withComponent=function(N,H){var j=t(N,Nt({},c,H,{shouldForwardProp:SA(O,H,!0)}));return j.apply(void 0,F)},O}},o9=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Bw=i9.bind(null);o9.forEach(function(t){Bw[t]=Bw(t)});function s9(t){return t==null||Object.keys(t).length===0}function a9(t){const{styles:s,defaultTheme:c={}}=t,p=typeof s=="function"?g=>s(s9(g)?c:g):s;return ue.jsx(J7,{styles:p})}function l9(t,s){return Bw(t,s)}function c9(t,s){Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=s(t.__emotion_styles))}const TA=[];function Op(t){return TA[0]=t,iv(TA)}const u9=t=>{const s=Object.keys(t).map(c=>({key:c,val:t[c]}))||[];return s.sort((c,p)=>c.val-p.val),s.reduce((c,p)=>({...c,[p.key]:p.val}),{})};function d9(t){const{values:s={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:c="px",step:p=5,...g}=t,v=u9(s),S=Object.keys(v);function r(z){return`@media (min-width:${typeof s[z]=="number"?s[z]:z}${c})`}function E(z){return`@media (max-width:${(typeof s[z]=="number"?s[z]:z)-p/100}${c})`}function A(z,R){const D=S.indexOf(R);return`@media (min-width:${typeof s[z]=="number"?s[z]:z}${c}) and (max-width:${(D!==-1&&typeof s[S[D]]=="number"?s[S[D]]:R)-p/100}${c})`}function I(z){return S.indexOf(z)+1<S.length?A(z,S[S.indexOf(z)+1]):r(z)}function F(z){const R=S.indexOf(z);return R===0?r(S[1]):R===S.length-1?E(S[R]):A(z,S[S.indexOf(z)+1]).replace("@media","@media not all and")}return{keys:S,values:v,up:r,down:E,between:A,only:I,not:F,unit:c,...g}}const h9={borderRadius:4};function qI(t=8,s=SS({spacing:t})){if(t.mui)return t;const c=(...p)=>(p.length===0?[1]:p).map(v=>{const S=s(v);return typeof S=="number"?`${S}px`:S}).join(" ");return c.mui=!0,c}function f9(t,s){const c=this;if(c.vars){if(!c.colorSchemes?.[t]||typeof c.getColorSchemeSelector!="function")return{};let p=c.getColorSchemeSelector(t);return p==="&"?s:((p.includes("data-")||p.includes("."))&&(p=`*:where(${p.replace(/\s*&$/,"")}) &`),{[p]:s})}return c.palette.mode===t?s:{}}function kS(t={},...s){const{breakpoints:c={},palette:p={},spacing:g,shape:v={},...S}=t,r=d9(c),E=qI(g);let A=sl({breakpoints:r,direction:"ltr",components:{},palette:{mode:"light",...p},spacing:E,shape:{...h9,...v}},S);return A=vN(A),A.applyStyles=f9,A=s.reduce((I,F)=>sl(I,F),A),A.unstable_sxConfig={...nv,...S?.unstable_sxConfig},A.unstable_sx=function(F){return l_({sx:F,theme:this})},A}function p9(t){return Object.keys(t).length===0}function WI(t=null){const s=Te.useContext(qx);return!s||p9(s)?t:s}const m9=kS();function OS(t=m9){return WI(t)}function H2(t){const s=Op(t);return t!==s&&s.styles?(s.styles.match(/^@layer\s+[^{]*$/)||(s.styles=`@layer global{${s.styles}}`),s):t}function g9({styles:t,themeId:s,defaultTheme:c={}}){const p=OS(c),g=s&&p[s]||p;let v=typeof t=="function"?t(g):t;return g.modularCssLayers&&(Array.isArray(v)?v=v.map(S=>H2(typeof S=="function"?S(g):S)):v=H2(v)),ue.jsx(a9,{styles:v})}const CA=t=>t,_9=()=>{let t=CA;return{configure(s){t=s},generate(s){return t(s)},reset(){t=CA}}},y9=_9(),v9={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function ui(t,s,c="Mui"){const p=v9[s];return p?`${c}-${p}`:`${y9.generate(t)}-${s}`}function oi(t,s,c="Mui"){const p={};return s.forEach(g=>{p[g]=ui(t,g,c)}),p}function ZI(t){const{variants:s,...c}=t,p={variants:s,style:Op(c),isProcessed:!0};return p.style===c||s&&s.forEach(g=>{typeof g.style!="function"&&(g.style=Op(g.style))}),p}const x9=kS();function fh(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function Gm(t,s){return s&&t&&typeof t=="object"&&t.styles&&!t.styles.startsWith("@layer")&&(t.styles=`@layer ${s}{${String(t.styles)}}`),t}function b9(t){return t?(s,c)=>c[t]:null}function w9(t,s,c){t.theme=C9(t.theme)?c:t.theme[s]||t.theme}function q1(t,s,c){const p=typeof s=="function"?s(t):s;if(Array.isArray(p))return p.flatMap(g=>q1(t,g,c));if(Array.isArray(p?.variants)){let g;if(p.isProcessed)g=c?Gm(p.style,c):p.style;else{const{variants:v,...S}=p;g=c?Gm(Op(S),c):S}return YI(t,p.variants,[g],c)}return p?.isProcessed?c?Gm(Op(p.style),c):p.style:c?Gm(Op(p),c):p}function YI(t,s,c=[],p=void 0){let g;e:for(let v=0;v<s.length;v+=1){const S=s[v];if(typeof S.props=="function"){if(g??={...t,...t.ownerState,ownerState:t.ownerState},!S.props(g))continue}else for(const r in S.props)if(t[r]!==S.props[r]&&t.ownerState?.[r]!==S.props[r])continue e;typeof S.style=="function"?(g??={...t,...t.ownerState,ownerState:t.ownerState},c.push(p?Gm(Op(S.style(g)),p):S.style(g))):c.push(p?Gm(Op(S.style),p):S.style)}return c}function S9(t={}){const{themeId:s,defaultTheme:c=x9,rootShouldForwardProp:p=fh,slotShouldForwardProp:g=fh}=t;function v(r){w9(r,s,c)}return(r,E={})=>{c9(r,se=>se.filter(ge=>ge!==l_));const{name:A,slot:I,skipVariantsResolver:F,skipSx:z,overridesResolver:R=b9(A9(I)),...D}=E,O=A&&A.startsWith("Mui")||I?"components":"custom",N=F!==void 0?F:I&&I!=="Root"&&I!=="root"||!1,H=z||!1;let j=fh;I==="Root"||I==="root"?j=p:I?j=g:E9(r)&&(j=void 0);const V=l9(r,{shouldForwardProp:j,label:T9(),...D}),Z=se=>{if(se.__emotion_real===se)return se;if(typeof se=="function")return function(ae){return q1(ae,se,ae.theme.modularCssLayers?O:void 0)};if(ch(se)){const ge=ZI(se);return function(oe){return ge.variants?q1(oe,ge,oe.theme.modularCssLayers?O:void 0):oe.theme.modularCssLayers?Gm(ge.style,O):ge.style}}return se},X=(...se)=>{const ge=[],ae=se.map(Z),oe=[];if(ge.push(v),A&&R&&oe.push(function(ye){const de=ye.theme.components?.[A]?.styleOverrides;if(!de)return null;const Ae={};for(const ne in de)Ae[ne]=q1(ye,de[ne],ye.theme.modularCssLayers?"theme":void 0);return R(ye,Ae)}),A&&!N&&oe.push(function(ye){const de=ye.theme?.components?.[A]?.variants;return de?YI(ye,de,[],ye.theme.modularCssLayers?"theme":void 0):null}),H||oe.push(l_),Array.isArray(ae[0])){const K=ae.shift(),ye=new Array(ge.length).fill(""),J=new Array(oe.length).fill("");let de;de=[...ye,...K,...J],de.raw=[...ye,...K.raw,...J],ge.unshift(de)}const fe=[...ge,...ae,...oe],pe=V(...fe);return r.muiName&&(pe.muiName=r.muiName),pe};return V.withConfig&&(X.withConfig=V.withConfig),X}}function T9(t,s){return void 0}function C9(t){for(const s in t)return!1;return!0}function E9(t){return typeof t=="string"&&t.charCodeAt(0)>96}function A9(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function By(t,s,c=!1){const p={...s};for(const g in t)if(Object.prototype.hasOwnProperty.call(t,g)){const v=g;if(v==="components"||v==="slots")p[v]={...t[v],...p[v]};else if(v==="componentsProps"||v==="slotProps"){const S=t[v],r=s[v];if(!r)p[v]=S||{};else if(!S)p[v]=r;else{p[v]={...r};for(const E in S)if(Object.prototype.hasOwnProperty.call(S,E)){const A=E;p[v][A]=By(S[A],r[A],c)}}}else v==="className"&&c&&s.className?p.className=Ar(t?.className,s?.className):v==="style"&&c&&s.style?p.style={...t?.style,...s?.style}:p[v]===void 0&&(p[v]=t[v])}return p}function XI(t){const{theme:s,name:c,props:p}=t;return!s||!s.components||!s.components[c]||!s.components[c].defaultProps?p:By(s.components[c].defaultProps,p)}function P9({props:t,name:s,defaultTheme:c,themeId:p}){let g=OS(c);return g=g[p]||g,XI({theme:g,name:s,props:t})}function M9(t,s,c,p,g){const[v,S]=Te.useState(()=>g&&c?c(t).matches:p?p(t).matches:s);return la(()=>{if(!c)return;const r=c(t),E=()=>{S(r.matches)};return E(),r.addEventListener("change",E),()=>{r.removeEventListener("change",E)}},[t,c]),v}const I9={...rx},KI=I9.useSyncExternalStore;function R9(t,s,c,p,g){const v=Te.useCallback(()=>s,[s]),S=Te.useMemo(()=>{if(g&&c)return()=>c(t).matches;if(p!==null){const{matches:I}=p(t);return()=>I}return v},[v,t,p,g,c]),[r,E]=Te.useMemo(()=>{if(c===null)return[v,()=>()=>{}];const I=c(t);return[()=>I.matches,F=>(I.addEventListener("change",F),()=>{I.removeEventListener("change",F)})]},[v,c,t]);return KI(E,r,S)}function JI(t={}){const{themeId:s}=t;return function(p,g={}){let v=WI();v&&s&&(v=v[s]||v);const S=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:r=!1,matchMedia:E=S?window.matchMedia:null,ssrMatchMedia:A=null,noSsr:I=!1}=XI({name:"MuiUseMediaQuery",props:g,theme:v});let F=typeof p=="function"?p(v):p;return F=F.replace(/^@media( ?)/m,""),F.includes("print")&&console.warn(["MUI: You have provided a `print` query to the `useMediaQuery` hook.","Using the print media query to modify print styles can lead to unexpected results.","Consider using the `displayPrint` field in the `sx` prop instead.","More information about `displayPrint` on our docs: https://mui.com/system/display/#display-in-print."].join(`
`)),(KI!==void 0?R9:M9)(F,r,E,A,I)}}JI();function LS(t,s=0,c=1){return Zg(t,s,c)}function D9(t){t=t.slice(1);const s=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let c=t.match(s);return c&&c[0].length===1&&(c=c.map(p=>p+p)),c?`rgb${c.length===4?"a":""}(${c.map((p,g)=>g<3?parseInt(p,16):Math.round(parseInt(p,16)/255*1e3)/1e3).join(", ")})`:""}function zp(t){if(t.type)return t;if(t.charAt(0)==="#")return zp(D9(t));const s=t.indexOf("("),c=t.substring(0,s);if(!["rgb","rgba","hsl","hsla","color"].includes(c))throw new Error(pf(9,t));let p=t.substring(s+1,t.length-1),g;if(c==="color"){if(p=p.split(" "),g=p.shift(),p.length===4&&p[3].charAt(0)==="/"&&(p[3]=p[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(g))throw new Error(pf(10,g))}else p=p.split(",");return p=p.map(v=>parseFloat(v)),{type:c,values:p,colorSpace:g}}const k9=t=>{const s=zp(t);return s.values.slice(0,3).map((c,p)=>s.type.includes("hsl")&&p!==0?`${c}%`:c).join(" ")},xy=(t,s)=>{try{return k9(t)}catch{return t}};function Wx(t){const{type:s,colorSpace:c}=t;let{values:p}=t;return s.includes("rgb")?p=p.map((g,v)=>v<3?parseInt(g,10):g):s.includes("hsl")&&(p[1]=`${p[1]}%`,p[2]=`${p[2]}%`),s.includes("color")?p=`${c} ${p.join(" ")}`:p=`${p.join(", ")}`,`${s}(${p})`}function QI(t){t=zp(t);const{values:s}=t,c=s[0],p=s[1]/100,g=s[2]/100,v=p*Math.min(g,1-g),S=(A,I=(A+c/30)%12)=>g-v*Math.max(Math.min(I-3,9-I,1),-1);let r="rgb";const E=[Math.round(S(0)*255),Math.round(S(8)*255),Math.round(S(4)*255)];return t.type==="hsla"&&(r+="a",E.push(s[3])),Wx({type:r,values:E})}function Nw(t){t=zp(t);let s=t.type==="hsl"||t.type==="hsla"?zp(QI(t)).values:t.values;return s=s.map(c=>(t.type!=="color"&&(c/=255),c<=.03928?c/12.92:((c+.055)/1.055)**2.4)),Number((.2126*s[0]+.7152*s[1]+.0722*s[2]).toFixed(3))}function O9(t,s){const c=Nw(t),p=Nw(s);return(Math.max(c,p)+.05)/(Math.min(c,p)+.05)}function gh(t,s){return t=zp(t),s=LS(s),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${s}`:t.values[3]=s,Wx(t)}function Im(t,s,c){try{return gh(t,s)}catch{return t}}function Zx(t,s){if(t=zp(t),s=LS(s),t.type.includes("hsl"))t.values[2]*=1-s;else if(t.type.includes("rgb")||t.type.includes("color"))for(let c=0;c<3;c+=1)t.values[c]*=1-s;return Wx(t)}function Vo(t,s,c){try{return Zx(t,s)}catch{return t}}function Yx(t,s){if(t=zp(t),s=LS(s),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*s;else if(t.type.includes("rgb"))for(let c=0;c<3;c+=1)t.values[c]+=(255-t.values[c])*s;else if(t.type.includes("color"))for(let c=0;c<3;c+=1)t.values[c]+=(1-t.values[c])*s;return Wx(t)}function Uo(t,s,c){try{return Yx(t,s)}catch{return t}}function L9(t,s=.15){return Nw(t)>.5?Zx(t,s):Yx(t,s)}function g1(t,s,c){try{return L9(t,s)}catch{return t}}const z9=Te.createContext(void 0);function F9(t){const{theme:s,name:c,props:p}=t;if(!s||!s.components||!s.components[c])return p;const g=s.components[c];return g.defaultProps?By(g.defaultProps,p,s.components.mergeClassNameAndStyle):!g.styleOverrides&&!g.variants?By(g,p,s.components.mergeClassNameAndStyle):p}function B9({props:t,name:s}){const c=Te.useContext(z9);return F9({props:t,name:s,theme:{components:c}})}let EA=0;function N9(t){const[s,c]=Te.useState(t),p=t||s;return Te.useEffect(()=>{s==null&&(EA+=1,c(`mui-${EA}`))},[s]),p}const V9={...rx},AA=V9.useId;function Np(t){if(AA!==void 0){const s=AA();return t??s}return N9(t)}const PA={theme:void 0};function U9(t){let s,c;return function(g){let v=s;return(v===void 0||g.theme!==c)&&(PA.theme=g.theme,v=ZI(t(PA)),s=v,c=g.theme),v}}function j9(t=""){function s(...p){if(!p.length)return"";const g=p[0];return typeof g=="string"&&!g.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${g}${s(...p.slice(1))})`:`, ${g}`}return(p,...g)=>`var(--${t?`${t}-`:""}${p}${s(...g)})`}const MA=(t,s,c,p=[])=>{let g=t;s.forEach((v,S)=>{S===s.length-1?Array.isArray(g)?g[Number(v)]=c:g&&typeof g=="object"&&(g[v]=c):g&&typeof g=="object"&&(g[v]||(g[v]=p.includes(v)?[]:{}),g=g[v])})},G9=(t,s,c)=>{function p(g,v=[],S=[]){Object.entries(g).forEach(([r,E])=>{(!c||c&&!c([...v,r]))&&E!=null&&(typeof E=="object"&&Object.keys(E).length>0?p(E,[...v,r],Array.isArray(E)?[...S,r]:S):s([...v,r],E,S))})}p(t)},$9=(t,s)=>typeof s=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(p=>t.includes(p))||t[t.length-1].toLowerCase().includes("opacity")?s:`${s}px`:s;function q2(t,s){const{prefix:c,shouldSkipGeneratingVar:p}=s||{},g={},v={},S={};return G9(t,(r,E,A)=>{if((typeof E=="string"||typeof E=="number")&&(!p||!p(r,E))){const I=`--${c?`${c}-`:""}${r.join("-")}`,F=$9(r,E);Object.assign(g,{[I]:F}),MA(v,r,`var(${I})`,A),MA(S,r,`var(${I}, ${F})`,A)}},r=>r[0]==="vars"),{css:g,vars:v,varsWithDefaults:S}}function H9(t,s={}){const{getSelector:c=H,disableCssColorScheme:p,colorSchemeSelector:g,enableContrastVars:v}=s,{colorSchemes:S={},components:r,defaultColorScheme:E="light",...A}=t,{vars:I,css:F,varsWithDefaults:z}=q2(A,s);let R=z;const D={},{[E]:O,...N}=S;if(Object.entries(N||{}).forEach(([Z,X])=>{const{vars:se,css:ge,varsWithDefaults:ae}=q2(X,s);R=sl(R,ae),D[Z]={css:ge,vars:se}}),O){const{css:Z,vars:X,varsWithDefaults:se}=q2(O,s);R=sl(R,se),D[E]={css:Z,vars:X}}function H(Z,X){let se=g;if(g==="class"&&(se=".%s"),g==="data"&&(se="[data-%s]"),g?.startsWith("data-")&&!g.includes("%s")&&(se=`[${g}="%s"]`),Z){if(se==="media")return t.defaultColorScheme===Z?":root":{[`@media (prefers-color-scheme: ${S[Z]?.palette?.mode||Z})`]:{":root":X}};if(se)return t.defaultColorScheme===Z?`:root, ${se.replace("%s",String(Z))}`:se.replace("%s",String(Z))}return":root"}return{vars:R,generateThemeVars:()=>{let Z={...I};return Object.entries(D).forEach(([,{vars:X}])=>{Z=sl(Z,X)}),Z},generateStyleSheets:()=>{const Z=[],X=t.defaultColorScheme||"light";function se(oe,fe){Object.keys(fe).length&&Z.push(typeof oe=="string"?{[oe]:{...fe}}:oe)}se(c(void 0,{...F}),F);const{[X]:ge,...ae}=D;if(ge){const{css:oe}=ge,fe=S[X]?.palette?.mode,pe=!p&&fe?{colorScheme:fe,...oe}:{...oe};se(c(X,{...pe}),pe)}return Object.entries(ae).forEach(([oe,{css:fe}])=>{const pe=S[oe]?.palette?.mode,K=!p&&pe?{colorScheme:pe,...fe}:{...fe};se(c(oe,{...K}),K)}),v&&Z.push({":root":{"--__l-threshold":"0.7","--__l":"clamp(0, (l / var(--__l-threshold) - 1) * -infinity, 1)","--__a":"clamp(0.87, (l / var(--__l-threshold) - 1) * -infinity, 1)"}}),Z}}}function q9(t){return function(c){return t==="media"?`@media (prefers-color-scheme: ${c})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${c}"] &`:t==="class"?`.${c} &`:t==="data"?`[data-${c}] &`:`${t.replace("%s",c)} &`:"&"}}function W1(t,s){return Te.isValidElement(t)&&s.indexOf(t.type.muiName??t.type?._payload?.value?.muiName)!==-1}const Ny={black:"#000",white:"#fff"},W9={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Vg={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},Ug={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},x0={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},jg={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},Gg={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},$g={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"};function eR(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Ny.white,default:Ny.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const tR=eR();function nR(){return{text:{primary:Ny.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Ny.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const Vw=nR();function IA(t,s,c,p){const g=p.light||p,v=p.dark||p*1.5;t[s]||(t.hasOwnProperty(c)?t[s]=t[c]:s==="light"?t.light=Yx(t.main,g):s==="dark"&&(t.dark=Zx(t.main,v)))}function RA(t,s,c,p,g){const v=g.light||g,S=g.dark||g*1.5;s[c]||(s.hasOwnProperty(p)?s[c]=s[p]:c==="light"?s.light=`color-mix(in ${t}, ${s.main}, #fff ${(v*100).toFixed(0)}%)`:c==="dark"&&(s.dark=`color-mix(in ${t}, ${s.main}, #000 ${(S*100).toFixed(0)}%)`))}function Z9(t="light"){return t==="dark"?{main:jg[200],light:jg[50],dark:jg[400]}:{main:jg[700],light:jg[400],dark:jg[800]}}function Y9(t="light"){return t==="dark"?{main:Vg[200],light:Vg[50],dark:Vg[400]}:{main:Vg[500],light:Vg[300],dark:Vg[700]}}function X9(t="light"){return t==="dark"?{main:Ug[500],light:Ug[300],dark:Ug[700]}:{main:Ug[700],light:Ug[400],dark:Ug[800]}}function K9(t="light"){return t==="dark"?{main:Gg[400],light:Gg[300],dark:Gg[700]}:{main:Gg[700],light:Gg[500],dark:Gg[900]}}function J9(t="light"){return t==="dark"?{main:$g[400],light:$g[300],dark:$g[700]}:{main:$g[800],light:$g[500],dark:$g[900]}}function Q9(t="light"){return t==="dark"?{main:x0[400],light:x0[300],dark:x0[700]}:{main:"#ed6c02",light:x0[500],dark:x0[900]}}function eV(t){return`oklch(from ${t} var(--__l) 0 h / var(--__a))`}function zS(t){const{mode:s="light",contrastThreshold:c=3,tonalOffset:p=.2,colorSpace:g,...v}=t,S=t.primary||Z9(s),r=t.secondary||Y9(s),E=t.error||X9(s),A=t.info||K9(s),I=t.success||J9(s),F=t.warning||Q9(s);function z(N){return g?eV(N):O9(N,Vw.text.primary)>=c?Vw.text.primary:tR.text.primary}const R=({color:N,name:H,mainShade:j=500,lightShade:V=300,darkShade:Z=700})=>{if(N={...N},!N.main&&N[j]&&(N.main=N[j]),!N.hasOwnProperty("main"))throw new Error(pf(11,H?` (${H})`:"",j));if(typeof N.main!="string")throw new Error(pf(12,H?` (${H})`:"",JSON.stringify(N.main)));return g?(RA(g,N,"light",V,p),RA(g,N,"dark",Z,p)):(IA(N,"light",V,p),IA(N,"dark",Z,p)),N.contrastText||(N.contrastText=z(N.main)),N};let D;return s==="light"?D=eR():s==="dark"&&(D=nR()),sl({common:{...Ny},mode:s,primary:R({color:S,name:"primary"}),secondary:R({color:r,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:R({color:E,name:"error"}),warning:R({color:F,name:"warning"}),info:R({color:A,name:"info"}),success:R({color:I,name:"success"}),grey:W9,contrastThreshold:c,getContrastText:z,augmentColor:R,tonalOffset:p,...D},v)}function tV(t){const s={};return Object.entries(t).forEach(p=>{const[g,v]=p;typeof v=="object"&&(s[g]=`${v.fontStyle?`${v.fontStyle} `:""}${v.fontVariant?`${v.fontVariant} `:""}${v.fontWeight?`${v.fontWeight} `:""}${v.fontStretch?`${v.fontStretch} `:""}${v.fontSize||""}${v.lineHeight?`/${v.lineHeight} `:""}${v.fontFamily||""}`)}),s}function nV(t,s){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...s}}function rV(t){return Math.round(t*1e5)/1e5}const DA={textTransform:"uppercase"},kA='"Roboto", "Helvetica", "Arial", sans-serif';function iV(t,s){const{fontFamily:c=kA,fontSize:p=14,fontWeightLight:g=300,fontWeightRegular:v=400,fontWeightMedium:S=500,fontWeightBold:r=700,htmlFontSize:E=16,allVariants:A,pxToRem:I,...F}=typeof s=="function"?s(t):s,z=p/14,R=I||(N=>`${N/E*z}rem`),D=(N,H,j,V,Z)=>({fontFamily:c,fontWeight:N,fontSize:R(H),lineHeight:j,...c===kA?{letterSpacing:`${rV(V/H)}em`}:{},...Z,...A}),O={h1:D(g,96,1.167,-1.5),h2:D(g,60,1.2,-.5),h3:D(v,48,1.167,0),h4:D(v,34,1.235,.25),h5:D(v,24,1.334,0),h6:D(S,20,1.6,.15),subtitle1:D(v,16,1.75,.15),subtitle2:D(S,14,1.57,.1),body1:D(v,16,1.5,.15),body2:D(v,14,1.43,.15),button:D(S,14,1.75,.4,DA),caption:D(v,12,1.66,.4),overline:D(v,12,2.66,1,DA),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return sl({htmlFontSize:E,pxToRem:R,fontFamily:c,fontSize:p,fontWeightLight:g,fontWeightRegular:v,fontWeightMedium:S,fontWeightBold:r,...O},F,{clone:!1})}const oV=.2,sV=.14,aV=.12;function cs(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${oV})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${sV})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${aV})`].join(",")}const lV=["none",cs(0,2,1,-1,0,1,1,0,0,1,3,0),cs(0,3,1,-2,0,2,2,0,0,1,5,0),cs(0,3,3,-2,0,3,4,0,0,1,8,0),cs(0,2,4,-1,0,4,5,0,0,1,10,0),cs(0,3,5,-1,0,5,8,0,0,1,14,0),cs(0,3,5,-1,0,6,10,0,0,1,18,0),cs(0,4,5,-2,0,7,10,1,0,2,16,1),cs(0,5,5,-3,0,8,10,1,0,3,14,2),cs(0,5,6,-3,0,9,12,1,0,3,16,2),cs(0,6,6,-3,0,10,14,1,0,4,18,3),cs(0,6,7,-4,0,11,15,1,0,4,20,3),cs(0,7,8,-4,0,12,17,2,0,5,22,4),cs(0,7,8,-4,0,13,19,2,0,5,24,4),cs(0,7,9,-4,0,14,21,2,0,5,26,4),cs(0,8,9,-5,0,15,22,2,0,6,28,5),cs(0,8,10,-5,0,16,24,2,0,6,30,5),cs(0,8,11,-5,0,17,26,2,0,6,32,5),cs(0,9,11,-5,0,18,28,2,0,7,34,6),cs(0,9,12,-6,0,19,29,2,0,7,36,6),cs(0,10,13,-6,0,20,31,3,0,8,38,7),cs(0,10,13,-6,0,21,33,3,0,8,40,7),cs(0,10,14,-6,0,22,35,3,0,8,42,7),cs(0,11,14,-7,0,23,36,3,0,9,44,8),cs(0,11,15,-7,0,24,38,3,0,9,46,8)],cV={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},uV={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function OA(t){return`${Math.round(t)}ms`}function dV(t){if(!t)return 0;const s=t/36;return Math.min(Math.round((4+15*s**.25+s/5)*10),3e3)}function hV(t){const s={...cV,...t.easing},c={...uV,...t.duration};return{getAutoHeightDuration:dV,create:(g=["all"],v={})=>{const{duration:S=c.standard,easing:r=s.easeInOut,delay:E=0,...A}=v;return(Array.isArray(g)?g:[g]).map(I=>`${I} ${typeof S=="string"?S:OA(S)} ${r} ${typeof E=="string"?E:OA(E)}`).join(",")},...t,easing:s,duration:c}}const fV={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function pV(t){return ch(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function rR(t={}){const s={...t};function c(p){const g=Object.entries(p);for(let v=0;v<g.length;v++){const[S,r]=g[v];!pV(r)||S.startsWith("unstable_")?delete p[S]:ch(r)&&(p[S]={...r},c(p[S]))}}return c(s),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(s,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function LA(t){return typeof t=="number"?`${(t*100).toFixed(0)}%`:`calc((${t}) * 100%)`}const mV=t=>{if(!Number.isNaN(+t))return+t;const s=t.match(/\d*\.?\d+/g);if(!s)return 0;let c=0;for(let p=0;p<s.length;p+=1)c+=+s[p];return c};function gV(t){Object.assign(t,{alpha(s,c){const p=this||t;return p.colorSpace?`oklch(from ${s} l c h / ${typeof c=="string"?`calc(${c})`:c})`:p.vars?`rgba(${s.replace(/var\(--([^,\s)]+)(?:,[^)]+)?\)+/g,"var(--$1Channel)")} / ${typeof c=="string"?`calc(${c})`:c})`:gh(s,mV(c))},lighten(s,c){const p=this||t;return p.colorSpace?`color-mix(in ${p.colorSpace}, ${s}, #fff ${LA(c)})`:Yx(s,c)},darken(s,c){const p=this||t;return p.colorSpace?`color-mix(in ${p.colorSpace}, ${s}, #000 ${LA(c)})`:Zx(s,c)}})}function Uw(t={},...s){const{breakpoints:c,mixins:p={},spacing:g,palette:v={},transitions:S={},typography:r={},shape:E,colorSpace:A,...I}=t;if(t.vars&&t.generateThemeVars===void 0)throw new Error(pf(20));const F=zS({...v,colorSpace:A}),z=kS(t);let R=sl(z,{mixins:nV(z.breakpoints,p),palette:F,shadows:lV.slice(),typography:iV(F,r),transitions:hV(S),zIndex:{...fV}});return R=sl(R,I),R=s.reduce((D,O)=>sl(D,O),R),R.unstable_sxConfig={...nv,...I?.unstable_sxConfig},R.unstable_sx=function(O){return l_({sx:O,theme:this})},R.toRuntimeSource=rR,gV(R),R}function jw(t){let s;return t<1?s=5.11916*t**2:s=4.5*Math.log(t+1)+2,Math.round(s*10)/1e3}const _V=[...Array(25)].map((t,s)=>{if(s===0)return"none";const c=jw(s);return`linear-gradient(rgba(255 255 255 / ${c}), rgba(255 255 255 / ${c}))`});function iR(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function oR(t){return t==="dark"?_V:[]}function yV(t){const{palette:s={mode:"light"},opacity:c,overlays:p,colorSpace:g,...v}=t,S=zS({...s,colorSpace:g});return{palette:S,opacity:{...iR(S.mode),...c},overlays:p||oR(S.mode),...v}}function vV(t){return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|modularCssLayers|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!t[1]?.match(/(mode|contrastThreshold|tonalOffset)/)}const xV=t=>[...[...Array(25)].map((s,c)=>`--${t?`${t}-`:""}overlays-${c}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],bV=t=>(s,c)=>{const p=t.rootSelector||":root",g=t.colorSchemeSelector;let v=g;if(g==="class"&&(v=".%s"),g==="data"&&(v="[data-%s]"),g?.startsWith("data-")&&!g.includes("%s")&&(v=`[${g}="%s"]`),t.defaultColorScheme===s){if(s==="dark"){const S={};return xV(t.cssVarPrefix).forEach(r=>{S[r]=c[r],delete c[r]}),v==="media"?{[p]:c,"@media (prefers-color-scheme: dark)":{[p]:S}}:v?{[v.replace("%s",s)]:S,[`${p}, ${v.replace("%s",s)}`]:c}:{[p]:{...c,...S}}}if(v&&v!=="media")return`${p}, ${v.replace("%s",String(s))}`}else if(s){if(v==="media")return{[`@media (prefers-color-scheme: ${String(s)})`]:{[p]:c}};if(v)return v.replace("%s",String(s))}return p};function wV(t,s){s.forEach(c=>{t[c]||(t[c]={})})}function Mn(t,s,c){!t[s]&&c&&(t[s]=c)}function by(t){return typeof t!="string"||!t.startsWith("hsl")?t:QI(t)}function af(t,s){`${s}Channel`in t||(t[`${s}Channel`]=xy(by(t[s])))}function SV(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const ih=t=>{try{return t()}catch{}},TV=(t="mui")=>j9(t);function W2(t,s,c,p,g){if(!c)return;c=c===!0?{}:c;const v=g==="dark"?"dark":"light";if(!p){s[g]=yV({...c,palette:{mode:v,...c?.palette},colorSpace:t});return}const{palette:S,...r}=Uw({...p,palette:{mode:v,...c?.palette},colorSpace:t});return s[g]={...c,palette:S,opacity:{...iR(v),...c?.opacity},overlays:c?.overlays||oR(v)},r}function CV(t={},...s){const{colorSchemes:c={light:!0},defaultColorScheme:p,disableCssColorScheme:g=!1,cssVarPrefix:v="mui",nativeColor:S=!1,shouldSkipGeneratingVar:r=vV,colorSchemeSelector:E=c.light&&c.dark?"media":void 0,rootSelector:A=":root",...I}=t,F=Object.keys(c)[0],z=p||(c.light&&F!=="light"?"light":F),R=TV(v),{[z]:D,light:O,dark:N,...H}=c,j={...H};let V=D;if((z==="dark"&&!("dark"in c)||z==="light"&&!("light"in c))&&(V=!0),!V)throw new Error(pf(21,z));let Z;S&&(Z="oklch");const X=W2(Z,j,V,I,z);O&&!j.light&&W2(Z,j,O,void 0,"light"),N&&!j.dark&&W2(Z,j,N,void 0,"dark");let se={defaultColorScheme:z,...X,cssVarPrefix:v,colorSchemeSelector:E,rootSelector:A,getCssVar:R,colorSchemes:j,font:{...tV(X.typography),...X.font},spacing:SV(I.spacing)};Object.keys(se.colorSchemes).forEach(pe=>{const K=se.colorSchemes[pe].palette,ye=de=>{const Ae=de.split("-"),ne=Ae[1],xe=Ae[2];return R(de,K[ne][xe])};K.mode==="light"&&(Mn(K.common,"background","#fff"),Mn(K.common,"onBackground","#000")),K.mode==="dark"&&(Mn(K.common,"background","#000"),Mn(K.common,"onBackground","#fff"));function J(de,Ae,ne){if(Z){let xe;return de===Im&&(xe=`transparent ${((1-ne)*100).toFixed(0)}%`),de===Vo&&(xe=`#000 ${(ne*100).toFixed(0)}%`),de===Uo&&(xe=`#fff ${(ne*100).toFixed(0)}%`),`color-mix(in ${Z}, ${Ae}, ${xe})`}return de(Ae,ne)}if(wV(K,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),K.mode==="light"){Mn(K.Alert,"errorColor",J(Vo,K.error.light,.6)),Mn(K.Alert,"infoColor",J(Vo,K.info.light,.6)),Mn(K.Alert,"successColor",J(Vo,K.success.light,.6)),Mn(K.Alert,"warningColor",J(Vo,K.warning.light,.6)),Mn(K.Alert,"errorFilledBg",ye("palette-error-main")),Mn(K.Alert,"infoFilledBg",ye("palette-info-main")),Mn(K.Alert,"successFilledBg",ye("palette-success-main")),Mn(K.Alert,"warningFilledBg",ye("palette-warning-main")),Mn(K.Alert,"errorFilledColor",ih(()=>K.getContrastText(K.error.main))),Mn(K.Alert,"infoFilledColor",ih(()=>K.getContrastText(K.info.main))),Mn(K.Alert,"successFilledColor",ih(()=>K.getContrastText(K.success.main))),Mn(K.Alert,"warningFilledColor",ih(()=>K.getContrastText(K.warning.main))),Mn(K.Alert,"errorStandardBg",J(Uo,K.error.light,.9)),Mn(K.Alert,"infoStandardBg",J(Uo,K.info.light,.9)),Mn(K.Alert,"successStandardBg",J(Uo,K.success.light,.9)),Mn(K.Alert,"warningStandardBg",J(Uo,K.warning.light,.9)),Mn(K.Alert,"errorIconColor",ye("palette-error-main")),Mn(K.Alert,"infoIconColor",ye("palette-info-main")),Mn(K.Alert,"successIconColor",ye("palette-success-main")),Mn(K.Alert,"warningIconColor",ye("palette-warning-main")),Mn(K.AppBar,"defaultBg",ye("palette-grey-100")),Mn(K.Avatar,"defaultBg",ye("palette-grey-400")),Mn(K.Button,"inheritContainedBg",ye("palette-grey-300")),Mn(K.Button,"inheritContainedHoverBg",ye("palette-grey-A100")),Mn(K.Chip,"defaultBorder",ye("palette-grey-400")),Mn(K.Chip,"defaultAvatarColor",ye("palette-grey-700")),Mn(K.Chip,"defaultIconColor",ye("palette-grey-700")),Mn(K.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),Mn(K.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),Mn(K.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),Mn(K.LinearProgress,"primaryBg",J(Uo,K.primary.main,.62)),Mn(K.LinearProgress,"secondaryBg",J(Uo,K.secondary.main,.62)),Mn(K.LinearProgress,"errorBg",J(Uo,K.error.main,.62)),Mn(K.LinearProgress,"infoBg",J(Uo,K.info.main,.62)),Mn(K.LinearProgress,"successBg",J(Uo,K.success.main,.62)),Mn(K.LinearProgress,"warningBg",J(Uo,K.warning.main,.62)),Mn(K.Skeleton,"bg",Z?J(Im,K.text.primary,.11):`rgba(${ye("palette-text-primaryChannel")} / 0.11)`),Mn(K.Slider,"primaryTrack",J(Uo,K.primary.main,.62)),Mn(K.Slider,"secondaryTrack",J(Uo,K.secondary.main,.62)),Mn(K.Slider,"errorTrack",J(Uo,K.error.main,.62)),Mn(K.Slider,"infoTrack",J(Uo,K.info.main,.62)),Mn(K.Slider,"successTrack",J(Uo,K.success.main,.62)),Mn(K.Slider,"warningTrack",J(Uo,K.warning.main,.62));const de=Z?J(Vo,K.background.default,.6825):g1(K.background.default,.8);Mn(K.SnackbarContent,"bg",de),Mn(K.SnackbarContent,"color",ih(()=>Z?Vw.text.primary:K.getContrastText(de))),Mn(K.SpeedDialAction,"fabHoverBg",g1(K.background.paper,.15)),Mn(K.StepConnector,"border",ye("palette-grey-400")),Mn(K.StepContent,"border",ye("palette-grey-400")),Mn(K.Switch,"defaultColor",ye("palette-common-white")),Mn(K.Switch,"defaultDisabledColor",ye("palette-grey-100")),Mn(K.Switch,"primaryDisabledColor",J(Uo,K.primary.main,.62)),Mn(K.Switch,"secondaryDisabledColor",J(Uo,K.secondary.main,.62)),Mn(K.Switch,"errorDisabledColor",J(Uo,K.error.main,.62)),Mn(K.Switch,"infoDisabledColor",J(Uo,K.info.main,.62)),Mn(K.Switch,"successDisabledColor",J(Uo,K.success.main,.62)),Mn(K.Switch,"warningDisabledColor",J(Uo,K.warning.main,.62)),Mn(K.TableCell,"border",J(Uo,J(Im,K.divider,1),.88)),Mn(K.Tooltip,"bg",J(Im,K.grey[700],.92))}if(K.mode==="dark"){Mn(K.Alert,"errorColor",J(Uo,K.error.light,.6)),Mn(K.Alert,"infoColor",J(Uo,K.info.light,.6)),Mn(K.Alert,"successColor",J(Uo,K.success.light,.6)),Mn(K.Alert,"warningColor",J(Uo,K.warning.light,.6)),Mn(K.Alert,"errorFilledBg",ye("palette-error-dark")),Mn(K.Alert,"infoFilledBg",ye("palette-info-dark")),Mn(K.Alert,"successFilledBg",ye("palette-success-dark")),Mn(K.Alert,"warningFilledBg",ye("palette-warning-dark")),Mn(K.Alert,"errorFilledColor",ih(()=>K.getContrastText(K.error.dark))),Mn(K.Alert,"infoFilledColor",ih(()=>K.getContrastText(K.info.dark))),Mn(K.Alert,"successFilledColor",ih(()=>K.getContrastText(K.success.dark))),Mn(K.Alert,"warningFilledColor",ih(()=>K.getContrastText(K.warning.dark))),Mn(K.Alert,"errorStandardBg",J(Vo,K.error.light,.9)),Mn(K.Alert,"infoStandardBg",J(Vo,K.info.light,.9)),Mn(K.Alert,"successStandardBg",J(Vo,K.success.light,.9)),Mn(K.Alert,"warningStandardBg",J(Vo,K.warning.light,.9)),Mn(K.Alert,"errorIconColor",ye("palette-error-main")),Mn(K.Alert,"infoIconColor",ye("palette-info-main")),Mn(K.Alert,"successIconColor",ye("palette-success-main")),Mn(K.Alert,"warningIconColor",ye("palette-warning-main")),Mn(K.AppBar,"defaultBg",ye("palette-grey-900")),Mn(K.AppBar,"darkBg",ye("palette-background-paper")),Mn(K.AppBar,"darkColor",ye("palette-text-primary")),Mn(K.Avatar,"defaultBg",ye("palette-grey-600")),Mn(K.Button,"inheritContainedBg",ye("palette-grey-800")),Mn(K.Button,"inheritContainedHoverBg",ye("palette-grey-700")),Mn(K.Chip,"defaultBorder",ye("palette-grey-700")),Mn(K.Chip,"defaultAvatarColor",ye("palette-grey-300")),Mn(K.Chip,"defaultIconColor",ye("palette-grey-300")),Mn(K.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),Mn(K.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),Mn(K.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),Mn(K.LinearProgress,"primaryBg",J(Vo,K.primary.main,.5)),Mn(K.LinearProgress,"secondaryBg",J(Vo,K.secondary.main,.5)),Mn(K.LinearProgress,"errorBg",J(Vo,K.error.main,.5)),Mn(K.LinearProgress,"infoBg",J(Vo,K.info.main,.5)),Mn(K.LinearProgress,"successBg",J(Vo,K.success.main,.5)),Mn(K.LinearProgress,"warningBg",J(Vo,K.warning.main,.5)),Mn(K.Skeleton,"bg",Z?J(Im,K.text.primary,.13):`rgba(${ye("palette-text-primaryChannel")} / 0.13)`),Mn(K.Slider,"primaryTrack",J(Vo,K.primary.main,.5)),Mn(K.Slider,"secondaryTrack",J(Vo,K.secondary.main,.5)),Mn(K.Slider,"errorTrack",J(Vo,K.error.main,.5)),Mn(K.Slider,"infoTrack",J(Vo,K.info.main,.5)),Mn(K.Slider,"successTrack",J(Vo,K.success.main,.5)),Mn(K.Slider,"warningTrack",J(Vo,K.warning.main,.5));const de=Z?J(Uo,K.background.default,.985):g1(K.background.default,.98);Mn(K.SnackbarContent,"bg",de),Mn(K.SnackbarContent,"color",ih(()=>Z?tR.text.primary:K.getContrastText(de))),Mn(K.SpeedDialAction,"fabHoverBg",g1(K.background.paper,.15)),Mn(K.StepConnector,"border",ye("palette-grey-600")),Mn(K.StepContent,"border",ye("palette-grey-600")),Mn(K.Switch,"defaultColor",ye("palette-grey-300")),Mn(K.Switch,"defaultDisabledColor",ye("palette-grey-600")),Mn(K.Switch,"primaryDisabledColor",J(Vo,K.primary.main,.55)),Mn(K.Switch,"secondaryDisabledColor",J(Vo,K.secondary.main,.55)),Mn(K.Switch,"errorDisabledColor",J(Vo,K.error.main,.55)),Mn(K.Switch,"infoDisabledColor",J(Vo,K.info.main,.55)),Mn(K.Switch,"successDisabledColor",J(Vo,K.success.main,.55)),Mn(K.Switch,"warningDisabledColor",J(Vo,K.warning.main,.55)),Mn(K.TableCell,"border",J(Vo,J(Im,K.divider,1),.68)),Mn(K.Tooltip,"bg",J(Im,K.grey[700],.92))}af(K.background,"default"),af(K.background,"paper"),af(K.common,"background"),af(K.common,"onBackground"),af(K,"divider"),Object.keys(K).forEach(de=>{const Ae=K[de];de!=="tonalOffset"&&Ae&&typeof Ae=="object"&&(Ae.main&&Mn(K[de],"mainChannel",xy(by(Ae.main))),Ae.light&&Mn(K[de],"lightChannel",xy(by(Ae.light))),Ae.dark&&Mn(K[de],"darkChannel",xy(by(Ae.dark))),Ae.contrastText&&Mn(K[de],"contrastTextChannel",xy(by(Ae.contrastText))),de==="text"&&(af(K[de],"primary"),af(K[de],"secondary")),de==="action"&&(Ae.active&&af(K[de],"active"),Ae.selected&&af(K[de],"selected")))})}),se=s.reduce((pe,K)=>sl(pe,K),se);const ge={prefix:v,disableCssColorScheme:g,shouldSkipGeneratingVar:r,getSelector:bV(se),enableContrastVars:S},{vars:ae,generateThemeVars:oe,generateStyleSheets:fe}=H9(se,ge);return se.vars=ae,Object.entries(se.colorSchemes[se.defaultColorScheme]).forEach(([pe,K])=>{se[pe]=K}),se.generateThemeVars=oe,se.generateStyleSheets=fe,se.generateSpacing=function(){return qI(I.spacing,SS(this))},se.getColorSchemeSelector=q9(E),se.spacing=se.generateSpacing(),se.shouldSkipGeneratingVar=r,se.unstable_sxConfig={...nv,...I?.unstable_sxConfig},se.unstable_sx=function(K){return l_({sx:K,theme:this})},se.toRuntimeSource=rR,se}function zA(t,s,c){t.colorSchemes&&c&&(t.colorSchemes[s]={...c!==!0&&c,palette:zS({...c===!0?{}:c.palette,mode:s})})}function EV(t={},...s){const{palette:c,cssVariables:p=!1,colorSchemes:g=c?void 0:{light:!0},defaultColorScheme:v=c?.mode,...S}=t,r=v||"light",E=g?.[r],A={...g,...c?{[r]:{...typeof E!="boolean"&&E,palette:c}}:void 0};if(p===!1){if(!("colorSchemes"in t))return Uw(t,...s);let I=c;"palette"in t||A[r]&&(A[r]!==!0?I=A[r].palette:r==="dark"&&(I={mode:"dark"}));const F=Uw({...t,palette:I},...s);return F.defaultColorScheme=r,F.colorSchemes=A,F.palette.mode==="light"&&(F.colorSchemes.light={...A.light!==!0&&A.light,palette:F.palette},zA(F,"dark",A.dark)),F.palette.mode==="dark"&&(F.colorSchemes.dark={...A.dark!==!0&&A.dark,palette:F.palette},zA(F,"light",A.light)),F}return!c&&!("light"in A)&&r==="light"&&(A.light=!0),CV({...S,colorSchemes:A,defaultColorScheme:r,...typeof p!="boolean"&&p},...s)}const Xx=EV(),sv="$$material";function y_(){const t=OS(Xx);return t[sv]||t}function AV(t){return ue.jsx(g9,{...t,defaultTheme:Xx,themeId:sv})}function Kx(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const hd=t=>Kx(t)&&t!=="classes",Cn=S9({themeId:sv,defaultTheme:Xx,rootShouldForwardProp:hd});function PV(t){return function(c){return ue.jsx(AV,{styles:typeof t=="function"?p=>t({theme:p,...c}):t})}}function MV(){return l7}const _o=U9;function To(t){return B9(t)}const IV=t=>!t||!dh(t);function RV(t){return typeof t.main=="string"}function DV(t,s=[]){if(!RV(t))return!1;for(const c of s)if(!t.hasOwnProperty(c)||typeof t[c]!="string")return!1;return!0}function il(t=[]){return([,s])=>s&&DV(s,t)}function kV(t){return ui("MuiSlider",t)}const yu=oi("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),OV=t=>{const{open:s}=t;return{offset:Ar(s&&yu.valueLabelOpen),circle:yu.valueLabelCircle,label:yu.valueLabelLabel}};function LV(t){const{children:s,className:c,value:p}=t,g=OV(t);return s?Te.cloneElement(s,{className:s.props.className},ue.jsxs(Te.Fragment,{children:[s.props.children,ue.jsx("span",{className:Ar(g.offset,c),"aria-hidden":!0,children:ue.jsx("span",{className:g.circle,children:ue.jsx("span",{className:g.label,children:p})})})]})):null}function FA(t){return t}const zV=Cn("span",{name:"MuiSlider",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,s[`color${ar(c.color)}`],c.size!=="medium"&&s[`size${ar(c.size)}`],c.marked&&s.marked,c.orientation==="vertical"&&s.vertical,c.track==="inverted"&&s.trackInverted,c.track===!1&&s.trackFalse]}})(_o(({theme:t})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${yu.disabled}`]:{pointerEvents:"none",cursor:"default",color:(t.vars||t).palette.grey[400]},[`&.${yu.dragging}`]:{[`& .${yu.thumb}, & .${yu.track}`]:{transition:"none"}},variants:[...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{color:(t.vars||t).palette[s].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),FV=Cn("span",{name:"MuiSlider",slot:"Rail"})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),BV=Cn("span",{name:"MuiSlider",slot:"Track"})(_o(({theme:t})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:t.transitions.create(["left","width","bottom","height"],{duration:t.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s,track:"inverted"},style:{...t.vars?{backgroundColor:t.vars.palette.Slider[`${s}Track`],borderColor:t.vars.palette.Slider[`${s}Track`]}:{backgroundColor:t.lighten(t.palette[s].main,.62),borderColor:t.lighten(t.palette[s].main,.62),...t.applyStyles("dark",{backgroundColor:t.darken(t.palette[s].main,.5)}),...t.applyStyles("dark",{borderColor:t.darken(t.palette[s].main,.5)})}}}))]}))),NV=Cn("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.thumb,s[`thumbColor${ar(c.color)}`],c.size!=="medium"&&s[`thumbSize${ar(c.size)}`]]}})(_o(({theme:t})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:t.transitions.create(["box-shadow","left","bottom"],{duration:t.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(t.vars||t).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${yu.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{[`&:hover, &.${yu.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${t.alpha((t.vars||t).palette[s].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${yu.active}`]:{boxShadow:`0px 0px 0px 14px ${t.alpha((t.vars||t).palette[s].main,.16)}`}}}))]}))),VV=Cn(LV,{name:"MuiSlider",slot:"ValueLabel"})(_o(({theme:t})=>({zIndex:1,whiteSpace:"nowrap",...t.typography.body2,fontWeight:500,transition:t.transitions.create(["transform"],{duration:t.transitions.duration.shortest}),position:"absolute",backgroundColor:(t.vars||t).palette.grey[600],borderRadius:2,color:(t.vars||t).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${yu.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${yu.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:t.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),UV=Cn("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:t=>Kx(t)&&t!=="markActive",overridesResolver:(t,s)=>{const{markActive:c}=t;return[s.mark,c&&s.markActive]}})(_o(({theme:t})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(t.vars||t).palette.background.paper,opacity:.8}}]}))),jV=Cn("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:t=>Kx(t)&&t!=="markLabelActive"})(_o(({theme:t})=>({...t.typography.body2,color:(t.vars||t).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(t.vars||t).palette.text.primary}}]}))),GV=t=>{const{disabled:s,dragging:c,marked:p,orientation:g,track:v,classes:S,color:r,size:E}=t,A={root:["root",s&&"disabled",c&&"dragging",p&&"marked",g==="vertical"&&"vertical",v==="inverted"&&"trackInverted",v===!1&&"trackFalse",r&&`color${ar(r)}`,E&&`size${ar(E)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",s&&"disabled",E&&`thumbSize${ar(E)}`,r&&`thumbColor${ar(r)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return ti(A,kV,S)},$V=({children:t})=>t,HV=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiSlider"}),g=Su(),{"aria-label":v,"aria-valuetext":S,"aria-labelledby":r,component:E="span",components:A={},componentsProps:I={},color:F="primary",classes:z,className:R,disableSwap:D=!1,disabled:O=!1,getAriaLabel:N,getAriaValueText:H,marks:j=!1,max:V=100,min:Z=0,name:X,onChange:se,onChangeCommitted:ge,orientation:ae="horizontal",shiftStep:oe=10,size:fe="medium",step:pe=1,scale:K=FA,slotProps:ye,slots:J,tabIndex:de,track:Ae="normal",value:ne,valueLabelDisplay:xe="off",valueLabelFormat:Ce=FA,...Re}=p,Ee={...p,isRtl:g,max:V,min:Z,classes:z,disabled:O,disableSwap:D,orientation:ae,marks:j,color:F,size:fe,step:pe,shiftStep:oe,scale:K,track:Ae,valueLabelDisplay:xe,valueLabelFormat:Ce},{axisProps:Oe,getRootProps:Be,getHiddenInputProps:at,getThumbProps:ut,open:nt,active:$e,axis:ct,focusedThumbIndex:At,range:xt,dragging:It,marks:jt,values:cn,trackOffset:Se,trackLeap:mt,getThumbStyle:Ke}=pN({...Ee,rootRef:c});Ee.marked=jt.length>0&&jt.some(Yr=>Yr.label),Ee.dragging=It,Ee.focusedThumbIndex=At;const Ue=GV(Ee),je=J?.root??A.Root??zV,gt=J?.rail??A.Rail??FV,Ot=J?.track??A.Track??BV,Ft=J?.thumb??A.Thumb??NV,pt=J?.valueLabel??A.ValueLabel??VV,dn=J?.mark??A.Mark??UV,An=J?.markLabel??A.MarkLabel??jV,Gt=J?.input??A.Input??"input",Yt=ye?.root??I.root,zn=ye?.rail??I.rail,$n=ye?.track??I.track,On=ye?.thumb??I.thumb,Bn=ye?.valueLabel??I.valueLabel,kn=ye?.mark??I.mark,Pr=ye?.markLabel??I.markLabel,mr=ye?.input??I.input,ni=ji({elementType:je,getSlotProps:Be,externalSlotProps:Yt,externalForwardedProps:Re,additionalProps:{...IV(je)&&{as:E}},ownerState:{...Ee,...Yt?.ownerState},className:[Ue.root,R]}),tr=ji({elementType:gt,externalSlotProps:zn,ownerState:Ee,className:Ue.rail}),Br=ji({elementType:Ot,externalSlotProps:$n,additionalProps:{style:{...Oe[ct].offset(Se),...Oe[ct].leap(mt)}},ownerState:{...Ee,...$n?.ownerState},className:Ue.track}),Tr=ji({elementType:Ft,getSlotProps:ut,externalSlotProps:On,ownerState:{...Ee,...On?.ownerState},className:Ue.thumb}),Fr=ji({elementType:pt,externalSlotProps:Bn,ownerState:{...Ee,...Bn?.ownerState},className:Ue.valueLabel}),di=ji({elementType:dn,externalSlotProps:kn,ownerState:Ee,className:Ue.mark}),Mo=ji({elementType:An,externalSlotProps:Pr,ownerState:Ee,className:Ue.markLabel}),ds=ji({elementType:Gt,getSlotProps:at,externalSlotProps:mr,ownerState:Ee});return ue.jsxs(je,{...ni,children:[ue.jsx(gt,{...tr}),ue.jsx(Ot,{...Br}),jt.filter(Yr=>Yr.value>=Z&&Yr.value<=V).map((Yr,co)=>{const ya=cx(Yr.value,Z,V),cl=Oe[ct].offset(ya);let Kt;return Ae===!1?Kt=cn.includes(Yr.value):Kt=Ae==="normal"&&(xt?Yr.value>=cn[0]&&Yr.value<=cn[cn.length-1]:Yr.value<=cn[0])||Ae==="inverted"&&(xt?Yr.value<=cn[0]||Yr.value>=cn[cn.length-1]:Yr.value>=cn[0]),ue.jsxs(Te.Fragment,{children:[ue.jsx(dn,{"data-index":co,...di,...!dh(dn)&&{markActive:Kt},style:{...cl,...di.style},className:Ar(di.className,Kt&&Ue.markActive)}),Yr.label!=null?ue.jsx(An,{"aria-hidden":!0,"data-index":co,...Mo,...!dh(An)&&{markLabelActive:Kt},style:{...cl,...Mo.style},className:Ar(Ue.markLabel,Mo.className,Kt&&Ue.markLabelActive),children:Yr.label}):null]},co)}),cn.map((Yr,co)=>{const ya=cx(Yr,Z,V),cl=Oe[ct].offset(ya),Kt=xe==="off"?$V:pt;return ue.jsx(Kt,{...!dh(Kt)&&{valueLabelFormat:Ce,valueLabelDisplay:xe,value:typeof Ce=="function"?Ce(K(Yr),co):Ce,index:co,open:nt===co||$e===co||xe==="on",disabled:O},...Fr,children:ue.jsx(Ft,{"data-index":co,...Tr,className:Ar(Ue.thumb,Tr.className,$e===co&&Ue.active,At===co&&Ue.focusVisible),style:{...cl,...Ke(co),...Tr.style},children:ue.jsx(Gt,{"data-index":co,"aria-label":N?N(co):v,"aria-valuenow":K(Yr),"aria-labelledby":r,"aria-valuetext":H?H(K(Yr),co):S,value:cn[co],...ds})})},co)})]})});function _s({props:t,name:s}){return P9({props:t,name:s,defaultTheme:Xx,themeId:sv})}var Z1={exports:{}},b0={},Z2={},Y2={},BA;function Zi(){return BA||(BA=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const s=Math.PI/180;function c(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof Jg<"u"?Jg:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.22",isBrowser:c(),isUnminified:/param/.test((function(g){}).toString()),dblClickWindow:400,getAngle(g){return t.Konva.angleDeg?g*s:g},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var g;return(g=t.Konva.Transformer)===null||g===void 0?void 0:g.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(g){t.glob.Konva=g}};const p=g=>{t.Konva[g.prototype.getClassName()]=g};t._registerNode=p,t.Konva._injectGlobal(t.Konva)})(Y2)),Y2}var X2={},NA;function Ms(){return NA||(NA=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const s=Zi();class c{constructor(Z=[1,0,0,1,0,0]){this.dirty=!1,this.m=Z&&Z.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new c(this.m)}copyInto(Z){Z.m[0]=this.m[0],Z.m[1]=this.m[1],Z.m[2]=this.m[2],Z.m[3]=this.m[3],Z.m[4]=this.m[4],Z.m[5]=this.m[5]}point(Z){const X=this.m;return{x:X[0]*Z.x+X[2]*Z.y+X[4],y:X[1]*Z.x+X[3]*Z.y+X[5]}}translate(Z,X){return this.m[4]+=this.m[0]*Z+this.m[2]*X,this.m[5]+=this.m[1]*Z+this.m[3]*X,this}scale(Z,X){return this.m[0]*=Z,this.m[1]*=Z,this.m[2]*=X,this.m[3]*=X,this}rotate(Z){const X=Math.cos(Z),se=Math.sin(Z),ge=this.m[0]*X+this.m[2]*se,ae=this.m[1]*X+this.m[3]*se,oe=this.m[0]*-se+this.m[2]*X,fe=this.m[1]*-se+this.m[3]*X;return this.m[0]=ge,this.m[1]=ae,this.m[2]=oe,this.m[3]=fe,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(Z,X){const se=this.m[0]+this.m[2]*X,ge=this.m[1]+this.m[3]*X,ae=this.m[2]+this.m[0]*Z,oe=this.m[3]+this.m[1]*Z;return this.m[0]=se,this.m[1]=ge,this.m[2]=ae,this.m[3]=oe,this}multiply(Z){const X=this.m[0]*Z.m[0]+this.m[2]*Z.m[1],se=this.m[1]*Z.m[0]+this.m[3]*Z.m[1],ge=this.m[0]*Z.m[2]+this.m[2]*Z.m[3],ae=this.m[1]*Z.m[2]+this.m[3]*Z.m[3],oe=this.m[0]*Z.m[4]+this.m[2]*Z.m[5]+this.m[4],fe=this.m[1]*Z.m[4]+this.m[3]*Z.m[5]+this.m[5];return this.m[0]=X,this.m[1]=se,this.m[2]=ge,this.m[3]=ae,this.m[4]=oe,this.m[5]=fe,this}invert(){const Z=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),X=this.m[3]*Z,se=-this.m[1]*Z,ge=-this.m[2]*Z,ae=this.m[0]*Z,oe=Z*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),fe=Z*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=X,this.m[1]=se,this.m[2]=ge,this.m[3]=ae,this.m[4]=oe,this.m[5]=fe,this}getMatrix(){return this.m}decompose(){const Z=this.m[0],X=this.m[1],se=this.m[2],ge=this.m[3],ae=this.m[4],oe=this.m[5],fe=Z*ge-X*se,pe={x:ae,y:oe,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(Z!=0||X!=0){const K=Math.sqrt(Z*Z+X*X);pe.rotation=X>0?Math.acos(Z/K):-Math.acos(Z/K),pe.scaleX=K,pe.scaleY=fe/K,pe.skewX=(Z*se+X*ge)/fe,pe.skewY=0}else if(se!=0||ge!=0){const K=Math.sqrt(se*se+ge*ge);pe.rotation=Math.PI/2-(ge>0?Math.acos(-se/K):-Math.acos(se/K)),pe.scaleX=fe/K,pe.scaleY=K,pe.skewX=0,pe.skewY=(Z*se+X*ge)/fe}return pe.rotation=t.Util._getRotation(pe.rotation),pe}}t.Transform=c;const p="[object Array]",g="[object Number]",v="[object String]",S="[object Boolean]",r=Math.PI/180,E=180/Math.PI,A="#",I="",F="0",z="Konva warning: ",R="Konva error: ",D="rgb(",O={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},N=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let H=[];const j=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(V){setTimeout(V,60)};t.Util={_isElement(V){return!!(V&&V.nodeType==1)},_isFunction(V){return!!(V&&V.constructor&&V.call&&V.apply)},_isPlainObject(V){return!!V&&V.constructor===Object},_isArray(V){return Object.prototype.toString.call(V)===p},_isNumber(V){return Object.prototype.toString.call(V)===g&&!isNaN(V)&&isFinite(V)},_isString(V){return Object.prototype.toString.call(V)===v},_isBoolean(V){return Object.prototype.toString.call(V)===S},isObject(V){return V instanceof Object},isValidSelector(V){if(typeof V!="string")return!1;const Z=V[0];return Z==="#"||Z==="."||Z===Z.toUpperCase()},_sign(V){return V===0||V>0?1:-1},requestAnimFrame(V){H.push(V),H.length===1&&j(function(){const Z=H;H=[],Z.forEach(function(X){X()})})},createCanvasElement(){const V=document.createElement("canvas");try{V.style=V.style||{}}catch{}return V},createImageElement(){return document.createElement("img")},_isInDocument(V){for(;V=V.parentNode;)if(V==document)return!0;return!1},_urlToImage(V,Z){const X=t.Util.createImageElement();X.onload=function(){Z(X)},X.src=V},_rgbToHex(V,Z,X){return((1<<24)+(V<<16)+(Z<<8)+X).toString(16).slice(1)},_hexToRgb(V){V=V.replace(A,I);const Z=parseInt(V,16);return{r:Z>>16&255,g:Z>>8&255,b:Z&255}},getRandomColor(){let V=(Math.random()*16777215<<0).toString(16);for(;V.length<6;)V=F+V;return A+V},getRGB(V){let Z;return V in O?(Z=O[V],{r:Z[0],g:Z[1],b:Z[2]}):V[0]===A?this._hexToRgb(V.substring(1)):V.substr(0,4)===D?(Z=N.exec(V.replace(/ /g,"")),{r:parseInt(Z[1],10),g:parseInt(Z[2],10),b:parseInt(Z[3],10)}):{r:0,g:0,b:0}},colorToRGBA(V){return V=V||"black",t.Util._namedColorToRBA(V)||t.Util._hex3ColorToRGBA(V)||t.Util._hex4ColorToRGBA(V)||t.Util._hex6ColorToRGBA(V)||t.Util._hex8ColorToRGBA(V)||t.Util._rgbColorToRGBA(V)||t.Util._rgbaColorToRGBA(V)||t.Util._hslColorToRGBA(V)},_namedColorToRBA(V){const Z=O[V.toLowerCase()];return Z?{r:Z[0],g:Z[1],b:Z[2],a:1}:null},_rgbColorToRGBA(V){if(V.indexOf("rgb(")===0){V=V.match(/rgb\(([^)]+)\)/)[1];const Z=V.split(/ *, */).map(Number);return{r:Z[0],g:Z[1],b:Z[2],a:1}}},_rgbaColorToRGBA(V){if(V.indexOf("rgba(")===0){V=V.match(/rgba\(([^)]+)\)/)[1];const Z=V.split(/ *, */).map((X,se)=>X.slice(-1)==="%"?se===3?parseInt(X)/100:parseInt(X)/100*255:Number(X));return{r:Z[0],g:Z[1],b:Z[2],a:Z[3]}}},_hex8ColorToRGBA(V){if(V[0]==="#"&&V.length===9)return{r:parseInt(V.slice(1,3),16),g:parseInt(V.slice(3,5),16),b:parseInt(V.slice(5,7),16),a:parseInt(V.slice(7,9),16)/255}},_hex6ColorToRGBA(V){if(V[0]==="#"&&V.length===7)return{r:parseInt(V.slice(1,3),16),g:parseInt(V.slice(3,5),16),b:parseInt(V.slice(5,7),16),a:1}},_hex4ColorToRGBA(V){if(V[0]==="#"&&V.length===5)return{r:parseInt(V[1]+V[1],16),g:parseInt(V[2]+V[2],16),b:parseInt(V[3]+V[3],16),a:parseInt(V[4]+V[4],16)/255}},_hex3ColorToRGBA(V){if(V[0]==="#"&&V.length===4)return{r:parseInt(V[1]+V[1],16),g:parseInt(V[2]+V[2],16),b:parseInt(V[3]+V[3],16),a:1}},_hslColorToRGBA(V){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(V)){const[Z,...X]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(V),se=Number(X[0])/360,ge=Number(X[1])/100,ae=Number(X[2])/100;let oe,fe,pe;if(ge===0)return pe=ae*255,{r:Math.round(pe),g:Math.round(pe),b:Math.round(pe),a:1};ae<.5?oe=ae*(1+ge):oe=ae+ge-ae*ge;const K=2*ae-oe,ye=[0,0,0];for(let J=0;J<3;J++)fe=se+1/3*-(J-1),fe<0&&fe++,fe>1&&fe--,6*fe<1?pe=K+(oe-K)*6*fe:2*fe<1?pe=oe:3*fe<2?pe=K+(oe-K)*(2/3-fe)*6:pe=K,ye[J]=pe*255;return{r:Math.round(ye[0]),g:Math.round(ye[1]),b:Math.round(ye[2]),a:1}}},haveIntersection(V,Z){return!(Z.x>V.x+V.width||Z.x+Z.width<V.x||Z.y>V.y+V.height||Z.y+Z.height<V.y)},cloneObject(V){const Z={};for(const X in V)this._isPlainObject(V[X])?Z[X]=this.cloneObject(V[X]):this._isArray(V[X])?Z[X]=this.cloneArray(V[X]):Z[X]=V[X];return Z},cloneArray(V){return V.slice(0)},degToRad(V){return V*r},radToDeg(V){return V*E},_degToRad(V){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(V)},_radToDeg(V){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(V)},_getRotation(V){return s.Konva.angleDeg?t.Util.radToDeg(V):V},_capitalize(V){return V.charAt(0).toUpperCase()+V.slice(1)},throw(V){throw new Error(R+V)},error(V){console.error(R+V)},warn(V){s.Konva.showWarnings&&console.warn(z+V)},each(V,Z){for(const X in V)Z(X,V[X])},_inRange(V,Z,X){return Z<=V&&V<X},_getProjectionToSegment(V,Z,X,se,ge,ae){let oe,fe,pe;const K=(V-X)*(V-X)+(Z-se)*(Z-se);if(K==0)oe=V,fe=Z,pe=(ge-X)*(ge-X)+(ae-se)*(ae-se);else{const ye=((ge-V)*(X-V)+(ae-Z)*(se-Z))/K;ye<0?(oe=V,fe=Z,pe=(V-ge)*(V-ge)+(Z-ae)*(Z-ae)):ye>1?(oe=X,fe=se,pe=(X-ge)*(X-ge)+(se-ae)*(se-ae)):(oe=V+ye*(X-V),fe=Z+ye*(se-Z),pe=(oe-ge)*(oe-ge)+(fe-ae)*(fe-ae))}return[oe,fe,pe]},_getProjectionToLine(V,Z,X){const se=t.Util.cloneObject(V);let ge=Number.MAX_VALUE;return Z.forEach(function(ae,oe){if(!X&&oe===Z.length-1)return;const fe=Z[(oe+1)%Z.length],pe=t.Util._getProjectionToSegment(ae.x,ae.y,fe.x,fe.y,V.x,V.y),K=pe[0],ye=pe[1],J=pe[2];J<ge&&(se.x=K,se.y=ye,ge=J)}),se},_prepareArrayForTween(V,Z,X){const se=[],ge=[];if(V.length>Z.length){const oe=Z;Z=V,V=oe}for(let oe=0;oe<V.length;oe+=2)se.push({x:V[oe],y:V[oe+1]});for(let oe=0;oe<Z.length;oe+=2)ge.push({x:Z[oe],y:Z[oe+1]});const ae=[];return ge.forEach(function(oe){const fe=t.Util._getProjectionToLine(oe,se,X);ae.push(fe.x),ae.push(fe.y)}),ae},_prepareToStringify(V){let Z;V.visitedByCircularReferenceRemoval=!0;for(const X in V)if(V.hasOwnProperty(X)&&V[X]&&typeof V[X]=="object"){if(Z=Object.getOwnPropertyDescriptor(V,X),V[X].visitedByCircularReferenceRemoval||t.Util._isElement(V[X]))if(Z.configurable)delete V[X];else return null;else if(t.Util._prepareToStringify(V[X])===null)if(Z.configurable)delete V[X];else return null}return delete V.visitedByCircularReferenceRemoval,V},_assign(V,Z){for(const X in Z)V[X]=Z[X];return V},_getFirstPointerId(V){return V.touches?V.changedTouches[0].identifier:V.pointerId||999},releaseCanvas(...V){s.Konva.releaseCanvasOnDestroy&&V.forEach(Z=>{Z.width=0,Z.height=0})},drawRoundedRectPath(V,Z,X,se){let ge=0,ae=0,oe=0,fe=0;typeof se=="number"?ge=ae=oe=fe=Math.min(se,Z/2,X/2):(ge=Math.min(se[0]||0,Z/2,X/2),ae=Math.min(se[1]||0,Z/2,X/2),fe=Math.min(se[2]||0,Z/2,X/2),oe=Math.min(se[3]||0,Z/2,X/2)),V.moveTo(ge,0),V.lineTo(Z-ae,0),V.arc(Z-ae,ae,ae,Math.PI*3/2,0,!1),V.lineTo(Z,X-fe),V.arc(Z-fe,X-fe,fe,0,Math.PI/2,!1),V.lineTo(oe,X),V.arc(oe,X-oe,oe,Math.PI/2,Math.PI,!1),V.lineTo(0,ge),V.arc(ge,ge,ge,Math.PI,Math.PI*3/2,!1)}}})(X2)),X2}var w0={},lf={},cf={},VA;function sR(){if(VA)return cf;VA=1,Object.defineProperty(cf,"__esModule",{value:!0}),cf.HitContext=cf.SceneContext=cf.Context=void 0;const t=Ms(),s=Zi();function c(H){const j=[],V=H.length,Z=t.Util;for(let X=0;X<V;X++){let se=H[X];Z._isNumber(se)?se=Math.round(se*1e3)/1e3:Z._isString(se)||(se=se+""),j.push(se)}return j}const p=",",g="(",v=")",S="([",r="])",E=";",A="()",I="=",F=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],z=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],R=100;let D=class{constructor(j){this.canvas=j,s.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(j){j.fillEnabled()&&this._fill(j)}_fill(j){}strokeShape(j){j.hasStroke()&&this._stroke(j)}_stroke(j){}fillStrokeShape(j){j.attrs.fillAfterStrokeEnabled?(this.strokeShape(j),this.fillShape(j)):(this.fillShape(j),this.strokeShape(j))}getTrace(j,V){let Z=this.traceArr,X=Z.length,se="",ge,ae,oe,fe;for(ge=0;ge<X;ge++)ae=Z[ge],oe=ae.method,oe?(fe=ae.args,se+=oe,j?se+=A:t.Util._isArray(fe[0])?se+=S+fe.join(p)+r:(V&&(fe=fe.map(pe=>typeof pe=="number"?Math.floor(pe):pe)),se+=g+fe.join(p)+v)):(se+=ae.property,j||(se+=I+ae.val)),se+=E;return se}clearTrace(){this.traceArr=[]}_trace(j){let V=this.traceArr,Z;V.push(j),Z=V.length,Z>=R&&V.shift()}reset(){const j=this.getCanvas().getPixelRatio();this.setTransform(1*j,0,0,1*j,0,0)}getCanvas(){return this.canvas}clear(j){const V=this.getCanvas();j?this.clearRect(j.x||0,j.y||0,j.width||0,j.height||0):this.clearRect(0,0,V.getWidth()/V.pixelRatio,V.getHeight()/V.pixelRatio)}_applyLineCap(j){const V=j.attrs.lineCap;V&&this.setAttr("lineCap",V)}_applyOpacity(j){const V=j.getAbsoluteOpacity();V!==1&&this.setAttr("globalAlpha",V)}_applyLineJoin(j){const V=j.attrs.lineJoin;V&&this.setAttr("lineJoin",V)}setAttr(j,V){this._context[j]=V}arc(j,V,Z,X,se,ge){this._context.arc(j,V,Z,X,se,ge)}arcTo(j,V,Z,X,se){this._context.arcTo(j,V,Z,X,se)}beginPath(){this._context.beginPath()}bezierCurveTo(j,V,Z,X,se,ge){this._context.bezierCurveTo(j,V,Z,X,se,ge)}clearRect(j,V,Z,X){this._context.clearRect(j,V,Z,X)}clip(...j){this._context.clip.apply(this._context,j)}closePath(){this._context.closePath()}createImageData(j,V){const Z=arguments;if(Z.length===2)return this._context.createImageData(j,V);if(Z.length===1)return this._context.createImageData(j)}createLinearGradient(j,V,Z,X){return this._context.createLinearGradient(j,V,Z,X)}createPattern(j,V){return this._context.createPattern(j,V)}createRadialGradient(j,V,Z,X,se,ge){return this._context.createRadialGradient(j,V,Z,X,se,ge)}drawImage(j,V,Z,X,se,ge,ae,oe,fe){const pe=arguments,K=this._context;pe.length===3?K.drawImage(j,V,Z):pe.length===5?K.drawImage(j,V,Z,X,se):pe.length===9&&K.drawImage(j,V,Z,X,se,ge,ae,oe,fe)}ellipse(j,V,Z,X,se,ge,ae,oe){this._context.ellipse(j,V,Z,X,se,ge,ae,oe)}isPointInPath(j,V,Z,X){return Z?this._context.isPointInPath(Z,j,V,X):this._context.isPointInPath(j,V,X)}fill(...j){this._context.fill.apply(this._context,j)}fillRect(j,V,Z,X){this._context.fillRect(j,V,Z,X)}strokeRect(j,V,Z,X){this._context.strokeRect(j,V,Z,X)}fillText(j,V,Z,X){X?this._context.fillText(j,V,Z,X):this._context.fillText(j,V,Z)}measureText(j){return this._context.measureText(j)}getImageData(j,V,Z,X){return this._context.getImageData(j,V,Z,X)}lineTo(j,V){this._context.lineTo(j,V)}moveTo(j,V){this._context.moveTo(j,V)}rect(j,V,Z,X){this._context.rect(j,V,Z,X)}roundRect(j,V,Z,X,se){this._context.roundRect(j,V,Z,X,se)}putImageData(j,V,Z){this._context.putImageData(j,V,Z)}quadraticCurveTo(j,V,Z,X){this._context.quadraticCurveTo(j,V,Z,X)}restore(){this._context.restore()}rotate(j){this._context.rotate(j)}save(){this._context.save()}scale(j,V){this._context.scale(j,V)}setLineDash(j){this._context.setLineDash?this._context.setLineDash(j):"mozDash"in this._context?this._context.mozDash=j:"webkitLineDash"in this._context&&(this._context.webkitLineDash=j)}getLineDash(){return this._context.getLineDash()}setTransform(j,V,Z,X,se,ge){this._context.setTransform(j,V,Z,X,se,ge)}stroke(j){j?this._context.stroke(j):this._context.stroke()}strokeText(j,V,Z,X){this._context.strokeText(j,V,Z,X)}transform(j,V,Z,X,se,ge){this._context.transform(j,V,Z,X,se,ge)}translate(j,V){this._context.translate(j,V)}_enableTrace(){let j=this,V=F.length,Z=this.setAttr,X,se;const ge=function(ae){let oe=j[ae],fe;j[ae]=function(){return se=c(Array.prototype.slice.call(arguments,0)),fe=oe.apply(j,arguments),j._trace({method:ae,args:se}),fe}};for(X=0;X<V;X++)ge(F[X]);j.setAttr=function(){Z.apply(j,arguments);const ae=arguments[0];let oe=arguments[1];(ae==="shadowOffsetX"||ae==="shadowOffsetY"||ae==="shadowBlur")&&(oe=oe/this.canvas.getPixelRatio()),j._trace({property:ae,val:oe})}}_applyGlobalCompositeOperation(j){const V=j.attrs.globalCompositeOperation;!V||V==="source-over"||this.setAttr("globalCompositeOperation",V)}};cf.Context=D,z.forEach(function(H){Object.defineProperty(D.prototype,H,{get(){return this._context[H]},set(j){this._context[H]=j}})});class O extends D{constructor(j,{willReadFrequently:V=!1}={}){super(j),this._context=j._canvas.getContext("2d",{willReadFrequently:V})}_fillColor(j){const V=j.fill();this.setAttr("fillStyle",V),j._fillFunc(this)}_fillPattern(j){this.setAttr("fillStyle",j._getFillPattern()),j._fillFunc(this)}_fillLinearGradient(j){const V=j._getLinearGradient();V&&(this.setAttr("fillStyle",V),j._fillFunc(this))}_fillRadialGradient(j){const V=j._getRadialGradient();V&&(this.setAttr("fillStyle",V),j._fillFunc(this))}_fill(j){const V=j.fill(),Z=j.getFillPriority();if(V&&Z==="color"){this._fillColor(j);return}const X=j.getFillPatternImage();if(X&&Z==="pattern"){this._fillPattern(j);return}const se=j.getFillLinearGradientColorStops();if(se&&Z==="linear-gradient"){this._fillLinearGradient(j);return}const ge=j.getFillRadialGradientColorStops();if(ge&&Z==="radial-gradient"){this._fillRadialGradient(j);return}V?this._fillColor(j):X?this._fillPattern(j):se?this._fillLinearGradient(j):ge&&this._fillRadialGradient(j)}_strokeLinearGradient(j){const V=j.getStrokeLinearGradientStartPoint(),Z=j.getStrokeLinearGradientEndPoint(),X=j.getStrokeLinearGradientColorStops(),se=this.createLinearGradient(V.x,V.y,Z.x,Z.y);if(X){for(let ge=0;ge<X.length;ge+=2)se.addColorStop(X[ge],X[ge+1]);this.setAttr("strokeStyle",se)}}_stroke(j){const V=j.dash(),Z=j.getStrokeScaleEnabled();if(j.hasStroke()){if(!Z){this.save();const se=this.getCanvas().getPixelRatio();this.setTransform(se,0,0,se,0,0)}this._applyLineCap(j),V&&j.dashEnabled()&&(this.setLineDash(V),this.setAttr("lineDashOffset",j.dashOffset())),this.setAttr("lineWidth",j.strokeWidth()),j.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),j.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(j):this.setAttr("strokeStyle",j.stroke()),j._strokeFunc(this),Z||this.restore()}}_applyShadow(j){var V,Z,X;const se=(V=j.getShadowRGBA())!==null&&V!==void 0?V:"black",ge=(Z=j.getShadowBlur())!==null&&Z!==void 0?Z:5,ae=(X=j.getShadowOffset())!==null&&X!==void 0?X:{x:0,y:0},oe=j.getAbsoluteScale(),fe=this.canvas.getPixelRatio(),pe=oe.x*fe,K=oe.y*fe;this.setAttr("shadowColor",se),this.setAttr("shadowBlur",ge*Math.min(Math.abs(pe),Math.abs(K))),this.setAttr("shadowOffsetX",ae.x*pe),this.setAttr("shadowOffsetY",ae.y*K)}}cf.SceneContext=O;class N extends D{constructor(j){super(j),this._context=j._canvas.getContext("2d",{willReadFrequently:!0})}_fill(j){this.save(),this.setAttr("fillStyle",j.colorKey),j._fillFuncHit(this),this.restore()}strokeShape(j){j.hasHitStroke()&&this._stroke(j)}_stroke(j){if(j.hasHitStroke()){const V=j.getStrokeScaleEnabled();if(!V){this.save();const se=this.getCanvas().getPixelRatio();this.setTransform(se,0,0,se,0,0)}this._applyLineCap(j);const Z=j.hitStrokeWidth(),X=Z==="auto"?j.strokeWidth():Z;this.setAttr("lineWidth",X),this.setAttr("strokeStyle",j.colorKey),j._strokeFuncHit(this),V||this.restore()}}}return cf.HitContext=N,cf}var UA;function Jx(){if(UA)return lf;UA=1,Object.defineProperty(lf,"__esModule",{value:!0}),lf.HitCanvas=lf.SceneCanvas=lf.Canvas=void 0;const t=Ms(),s=sR(),c=Zi();let p;function g(){if(p)return p;const E=t.Util.createCanvasElement(),A=E.getContext("2d");return p=(function(){const I=c.Konva._global.devicePixelRatio||1,F=A.webkitBackingStorePixelRatio||A.mozBackingStorePixelRatio||A.msBackingStorePixelRatio||A.oBackingStorePixelRatio||A.backingStorePixelRatio||1;return I/F})(),t.Util.releaseCanvas(E),p}let v=class{constructor(A){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const F=(A||{}).pixelRatio||c.Konva.pixelRatio||g();this.pixelRatio=F,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(A){const I=this.pixelRatio;this.pixelRatio=A,this.setSize(this.getWidth()/I,this.getHeight()/I)}setWidth(A){this.width=this._canvas.width=A*this.pixelRatio,this._canvas.style.width=A+"px";const I=this.pixelRatio;this.getContext()._context.scale(I,I)}setHeight(A){this.height=this._canvas.height=A*this.pixelRatio,this._canvas.style.height=A+"px";const I=this.pixelRatio;this.getContext()._context.scale(I,I)}getWidth(){return this.width}getHeight(){return this.height}setSize(A,I){this.setWidth(A||0),this.setHeight(I||0)}toDataURL(A,I){try{return this._canvas.toDataURL(A,I)}catch{try{return this._canvas.toDataURL()}catch(z){return t.Util.error("Unable to get data URL. "+z.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};lf.Canvas=v;class S extends v{constructor(A={width:0,height:0,willReadFrequently:!1}){super(A),this.context=new s.SceneContext(this,{willReadFrequently:A.willReadFrequently}),this.setSize(A.width,A.height)}}lf.SceneCanvas=S;class r extends v{constructor(A={width:0,height:0}){super(A),this.hitCanvas=!0,this.context=new s.HitContext(this),this.setSize(A.width,A.height)}}return lf.HitCanvas=r,lf}var K2={},jA;function FS(){return jA||(jA=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const s=Zi(),c=Ms();t.DD={get isDragging(){let p=!1;return t.DD._dragElements.forEach(g=>{g.dragStatus==="dragging"&&(p=!0)}),p},justDragged:!1,get node(){let p;return t.DD._dragElements.forEach(g=>{p=g.node}),p},_dragElements:new Map,_drag(p){const g=[];t.DD._dragElements.forEach((v,S)=>{const{node:r}=v,E=r.getStage();E.setPointersPositions(p),v.pointerId===void 0&&(v.pointerId=c.Util._getFirstPointerId(p));const A=E._changedPointerPositions.find(I=>I.id===v.pointerId);if(A){if(v.dragStatus!=="dragging"){const I=r.dragDistance();if(Math.max(Math.abs(A.x-v.startPointerPos.x),Math.abs(A.y-v.startPointerPos.y))<I||(r.startDrag({evt:p}),!r.isDragging()))return}r._setDragPosition(p,v),g.push(r)}}),g.forEach(v=>{v.fire("dragmove",{type:"dragmove",target:v,evt:p},!0)})},_endDragBefore(p){const g=[];t.DD._dragElements.forEach(v=>{const{node:S}=v,r=S.getStage();if(p&&r.setPointersPositions(p),!r._changedPointerPositions.find(I=>I.id===v.pointerId))return;(v.dragStatus==="dragging"||v.dragStatus==="stopped")&&(t.DD.justDragged=!0,s.Konva._mouseListenClick=!1,s.Konva._touchListenClick=!1,s.Konva._pointerListenClick=!1,v.dragStatus="stopped");const A=v.node.getLayer()||v.node instanceof s.Konva.Stage&&v.node;A&&g.indexOf(A)===-1&&g.push(A)}),g.forEach(v=>{v.draw()})},_endDragAfter(p){t.DD._dragElements.forEach((g,v)=>{g.dragStatus==="stopped"&&g.node.fire("dragend",{type:"dragend",target:g.node,evt:p},!0),g.dragStatus!=="dragging"&&t.DD._dragElements.delete(v)})}},s.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(K2)),K2}var J2={},nc={},GA;function lo(){if(GA)return nc;GA=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.RGBComponent=p,nc.alphaComponent=g,nc.getNumberValidator=v,nc.getNumberOrArrayOfNumbersValidator=S,nc.getNumberOrAutoValidator=r,nc.getStringValidator=E,nc.getStringOrGradientValidator=A,nc.getFunctionValidator=I,nc.getNumberArrayValidator=F,nc.getBooleanValidator=z,nc.getComponentValidator=R;const t=Zi(),s=Ms();function c(D){return s.Util._isString(D)?'"'+D+'"':Object.prototype.toString.call(D)==="[object Number]"||s.Util._isBoolean(D)?D:Object.prototype.toString.call(D)}function p(D){return D>255?255:D<0?0:Math.round(D)}function g(D){return D>1?1:D<1e-4?1e-4:D}function v(){if(t.Konva.isUnminified)return function(D,O){return s.Util._isNumber(D)||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a number.'),D}}function S(D){if(t.Konva.isUnminified)return function(O,N){let H=s.Util._isNumber(O),j=s.Util._isArray(O)&&O.length==D;return!H&&!j&&s.Util.warn(c(O)+' is a not valid value for "'+N+'" attribute. The value should be a number or Array<number>('+D+")"),O}}function r(){if(t.Konva.isUnminified)return function(D,O){return s.Util._isNumber(D)||D==="auto"||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a number or "auto".'),D}}function E(){if(t.Konva.isUnminified)return function(D,O){return s.Util._isString(D)||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a string.'),D}}function A(){if(t.Konva.isUnminified)return function(D,O){const N=s.Util._isString(D),H=Object.prototype.toString.call(D)==="[object CanvasGradient]"||D&&D.addColorStop;return N||H||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a string or a native gradient.'),D}}function I(){if(t.Konva.isUnminified)return function(D,O){return s.Util._isFunction(D)||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a function.'),D}}function F(){if(t.Konva.isUnminified)return function(D,O){const N=Int8Array?Object.getPrototypeOf(Int8Array):null;return N&&D instanceof N||(s.Util._isArray(D)?D.forEach(function(H){s.Util._isNumber(H)||s.Util.warn('"'+O+'" attribute has non numeric element '+H+". Make sure that all elements are numbers.")}):s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a array of numbers.')),D}}function z(){if(t.Konva.isUnminified)return function(D,O){return D===!0||D===!1||s.Util.warn(c(D)+' is a not valid value for "'+O+'" attribute. The value should be a boolean.'),D}}function R(D){if(t.Konva.isUnminified)return function(O,N){return O==null||s.Util.isObject(O)||s.Util.warn(c(O)+' is a not valid value for "'+N+'" attribute. The value should be an object with properties '+D),O}}return nc}var $A;function ro(){return $A||($A=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const s=Ms(),c=lo(),p="get",g="set";t.Factory={addGetterSetter(v,S,r,E,A){t.Factory.addGetter(v,S,r),t.Factory.addSetter(v,S,E,A),t.Factory.addOverloadedGetterSetter(v,S)},addGetter(v,S,r){const E=p+s.Util._capitalize(S);v.prototype[E]=v.prototype[E]||function(){const A=this.attrs[S];return A===void 0?r:A}},addSetter(v,S,r,E){const A=g+s.Util._capitalize(S);v.prototype[A]||t.Factory.overWriteSetter(v,S,r,E)},overWriteSetter(v,S,r,E){const A=g+s.Util._capitalize(S);v.prototype[A]=function(I){return r&&I!==void 0&&I!==null&&(I=r.call(this,I,S)),this._setAttr(S,I),E&&E.call(this),this}},addComponentsGetterSetter(v,S,r,E,A){const I=r.length,F=s.Util._capitalize,z=p+F(S),R=g+F(S);v.prototype[z]=function(){const O={};for(let N=0;N<I;N++){const H=r[N];O[H]=this.getAttr(S+F(H))}return O};const D=(0,c.getComponentValidator)(r);v.prototype[R]=function(O){const N=this.attrs[S];E&&(O=E.call(this,O,S)),D&&D.call(this,O,S);for(const H in O)O.hasOwnProperty(H)&&this._setAttr(S+F(H),O[H]);return O||r.forEach(H=>{this._setAttr(S+F(H),void 0)}),this._fireChangeEvent(S,N,O),A&&A.call(this),this},t.Factory.addOverloadedGetterSetter(v,S)},addOverloadedGetterSetter(v,S){const r=s.Util._capitalize(S),E=g+r,A=p+r;v.prototype[S]=function(){return arguments.length?(this[E](arguments[0]),this):this[A]()}},addDeprecatedGetterSetter(v,S,r,E){s.Util.error("Adding deprecated "+S);const A=p+s.Util._capitalize(S),I=S+" property is deprecated and will be removed soon. Look at Konva change log for more information.";v.prototype[A]=function(){s.Util.error(I);const F=this.attrs[S];return F===void 0?r:F},t.Factory.addSetter(v,S,E,function(){s.Util.error(I)}),t.Factory.addOverloadedGetterSetter(v,S)},backCompat(v,S){s.Util.each(S,function(r,E){const A=v.prototype[E],I=p+s.Util._capitalize(r),F=g+s.Util._capitalize(r);function z(){A.apply(this,arguments),s.Util.error('"'+r+'" method is deprecated and will be removed soon. Use ""'+E+'" instead.')}v.prototype[r]=z,v.prototype[I]=z,v.prototype[F]=z})},afterSetFilter(){this._filterUpToDate=!1}}})(J2)),J2}var HA;function Gs(){if(HA)return w0;HA=1,Object.defineProperty(w0,"__esModule",{value:!0}),w0.Node=void 0;const t=Jx(),s=FS(),c=ro(),p=Zi(),g=Ms(),v=lo(),S="absoluteOpacity",r="allEventListeners",E="absoluteTransform",A="absoluteScale",I="canvas",F="Change",z="children",R="konva",D="listening",O="mouseenter",N="mouseleave",H="pointerenter",j="pointerleave",V="touchenter",Z="touchleave",X="set",se="Shape",ge=" ",ae="stage",oe="transform",fe="Stage",pe="visible",K=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(ge);let ye=1;class J{constructor(ne){this._id=ye++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(ne),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(ne){(ne===oe||ne===E)&&this._cache.get(ne)?this._cache.get(ne).dirty=!0:ne?this._cache.delete(ne):this._cache.clear()}_getCache(ne,xe){let Ce=this._cache.get(ne);return(Ce===void 0||(ne===oe||ne===E)&&Ce.dirty===!0)&&(Ce=xe.call(this),this._cache.set(ne,Ce)),Ce}_calculate(ne,xe,Ce){if(!this._attachedDepsListeners.get(ne)){const Re=xe.map(Ee=>Ee+"Change.konva").join(ge);this.on(Re,()=>{this._clearCache(ne)}),this._attachedDepsListeners.set(ne,!0)}return this._getCache(ne,Ce)}_getCanvasCache(){return this._cache.get(I)}_clearSelfAndDescendantCache(ne){this._clearCache(ne),ne===E&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(I)){const{scene:ne,filter:xe,hit:Ce,buffer:Re}=this._cache.get(I);g.Util.releaseCanvas(ne,xe,Ce,Re),this._cache.delete(I)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(ne){const xe=ne||{};let Ce={};(xe.x===void 0||xe.y===void 0||xe.width===void 0||xe.height===void 0)&&(Ce=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let Re=Math.ceil(xe.width||Ce.width),Ee=Math.ceil(xe.height||Ce.height),Oe=xe.pixelRatio,Be=xe.x===void 0?Math.floor(Ce.x):xe.x,at=xe.y===void 0?Math.floor(Ce.y):xe.y,ut=xe.offset||0,nt=xe.drawBorder||!1,$e=xe.hitCanvasPixelRatio||1;if(!Re||!Ee){g.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const ct=Math.abs(Math.round(Ce.x)-Be)>.5?1:0,At=Math.abs(Math.round(Ce.y)-at)>.5?1:0;Re+=ut*2+ct,Ee+=ut*2+At,Be-=ut,at-=ut;const xt=new t.SceneCanvas({pixelRatio:Oe,width:Re,height:Ee}),It=new t.SceneCanvas({pixelRatio:Oe,width:0,height:0,willReadFrequently:!0}),jt=new t.HitCanvas({pixelRatio:$e,width:Re,height:Ee}),cn=xt.getContext(),Se=jt.getContext(),mt=new t.SceneCanvas({width:xt.width/xt.pixelRatio+Math.abs(Be),height:xt.height/xt.pixelRatio+Math.abs(at),pixelRatio:xt.pixelRatio}),Ke=mt.getContext();return jt.isCache=!0,xt.isCache=!0,this._cache.delete(I),this._filterUpToDate=!1,xe.imageSmoothingEnabled===!1&&(xt.getContext()._context.imageSmoothingEnabled=!1,It.getContext()._context.imageSmoothingEnabled=!1),cn.save(),Se.save(),Ke.save(),cn.translate(-Be,-at),Se.translate(-Be,-at),Ke.translate(-Be,-at),mt.x=Be,mt.y=at,this._isUnderCache=!0,this._clearSelfAndDescendantCache(S),this._clearSelfAndDescendantCache(A),this.drawScene(xt,this,mt),this.drawHit(jt,this),this._isUnderCache=!1,cn.restore(),Se.restore(),nt&&(cn.save(),cn.beginPath(),cn.rect(0,0,Re,Ee),cn.closePath(),cn.setAttr("strokeStyle","red"),cn.setAttr("lineWidth",5),cn.stroke(),cn.restore()),this._cache.set(I,{scene:xt,filter:It,hit:jt,buffer:mt,x:Be,y:at}),this._requestDraw(),this}isCached(){return this._cache.has(I)}getClientRect(ne){throw new Error('abstract "getClientRect" method call')}_transformedRect(ne,xe){const Ce=[{x:ne.x,y:ne.y},{x:ne.x+ne.width,y:ne.y},{x:ne.x+ne.width,y:ne.y+ne.height},{x:ne.x,y:ne.y+ne.height}];let Re=1/0,Ee=1/0,Oe=-1/0,Be=-1/0;const at=this.getAbsoluteTransform(xe);return Ce.forEach(function(ut){const nt=at.point(ut);Re===void 0&&(Re=Oe=nt.x,Ee=Be=nt.y),Re=Math.min(Re,nt.x),Ee=Math.min(Ee,nt.y),Oe=Math.max(Oe,nt.x),Be=Math.max(Be,nt.y)}),{x:Re,y:Ee,width:Oe-Re,height:Be-Ee}}_drawCachedSceneCanvas(ne){ne.save(),ne._applyOpacity(this),ne._applyGlobalCompositeOperation(this);const xe=this._getCanvasCache();ne.translate(xe.x,xe.y);const Ce=this._getCachedSceneCanvas(),Re=Ce.pixelRatio;ne.drawImage(Ce._canvas,0,0,Ce.width/Re,Ce.height/Re),ne.restore()}_drawCachedHitCanvas(ne){const xe=this._getCanvasCache(),Ce=xe.hit;ne.save(),ne.translate(xe.x,xe.y),ne.drawImage(Ce._canvas,0,0,Ce.width/Ce.pixelRatio,Ce.height/Ce.pixelRatio),ne.restore()}_getCachedSceneCanvas(){let ne=this.filters(),xe=this._getCanvasCache(),Ce=xe.scene,Re=xe.filter,Ee=Re.getContext(),Oe,Be,at,ut;if(ne){if(!this._filterUpToDate){const nt=Ce.pixelRatio;Re.setSize(Ce.width/Ce.pixelRatio,Ce.height/Ce.pixelRatio);try{for(Oe=ne.length,Ee.clear(),Ee.drawImage(Ce._canvas,0,0,Ce.getWidth()/nt,Ce.getHeight()/nt),Be=Ee.getImageData(0,0,Re.getWidth(),Re.getHeight()),at=0;at<Oe;at++){if(ut=ne[at],typeof ut!="function"){g.Util.error("Filter should be type of function, but got "+typeof ut+" instead. Please check correct filters");continue}ut.call(this,Be),Ee.putImageData(Be,0,0)}}catch($e){g.Util.error("Unable to apply filter. "+$e.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return Re}return Ce}on(ne,xe){if(this._cache&&this._cache.delete(r),arguments.length===3)return this._delegate.apply(this,arguments);const Ce=ne.split(ge);for(let Re=0;Re<Ce.length;Re++){const Oe=Ce[Re].split("."),Be=Oe[0],at=Oe[1]||"";this.eventListeners[Be]||(this.eventListeners[Be]=[]),this.eventListeners[Be].push({name:at,handler:xe})}return this}off(ne,xe){let Ce=(ne||"").split(ge),Re=Ce.length,Ee,Oe,Be,at,ut,nt;if(this._cache&&this._cache.delete(r),!ne)for(Oe in this.eventListeners)this._off(Oe);for(Ee=0;Ee<Re;Ee++)if(Be=Ce[Ee],at=Be.split("."),ut=at[0],nt=at[1],ut)this.eventListeners[ut]&&this._off(ut,nt,xe);else for(Oe in this.eventListeners)this._off(Oe,nt,xe);return this}dispatchEvent(ne){const xe={target:this,type:ne.type,evt:ne};return this.fire(ne.type,xe),this}addEventListener(ne,xe){return this.on(ne,function(Ce){xe.call(this,Ce.evt)}),this}removeEventListener(ne){return this.off(ne),this}_delegate(ne,xe,Ce){const Re=this;this.on(ne,function(Ee){const Oe=Ee.target.findAncestors(xe,!0,Re);for(let Be=0;Be<Oe.length;Be++)Ee=g.Util.cloneObject(Ee),Ee.currentTarget=Oe[Be],Ce.call(Oe[Be],Ee)})}remove(){return this.isDragging()&&this.stopDrag(),s.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(E),this._clearSelfAndDescendantCache(S),this._clearSelfAndDescendantCache(A),this._clearSelfAndDescendantCache(ae),this._clearSelfAndDescendantCache(pe),this._clearSelfAndDescendantCache(D)}_remove(){this._clearCaches();const ne=this.getParent();ne&&ne.children&&(ne.children.splice(this.index,1),ne._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(ne){const xe="get"+g.Util._capitalize(ne);return g.Util._isFunction(this[xe])?this[xe]():this.attrs[ne]}getAncestors(){let ne=this.getParent(),xe=[];for(;ne;)xe.push(ne),ne=ne.getParent();return xe}getAttrs(){return this.attrs||{}}setAttrs(ne){return this._batchTransformChanges(()=>{let xe,Ce;if(!ne)return this;for(xe in ne)xe!==z&&(Ce=X+g.Util._capitalize(xe),g.Util._isFunction(this[Ce])?this[Ce](ne[xe]):this._setAttr(xe,ne[xe]))}),this}isListening(){return this._getCache(D,this._isListening)}_isListening(ne){if(!this.listening())return!1;const Ce=this.getParent();return Ce&&Ce!==ne&&this!==ne?Ce._isListening(ne):!0}isVisible(){return this._getCache(pe,this._isVisible)}_isVisible(ne){if(!this.visible())return!1;const Ce=this.getParent();return Ce&&Ce!==ne&&this!==ne?Ce._isVisible(ne):!0}shouldDrawHit(ne,xe=!1){if(ne)return this._isVisible(ne)&&this._isListening(ne);const Ce=this.getLayer();let Re=!1;s.DD._dragElements.forEach(Oe=>{Oe.dragStatus==="dragging"&&(Oe.node.nodeType==="Stage"||Oe.node.getLayer()===Ce)&&(Re=!0)});const Ee=!xe&&!p.Konva.hitOnDragEnabled&&(Re||p.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!Ee}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let ne=this.getDepth(),xe=this,Ce=0,Re,Ee,Oe,Be;function at(nt){for(Re=[],Ee=nt.length,Oe=0;Oe<Ee;Oe++)Be=nt[Oe],Ce++,Be.nodeType!==se&&(Re=Re.concat(Be.getChildren().slice())),Be._id===xe._id&&(Oe=Ee);Re.length>0&&Re[0].getDepth()<=ne&&at(Re)}const ut=this.getStage();return xe.nodeType!==fe&&ut&&at(ut.getChildren()),Ce}getDepth(){let ne=0,xe=this.parent;for(;xe;)ne++,xe=xe.parent;return ne}_batchTransformChanges(ne){this._batchingTransformChange=!0,ne(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(oe),this._clearSelfAndDescendantCache(E)),this._needClearTransformCache=!1}setPosition(ne){return this._batchTransformChanges(()=>{this.x(ne.x),this.y(ne.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const ne=this.getStage();if(!ne)return null;const xe=ne.getPointerPosition();if(!xe)return null;const Ce=this.getAbsoluteTransform().copy();return Ce.invert(),Ce.point(xe)}getAbsolutePosition(ne){let xe=!1,Ce=this.parent;for(;Ce;){if(Ce.isCached()){xe=!0;break}Ce=Ce.parent}xe&&!ne&&(ne=!0);const Re=this.getAbsoluteTransform(ne).getMatrix(),Ee=new g.Transform,Oe=this.offset();return Ee.m=Re.slice(),Ee.translate(Oe.x,Oe.y),Ee.getTranslation()}setAbsolutePosition(ne){const{x:xe,y:Ce,...Re}=this._clearTransform();this.attrs.x=xe,this.attrs.y=Ce,this._clearCache(oe);const Ee=this._getAbsoluteTransform().copy();return Ee.invert(),Ee.translate(ne.x,ne.y),ne={x:this.attrs.x+Ee.getTranslation().x,y:this.attrs.y+Ee.getTranslation().y},this._setTransform(Re),this.setPosition({x:ne.x,y:ne.y}),this._clearCache(oe),this._clearSelfAndDescendantCache(E),this}_setTransform(ne){let xe;for(xe in ne)this.attrs[xe]=ne[xe]}_clearTransform(){const ne={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,ne}move(ne){let xe=ne.x,Ce=ne.y,Re=this.x(),Ee=this.y();return xe!==void 0&&(Re+=xe),Ce!==void 0&&(Ee+=Ce),this.setPosition({x:Re,y:Ee}),this}_eachAncestorReverse(ne,xe){let Ce=[],Re=this.getParent(),Ee,Oe;if(!(xe&&xe._id===this._id)){for(Ce.unshift(this);Re&&(!xe||Re._id!==xe._id);)Ce.unshift(Re),Re=Re.parent;for(Ee=Ce.length,Oe=0;Oe<Ee;Oe++)ne(Ce[Oe])}}rotate(ne){return this.rotation(this.rotation()+ne),this}moveToTop(){if(!this.parent)return g.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const ne=this.index,xe=this.parent.getChildren().length;return ne<xe-1?(this.parent.children.splice(ne,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return g.Util.warn("Node has no parent. moveUp function is ignored."),!1;const ne=this.index,xe=this.parent.getChildren().length;return ne<xe-1?(this.parent.children.splice(ne,1),this.parent.children.splice(ne+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return g.Util.warn("Node has no parent. moveDown function is ignored."),!1;const ne=this.index;return ne>0?(this.parent.children.splice(ne,1),this.parent.children.splice(ne-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return g.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const ne=this.index;return ne>0?(this.parent.children.splice(ne,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(ne){if(!this.parent)return g.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(ne<0||ne>=this.parent.children.length)&&g.Util.warn("Unexpected value "+ne+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const xe=this.index;return this.parent.children.splice(xe,1),this.parent.children.splice(ne,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(S,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let ne=this.opacity();const xe=this.getParent();return xe&&!xe._isUnderCache&&(ne*=xe.getAbsoluteOpacity()),ne}moveTo(ne){return this.getParent()!==ne&&(this._remove(),ne.add(this)),this}toObject(){let ne=this.getAttrs(),xe,Ce,Re,Ee,Oe;const Be={attrs:{},className:this.getClassName()};for(xe in ne)Ce=ne[xe],Oe=g.Util.isObject(Ce)&&!g.Util._isPlainObject(Ce)&&!g.Util._isArray(Ce),!Oe&&(Re=typeof this[xe]=="function"&&this[xe],delete ne[xe],Ee=Re?Re.call(this):null,ne[xe]=Ce,Ee!==Ce&&(Be.attrs[xe]=Ce));return g.Util._prepareToStringify(Be)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(ne,xe,Ce){const Re=[];xe&&this._isMatch(ne)&&Re.push(this);let Ee=this.parent;for(;Ee;){if(Ee===Ce)return Re;Ee._isMatch(ne)&&Re.push(Ee),Ee=Ee.parent}return Re}isAncestorOf(ne){return!1}findAncestor(ne,xe,Ce){return this.findAncestors(ne,xe,Ce)[0]}_isMatch(ne){if(!ne)return!1;if(typeof ne=="function")return ne(this);let xe=ne.replace(/ /g,"").split(","),Ce=xe.length,Re,Ee;for(Re=0;Re<Ce;Re++)if(Ee=xe[Re],g.Util.isValidSelector(Ee)||(g.Util.warn('Selector "'+Ee+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),g.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),g.Util.warn("Konva is awesome, right?")),Ee.charAt(0)==="#"){if(this.id()===Ee.slice(1))return!0}else if(Ee.charAt(0)==="."){if(this.hasName(Ee.slice(1)))return!0}else if(this.className===Ee||this.nodeType===Ee)return!0;return!1}getLayer(){const ne=this.getParent();return ne?ne.getLayer():null}getStage(){return this._getCache(ae,this._getStage)}_getStage(){const ne=this.getParent();return ne?ne.getStage():null}fire(ne,xe={},Ce){return xe.target=xe.target||this,Ce?this._fireAndBubble(ne,xe):this._fire(ne,xe),this}getAbsoluteTransform(ne){return ne?this._getAbsoluteTransform(ne):this._getCache(E,this._getAbsoluteTransform)}_getAbsoluteTransform(ne){let xe;if(ne)return xe=new g.Transform,this._eachAncestorReverse(function(Ce){const Re=Ce.transformsEnabled();Re==="all"?xe.multiply(Ce.getTransform()):Re==="position"&&xe.translate(Ce.x()-Ce.offsetX(),Ce.y()-Ce.offsetY())},ne),xe;{xe=this._cache.get(E)||new g.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(xe):xe.reset();const Ce=this.transformsEnabled();if(Ce==="all")xe.multiply(this.getTransform());else if(Ce==="position"){const Re=this.attrs.x||0,Ee=this.attrs.y||0,Oe=this.attrs.offsetX||0,Be=this.attrs.offsetY||0;xe.translate(Re-Oe,Ee-Be)}return xe.dirty=!1,xe}}getAbsoluteScale(ne){let xe=this;for(;xe;)xe._isUnderCache&&(ne=xe),xe=xe.getParent();const Re=this.getAbsoluteTransform(ne).decompose();return{x:Re.scaleX,y:Re.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(oe,this._getTransform)}_getTransform(){var ne,xe;const Ce=this._cache.get(oe)||new g.Transform;Ce.reset();const Re=this.x(),Ee=this.y(),Oe=p.Konva.getAngle(this.rotation()),Be=(ne=this.attrs.scaleX)!==null&&ne!==void 0?ne:1,at=(xe=this.attrs.scaleY)!==null&&xe!==void 0?xe:1,ut=this.attrs.skewX||0,nt=this.attrs.skewY||0,$e=this.attrs.offsetX||0,ct=this.attrs.offsetY||0;return(Re!==0||Ee!==0)&&Ce.translate(Re,Ee),Oe!==0&&Ce.rotate(Oe),(ut!==0||nt!==0)&&Ce.skew(ut,nt),(Be!==1||at!==1)&&Ce.scale(Be,at),($e!==0||ct!==0)&&Ce.translate(-1*$e,-1*ct),Ce.dirty=!1,Ce}clone(ne){let xe=g.Util.cloneObject(this.attrs),Ce,Re,Ee,Oe,Be;for(Ce in ne)xe[Ce]=ne[Ce];const at=new this.constructor(xe);for(Ce in this.eventListeners)for(Re=this.eventListeners[Ce],Ee=Re.length,Oe=0;Oe<Ee;Oe++)Be=Re[Oe],Be.name.indexOf(R)<0&&(at.eventListeners[Ce]||(at.eventListeners[Ce]=[]),at.eventListeners[Ce].push(Be));return at}_toKonvaCanvas(ne){ne=ne||{};const xe=this.getClientRect(),Ce=this.getStage(),Re=ne.x!==void 0?ne.x:Math.floor(xe.x),Ee=ne.y!==void 0?ne.y:Math.floor(xe.y),Oe=ne.pixelRatio||1,Be=new t.SceneCanvas({width:ne.width||Math.ceil(xe.width)||(Ce?Ce.width():0),height:ne.height||Math.ceil(xe.height)||(Ce?Ce.height():0),pixelRatio:Oe}),at=Be.getContext(),ut=new t.SceneCanvas({width:Be.width/Be.pixelRatio+Math.abs(Re),height:Be.height/Be.pixelRatio+Math.abs(Ee),pixelRatio:Be.pixelRatio});return ne.imageSmoothingEnabled===!1&&(at._context.imageSmoothingEnabled=!1),at.save(),(Re||Ee)&&at.translate(-1*Re,-1*Ee),this.drawScene(Be,void 0,ut),at.restore(),Be}toCanvas(ne){return this._toKonvaCanvas(ne)._canvas}toDataURL(ne){ne=ne||{};const xe=ne.mimeType||null,Ce=ne.quality||null,Re=this._toKonvaCanvas(ne).toDataURL(xe,Ce);return ne.callback&&ne.callback(Re),Re}toImage(ne){return new Promise((xe,Ce)=>{try{const Re=ne?.callback;Re&&delete ne.callback,g.Util._urlToImage(this.toDataURL(ne),function(Ee){xe(Ee),Re?.(Ee)})}catch(Re){Ce(Re)}})}toBlob(ne){return new Promise((xe,Ce)=>{try{const Re=ne?.callback;Re&&delete ne.callback,this.toCanvas(ne).toBlob(Ee=>{xe(Ee),Re?.(Ee)},ne?.mimeType,ne?.quality)}catch(Re){Ce(Re)}})}setSize(ne){return this.width(ne.width),this.height(ne.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():p.Konva.dragDistance}_off(ne,xe,Ce){let Re=this.eventListeners[ne],Ee,Oe,Be;for(Ee=0;Ee<Re.length;Ee++)if(Oe=Re[Ee].name,Be=Re[Ee].handler,(Oe!=="konva"||xe==="konva")&&(!xe||Oe===xe)&&(!Ce||Ce===Be)){if(Re.splice(Ee,1),Re.length===0){delete this.eventListeners[ne];break}Ee--}}_fireChangeEvent(ne,xe,Ce){this._fire(ne+F,{oldVal:xe,newVal:Ce})}addName(ne){if(!this.hasName(ne)){const xe=this.name(),Ce=xe?xe+" "+ne:ne;this.name(Ce)}return this}hasName(ne){if(!ne)return!1;const xe=this.name();return xe?(xe||"").split(/\s/g).indexOf(ne)!==-1:!1}removeName(ne){const xe=(this.name()||"").split(/\s/g),Ce=xe.indexOf(ne);return Ce!==-1&&(xe.splice(Ce,1),this.name(xe.join(" "))),this}setAttr(ne,xe){const Ce=this[X+g.Util._capitalize(ne)];return g.Util._isFunction(Ce)?Ce.call(this,xe):this._setAttr(ne,xe),this}_requestDraw(){if(p.Konva.autoDrawEnabled){const ne=this.getLayer()||this.getStage();ne?.batchDraw()}}_setAttr(ne,xe){const Ce=this.attrs[ne];Ce===xe&&!g.Util.isObject(xe)||(xe==null?delete this.attrs[ne]:this.attrs[ne]=xe,this._shouldFireChangeEvents&&this._fireChangeEvent(ne,Ce,xe),this._requestDraw())}_setComponentAttr(ne,xe,Ce){let Re;Ce!==void 0&&(Re=this.attrs[ne],Re||(this.attrs[ne]=this.getAttr(ne)),this.attrs[ne][xe]=Ce,this._fireChangeEvent(ne,Re,Ce))}_fireAndBubble(ne,xe,Ce){xe&&this.nodeType===se&&(xe.target=this);const Re=[O,N,H,j,V,Z];if(!(Re.indexOf(ne)!==-1&&(Ce&&(this===Ce||this.isAncestorOf&&this.isAncestorOf(Ce))||this.nodeType==="Stage"&&!Ce))){this._fire(ne,xe);const Oe=Re.indexOf(ne)!==-1&&Ce&&Ce.isAncestorOf&&Ce.isAncestorOf(this)&&!Ce.isAncestorOf(this.parent);(xe&&!xe.cancelBubble||!xe)&&this.parent&&this.parent.isListening()&&!Oe&&(Ce&&Ce.parent?this._fireAndBubble.call(this.parent,ne,xe,Ce):this._fireAndBubble.call(this.parent,ne,xe))}}_getProtoListeners(ne){var xe,Ce,Re;const Ee=(xe=this._cache.get(r))!==null&&xe!==void 0?xe:{};let Oe=Ee?.[ne];if(Oe===void 0){Oe=[];let Be=Object.getPrototypeOf(this);for(;Be;){const at=(Re=(Ce=Be.eventListeners)===null||Ce===void 0?void 0:Ce[ne])!==null&&Re!==void 0?Re:[];Oe.push(...at),Be=Object.getPrototypeOf(Be)}Ee[ne]=Oe,this._cache.set(r,Ee)}return Oe}_fire(ne,xe){xe=xe||{},xe.currentTarget=this,xe.type=ne;const Ce=this._getProtoListeners(ne);if(Ce)for(let Ee=0;Ee<Ce.length;Ee++)Ce[Ee].handler.call(this,xe);const Re=this.eventListeners[ne];if(Re)for(let Ee=0;Ee<Re.length;Ee++)Re[Ee].handler.call(this,xe)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(ne){const xe=ne?ne.pointerId:void 0,Ce=this.getStage(),Re=this.getAbsolutePosition();if(!Ce)return;const Ee=Ce._getPointerById(xe)||Ce._changedPointerPositions[0]||Re;s.DD._dragElements.set(this._id,{node:this,startPointerPos:Ee,offset:{x:Ee.x-Re.x,y:Ee.y-Re.y},dragStatus:"ready",pointerId:xe})}startDrag(ne,xe=!0){s.DD._dragElements.has(this._id)||this._createDragElement(ne);const Ce=s.DD._dragElements.get(this._id);Ce.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:ne&&ne.evt},xe)}_setDragPosition(ne,xe){const Ce=this.getStage()._getPointerById(xe.pointerId);if(!Ce)return;let Re={x:Ce.x-xe.offset.x,y:Ce.y-xe.offset.y};const Ee=this.dragBoundFunc();if(Ee!==void 0){const Oe=Ee.call(this,Re,ne);Oe?Re=Oe:g.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==Re.x||this._lastPos.y!==Re.y)&&(this.setAbsolutePosition(Re),this._requestDraw()),this._lastPos=Re}stopDrag(ne){const xe=s.DD._dragElements.get(this._id);xe&&(xe.dragStatus="stopped"),s.DD._endDragBefore(ne),s.DD._endDragAfter(ne)}setDraggable(ne){this._setAttr("draggable",ne),this._dragChange()}isDragging(){const ne=s.DD._dragElements.get(this._id);return ne?ne.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(ne){if(!(!(ne.evt.button!==void 0)||p.Konva.dragButtons.indexOf(ne.evt.button)>=0)||this.isDragging())return;let Re=!1;s.DD._dragElements.forEach(Ee=>{this.isAncestorOf(Ee.node)&&(Re=!0)}),Re||this._createDragElement(ne)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const xe=s.DD._dragElements.get(this._id),Ce=xe&&xe.dragStatus==="dragging",Re=xe&&xe.dragStatus==="ready";Ce?this.stopDrag():Re&&s.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(ne={x:0,y:0}){const xe=this.getStage();if(!xe)return!1;const Ce={x:-ne.x,y:-ne.y,width:xe.width()+2*ne.x,height:xe.height()+2*ne.y};return g.Util.haveIntersection(Ce,this.getClientRect())}static create(ne,xe){return g.Util._isString(ne)&&(ne=JSON.parse(ne)),this._createNode(ne,xe)}static _createNode(ne,xe){let Ce=J.prototype.getClassName.call(ne),Re=ne.children,Ee,Oe,Be;xe&&(ne.attrs.container=xe),p.Konva[Ce]||(g.Util.warn('Can not find a node with class name "'+Ce+'". Fallback to "Shape".'),Ce="Shape");const at=p.Konva[Ce];if(Ee=new at(ne.attrs),Re)for(Oe=Re.length,Be=0;Be<Oe;Be++)Ee.add(J._createNode(Re[Be]));return Ee}}w0.Node=J,J.prototype.nodeType="Node",J.prototype._attrsAffectingSize=[],J.prototype.eventListeners={},J.prototype.on.call(J.prototype,K,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(oe),this._clearSelfAndDescendantCache(E)}),J.prototype.on.call(J.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(pe)}),J.prototype.on.call(J.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(D)}),J.prototype.on.call(J.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(S)});const de=c.Factory.addGetterSetter;return de(J,"zIndex"),de(J,"absolutePosition"),de(J,"position"),de(J,"x",0,(0,v.getNumberValidator)()),de(J,"y",0,(0,v.getNumberValidator)()),de(J,"globalCompositeOperation","source-over",(0,v.getStringValidator)()),de(J,"opacity",1,(0,v.getNumberValidator)()),de(J,"name","",(0,v.getStringValidator)()),de(J,"id","",(0,v.getStringValidator)()),de(J,"rotation",0,(0,v.getNumberValidator)()),c.Factory.addComponentsGetterSetter(J,"scale",["x","y"]),de(J,"scaleX",1,(0,v.getNumberValidator)()),de(J,"scaleY",1,(0,v.getNumberValidator)()),c.Factory.addComponentsGetterSetter(J,"skew",["x","y"]),de(J,"skewX",0,(0,v.getNumberValidator)()),de(J,"skewY",0,(0,v.getNumberValidator)()),c.Factory.addComponentsGetterSetter(J,"offset",["x","y"]),de(J,"offsetX",0,(0,v.getNumberValidator)()),de(J,"offsetY",0,(0,v.getNumberValidator)()),de(J,"dragDistance",void 0,(0,v.getNumberValidator)()),de(J,"width",0,(0,v.getNumberValidator)()),de(J,"height",0,(0,v.getNumberValidator)()),de(J,"listening",!0,(0,v.getBooleanValidator)()),de(J,"preventDefault",!0,(0,v.getBooleanValidator)()),de(J,"filters",void 0,function(Ae){return this._filterUpToDate=!1,Ae}),de(J,"visible",!0,(0,v.getBooleanValidator)()),de(J,"transformsEnabled","all",(0,v.getStringValidator)()),de(J,"size"),de(J,"dragBoundFunc"),de(J,"draggable",!1,(0,v.getBooleanValidator)()),c.Factory.backCompat(J,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),w0}var S0={},qA;function Qx(){if(qA)return S0;qA=1,Object.defineProperty(S0,"__esModule",{value:!0}),S0.Container=void 0;const t=ro(),s=Gs(),c=lo();class p extends s.Node{constructor(){super(...arguments),this.children=[]}getChildren(v){const S=this.children||[];return v?S.filter(v):S}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(v=>{v.parent=null,v.index=0,v.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(v=>{v.parent=null,v.index=0,v.destroy()}),this.children=[],this._requestDraw(),this}add(...v){if(v.length===0)return this;if(v.length>1){for(let r=0;r<v.length;r++)this.add(v[r]);return this}const S=v[0];return S.getParent()?(S.moveTo(this),this):(this._validateAdd(S),S.index=this.getChildren().length,S.parent=this,S._clearCaches(),this.getChildren().push(S),this._fire("add",{child:S}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(v){return this._generalFind(v,!1)}findOne(v){const S=this._generalFind(v,!0);return S.length>0?S[0]:void 0}_generalFind(v,S){const r=[];return this._descendants(E=>{const A=E._isMatch(v);return A&&r.push(E),!!(A&&S)}),r}_descendants(v){let S=!1;const r=this.getChildren();for(const E of r){if(S=v(E),S)return!0;if(E.hasChildren()&&(S=E._descendants(v),S))return!0}return!1}toObject(){const v=s.Node.prototype.toObject.call(this);return v.children=[],this.getChildren().forEach(S=>{v.children.push(S.toObject())}),v}isAncestorOf(v){let S=v.getParent();for(;S;){if(S._id===this._id)return!0;S=S.getParent()}return!1}clone(v){const S=s.Node.prototype.clone.call(this,v);return this.getChildren().forEach(function(r){S.add(r.clone())}),S}getAllIntersections(v){const S=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(v)&&S.push(r)}),S}_clearSelfAndDescendantCache(v){var S;super._clearSelfAndDescendantCache(v),!this.isCached()&&((S=this.children)===null||S===void 0||S.forEach(function(r){r._clearSelfAndDescendantCache(v)}))}_setChildrenIndices(){var v;(v=this.children)===null||v===void 0||v.forEach(function(S,r){S.index=r}),this._requestDraw()}drawScene(v,S,r){const E=this.getLayer(),A=v||E&&E.getCanvas(),I=A&&A.getContext(),F=this._getCanvasCache(),z=F&&F.scene,R=A&&A.isCache;if(!this.isVisible()&&!R)return this;if(z){I.save();const D=this.getAbsoluteTransform(S).getMatrix();I.transform(D[0],D[1],D[2],D[3],D[4],D[5]),this._drawCachedSceneCanvas(I),I.restore()}else this._drawChildren("drawScene",A,S,r);return this}drawHit(v,S){if(!this.shouldDrawHit(S))return this;const r=this.getLayer(),E=v||r&&r.hitCanvas,A=E&&E.getContext(),I=this._getCanvasCache();if(I&&I.hit){A.save();const z=this.getAbsoluteTransform(S).getMatrix();A.transform(z[0],z[1],z[2],z[3],z[4],z[5]),this._drawCachedHitCanvas(A),A.restore()}else this._drawChildren("drawHit",E,S);return this}_drawChildren(v,S,r,E){var A;const I=S&&S.getContext(),F=this.clipWidth(),z=this.clipHeight(),R=this.clipFunc(),D=typeof F=="number"&&typeof z=="number"||R,O=r===this;if(D){I.save();const H=this.getAbsoluteTransform(r);let j=H.getMatrix();I.transform(j[0],j[1],j[2],j[3],j[4],j[5]),I.beginPath();let V;if(R)V=R.call(this,I,this);else{const Z=this.clipX(),X=this.clipY();I.rect(Z||0,X||0,F,z)}I.clip.apply(I,V),j=H.copy().invert().getMatrix(),I.transform(j[0],j[1],j[2],j[3],j[4],j[5])}const N=!O&&this.globalCompositeOperation()!=="source-over"&&v==="drawScene";N&&(I.save(),I._applyGlobalCompositeOperation(this)),(A=this.children)===null||A===void 0||A.forEach(function(H){H[v](S,r,E)}),N&&I.restore(),D&&I.restore()}getClientRect(v={}){var S;const r=v.skipTransform,E=v.relativeTo;let A,I,F,z,R={x:1/0,y:1/0,width:0,height:0};const D=this;(S=this.children)===null||S===void 0||S.forEach(function(H){if(!H.visible())return;const j=H.getClientRect({relativeTo:D,skipShadow:v.skipShadow,skipStroke:v.skipStroke});j.width===0&&j.height===0||(A===void 0?(A=j.x,I=j.y,F=j.x+j.width,z=j.y+j.height):(A=Math.min(A,j.x),I=Math.min(I,j.y),F=Math.max(F,j.x+j.width),z=Math.max(z,j.y+j.height)))});const O=this.find("Shape");let N=!1;for(let H=0;H<O.length;H++)if(O[H]._isVisible(this)){N=!0;break}return N&&A!==void 0?R={x:A,y:I,width:F-A,height:z-I}:R={x:0,y:0,width:0,height:0},r?R:this._transformedRect(R,E)}}return S0.Container=p,t.Factory.addComponentsGetterSetter(p,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(p,"clipX",void 0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(p,"clipY",void 0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(p,"clipWidth",void 0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(p,"clipHeight",void 0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(p,"clipFunc"),S0}var Q2={},Rp={},WA;function aR(){if(WA)return Rp;WA=1,Object.defineProperty(Rp,"__esModule",{value:!0}),Rp.getCapturedShape=p,Rp.createEvent=g,Rp.hasPointerCapture=v,Rp.setPointerCapture=S,Rp.releaseCapture=r;const t=Zi(),s=new Map,c=t.Konva._global.PointerEvent!==void 0;function p(E){return s.get(E)}function g(E){return{evt:E,pointerId:E.pointerId}}function v(E,A){return s.get(E)===A}function S(E,A){r(E),A.getStage()&&(s.set(E,A),c&&A._fire("gotpointercapture",g(new PointerEvent("gotpointercapture"))))}function r(E,A){const I=s.get(E);if(!I)return;const F=I.getStage();F&&F.content,s.delete(E),c&&I._fire("lostpointercapture",g(new PointerEvent("lostpointercapture")))}return Rp}var ZA;function qV(){return ZA||(ZA=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const s=Ms(),c=ro(),p=Qx(),g=Zi(),v=Jx(),S=FS(),r=Zi(),E=aR(),A="Stage",I="string",F="px",z="mouseout",R="mouseleave",D="mouseover",O="mouseenter",N="mousemove",H="mousedown",j="mouseup",V="pointermove",Z="pointerdown",X="pointerup",se="pointercancel",ge="lostpointercapture",ae="pointerout",oe="pointerleave",fe="pointerover",pe="pointerenter",K="contextmenu",ye="touchstart",J="touchend",de="touchmove",Ae="touchcancel",ne="wheel",xe=5,Ce=[[O,"_pointerenter"],[H,"_pointerdown"],[N,"_pointermove"],[j,"_pointerup"],[R,"_pointerleave"],[ye,"_pointerdown"],[de,"_pointermove"],[J,"_pointerup"],[Ae,"_pointercancel"],[D,"_pointerover"],[ne,"_wheel"],[K,"_contextmenu"],[Z,"_pointerdown"],[V,"_pointermove"],[X,"_pointerup"],[se,"_pointercancel"],[oe,"_pointerleave"],[ge,"_lostpointercapture"]],Re={mouse:{[ae]:z,[oe]:R,[fe]:D,[pe]:O,[V]:N,[Z]:H,[X]:j,[se]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[ae]:"touchout",[oe]:"touchleave",[fe]:"touchover",[pe]:"touchenter",[V]:de,[Z]:ye,[X]:J,[se]:Ae,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[ae]:ae,[oe]:oe,[fe]:fe,[pe]:pe,[V]:V,[Z]:Z,[X]:X,[se]:se,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Ee=nt=>nt.indexOf("pointer")>=0?"pointer":nt.indexOf("touch")>=0?"touch":"mouse",Oe=nt=>{const $e=Ee(nt);if($e==="pointer")return g.Konva.pointerEventsEnabled&&Re.pointer;if($e==="touch")return Re.touch;if($e==="mouse")return Re.mouse};function Be(nt={}){return(nt.clipFunc||nt.clipWidth||nt.clipHeight)&&s.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),nt}const at="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class ut extends p.Container{constructor($e){super(Be($e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Be(this.attrs)}),this._checkVisibility()}_validateAdd($e){const ct=$e.getType()==="Layer",At=$e.getType()==="FastLayer";ct||At||s.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const $e=this.visible()?"":"none";this.content.style.display=$e}setContainer($e){if(typeof $e===I){let ct;if($e.charAt(0)==="."){const At=$e.slice(1);$e=document.getElementsByClassName(At)[0]}else $e.charAt(0)!=="#"?ct=$e:ct=$e.slice(1),$e=document.getElementById(ct);if(!$e)throw"Can not find container in document with id "+ct}return this._setAttr("container",$e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),$e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const $e=this.children,ct=$e.length;for(let At=0;At<ct;At++)$e[At].clear();return this}clone($e){return $e||($e={}),$e.container=typeof document<"u"&&document.createElement("div"),p.Container.prototype.clone.call(this,$e)}destroy(){super.destroy();const $e=this.content;$e&&s.Util._isInDocument($e)&&this.container().removeChild($e);const ct=t.stages.indexOf(this);return ct>-1&&t.stages.splice(ct,1),s.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const $e=this._pointerPositions[0]||this._changedPointerPositions[0];return $e?{x:$e.x,y:$e.y}:(s.Util.warn(at),null)}_getPointerById($e){return this._pointerPositions.find(ct=>ct.id===$e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas($e){$e=$e||{},$e.x=$e.x||0,$e.y=$e.y||0,$e.width=$e.width||this.width(),$e.height=$e.height||this.height();const ct=new v.SceneCanvas({width:$e.width,height:$e.height,pixelRatio:$e.pixelRatio||1}),At=ct.getContext()._context,xt=this.children;return($e.x||$e.y)&&At.translate(-1*$e.x,-1*$e.y),xt.forEach(function(It){if(!It.isVisible())return;const jt=It._toKonvaCanvas($e);At.drawImage(jt._canvas,$e.x,$e.y,jt.getWidth()/jt.getPixelRatio(),jt.getHeight()/jt.getPixelRatio())}),ct}getIntersection($e){if(!$e)return null;const ct=this.children,At=ct.length,xt=At-1;for(let It=xt;It>=0;It--){const jt=ct[It].getIntersection($e);if(jt)return jt}return null}_resizeDOM(){const $e=this.width(),ct=this.height();this.content&&(this.content.style.width=$e+F,this.content.style.height=ct+F),this.bufferCanvas.setSize($e,ct),this.bufferHitCanvas.setSize($e,ct),this.children.forEach(At=>{At.setSize({width:$e,height:ct}),At.draw()})}add($e,...ct){if(arguments.length>1){for(let xt=0;xt<arguments.length;xt++)this.add(arguments[xt]);return this}super.add($e);const At=this.children.length;return At>xe&&s.Util.warn("The stage has "+At+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),$e.setSize({width:this.width(),height:this.height()}),$e.draw(),g.Konva.isBrowser&&this.content.appendChild($e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture($e){return E.hasPointerCapture($e,this)}setPointerCapture($e){E.setPointerCapture($e,this)}releaseCapture($e){E.releaseCapture($e,this)}getLayers(){return this.children}_bindContentEvents(){g.Konva.isBrowser&&Ce.forEach(([$e,ct])=>{this.content.addEventListener($e,At=>{this[ct](At)},{passive:!1})})}_pointerenter($e){this.setPointersPositions($e);const ct=Oe($e.type);ct&&this._fire(ct.pointerenter,{evt:$e,target:this,currentTarget:this})}_pointerover($e){this.setPointersPositions($e);const ct=Oe($e.type);ct&&this._fire(ct.pointerover,{evt:$e,target:this,currentTarget:this})}_getTargetShape($e){let ct=this[$e+"targetShape"];return ct&&!ct.getStage()&&(ct=null),ct}_pointerleave($e){const ct=Oe($e.type),At=Ee($e.type);if(!ct)return;this.setPointersPositions($e);const xt=this._getTargetShape(At),It=!(g.Konva.isDragging()||g.Konva.isTransforming())||g.Konva.hitOnDragEnabled;xt&&It?(xt._fireAndBubble(ct.pointerout,{evt:$e}),xt._fireAndBubble(ct.pointerleave,{evt:$e}),this._fire(ct.pointerleave,{evt:$e,target:this,currentTarget:this}),this[At+"targetShape"]=null):It&&(this._fire(ct.pointerleave,{evt:$e,target:this,currentTarget:this}),this._fire(ct.pointerout,{evt:$e,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown($e){const ct=Oe($e.type),At=Ee($e.type);if(!ct)return;this.setPointersPositions($e);let xt=!1;this._changedPointerPositions.forEach(It=>{const jt=this.getIntersection(It);if(S.DD.justDragged=!1,g.Konva["_"+At+"ListenClick"]=!0,!jt||!jt.isListening()){this[At+"ClickStartShape"]=void 0;return}g.Konva.capturePointerEventsEnabled&&jt.setPointerCapture(It.id),this[At+"ClickStartShape"]=jt,jt._fireAndBubble(ct.pointerdown,{evt:$e,pointerId:It.id}),xt=!0;const cn=$e.type.indexOf("touch")>=0;jt.preventDefault()&&$e.cancelable&&cn&&$e.preventDefault()}),xt||this._fire(ct.pointerdown,{evt:$e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove($e){const ct=Oe($e.type),At=Ee($e.type);if(!ct||(g.Konva.isDragging()&&S.DD.node.preventDefault()&&$e.cancelable&&$e.preventDefault(),this.setPointersPositions($e),!(!(g.Konva.isDragging()||g.Konva.isTransforming())||g.Konva.hitOnDragEnabled)))return;const It={};let jt=!1;const cn=this._getTargetShape(At);this._changedPointerPositions.forEach(Se=>{const mt=E.getCapturedShape(Se.id)||this.getIntersection(Se),Ke=Se.id,Ue={evt:$e,pointerId:Ke},je=cn!==mt;if(je&&cn&&(cn._fireAndBubble(ct.pointerout,{...Ue},mt),cn._fireAndBubble(ct.pointerleave,{...Ue},mt)),mt){if(It[mt._id])return;It[mt._id]=!0}mt&&mt.isListening()?(jt=!0,je&&(mt._fireAndBubble(ct.pointerover,{...Ue},cn),mt._fireAndBubble(ct.pointerenter,{...Ue},cn),this[At+"targetShape"]=mt),mt._fireAndBubble(ct.pointermove,{...Ue})):cn&&(this._fire(ct.pointerover,{evt:$e,target:this,currentTarget:this,pointerId:Ke}),this[At+"targetShape"]=null)}),jt||this._fire(ct.pointermove,{evt:$e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup($e){const ct=Oe($e.type),At=Ee($e.type);if(!ct)return;this.setPointersPositions($e);const xt=this[At+"ClickStartShape"],It=this[At+"ClickEndShape"],jt={};let cn=!1;this._changedPointerPositions.forEach(Se=>{const mt=E.getCapturedShape(Se.id)||this.getIntersection(Se);if(mt){if(mt.releaseCapture(Se.id),jt[mt._id])return;jt[mt._id]=!0}const Ke=Se.id,Ue={evt:$e,pointerId:Ke};let je=!1;g.Konva["_"+At+"InDblClickWindow"]?(je=!0,clearTimeout(this[At+"DblTimeout"])):S.DD.justDragged||(g.Konva["_"+At+"InDblClickWindow"]=!0,clearTimeout(this[At+"DblTimeout"])),this[At+"DblTimeout"]=setTimeout(function(){g.Konva["_"+At+"InDblClickWindow"]=!1},g.Konva.dblClickWindow),mt&&mt.isListening()?(cn=!0,this[At+"ClickEndShape"]=mt,mt._fireAndBubble(ct.pointerup,{...Ue}),g.Konva["_"+At+"ListenClick"]&&xt&&xt===mt&&(mt._fireAndBubble(ct.pointerclick,{...Ue}),je&&It&&It===mt&&mt._fireAndBubble(ct.pointerdblclick,{...Ue}))):(this[At+"ClickEndShape"]=null,g.Konva["_"+At+"ListenClick"]&&this._fire(ct.pointerclick,{evt:$e,target:this,currentTarget:this,pointerId:Ke}),je&&this._fire(ct.pointerdblclick,{evt:$e,target:this,currentTarget:this,pointerId:Ke}))}),cn||this._fire(ct.pointerup,{evt:$e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),g.Konva["_"+At+"ListenClick"]=!1,$e.cancelable&&At!=="touch"&&At!=="pointer"&&$e.preventDefault()}_contextmenu($e){this.setPointersPositions($e);const ct=this.getIntersection(this.getPointerPosition());ct&&ct.isListening()?ct._fireAndBubble(K,{evt:$e}):this._fire(K,{evt:$e,target:this,currentTarget:this})}_wheel($e){this.setPointersPositions($e);const ct=this.getIntersection(this.getPointerPosition());ct&&ct.isListening()?ct._fireAndBubble(ne,{evt:$e}):this._fire(ne,{evt:$e,target:this,currentTarget:this})}_pointercancel($e){this.setPointersPositions($e);const ct=E.getCapturedShape($e.pointerId)||this.getIntersection(this.getPointerPosition());ct&&ct._fireAndBubble(X,E.createEvent($e)),E.releaseCapture($e.pointerId)}_lostpointercapture($e){E.releaseCapture($e.pointerId)}setPointersPositions($e){const ct=this._getContentPosition();let At=null,xt=null;$e=$e||window.event,$e.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call($e.touches,It=>{this._pointerPositions.push({id:It.identifier,x:(It.clientX-ct.left)/ct.scaleX,y:(It.clientY-ct.top)/ct.scaleY})}),Array.prototype.forEach.call($e.changedTouches||$e.touches,It=>{this._changedPointerPositions.push({id:It.identifier,x:(It.clientX-ct.left)/ct.scaleX,y:(It.clientY-ct.top)/ct.scaleY})})):(At=($e.clientX-ct.left)/ct.scaleX,xt=($e.clientY-ct.top)/ct.scaleY,this.pointerPos={x:At,y:xt},this._pointerPositions=[{x:At,y:xt,id:s.Util._getFirstPointerId($e)}],this._changedPointerPositions=[{x:At,y:xt,id:s.Util._getFirstPointerId($e)}])}_setPointerPosition($e){s.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions($e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const $e=this.content.getBoundingClientRect();return{top:$e.top,left:$e.left,scaleX:$e.width/this.content.clientWidth||1,scaleY:$e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new v.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new v.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!g.Konva.isBrowser)return;const $e=this.container();if(!$e)throw"Stage has no container. A container is required.";$e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),$e.appendChild(this.content),this._resizeDOM()}cache(){return s.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function($e){$e.batchDraw()}),this}}t.Stage=ut,ut.prototype.nodeType=A,(0,r._registerNode)(ut),c.Factory.addGetterSetter(ut,"container"),g.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(nt=>{nt.batchDraw()})})})(Q2)),Q2}var T0={},ew={},YA;function Aa(){return YA||(YA=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const s=Zi(),c=Ms(),p=ro(),g=Gs(),v=lo(),S=Zi(),r=aR(),E="hasShadow",A="shadowRGBA",I="patternImage",F="linearGradient",z="radialGradient";let R;function D(){return R||(R=c.Util.createCanvasElement().getContext("2d"),R)}t.shapes={};function O(oe){const fe=this.attrs.fillRule;fe?oe.fill(fe):oe.fill()}function N(oe){oe.stroke()}function H(oe){const fe=this.attrs.fillRule;fe?oe.fill(fe):oe.fill()}function j(oe){oe.stroke()}function V(){this._clearCache(E)}function Z(){this._clearCache(A)}function X(){this._clearCache(I)}function se(){this._clearCache(F)}function ge(){this._clearCache(z)}class ae extends g.Node{constructor(fe){super(fe);let pe;for(;pe=c.Util.getRandomColor(),!(pe&&!(pe in t.shapes)););this.colorKey=pe,t.shapes[pe]=this}getContext(){return c.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return c.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(E,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(I,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const pe=D().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(pe&&pe.setTransform){const K=new c.Transform;K.translate(this.fillPatternX(),this.fillPatternY()),K.rotate(s.Konva.getAngle(this.fillPatternRotation())),K.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),K.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const ye=K.getMatrix(),J=typeof DOMMatrix>"u"?{a:ye[0],b:ye[1],c:ye[2],d:ye[3],e:ye[4],f:ye[5]}:new DOMMatrix(ye);pe.setTransform(J)}return pe}}_getLinearGradient(){return this._getCache(F,this.__getLinearGradient)}__getLinearGradient(){const fe=this.fillLinearGradientColorStops();if(fe){const pe=D(),K=this.fillLinearGradientStartPoint(),ye=this.fillLinearGradientEndPoint(),J=pe.createLinearGradient(K.x,K.y,ye.x,ye.y);for(let de=0;de<fe.length;de+=2)J.addColorStop(fe[de],fe[de+1]);return J}}_getRadialGradient(){return this._getCache(z,this.__getRadialGradient)}__getRadialGradient(){const fe=this.fillRadialGradientColorStops();if(fe){const pe=D(),K=this.fillRadialGradientStartPoint(),ye=this.fillRadialGradientEndPoint(),J=pe.createRadialGradient(K.x,K.y,this.fillRadialGradientStartRadius(),ye.x,ye.y,this.fillRadialGradientEndRadius());for(let de=0;de<fe.length;de+=2)J.addColorStop(fe[de],fe[de+1]);return J}}getShadowRGBA(){return this._getCache(A,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const fe=c.Util.colorToRGBA(this.shadowColor());if(fe)return"rgba("+fe.r+","+fe.g+","+fe.b+","+fe.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const fe=this.hitStrokeWidth();return fe==="auto"?this.hasStroke():this.strokeEnabled()&&!!fe}intersects(fe){const pe=this.getStage();if(!pe)return!1;const K=pe.bufferHitCanvas;return K.getContext().clear(),this.drawHit(K,void 0,!0),K.context.getImageData(Math.round(fe.x),Math.round(fe.y),1,1).data[3]>0}destroy(){return g.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(fe){var pe;if(!((pe=this.attrs.perfectDrawEnabled)!==null&&pe!==void 0?pe:!0))return!1;const ye=fe||this.hasFill(),J=this.hasStroke(),de=this.getAbsoluteOpacity()!==1;if(ye&&J&&de)return!0;const Ae=this.hasShadow(),ne=this.shadowForStrokeEnabled();return!!(ye&&J&&Ae&&ne)}setStrokeHitEnabled(fe){c.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),fe?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const fe=this.size();return{x:this._centroid?-fe.width/2:0,y:this._centroid?-fe.height/2:0,width:fe.width,height:fe.height}}getClientRect(fe={}){let pe=!1,K=this.getParent();for(;K;){if(K.isCached()){pe=!0;break}K=K.getParent()}const ye=fe.skipTransform,J=fe.relativeTo||pe&&this.getStage()||void 0,de=this.getSelfRect(),ne=!fe.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,xe=de.width+ne,Ce=de.height+ne,Re=!fe.skipShadow&&this.hasShadow(),Ee=Re?this.shadowOffsetX():0,Oe=Re?this.shadowOffsetY():0,Be=xe+Math.abs(Ee),at=Ce+Math.abs(Oe),ut=Re&&this.shadowBlur()||0,nt=Be+ut*2,$e=at+ut*2,ct={width:nt,height:$e,x:-(ne/2+ut)+Math.min(Ee,0)+de.x,y:-(ne/2+ut)+Math.min(Oe,0)+de.y};return ye?ct:this._transformedRect(ct,J)}drawScene(fe,pe,K){const ye=this.getLayer(),J=fe||ye.getCanvas(),de=J.getContext(),Ae=this._getCanvasCache(),ne=this.getSceneFunc(),xe=this.hasShadow();let Ce;const Re=pe===this;if(!this.isVisible()&&!Re)return this;if(Ae){de.save();const Ee=this.getAbsoluteTransform(pe).getMatrix();return de.transform(Ee[0],Ee[1],Ee[2],Ee[3],Ee[4],Ee[5]),this._drawCachedSceneCanvas(de),de.restore(),this}if(!ne)return this;if(de.save(),this._useBufferCanvas()){Ce=this.getStage();const Ee=K||Ce.bufferCanvas,Oe=Ee.getContext();Oe.clear(),Oe.save(),Oe._applyLineJoin(this);const Be=this.getAbsoluteTransform(pe).getMatrix();Oe.transform(Be[0],Be[1],Be[2],Be[3],Be[4],Be[5]),ne.call(this,Oe,this),Oe.restore();const at=Ee.pixelRatio;xe&&de._applyShadow(this),de._applyOpacity(this),de._applyGlobalCompositeOperation(this),de.drawImage(Ee._canvas,Ee.x||0,Ee.y||0,Ee.width/at,Ee.height/at)}else{if(de._applyLineJoin(this),!Re){const Ee=this.getAbsoluteTransform(pe).getMatrix();de.transform(Ee[0],Ee[1],Ee[2],Ee[3],Ee[4],Ee[5]),de._applyOpacity(this),de._applyGlobalCompositeOperation(this)}xe&&de._applyShadow(this),ne.call(this,de,this)}return de.restore(),this}drawHit(fe,pe,K=!1){if(!this.shouldDrawHit(pe,K))return this;const ye=this.getLayer(),J=fe||ye.hitCanvas,de=J&&J.getContext(),Ae=this.hitFunc()||this.sceneFunc(),ne=this._getCanvasCache(),xe=ne&&ne.hit;if(this.colorKey||c.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),xe){de.save();const Re=this.getAbsoluteTransform(pe).getMatrix();return de.transform(Re[0],Re[1],Re[2],Re[3],Re[4],Re[5]),this._drawCachedHitCanvas(de),de.restore(),this}if(!Ae)return this;if(de.save(),de._applyLineJoin(this),!(this===pe)){const Re=this.getAbsoluteTransform(pe).getMatrix();de.transform(Re[0],Re[1],Re[2],Re[3],Re[4],Re[5])}return Ae.call(this,de,this),de.restore(),this}drawHitFromCache(fe=0){const pe=this._getCanvasCache(),K=this._getCachedSceneCanvas(),ye=pe.hit,J=ye.getContext(),de=ye.getWidth(),Ae=ye.getHeight();J.clear(),J.drawImage(K._canvas,0,0,de,Ae);try{const ne=J.getImageData(0,0,de,Ae),xe=ne.data,Ce=xe.length,Re=c.Util._hexToRgb(this.colorKey);for(let Ee=0;Ee<Ce;Ee+=4)xe[Ee+3]>fe?(xe[Ee]=Re.r,xe[Ee+1]=Re.g,xe[Ee+2]=Re.b,xe[Ee+3]=255):xe[Ee+3]=0;J.putImageData(ne,0,0)}catch(ne){c.Util.error("Unable to draw hit graph from cached scene canvas. "+ne.message)}return this}hasPointerCapture(fe){return r.hasPointerCapture(fe,this)}setPointerCapture(fe){r.setPointerCapture(fe,this)}releaseCapture(fe){r.releaseCapture(fe,this)}}t.Shape=ae,ae.prototype._fillFunc=O,ae.prototype._strokeFunc=N,ae.prototype._fillFuncHit=H,ae.prototype._strokeFuncHit=j,ae.prototype._centroid=!1,ae.prototype.nodeType="Shape",(0,S._registerNode)(ae),ae.prototype.eventListeners={},ae.prototype.on.call(ae.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",V),ae.prototype.on.call(ae.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Z),ae.prototype.on.call(ae.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",X),ae.prototype.on.call(ae.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",se),ae.prototype.on.call(ae.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",ge),p.Factory.addGetterSetter(ae,"stroke",void 0,(0,v.getStringOrGradientValidator)()),p.Factory.addGetterSetter(ae,"strokeWidth",2,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillAfterStrokeEnabled",!1),p.Factory.addGetterSetter(ae,"hitStrokeWidth","auto",(0,v.getNumberOrAutoValidator)()),p.Factory.addGetterSetter(ae,"strokeHitEnabled",!0,(0,v.getBooleanValidator)()),p.Factory.addGetterSetter(ae,"perfectDrawEnabled",!0,(0,v.getBooleanValidator)()),p.Factory.addGetterSetter(ae,"shadowForStrokeEnabled",!0,(0,v.getBooleanValidator)()),p.Factory.addGetterSetter(ae,"lineJoin"),p.Factory.addGetterSetter(ae,"lineCap"),p.Factory.addGetterSetter(ae,"sceneFunc"),p.Factory.addGetterSetter(ae,"hitFunc"),p.Factory.addGetterSetter(ae,"dash"),p.Factory.addGetterSetter(ae,"dashOffset",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"shadowColor",void 0,(0,v.getStringValidator)()),p.Factory.addGetterSetter(ae,"shadowBlur",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"shadowOpacity",1,(0,v.getNumberValidator)()),p.Factory.addComponentsGetterSetter(ae,"shadowOffset",["x","y"]),p.Factory.addGetterSetter(ae,"shadowOffsetX",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"shadowOffsetY",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillPatternImage"),p.Factory.addGetterSetter(ae,"fill",void 0,(0,v.getStringOrGradientValidator)()),p.Factory.addGetterSetter(ae,"fillPatternX",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillPatternY",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillLinearGradientColorStops"),p.Factory.addGetterSetter(ae,"strokeLinearGradientColorStops"),p.Factory.addGetterSetter(ae,"fillRadialGradientStartRadius",0),p.Factory.addGetterSetter(ae,"fillRadialGradientEndRadius",0),p.Factory.addGetterSetter(ae,"fillRadialGradientColorStops"),p.Factory.addGetterSetter(ae,"fillPatternRepeat","repeat"),p.Factory.addGetterSetter(ae,"fillEnabled",!0),p.Factory.addGetterSetter(ae,"strokeEnabled",!0),p.Factory.addGetterSetter(ae,"shadowEnabled",!0),p.Factory.addGetterSetter(ae,"dashEnabled",!0),p.Factory.addGetterSetter(ae,"strokeScaleEnabled",!0),p.Factory.addGetterSetter(ae,"fillPriority","color"),p.Factory.addComponentsGetterSetter(ae,"fillPatternOffset",["x","y"]),p.Factory.addGetterSetter(ae,"fillPatternOffsetX",0,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillPatternOffsetY",0,(0,v.getNumberValidator)()),p.Factory.addComponentsGetterSetter(ae,"fillPatternScale",["x","y"]),p.Factory.addGetterSetter(ae,"fillPatternScaleX",1,(0,v.getNumberValidator)()),p.Factory.addGetterSetter(ae,"fillPatternScaleY",1,(0,v.getNumberValidator)()),p.Factory.addComponentsGetterSetter(ae,"fillLinearGradientStartPoint",["x","y"]),p.Factory.addComponentsGetterSetter(ae,"strokeLinearGradientStartPoint",["x","y"]),p.Factory.addGetterSetter(ae,"fillLinearGradientStartPointX",0),p.Factory.addGetterSetter(ae,"strokeLinearGradientStartPointX",0),p.Factory.addGetterSetter(ae,"fillLinearGradientStartPointY",0),p.Factory.addGetterSetter(ae,"strokeLinearGradientStartPointY",0),p.Factory.addComponentsGetterSetter(ae,"fillLinearGradientEndPoint",["x","y"]),p.Factory.addComponentsGetterSetter(ae,"strokeLinearGradientEndPoint",["x","y"]),p.Factory.addGetterSetter(ae,"fillLinearGradientEndPointX",0),p.Factory.addGetterSetter(ae,"strokeLinearGradientEndPointX",0),p.Factory.addGetterSetter(ae,"fillLinearGradientEndPointY",0),p.Factory.addGetterSetter(ae,"strokeLinearGradientEndPointY",0),p.Factory.addComponentsGetterSetter(ae,"fillRadialGradientStartPoint",["x","y"]),p.Factory.addGetterSetter(ae,"fillRadialGradientStartPointX",0),p.Factory.addGetterSetter(ae,"fillRadialGradientStartPointY",0),p.Factory.addComponentsGetterSetter(ae,"fillRadialGradientEndPoint",["x","y"]),p.Factory.addGetterSetter(ae,"fillRadialGradientEndPointX",0),p.Factory.addGetterSetter(ae,"fillRadialGradientEndPointY",0),p.Factory.addGetterSetter(ae,"fillPatternRotation",0),p.Factory.addGetterSetter(ae,"fillRule",void 0,(0,v.getStringValidator)()),p.Factory.backCompat(ae,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(ew)),ew}var XA;function lR(){if(XA)return T0;XA=1,Object.defineProperty(T0,"__esModule",{value:!0}),T0.Layer=void 0;const t=Ms(),s=Qx(),c=Gs(),p=ro(),g=Jx(),v=lo(),S=Aa(),r=Zi(),E="#",A="beforeDraw",I="draw",F=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],z=F.length;class R extends s.Container{constructor(O){super(O),this.canvas=new g.SceneCanvas,this.hitCanvas=new g.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(O){return this.getContext().clear(O),this.getHitCanvas().getContext().clear(O),this}setZIndex(O){super.setZIndex(O);const N=this.getStage();return N&&N.content&&(N.content.removeChild(this.getNativeCanvasElement()),O<N.children.length-1?N.content.insertBefore(this.getNativeCanvasElement(),N.children[O+1].getCanvas()._canvas):N.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){c.Node.prototype.moveToTop.call(this);const O=this.getStage();return O&&O.content&&(O.content.removeChild(this.getNativeCanvasElement()),O.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!c.Node.prototype.moveUp.call(this))return!1;const N=this.getStage();return!N||!N.content?!1:(N.content.removeChild(this.getNativeCanvasElement()),this.index<N.children.length-1?N.content.insertBefore(this.getNativeCanvasElement(),N.children[this.index+1].getCanvas()._canvas):N.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(c.Node.prototype.moveDown.call(this)){const O=this.getStage();if(O){const N=O.children;O.content&&(O.content.removeChild(this.getNativeCanvasElement()),O.content.insertBefore(this.getNativeCanvasElement(),N[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(c.Node.prototype.moveToBottom.call(this)){const O=this.getStage();if(O){const N=O.children;O.content&&(O.content.removeChild(this.getNativeCanvasElement()),O.content.insertBefore(this.getNativeCanvasElement(),N[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const O=this.getNativeCanvasElement();return c.Node.prototype.remove.call(this),O&&O.parentNode&&t.Util._isInDocument(O)&&O.parentNode.removeChild(O),this}getStage(){return this.parent}setSize({width:O,height:N}){return this.canvas.setSize(O,N),this.hitCanvas.setSize(O,N),this._setSmoothEnabled(),this}_validateAdd(O){const N=O.getType();N!=="Group"&&N!=="Shape"&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(O){return O=O||{},O.width=O.width||this.getWidth(),O.height=O.height||this.getHeight(),O.x=O.x!==void 0?O.x:this.x(),O.y=O.y!==void 0?O.y:this.y(),c.Node.prototype._toKonvaCanvas.call(this,O)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(O){if(!this.isListening()||!this.isVisible())return null;let N=1,H=!1;for(;;){for(let j=0;j<z;j++){const V=F[j],Z=this._getIntersection({x:O.x+V.x*N,y:O.y+V.y*N}),X=Z.shape;if(X)return X;if(H=!!Z.antialiased,!Z.antialiased)break}if(H)N+=1;else return null}}_getIntersection(O){const N=this.hitCanvas.pixelRatio,H=this.hitCanvas.context.getImageData(Math.round(O.x*N),Math.round(O.y*N),1,1).data,j=H[3];if(j===255){const V=t.Util._rgbToHex(H[0],H[1],H[2]),Z=S.shapes[E+V];return Z?{shape:Z}:{antialiased:!0}}else if(j>0)return{antialiased:!0};return{}}drawScene(O,N,H){const j=this.getLayer(),V=O||j&&j.getCanvas();return this._fire(A,{node:this}),this.clearBeforeDraw()&&V.getContext().clear(),s.Container.prototype.drawScene.call(this,V,N,H),this._fire(I,{node:this}),this}drawHit(O,N){const H=this.getLayer(),j=O||H&&H.hitCanvas;return H&&H.clearBeforeDraw()&&H.getHitCanvas().getContext().clear(),s.Container.prototype.drawHit.call(this,j,N),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(O){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(O)}getHitGraphEnabled(O){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const O=this.parent;!!this.hitCanvas._canvas.parentNode?O.content.removeChild(this.hitCanvas._canvas):O.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}return T0.Layer=R,R.prototype.nodeType="Layer",(0,r._registerNode)(R),p.Factory.addGetterSetter(R,"imageSmoothingEnabled",!0),p.Factory.addGetterSetter(R,"clearBeforeDraw",!0),p.Factory.addGetterSetter(R,"hitGraphEnabled",!0,(0,v.getBooleanValidator)()),T0}var C0={},KA;function WV(){if(KA)return C0;KA=1,Object.defineProperty(C0,"__esModule",{value:!0}),C0.FastLayer=void 0;const t=Ms(),s=lR(),c=Zi();let p=class extends s.Layer{constructor(v){super(v),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return C0.FastLayer=p,p.prototype.nodeType="FastLayer",(0,c._registerNode)(p),C0}var E0={},JA;function BS(){if(JA)return E0;JA=1,Object.defineProperty(E0,"__esModule",{value:!0}),E0.Group=void 0;const t=Ms(),s=Qx(),c=Zi();let p=class extends s.Container{_validateAdd(v){const S=v.getType();S!=="Group"&&S!=="Shape"&&t.Util.throw("You may only add groups and shapes to groups.")}};return E0.Group=p,p.prototype.nodeType="Group",(0,c._registerNode)(p),E0}var A0={},QA;function NS(){if(QA)return A0;QA=1,Object.defineProperty(A0,"__esModule",{value:!0}),A0.Animation=void 0;const t=Zi(),s=Ms(),c=(function(){return t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return new Date().getTime()}})();let p=class Yg{constructor(v,S){this.id=Yg.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:c(),frameRate:0},this.func=v,this.setLayers(S)}setLayers(v){let S=[];return v&&(S=Array.isArray(v)?v:[v]),this.layers=S,this}getLayers(){return this.layers}addLayer(v){const S=this.layers,r=S.length;for(let E=0;E<r;E++)if(S[E]._id===v._id)return!1;return this.layers.push(v),!0}isRunning(){const S=Yg.animations,r=S.length;for(let E=0;E<r;E++)if(S[E].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=c(),Yg._addAnimation(this),this}stop(){return Yg._removeAnimation(this),this}_updateFrameObject(v){this.frame.timeDiff=v-this.frame.lastTime,this.frame.lastTime=v,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(v){this.animations.push(v),this._handleAnimation()}static _removeAnimation(v){const S=v.id,r=this.animations,E=r.length;for(let A=0;A<E;A++)if(r[A].id===S){this.animations.splice(A,1);break}}static _runFrames(){const v={},S=this.animations;for(let r=0;r<S.length;r++){const E=S[r],A=E.layers,I=E.func;E._updateFrameObject(c());const F=A.length;let z;if(I?z=I.call(E,E.frame)!==!1:z=!0,!!z)for(let R=0;R<F;R++){const D=A[R];D._id!==void 0&&(v[D._id]=D)}}for(const r in v)v.hasOwnProperty(r)&&v[r].batchDraw()}static _animationLoop(){const v=Yg;v.animations.length?(v._runFrames(),s.Util.requestAnimFrame(v._animationLoop)):v.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,s.Util.requestAnimFrame(this._animationLoop))}};return A0.Animation=p,p.animations=[],p.animIdCounter=0,p.animRunning=!1,A0}var tw={},e4;function ZV(){return e4||(e4=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const s=Ms(),c=NS(),p=Gs(),g=Zi(),v={node:1,duration:1,easing:1,onFinish:1,yoyo:1},S=1,r=2,E=3,A=["fill","stroke","shadowColor"];let I=0;class F{constructor(D,O,N,H,j,V,Z){this.prop=D,this.propFunc=O,this.begin=H,this._pos=H,this.duration=V,this._change=0,this.prevPos=0,this.yoyo=Z,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=N,this._change=j-this.begin,this.pause()}fire(D){const O=this[D];O&&O()}setTime(D){D>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():D<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=D,this.update())}getTime(){return this._time}setPosition(D){this.prevPos=this._pos,this.propFunc(D),this._pos=D}getPosition(D){return D===void 0&&(D=this._time),this.func(D,this.begin,this._change,this.duration)}play(){this.state=r,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=E,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(D){this.pause(),this._time=D,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const D=this.getTimer()-this._startTime;this.state===r?this.setTime(D):this.state===E&&this.setTime(this.duration-D)}pause(){this.state=S,this.fire("onPause")}getTimer(){return new Date().getTime()}}class z{constructor(D){const O=this,N=D.node,H=N._id,j=D.easing||t.Easings.Linear,V=!!D.yoyo;let Z,X;typeof D.duration>"u"?Z=.3:D.duration===0?Z=.001:Z=D.duration,this.node=N,this._id=I++;const se=N.getLayer()||(N instanceof g.Konva.Stage?N.getLayers():null);se||s.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new c.Animation(function(){O.tween.onEnterFrame()},se),this.tween=new F(X,function(ge){O._tweenFunc(ge)},j,0,1,Z*1e3,V),this._addListeners(),z.attrs[H]||(z.attrs[H]={}),z.attrs[H][this._id]||(z.attrs[H][this._id]={}),z.tweens[H]||(z.tweens[H]={});for(X in D)v[X]===void 0&&this._addAttr(X,D[X]);this.reset(),this.onFinish=D.onFinish,this.onReset=D.onReset,this.onUpdate=D.onUpdate}_addAttr(D,O){const N=this.node,H=N._id;let j,V,Z,X,se;const ge=z.tweens[H][D];ge&&delete z.attrs[H][ge][D];let ae=N.getAttr(D);if(s.Util._isArray(O))if(j=[],V=Math.max(O.length,ae.length),D==="points"&&O.length!==ae.length&&(O.length>ae.length?(X=ae,ae=s.Util._prepareArrayForTween(ae,O,N.closed())):(Z=O,O=s.Util._prepareArrayForTween(O,ae,N.closed()))),D.indexOf("fill")===0)for(let oe=0;oe<V;oe++)if(oe%2===0)j.push(O[oe]-ae[oe]);else{const fe=s.Util.colorToRGBA(ae[oe]);se=s.Util.colorToRGBA(O[oe]),ae[oe]=fe,j.push({r:se.r-fe.r,g:se.g-fe.g,b:se.b-fe.b,a:se.a-fe.a})}else for(let oe=0;oe<V;oe++)j.push(O[oe]-ae[oe]);else A.indexOf(D)!==-1?(ae=s.Util.colorToRGBA(ae),se=s.Util.colorToRGBA(O),j={r:se.r-ae.r,g:se.g-ae.g,b:se.b-ae.b,a:se.a-ae.a}):j=O-ae;z.attrs[H][this._id][D]={start:ae,diff:j,end:O,trueEnd:Z,trueStart:X},z.tweens[H][D]=this._id}_tweenFunc(D){const O=this.node,N=z.attrs[O._id][this._id];let H,j,V,Z,X,se,ge,ae;for(H in N){if(j=N[H],V=j.start,Z=j.diff,ae=j.end,s.Util._isArray(V))if(X=[],ge=Math.max(V.length,ae.length),H.indexOf("fill")===0)for(se=0;se<ge;se++)se%2===0?X.push((V[se]||0)+Z[se]*D):X.push("rgba("+Math.round(V[se].r+Z[se].r*D)+","+Math.round(V[se].g+Z[se].g*D)+","+Math.round(V[se].b+Z[se].b*D)+","+(V[se].a+Z[se].a*D)+")");else for(se=0;se<ge;se++)X.push((V[se]||0)+Z[se]*D);else A.indexOf(H)!==-1?X="rgba("+Math.round(V.r+Z.r*D)+","+Math.round(V.g+Z.g*D)+","+Math.round(V.b+Z.b*D)+","+(V.a+Z.a*D)+")":X=V+Z*D;O.setAttr(H,X)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const D=this.node,O=z.attrs[D._id][this._id];O.points&&O.points.trueEnd&&D.setAttr("points",O.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const D=this.node,O=z.attrs[D._id][this._id];O.points&&O.points.trueStart&&D.points(O.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(D){return this.tween.seek(D*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const D=this.node._id,O=this._id,N=z.tweens[D];this.pause(),this.anim&&this.anim.stop();for(const H in N)delete z.tweens[D][H];delete z.attrs[D][O],z.tweens[D]&&(Object.keys(z.tweens[D]).length===0&&delete z.tweens[D],Object.keys(z.attrs[D]).length===0&&delete z.attrs[D])}}t.Tween=z,z.attrs={},z.tweens={},p.Node.prototype.to=function(R){const D=R.onFinish;R.node=this,R.onFinish=function(){this.destroy(),D&&D()},new z(R).play()},t.Easings={BackEaseIn(R,D,O,N){return O*(R/=N)*R*((1.70158+1)*R-1.70158)+D},BackEaseOut(R,D,O,N){return O*((R=R/N-1)*R*((1.70158+1)*R+1.70158)+1)+D},BackEaseInOut(R,D,O,N){let H=1.70158;return(R/=N/2)<1?O/2*(R*R*(((H*=1.525)+1)*R-H))+D:O/2*((R-=2)*R*(((H*=1.525)+1)*R+H)+2)+D},ElasticEaseIn(R,D,O,N,H,j){let V=0;return R===0?D:(R/=N)===1?D+O:(j||(j=N*.3),!H||H<Math.abs(O)?(H=O,V=j/4):V=j/(2*Math.PI)*Math.asin(O/H),-(H*Math.pow(2,10*(R-=1))*Math.sin((R*N-V)*(2*Math.PI)/j))+D)},ElasticEaseOut(R,D,O,N,H,j){let V=0;return R===0?D:(R/=N)===1?D+O:(j||(j=N*.3),!H||H<Math.abs(O)?(H=O,V=j/4):V=j/(2*Math.PI)*Math.asin(O/H),H*Math.pow(2,-10*R)*Math.sin((R*N-V)*(2*Math.PI)/j)+O+D)},ElasticEaseInOut(R,D,O,N,H,j){let V=0;return R===0?D:(R/=N/2)===2?D+O:(j||(j=N*(.3*1.5)),!H||H<Math.abs(O)?(H=O,V=j/4):V=j/(2*Math.PI)*Math.asin(O/H),R<1?-.5*(H*Math.pow(2,10*(R-=1))*Math.sin((R*N-V)*(2*Math.PI)/j))+D:H*Math.pow(2,-10*(R-=1))*Math.sin((R*N-V)*(2*Math.PI)/j)*.5+O+D)},BounceEaseOut(R,D,O,N){return(R/=N)<1/2.75?O*(7.5625*R*R)+D:R<2/2.75?O*(7.5625*(R-=1.5/2.75)*R+.75)+D:R<2.5/2.75?O*(7.5625*(R-=2.25/2.75)*R+.9375)+D:O*(7.5625*(R-=2.625/2.75)*R+.984375)+D},BounceEaseIn(R,D,O,N){return O-t.Easings.BounceEaseOut(N-R,0,O,N)+D},BounceEaseInOut(R,D,O,N){return R<N/2?t.Easings.BounceEaseIn(R*2,0,O,N)*.5+D:t.Easings.BounceEaseOut(R*2-N,0,O,N)*.5+O*.5+D},EaseIn(R,D,O,N){return O*(R/=N)*R+D},EaseOut(R,D,O,N){return-O*(R/=N)*(R-2)+D},EaseInOut(R,D,O,N){return(R/=N/2)<1?O/2*R*R+D:-O/2*(--R*(R-2)-1)+D},StrongEaseIn(R,D,O,N){return O*(R/=N)*R*R*R*R+D},StrongEaseOut(R,D,O,N){return O*((R=R/N-1)*R*R*R*R+1)+D},StrongEaseInOut(R,D,O,N){return(R/=N/2)<1?O/2*R*R*R*R*R+D:O/2*((R-=2)*R*R*R*R+2)+D},Linear(R,D,O,N){return O*R/N+D}}})(tw)),tw}var t4;function Gw(){return t4||(t4=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const s=Zi(),c=Ms(),p=Gs(),g=Qx(),v=qV(),S=lR(),r=WV(),E=BS(),A=FS(),I=Aa(),F=NS(),z=ZV(),R=sR(),D=Jx();t.Konva=c.Util._assign(s.Konva,{Util:c.Util,Transform:c.Transform,Node:p.Node,Container:g.Container,Stage:v.Stage,stages:v.stages,Layer:S.Layer,FastLayer:r.FastLayer,Group:E.Group,DD:A.DD,Shape:I.Shape,shapes:I.shapes,Animation:F.Animation,Tween:z.Tween,Easings:z.Easings,Context:R.Context,Canvas:D.Canvas}),t.default=t.Konva})(Z2)),Z2}var P0={},n4;function YV(){if(n4)return P0;n4=1,Object.defineProperty(P0,"__esModule",{value:!0}),P0.Arc=void 0;const t=ro(),s=Aa(),c=Zi(),p=lo(),g=Zi();let v=class extends s.Shape{_sceneFunc(r){const E=c.Konva.getAngle(this.angle()),A=this.clockwise();r.beginPath(),r.arc(0,0,this.outerRadius(),0,E,A),r.arc(0,0,this.innerRadius(),E,0,!A),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}getSelfRect(){const r=this.innerRadius(),E=this.outerRadius(),A=this.clockwise(),I=c.Konva.getAngle(A?360-this.angle():this.angle()),F=Math.cos(Math.min(I,Math.PI)),z=1,R=Math.sin(Math.min(Math.max(Math.PI,I),3*Math.PI/2)),D=Math.sin(Math.min(I,Math.PI/2)),O=F*(F>0?r:E),N=z*E,H=R*(R>0?r:E),j=D*(D>0?E:r);return{x:O,y:A?-1*j:H,width:N-O,height:j-H}}};return P0.Arc=v,v.prototype._centroid=!0,v.prototype.className="Arc",v.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,g._registerNode)(v),t.Factory.addGetterSetter(v,"innerRadius",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"outerRadius",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"angle",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"clockwise",!1,(0,p.getBooleanValidator)()),P0}var M0={},I0={},r4;function cR(){if(r4)return I0;r4=1,Object.defineProperty(I0,"__esModule",{value:!0}),I0.Line=void 0;const t=ro(),s=Zi(),c=Aa(),p=lo();function g(r,E,A,I,F,z,R){const D=Math.sqrt(Math.pow(A-r,2)+Math.pow(I-E,2)),O=Math.sqrt(Math.pow(F-A,2)+Math.pow(z-I,2)),N=R*D/(D+O),H=R*O/(D+O),j=A-N*(F-r),V=I-N*(z-E),Z=A+H*(F-r),X=I+H*(z-E);return[j,V,Z,X]}function v(r,E){const A=r.length,I=[];for(let F=2;F<A-2;F+=2){const z=g(r[F-2],r[F-1],r[F],r[F+1],r[F+2],r[F+3],E);isNaN(z[0])||(I.push(z[0]),I.push(z[1]),I.push(r[F]),I.push(r[F+1]),I.push(z[2]),I.push(z[3]))}return I}class S extends c.Shape{constructor(E){super(E),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(E){const A=this.points(),I=A.length,F=this.tension(),z=this.closed(),R=this.bezier();if(!I)return;let D=0;if(E.beginPath(),E.moveTo(A[0],A[1]),F!==0&&I>4){const O=this.getTensionPoints(),N=O.length;for(D=z?0:4,z||E.quadraticCurveTo(O[0],O[1],O[2],O[3]);D<N-2;)E.bezierCurveTo(O[D++],O[D++],O[D++],O[D++],O[D++],O[D++]);z||E.quadraticCurveTo(O[N-2],O[N-1],A[I-2],A[I-1])}else if(R)for(D=2;D<I;)E.bezierCurveTo(A[D++],A[D++],A[D++],A[D++],A[D++],A[D++]);else for(D=2;D<I;D+=2)E.lineTo(A[D],A[D+1]);z?(E.closePath(),E.fillStrokeShape(this)):E.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():v(this.points(),this.tension())}_getTensionPointsClosed(){const E=this.points(),A=E.length,I=this.tension(),F=g(E[A-2],E[A-1],E[0],E[1],E[2],E[3],I),z=g(E[A-4],E[A-3],E[A-2],E[A-1],E[0],E[1],I),R=v(E,I);return[F[2],F[3]].concat(R).concat([z[0],z[1],E[A-2],E[A-1],z[2],z[3],F[0],F[1],E[0],E[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let E=this.points();if(E.length<4)return{x:E[0]||0,y:E[1]||0,width:0,height:0};this.tension()!==0?E=[E[0],E[1],...this._getTensionPoints(),E[E.length-2],E[E.length-1]]:E=this.points();let A=E[0],I=E[0],F=E[1],z=E[1],R,D;for(let O=0;O<E.length/2;O++)R=E[O*2],D=E[O*2+1],A=Math.min(A,R),I=Math.max(I,R),F=Math.min(F,D),z=Math.max(z,D);return{x:A,y:F,width:I-A,height:z-F}}}return I0.Line=S,S.prototype.className="Line",S.prototype._attrsAffectingSize=["points","bezier","tension"],(0,s._registerNode)(S),t.Factory.addGetterSetter(S,"closed",!1),t.Factory.addGetterSetter(S,"bezier",!1),t.Factory.addGetterSetter(S,"tension",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(S,"points",[],(0,p.getNumberArrayValidator)()),I0}var R0={},nw={},i4;function XV(){return i4||(i4=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const s=(S,r,E)=>{let A,I;const z=E/2;A=0;for(let R=0;R<20;R++)I=z*t.tValues[20][R]+z,A+=t.cValues[20][R]*p(S,r,I);return z*A};t.getCubicArcLength=s;const c=(S,r,E)=>{E===void 0&&(E=1);const A=S[0]-2*S[1]+S[2],I=r[0]-2*r[1]+r[2],F=2*S[1]-2*S[0],z=2*r[1]-2*r[0],R=4*(A*A+I*I),D=4*(A*F+I*z),O=F*F+z*z;if(R===0)return E*Math.sqrt(Math.pow(S[2]-S[0],2)+Math.pow(r[2]-r[0],2));const N=D/(2*R),H=O/R,j=E+N,V=H-N*N,Z=j*j+V>0?Math.sqrt(j*j+V):0,X=N*N+V>0?Math.sqrt(N*N+V):0,se=N+Math.sqrt(N*N+V)!==0?V*Math.log(Math.abs((j+Z)/(N+X))):0;return Math.sqrt(R)/2*(j*Z-N*X+se)};t.getQuadraticArcLength=c;function p(S,r,E){const A=g(1,E,S),I=g(1,E,r),F=A*A+I*I;return Math.sqrt(F)}const g=(S,r,E)=>{const A=E.length-1;let I,F;if(A===0)return 0;if(S===0){F=0;for(let z=0;z<=A;z++)F+=t.binomialCoefficients[A][z]*Math.pow(1-r,A-z)*Math.pow(r,z)*E[z];return F}else{I=new Array(A);for(let z=0;z<A;z++)I[z]=A*(E[z+1]-E[z]);return g(S-1,r,I)}},v=(S,r,E)=>{let A=1,I=S/r,F=(S-E(I))/r,z=0;for(;A>.001;){const R=E(I+F),D=Math.abs(S-R)/r;if(D<A)A=D,I+=F;else{const O=E(I-F),N=Math.abs(S-O)/r;N<A?(A=N,I-=F):F/=2}if(z++,z>500)break}return I};t.t2length=v})(nw)),nw}var o4;function VS(){if(o4)return R0;o4=1,Object.defineProperty(R0,"__esModule",{value:!0}),R0.Path=void 0;const t=ro(),s=Zi(),c=Aa(),p=XV();let g=class rc extends c.Shape{constructor(S){super(S),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=rc.parsePathData(this.data()),this.pathLength=rc.getPathLength(this.dataArray)}_sceneFunc(S){const r=this.dataArray;S.beginPath();let E=!1;for(let A=0;A<r.length;A++){const I=r[A].command,F=r[A].points;switch(I){case"L":S.lineTo(F[0],F[1]);break;case"M":S.moveTo(F[0],F[1]);break;case"C":S.bezierCurveTo(F[0],F[1],F[2],F[3],F[4],F[5]);break;case"Q":S.quadraticCurveTo(F[0],F[1],F[2],F[3]);break;case"A":const z=F[0],R=F[1],D=F[2],O=F[3],N=F[4],H=F[5],j=F[6],V=F[7],Z=D>O?D:O,X=D>O?1:D/O,se=D>O?O/D:1;S.translate(z,R),S.rotate(j),S.scale(X,se),S.arc(0,0,Z,N,N+H,1-V),S.scale(1/X,1/se),S.rotate(-j),S.translate(-z,-R);break;case"z":E=!0,S.closePath();break}}!E&&!this.hasFill()?S.strokeShape(this):S.fillStrokeShape(this)}getSelfRect(){let S=[];this.dataArray.forEach(function(R){if(R.command==="A"){const D=R.points[4],O=R.points[5],N=R.points[4]+O;let H=Math.PI/180;if(Math.abs(D-N)<H&&(H=Math.abs(D-N)),O<0)for(let j=D-H;j>N;j-=H){const V=rc.getPointOnEllipticalArc(R.points[0],R.points[1],R.points[2],R.points[3],j,0);S.push(V.x,V.y)}else for(let j=D+H;j<N;j+=H){const V=rc.getPointOnEllipticalArc(R.points[0],R.points[1],R.points[2],R.points[3],j,0);S.push(V.x,V.y)}}else if(R.command==="C")for(let D=0;D<=1;D+=.01){const O=rc.getPointOnCubicBezier(D,R.start.x,R.start.y,R.points[0],R.points[1],R.points[2],R.points[3],R.points[4],R.points[5]);S.push(O.x,O.y)}else S=S.concat(R.points)});let r=S[0],E=S[0],A=S[1],I=S[1],F,z;for(let R=0;R<S.length/2;R++)F=S[R*2],z=S[R*2+1],isNaN(F)||(r=Math.min(r,F),E=Math.max(E,F)),isNaN(z)||(A=Math.min(A,z),I=Math.max(I,z));return{x:r,y:A,width:E-r,height:I-A}}getLength(){return this.pathLength}getPointAtLength(S){return rc.getPointAtLengthOfDataArray(S,this.dataArray)}static getLineLength(S,r,E,A){return Math.sqrt((E-S)*(E-S)+(A-r)*(A-r))}static getPathLength(S){let r=0;for(let E=0;E<S.length;++E)r+=S[E].pathLength;return r}static getPointAtLengthOfDataArray(S,r){let E,A=0,I=r.length;if(!I)return null;for(;A<I&&S>r[A].pathLength;)S-=r[A].pathLength,++A;if(A===I)return E=r[A-1].points.slice(-2),{x:E[0],y:E[1]};if(S<.01)return r[A].command==="M"?(E=r[A].points.slice(0,2),{x:E[0],y:E[1]}):{x:r[A].start.x,y:r[A].start.y};const F=r[A],z=F.points;switch(F.command){case"L":return rc.getPointOnLine(S,F.start.x,F.start.y,z[0],z[1]);case"C":return rc.getPointOnCubicBezier((0,p.t2length)(S,rc.getPathLength(r),Z=>(0,p.getCubicArcLength)([F.start.x,z[0],z[2],z[4]],[F.start.y,z[1],z[3],z[5]],Z)),F.start.x,F.start.y,z[0],z[1],z[2],z[3],z[4],z[5]);case"Q":return rc.getPointOnQuadraticBezier((0,p.t2length)(S,rc.getPathLength(r),Z=>(0,p.getQuadraticArcLength)([F.start.x,z[0],z[2]],[F.start.y,z[1],z[3]],Z)),F.start.x,F.start.y,z[0],z[1],z[2],z[3]);case"A":const R=z[0],D=z[1],O=z[2],N=z[3],H=z[5],j=z[6];let V=z[4];return V+=H*S/F.pathLength,rc.getPointOnEllipticalArc(R,D,O,N,V,j)}return null}static getPointOnLine(S,r,E,A,I,F,z){F=F??r,z=z??E;const R=this.getLineLength(r,E,A,I);if(R<1e-10)return{x:r,y:E};if(A===r)return{x:F,y:z+(I>E?S:-S)};const D=(I-E)/(A-r),O=Math.sqrt(S*S/(1+D*D))*(A<r?-1:1),N=D*O;if(Math.abs(z-E-D*(F-r))<1e-10)return{x:F+O,y:z+N};const H=((F-r)*(A-r)+(z-E)*(I-E))/(R*R),j=r+H*(A-r),V=E+H*(I-E),Z=this.getLineLength(F,z,j,V),X=Math.sqrt(S*S-Z*Z),se=Math.sqrt(X*X/(1+D*D))*(A<r?-1:1),ge=D*se;return{x:j+se,y:V+ge}}static getPointOnCubicBezier(S,r,E,A,I,F,z,R,D){function O(X){return X*X*X}function N(X){return 3*X*X*(1-X)}function H(X){return 3*X*(1-X)*(1-X)}function j(X){return(1-X)*(1-X)*(1-X)}const V=R*O(S)+F*N(S)+A*H(S)+r*j(S),Z=D*O(S)+z*N(S)+I*H(S)+E*j(S);return{x:V,y:Z}}static getPointOnQuadraticBezier(S,r,E,A,I,F,z){function R(j){return j*j}function D(j){return 2*j*(1-j)}function O(j){return(1-j)*(1-j)}const N=F*R(S)+A*D(S)+r*O(S),H=z*R(S)+I*D(S)+E*O(S);return{x:N,y:H}}static getPointOnEllipticalArc(S,r,E,A,I,F){const z=Math.cos(F),R=Math.sin(F),D={x:E*Math.cos(I),y:A*Math.sin(I)};return{x:S+(D.x*z-D.y*R),y:r+(D.x*R+D.y*z)}}static parsePathData(S){if(!S)return[];let r=S;const E=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];r=r.replace(new RegExp(" ","g"),",");for(let N=0;N<E.length;N++)r=r.replace(new RegExp(E[N],"g"),"|"+E[N]);const A=r.split("|"),I=[],F=[];let z=0,R=0;const D=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let O;for(let N=1;N<A.length;N++){let H=A[N],j=H.charAt(0);for(H=H.slice(1),F.length=0;O=D.exec(H);)F.push(O[0]);const V=[];for(let Z=0,X=F.length;Z<X;Z++){if(F[Z]==="00"){V.push(0,0);continue}const se=parseFloat(F[Z]);isNaN(se)?V.push(0):V.push(se)}for(;V.length>0&&!isNaN(V[0]);){let Z="",X=[];const se=z,ge=R;let ae,oe,fe,pe,K,ye,J,de,Ae,ne;switch(j){case"l":z+=V.shift(),R+=V.shift(),Z="L",X.push(z,R);break;case"L":z=V.shift(),R=V.shift(),X.push(z,R);break;case"m":const xe=V.shift(),Ce=V.shift();if(z+=xe,R+=Ce,Z="M",I.length>2&&I[I.length-1].command==="z"){for(let Re=I.length-2;Re>=0;Re--)if(I[Re].command==="M"){z=I[Re].points[0]+xe,R=I[Re].points[1]+Ce;break}}X.push(z,R),j="l";break;case"M":z=V.shift(),R=V.shift(),Z="M",X.push(z,R),j="L";break;case"h":z+=V.shift(),Z="L",X.push(z,R);break;case"H":z=V.shift(),Z="L",X.push(z,R);break;case"v":R+=V.shift(),Z="L",X.push(z,R);break;case"V":R=V.shift(),Z="L",X.push(z,R);break;case"C":X.push(V.shift(),V.shift(),V.shift(),V.shift()),z=V.shift(),R=V.shift(),X.push(z,R);break;case"c":X.push(z+V.shift(),R+V.shift(),z+V.shift(),R+V.shift()),z+=V.shift(),R+=V.shift(),Z="C",X.push(z,R);break;case"S":oe=z,fe=R,ae=I[I.length-1],ae.command==="C"&&(oe=z+(z-ae.points[2]),fe=R+(R-ae.points[3])),X.push(oe,fe,V.shift(),V.shift()),z=V.shift(),R=V.shift(),Z="C",X.push(z,R);break;case"s":oe=z,fe=R,ae=I[I.length-1],ae.command==="C"&&(oe=z+(z-ae.points[2]),fe=R+(R-ae.points[3])),X.push(oe,fe,z+V.shift(),R+V.shift()),z+=V.shift(),R+=V.shift(),Z="C",X.push(z,R);break;case"Q":X.push(V.shift(),V.shift()),z=V.shift(),R=V.shift(),X.push(z,R);break;case"q":X.push(z+V.shift(),R+V.shift()),z+=V.shift(),R+=V.shift(),Z="Q",X.push(z,R);break;case"T":oe=z,fe=R,ae=I[I.length-1],ae.command==="Q"&&(oe=z+(z-ae.points[0]),fe=R+(R-ae.points[1])),z=V.shift(),R=V.shift(),Z="Q",X.push(oe,fe,z,R);break;case"t":oe=z,fe=R,ae=I[I.length-1],ae.command==="Q"&&(oe=z+(z-ae.points[0]),fe=R+(R-ae.points[1])),z+=V.shift(),R+=V.shift(),Z="Q",X.push(oe,fe,z,R);break;case"A":pe=V.shift(),K=V.shift(),ye=V.shift(),J=V.shift(),de=V.shift(),Ae=z,ne=R,z=V.shift(),R=V.shift(),Z="A",X=this.convertEndpointToCenterParameterization(Ae,ne,z,R,J,de,pe,K,ye);break;case"a":pe=V.shift(),K=V.shift(),ye=V.shift(),J=V.shift(),de=V.shift(),Ae=z,ne=R,z+=V.shift(),R+=V.shift(),Z="A",X=this.convertEndpointToCenterParameterization(Ae,ne,z,R,J,de,pe,K,ye);break}I.push({command:Z||j,points:X,start:{x:se,y:ge},pathLength:this.calcLength(se,ge,Z||j,X)})}(j==="z"||j==="Z")&&I.push({command:"z",points:[],start:void 0,pathLength:0})}return I}static calcLength(S,r,E,A){let I,F,z,R;const D=rc;switch(E){case"L":return D.getLineLength(S,r,A[0],A[1]);case"C":return(0,p.getCubicArcLength)([S,A[0],A[2],A[4]],[r,A[1],A[3],A[5]],1);case"Q":return(0,p.getQuadraticArcLength)([S,A[0],A[2]],[r,A[1],A[3]],1);case"A":I=0;const O=A[4],N=A[5],H=A[4]+N;let j=Math.PI/180;if(Math.abs(O-H)<j&&(j=Math.abs(O-H)),F=D.getPointOnEllipticalArc(A[0],A[1],A[2],A[3],O,0),N<0)for(R=O-j;R>H;R-=j)z=D.getPointOnEllipticalArc(A[0],A[1],A[2],A[3],R,0),I+=D.getLineLength(F.x,F.y,z.x,z.y),F=z;else for(R=O+j;R<H;R+=j)z=D.getPointOnEllipticalArc(A[0],A[1],A[2],A[3],R,0),I+=D.getLineLength(F.x,F.y,z.x,z.y),F=z;return z=D.getPointOnEllipticalArc(A[0],A[1],A[2],A[3],H,0),I+=D.getLineLength(F.x,F.y,z.x,z.y),I}return 0}static convertEndpointToCenterParameterization(S,r,E,A,I,F,z,R,D){const O=D*(Math.PI/180),N=Math.cos(O)*(S-E)/2+Math.sin(O)*(r-A)/2,H=-1*Math.sin(O)*(S-E)/2+Math.cos(O)*(r-A)/2,j=N*N/(z*z)+H*H/(R*R);j>1&&(z*=Math.sqrt(j),R*=Math.sqrt(j));let V=Math.sqrt((z*z*(R*R)-z*z*(H*H)-R*R*(N*N))/(z*z*(H*H)+R*R*(N*N)));I===F&&(V*=-1),isNaN(V)&&(V=0);const Z=V*z*H/R,X=V*-R*N/z,se=(S+E)/2+Math.cos(O)*Z-Math.sin(O)*X,ge=(r+A)/2+Math.sin(O)*Z+Math.cos(O)*X,ae=function(de){return Math.sqrt(de[0]*de[0]+de[1]*de[1])},oe=function(de,Ae){return(de[0]*Ae[0]+de[1]*Ae[1])/(ae(de)*ae(Ae))},fe=function(de,Ae){return(de[0]*Ae[1]<de[1]*Ae[0]?-1:1)*Math.acos(oe(de,Ae))},pe=fe([1,0],[(N-Z)/z,(H-X)/R]),K=[(N-Z)/z,(H-X)/R],ye=[(-1*N-Z)/z,(-1*H-X)/R];let J=fe(K,ye);return oe(K,ye)<=-1&&(J=Math.PI),oe(K,ye)>=1&&(J=0),F===0&&J>0&&(J=J-2*Math.PI),F===1&&J<0&&(J=J+2*Math.PI),[se,ge,z,R,pe,J,O,F]}};return R0.Path=g,g.prototype.className="Path",g.prototype._attrsAffectingSize=["data"],(0,s._registerNode)(g),t.Factory.addGetterSetter(g,"data"),R0}var s4;function KV(){if(s4)return M0;s4=1,Object.defineProperty(M0,"__esModule",{value:!0}),M0.Arrow=void 0;const t=ro(),s=cR(),c=lo(),p=Zi(),g=VS();let v=class extends s.Line{_sceneFunc(r){super._sceneFunc(r);const E=Math.PI*2,A=this.points();let I=A;const F=this.tension()!==0&&A.length>4;F&&(I=this.getTensionPoints());const z=this.pointerLength(),R=A.length;let D,O;if(F){const j=[I[I.length-4],I[I.length-3],I[I.length-2],I[I.length-1],A[R-2],A[R-1]],V=g.Path.calcLength(I[I.length-4],I[I.length-3],"C",j),Z=g.Path.getPointOnQuadraticBezier(Math.min(1,1-z/V),j[0],j[1],j[2],j[3],j[4],j[5]);D=A[R-2]-Z.x,O=A[R-1]-Z.y}else D=A[R-2]-A[R-4],O=A[R-1]-A[R-3];const N=(Math.atan2(O,D)+E)%E,H=this.pointerWidth();this.pointerAtEnding()&&(r.save(),r.beginPath(),r.translate(A[R-2],A[R-1]),r.rotate(N),r.moveTo(0,0),r.lineTo(-z,H/2),r.lineTo(-z,-H/2),r.closePath(),r.restore(),this.__fillStroke(r)),this.pointerAtBeginning()&&(r.save(),r.beginPath(),r.translate(A[0],A[1]),F?(D=(I[0]+I[2])/2-A[0],O=(I[1]+I[3])/2-A[1]):(D=A[2]-A[0],O=A[3]-A[1]),r.rotate((Math.atan2(-O,-D)+E)%E),r.moveTo(0,0),r.lineTo(-z,H/2),r.lineTo(-z,-H/2),r.closePath(),r.restore(),this.__fillStroke(r))}__fillStroke(r){const E=this.dashEnabled();E&&(this.attrs.dashEnabled=!1,r.setLineDash([])),r.fillStrokeShape(this),E&&(this.attrs.dashEnabled=!0)}getSelfRect(){const r=super.getSelfRect(),E=this.pointerWidth()/2;return{x:r.x,y:r.y-E,width:r.width,height:r.height+E*2}}};return M0.Arrow=v,v.prototype.className="Arrow",(0,p._registerNode)(v),t.Factory.addGetterSetter(v,"pointerLength",10,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(v,"pointerWidth",10,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(v,"pointerAtBeginning",!1),t.Factory.addGetterSetter(v,"pointerAtEnding",!0),M0}var D0={},a4;function JV(){if(a4)return D0;a4=1,Object.defineProperty(D0,"__esModule",{value:!0}),D0.Circle=void 0;const t=ro(),s=Aa(),c=lo(),p=Zi();let g=class extends s.Shape{_sceneFunc(S){S.beginPath(),S.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),S.closePath(),S.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(S){this.radius()!==S/2&&this.radius(S/2)}setHeight(S){this.radius()!==S/2&&this.radius(S/2)}};return D0.Circle=g,g.prototype._centroid=!0,g.prototype.className="Circle",g.prototype._attrsAffectingSize=["radius"],(0,p._registerNode)(g),t.Factory.addGetterSetter(g,"radius",0,(0,c.getNumberValidator)()),D0}var k0={},l4;function QV(){if(l4)return k0;l4=1,Object.defineProperty(k0,"__esModule",{value:!0}),k0.Ellipse=void 0;const t=ro(),s=Aa(),c=lo(),p=Zi();let g=class extends s.Shape{_sceneFunc(S){const r=this.radiusX(),E=this.radiusY();S.beginPath(),S.save(),r!==E&&S.scale(1,E/r),S.arc(0,0,r,0,Math.PI*2,!1),S.restore(),S.closePath(),S.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(S){this.radiusX(S/2)}setHeight(S){this.radiusY(S/2)}};return k0.Ellipse=g,g.prototype.className="Ellipse",g.prototype._centroid=!0,g.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,p._registerNode)(g),t.Factory.addComponentsGetterSetter(g,"radius",["x","y"]),t.Factory.addGetterSetter(g,"radiusX",0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(g,"radiusY",0,(0,c.getNumberValidator)()),k0}var O0={},c4;function eU(){if(c4)return O0;c4=1,Object.defineProperty(O0,"__esModule",{value:!0}),O0.Image=void 0;const t=Ms(),s=ro(),c=Aa(),p=Zi(),g=lo();class v extends c.Shape{constructor(r){super(r),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",E=>{this._removeImageLoad(E.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const r=this.image();r&&r.complete||r&&r.readyState===4||r&&r.addEventListener&&r.addEventListener("load",this._loadListener)}_removeImageLoad(r){r&&r.removeEventListener&&r.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const r=!!this.cornerRadius(),E=this.hasShadow();return r&&E?!0:super._useBufferCanvas(!0)}_sceneFunc(r){const E=this.getWidth(),A=this.getHeight(),I=this.cornerRadius(),F=this.attrs.image;let z;if(F){const R=this.attrs.cropWidth,D=this.attrs.cropHeight;R&&D?z=[F,this.cropX(),this.cropY(),R,D,0,0,E,A]:z=[F,0,0,E,A]}(this.hasFill()||this.hasStroke()||I)&&(r.beginPath(),I?t.Util.drawRoundedRectPath(r,E,A,I):r.rect(0,0,E,A),r.closePath(),r.fillStrokeShape(this)),F&&(I&&r.clip(),r.drawImage.apply(r,z))}_hitFunc(r){const E=this.width(),A=this.height(),I=this.cornerRadius();r.beginPath(),I?t.Util.drawRoundedRectPath(r,E,A,I):r.rect(0,0,E,A),r.closePath(),r.fillStrokeShape(this)}getWidth(){var r,E;return(r=this.attrs.width)!==null&&r!==void 0?r:(E=this.image())===null||E===void 0?void 0:E.width}getHeight(){var r,E;return(r=this.attrs.height)!==null&&r!==void 0?r:(E=this.image())===null||E===void 0?void 0:E.height}static fromURL(r,E,A=null){const I=t.Util.createImageElement();I.onload=function(){const F=new v({image:I});E(F)},I.onerror=A,I.crossOrigin="Anonymous",I.src=r}}return O0.Image=v,v.prototype.className="Image",(0,p._registerNode)(v),s.Factory.addGetterSetter(v,"cornerRadius",0,(0,g.getNumberOrArrayOfNumbersValidator)(4)),s.Factory.addGetterSetter(v,"image"),s.Factory.addComponentsGetterSetter(v,"crop",["x","y","width","height"]),s.Factory.addGetterSetter(v,"cropX",0,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(v,"cropY",0,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(v,"cropWidth",0,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(v,"cropHeight",0,(0,g.getNumberValidator)()),O0}var Rm={},u4;function tU(){if(u4)return Rm;u4=1,Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.Tag=Rm.Label=void 0;const t=ro(),s=Aa(),c=BS(),p=lo(),g=Zi(),v=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],S="Change.konva",r="none",E="up",A="right",I="down",F="left",z=v.length;class R extends c.Group{constructor(N){super(N),this.on("add.konva",function(H){this._addListeners(H.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(N){let H=this,j;const V=function(){H._sync()};for(j=0;j<z;j++)N.on(v[j]+S,V)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let N=this.getText(),H=this.getTag(),j,V,Z,X,se,ge,ae;if(N&&H){switch(j=N.width(),V=N.height(),Z=H.pointerDirection(),X=H.pointerWidth(),ae=H.pointerHeight(),se=0,ge=0,Z){case E:se=j/2,ge=-1*ae;break;case A:se=j+X,ge=V/2;break;case I:se=j/2,ge=V+ae;break;case F:se=-1*X,ge=V/2;break}H.setAttrs({x:-1*se,y:-1*ge,width:j,height:V}),N.setAttrs({x:-1*se,y:-1*ge})}}}Rm.Label=R,R.prototype.className="Label",(0,g._registerNode)(R);class D extends s.Shape{_sceneFunc(N){const H=this.width(),j=this.height(),V=this.pointerDirection(),Z=this.pointerWidth(),X=this.pointerHeight(),se=this.cornerRadius();let ge=0,ae=0,oe=0,fe=0;typeof se=="number"?ge=ae=oe=fe=Math.min(se,H/2,j/2):(ge=Math.min(se[0]||0,H/2,j/2),ae=Math.min(se[1]||0,H/2,j/2),fe=Math.min(se[2]||0,H/2,j/2),oe=Math.min(se[3]||0,H/2,j/2)),N.beginPath(),N.moveTo(ge,0),V===E&&(N.lineTo((H-Z)/2,0),N.lineTo(H/2,-1*X),N.lineTo((H+Z)/2,0)),N.lineTo(H-ae,0),N.arc(H-ae,ae,ae,Math.PI*3/2,0,!1),V===A&&(N.lineTo(H,(j-X)/2),N.lineTo(H+Z,j/2),N.lineTo(H,(j+X)/2)),N.lineTo(H,j-fe),N.arc(H-fe,j-fe,fe,0,Math.PI/2,!1),V===I&&(N.lineTo((H+Z)/2,j),N.lineTo(H/2,j+X),N.lineTo((H-Z)/2,j)),N.lineTo(oe,j),N.arc(oe,j-oe,oe,Math.PI/2,Math.PI,!1),V===F&&(N.lineTo(0,(j+X)/2),N.lineTo(-1*Z,j/2),N.lineTo(0,(j-X)/2)),N.lineTo(0,ge),N.arc(ge,ge,ge,Math.PI,Math.PI*3/2,!1),N.closePath(),N.fillStrokeShape(this)}getSelfRect(){let N=0,H=0,j=this.pointerWidth(),V=this.pointerHeight(),Z=this.pointerDirection(),X=this.width(),se=this.height();return Z===E?(H-=V,se+=V):Z===I?se+=V:Z===F?(N-=j*1.5,X+=j):Z===A&&(X+=j*1.5),{x:N,y:H,width:X,height:se}}}return Rm.Tag=D,D.prototype.className="Tag",(0,g._registerNode)(D),t.Factory.addGetterSetter(D,"pointerDirection",r),t.Factory.addGetterSetter(D,"pointerWidth",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(D,"pointerHeight",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(D,"cornerRadius",0,(0,p.getNumberOrArrayOfNumbersValidator)(4)),Rm}var L0={},d4;function uR(){if(d4)return L0;d4=1,Object.defineProperty(L0,"__esModule",{value:!0}),L0.Rect=void 0;const t=ro(),s=Aa(),c=Zi(),p=Ms(),g=lo();let v=class extends s.Shape{_sceneFunc(r){const E=this.cornerRadius(),A=this.width(),I=this.height();r.beginPath(),E?p.Util.drawRoundedRectPath(r,A,I,E):r.rect(0,0,A,I),r.closePath(),r.fillStrokeShape(this)}};return L0.Rect=v,v.prototype.className="Rect",(0,c._registerNode)(v),t.Factory.addGetterSetter(v,"cornerRadius",0,(0,g.getNumberOrArrayOfNumbersValidator)(4)),L0}var z0={},h4;function nU(){if(h4)return z0;h4=1,Object.defineProperty(z0,"__esModule",{value:!0}),z0.RegularPolygon=void 0;const t=ro(),s=Aa(),c=lo(),p=Zi();let g=class extends s.Shape{_sceneFunc(S){const r=this._getPoints();S.beginPath(),S.moveTo(r[0].x,r[0].y);for(let E=1;E<r.length;E++)S.lineTo(r[E].x,r[E].y);S.closePath(),S.fillStrokeShape(this)}_getPoints(){const S=this.attrs.sides,r=this.attrs.radius||0,E=[];for(let A=0;A<S;A++)E.push({x:r*Math.sin(A*2*Math.PI/S),y:-1*r*Math.cos(A*2*Math.PI/S)});return E}getSelfRect(){const S=this._getPoints();let r=S[0].x,E=S[0].y,A=S[0].x,I=S[0].y;return S.forEach(F=>{r=Math.min(r,F.x),E=Math.max(E,F.x),A=Math.min(A,F.y),I=Math.max(I,F.y)}),{x:r,y:A,width:E-r,height:I-A}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(S){this.radius(S/2)}setHeight(S){this.radius(S/2)}};return z0.RegularPolygon=g,g.prototype.className="RegularPolygon",g.prototype._centroid=!0,g.prototype._attrsAffectingSize=["radius"],(0,p._registerNode)(g),t.Factory.addGetterSetter(g,"radius",0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(g,"sides",0,(0,c.getNumberValidator)()),z0}var F0={},f4;function rU(){if(f4)return F0;f4=1,Object.defineProperty(F0,"__esModule",{value:!0}),F0.Ring=void 0;const t=ro(),s=Aa(),c=lo(),p=Zi(),g=Math.PI*2;let v=class extends s.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.innerRadius(),0,g,!1),r.moveTo(this.outerRadius(),0),r.arc(0,0,this.outerRadius(),g,0,!0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}};return F0.Ring=v,v.prototype.className="Ring",v.prototype._centroid=!0,v.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,p._registerNode)(v),t.Factory.addGetterSetter(v,"innerRadius",0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(v,"outerRadius",0,(0,c.getNumberValidator)()),F0}var B0={},p4;function iU(){if(p4)return B0;p4=1,Object.defineProperty(B0,"__esModule",{value:!0}),B0.Sprite=void 0;const t=ro(),s=Aa(),c=NS(),p=lo(),g=Zi();let v=class extends s.Shape{constructor(r){super(r),this._updated=!0,this.anim=new c.Animation(()=>{const E=this._updated;return this._updated=!1,E}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(r){const E=this.animation(),A=this.frameIndex(),I=A*4,F=this.animations()[E],z=this.frameOffsets(),R=F[I+0],D=F[I+1],O=F[I+2],N=F[I+3],H=this.image();if((this.hasFill()||this.hasStroke())&&(r.beginPath(),r.rect(0,0,O,N),r.closePath(),r.fillStrokeShape(this)),H)if(z){const j=z[E],V=A*2;r.drawImage(H,R,D,O,N,j[V+0],j[V+1],O,N)}else r.drawImage(H,R,D,O,N,0,0,O,N)}_hitFunc(r){const E=this.animation(),A=this.frameIndex(),I=A*4,F=this.animations()[E],z=this.frameOffsets(),R=F[I+2],D=F[I+3];if(r.beginPath(),z){const O=z[E],N=A*2;r.rect(O[N+0],O[N+1],R,D)}else r.rect(0,0,R,D);r.closePath(),r.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const r=this;this.interval=setInterval(function(){r._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const r=this.getLayer();this.anim.setLayers(r),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const r=this.frameIndex(),E=this.animation(),A=this.animations(),I=A[E],F=I.length/4;r<F-1?this.frameIndex(r+1):this.frameIndex(0)}};return B0.Sprite=v,v.prototype.className="Sprite",(0,g._registerNode)(v),t.Factory.addGetterSetter(v,"animation"),t.Factory.addGetterSetter(v,"animations"),t.Factory.addGetterSetter(v,"frameOffsets"),t.Factory.addGetterSetter(v,"image"),t.Factory.addGetterSetter(v,"frameIndex",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"frameRate",17,(0,p.getNumberValidator)()),t.Factory.backCompat(v,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),B0}var N0={},m4;function oU(){if(m4)return N0;m4=1,Object.defineProperty(N0,"__esModule",{value:!0}),N0.Star=void 0;const t=ro(),s=Aa(),c=lo(),p=Zi();let g=class extends s.Shape{_sceneFunc(S){const r=this.innerRadius(),E=this.outerRadius(),A=this.numPoints();S.beginPath(),S.moveTo(0,0-E);for(let I=1;I<A*2;I++){const F=I%2===0?E:r,z=F*Math.sin(I*Math.PI/A),R=-1*F*Math.cos(I*Math.PI/A);S.lineTo(z,R)}S.closePath(),S.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(S){this.outerRadius(S/2)}setHeight(S){this.outerRadius(S/2)}};return N0.Star=g,g.prototype.className="Star",g.prototype._centroid=!0,g.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,p._registerNode)(g),t.Factory.addGetterSetter(g,"numPoints",5,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(g,"innerRadius",0,(0,c.getNumberValidator)()),t.Factory.addGetterSetter(g,"outerRadius",0,(0,c.getNumberValidator)()),N0}var Hg={},g4;function dR(){if(g4)return Hg;g4=1,Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.Text=void 0,Hg.stringToArray=S;const t=Ms(),s=ro(),c=Aa(),p=Zi(),g=lo(),v=Zi();function S(Oe){return[...Oe].reduce((Be,at,ut,nt)=>{if(new RegExp("\\p{Emoji}","u").test(at)){const $e=nt[ut+1];$e&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test($e)?(Be.push(at+$e),nt[ut+1]=""):Be.push(at)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(at+(nt[ut+1]||""))?Be.push(at+nt[ut+1]):ut>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(at)?Be[Be.length-1]+=at:at&&Be.push(at);return Be},[])}const r="auto",E="center",A="inherit",I="justify",F="Change.konva",z="2d",R="-",D="left",O="text",N="Text",H="top",j="bottom",V="middle",Z="normal",X="px ",se=" ",ge="right",ae="rtl",oe="word",fe="char",pe="none",K="",ye=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],J=ye.length;function de(Oe){return Oe.split(",").map(Be=>{Be=Be.trim();const at=Be.indexOf(" ")>=0,ut=Be.indexOf('"')>=0||Be.indexOf("'")>=0;return at&&!ut&&(Be=`"${Be}"`),Be}).join(", ")}let Ae;function ne(){return Ae||(Ae=t.Util.createCanvasElement().getContext(z),Ae)}function xe(Oe){Oe.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Ce(Oe){Oe.setAttr("miterLimit",2),Oe.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Re(Oe){return Oe=Oe||{},!Oe.fillLinearGradientColorStops&&!Oe.fillRadialGradientColorStops&&!Oe.fillPatternImage&&(Oe.fill=Oe.fill||"black"),Oe}class Ee extends c.Shape{constructor(Be){super(Re(Be)),this._partialTextX=0,this._partialTextY=0;for(let at=0;at<J;at++)this.on(ye[at]+F,this._setTextData);this._setTextData()}_sceneFunc(Be){const at=this.textArr,ut=at.length;if(!this.text())return;let nt=this.padding(),$e=this.fontSize(),ct=this.lineHeight()*$e,At=this.verticalAlign(),xt=this.direction(),It=0,jt=this.align(),cn=this.getWidth(),Se=this.letterSpacing(),mt=this.fill(),Ke=this.textDecoration(),Ue=Ke.indexOf("underline")!==-1,je=Ke.indexOf("line-through")!==-1,gt;xt=xt===A?Be.direction:xt;let Ot=ct/2,Ft=V;if(p.Konva._fixTextRendering){const pt=this.measureSize("M");Ft="alphabetic",Ot=(pt.fontBoundingBoxAscent-pt.fontBoundingBoxDescent)/2+ct/2}for(xt===ae&&Be.setAttr("direction",xt),Be.setAttr("font",this._getContextFont()),Be.setAttr("textBaseline",Ft),Be.setAttr("textAlign",D),At===V?It=(this.getHeight()-ut*ct-nt*2)/2:At===j&&(It=this.getHeight()-ut*ct-nt*2),Be.translate(nt,It+nt),gt=0;gt<ut;gt++){let pt=0,dn=0;const An=at[gt],Gt=An.text,Yt=An.width,zn=An.lastInParagraph;if(Be.save(),jt===ge?pt+=cn-Yt-nt*2:jt===E&&(pt+=(cn-Yt-nt*2)/2),Ue){Be.save(),Be.beginPath();const $n=p.Konva._fixTextRendering?Math.round($e/4):Math.round($e/2),On=pt,Bn=Ot+dn+$n;Be.moveTo(On,Bn);const kn=jt===I&&!zn?cn-nt*2:Yt;Be.lineTo(On+Math.round(kn),Bn),Be.lineWidth=$e/15;const Pr=this._getLinearGradient();Be.strokeStyle=Pr||mt,Be.stroke(),Be.restore()}if(je){Be.save(),Be.beginPath();const $n=p.Konva._fixTextRendering?-Math.round($e/4):0;Be.moveTo(pt,Ot+dn+$n);const On=jt===I&&!zn?cn-nt*2:Yt;Be.lineTo(pt+Math.round(On),Ot+dn+$n),Be.lineWidth=$e/15;const Bn=this._getLinearGradient();Be.strokeStyle=Bn||mt,Be.stroke(),Be.restore()}if(xt!==ae&&(Se!==0||jt===I)){const $n=Gt.split(" ").length-1,On=S(Gt);for(let Bn=0;Bn<On.length;Bn++){const kn=On[Bn];kn===" "&&!zn&&jt===I&&(pt+=(cn-nt*2-Yt)/$n),this._partialTextX=pt,this._partialTextY=Ot+dn,this._partialText=kn,Be.fillStrokeShape(this),pt+=this.measureSize(kn).width+Se}}else Se!==0&&Be.setAttr("letterSpacing",`${Se}px`),this._partialTextX=pt,this._partialTextY=Ot+dn,this._partialText=Gt,Be.fillStrokeShape(this);Be.restore(),ut>1&&(Ot+=ct)}}_hitFunc(Be){const at=this.getWidth(),ut=this.getHeight();Be.beginPath(),Be.rect(0,0,at,ut),Be.closePath(),Be.fillStrokeShape(this)}setText(Be){const at=t.Util._isString(Be)?Be:Be==null?"":Be+"";return this._setAttr(O,at),this}getWidth(){return this.attrs.width===r||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===r||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(Be){var at,ut,nt,$e,ct,At,xt,It,jt,cn,Se;let mt=ne(),Ke=this.fontSize(),Ue;mt.save(),mt.font=this._getContextFont(),Ue=mt.measureText(Be),mt.restore();const je=Ke/100;return{actualBoundingBoxAscent:(at=Ue.actualBoundingBoxAscent)!==null&&at!==void 0?at:71.58203125*je,actualBoundingBoxDescent:(ut=Ue.actualBoundingBoxDescent)!==null&&ut!==void 0?ut:0,actualBoundingBoxLeft:(nt=Ue.actualBoundingBoxLeft)!==null&&nt!==void 0?nt:-7.421875*je,actualBoundingBoxRight:($e=Ue.actualBoundingBoxRight)!==null&&$e!==void 0?$e:75.732421875*je,alphabeticBaseline:(ct=Ue.alphabeticBaseline)!==null&&ct!==void 0?ct:0,emHeightAscent:(At=Ue.emHeightAscent)!==null&&At!==void 0?At:100*je,emHeightDescent:(xt=Ue.emHeightDescent)!==null&&xt!==void 0?xt:-20*je,fontBoundingBoxAscent:(It=Ue.fontBoundingBoxAscent)!==null&&It!==void 0?It:91*je,fontBoundingBoxDescent:(jt=Ue.fontBoundingBoxDescent)!==null&&jt!==void 0?jt:21*je,hangingBaseline:(cn=Ue.hangingBaseline)!==null&&cn!==void 0?cn:72.80000305175781*je,ideographicBaseline:(Se=Ue.ideographicBaseline)!==null&&Se!==void 0?Se:-21*je,width:Ue.width,height:Ke}}_getContextFont(){return this.fontStyle()+se+this.fontVariant()+se+(this.fontSize()+X)+de(this.fontFamily())}_addTextLine(Be){this.align()===I&&(Be=Be.trim());const ut=this._getTextWidth(Be);return this.textArr.push({text:Be,width:ut,lastInParagraph:!1})}_getTextWidth(Be){const at=this.letterSpacing(),ut=Be.length;return ne().measureText(Be).width+at*ut}_setTextData(){let Be=this.text().split(`
`),at=+this.fontSize(),ut=0,nt=this.lineHeight()*at,$e=this.attrs.width,ct=this.attrs.height,At=$e!==r&&$e!==void 0,xt=ct!==r&&ct!==void 0,It=this.padding(),jt=$e-It*2,cn=ct-It*2,Se=0,mt=this.wrap(),Ke=mt!==pe,Ue=mt!==fe&&Ke,je=this.ellipsis();this.textArr=[],ne().font=this._getContextFont();const gt=je?this._getTextWidth(K):0;for(let Ot=0,Ft=Be.length;Ot<Ft;++Ot){let pt=Be[Ot],dn=this._getTextWidth(pt);if(At&&dn>jt)for(;pt.length>0;){let An=0,Gt=S(pt).length,Yt="",zn=0;for(;An<Gt;){const $n=An+Gt>>>1,On=S(pt),Bn=On.slice(0,$n+1).join(""),kn=this._getTextWidth(Bn);(je&&xt&&Se+nt>cn?kn+gt:kn)<=jt?(An=$n+1,Yt=Bn,zn=kn):Gt=$n}if(Yt){if(Ue){const Bn=S(pt),kn=S(Yt),Pr=Bn[kn.length],mr=Pr===se||Pr===R;let ni;if(mr&&zn<=jt)ni=kn.length;else{const tr=kn.lastIndexOf(se),Br=kn.lastIndexOf(R);ni=Math.max(tr,Br)+1}ni>0&&(An=ni,Yt=Bn.slice(0,An).join(""),zn=this._getTextWidth(Yt))}if(Yt=Yt.trimRight(),this._addTextLine(Yt),ut=Math.max(ut,zn),Se+=nt,this._shouldHandleEllipsis(Se)){this._tryToAddEllipsisToLastLine();break}if(pt=S(pt).slice(An).join("").trimLeft(),pt.length>0&&(dn=this._getTextWidth(pt),dn<=jt)){this._addTextLine(pt),Se+=nt,ut=Math.max(ut,dn);break}}else break}else this._addTextLine(pt),Se+=nt,ut=Math.max(ut,dn),this._shouldHandleEllipsis(Se)&&Ot<Ft-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),xt&&Se+nt>cn)break}this.textHeight=at,this.textWidth=ut}_shouldHandleEllipsis(Be){const at=+this.fontSize(),ut=this.lineHeight()*at,nt=this.attrs.height,$e=nt!==r&&nt!==void 0,ct=this.padding(),At=nt-ct*2;return!(this.wrap()!==pe)||$e&&Be+ut>At}_tryToAddEllipsisToLastLine(){const Be=this.attrs.width,at=Be!==r&&Be!==void 0,ut=this.padding(),nt=Be-ut*2,$e=this.ellipsis(),ct=this.textArr[this.textArr.length-1];!ct||!$e||(at&&(this._getTextWidth(ct.text+K)<nt||(ct.text=ct.text.slice(0,ct.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(ct.text+K))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const Be=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,at=this.hasShadow();return Be&&at?!0:super._useBufferCanvas()}}return Hg.Text=Ee,Ee.prototype._fillFunc=xe,Ee.prototype._strokeFunc=Ce,Ee.prototype.className=N,Ee.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,v._registerNode)(Ee),s.Factory.overWriteSetter(Ee,"width",(0,g.getNumberOrAutoValidator)()),s.Factory.overWriteSetter(Ee,"height",(0,g.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(Ee,"direction",A),s.Factory.addGetterSetter(Ee,"fontFamily","Arial"),s.Factory.addGetterSetter(Ee,"fontSize",12,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(Ee,"fontStyle",Z),s.Factory.addGetterSetter(Ee,"fontVariant",Z),s.Factory.addGetterSetter(Ee,"padding",0,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(Ee,"align",D),s.Factory.addGetterSetter(Ee,"verticalAlign",H),s.Factory.addGetterSetter(Ee,"lineHeight",1,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(Ee,"wrap",oe),s.Factory.addGetterSetter(Ee,"ellipsis",!1,(0,g.getBooleanValidator)()),s.Factory.addGetterSetter(Ee,"letterSpacing",0,(0,g.getNumberValidator)()),s.Factory.addGetterSetter(Ee,"text","",(0,g.getStringValidator)()),s.Factory.addGetterSetter(Ee,"textDecoration",""),Hg}var V0={},_4;function sU(){if(_4)return V0;_4=1,Object.defineProperty(V0,"__esModule",{value:!0}),V0.TextPath=void 0;const t=Ms(),s=ro(),c=Aa(),p=VS(),g=dR(),v=lo(),S=Zi(),r="",E="normal";function A(z){z.fillText(this.partialText,0,0)}function I(z){z.strokeText(this.partialText,0,0)}let F=class extends c.Shape{constructor(R){super(R),this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return p.Path.getPathLength(this.dataArray)}_getPointAtLength(R){if(!this.attrs.data)return null;const D=this.pathLength;return R-1>D?null:p.Path.getPointAtLengthOfDataArray(R,this.dataArray)}_readDataAttribute(){this.dataArray=p.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(R){R.setAttr("font",this._getContextFont()),R.setAttr("textBaseline",this.textBaseline()),R.setAttr("textAlign","left"),R.save();const D=this.textDecoration(),O=this.fill(),N=this.fontSize(),H=this.glyphInfo;D==="underline"&&R.beginPath();for(let j=0;j<H.length;j++){R.save();const V=H[j].p0;R.translate(V.x,V.y),R.rotate(H[j].rotation),this.partialText=H[j].text,R.fillStrokeShape(this),D==="underline"&&(j===0&&R.moveTo(0,N/2+1),R.lineTo(N,N/2+1)),R.restore()}D==="underline"&&(R.strokeStyle=O,R.lineWidth=N/20,R.stroke()),R.restore()}_hitFunc(R){R.beginPath();const D=this.glyphInfo;if(D.length>=1){const O=D[0].p0;R.moveTo(O.x,O.y)}for(let O=0;O<D.length;O++){const N=D[O].p1;R.lineTo(N.x,N.y)}R.setAttr("lineWidth",this.fontSize()),R.setAttr("strokeStyle",this.colorKey),R.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(R){return g.Text.prototype.setText.call(this,R)}_getContextFont(){return g.Text.prototype._getContextFont.call(this)}_getTextSize(R){const O=this.dummyCanvas.getContext("2d");O.save(),O.font=this._getContextFont();const N=O.measureText(R);return O.restore(),{width:N.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:R,height:D}=this._getTextSize(this.attrs.text);if(this.textWidth=R,this.textHeight=D,this.glyphInfo=[],!this.attrs.data)return null;const O=this.letterSpacing(),N=this.align(),H=this.kerningFunc(),j=Math.max(this.textWidth+((this.attrs.text||"").length-1)*O,0);let V=0;N==="center"&&(V=Math.max(0,this.pathLength/2-j/2)),N==="right"&&(V=Math.max(0,this.pathLength-j));const Z=(0,g.stringToArray)(this.text());let X=V;for(let se=0;se<Z.length;se++){const ge=this._getPointAtLength(X);if(!ge)return;let ae=this._getTextSize(Z[se]).width+O;if(Z[se]===" "&&N==="justify"){const J=this.text().split(" ").length-1;ae+=(this.pathLength-j)/J}const oe=this._getPointAtLength(X+ae);if(!oe)return;const fe=p.Path.getLineLength(ge.x,ge.y,oe.x,oe.y);let pe=0;if(H)try{pe=H(Z[se-1],Z[se])*this.fontSize()}catch{pe=0}ge.x+=pe,oe.x+=pe,this.textWidth+=pe;const K=p.Path.getPointOnLine(pe+fe/2,ge.x,ge.y,oe.x,oe.y),ye=Math.atan2(oe.y-ge.y,oe.x-ge.x);this.glyphInfo.push({transposeX:K.x,transposeY:K.y,text:Z[se],rotation:ye,p0:ge,p1:oe}),X+=ae}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const R=[];this.glyphInfo.forEach(function(X){R.push(X.p0.x),R.push(X.p0.y),R.push(X.p1.x),R.push(X.p1.y)});let D=R[0]||0,O=R[0]||0,N=R[1]||0,H=R[1]||0,j,V;for(let X=0;X<R.length/2;X++)j=R[X*2],V=R[X*2+1],D=Math.min(D,j),O=Math.max(O,j),N=Math.min(N,V),H=Math.max(H,V);const Z=this.fontSize();return{x:D-Z/2,y:N-Z/2,width:O-D+Z,height:H-N+Z}}destroy(){return t.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return V0.TextPath=F,F.prototype._fillFunc=A,F.prototype._strokeFunc=I,F.prototype._fillFuncHit=A,F.prototype._strokeFuncHit=I,F.prototype.className="TextPath",F.prototype._attrsAffectingSize=["text","fontSize","data"],(0,S._registerNode)(F),s.Factory.addGetterSetter(F,"data"),s.Factory.addGetterSetter(F,"fontFamily","Arial"),s.Factory.addGetterSetter(F,"fontSize",12,(0,v.getNumberValidator)()),s.Factory.addGetterSetter(F,"fontStyle",E),s.Factory.addGetterSetter(F,"align","left"),s.Factory.addGetterSetter(F,"letterSpacing",0,(0,v.getNumberValidator)()),s.Factory.addGetterSetter(F,"textBaseline","middle"),s.Factory.addGetterSetter(F,"fontVariant",E),s.Factory.addGetterSetter(F,"text",r),s.Factory.addGetterSetter(F,"textDecoration",""),s.Factory.addGetterSetter(F,"kerningFunc",void 0),V0}var U0={},y4;function aU(){if(y4)return U0;y4=1,Object.defineProperty(U0,"__esModule",{value:!0}),U0.Transformer=void 0;const t=Ms(),s=ro(),c=Gs(),p=Aa(),g=uR(),v=BS(),S=Zi(),r=lo(),E=Zi(),A="tr-konva",I=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(ae=>ae+`.${A}`).join(" "),F="nodesRect",z=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],R={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},D="ontouchstart"in S.Konva._global;function O(ae,oe,fe){if(ae==="rotater")return fe;oe+=t.Util.degToRad(R[ae]||0);const pe=(t.Util.radToDeg(oe)%360+360)%360;return t.Util._inRange(pe,315+22.5,360)||t.Util._inRange(pe,0,22.5)?"ns-resize":t.Util._inRange(pe,45-22.5,45+22.5)?"nesw-resize":t.Util._inRange(pe,90-22.5,90+22.5)?"ew-resize":t.Util._inRange(pe,135-22.5,135+22.5)?"nwse-resize":t.Util._inRange(pe,180-22.5,180+22.5)?"ns-resize":t.Util._inRange(pe,225-22.5,225+22.5)?"nesw-resize":t.Util._inRange(pe,270-22.5,270+22.5)?"ew-resize":t.Util._inRange(pe,315-22.5,315+22.5)?"nwse-resize":(t.Util.error("Transformer has unknown angle for cursor detection: "+pe),"pointer")}const N=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function H(ae){return{x:ae.x+ae.width/2*Math.cos(ae.rotation)+ae.height/2*Math.sin(-ae.rotation),y:ae.y+ae.height/2*Math.cos(ae.rotation)+ae.width/2*Math.sin(ae.rotation)}}function j(ae,oe,fe){const pe=fe.x+(ae.x-fe.x)*Math.cos(oe)-(ae.y-fe.y)*Math.sin(oe),K=fe.y+(ae.x-fe.x)*Math.sin(oe)+(ae.y-fe.y)*Math.cos(oe);return{...ae,rotation:ae.rotation+oe,x:pe,y:K}}function V(ae,oe){const fe=H(ae);return j(ae,oe,fe)}function Z(ae,oe,fe){let pe=oe;for(let K=0;K<ae.length;K++){const ye=S.Konva.getAngle(ae[K]),J=Math.abs(ye-oe)%(Math.PI*2);Math.min(J,Math.PI*2-J)<fe&&(pe=ye)}return pe}let X=0,se=class extends v.Group{constructor(oe){super(oe),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(I,this.update),this.getNode()&&this.update()}attachTo(oe){return this.setNode(oe),this}setNode(oe){return t.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([oe])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return A+this._id}setNodes(oe=[]){this._nodes&&this._nodes.length&&this.detach();const fe=oe.filter(K=>K.isAncestorOf(this)?(t.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=oe=fe,oe.length===1&&this.useSingleNodeRotation()?this.rotation(oe[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(K=>{const ye=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(K._attrsAffectingSize.length){const J=K._attrsAffectingSize.map(de=>de+"Change."+this._getEventNamespace()).join(" ");K.on(J,ye)}K.on(z.map(J=>J+`.${this._getEventNamespace()}`).join(" "),ye),K.on(`absoluteTransformChange.${this._getEventNamespace()}`,ye),this._proxyDrag(K)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(oe){let fe;oe.on(`dragstart.${this._getEventNamespace()}`,pe=>{fe=oe.getAbsolutePosition(),!this.isDragging()&&oe!==this.findOne(".back")&&this.startDrag(pe,!1)}),oe.on(`dragmove.${this._getEventNamespace()}`,pe=>{if(!fe)return;const K=oe.getAbsolutePosition(),ye=K.x-fe.x,J=K.y-fe.y;this.nodes().forEach(de=>{if(de===oe||de.isDragging())return;const Ae=de.getAbsolutePosition();de.setAbsolutePosition({x:Ae.x+ye,y:Ae.y+J}),de.startDrag(pe)}),fe=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(oe=>{oe.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(F),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(F,this.__getNodeRect)}__getNodeShape(oe,fe=this.rotation(),pe){const K=oe.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),ye=oe.getAbsoluteScale(pe),J=oe.getAbsolutePosition(pe),de=K.x*ye.x-oe.offsetX()*ye.x,Ae=K.y*ye.y-oe.offsetY()*ye.y,ne=(S.Konva.getAngle(oe.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),xe={x:J.x+de*Math.cos(ne)+Ae*Math.sin(-ne),y:J.y+Ae*Math.cos(ne)+de*Math.sin(ne),width:K.width*ye.x,height:K.height*ye.y,rotation:ne};return j(xe,-S.Konva.getAngle(fe),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const fe=[];this.nodes().map(ne=>{const xe=ne.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),Ce=[{x:xe.x,y:xe.y},{x:xe.x+xe.width,y:xe.y},{x:xe.x+xe.width,y:xe.y+xe.height},{x:xe.x,y:xe.y+xe.height}],Re=ne.getAbsoluteTransform();Ce.forEach(function(Ee){const Oe=Re.point(Ee);fe.push(Oe)})});const pe=new t.Transform;pe.rotate(-S.Konva.getAngle(this.rotation()));let K=1/0,ye=1/0,J=-1/0,de=-1/0;fe.forEach(function(ne){const xe=pe.point(ne);K===void 0&&(K=J=xe.x,ye=de=xe.y),K=Math.min(K,xe.x),ye=Math.min(ye,xe.y),J=Math.max(J,xe.x),de=Math.max(de,xe.y)}),pe.invert();const Ae=pe.point({x:K,y:ye});return{x:Ae.x,y:Ae.y,width:J-K,height:de-ye,rotation:S.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),N.forEach(oe=>{this._createAnchor(oe)}),this._createAnchor("rotater")}_createAnchor(oe){const fe=new g.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:oe+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:D?10:"auto"}),pe=this;fe.on("mousedown touchstart",function(K){pe._handleMouseDown(K)}),fe.on("dragstart",K=>{fe.stopDrag(),K.cancelBubble=!0}),fe.on("dragend",K=>{K.cancelBubble=!0}),fe.on("mouseenter",()=>{const K=S.Konva.getAngle(this.rotation()),ye=this.rotateAnchorCursor(),J=O(oe,K,ye);fe.getStage().content&&(fe.getStage().content.style.cursor=J),this._cursorChange=!0}),fe.on("mouseout",()=>{fe.getStage().content&&(fe.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(fe)}_createBack(){const oe=new p.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(fe,pe){const K=pe.getParent(),ye=K.padding();fe.beginPath(),fe.rect(-ye,-ye,pe.width()+ye*2,pe.height()+ye*2),fe.moveTo(pe.width()/2,-ye),K.rotateEnabled()&&K.rotateLineVisible()&&fe.lineTo(pe.width()/2,-K.rotateAnchorOffset()*t.Util._sign(pe.height())-ye),fe.fillStrokeShape(pe)},hitFunc:(fe,pe)=>{if(!this.shouldOverdrawWholeArea())return;const K=this.padding();fe.beginPath(),fe.rect(-K,-K,pe.width()+K*2,pe.height()+K*2),fe.fillStrokeShape(pe)}});this.add(oe),this._proxyDrag(oe),oe.on("dragstart",fe=>{fe.cancelBubble=!0}),oe.on("dragmove",fe=>{fe.cancelBubble=!0}),oe.on("dragend",fe=>{fe.cancelBubble=!0}),this.on("dragmove",fe=>{this.update()})}_handleMouseDown(oe){if(this._transforming)return;this._movingAnchorName=oe.target.name().split(" ")[0];const fe=this._getNodeRect(),pe=fe.width,K=fe.height,ye=Math.sqrt(Math.pow(pe,2)+Math.pow(K,2));this.sin=Math.abs(K/ye),this.cos=Math.abs(pe/ye),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const J=oe.target.getAbsolutePosition(),de=oe.target.getStage().getPointerPosition();this._anchorDragOffset={x:de.x-J.x,y:de.y-J.y},X++,this._fire("transformstart",{evt:oe.evt,target:this.getNode()}),this._nodes.forEach(Ae=>{Ae._fire("transformstart",{evt:oe.evt,target:Ae})})}_handleMouseMove(oe){let fe,pe,K;const ye=this.findOne("."+this._movingAnchorName),J=ye.getStage();J.setPointersPositions(oe);const de=J.getPointerPosition();let Ae={x:de.x-this._anchorDragOffset.x,y:de.y-this._anchorDragOffset.y};const ne=ye.getAbsolutePosition();this.anchorDragBoundFunc()&&(Ae=this.anchorDragBoundFunc()(ne,Ae,oe)),ye.setAbsolutePosition(Ae);const xe=ye.getAbsolutePosition();if(ne.x===xe.x&&ne.y===xe.y)return;if(this._movingAnchorName==="rotater"){const nt=this._getNodeRect();fe=ye.x()-nt.width/2,pe=-ye.y()+nt.height/2;let $e=Math.atan2(-pe,fe)+Math.PI/2;nt.height<0&&($e-=Math.PI);const At=S.Konva.getAngle(this.rotation())+$e,xt=S.Konva.getAngle(this.rotationSnapTolerance()),jt=Z(this.rotationSnaps(),At,xt)-nt.rotation,cn=V(nt,jt);this._fitNodesInto(cn,oe);return}const Ce=this.shiftBehavior();let Re;Ce==="inverted"?Re=this.keepRatio()&&!oe.shiftKey:Ce==="none"?Re=this.keepRatio():Re=this.keepRatio()||oe.shiftKey;let Ee=this.centeredScaling()||oe.altKey;if(this._movingAnchorName==="top-left"){if(Re){const nt=Ee?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};K=Math.sqrt(Math.pow(nt.x-ye.x(),2)+Math.pow(nt.y-ye.y(),2));const $e=this.findOne(".top-left").x()>nt.x?-1:1,ct=this.findOne(".top-left").y()>nt.y?-1:1;fe=K*this.cos*$e,pe=K*this.sin*ct,this.findOne(".top-left").x(nt.x-fe),this.findOne(".top-left").y(nt.y-pe)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(ye.y());else if(this._movingAnchorName==="top-right"){if(Re){const nt=Ee?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};K=Math.sqrt(Math.pow(ye.x()-nt.x,2)+Math.pow(nt.y-ye.y(),2));const $e=this.findOne(".top-right").x()<nt.x?-1:1,ct=this.findOne(".top-right").y()>nt.y?-1:1;fe=K*this.cos*$e,pe=K*this.sin*ct,this.findOne(".top-right").x(nt.x+fe),this.findOne(".top-right").y(nt.y-pe)}var Oe=ye.position();this.findOne(".top-left").y(Oe.y),this.findOne(".bottom-right").x(Oe.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(ye.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(ye.x());else if(this._movingAnchorName==="bottom-left"){if(Re){const nt=Ee?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};K=Math.sqrt(Math.pow(nt.x-ye.x(),2)+Math.pow(ye.y()-nt.y,2));const $e=nt.x<ye.x()?-1:1,ct=ye.y()<nt.y?-1:1;fe=K*this.cos*$e,pe=K*this.sin*ct,ye.x(nt.x-fe),ye.y(nt.y+pe)}Oe=ye.position(),this.findOne(".top-left").x(Oe.x),this.findOne(".bottom-right").y(Oe.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(ye.y());else if(this._movingAnchorName==="bottom-right"){if(Re){const nt=Ee?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};K=Math.sqrt(Math.pow(ye.x()-nt.x,2)+Math.pow(ye.y()-nt.y,2));const $e=this.findOne(".bottom-right").x()<nt.x?-1:1,ct=this.findOne(".bottom-right").y()<nt.y?-1:1;fe=K*this.cos*$e,pe=K*this.sin*ct,this.findOne(".bottom-right").x(nt.x+fe),this.findOne(".bottom-right").y(nt.y+pe)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(Ee=this.centeredScaling()||oe.altKey,Ee){const nt=this.findOne(".top-left"),$e=this.findOne(".bottom-right"),ct=nt.x(),At=nt.y(),xt=this.getWidth()-$e.x(),It=this.getHeight()-$e.y();$e.move({x:-ct,y:-At}),nt.move({x:xt,y:It})}const Be=this.findOne(".top-left").getAbsolutePosition();fe=Be.x,pe=Be.y;const at=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),ut=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:fe,y:pe,width:at,height:ut,rotation:S.Konva.getAngle(this.rotation())},oe)}_handleMouseUp(oe){this._removeEvents(oe)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(oe){var fe;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const pe=this.getNode();X--,this._fire("transformend",{evt:oe,target:pe}),(fe=this.getLayer())===null||fe===void 0||fe.batchDraw(),pe&&this._nodes.forEach(K=>{var ye;K._fire("transformend",{evt:oe,target:K}),(ye=K.getLayer())===null||ye===void 0||ye.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(oe,fe){const pe=this._getNodeRect(),K=1;if(t.Util._inRange(oe.width,-this.padding()*2-K,K)){this.update();return}if(t.Util._inRange(oe.height,-this.padding()*2-K,K)){this.update();return}const ye=new t.Transform;if(ye.rotate(S.Konva.getAngle(this.rotation())),this._movingAnchorName&&oe.width<0&&this._movingAnchorName.indexOf("left")>=0){const Re=ye.point({x:-this.padding()*2,y:0});oe.x+=Re.x,oe.y+=Re.y,oe.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=Re.x,this._anchorDragOffset.y-=Re.y}else if(this._movingAnchorName&&oe.width<0&&this._movingAnchorName.indexOf("right")>=0){const Re=ye.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=Re.x,this._anchorDragOffset.y-=Re.y,oe.width+=this.padding()*2}if(this._movingAnchorName&&oe.height<0&&this._movingAnchorName.indexOf("top")>=0){const Re=ye.point({x:0,y:-this.padding()*2});oe.x+=Re.x,oe.y+=Re.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=Re.x,this._anchorDragOffset.y-=Re.y,oe.height+=this.padding()*2}else if(this._movingAnchorName&&oe.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const Re=ye.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=Re.x,this._anchorDragOffset.y-=Re.y,oe.height+=this.padding()*2}if(this.boundBoxFunc()){const Re=this.boundBoxFunc()(pe,oe);Re?oe=Re:t.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const J=1e7,de=new t.Transform;de.translate(pe.x,pe.y),de.rotate(pe.rotation),de.scale(pe.width/J,pe.height/J);const Ae=new t.Transform,ne=oe.width/J,xe=oe.height/J;this.flipEnabled()===!1?(Ae.translate(oe.x,oe.y),Ae.rotate(oe.rotation),Ae.translate(oe.width<0?oe.width:0,oe.height<0?oe.height:0),Ae.scale(Math.abs(ne),Math.abs(xe))):(Ae.translate(oe.x,oe.y),Ae.rotate(oe.rotation),Ae.scale(ne,xe));const Ce=Ae.multiply(de.invert());this._nodes.forEach(Re=>{var Ee;const Oe=Re.getParent().getAbsoluteTransform(),Be=Re.getTransform().copy();Be.translate(Re.offsetX(),Re.offsetY());const at=new t.Transform;at.multiply(Oe.copy().invert()).multiply(Ce).multiply(Oe).multiply(Be);const ut=at.decompose();Re.setAttrs(ut),(Ee=Re.getLayer())===null||Ee===void 0||Ee.batchDraw()}),this.rotation(t.Util._getRotation(oe.rotation)),this._nodes.forEach(Re=>{this._fire("transform",{evt:fe,target:Re}),Re._fire("transform",{evt:fe,target:Re})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(oe,fe){this.findOne(oe).setAttrs(fe)}update(){var oe;const fe=this._getNodeRect();this.rotation(t.Util._getRotation(fe.rotation));const pe=fe.width,K=fe.height,ye=this.enabledAnchors(),J=this.resizeEnabled(),de=this.padding(),Ae=this.anchorSize(),ne=this.find("._anchor");ne.forEach(Ce=>{Ce.setAttrs({width:Ae,height:Ae,offsetX:Ae/2,offsetY:Ae/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:Ae/2+de,offsetY:Ae/2+de,visible:J&&ye.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:pe/2,y:0,offsetY:Ae/2+de,visible:J&&ye.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:pe,y:0,offsetX:Ae/2-de,offsetY:Ae/2+de,visible:J&&ye.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:K/2,offsetX:Ae/2+de,visible:J&&ye.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:pe,y:K/2,offsetX:Ae/2-de,visible:J&&ye.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:K,offsetX:Ae/2+de,offsetY:Ae/2-de,visible:J&&ye.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:pe/2,y:K,offsetY:Ae/2-de,visible:J&&ye.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:pe,y:K,offsetX:Ae/2-de,offsetY:Ae/2-de,visible:J&&ye.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:pe/2,y:-this.rotateAnchorOffset()*t.Util._sign(K)-de,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:pe,height:K,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const xe=this.anchorStyleFunc();xe&&ne.forEach(Ce=>{xe(Ce)}),(oe=this.getLayer())===null||oe===void 0||oe.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const oe=this.findOne("."+this._movingAnchorName);oe&&oe.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),v.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return c.Node.prototype.toObject.call(this)}clone(oe){return c.Node.prototype.clone.call(this,oe)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};U0.Transformer=se,se.isTransforming=()=>X>0;function ge(ae){return ae instanceof Array||t.Util.warn("enabledAnchors value should be an array"),ae instanceof Array&&ae.forEach(function(oe){N.indexOf(oe)===-1&&t.Util.warn("Unknown anchor name: "+oe+". Available names are: "+N.join(", "))}),ae||[]}return se.prototype.className="Transformer",(0,E._registerNode)(se),s.Factory.addGetterSetter(se,"enabledAnchors",N,ge),s.Factory.addGetterSetter(se,"flipEnabled",!0,(0,r.getBooleanValidator)()),s.Factory.addGetterSetter(se,"resizeEnabled",!0),s.Factory.addGetterSetter(se,"anchorSize",10,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"rotateEnabled",!0),s.Factory.addGetterSetter(se,"rotateLineVisible",!0),s.Factory.addGetterSetter(se,"rotationSnaps",[]),s.Factory.addGetterSetter(se,"rotateAnchorOffset",50,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"rotateAnchorCursor","crosshair"),s.Factory.addGetterSetter(se,"rotationSnapTolerance",5,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"borderEnabled",!0),s.Factory.addGetterSetter(se,"anchorStroke","rgb(0, 161, 255)"),s.Factory.addGetterSetter(se,"anchorStrokeWidth",1,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"anchorFill","white"),s.Factory.addGetterSetter(se,"anchorCornerRadius",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"borderStroke","rgb(0, 161, 255)"),s.Factory.addGetterSetter(se,"borderStrokeWidth",1,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"borderDash"),s.Factory.addGetterSetter(se,"keepRatio",!0),s.Factory.addGetterSetter(se,"shiftBehavior","default"),s.Factory.addGetterSetter(se,"centeredScaling",!1),s.Factory.addGetterSetter(se,"ignoreStroke",!1),s.Factory.addGetterSetter(se,"padding",0,(0,r.getNumberValidator)()),s.Factory.addGetterSetter(se,"nodes"),s.Factory.addGetterSetter(se,"node"),s.Factory.addGetterSetter(se,"boundBoxFunc"),s.Factory.addGetterSetter(se,"anchorDragBoundFunc"),s.Factory.addGetterSetter(se,"anchorStyleFunc"),s.Factory.addGetterSetter(se,"shouldOverdrawWholeArea",!1),s.Factory.addGetterSetter(se,"useSingleNodeRotation",!0),s.Factory.backCompat(se,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),U0}var j0={},v4;function lU(){if(v4)return j0;v4=1,Object.defineProperty(j0,"__esModule",{value:!0}),j0.Wedge=void 0;const t=ro(),s=Aa(),c=Zi(),p=lo(),g=Zi();let v=class extends s.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.radius(),0,c.Konva.getAngle(this.angle()),this.clockwise()),r.lineTo(0,0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(r){this.radius(r/2)}setHeight(r){this.radius(r/2)}};return j0.Wedge=v,v.prototype.className="Wedge",v.prototype._centroid=!0,v.prototype._attrsAffectingSize=["radius"],(0,g._registerNode)(v),t.Factory.addGetterSetter(v,"radius",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"angle",0,(0,p.getNumberValidator)()),t.Factory.addGetterSetter(v,"clockwise",!1),t.Factory.backCompat(v,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),j0}var G0={},x4;function cU(){if(x4)return G0;x4=1,Object.defineProperty(G0,"__esModule",{value:!0}),G0.Blur=void 0;const t=ro(),s=Gs(),c=lo();function p(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const g=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],v=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function S(E,A){const I=E.data,F=E.width,z=E.height;let R,D,O,N,H,j,V,Z,X,se,ge,ae,oe,fe,pe,K,ye,J,de,Ae;const ne=A+A+1,xe=F-1,Ce=z-1,Re=A+1,Ee=Re*(Re+1)/2,Oe=new p,Be=g[A],at=v[A];let ut=null,nt=Oe,$e=null,ct=null;for(let At=1;At<ne;At++)nt=nt.next=new p,At===Re&&(ut=nt);nt.next=Oe,O=D=0;for(let At=0;At<z;At++){ae=oe=fe=pe=N=H=j=V=0,Z=Re*(K=I[D]),X=Re*(ye=I[D+1]),se=Re*(J=I[D+2]),ge=Re*(de=I[D+3]),N+=Ee*K,H+=Ee*ye,j+=Ee*J,V+=Ee*de,nt=Oe;for(let xt=0;xt<Re;xt++)nt.r=K,nt.g=ye,nt.b=J,nt.a=de,nt=nt.next;for(let xt=1;xt<Re;xt++)R=D+((xe<xt?xe:xt)<<2),N+=(nt.r=K=I[R])*(Ae=Re-xt),H+=(nt.g=ye=I[R+1])*Ae,j+=(nt.b=J=I[R+2])*Ae,V+=(nt.a=de=I[R+3])*Ae,ae+=K,oe+=ye,fe+=J,pe+=de,nt=nt.next;$e=Oe,ct=ut;for(let xt=0;xt<F;xt++)I[D+3]=de=V*Be>>at,de!==0?(de=255/de,I[D]=(N*Be>>at)*de,I[D+1]=(H*Be>>at)*de,I[D+2]=(j*Be>>at)*de):I[D]=I[D+1]=I[D+2]=0,N-=Z,H-=X,j-=se,V-=ge,Z-=$e.r,X-=$e.g,se-=$e.b,ge-=$e.a,R=O+((R=xt+A+1)<xe?R:xe)<<2,ae+=$e.r=I[R],oe+=$e.g=I[R+1],fe+=$e.b=I[R+2],pe+=$e.a=I[R+3],N+=ae,H+=oe,j+=fe,V+=pe,$e=$e.next,Z+=K=ct.r,X+=ye=ct.g,se+=J=ct.b,ge+=de=ct.a,ae-=K,oe-=ye,fe-=J,pe-=de,ct=ct.next,D+=4;O+=F}for(let At=0;At<F;At++){oe=fe=pe=ae=H=j=V=N=0,D=At<<2,Z=Re*(K=I[D]),X=Re*(ye=I[D+1]),se=Re*(J=I[D+2]),ge=Re*(de=I[D+3]),N+=Ee*K,H+=Ee*ye,j+=Ee*J,V+=Ee*de,nt=Oe;for(let It=0;It<Re;It++)nt.r=K,nt.g=ye,nt.b=J,nt.a=de,nt=nt.next;let xt=F;for(let It=1;It<=A;It++)D=xt+At<<2,N+=(nt.r=K=I[D])*(Ae=Re-It),H+=(nt.g=ye=I[D+1])*Ae,j+=(nt.b=J=I[D+2])*Ae,V+=(nt.a=de=I[D+3])*Ae,ae+=K,oe+=ye,fe+=J,pe+=de,nt=nt.next,It<Ce&&(xt+=F);D=At,$e=Oe,ct=ut;for(let It=0;It<z;It++)R=D<<2,I[R+3]=de=V*Be>>at,de>0?(de=255/de,I[R]=(N*Be>>at)*de,I[R+1]=(H*Be>>at)*de,I[R+2]=(j*Be>>at)*de):I[R]=I[R+1]=I[R+2]=0,N-=Z,H-=X,j-=se,V-=ge,Z-=$e.r,X-=$e.g,se-=$e.b,ge-=$e.a,R=At+((R=It+Re)<Ce?R:Ce)*F<<2,N+=ae+=$e.r=I[R],H+=oe+=$e.g=I[R+1],j+=fe+=$e.b=I[R+2],V+=pe+=$e.a=I[R+3],$e=$e.next,Z+=K=ct.r,X+=ye=ct.g,se+=J=ct.b,ge+=de=ct.a,ae-=K,oe-=ye,fe-=J,pe-=de,ct=ct.next,D+=F}}const r=function(A){const I=Math.round(this.blurRadius());I>0&&S(A,I)};return G0.Blur=r,t.Factory.addGetterSetter(s.Node,"blurRadius",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),G0}var $0={},b4;function uU(){if(b4)return $0;b4=1,Object.defineProperty($0,"__esModule",{value:!0}),$0.Brighten=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=this.brightness()*255,S=g.data,r=S.length;for(let E=0;E<r;E+=4)S[E]+=v,S[E+1]+=v,S[E+2]+=v};return $0.Brighten=p,t.Factory.addGetterSetter(s.Node,"brightness",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),$0}var H0={},w4;function dU(){if(w4)return H0;w4=1,Object.defineProperty(H0,"__esModule",{value:!0}),H0.Contrast=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=Math.pow((this.contrast()+100)/100,2),S=g.data,r=S.length;let E=150,A=150,I=150;for(let F=0;F<r;F+=4)E=S[F],A=S[F+1],I=S[F+2],E/=255,E-=.5,E*=v,E+=.5,E*=255,A/=255,A-=.5,A*=v,A+=.5,A*=255,I/=255,I-=.5,I*=v,I+=.5,I*=255,E=E<0?0:E>255?255:E,A=A<0?0:A>255?255:A,I=I<0?0:I>255?255:I,S[F]=E,S[F+1]=A,S[F+2]=I};return H0.Contrast=p,t.Factory.addGetterSetter(s.Node,"contrast",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),H0}var q0={},S4;function hU(){if(S4)return q0;S4=1,Object.defineProperty(q0,"__esModule",{value:!0}),q0.Emboss=void 0;const t=ro(),s=Gs(),c=Ms(),p=lo(),g=function(v){const S=this.embossStrength()*10,r=this.embossWhiteLevel()*255,E=this.embossDirection(),A=this.embossBlend(),I=v.data,F=v.width,z=v.height,R=F*4;let D=0,O=0,N=z;switch(E){case"top-left":D=-1,O=-1;break;case"top":D=-1,O=0;break;case"top-right":D=-1,O=1;break;case"right":D=0,O=1;break;case"bottom-right":D=1,O=1;break;case"bottom":D=1,O=0;break;case"bottom-left":D=1,O=-1;break;case"left":D=0,O=-1;break;default:c.Util.error("Unknown emboss direction: "+E)}do{const H=(N-1)*R;let j=D;N+j<1&&(j=0),N+j>z&&(j=0);const V=(N-1+j)*F*4;let Z=F;do{const X=H+(Z-1)*4;let se=O;Z+se<1&&(se=0),Z+se>F&&(se=0);const ge=V+(Z-1+se)*4,ae=I[X]-I[ge],oe=I[X+1]-I[ge+1],fe=I[X+2]-I[ge+2];let pe=ae;const K=pe>0?pe:-pe,ye=oe>0?oe:-oe,J=fe>0?fe:-fe;if(ye>K&&(pe=oe),J>K&&(pe=fe),pe*=S,A){const de=I[X]+pe,Ae=I[X+1]+pe,ne=I[X+2]+pe;I[X]=de>255?255:de<0?0:de,I[X+1]=Ae>255?255:Ae<0?0:Ae,I[X+2]=ne>255?255:ne<0?0:ne}else{let de=r-pe;de<0?de=0:de>255&&(de=255),I[X]=I[X+1]=I[X+2]=de}}while(--Z)}while(--N)};return q0.Emboss=g,t.Factory.addGetterSetter(s.Node,"embossStrength",.5,(0,p.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"embossWhiteLevel",.5,(0,p.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"embossDirection","top-left",void 0,t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"embossBlend",!1,void 0,t.Factory.afterSetFilter),q0}var W0={},T4;function fU(){if(T4)return W0;T4=1,Object.defineProperty(W0,"__esModule",{value:!0}),W0.Enhance=void 0;const t=ro(),s=Gs(),c=lo();function p(v,S,r,E,A){const I=r-S,F=A-E;if(I===0)return E+F/2;if(F===0)return E;let z=(v-S)/I;return z=F*z+E,z}const g=function(v){const S=v.data,r=S.length;let E=S[0],A=E,I,F=S[1],z=F,R,D=S[2],O=D,N;const H=this.enhance();if(H===0)return;for(let ae=0;ae<r;ae+=4)I=S[ae+0],I<E?E=I:I>A&&(A=I),R=S[ae+1],R<F?F=R:R>z&&(z=R),N=S[ae+2],N<D?D=N:N>O&&(O=N);A===E&&(A=255,E=0),z===F&&(z=255,F=0),O===D&&(O=255,D=0);let j,V,Z,X,se,ge;if(H>0)j=A+H*(255-A),V=E-H*(E-0),Z=z+H*(255-z),X=F-H*(F-0),se=O+H*(255-O),ge=D-H*(D-0);else{const ae=(A+E)*.5;j=A+H*(A-ae),V=E+H*(E-ae);const oe=(z+F)*.5;Z=z+H*(z-oe),X=F+H*(F-oe);const fe=(O+D)*.5;se=O+H*(O-fe),ge=D+H*(D-fe)}for(let ae=0;ae<r;ae+=4)S[ae+0]=p(S[ae+0],E,A,V,j),S[ae+1]=p(S[ae+1],F,z,X,Z),S[ae+2]=p(S[ae+2],D,O,ge,se)};return W0.Enhance=g,t.Factory.addGetterSetter(s.Node,"enhance",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),W0}var Z0={},C4;function pU(){if(C4)return Z0;C4=1,Object.defineProperty(Z0,"__esModule",{value:!0}),Z0.Grayscale=void 0;const t=function(s){const c=s.data,p=c.length;for(let g=0;g<p;g+=4){const v=.34*c[g]+.5*c[g+1]+.16*c[g+2];c[g]=v,c[g+1]=v,c[g+2]=v}};return Z0.Grayscale=t,Z0}var Y0={},E4;function mU(){if(E4)return Y0;E4=1,Object.defineProperty(Y0,"__esModule",{value:!0}),Y0.HSL=void 0;const t=ro(),s=Gs(),c=lo();t.Factory.addGetterSetter(s.Node,"hue",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"saturation",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"luminance",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter);const p=function(g){const v=g.data,S=v.length,r=1,E=Math.pow(2,this.saturation()),A=Math.abs(this.hue()+360)%360,I=this.luminance()*127,F=r*E*Math.cos(A*Math.PI/180),z=r*E*Math.sin(A*Math.PI/180),R=.299*r+.701*F+.167*z,D=.587*r-.587*F+.33*z,O=.114*r-.114*F-.497*z,N=.299*r-.299*F-.328*z,H=.587*r+.413*F+.035*z,j=.114*r-.114*F+.293*z,V=.299*r-.3*F+1.25*z,Z=.587*r-.586*F-1.05*z,X=.114*r+.886*F-.2*z;let se,ge,ae,oe;for(let fe=0;fe<S;fe+=4)se=v[fe+0],ge=v[fe+1],ae=v[fe+2],oe=v[fe+3],v[fe+0]=R*se+D*ge+O*ae+I,v[fe+1]=N*se+H*ge+j*ae+I,v[fe+2]=V*se+Z*ge+X*ae+I,v[fe+3]=oe};return Y0.HSL=p,Y0}var X0={},A4;function gU(){if(A4)return X0;A4=1,Object.defineProperty(X0,"__esModule",{value:!0}),X0.HSV=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=g.data,S=v.length,r=Math.pow(2,this.value()),E=Math.pow(2,this.saturation()),A=Math.abs(this.hue()+360)%360,I=r*E*Math.cos(A*Math.PI/180),F=r*E*Math.sin(A*Math.PI/180),z=.299*r+.701*I+.167*F,R=.587*r-.587*I+.33*F,D=.114*r-.114*I-.497*F,O=.299*r-.299*I-.328*F,N=.587*r+.413*I+.035*F,H=.114*r-.114*I+.293*F,j=.299*r-.3*I+1.25*F,V=.587*r-.586*I-1.05*F,Z=.114*r+.886*I-.2*F;for(let X=0;X<S;X+=4){const se=v[X+0],ge=v[X+1],ae=v[X+2],oe=v[X+3];v[X+0]=z*se+R*ge+D*ae,v[X+1]=O*se+N*ge+H*ae,v[X+2]=j*se+V*ge+Z*ae,v[X+3]=oe}};return X0.HSV=p,t.Factory.addGetterSetter(s.Node,"hue",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"saturation",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"value",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),X0}var K0={},P4;function _U(){if(P4)return K0;P4=1,Object.defineProperty(K0,"__esModule",{value:!0}),K0.Invert=void 0;const t=function(s){const c=s.data,p=c.length;for(let g=0;g<p;g+=4)c[g]=255-c[g],c[g+1]=255-c[g+1],c[g+2]=255-c[g+2]};return K0.Invert=t,K0}var J0={},M4;function yU(){if(M4)return J0;M4=1,Object.defineProperty(J0,"__esModule",{value:!0}),J0.Kaleidoscope=void 0;const t=ro(),s=Gs(),c=Ms(),p=lo(),g=function(r,E,A){const I=r.data,F=E.data,z=r.width,R=r.height,D=A.polarCenterX||z/2,O=A.polarCenterY||R/2;let N=Math.sqrt(D*D+O*O),H=z-D,j=R-O;const V=Math.sqrt(H*H+j*j);N=V>N?V:N;const Z=R,X=z,se=360/X*Math.PI/180;for(let ge=0;ge<X;ge+=1){const ae=Math.sin(ge*se),oe=Math.cos(ge*se);for(let fe=0;fe<Z;fe+=1){H=Math.floor(D+N*fe/Z*oe),j=Math.floor(O+N*fe/Z*ae);let pe=(j*z+H)*4;const K=I[pe+0],ye=I[pe+1],J=I[pe+2],de=I[pe+3];pe=(ge+fe*z)*4,F[pe+0]=K,F[pe+1]=ye,F[pe+2]=J,F[pe+3]=de}}},v=function(r,E,A){const I=r.data,F=E.data,z=r.width,R=r.height,D=A.polarCenterX||z/2,O=A.polarCenterY||R/2;let N=Math.sqrt(D*D+O*O),H=z-D,j=R-O;const V=Math.sqrt(H*H+j*j);N=V>N?V:N;const Z=R,X=z,se=0;let ge,ae;for(H=0;H<z;H+=1)for(j=0;j<R;j+=1){const oe=H-D,fe=j-O,pe=Math.sqrt(oe*oe+fe*fe)*Z/N;let K=(Math.atan2(fe,oe)*180/Math.PI+360+se)%360;K=K*X/360,ge=Math.floor(K),ae=Math.floor(pe);let ye=(ae*z+ge)*4;const J=I[ye+0],de=I[ye+1],Ae=I[ye+2],ne=I[ye+3];ye=(j*z+H)*4,F[ye+0]=J,F[ye+1]=de,F[ye+2]=Ae,F[ye+3]=ne}},S=function(r){const E=r.width,A=r.height;let I,F,z,R,D,O,N,H,j,V,Z=Math.round(this.kaleidoscopePower());const X=Math.round(this.kaleidoscopeAngle()),se=Math.floor(E*(X%360)/360);if(Z<1)return;const ge=c.Util.createCanvasElement();ge.width=E,ge.height=A;const ae=ge.getContext("2d").getImageData(0,0,E,A);c.Util.releaseCanvas(ge),g(r,ae,{polarCenterX:E/2,polarCenterY:A/2});let oe=E/Math.pow(2,Z);for(;oe<=8;)oe=oe*2,Z-=1;oe=Math.ceil(oe);let fe=oe,pe=0,K=fe,ye=1;for(se+oe>E&&(pe=fe,K=0,ye=-1),F=0;F<A;F+=1)for(I=pe;I!==K;I+=ye)z=Math.round(I+se)%E,j=(E*F+z)*4,D=ae.data[j+0],O=ae.data[j+1],N=ae.data[j+2],H=ae.data[j+3],V=(E*F+I)*4,ae.data[V+0]=D,ae.data[V+1]=O,ae.data[V+2]=N,ae.data[V+3]=H;for(F=0;F<A;F+=1)for(fe=Math.floor(oe),R=0;R<Z;R+=1){for(I=0;I<fe+1;I+=1)j=(E*F+I)*4,D=ae.data[j+0],O=ae.data[j+1],N=ae.data[j+2],H=ae.data[j+3],V=(E*F+fe*2-I-1)*4,ae.data[V+0]=D,ae.data[V+1]=O,ae.data[V+2]=N,ae.data[V+3]=H;fe*=2}v(ae,r,{})};return J0.Kaleidoscope=S,t.Factory.addGetterSetter(s.Node,"kaleidoscopePower",2,(0,p.getNumberValidator)(),t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"kaleidoscopeAngle",0,(0,p.getNumberValidator)(),t.Factory.afterSetFilter),J0}var Q0={},I4;function vU(){if(I4)return Q0;I4=1,Object.defineProperty(Q0,"__esModule",{value:!0}),Q0.Mask=void 0;const t=ro(),s=Gs(),c=lo();function p(z,R,D){let O=(D*z.width+R)*4;const N=[];return N.push(z.data[O++],z.data[O++],z.data[O++],z.data[O++]),N}function g(z,R){return Math.sqrt(Math.pow(z[0]-R[0],2)+Math.pow(z[1]-R[1],2)+Math.pow(z[2]-R[2],2))}function v(z){const R=[0,0,0];for(let D=0;D<z.length;D++)R[0]+=z[D][0],R[1]+=z[D][1],R[2]+=z[D][2];return R[0]/=z.length,R[1]/=z.length,R[2]/=z.length,R}function S(z,R){const D=p(z,0,0),O=p(z,z.width-1,0),N=p(z,0,z.height-1),H=p(z,z.width-1,z.height-1),j=R||10;if(g(D,O)<j&&g(O,H)<j&&g(H,N)<j&&g(N,D)<j){const V=v([O,D,H,N]),Z=[];for(let X=0;X<z.width*z.height;X++){const se=g(V,[z.data[X*4],z.data[X*4+1],z.data[X*4+2]]);Z[X]=se<j?0:255}return Z}}function r(z,R){for(let D=0;D<z.width*z.height;D++)z.data[4*D+3]=R[D]}function E(z,R,D){const O=[1,1,1,1,0,1,1,1,1],N=Math.round(Math.sqrt(O.length)),H=Math.floor(N/2),j=[];for(let V=0;V<D;V++)for(let Z=0;Z<R;Z++){const X=V*R+Z;let se=0;for(let ge=0;ge<N;ge++)for(let ae=0;ae<N;ae++){const oe=V+ge-H,fe=Z+ae-H;if(oe>=0&&oe<D&&fe>=0&&fe<R){const pe=oe*R+fe,K=O[ge*N+ae];se+=z[pe]*K}}j[X]=se===2040?255:0}return j}function A(z,R,D){const O=[1,1,1,1,1,1,1,1,1],N=Math.round(Math.sqrt(O.length)),H=Math.floor(N/2),j=[];for(let V=0;V<D;V++)for(let Z=0;Z<R;Z++){const X=V*R+Z;let se=0;for(let ge=0;ge<N;ge++)for(let ae=0;ae<N;ae++){const oe=V+ge-H,fe=Z+ae-H;if(oe>=0&&oe<D&&fe>=0&&fe<R){const pe=oe*R+fe,K=O[ge*N+ae];se+=z[pe]*K}}j[X]=se>=1020?255:0}return j}function I(z,R,D){const O=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],N=Math.round(Math.sqrt(O.length)),H=Math.floor(N/2),j=[];for(let V=0;V<D;V++)for(let Z=0;Z<R;Z++){const X=V*R+Z;let se=0;for(let ge=0;ge<N;ge++)for(let ae=0;ae<N;ae++){const oe=V+ge-H,fe=Z+ae-H;if(oe>=0&&oe<D&&fe>=0&&fe<R){const pe=oe*R+fe,K=O[ge*N+ae];se+=z[pe]*K}}j[X]=se}return j}const F=function(z){const R=this.threshold();let D=S(z,R);return D&&(D=E(D,z.width,z.height),D=A(D,z.width,z.height),D=I(D,z.width,z.height),r(z,D)),z};return Q0.Mask=F,t.Factory.addGetterSetter(s.Node,"threshold",0,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),Q0}var ey={},R4;function xU(){if(R4)return ey;R4=1,Object.defineProperty(ey,"__esModule",{value:!0}),ey.Noise=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=this.noise()*255,S=g.data,r=S.length,E=v/2;for(let A=0;A<r;A+=4)S[A+0]+=E-2*E*Math.random(),S[A+1]+=E-2*E*Math.random(),S[A+2]+=E-2*E*Math.random()};return ey.Noise=p,t.Factory.addGetterSetter(s.Node,"noise",.2,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),ey}var ty={},D4;function bU(){if(D4)return ty;D4=1,Object.defineProperty(ty,"__esModule",{value:!0}),ty.Pixelate=void 0;const t=ro(),s=Ms(),c=Gs(),p=lo(),g=function(v){let S=Math.ceil(this.pixelSize()),r=v.width,E=v.height,A=Math.ceil(r/S),I=Math.ceil(E/S),F=v.data;if(S<=0){s.Util.error("pixelSize value can not be <= 0");return}for(let z=0;z<A;z+=1)for(let R=0;R<I;R+=1){let D=0,O=0,N=0,H=0;const j=z*S,V=j+S,Z=R*S,X=Z+S;let se=0;for(let ge=j;ge<V;ge+=1)if(!(ge>=r))for(let ae=Z;ae<X;ae+=1){if(ae>=E)continue;const oe=(r*ae+ge)*4;D+=F[oe+0],O+=F[oe+1],N+=F[oe+2],H+=F[oe+3],se+=1}D=D/se,O=O/se,N=N/se,H=H/se;for(let ge=j;ge<V;ge+=1)if(!(ge>=r))for(let ae=Z;ae<X;ae+=1){if(ae>=E)continue;const oe=(r*ae+ge)*4;F[oe+0]=D,F[oe+1]=O,F[oe+2]=N,F[oe+3]=H}}};return ty.Pixelate=g,t.Factory.addGetterSetter(c.Node,"pixelSize",8,(0,p.getNumberValidator)(),t.Factory.afterSetFilter),ty}var ny={},k4;function wU(){if(k4)return ny;k4=1,Object.defineProperty(ny,"__esModule",{value:!0}),ny.Posterize=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=Math.round(this.levels()*254)+1,S=g.data,r=S.length,E=255/v;for(let A=0;A<r;A+=1)S[A]=Math.floor(S[A]/E)*E};return ny.Posterize=p,t.Factory.addGetterSetter(s.Node,"levels",.5,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),ny}var ry={},O4;function SU(){if(O4)return ry;O4=1,Object.defineProperty(ry,"__esModule",{value:!0}),ry.RGB=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=g.data,S=v.length,r=this.red(),E=this.green(),A=this.blue();for(let I=0;I<S;I+=4){const F=(.34*v[I]+.5*v[I+1]+.16*v[I+2])/255;v[I]=F*r,v[I+1]=F*E,v[I+2]=F*A,v[I+3]=v[I+3]}};return ry.RGB=p,t.Factory.addGetterSetter(s.Node,"red",0,function(g){return this._filterUpToDate=!1,g>255?255:g<0?0:Math.round(g)}),t.Factory.addGetterSetter(s.Node,"green",0,function(g){return this._filterUpToDate=!1,g>255?255:g<0?0:Math.round(g)}),t.Factory.addGetterSetter(s.Node,"blue",0,c.RGBComponent,t.Factory.afterSetFilter),ry}var iy={},L4;function TU(){if(L4)return iy;L4=1,Object.defineProperty(iy,"__esModule",{value:!0}),iy.RGBA=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=g.data,S=v.length,r=this.red(),E=this.green(),A=this.blue(),I=this.alpha();for(let F=0;F<S;F+=4){const z=1-I;v[F]=r*I+v[F]*z,v[F+1]=E*I+v[F+1]*z,v[F+2]=A*I+v[F+2]*z}};return iy.RGBA=p,t.Factory.addGetterSetter(s.Node,"red",0,function(g){return this._filterUpToDate=!1,g>255?255:g<0?0:Math.round(g)}),t.Factory.addGetterSetter(s.Node,"green",0,function(g){return this._filterUpToDate=!1,g>255?255:g<0?0:Math.round(g)}),t.Factory.addGetterSetter(s.Node,"blue",0,c.RGBComponent,t.Factory.afterSetFilter),t.Factory.addGetterSetter(s.Node,"alpha",1,function(g){return this._filterUpToDate=!1,g>1?1:g<0?0:g}),iy}var oy={},z4;function CU(){if(z4)return oy;z4=1,Object.defineProperty(oy,"__esModule",{value:!0}),oy.Sepia=void 0;const t=function(s){const c=s.data,p=c.length;for(let g=0;g<p;g+=4){const v=c[g+0],S=c[g+1],r=c[g+2];c[g+0]=Math.min(255,v*.393+S*.769+r*.189),c[g+1]=Math.min(255,v*.349+S*.686+r*.168),c[g+2]=Math.min(255,v*.272+S*.534+r*.131)}};return oy.Sepia=t,oy}var sy={},F4;function EU(){if(F4)return sy;F4=1,Object.defineProperty(sy,"__esModule",{value:!0}),sy.Solarize=void 0;const t=function(s){const c=s.data,p=s.width,g=s.height,v=p*4;let S=g;do{const r=(S-1)*v;let E=p;do{const A=r+(E-1)*4;let I=c[A],F=c[A+1],z=c[A+2];I>127&&(I=255-I),F>127&&(F=255-F),z>127&&(z=255-z),c[A]=I,c[A+1]=F,c[A+2]=z}while(--E)}while(--S)};return sy.Solarize=t,sy}var ay={},B4;function AU(){if(B4)return ay;B4=1,Object.defineProperty(ay,"__esModule",{value:!0}),ay.Threshold=void 0;const t=ro(),s=Gs(),c=lo(),p=function(g){const v=this.threshold()*255,S=g.data,r=S.length;for(let E=0;E<r;E+=1)S[E]=S[E]<v?0:255};return ay.Threshold=p,t.Factory.addGetterSetter(s.Node,"threshold",.5,(0,c.getNumberValidator)(),t.Factory.afterSetFilter),ay}var N4;function PU(){if(N4)return b0;N4=1,Object.defineProperty(b0,"__esModule",{value:!0}),b0.Konva=void 0;const t=Gw(),s=YV(),c=KV(),p=JV(),g=QV(),v=eU(),S=tU(),r=cR(),E=VS(),A=uR(),I=nU(),F=rU(),z=iU(),R=oU(),D=dR(),O=sU(),N=aU(),H=lU(),j=cU(),V=uU(),Z=dU(),X=hU(),se=fU(),ge=pU(),ae=mU(),oe=gU(),fe=_U(),pe=yU(),K=vU(),ye=xU(),J=bU(),de=wU(),Ae=SU(),ne=TU(),xe=CU(),Ce=EU(),Re=AU();return b0.Konva=t.Konva.Util._assign(t.Konva,{Arc:s.Arc,Arrow:c.Arrow,Circle:p.Circle,Ellipse:g.Ellipse,Image:v.Image,Label:S.Label,Tag:S.Tag,Line:r.Line,Path:E.Path,Rect:A.Rect,RegularPolygon:I.RegularPolygon,Ring:F.Ring,Sprite:z.Sprite,Star:R.Star,Text:D.Text,TextPath:O.TextPath,Transformer:N.Transformer,Wedge:H.Wedge,Filters:{Blur:j.Blur,Brighten:V.Brighten,Contrast:Z.Contrast,Emboss:X.Emboss,Enhance:se.Enhance,Grayscale:ge.Grayscale,HSL:ae.HSL,HSV:oe.HSV,Invert:fe.Invert,Kaleidoscope:pe.Kaleidoscope,Mask:K.Mask,Noise:ye.Noise,Pixelate:J.Pixelate,Posterize:de.Posterize,RGB:Ae.RGB,RGBA:ne.RGBA,Sepia:xe.Sepia,Solarize:Ce.Solarize,Threshold:Re.Threshold}}),b0}var MU=Z1.exports,V4;function IU(){if(V4)return Z1.exports;V4=1,Object.defineProperty(MU,"__esModule",{value:!0});const t=PU();return Z1.exports=t.Konva,Z1.exports}IU();var _1={exports:{}},U4;function RU(){return U4||(U4=1,(function(t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Konva=void 0;var c=Gw();Object.defineProperty(s,"Konva",{enumerable:!0,get:function(){return c.Konva}});const p=Gw();t.exports=p.Konva})(_1,_1.exports)),_1.exports}var DU=RU();const hx=al(DU);var rw={exports:{}},iw={exports:{}};/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j4;function kU(){return j4||(j4=1,(function(t){t.exports=function(s){function c(y,x,L,W){return new nm(y,x,L,W)}function p(){}function g(y){var x="https://react.dev/errors/"+y;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var L=2;L<arguments.length;L++)x+="&args[]="+encodeURIComponent(arguments[L])}return"Minified React error #"+y+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function v(y){var x=y,L=y;if(y.alternate)for(;x.return;)x=x.return;else{y=x;do x=y,(x.flags&4098)!==0&&(L=x.return),y=x.return;while(y)}return x.tag===3?L:null}function S(y){if(v(y)!==y)throw Error(g(188))}function r(y){var x=y.alternate;if(!x){if(x=v(y),x===null)throw Error(g(188));return x!==y?null:y}for(var L=y,W=x;;){var ie=L.return;if(ie===null)break;var be=ie.alternate;if(be===null){if(W=ie.return,W!==null){L=W;continue}break}if(ie.child===be.child){for(be=ie.child;be;){if(be===L)return S(ie),y;if(be===W)return S(ie),x;be=be.sibling}throw Error(g(188))}if(L.return!==W.return)L=ie,W=be;else{for(var ot=!1,kt=ie.child;kt;){if(kt===L){ot=!0,L=ie,W=be;break}if(kt===W){ot=!0,W=ie,L=be;break}kt=kt.sibling}if(!ot){for(kt=be.child;kt;){if(kt===L){ot=!0,L=be,W=ie;break}if(kt===W){ot=!0,W=be,L=ie;break}kt=kt.sibling}if(!ot)throw Error(g(189))}}if(L.alternate!==W)throw Error(g(190))}if(L.tag!==3)throw Error(g(188));return L.stateNode.current===L?y:x}function E(y){var x=y.tag;if(x===5||x===26||x===27||x===6)return y;for(y=y.child;y!==null;){if(x=E(y),x!==null)return x;y=y.sibling}return null}function A(y){var x=y.tag;if(x===5||x===26||x===27||x===6)return y;for(y=y.child;y!==null;){if(y.tag!==4&&(x=A(y),x!==null))return x;y=y.sibling}return null}function I(y){return y===null||typeof y!="object"?null:(y=Jc&&y[Jc]||y["@@iterator"],typeof y=="function"?y:null)}function F(y){if(y==null)return null;if(typeof y=="function")return y.$$typeof===Nu?null:y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case Ud:return"Fragment";case jd:return"Profiler";case cg:return"StrictMode";case Hh:return"Suspense";case Kc:return"SuspenseList";case qh:return"Activity"}if(typeof y=="object")switch(y.$$typeof){case Vd:return"Portal";case $l:return(y.displayName||"Context")+".Provider";case ug:return(y._context.displayName||"Context")+".Consumer";case $h:var x=y.render;return y=y.displayName,y||(y=x.displayName||x.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case Xf:return x=y.displayName||null,x!==null?x:F(y.type)||"Memo";case Hl:x=y._payload,y=y._init;try{return F(y(x))}catch{}}return null}function z(y){return{current:y}}function R(y){0>Jl||(y.current=Fo[Jl],Fo[Jl]=null,Jl--)}function D(y,x){Jl++,Fo[Jl]=y.current,y.current=x}function O(y){return y>>>=0,y===0?32:31-(Yu(y)/ym|0)|0}function N(y){var x=y&42;if(x!==0)return x;switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return y&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return y}}function H(y,x,L){var W=y.pendingLanes;if(W===0)return 0;var ie=0,be=y.suspendedLanes,ot=y.pingedLanes;y=y.warmLanes;var kt=W&134217727;return kt!==0?(W=kt&~be,W!==0?ie=N(W):(ot&=kt,ot!==0?ie=N(ot):L||(L=kt&~y,L!==0&&(ie=N(L))))):(kt=W&~be,kt!==0?ie=N(kt):ot!==0?ie=N(ot):L||(L=W&~y,L!==0&&(ie=N(L)))),ie===0?0:x!==0&&x!==ie&&(x&be)===0&&(be=ie&-ie,L=x&-x,be>=L||be===32&&(L&4194048)!==0)?x:ie}function j(y,x){return(y.pendingLanes&~(y.suspendedLanes&~y.pingedLanes)&x)===0}function V(y,x){switch(y){case 1:case 2:case 4:case 8:case 64:return x+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Z(){var y=Xu;return Xu<<=1,(Xu&4194048)===0&&(Xu=256),y}function X(){var y=lu;return lu<<=1,(lu&62914560)===0&&(lu=4194304),y}function se(y){for(var x=[],L=0;31>L;L++)x.push(y);return x}function ge(y,x){y.pendingLanes|=x,x!==268435456&&(y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0)}function ae(y,x,L,W,ie,be){var ot=y.pendingLanes;y.pendingLanes=L,y.suspendedLanes=0,y.pingedLanes=0,y.warmLanes=0,y.expiredLanes&=L,y.entangledLanes&=L,y.errorRecoveryDisabledLanes&=L,y.shellSuspendCounter=0;var kt=y.entanglements,gn=y.expirationTimes,Yn=y.hiddenUpdates;for(L=ot&~L;0<L;){var or=31-Os(L),vr=1<<or;kt[or]=0,gn[or]=-1;var Er=Yn[or];if(Er!==null)for(Yn[or]=null,or=0;or<Er.length;or++){var Ri=Er[or];Ri!==null&&(Ri.lane&=-536870913)}L&=~vr}W!==0&&oe(y,W,0),be!==0&&ie===0&&y.tag!==0&&(y.suspendedLanes|=be&~(ot&~x))}function oe(y,x,L){y.pendingLanes|=x,y.suspendedLanes&=~x;var W=31-Os(x);y.entangledLanes|=x,y.entanglements[W]=y.entanglements[W]|1073741824|L&4194090}function fe(y,x){var L=y.entangledLanes|=x;for(y=y.entanglements;L;){var W=31-Os(L),ie=1<<W;ie&x|y[W]&x&&(y[W]|=x),L&=~ie}}function pe(y){switch(y){case 2:y=1;break;case 8:y=4;break;case 32:y=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:y=128;break;case 268435456:y=134217728;break;default:y=0}return y}function K(y){return y&=-y,2<y?8<y?(y&134217727)!==0?32:268435456:8:2}function ye(y){if(typeof xg=="function"&&vp(y),wa&&typeof wa.setStrictMode=="function")try{wa.setStrictMode(Jd,y)}catch{}}function J(y){if(xp===void 0)try{throw Error()}catch(L){var x=L.stack.trim().match(/\n( *(at )?)/);xp=x&&x[1]||"",bm=-1<L.stack.indexOf(`
    at`)?" (<anonymous>)":-1<L.stack.indexOf("@")?"@unknown:0:0":""}return`
`+xp+y+bm}function de(y,x){if(!y||ef)return"";ef=!0;var L=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var W={DetermineComponentFrameRoot:function(){try{if(x){var vr=function(){throw Error()};if(Object.defineProperty(vr.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(vr,[])}catch(Ri){var Er=Ri}Reflect.construct(y,[],vr)}else{try{vr.call()}catch(Ri){Er=Ri}y.call(vr.prototype)}}else{try{throw Error()}catch(Ri){Er=Ri}(vr=y())&&typeof vr.catch=="function"&&vr.catch(function(){})}}catch(Ri){if(Ri&&Er&&typeof Ri.stack=="string")return[Ri.stack,Er.stack]}return[null,null]}};W.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var ie=Object.getOwnPropertyDescriptor(W.DetermineComponentFrameRoot,"name");ie&&ie.configurable&&Object.defineProperty(W.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var be=W.DetermineComponentFrameRoot(),ot=be[0],kt=be[1];if(ot&&kt){var gn=ot.split(`
`),Yn=kt.split(`
`);for(ie=W=0;W<gn.length&&!gn[W].includes("DetermineComponentFrameRoot");)W++;for(;ie<Yn.length&&!Yn[ie].includes("DetermineComponentFrameRoot");)ie++;if(W===gn.length||ie===Yn.length)for(W=gn.length-1,ie=Yn.length-1;1<=W&&0<=ie&&gn[W]!==Yn[ie];)ie--;for(;1<=W&&0<=ie;W--,ie--)if(gn[W]!==Yn[ie]){if(W!==1||ie!==1)do if(W--,ie--,0>ie||gn[W]!==Yn[ie]){var or=`
`+gn[W].replace(" at new "," at ");return y.displayName&&or.includes("<anonymous>")&&(or=or.replace("<anonymous>",y.displayName)),or}while(1<=W&&0<=ie);break}}}finally{ef=!1,Error.prepareStackTrace=L}return(L=y?y.displayName||y.name:"")?J(L):""}function Ae(y){switch(y.tag){case 26:case 27:case 5:return J(y.type);case 16:return J("Lazy");case 13:return J("Suspense");case 19:return J("SuspenseList");case 0:case 15:return de(y.type,!1);case 11:return de(y.type.render,!1);case 1:return de(y.type,!0);case 31:return J("Activity");default:return""}}function ne(y){try{var x="";do x+=Ae(y),y=y.return;while(y);return x}catch(L){return`
Error generating stack: `+L.message+`
`+L.stack}}function xe(y,x){if(typeof y=="object"&&y!==null){var L=wm.get(y);return L!==void 0?L:(x={value:y,source:x,stack:ne(x)},wm.set(y,x),x)}return{value:y,source:x,stack:ne(x)}}function Ce(y,x){Ju[Qu++]=bp,Ju[Qu++]=tf,tf=y,bp=x}function Re(y,x,L){Za[Ya++]=Oa,Za[Ya++]=Mc,Za[Ya++]=Pi,Pi=y;var W=Oa;y=Mc;var ie=32-Os(W)-1;W&=~(1<<ie),L+=1;var be=32-Os(x)+ie;if(30<be){var ot=ie-ie%5;be=(W&(1<<ot)-1).toString(32),W>>=ot,ie-=ot,Oa=1<<32-Os(x)+ie|L<<ie|W,Mc=be+y}else Oa=1<<be|L<<ie|W,Mc=y}function Ee(y){y.return!==null&&(Ce(y,1),Re(y,1,0))}function Oe(y){for(;y===tf;)tf=Ju[--Qu],Ju[Qu]=null,bp=Ju[--Qu],Ju[Qu]=null;for(;y===Pi;)Pi=Za[--Ya],Za[Ya]=null,Mc=Za[--Ya],Za[Ya]=null,Oa=Za[--Ya],Za[Ya]=null}function Be(y,x){D(Xa,x),D(cu,y),D(Ls,null),y=ep(x),R(Ls),D(Ls,y)}function at(){R(Ls),R(cu),R(Xa)}function ut(y){y.memoizedState!==null&&D(Qd,y);var x=Ls.current,L=om(x,y.type);x!==L&&(D(cu,y),D(Ls,L))}function nt(y){cu.current===y&&(R(Ls),R(cu)),Qd.current===y&&(R(Qd),Js?Zl._currentValue=Vu:Zl._currentValue2=Vu)}function $e(y){var x=Error(g(418,""));throw cn(xe(x,y)),Ka}function ct(y,x){if(!pa)throw Error(g(175));gg(y.stateNode,y.type,y.memoizedProps,x,y)||$e(y)}function At(y){for(zs=y.return;zs;)switch(zs.tag){case 5:case 13:Bi=!1;return;case 27:case 3:Bi=!0;return;default:zs=zs.return}}function xt(y){if(!pa||y!==zs)return!1;if(!Ci)return At(y),Ci=!0,!1;var x=y.tag;if(Ho?x!==3&&x!==27&&(x!==5||jr(y.type)&&!np(y.type,y.memoizedProps))&&Wo&&$e(y):x!==3&&(x!==5||jr(y.type)&&!np(y.type,y.memoizedProps))&&Wo&&$e(y),At(y),x===13){if(!pa)throw Error(g(316));if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(g(317));Wo=yg(y)}else Wo=Ho&&x===27?lp(y.type,Wo):zs?pm(y.stateNode):null;return!0}function It(){pa&&(Wo=zs=null,Ci=!1)}function jt(){var y=Tl;return y!==null&&(vi===null?vi=y:vi.push.apply(vi,y),Tl=null),y}function cn(y){Tl===null?Tl=[y]:Tl.push(y)}function Se(y,x){return y===x&&(y!==0||1/y===1/x)||y!==y&&x!==x}function mt(y,x,L){Js?(D(uu,x._currentValue),x._currentValue=L):(D(uu,x._currentValue2),x._currentValue2=L)}function Ke(y){var x=uu.current;Js?y._currentValue=x:y._currentValue2=x,R(uu)}function Ue(y,x,L){for(;y!==null;){var W=y.alternate;if((y.childLanes&x)!==x?(y.childLanes|=x,W!==null&&(W.childLanes|=x)):W!==null&&(W.childLanes&x)!==x&&(W.childLanes|=x),y===L)break;y=y.return}}function je(y,x,L,W){var ie=y.child;for(ie!==null&&(ie.return=y);ie!==null;){var be=ie.dependencies;if(be!==null){var ot=ie.child;be=be.firstContext;e:for(;be!==null;){var kt=be;be=ie;for(var gn=0;gn<x.length;gn++)if(kt.context===x[gn]){be.lanes|=L,kt=be.alternate,kt!==null&&(kt.lanes|=L),Ue(be.return,L,y),W||(ot=null);break e}be=kt.next}}else if(ie.tag===18){if(ot=ie.return,ot===null)throw Error(g(341));ot.lanes|=L,be=ot.alternate,be!==null&&(be.lanes|=L),Ue(ot,L,y),ot=null}else ot=ie.child;if(ot!==null)ot.return=ie;else for(ot=ie;ot!==null;){if(ot===y){ot=null;break}if(ie=ot.sibling,ie!==null){ie.return=ot.return,ot=ie;break}ot=ot.return}ie=ot}}function gt(y,x,L,W){y=null;for(var ie=x,be=!1;ie!==null;){if(!be){if((ie.flags&524288)!==0)be=!0;else if((ie.flags&262144)!==0)break}if(ie.tag===10){var ot=ie.alternate;if(ot===null)throw Error(g(387));if(ot=ot.memoizedProps,ot!==null){var kt=ie.type;Fs(ie.pendingProps.value,ot.value)||(y!==null?y.push(kt):y=[kt])}}else if(ie===Qd.current){if(ot=ie.alternate,ot===null)throw Error(g(387));ot.memoizedState.memoizedState!==ie.memoizedState.memoizedState&&(y!==null?y.push(Zl):y=[Zl])}ie=ie.return}y!==null&&je(x,y,L,W),x.flags|=262144}function Ot(y){for(y=y.firstContext;y!==null;){var x=y.context;if(!Fs(Js?x._currentValue:x._currentValue2,y.memoizedValue))return!0;y=y.next}return!1}function Ft(y){du=y,Ic=null,y=y.dependencies,y!==null&&(y.firstContext=null)}function pt(y){return An(du,y)}function dn(y,x){return du===null&&Ft(y),An(y,x)}function An(y,x){var L=Js?x._currentValue:x._currentValue2;if(x={context:x,memoizedValue:L,next:null},Ic===null){if(y===null)throw Error(g(308));Ic=x,y.dependencies={lanes:0,firstContext:x},y.flags|=524288}else Ic=Ic.next=x;return L}function Gt(){return{controller:new nf,data:new Map,refCount:0}}function Yt(y){y.refCount--,y.refCount===0&&I_(R_,function(){y.controller.abort()})}function zn(y){y!==bs&&y.next===null&&(bs===null?hu=bs=y:bs=bs.next=y),Cl=!0,Rc||(Rc=!0,ni())}function $n(y,x){if(!El&&Cl){El=!0;do for(var L=!1,W=hu;W!==null;){if(y!==0){var ie=W.pendingLanes;if(ie===0)var be=0;else{var ot=W.suspendedLanes,kt=W.pingedLanes;be=(1<<31-Os(42|y)+1)-1,be&=ie&~(ot&~kt),be=be&201326741?be&201326741|1:be?be|2:0}be!==0&&(L=!0,mr(W,be))}else be=Zn,be=H(W,W===hi?be:0,W.cancelPendingCommit!==null||W.timeoutHandle!==xl),(be&3)===0||j(W,be)||(L=!0,mr(W,be));W=W.next}while(L);El=!1}}function On(){Bn()}function Bn(){Cl=Rc=!1;var y=0;Sa!==0&&(In()&&(y=Sa),Sa=0);for(var x=ta(),L=null,W=hu;W!==null;){var ie=W.next,be=kn(W,x);be===0?(W.next=null,L===null?hu=ie:L.next=ie,ie===null&&(bs=L)):(L=W,(y!==0||(be&3)!==0)&&(Cl=!0)),W=ie}$n(y)}function kn(y,x){for(var L=y.suspendedLanes,W=y.pingedLanes,ie=y.expirationTimes,be=y.pendingLanes&-62914561;0<be;){var ot=31-Os(be),kt=1<<ot,gn=ie[ot];gn===-1?((kt&L)===0||(kt&W)!==0)&&(ie[ot]=V(kt,x)):gn<=x&&(y.expiredLanes|=kt),be&=~kt}if(x=hi,L=Zn,L=H(y,y===x?L:0,y.cancelPendingCommit!==null||y.timeoutHandle!==xl),W=y.callbackNode,L===0||y===x&&(Fn===2||Fn===9)||y.cancelPendingCommit!==null)return W!==null&&W!==null&&Kd(W),y.callbackNode=null,y.callbackPriority=0;if((L&3)===0||j(y,L)){if(x=L&-L,x===y.callbackPriority)return x;switch(W!==null&&Kd(W),K(L)){case 2:case 8:L=_p;break;case 32:L=yp;break;case 268435456:L=xm;break;default:L=yp}return W=Pr.bind(null,y),L=Pc(L,W),y.callbackPriority=x,y.callbackNode=L,x}return W!==null&&W!==null&&Kd(W),y.callbackPriority=2,y.callbackNode=null,2}function Pr(y,x){if(Ji!==0&&Ji!==5)return y.callbackNode=null,y.callbackPriority=0,null;var L=y.callbackNode;if(Fd()&&y.callbackNode!==L)return null;var W=Zn;return W=H(y,y===hi?W:0,y.cancelPendingCommit!==null||y.timeoutHandle!==xl),W===0?null:(og(y,W,x),kn(y,ta()),y.callbackNode!=null&&y.callbackNode===L?Pr.bind(null,y):null)}function mr(y,x){if(Fd())return null;og(y,x,!0)}function ni(){op?C_(function(){(Dr&6)!==0?Pc(Ku,On):Bn()}):Pc(Ku,On)}function tr(){return Sa===0&&(Sa=Z()),Sa}function Br(y,x){if(Al===null){var L=Al=[];La=0,ed=tr(),rf={status:"pending",value:void 0,then:function(W){L.push(W)}}}return La++,x.then(Tr,Tr),x}function Tr(){if(--La===0&&Al!==null){rf!==null&&(rf.status="fulfilled");var y=Al;Al=null,ed=0,rf=null;for(var x=0;x<y.length;x++)(0,y[x])()}}function Fr(y,x){var L=[],W={status:"pending",value:null,reason:null,then:function(ie){L.push(ie)}};return y.then(function(){W.status="fulfilled",W.value=x;for(var ie=0;ie<L.length;ie++)(0,L[ie])(x)},function(ie){for(W.status="rejected",W.reason=ie,ie=0;ie<L.length;ie++)(0,L[ie])(void 0)}),W}function di(){var y=n.current;return y!==null?y:hi.pooledCache}function Mo(y,x){x===null?D(n,n.current):D(n,x.pool)}function ds(){var y=di();return y===null?null:{parent:Js?Bo._currentValue:Bo._currentValue2,pool:y}}function Yr(y,x){if(Fs(y,x))return!0;if(typeof y!="object"||y===null||typeof x!="object"||x===null)return!1;var L=Object.keys(y),W=Object.keys(x);if(L.length!==W.length)return!1;for(W=0;W<L.length;W++){var ie=L[W];if(!a.call(x,ie)||!Fs(y[ie],x[ie]))return!1}return!0}function co(y){return y=y.status,y==="fulfilled"||y==="rejected"}function ya(){}function cl(y,x,L){switch(L=y[L],L===void 0?y.push(x):L!==x&&(x.then(ya,ya),x=L),x.status){case"fulfilled":return x.value;case"rejected":throw y=x.reason,yo(y),y;default:if(typeof x.status=="string")x.then(ya,ya);else{if(y=hi,y!==null&&100<y.shellSuspendCounter)throw Error(g(482));y=x,y.status="pending",y.then(function(W){if(x.status==="pending"){var ie=x;ie.status="fulfilled",ie.value=W}},function(W){if(x.status==="pending"){var ie=x;ie.status="rejected",ie.reason=W}})}switch(x.status){case"fulfilled":return x.value;case"rejected":throw y=x.reason,yo(y),y}throw P=x,d}}function Kt(){if(P===null)throw Error(g(459));var y=P;return P=null,y}function yo(y){if(y===d||y===b)throw Error(g(483))}function ca(){for(var y=G,x=q=G=0;x<y;){var L=k[x];k[x++]=null;var W=k[x];k[x++]=null;var ie=k[x];k[x++]=null;var be=k[x];if(k[x++]=null,W!==null&&ie!==null){var ot=W.pending;ot===null?ie.next=ie:(ie.next=ot.next,ot.next=ie),W.pending=ie}be!==0&&Ie(L,ie,be)}}function Va(y,x,L,W){k[G++]=y,k[G++]=x,k[G++]=L,k[G++]=W,q|=W,y.lanes|=W,y=y.alternate,y!==null&&(y.lanes|=W)}function _t(y,x,L,W){return Va(y,x,L,W),Ge(y)}function we(y,x){return Va(y,null,null,x),Ge(y)}function Ie(y,x,L){y.lanes|=L;var W=y.alternate;W!==null&&(W.lanes|=L);for(var ie=!1,be=y.return;be!==null;)be.childLanes|=L,W=be.alternate,W!==null&&(W.childLanes|=L),be.tag===22&&(y=be.stateNode,y===null||y._visibility&1||(ie=!0)),y=be,be=be.return;return y.tag===3?(be=y.stateNode,ie&&x!==null&&(ie=31-Os(L),y=be.hiddenUpdates,W=y[ie],W===null?y[ie]=[x]:W.push(x),x.lane=L|536870912),be):null}function Ge(y){if(50<tc)throw tc=0,Ml=null,Error(g(185));for(var x=y.return;x!==null;)y=x,x=y.return;return y.tag===3?y.stateNode:null}function it(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tt(y,x){y=y.updateQueue,x.updateQueue===y&&(x.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,callbacks:null})}function et(y){return{lane:y,tag:0,payload:null,callback:null,next:null}}function Ct(y,x,L){var W=y.updateQueue;if(W===null)return null;if(W=W.shared,(Dr&2)!==0){var ie=W.pending;return ie===null?x.next=x:(x.next=ie.next,ie.next=x),W.pending=x,x=Ge(y),Ie(y,null,L),x}return Va(y,W,x,L),Ge(y)}function dt(y,x,L){if(x=x.updateQueue,x!==null&&(x=x.shared,(L&4194048)!==0)){var W=x.lanes;W&=y.pendingLanes,L|=W,x.lanes=L,fe(y,L)}}function Rt(y,x){var L=y.updateQueue,W=y.alternate;if(W!==null&&(W=W.updateQueue,L===W)){var ie=null,be=null;if(L=L.firstBaseUpdate,L!==null){do{var ot={lane:L.lane,tag:L.tag,payload:L.payload,callback:null,next:null};be===null?ie=be=ot:be=be.next=ot,L=L.next}while(L!==null);be===null?ie=be=x:be=be.next=x}else ie=be=x;L={baseState:W.baseState,firstBaseUpdate:ie,lastBaseUpdate:be,shared:W.shared,callbacks:W.callbacks},y.updateQueue=L;return}y=L.lastBaseUpdate,y===null?L.firstBaseUpdate=x:y.next=x,L.lastBaseUpdate=x}function un(){if(Y){var y=rf;if(y!==null)throw y}}function Wt(y,x,L,W){Y=!1;var ie=y.updateQueue;te=!1;var be=ie.firstBaseUpdate,ot=ie.lastBaseUpdate,kt=ie.shared.pending;if(kt!==null){ie.shared.pending=null;var gn=kt,Yn=gn.next;gn.next=null,ot===null?be=Yn:ot.next=Yn,ot=gn;var or=y.alternate;or!==null&&(or=or.updateQueue,kt=or.lastBaseUpdate,kt!==ot&&(kt===null?or.firstBaseUpdate=Yn:kt.next=Yn,or.lastBaseUpdate=gn))}if(be!==null){var vr=ie.baseState;ot=0,or=Yn=gn=null,kt=be;do{var Er=kt.lane&-536870913,Ri=Er!==kt.lane;if(Ri?(Zn&Er)===Er:(W&Er)===Er){Er!==0&&Er===ed&&(Y=!0),or!==null&&(or=or.next={lane:0,tag:kt.tag,payload:kt.payload,callback:null,next:null});e:{var Ja=y,Qa=kt;Er=x;var za=L;switch(Qa.tag){case 1:if(Ja=Qa.payload,typeof Ja=="function"){vr=Ja.call(za,vr,Er);break e}vr=Ja;break e;case 3:Ja.flags=Ja.flags&-65537|128;case 0:if(Ja=Qa.payload,Er=typeof Ja=="function"?Ja.call(za,vr,Er):Ja,Er==null)break e;vr=Yf({},vr,Er);break e;case 2:te=!0}}Er=kt.callback,Er!==null&&(y.flags|=64,Ri&&(y.flags|=8192),Ri=ie.callbacks,Ri===null?ie.callbacks=[Er]:Ri.push(Er))}else Ri={lane:Er,tag:kt.tag,payload:kt.payload,callback:kt.callback,next:null},or===null?(Yn=or=Ri,gn=vr):or=or.next=Ri,ot|=Er;if(kt=kt.next,kt===null){if(kt=ie.shared.pending,kt===null)break;Ri=kt,kt=Ri.next,Ri.next=null,ie.lastBaseUpdate=Ri,ie.shared.pending=null}}while(!0);or===null&&(gn=vr),ie.baseState=gn,ie.firstBaseUpdate=Yn,ie.lastBaseUpdate=or,be===null&&(ie.shared.lanes=0),ss|=ot,y.lanes=ot,y.memoizedState=vr}}function qn(y,x){if(typeof y!="function")throw Error(g(191,y));y.call(x)}function lr(y,x){var L=y.callbacks;if(L!==null)for(y.callbacks=null,y=0;y<L.length;y++)qn(L[y],x)}function fr(y,x){y=bo,D(le,y),D(re,x),bo=y|x.baseLanes}function Nr(){D(le,bo),D(re,re.current)}function Ir(){bo=le.current,R(re),R(le)}function gr(){throw Error(g(321))}function wi(y,x){if(x===null)return!1;for(var L=0;L<x.length&&L<y.length;L++)if(!Fs(y[L],x[L]))return!1;return!0}function Vr(y,x,L,W,ie,be){return ce=be,Pe=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,Zr.H=y===null||y.memoizedState===null?Tt:ht,Ze=!1,be=L(W,ie),Ze=!1,Fe&&(be=ko(x,L,W,ie)),fo(y),be}function fo(y){Zr.H=Xe;var x=me!==null&&me.next!==null;if(ce=0,Me=me=Pe=null,Le=!1,Ye=0,qe=null,x)throw Error(g(300));y===null||Ht||(y=y.dependencies,y!==null&&Ot(y)&&(Ht=!0))}function ko(y,x,L,W){Pe=y;var ie=0;do{if(Fe&&(qe=null),Ye=0,Fe=!1,25<=ie)throw Error(g(301));if(ie+=1,Me=me=null,y.updateQueue!=null){var be=y.updateQueue;be.lastEffect=null,be.events=null,be.stores=null,be.memoCache!=null&&(be.memoCache.index=0)}Zr.H=Lt,be=x(L,W)}while(Fe);return be}function jo(){var y=Zr.H,x=y.useState()[0];return x=typeof x.then=="function"?rs(x):x,y=y.useState()[0],(me!==null?me.memoizedState:null)!==y&&(Pe.flags|=1024),x}function bi(){var y=He!==0;return He=0,y}function ai(y,x,L){x.updateQueue=y.updateQueue,x.flags&=-2053,y.lanes&=~L}function io(y){if(Le){for(y=y.memoizedState;y!==null;){var x=y.queue;x!==null&&(x.pending=null),y=y.next}Le=!1}ce=0,Me=me=Pe=null,Fe=!1,Ye=He=0,qe=null}function yi(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?Pe.memoizedState=Me=y:Me=Me.next=y,Me}function Hr(){if(me===null){var y=Pe.alternate;y=y!==null?y.memoizedState:null}else y=me.next;var x=Me===null?Pe.memoizedState:Me.next;if(x!==null)Me=x,me=y;else{if(y===null)throw Pe.alternate===null?Error(g(467)):Error(g(310));me=y,y={memoizedState:me.memoizedState,baseState:me.baseState,baseQueue:me.baseQueue,queue:me.queue,next:null},Me===null?Pe.memoizedState=Me=y:Me=Me.next=y}return Me}function ts(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function rs(y){var x=Ye;return Ye+=1,qe===null&&(qe=[]),y=cl(qe,y,x),x=Pe,(Me===null?x.memoizedState:Me.next)===null&&(x=x.alternate,Zr.H=x===null||x.memoizedState===null?Tt:ht),y}function $s(y){if(y!==null&&typeof y=="object"){if(typeof y.then=="function")return rs(y);if(y.$$typeof===$l)return pt(y)}throw Error(g(438,String(y)))}function ul(y){var x=null,L=Pe.updateQueue;if(L!==null&&(x=L.memoCache),x==null){var W=Pe.alternate;W!==null&&(W=W.updateQueue,W!==null&&(W=W.memoCache,W!=null&&(x={data:W.data.map(function(ie){return ie.slice()}),index:0})))}if(x==null&&(x={data:[],index:0}),L===null&&(L=ts(),Pe.updateQueue=L),L.memoCache=x,L=x.data[x.index],L===void 0)for(L=x.data[x.index]=Array(y),W=0;W<y;W++)L[W]=Kf;return x.index++,L}function Oo(y,x){return typeof x=="function"?x(y):x}function dc(y){var x=Hr();return vf(x,me,y)}function vf(y,x,L){var W=y.queue;if(W===null)throw Error(g(311));W.lastRenderedReducer=L;var ie=y.baseQueue,be=W.pending;if(be!==null){if(ie!==null){var ot=ie.next;ie.next=be.next,be.next=ot}x.baseQueue=ie=be,W.pending=null}if(be=y.baseState,ie===null)y.memoizedState=be;else{x=ie.next;var kt=ot=null,gn=null,Yn=x,or=!1;do{var vr=Yn.lane&-536870913;if(vr!==Yn.lane?(Zn&vr)===vr:(ce&vr)===vr){var Er=Yn.revertLane;if(Er===0)gn!==null&&(gn=gn.next={lane:0,revertLane:0,action:Yn.action,hasEagerState:Yn.hasEagerState,eagerState:Yn.eagerState,next:null}),vr===ed&&(or=!0);else if((ce&Er)===Er){Yn=Yn.next,Er===ed&&(or=!0);continue}else vr={lane:0,revertLane:Yn.revertLane,action:Yn.action,hasEagerState:Yn.hasEagerState,eagerState:Yn.eagerState,next:null},gn===null?(kt=gn=vr,ot=be):gn=gn.next=vr,Pe.lanes|=Er,ss|=Er;vr=Yn.action,Ze&&L(be,vr),be=Yn.hasEagerState?Yn.eagerState:L(be,vr)}else Er={lane:vr,revertLane:Yn.revertLane,action:Yn.action,hasEagerState:Yn.hasEagerState,eagerState:Yn.eagerState,next:null},gn===null?(kt=gn=Er,ot=be):gn=gn.next=Er,Pe.lanes|=vr,ss|=vr;Yn=Yn.next}while(Yn!==null&&Yn!==x);if(gn===null?ot=be:gn.next=kt,!Fs(be,y.memoizedState)&&(Ht=!0,or&&(L=rf,L!==null)))throw L;y.memoizedState=be,y.baseState=ot,y.baseQueue=gn,W.lastRenderedState=be}return ie===null&&(W.lanes=0),[y.memoizedState,W.dispatch]}function zl(y){var x=Hr(),L=x.queue;if(L===null)throw Error(g(311));L.lastRenderedReducer=y;var W=L.dispatch,ie=L.pending,be=x.memoizedState;if(ie!==null){L.pending=null;var ot=ie=ie.next;do be=y(be,ot.action),ot=ot.next;while(ot!==ie);Fs(be,x.memoizedState)||(Ht=!0),x.memoizedState=be,x.baseQueue===null&&(x.baseState=be),L.lastRenderedState=be}return[be,W]}function Cu(y,x,L){var W=Pe,ie=Hr(),be=Ci;if(be){if(L===void 0)throw Error(g(407));L=L()}else L=x();var ot=!Fs((me||ie).memoizedState,L);ot&&(ie.memoizedState=L,Ht=!0),ie=ie.queue;var kt=hc.bind(null,W,ie,y);if(Bl(2048,8,kt,[y]),ie.getSnapshot!==x||ot||Me!==null&&Me.memoizedState.tag&1){if(W.flags|=2048,dl(9,Hs(),md.bind(null,W,ie,L,x),null),hi===null)throw Error(g(349));be||(ce&124)!==0||pd(W,x,L)}return L}function pd(y,x,L){y.flags|=16384,y={getSnapshot:x,value:L},x=Pe.updateQueue,x===null?(x=ts(),Pe.updateQueue=x,x.stores=[y]):(L=x.stores,L===null?x.stores=[y]:L.push(y))}function md(y,x,L,W){x.value=L,x.getSnapshot=W,gd(x)&&xf(y)}function hc(y,x,L){return L(function(){gd(x)&&xf(y)})}function gd(y){var x=y.getSnapshot;y=y.value;try{var L=x();return!Fs(y,L)}catch{return!0}}function xf(y){var x=we(y,2);x!==null&&ka(x,y,2)}function Ua(y){var x=yi();if(typeof y=="function"){var L=y;if(y=L(),Ze){ye(!0);try{L()}finally{ye(!1)}}}return x.memoizedState=x.baseState=y,x.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:y},x}function bf(y,x,L,W){return y.baseState=L,vf(y,me,typeof W=="function"?W:Oo)}function wf(y,x,L,W,ie){if(qs(y))throw Error(g(485));if(y=x.action,y!==null){var be={payload:ie,action:y,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ot){be.listeners.push(ot)}};Zr.T!==null?L(!0):be.isTransition=!1,W(be),L=x.pending,L===null?(be.next=x.pending=be,va(x,be)):(be.next=L.next,x.pending=L.next=be)}}function va(y,x){var L=x.action,W=x.payload,ie=y.state;if(x.isTransition){var be=Zr.T,ot={};Zr.T=ot;try{var kt=L(ie,W),gn=Zr.S;gn!==null&&gn(ot,kt),ja(y,x,kt)}catch(Yn){Pa(y,x,Yn)}finally{Zr.T=be}}else try{be=L(ie,W),ja(y,x,be)}catch(Yn){Pa(y,x,Yn)}}function ja(y,x,L){L!==null&&typeof L=="object"&&typeof L.then=="function"?L.then(function(W){Fl(y,x,W)},function(W){return Pa(y,x,W)}):Fl(y,x,L)}function Fl(y,x,L){x.status="fulfilled",x.value=L,Is(x),y.state=L,x=y.pending,x!==null&&(L=x.next,L===x?y.pending=null:(L=L.next,x.next=L,va(y,L)))}function Pa(y,x,L){var W=y.pending;if(y.pending=null,W!==null){W=W.next;do x.status="rejected",x.reason=L,Is(x),x=x.next;while(x!==W)}y.action=null}function Is(y){y=y.listeners;for(var x=0;x<y.length;x++)(0,y[x])()}function Nc(y,x){return x}function Sf(y,x){if(Ci){var L=hi.formState;if(L!==null){e:{var W=Pe;if(Ci){if(Wo){var ie=fg(Wo,Bi);if(ie){Wo=pm(ie),W=P_(ie);break e}}$e(W)}W=!1}W&&(x=L[0])}}L=yi(),L.memoizedState=L.baseState=x,W={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nc,lastRenderedState:x},L.queue=W,L=Ga.bind(null,Pe,W),W.dispatch=L,W=Ua(!1);var be=bd.bind(null,Pe,!1,W.queue);return W=yi(),ie={state:x,dispatch:null,action:y,pending:null},W.queue=ie,L=wf.bind(null,Pe,ie,be,L),ie.dispatch=L,W.memoizedState=y,[x,L,!1]}function _d(y){var x=Hr();return fc(x,me,y)}function fc(y,x,L){if(x=vf(y,x,Nc)[0],y=dc(Oo)[0],typeof x=="object"&&x!==null&&typeof x.then=="function")try{var W=rs(x)}catch(ot){throw ot===d?b:ot}else W=x;x=Hr();var ie=x.queue,be=ie.dispatch;return L!==x.memoizedState&&(Pe.flags|=2048,dl(9,Hs(),bh.bind(null,ie,L),null)),[W,be,y]}function bh(y,x){y.action=x}function yd(y){var x=Hr(),L=me;if(L!==null)return fc(x,L,y);Hr(),x=x.memoizedState,L=Hr();var W=L.queue.dispatch;return L.memoizedState=y,[x,W,!1]}function dl(y,x,L,W){return y={tag:y,create:L,deps:W,inst:x,next:null},x=Pe.updateQueue,x===null&&(x=ts(),Pe.updateQueue=x),L=x.lastEffect,L===null?x.lastEffect=y.next=y:(W=L.next,L.next=y,y.next=W,x.lastEffect=y),y}function Hs(){return{destroy:void 0,resource:void 0}}function Tf(){return Hr().memoizedState}function Eu(y,x,L,W){var ie=yi();W=W===void 0?null:W,Pe.flags|=y,ie.memoizedState=dl(1|x,Hs(),L,W)}function Bl(y,x,L,W){var ie=Hr();W=W===void 0?null:W;var be=ie.memoizedState.inst;me!==null&&W!==null&&wi(W,me.memoizedState.deps)?ie.memoizedState=dl(x,be,L,W):(Pe.flags|=y,ie.memoizedState=dl(1|x,be,L,W))}function wh(y,x){Eu(8390656,8,y,x)}function Cf(y,x){Bl(2048,8,y,x)}function Sh(y,x){return Bl(4,2,y,x)}function Wr(y,x){return Bl(4,4,y,x)}function Au(y,x){if(typeof x=="function"){y=y();var L=x(y);return function(){typeof L=="function"?L():x(null)}}if(x!=null)return y=y(),x.current=y,function(){x.current=null}}function Gp(y,x,L){L=L!=null?L.concat([y]):null,Bl(4,4,Au.bind(null,x,y),L)}function Ef(){}function Th(y,x){var L=Hr();x=x===void 0?null:x;var W=L.memoizedState;return x!==null&&wi(x,W[1])?W[0]:(L.memoizedState=[y,x],y)}function pc(y,x){var L=Hr();x=x===void 0?null:x;var W=L.memoizedState;if(x!==null&&wi(x,W[1]))return W[0];if(W=y(),Ze){ye(!0);try{y()}finally{ye(!1)}}return L.memoizedState=[W,x],W}function Vc(y,x,L){return L===void 0||(ce&1073741824)!==0?y.memoizedState=x:(y.memoizedState=L,y=ig(),Pe.lanes|=y,ss|=y,L)}function vd(y,x,L,W){return Fs(L,x)?L:re.current!==null?(y=Vc(y,L,W),Fs(y,x)||(Ht=!0),y):(ce&42)===0?(Ht=!0,y.memoizedState=L):(y=ig(),Pe.lanes|=y,ss|=y,x)}function Ch(y,x,L,W,ie){var be=ma();ps(be!==0&&8>be?be:8);var ot=Zr.T,kt={};Zr.T=kt,bd(y,!1,x,L);try{var gn=ie(),Yn=Zr.S;if(Yn!==null&&Yn(kt,gn),gn!==null&&typeof gn=="object"&&typeof gn.then=="function"){var or=Fr(gn,W);gc(y,x,or,da(y))}else gc(y,x,W,da(y))}catch(vr){gc(y,x,{then:function(){},status:"rejected",reason:vr},da())}finally{ps(be),Zr.T=ot}}function $p(y){var x=y.memoizedState;if(x!==null)return x;x={memoizedState:Vu,baseState:Vu,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:Vu},next:null};var L={};return x.next={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:L},next:null},y.memoizedState=x,y=y.alternate,y!==null&&(y.memoizedState=x),x}function mc(){return pt(Zl)}function Hp(){return Hr().memoizedState}function Af(){return Hr().memoizedState}function xd(y){for(var x=y.return;x!==null;){switch(x.tag){case 24:case 3:var L=da();y=et(L);var W=Ct(x,y,L);W!==null&&(ka(W,x,L),dt(W,x,L)),x={cache:Gt()},y.payload=x;return}x=x.return}}function Pf(y,x,L){var W=da();L={lane:W,revertLane:0,action:L,hasEagerState:!1,eagerState:null,next:null},qs(y)?Uc(x,L):(L=_t(y,x,L,W),L!==null&&(ka(L,y,W),xa(L,x,W)))}function Ga(y,x,L){var W=da();gc(y,x,L,W)}function gc(y,x,L,W){var ie={lane:W,revertLane:0,action:L,hasEagerState:!1,eagerState:null,next:null};if(qs(y))Uc(x,ie);else{var be=y.alternate;if(y.lanes===0&&(be===null||be.lanes===0)&&(be=x.lastRenderedReducer,be!==null))try{var ot=x.lastRenderedState,kt=be(ot,L);if(ie.hasEagerState=!0,ie.eagerState=kt,Fs(kt,ot))return Va(y,x,ie,0),hi===null&&ca(),!1}catch{}finally{}if(L=_t(y,x,ie,W),L!==null)return ka(L,y,W),xa(L,x,W),!0}return!1}function bd(y,x,L,W){if(W={lane:2,revertLane:tr(),action:W,hasEagerState:!1,eagerState:null,next:null},qs(y)){if(x)throw Error(g(479))}else x=_t(y,L,W,2),x!==null&&ka(x,y,2)}function qs(y){var x=y.alternate;return y===Pe||x!==null&&x===Pe}function Uc(y,x){Fe=Le=!0;var L=y.pending;L===null?x.next=x:(x.next=L.next,L.next=x),y.pending=x}function xa(y,x,L){if((L&4194048)!==0){var W=x.lanes;W&=y.pendingLanes,L|=W,x.lanes=L,fe(y,L)}}function wd(y){var x=Pt;return Pt+=1,bt===null&&(bt=[]),cl(bt,y,x)}function jc(y,x){x=x.props.ref,y.ref=x!==void 0?x:null}function Sd(y,x){throw x.$$typeof===rm?Error(g(525)):(y=Object.prototype.toString.call(x),Error(g(31,y==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":y)))}function mi(y){var x=y._init;return x(y._payload)}function Mf(y){function x(fn,Xt){if(y){var _n=fn.deletions;_n===null?(fn.deletions=[Xt],fn.flags|=16):_n.push(Xt)}}function L(fn,Xt){if(!y)return null;for(;Xt!==null;)x(fn,Xt),Xt=Xt.sibling;return null}function W(fn){for(var Xt=new Map;fn!==null;)fn.key!==null?Xt.set(fn.key,fn):Xt.set(fn.index,fn),fn=fn.sibling;return Xt}function ie(fn,Xt){return fn=Tc(fn,Xt),fn.index=0,fn.sibling=null,fn}function be(fn,Xt,_n){return fn.index=_n,y?(_n=fn.alternate,_n!==null?(_n=_n.index,_n<Xt?(fn.flags|=67108866,Xt):_n):(fn.flags|=67108866,Xt)):(fn.flags|=1048576,Xt)}function ot(fn){return y&&fn.alternate===null&&(fn.flags|=67108866),fn}function kt(fn,Xt,_n,nr){return Xt===null||Xt.tag!==6?(Xt=ha(_n,fn.mode,nr),Xt.return=fn,Xt):(Xt=ie(Xt,_n),Xt.return=fn,Xt)}function gn(fn,Xt,_n,nr){var $r=_n.type;return $r===Ud?or(fn,Xt,_n.props.children,nr,_n.key):Xt!==null&&(Xt.elementType===$r||typeof $r=="object"&&$r!==null&&$r.$$typeof===Hl&&mi($r)===Xt.type)?(Xt=ie(Xt,_n.props),jc(Xt,_n),Xt.return=fn,Xt):(Xt=jl(_n.type,_n.key,_n.props,null,fn.mode,nr),jc(Xt,_n),Xt.return=fn,Xt)}function Yn(fn,Xt,_n,nr){return Xt===null||Xt.tag!==4||Xt.stateNode.containerInfo!==_n.containerInfo||Xt.stateNode.implementation!==_n.implementation?(Xt=Bd(_n,fn.mode,nr),Xt.return=fn,Xt):(Xt=ie(Xt,_n.children||[]),Xt.return=fn,Xt)}function or(fn,Xt,_n,nr,$r){return Xt===null||Xt.tag!==7?(Xt=Yc(_n,fn.mode,nr,$r),Xt.return=fn,Xt):(Xt=ie(Xt,_n),Xt.return=fn,Xt)}function vr(fn,Xt,_n){if(typeof Xt=="string"&&Xt!==""||typeof Xt=="number"||typeof Xt=="bigint")return Xt=ha(""+Xt,fn.mode,_n),Xt.return=fn,Xt;if(typeof Xt=="object"&&Xt!==null){switch(Xt.$$typeof){case Gl:return _n=jl(Xt.type,Xt.key,Xt.props,null,fn.mode,_n),jc(_n,Xt),_n.return=fn,_n;case Vd:return Xt=Bd(Xt,fn.mode,_n),Xt.return=fn,Xt;case Hl:var nr=Xt._init;return Xt=nr(Xt._payload),vr(fn,Xt,_n)}if(vl(Xt)||I(Xt))return Xt=Yc(Xt,fn.mode,_n,null),Xt.return=fn,Xt;if(typeof Xt.then=="function")return vr(fn,wd(Xt),_n);if(Xt.$$typeof===$l)return vr(fn,dn(fn,Xt),_n);Sd(fn,Xt)}return null}function Er(fn,Xt,_n,nr){var $r=Xt!==null?Xt.key:null;if(typeof _n=="string"&&_n!==""||typeof _n=="number"||typeof _n=="bigint")return $r!==null?null:kt(fn,Xt,""+_n,nr);if(typeof _n=="object"&&_n!==null){switch(_n.$$typeof){case Gl:return _n.key===$r?gn(fn,Xt,_n,nr):null;case Vd:return _n.key===$r?Yn(fn,Xt,_n,nr):null;case Hl:return $r=_n._init,_n=$r(_n._payload),Er(fn,Xt,_n,nr)}if(vl(_n)||I(_n))return $r!==null?null:or(fn,Xt,_n,nr,null);if(typeof _n.then=="function")return Er(fn,Xt,wd(_n),nr);if(_n.$$typeof===$l)return Er(fn,Xt,dn(fn,_n),nr);Sd(fn,_n)}return null}function Ri(fn,Xt,_n,nr,$r){if(typeof nr=="string"&&nr!==""||typeof nr=="number"||typeof nr=="bigint")return fn=fn.get(_n)||null,kt(Xt,fn,""+nr,$r);if(typeof nr=="object"&&nr!==null){switch(nr.$$typeof){case Gl:return fn=fn.get(nr.key===null?_n:nr.key)||null,gn(Xt,fn,nr,$r);case Vd:return fn=fn.get(nr.key===null?_n:nr.key)||null,Yn(Xt,fn,nr,$r);case Hl:var Io=nr._init;return nr=Io(nr._payload),Ri(fn,Xt,_n,nr,$r)}if(vl(nr)||I(nr))return fn=fn.get(_n)||null,or(Xt,fn,nr,$r,null);if(typeof nr.then=="function")return Ri(fn,Xt,_n,wd(nr),$r);if(nr.$$typeof===$l)return Ri(fn,Xt,_n,dn(Xt,nr),$r);Sd(Xt,nr)}return null}function Ja(fn,Xt,_n,nr){for(var $r=null,Io=null,fi=Xt,eo=Xt=0,ws=null;fi!==null&&eo<_n.length;eo++){fi.index>eo?(ws=fi,fi=null):ws=fi.sibling;var so=Er(fn,fi,_n[eo],nr);if(so===null){fi===null&&(fi=ws);break}y&&fi&&so.alternate===null&&x(fn,fi),Xt=be(so,Xt,eo),Io===null?$r=so:Io.sibling=so,Io=so,fi=ws}if(eo===_n.length)return L(fn,fi),Ci&&Ce(fn,eo),$r;if(fi===null){for(;eo<_n.length;eo++)fi=vr(fn,_n[eo],nr),fi!==null&&(Xt=be(fi,Xt,eo),Io===null?$r=fi:Io.sibling=fi,Io=fi);return Ci&&Ce(fn,eo),$r}for(fi=W(fi);eo<_n.length;eo++)ws=Ri(fi,fn,eo,_n[eo],nr),ws!==null&&(y&&ws.alternate!==null&&fi.delete(ws.key===null?eo:ws.key),Xt=be(ws,Xt,eo),Io===null?$r=ws:Io.sibling=ws,Io=ws);return y&&fi.forEach(function(td){return x(fn,td)}),Ci&&Ce(fn,eo),$r}function Qa(fn,Xt,_n,nr){if(_n==null)throw Error(g(151));for(var $r=null,Io=null,fi=Xt,eo=Xt=0,ws=null,so=_n.next();fi!==null&&!so.done;eo++,so=_n.next()){fi.index>eo?(ws=fi,fi=null):ws=fi.sibling;var td=Er(fn,fi,so.value,nr);if(td===null){fi===null&&(fi=ws);break}y&&fi&&td.alternate===null&&x(fn,fi),Xt=be(td,Xt,eo),Io===null?$r=td:Io.sibling=td,Io=td,fi=ws}if(so.done)return L(fn,fi),Ci&&Ce(fn,eo),$r;if(fi===null){for(;!so.done;eo++,so=_n.next())so=vr(fn,so.value,nr),so!==null&&(Xt=be(so,Xt,eo),Io===null?$r=so:Io.sibling=so,Io=so);return Ci&&Ce(fn,eo),$r}for(fi=W(fi);!so.done;eo++,so=_n.next())so=Ri(fi,fn,eo,so.value,nr),so!==null&&(y&&so.alternate!==null&&fi.delete(so.key===null?eo:so.key),Xt=be(so,Xt,eo),Io===null?$r=so:Io.sibling=so,Io=so);return y&&fi.forEach(function(pv){return x(fn,pv)}),Ci&&Ce(fn,eo),$r}function za(fn,Xt,_n,nr){if(typeof _n=="object"&&_n!==null&&_n.type===Ud&&_n.key===null&&(_n=_n.props.children),typeof _n=="object"&&_n!==null){switch(_n.$$typeof){case Gl:e:{for(var $r=_n.key;Xt!==null;){if(Xt.key===$r){if($r=_n.type,$r===Ud){if(Xt.tag===7){L(fn,Xt.sibling),nr=ie(Xt,_n.props.children),nr.return=fn,fn=nr;break e}}else if(Xt.elementType===$r||typeof $r=="object"&&$r!==null&&$r.$$typeof===Hl&&mi($r)===Xt.type){L(fn,Xt.sibling),nr=ie(Xt,_n.props),jc(nr,_n),nr.return=fn,fn=nr;break e}L(fn,Xt);break}else x(fn,Xt);Xt=Xt.sibling}_n.type===Ud?(nr=Yc(_n.props.children,fn.mode,nr,_n.key),nr.return=fn,fn=nr):(nr=jl(_n.type,_n.key,_n.props,null,fn.mode,nr),jc(nr,_n),nr.return=fn,fn=nr)}return ot(fn);case Vd:e:{for($r=_n.key;Xt!==null;){if(Xt.key===$r)if(Xt.tag===4&&Xt.stateNode.containerInfo===_n.containerInfo&&Xt.stateNode.implementation===_n.implementation){L(fn,Xt.sibling),nr=ie(Xt,_n.children||[]),nr.return=fn,fn=nr;break e}else{L(fn,Xt);break}else x(fn,Xt);Xt=Xt.sibling}nr=Bd(_n,fn.mode,nr),nr.return=fn,fn=nr}return ot(fn);case Hl:return $r=_n._init,_n=$r(_n._payload),za(fn,Xt,_n,nr)}if(vl(_n))return Ja(fn,Xt,_n,nr);if(I(_n)){if($r=I(_n),typeof $r!="function")throw Error(g(150));return _n=$r.call(_n),Qa(fn,Xt,_n,nr)}if(typeof _n.then=="function")return za(fn,Xt,wd(_n),nr);if(_n.$$typeof===$l)return za(fn,Xt,dn(fn,_n),nr);Sd(fn,_n)}return typeof _n=="string"&&_n!==""||typeof _n=="number"||typeof _n=="bigint"?(_n=""+_n,Xt!==null&&Xt.tag===6?(L(fn,Xt.sibling),nr=ie(Xt,_n),nr.return=fn,fn=nr):(L(fn,Xt),nr=ha(_n,fn.mode,nr),nr.return=fn,fn=nr),ot(fn)):L(fn,Xt)}return function(fn,Xt,_n,nr){try{Pt=0;var $r=za(fn,Xt,_n,nr);return bt=null,$r}catch(fi){if(fi===d||fi===b)throw fi;var Io=c(29,fi,null,fn.mode);return Io.lanes=nr,Io.return=fn,Io}finally{}}}function _c(y){var x=y.alternate;D(wt,wt.current&1),D(rt,y),zt===null&&(x===null||re.current!==null||x.memoizedState!==null)&&(zt=y)}function Eh(y){if(y.tag===22){if(D(wt,wt.current),D(rt,y),zt===null){var x=y.alternate;x!==null&&x.memoizedState!==null&&(zt=y)}}else Qn()}function Qn(){D(wt,wt.current),D(rt,rt.current)}function hl(y){R(rt),zt===y&&(zt=null),R(wt)}function Ws(y){for(var x=y;x!==null;){if(x.tag===13){var L=x.memoizedState;if(L!==null&&(L=L.dehydrated,L===null||Zu(L)||ap(L)))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===y)break;for(;x.sibling===null;){if(x.return===null||x.return===y)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}function Ma(y,x,L,W){x=y.memoizedState,L=L(W,x),L=L==null?x:Yf({},x,L),y.memoizedState=L,y.lanes===0&&(y.updateQueue.baseState=L)}function Ah(y,x,L,W,ie,be,ot){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(W,be,ot):x.prototype&&x.prototype.isPureReactComponent?!Yr(L,W)||!Yr(ie,be):!0}function fl(y,x,L,W){y=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(L,W),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(L,W),x.state!==y&&Zt.enqueueReplaceState(x,x.state,null)}function jn(y,x){var L=x;if("ref"in x){L={};for(var W in x)W!=="ref"&&(L[W]=x[W])}if(y=y.defaultProps){L===x&&(L=Yf({},L));for(var ie in y)L[ie]===void 0&&(L[ie]=y[ie])}return L}function li(y,x){try{var L=y.onUncaughtError;L(x.value,{componentStack:x.stack})}catch(W){setTimeout(function(){throw W})}}function gi(y,x,L){try{var W=y.onCaughtError;W(L.value,{componentStack:L.stack,errorBoundary:x.tag===1?x.stateNode:null})}catch(ie){setTimeout(function(){throw ie})}}function Zs(y,x,L){return L=et(L),L.tag=3,L.payload={element:null},L.callback=function(){li(y,x)},L}function Gc(y){return y=et(y),y.tag=3,y}function ci(y,x,L,W){var ie=L.type.getDerivedStateFromError;if(typeof ie=="function"){var be=W.value;y.payload=function(){return ie(be)},y.callback=function(){gi(x,L,W)}}var ot=L.stateNode;ot!==null&&typeof ot.componentDidCatch=="function"&&(y.callback=function(){gi(x,L,W),typeof ie!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var kt=W.stack;this.componentDidCatch(W.value,{componentStack:kt!==null?kt:""})})}function If(y,x,L,W,ie){if(L.flags|=32768,W!==null&&typeof W=="object"&&typeof W.then=="function"){if(x=L.alternate,x!==null&&gt(x,L,ie,!0),L=rt.current,L!==null){switch(L.tag){case 13:return zt===null?qc():L.alternate===null&&Xi===0&&(Xi=3),L.flags&=-257,L.flags|=65536,L.lanes=ie,W===T?L.flags|=16384:(x=L.updateQueue,x===null?L.updateQueue=new Set([W]):x.add(W),tm(y,W,ie)),!1;case 22:return L.flags|=65536,W===T?L.flags|=16384:(x=L.updateQueue,x===null?(x={transitions:null,markerInstances:null,retryQueue:new Set([W])},L.updateQueue=x):(L=x.retryQueue,L===null?x.retryQueue=new Set([W]):L.add(W)),tm(y,W,ie)),!1}throw Error(g(435,L.tag))}return tm(y,W,ie),qc(),!1}if(Ci)return x=rt.current,x!==null?((x.flags&65536)===0&&(x.flags|=256),x.flags|=65536,x.lanes=ie,W!==Ka&&(y=Error(g(422),{cause:W}),cn(xe(y,L)))):(W!==Ka&&(x=Error(g(423),{cause:W}),cn(xe(x,L))),y=y.current.alternate,y.flags|=65536,ie&=-ie,y.lanes|=ie,W=xe(W,L),ie=Zs(y.stateNode,W,ie),Rt(y,ie),Xi!==4&&(Xi=2)),!1;var be=Error(g(520),{cause:W});if(be=xe(be,L),ga===null?ga=[be]:ga.push(be),Xi!==4&&(Xi=2),x===null)return!0;W=xe(W,L),L=x;do{switch(L.tag){case 3:return L.flags|=65536,y=ie&-ie,L.lanes|=y,y=Zs(L.stateNode,W,y),Rt(L,y),!1;case 1:if(x=L.type,be=L.stateNode,(L.flags&128)===0&&(typeof x.getDerivedStateFromError=="function"||be!==null&&typeof be.componentDidCatch=="function"&&(Ki===null||!Ki.has(be))))return L.flags|=65536,ie&=-ie,L.lanes|=ie,ie=Gc(ie),ci(ie,y,L,W),Rt(L,ie),!1}L=L.return}while(L!==null);return!1}function Go(y,x,L,W){x.child=y===null?St(x,null,L,W):nn(x,y.child,L,W)}function Td(y,x,L,W,ie){L=L.render;var be=x.ref;if("ref"in W){var ot={};for(var kt in W)kt!=="ref"&&(ot[kt]=W[kt])}else ot=W;return Ft(x),W=Vr(y,x,L,ot,be,ie),kt=bi(),y!==null&&!Ht?(ai(y,x,ie),Ra(y,x,ie)):(Ci&&kt&&Ee(x),x.flags|=1,Go(y,x,W,ie),x.child)}function ys(y,x,L,W,ie){if(y===null){var be=L.type;return typeof be=="function"&&!Nh(be)&&be.defaultProps===void 0&&L.compare===null?(x.tag=15,x.type=be,Lo(y,x,be,W,ie)):(y=jl(L.type,null,W,x,x.mode,ie),y.ref=x.ref,y.return=x,x.child=y)}if(be=y.child,!sr(y,ie)){var ot=be.memoizedProps;if(L=L.compare,L=L!==null?L:Yr,L(ot,W)&&y.ref===x.ref)return Ra(y,x,ie)}return x.flags|=1,y=Tc(be,W),y.ref=x.ref,y.return=x,x.child=y}function Lo(y,x,L,W,ie){if(y!==null){var be=y.memoizedProps;if(Yr(be,W)&&y.ref===x.ref)if(Ht=!1,x.pendingProps=W=be,sr(y,ie))(y.flags&131072)!==0&&(Ht=!0);else return x.lanes=y.lanes,Ra(y,x,ie)}return Pu(y,x,L,W,ie)}function Qm(y,x,L){var W=x.pendingProps,ie=W.children,be=y!==null?y.memoizedState:null;if(W.mode==="hidden"){if((x.flags&128)!==0){if(W=be!==null?be.baseLanes|L:L,y!==null){for(ie=x.child=y.child,be=0;ie!==null;)be=be|ie.lanes|ie.childLanes,ie=ie.sibling;x.childLanes=be&~W}else x.childLanes=0,x.child=null;return Cd(y,x,W,L)}if((L&536870912)!==0)x.memoizedState={baseLanes:0,cachePool:null},y!==null&&Mo(x,be!==null?be.cachePool:null),be!==null?fr(x,be):Nr(),Eh(x);else return x.lanes=x.childLanes=536870912,Cd(y,x,be!==null?be.baseLanes|L:L,L)}else be!==null?(Mo(x,be.cachePool),fr(x,be),Qn(),x.memoizedState=null):(y!==null&&Mo(x,null),Nr(),Qn());return Go(y,x,ie,L),x.child}function Cd(y,x,L,W){var ie=di();return ie=ie===null?null:{parent:Js?Bo._currentValue:Bo._currentValue2,pool:ie},x.memoizedState={baseLanes:L,cachePool:ie},y!==null&&Mo(x,null),Nr(),Eh(x),y!==null&&gt(y,x,W,!0),null}function Ed(y,x){var L=x.ref;if(L===null)y!==null&&y.ref!==null&&(x.flags|=4194816);else{if(typeof L!="function"&&typeof L!="object")throw Error(g(284));(y===null||y.ref!==L)&&(x.flags|=4194816)}}function Pu(y,x,L,W,ie){return Ft(x),L=Vr(y,x,L,W,void 0,ie),W=bi(),y!==null&&!Ht?(ai(y,x,ie),Ra(y,x,ie)):(Ci&&W&&Ee(x),x.flags|=1,Go(y,x,L,ie),x.child)}function Ad(y,x,L,W,ie,be){return Ft(x),x.updateQueue=null,L=ko(x,W,L,ie),fo(y),W=bi(),y!==null&&!Ht?(ai(y,x,be),Ra(y,x,be)):(Ci&&W&&Ee(x),x.flags|=1,Go(y,x,L,be),x.child)}function yc(y,x,L,W,ie){if(Ft(x),x.stateNode===null){var be=au,ot=L.contextType;typeof ot=="object"&&ot!==null&&(be=pt(ot)),be=new L(W,be),x.memoizedState=be.state!==null&&be.state!==void 0?be.state:null,be.updater=Zt,x.stateNode=be,be._reactInternals=x,be=x.stateNode,be.props=W,be.state=x.memoizedState,be.refs={},it(x),ot=L.contextType,be.context=typeof ot=="object"&&ot!==null?pt(ot):au,be.state=x.memoizedState,ot=L.getDerivedStateFromProps,typeof ot=="function"&&(Ma(x,L,ot,W),be.state=x.memoizedState),typeof L.getDerivedStateFromProps=="function"||typeof be.getSnapshotBeforeUpdate=="function"||typeof be.UNSAFE_componentWillMount!="function"&&typeof be.componentWillMount!="function"||(ot=be.state,typeof be.componentWillMount=="function"&&be.componentWillMount(),typeof be.UNSAFE_componentWillMount=="function"&&be.UNSAFE_componentWillMount(),ot!==be.state&&Zt.enqueueReplaceState(be,be.state,null),Wt(x,W,be,ie),un(),be.state=x.memoizedState),typeof be.componentDidMount=="function"&&(x.flags|=4194308),W=!0}else if(y===null){be=x.stateNode;var kt=x.memoizedProps,gn=jn(L,kt);be.props=gn;var Yn=be.context,or=L.contextType;ot=au,typeof or=="object"&&or!==null&&(ot=pt(or));var vr=L.getDerivedStateFromProps;or=typeof vr=="function"||typeof be.getSnapshotBeforeUpdate=="function",kt=x.pendingProps!==kt,or||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(kt||Yn!==ot)&&fl(x,be,W,ot),te=!1;var Er=x.memoizedState;be.state=Er,Wt(x,W,be,ie),un(),Yn=x.memoizedState,kt||Er!==Yn||te?(typeof vr=="function"&&(Ma(x,L,vr,W),Yn=x.memoizedState),(gn=te||Ah(x,L,gn,W,Er,Yn,ot))?(or||typeof be.UNSAFE_componentWillMount!="function"&&typeof be.componentWillMount!="function"||(typeof be.componentWillMount=="function"&&be.componentWillMount(),typeof be.UNSAFE_componentWillMount=="function"&&be.UNSAFE_componentWillMount()),typeof be.componentDidMount=="function"&&(x.flags|=4194308)):(typeof be.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=W,x.memoizedState=Yn),be.props=W,be.state=Yn,be.context=ot,W=gn):(typeof be.componentDidMount=="function"&&(x.flags|=4194308),W=!1)}else{be=x.stateNode,tt(y,x),ot=x.memoizedProps,or=jn(L,ot),be.props=or,vr=x.pendingProps,Er=be.context,Yn=L.contextType,gn=au,typeof Yn=="object"&&Yn!==null&&(gn=pt(Yn)),kt=L.getDerivedStateFromProps,(Yn=typeof kt=="function"||typeof be.getSnapshotBeforeUpdate=="function")||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(ot!==vr||Er!==gn)&&fl(x,be,W,gn),te=!1,Er=x.memoizedState,be.state=Er,Wt(x,W,be,ie),un();var Ri=x.memoizedState;ot!==vr||Er!==Ri||te||y!==null&&y.dependencies!==null&&Ot(y.dependencies)?(typeof kt=="function"&&(Ma(x,L,kt,W),Ri=x.memoizedState),(or=te||Ah(x,L,or,W,Er,Ri,gn)||y!==null&&y.dependencies!==null&&Ot(y.dependencies))?(Yn||typeof be.UNSAFE_componentWillUpdate!="function"&&typeof be.componentWillUpdate!="function"||(typeof be.componentWillUpdate=="function"&&be.componentWillUpdate(W,Ri,gn),typeof be.UNSAFE_componentWillUpdate=="function"&&be.UNSAFE_componentWillUpdate(W,Ri,gn)),typeof be.componentDidUpdate=="function"&&(x.flags|=4),typeof be.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof be.componentDidUpdate!="function"||ot===y.memoizedProps&&Er===y.memoizedState||(x.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||ot===y.memoizedProps&&Er===y.memoizedState||(x.flags|=1024),x.memoizedProps=W,x.memoizedState=Ri),be.props=W,be.state=Ri,be.context=gn,W=or):(typeof be.componentDidUpdate!="function"||ot===y.memoizedProps&&Er===y.memoizedState||(x.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||ot===y.memoizedProps&&Er===y.memoizedState||(x.flags|=1024),W=!1)}return be=W,Ed(y,x),W=(x.flags&128)!==0,be||W?(be=x.stateNode,L=W&&typeof L.getDerivedStateFromError!="function"?null:be.render(),x.flags|=1,y!==null&&W?(x.child=nn(x,y.child,null,ie),x.child=nn(x,null,L,ie)):Go(y,x,L,ie),x.memoizedState=be.state,y=x.child):y=Ra(y,x,ie),y}function Ph(y,x,L,W){return It(),x.flags|=256,Go(y,x,L,W),x.child}function vs(y){return{baseLanes:y,cachePool:ds()}}function Ia(y,x,L){return y=y!==null?y.childLanes&~L:0,x&&(y|=Co),y}function Ys(y,x,L){var W=x.pendingProps,ie=!1,be=(x.flags&128)!==0,ot;if((ot=be)||(ot=y!==null&&y.memoizedState===null?!1:(wt.current&2)!==0),ot&&(ie=!0,x.flags&=-129),ot=(x.flags&32)!==0,x.flags&=-33,y===null){if(Ci){if(ie?_c(x):Qn(),Ci){var kt=Wo,gn;(gn=kt)&&(kt=gm(kt,Bi),kt!==null?(x.memoizedState={dehydrated:kt,treeContext:Pi!==null?{id:Oa,overflow:Mc}:null,retryLane:536870912,hydrationErrors:null},gn=c(18,null,null,0),gn.stateNode=kt,gn.return=x,x.child=gn,zs=x,Wo=null,gn=!0):gn=!1),gn||$e(x)}if(kt=x.memoizedState,kt!==null&&(kt=kt.dehydrated,kt!==null))return ap(kt)?x.lanes=32:x.lanes=536870912,null;hl(x)}return kt=W.children,W=W.fallback,ie?(Qn(),ie=x.mode,kt=vc({mode:"hidden",children:kt},ie),W=Yc(W,ie,L,null),kt.return=x,W.return=x,kt.sibling=W,x.child=kt,ie=x.child,ie.memoizedState=vs(L),ie.childLanes=Ia(y,ot,L),x.memoizedState=en,W):(_c(x),Rf(x,kt))}if(gn=y.memoizedState,gn!==null&&(kt=gn.dehydrated,kt!==null)){if(be)x.flags&256?(_c(x),x.flags&=-257,x=$o(y,x,L)):x.memoizedState!==null?(Qn(),x.child=y.child,x.flags|=128,x=null):(Qn(),ie=W.fallback,kt=x.mode,W=vc({mode:"visible",children:W.children},kt),ie=Yc(ie,kt,L,null),ie.flags|=2,W.return=x,ie.return=x,W.sibling=ie,x.child=W,nn(x,y.child,null,L),W=x.child,W.memoizedState=vs(L),W.childLanes=Ia(y,ot,L),x.memoizedState=en,x=ie);else if(_c(x),ap(kt))ot=wl(kt).digest,W=Error(g(419)),W.stack="",W.digest=ot,cn({value:W,source:null,stack:null}),x=$o(y,x,L);else if(Ht||gt(y,x,L,!1),ot=(L&y.childLanes)!==0,Ht||ot){if(ot=hi,ot!==null&&(W=L&-L,W=(W&42)!==0?1:pe(W),W=(W&(ot.suspendedLanes|L))!==0?0:W,W!==0&&W!==gn.retryLane))throw gn.retryLane=W,we(y,W),ka(ot,y,W),Sn;Zu(kt)||qc(),x=$o(y,x,L)}else Zu(kt)?(x.flags|=192,x.child=y.child,x=null):(y=gn.treeContext,pa&&(Wo=mg(kt),zs=x,Ci=!0,Tl=null,Bi=!1,y!==null&&(Za[Ya++]=Oa,Za[Ya++]=Mc,Za[Ya++]=Pi,Oa=y.id,Mc=y.overflow,Pi=x)),x=Rf(x,W.children),x.flags|=4096);return x}return ie?(Qn(),ie=W.fallback,kt=x.mode,gn=y.child,be=gn.sibling,W=Tc(gn,{mode:"hidden",children:W.children}),W.subtreeFlags=gn.subtreeFlags&65011712,be!==null?ie=Tc(be,ie):(ie=Yc(ie,kt,L,null),ie.flags|=2),ie.return=x,W.return=x,W.sibling=ie,x.child=W,W=ie,ie=x.child,kt=y.child.memoizedState,kt===null?kt=vs(L):(gn=kt.cachePool,gn!==null?(be=Js?Bo._currentValue:Bo._currentValue2,gn=gn.parent!==be?{parent:be,pool:be}:gn):gn=ds(),kt={baseLanes:kt.baseLanes|L,cachePool:gn}),ie.memoizedState=kt,ie.childLanes=Ia(y,ot,L),x.memoizedState=en,W):(_c(x),L=y.child,y=L.sibling,L=Tc(L,{mode:"visible",children:W.children}),L.return=x,L.sibling=null,y!==null&&(ot=x.deletions,ot===null?(x.deletions=[y],x.flags|=16):ot.push(y)),x.child=L,x.memoizedState=null,L)}function Rf(y,x){return x=vc({mode:"visible",children:x},y.mode),x.return=y,y.child=x}function vc(y,x){return y=c(22,y,null,x),y.lanes=0,y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},y}function $o(y,x,L){return nn(x,y.child,null,L),y=Rf(x,x.pendingProps.children),y.flags|=2,x.memoizedState=null,y}function Xs(y,x,L){y.lanes|=x;var W=y.alternate;W!==null&&(W.lanes|=x),Ue(y.return,x,L)}function br(y,x,L,W,ie){var be=y.memoizedState;be===null?y.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:W,tail:L,tailMode:ie}:(be.isBackwards=x,be.rendering=null,be.renderingStartTime=0,be.last=W,be.tail=L,be.tailMode=ie)}function Pn(y,x,L){var W=x.pendingProps,ie=W.revealOrder,be=W.tail;if(Go(y,x,W.children,L),W=wt.current,(W&2)!==0)W=W&1|2,x.flags|=128;else{if(y!==null&&(y.flags&128)!==0)e:for(y=x.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&Xs(y,L,x);else if(y.tag===19)Xs(y,L,x);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===x)break e;for(;y.sibling===null;){if(y.return===null||y.return===x)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}W&=1}switch(D(wt,W),ie){case"forwards":for(L=x.child,ie=null;L!==null;)y=L.alternate,y!==null&&Ws(y)===null&&(ie=L),L=L.sibling;L=ie,L===null?(ie=x.child,x.child=null):(ie=L.sibling,L.sibling=null),br(x,!1,ie,L,be);break;case"backwards":for(L=null,ie=x.child,x.child=null;ie!==null;){if(y=ie.alternate,y!==null&&Ws(y)===null){x.child=ie;break}y=ie.sibling,ie.sibling=L,L=ie,ie=y}br(x,!0,L,null,be);break;case"together":br(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function Ra(y,x,L){if(y!==null&&(x.dependencies=y.dependencies),ss|=x.lanes,(L&x.childLanes)===0)if(y!==null){if(gt(y,x,L,!1),(L&x.childLanes)===0)return null}else return null;if(y!==null&&x.child!==y.child)throw Error(g(153));if(x.child!==null){for(y=x.child,L=Tc(y,y.pendingProps),x.child=L,L.return=x;y.sibling!==null;)y=y.sibling,L=L.sibling=Tc(y,y.pendingProps),L.return=x;L.sibling=null}return x.child}function sr(y,x){return(y.lanes&x)!==0?!0:(y=y.dependencies,!!(y!==null&&Ot(y)))}function Mu(y,x,L){switch(x.tag){case 3:Be(x,x.stateNode.containerInfo),mt(x,Bo,y.memoizedState.cache),It();break;case 27:case 5:ut(x);break;case 4:Be(x,x.stateNode.containerInfo);break;case 10:mt(x,x.type,x.memoizedProps.value);break;case 13:var W=x.memoizedState;if(W!==null)return W.dehydrated!==null?(_c(x),x.flags|=128,null):(L&x.child.childLanes)!==0?Ys(y,x,L):(_c(x),y=Ra(y,x,L),y!==null?y.sibling:null);_c(x);break;case 19:var ie=(y.flags&128)!==0;if(W=(L&x.childLanes)!==0,W||(gt(y,x,L,!1),W=(L&x.childLanes)!==0),ie){if(W)return Pn(y,x,L);x.flags|=128}if(ie=x.memoizedState,ie!==null&&(ie.rendering=null,ie.tail=null,ie.lastEffect=null),D(wt,wt.current),W)break;return null;case 22:case 23:return x.lanes=0,Qm(y,x,L);case 24:mt(x,Bo,y.memoizedState.cache)}return Ra(y,x,L)}function Iu(y,x,L){if(y!==null)if(y.memoizedProps!==x.pendingProps)Ht=!0;else{if(!sr(y,L)&&(x.flags&128)===0)return Ht=!1,Mu(y,x,L);Ht=(y.flags&131072)!==0}else Ht=!1,Ci&&(x.flags&1048576)!==0&&Re(x,bp,x.index);switch(x.lanes=0,x.tag){case 16:e:{y=x.pendingProps;var W=x.elementType,ie=W._init;if(W=ie(W._payload),x.type=W,typeof W=="function")Nh(W)?(y=jn(W,y),x.tag=1,x=yc(null,x,W,y,L)):(x.tag=0,x=Pu(null,x,W,y,L));else{if(W!=null){if(ie=W.$$typeof,ie===$h){x.tag=11,x=Td(null,x,W,y,L);break e}else if(ie===Xf){x.tag=14,x=ys(null,x,W,y,L);break e}}throw x=F(W)||W,Error(g(306,x,""))}}return x;case 0:return Pu(y,x,x.type,x.pendingProps,L);case 1:return W=x.type,ie=jn(W,x.pendingProps),yc(y,x,W,ie,L);case 3:e:{if(Be(x,x.stateNode.containerInfo),y===null)throw Error(g(387));var be=x.pendingProps;ie=x.memoizedState,W=ie.element,tt(y,x),Wt(x,be,null,L);var ot=x.memoizedState;if(be=ot.cache,mt(x,Bo,be),be!==ie.cache&&je(x,[Bo],L,!0),un(),be=ot.element,pa&&ie.isDehydrated)if(ie={element:be,isDehydrated:!1,cache:ot.cache},x.updateQueue.baseState=ie,x.memoizedState=ie,x.flags&256){x=Ph(y,x,be,L);break e}else if(be!==W){W=xe(Error(g(424)),x),cn(W),x=Ph(y,x,be,L);break e}else for(pa&&(Wo=pg(x.stateNode.containerInfo),zs=x,Ci=!0,Tl=null,Bi=!0),L=St(x,null,be,L),x.child=L;L;)L.flags=L.flags&-3|4096,L=L.sibling;else{if(It(),be===W){x=Ra(y,x,L);break e}Go(y,x,be,L)}x=x.child}return x;case 26:if(ks)return Ed(y,x),y===null?(L=up(x.type,null,x.pendingProps,null))?x.memoizedState=L:Ci||(x.stateNode=Yd(x.type,x.pendingProps,Xa.current,x)):x.memoizedState=up(x.type,y.memoizedProps,x.pendingProps,y.memoizedState),null;case 27:if(Ho)return ut(x),y===null&&Ho&&Ci&&(W=x.stateNode=zo(x.type,x.pendingProps,Xa.current,Ls.current,!1),zs=x,Bi=!0,Wo=cp(x.type,W,Wo)),Go(y,x,x.pendingProps.children,L),Ed(y,x),y===null&&(x.flags|=4194304),x.child;case 5:return y===null&&Ci&&(vg(x.type,x.pendingProps,Ls.current),(ie=W=Wo)&&(W=Kh(W,x.type,x.pendingProps,Bi),W!==null?(x.stateNode=W,zs=x,Wo=mm(W),Bi=!1,ie=!0):ie=!1),ie||$e(x)),ut(x),ie=x.type,be=x.pendingProps,ot=y!==null?y.memoizedProps:null,W=be.children,np(ie,be)?W=null:ot!==null&&np(ie,ot)&&(x.flags|=32),x.memoizedState!==null&&(ie=Vr(y,x,jo,null,null,L),Js?Zl._currentValue=ie:Zl._currentValue2=ie),Ed(y,x),Go(y,x,W,L),x.child;case 6:return y===null&&Ci&&(iu(x.pendingProps,Ls.current),(y=L=Wo)&&(L=Wd(L,x.pendingProps,Bi),L!==null?(x.stateNode=L,zs=x,Wo=null,y=!0):y=!1),y||$e(x)),null;case 13:return Ys(y,x,L);case 4:return Be(x,x.stateNode.containerInfo),W=x.pendingProps,y===null?x.child=nn(x,null,W,L):Go(y,x,W,L),x.child;case 11:return Td(y,x,x.type,x.pendingProps,L);case 7:return Go(y,x,x.pendingProps,L),x.child;case 8:return Go(y,x,x.pendingProps.children,L),x.child;case 12:return Go(y,x,x.pendingProps.children,L),x.child;case 10:return W=x.pendingProps,mt(x,x.type,W.value),Go(y,x,W.children,L),x.child;case 9:return ie=x.type._context,W=x.pendingProps.children,Ft(x),ie=pt(ie),W=W(ie),x.flags|=1,Go(y,x,W,L),x.child;case 14:return ys(y,x,x.type,x.pendingProps,L);case 15:return Lo(y,x,x.type,x.pendingProps,L);case 19:return Pn(y,x,L);case 31:return W=x.pendingProps,L=x.mode,W={mode:W.mode,children:W.children},y===null?(L=vc(W,L),L.ref=x.ref,x.child=L,L.return=x,x=L):(L=Tc(y.child,W),L.ref=x.ref,x.child=L,L.return=x,x=L),x;case 22:return Qm(y,x,L);case 24:return Ft(x),W=pt(Bo),y===null?(ie=di(),ie===null&&(ie=hi,be=Gt(),ie.pooledCache=be,be.refCount++,be!==null&&(ie.pooledCacheLanes|=L),ie=be),x.memoizedState={parent:W,cache:ie},it(x),mt(x,Bo,ie)):((y.lanes&L)!==0&&(tt(y,x),Wt(x,null,null,L),un()),ie=y.memoizedState,be=x.memoizedState,ie.parent!==W?(ie={parent:W,cache:W},x.memoizedState=ie,x.lanes===0&&(x.memoizedState=x.updateQueue.baseState=ie),mt(x,Bo,W)):(W=be.cache,mt(x,Bo,W),W!==ie.cache&&je(x,[Bo],L,!0))),Go(y,x,x.pendingProps.children,L),x.child;case 29:throw x.pendingProps}throw Error(g(156,x.tag))}function er(y){y.flags|=4}function Df(y,x){if(y!==null&&y.child===x.child)return!1;if((x.flags&16)!==0)return!0;for(y=x.child;y!==null;){if((y.flags&13878)!==0||(y.subtreeFlags&13878)!==0)return!0;y=y.sibling}return!1}function Ru(y,x,L,W){if(xs)for(L=x.child;L!==null;){if(L.tag===5||L.tag===6)ql(y,L.stateNode);else if(!(L.tag===4||Ho&&L.tag===27)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===x)break;for(;L.sibling===null;){if(L.return===null||L.return===x)return;L=L.return}L.sibling.return=L.return,L=L.sibling}else if(bl)for(var ie=x.child;ie!==null;){if(ie.tag===5){var be=ie.stateNode;L&&W&&(be=nu(be,ie.type,ie.memoizedProps)),ql(y,be)}else if(ie.tag===6)be=ie.stateNode,L&&W&&(be=Xh(be,ie.memoizedProps)),ql(y,be);else if(ie.tag!==4){if(ie.tag===22&&ie.memoizedState!==null)be=ie.child,be!==null&&(be.return=ie),Ru(y,ie,!0,!0);else if(ie.child!==null){ie.child.return=ie,ie=ie.child;continue}}if(ie===x)break;for(;ie.sibling===null;){if(ie.return===null||ie.return===x)return;ie=ie.return}ie.sibling.return=ie.return,ie=ie.sibling}}function Pd(y,x,L,W){var ie=!1;if(bl)for(var be=x.child;be!==null;){if(be.tag===5){var ot=be.stateNode;L&&W&&(ot=nu(ot,be.type,be.memoizedProps)),oo(y,ot)}else if(be.tag===6)ot=be.stateNode,L&&W&&(ot=Xh(ot,be.memoizedProps)),oo(y,ot);else if(be.tag!==4){if(be.tag===22&&be.memoizedState!==null)ie=be.child,ie!==null&&(ie.return=be),Pd(y,be,!0,!0),ie=!0;else if(be.child!==null){be.child.return=be,be=be.child;continue}}if(be===x)break;for(;be.sibling===null;){if(be.return===null||be.return===x)return ie;be=be.return}be.sibling.return=be.return,be=be.sibling}return ie}function kf(y,x){if(bl&&Df(y,x)){y=x.stateNode;var L=y.containerInfo,W=Wu();Pd(W,x,!1,!1),y.pendingChildren=W,er(x),yt(L,W)}}function Md(y,x,L,W){if(xs)y.memoizedProps!==W&&er(x);else if(bl){var ie=y.stateNode,be=y.memoizedProps;if((y=Df(y,x))||be!==W){var ot=Ls.current;be=wn(ie,L,be,W,!y,null),be===ie?x.stateNode=ie:(sm(be,L,W,ot)&&er(x),x.stateNode=be,y?Ru(be,x,!1,!1):er(x))}else x.stateNode=ie}}function vo(y,x,L){if(Cc(x,L)){if(y.flags|=16777216,!Ec(x,L))if(zh())y.flags|=8192;else throw P=T,_}else y.flags&=-16777217}function Of(y,x){if(_m(x)){if(y.flags|=16777216,!pp(x))if(zh())y.flags|=8192;else throw P=T,_}else y.flags&=-16777217}function $a(y,x){x!==null&&(y.flags|=4),y.flags&16384&&(x=y.tag!==22?X():536870912,y.lanes|=x,Bs|=x)}function is(y,x){if(!Ci)switch(y.tailMode){case"hidden":x=y.tail;for(var L=null;x!==null;)x.alternate!==null&&(L=x),x=x.sibling;L===null?y.tail=null:L.sibling=null;break;case"collapsed":L=y.tail;for(var W=null;L!==null;)L.alternate!==null&&(W=L),L=L.sibling;W===null?x||y.tail===null?y.tail=null:y.tail.sibling=null:W.sibling=null}}function po(y){var x=y.alternate!==null&&y.alternate.child===y.child,L=0,W=0;if(x)for(var ie=y.child;ie!==null;)L|=ie.lanes|ie.childLanes,W|=ie.subtreeFlags&65011712,W|=ie.flags&65011712,ie.return=y,ie=ie.sibling;else for(ie=y.child;ie!==null;)L|=ie.lanes|ie.childLanes,W|=ie.subtreeFlags,W|=ie.flags,ie.return=y,ie=ie.sibling;return y.subtreeFlags|=W,y.childLanes=L,x}function hs(y,x,L){var W=x.pendingProps;switch(Oe(x),x.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return po(x),null;case 1:return po(x),null;case 3:return L=x.stateNode,W=null,y!==null&&(W=y.memoizedState.cache),x.memoizedState.cache!==W&&(x.flags|=2048),Ke(Bo),at(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(y===null||y.child===null)&&(xt(x)?er(x):y===null||y.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,jt())),kf(y,x),po(x),null;case 26:if(ks){L=x.type;var ie=x.memoizedState;return y===null?(er(x),ie!==null?(po(x),Of(x,ie)):(po(x),vo(x,L,W))):ie?ie!==y.memoizedState?(er(x),po(x),Of(x,ie)):(po(x),x.flags&=-16777217):(xs?y.memoizedProps!==W&&er(x):Md(y,x,L,W),po(x),vo(x,L,W)),null}case 27:if(Ho){if(nt(x),L=Xa.current,ie=x.type,y!==null&&x.stateNode!=null)xs?y.memoizedProps!==W&&er(x):Md(y,x,ie,W);else{if(!W){if(x.stateNode===null)throw Error(g(166));return po(x),null}y=Ls.current,xt(x)?ct(x,y):(y=zo(ie,W,L,y,!0),x.stateNode=y,er(x))}return po(x),null}case 5:if(nt(x),L=x.type,y!==null&&x.stateNode!=null)Md(y,x,L,W);else{if(!W){if(x.stateNode===null)throw Error(g(166));return po(x),null}y=Ls.current,xt(x)?ct(x,y):(ie=T_(L,W,Xa.current,y,x),Ru(ie,x,!1,!1),x.stateNode=ie,sm(ie,L,W,y)&&er(x))}return po(x),vo(x,x.type,x.pendingProps),null;case 6:if(y&&x.stateNode!=null)L=y.memoizedProps,xs?L!==W&&er(x):bl&&(L!==W?(x.stateNode=Wh(W,Xa.current,Ls.current,x),er(x)):x.stateNode=y.stateNode);else{if(typeof W!="string"&&x.stateNode===null)throw Error(g(166));if(y=Xa.current,L=Ls.current,xt(x)){if(!pa)throw Error(g(176));if(y=x.stateNode,L=x.memoizedProps,W=null,ie=zs,ie!==null)switch(ie.tag){case 27:case 5:W=ie.memoizedProps}M_(y,L,x,W)||$e(x)}else x.stateNode=Wh(W,y,L,x)}return po(x),null;case 13:if(W=x.memoizedState,y===null||y.memoizedState!==null&&y.memoizedState.dehydrated!==null){if(ie=xt(x),W!==null&&W.dehydrated!==null){if(y===null){if(!ie)throw Error(g(318));if(!pa)throw Error(g(344));if(ie=x.memoizedState,ie=ie!==null?ie.dehydrated:null,!ie)throw Error(g(317));_g(ie,x)}else It(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;po(x),ie=!1}else ie=jt(),y!==null&&y.memoizedState!==null&&(y.memoizedState.hydrationErrors=ie),ie=!0;if(!ie)return x.flags&256?(hl(x),x):(hl(x),null)}if(hl(x),(x.flags&128)!==0)return x.lanes=L,x;if(L=W!==null,y=y!==null&&y.memoizedState!==null,L){W=x.child,ie=null,W.alternate!==null&&W.alternate.memoizedState!==null&&W.alternate.memoizedState.cachePool!==null&&(ie=W.alternate.memoizedState.cachePool.pool);var be=null;W.memoizedState!==null&&W.memoizedState.cachePool!==null&&(be=W.memoizedState.cachePool.pool),be!==ie&&(W.flags|=2048)}return L!==y&&L&&(x.child.flags|=8192),$a(x,x.updateQueue),po(x),null;case 4:return at(),kf(y,x),y===null&&rp(x.stateNode.containerInfo),po(x),null;case 10:return Ke(x.type),po(x),null;case 19:if(R(wt),ie=x.memoizedState,ie===null)return po(x),null;if(W=(x.flags&128)!==0,be=ie.rendering,be===null)if(W)is(ie,!1);else{if(Xi!==0||y!==null&&(y.flags&128)!==0)for(y=x.child;y!==null;){if(be=Ws(y),be!==null){for(x.flags|=128,is(ie,!1),y=be.updateQueue,x.updateQueue=y,$a(x,y),x.subtreeFlags=0,y=L,L=x.child;L!==null;)Zc(L,y),L=L.sibling;return D(wt,wt.current&1|2),x.child}y=y.sibling}ie.tail!==null&&ta()>wo&&(x.flags|=128,W=!0,is(ie,!1),x.lanes=4194304)}else{if(!W)if(y=Ws(be),y!==null){if(x.flags|=128,W=!0,y=y.updateQueue,x.updateQueue=y,$a(x,y),is(ie,!0),ie.tail===null&&ie.tailMode==="hidden"&&!be.alternate&&!Ci)return po(x),null}else 2*ta()-ie.renderingStartTime>wo&&L!==536870912&&(x.flags|=128,W=!0,is(ie,!1),x.lanes=4194304);ie.isBackwards?(be.sibling=x.child,x.child=be):(y=ie.last,y!==null?y.sibling=be:x.child=be,ie.last=be)}return ie.tail!==null?(x=ie.tail,ie.rendering=x,ie.tail=x.sibling,ie.renderingStartTime=ta(),x.sibling=null,y=wt.current,D(wt,W?y&1|2:y&1),x):(po(x),null);case 22:case 23:return hl(x),Ir(),W=x.memoizedState!==null,y!==null?y.memoizedState!==null!==W&&(x.flags|=8192):W&&(x.flags|=8192),W?(L&536870912)!==0&&(x.flags&128)===0&&(po(x),x.subtreeFlags&6&&(x.flags|=8192)):po(x),L=x.updateQueue,L!==null&&$a(x,L.retryQueue),L=null,y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(L=y.memoizedState.cachePool.pool),W=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(W=x.memoizedState.cachePool.pool),W!==L&&(x.flags|=2048),y!==null&&R(n),null;case 24:return L=null,y!==null&&(L=y.memoizedState.cache),x.memoizedState.cache!==L&&(x.flags|=2048),Ke(Bo),po(x),null;case 25:return null;case 30:return null}throw Error(g(156,x.tag))}function eg(y,x){switch(Oe(x),x.tag){case 1:return y=x.flags,y&65536?(x.flags=y&-65537|128,x):null;case 3:return Ke(Bo),at(),y=x.flags,(y&65536)!==0&&(y&128)===0?(x.flags=y&-65537|128,x):null;case 26:case 27:case 5:return nt(x),null;case 13:if(hl(x),y=x.memoizedState,y!==null&&y.dehydrated!==null){if(x.alternate===null)throw Error(g(340));It()}return y=x.flags,y&65536?(x.flags=y&-65537|128,x):null;case 19:return R(wt),null;case 4:return at(),null;case 10:return Ke(x.type),null;case 22:case 23:return hl(x),Ir(),y!==null&&R(n),y=x.flags,y&65536?(x.flags=y&-65537|128,x):null;case 24:return Ke(Bo),null;case 25:return null;default:return null}}function Id(y,x){switch(Oe(x),x.tag){case 3:Ke(Bo),at();break;case 26:case 27:case 5:nt(x);break;case 4:at();break;case 13:hl(x);break;case 19:R(wt);break;case 10:Ke(x.type);break;case 22:case 23:hl(x),Ir(),y!==null&&R(n);break;case 24:Ke(Bo)}}function Mh(y,x){try{var L=x.updateQueue,W=L!==null?L.lastEffect:null;if(W!==null){var ie=W.next;L=ie;do{if((L.tag&y)===y){W=void 0;var be=L.create,ot=L.inst;W=be(),ot.destroy=W}L=L.next}while(L!==ie)}}catch(kt){mo(x,x.return,kt)}}function pl(y,x,L){try{var W=x.updateQueue,ie=W!==null?W.lastEffect:null;if(ie!==null){var be=ie.next;W=be;do{if((W.tag&y)===y){var ot=W.inst,kt=ot.destroy;if(kt!==void 0){ot.destroy=void 0,ie=x;var gn=L,Yn=kt;try{Yn()}catch(or){mo(ie,gn,or)}}}W=W.next}while(W!==be)}}catch(or){mo(x,x.return,or)}}function Du(y){var x=y.updateQueue;if(x!==null){var L=y.stateNode;try{lr(x,L)}catch(W){mo(y,y.return,W)}}}function Ha(y,x,L){L.props=jn(y.type,y.memoizedProps),L.state=y.memoizedState;try{L.componentWillUnmount()}catch(W){mo(y,x,W)}}function Ih(y,x){try{var L=y.ref;if(L!==null){switch(y.tag){case 26:case 27:case 5:var W=Qc(y.stateNode);break;case 30:W=y.stateNode;break;default:W=y.stateNode}typeof L=="function"?y.refCleanup=L(W):L.current=W}}catch(ie){mo(y,x,ie)}}function ua(y,x){var L=y.ref,W=y.refCleanup;if(L!==null)if(typeof W=="function")try{W()}catch(ie){mo(y,x,ie)}finally{y.refCleanup=null,y=y.alternate,y!=null&&(y.refCleanup=null)}else if(typeof L=="function")try{L(null)}catch(ie){mo(y,x,ie)}else L.current=null}function qp(y){var x=y.type,L=y.memoizedProps,W=y.stateNode;try{ju(W,x,L,y)}catch(ie){mo(y,y.return,ie)}}function Rd(y,x,L){try{Yl(y.stateNode,y.type,L,x,y)}catch(W){mo(y,y.return,W)}}function Rh(y){return y.tag===5||y.tag===3||(ks?y.tag===26:!1)||(Ho?y.tag===27&&su(y.type):!1)||y.tag===4}function Nl(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||Rh(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(Ho&&y.tag===27&&su(y.type)||y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function xc(y,x,L){var W=y.tag;if(W===5||W===6)y=y.stateNode,x?Gu(L,y,x):dm(L,y);else if(W!==4&&(Ho&&W===27&&su(y.type)&&(L=y.stateNode,x=null),y=y.child,y!==null))for(xc(y,x,L),y=y.sibling;y!==null;)xc(y,x,L),y=y.sibling}function Lf(y,x,L){var W=y.tag;if(W===5||W===6)y=y.stateNode,x?ki(L,y,x):um(L,y);else if(W!==4&&(Ho&&W===27&&su(y.type)&&(L=y.stateNode),y=y.child,y!==null))for(Lf(y,x,L),y=y.sibling;y!==null;)Lf(y,x,L),y=y.sibling}function tg(y,x,L){y=y.containerInfo;try{Yh(y,L)}catch(W){mo(x,x.return,W)}}function Dh(y){var x=y.stateNode,L=y.memoizedProps;try{Xd(y.type,L,x,y)}catch(W){mo(y,y.return,W)}}function ng(y,x){for(tp(y.containerInfo),Kn=x;Kn!==null;)if(y=Kn,x=y.child,(y.subtreeFlags&1024)!==0&&x!==null)x.return=y,Kn=x;else for(;Kn!==null;){y=Kn;var L=y.alternate;switch(x=y.flags,y.tag){case 0:break;case 11:case 15:break;case 1:if((x&1024)!==0&&L!==null){x=void 0;var W=y,ie=L.memoizedProps;L=L.memoizedState;var be=W.stateNode;try{var ot=jn(W.type,ie,W.elementType===W.type);x=be.getSnapshotBeforeUpdate(ot,L),be.__reactInternalSnapshotBeforeUpdate=x}catch(kt){mo(W,W.return,kt)}}break;case 3:(x&1024)!==0&&xs&&ln(y.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((x&1024)!==0)throw Error(g(163))}if(x=y.sibling,x!==null){x.return=y.return,Kn=x;break}Kn=y.return}}function kh(y,x,L){var W=L.flags;switch(L.tag){case 0:case 11:case 15:Vl(y,L),W&4&&Mh(5,L);break;case 1:if(Vl(y,L),W&4)if(y=L.stateNode,x===null)try{y.componentDidMount()}catch(ot){mo(L,L.return,ot)}else{var ie=jn(L.type,x.memoizedProps);x=x.memoizedState;try{y.componentDidUpdate(ie,x,y.__reactInternalSnapshotBeforeUpdate)}catch(ot){mo(L,L.return,ot)}}W&64&&Du(L),W&512&&Ih(L,L.return);break;case 3:if(Vl(y,L),W&64&&(y=L.updateQueue,y!==null)){if(x=null,L.child!==null)switch(L.child.tag){case 27:case 5:x=Qc(L.child.stateNode);break;case 1:x=L.child.stateNode}try{lr(y,x)}catch(ot){mo(L,L.return,ot)}}break;case 27:Ho&&x===null&&W&4&&Dh(L);case 26:case 5:Vl(y,L),x===null&&W&4&&qp(L),W&512&&Ih(L,L.return);break;case 12:Vl(y,L);break;case 13:Vl(y,L),W&4&&Wp(y,L),W&64&&(y=L.memoizedState,y!==null&&(y=y.dehydrated,y!==null&&(L=Hf.bind(null,L),qd(y,L))));break;case 22:if(W=L.memoizedState!==null||Nn,!W){x=x!==null&&x.memoizedState!==null||En,ie=Nn;var be=En;Nn=W,(En=x)&&!be?os(y,L,(L.subtreeFlags&8772)!==0):Vl(y,L),Nn=ie,En=be}break;case 30:break;default:Vl(y,L)}}function Da(y){var x=y.alternate;x!==null&&(y.alternate=null,Da(x)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(x=y.stateNode,x!==null&&lm(x)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}function qa(y,x,L){for(L=L.child;L!==null;)zf(y,x,L),L=L.sibling}function zf(y,x,L){if(wa&&typeof wa.onCommitFiberUnmount=="function")try{wa.onCommitFiberUnmount(Jd,L)}catch{}switch(L.tag){case 26:if(ks){En||ua(L,x),qa(y,x,L),L.memoizedState?dp(L.memoizedState):L.stateNode&&Ac(L.stateNode);break}case 27:if(Ho){En||ua(L,x);var W=ir,ie=dr;su(L.type)&&(ir=L.stateNode,dr=!1),qa(y,x,L),Qh(L.stateNode),ir=W,dr=ie;break}case 5:En||ua(L,x);case 6:if(xs){if(W=ir,ie=dr,ir=null,qa(y,x,L),ir=W,dr=ie,ir!==null)if(dr)try{hg(ir,L.stateNode)}catch(be){mo(L,x,be)}else try{hm(ir,L.stateNode)}catch(be){mo(L,x,be)}}else qa(y,x,L);break;case 18:xs&&ir!==null&&(dr?Fi(ir,L.stateNode):Zd(ir,L.stateNode));break;case 4:xs?(W=ir,ie=dr,ir=L.stateNode.containerInfo,dr=!0,qa(y,x,L),ir=W,dr=ie):(bl&&tg(L.stateNode,L,Wu()),qa(y,x,L));break;case 0:case 11:case 14:case 15:En||pl(2,L,x),En||pl(4,L,x),qa(y,x,L);break;case 1:En||(ua(L,x),W=L.stateNode,typeof W.componentWillUnmount=="function"&&Ha(L,x,W)),qa(y,x,L);break;case 21:qa(y,x,L);break;case 22:En=(W=En)||L.memoizedState!==null,qa(y,x,L),En=W;break;default:qa(y,x,L)}}function Wp(y,x){if(pa&&x.memoizedState===null&&(y=x.alternate,y!==null&&(y=y.memoizedState,y!==null&&(y=y.dehydrated,y!==null))))try{ru(y)}catch(L){mo(x,x.return,L)}}function ku(y){switch(y.tag){case 13:case 19:var x=y.stateNode;return x===null&&(x=y.stateNode=new Vn),x;case 22:return y=y.stateNode,x=y._retryCache,x===null&&(x=y._retryCache=new Vn),x;default:throw Error(g(435,y.tag))}}function Ou(y,x){var L=ku(y);x.forEach(function(W){var ie=qf.bind(null,y,W);L.has(W)||(L.add(W),W.then(ie,ie))})}function Rs(y,x){var L=x.deletions;if(L!==null)for(var W=0;W<L.length;W++){var ie=L[W],be=y,ot=x;if(xs){var kt=ot;e:for(;kt!==null;){switch(kt.tag){case 27:if(Ho){if(su(kt.type)){ir=kt.stateNode,dr=!1;break e}break}case 5:ir=kt.stateNode,dr=!1;break e;case 3:case 4:ir=kt.stateNode.containerInfo,dr=!0;break e}kt=kt.return}if(ir===null)throw Error(g(160));zf(be,ot,ie),ir=null,dr=!1}else zf(be,ot,ie);be=ie.alternate,be!==null&&(be.return=null),ie.return=null}if(x.subtreeFlags&13878)for(x=x.child;x!==null;)Ff(x,y),x=x.sibling}function Ff(y,x){var L=y.alternate,W=y.flags;switch(y.tag){case 0:case 11:case 14:case 15:Rs(x,y),fs(y),W&4&&(pl(3,y,y.return),Mh(3,y),pl(5,y,y.return));break;case 1:Rs(x,y),fs(y),W&512&&(En||L===null||ua(L,L.return)),W&64&&Nn&&(y=y.updateQueue,y!==null&&(W=y.callbacks,W!==null&&(L=y.shared.hiddenCallbacks,y.shared.hiddenCallbacks=L===null?W:L.concat(W))));break;case 26:if(ks){var ie=qr;if(Rs(x,y),fs(y),W&512&&(En||L===null||ua(L,L.return)),W&4){W=L!==null?L.memoizedState:null;var be=y.memoizedState;L===null?be===null?y.stateNode===null?y.stateNode=hp(ie,y.type,y.memoizedProps,y):ea(ie,y.type,y.stateNode):y.stateNode=Jh(ie,be,y.memoizedProps):W!==be?(W===null?L.stateNode!==null&&Ac(L.stateNode):dp(W),be===null?ea(ie,y.type,y.stateNode):Jh(ie,be,y.memoizedProps)):be===null&&y.stateNode!==null&&Rd(y,y.memoizedProps,L.memoizedProps)}break}case 27:if(Ho){Rs(x,y),fs(y),W&512&&(En||L===null||ua(L,L.return)),L!==null&&W&4&&Rd(y,y.memoizedProps,L.memoizedProps);break}case 5:if(Rs(x,y),fs(y),W&512&&(En||L===null||ua(L,L.return)),xs){if(y.flags&32){ie=y.stateNode;try{Xl(ie)}catch(or){mo(y,y.return,or)}}W&4&&y.stateNode!=null&&(ie=y.memoizedProps,Rd(y,ie,L!==null?L.memoizedProps:ie)),W&1024&&(Gn=!0)}break;case 6:if(Rs(x,y),fs(y),W&4&&xs){if(y.stateNode===null)throw Error(g(162));W=y.memoizedProps,L=L!==null?L.memoizedProps:W,ie=y.stateNode;try{sp(ie,L,W)}catch(or){mo(y,y.return,or)}}break;case 3:if(ks?(fp(),ie=qr,qr=Kl(x.containerInfo),Rs(x,y),qr=ie):Rs(x,y),fs(y),W&4){if(xs&&pa&&L!==null&&L.memoizedState.isDehydrated)try{Ds(x.containerInfo)}catch(or){mo(y,y.return,or)}if(bl){W=x.containerInfo,L=x.pendingChildren;try{Yh(W,L)}catch(or){mo(y,y.return,or)}}}Gn&&(Gn=!1,Lu(y));break;case 4:ks?(L=qr,qr=Kl(y.stateNode.containerInfo),Rs(x,y),fs(y),qr=L):(Rs(x,y),fs(y)),W&4&&bl&&tg(y.stateNode,y,y.stateNode.pendingChildren);break;case 12:Rs(x,y),fs(y);break;case 13:Rs(x,y),fs(y),y.child.flags&8192&&y.memoizedState!==null!=(L!==null&&L.memoizedState!==null)&&(Ni=ta()),W&4&&(W=y.updateQueue,W!==null&&(y.updateQueue=null,Ou(y,W)));break;case 22:ie=y.memoizedState!==null;var ot=L!==null&&L.memoizedState!==null,kt=Nn,gn=En;if(Nn=kt||ie,En=gn||ot,Rs(x,y),En=gn,Nn=kt,fs(y),W&8192&&(x=y.stateNode,x._visibility=ie?x._visibility&-2:x._visibility|1,ie&&(L===null||ot||Nn||En||Ul(y)),xs)){e:if(L=null,xs)for(x=y;;){if(x.tag===5||ks&&x.tag===26){if(L===null){ot=L=x;try{be=ot.stateNode,ie?fm(be):Hu(ot.stateNode,ot.memoizedProps)}catch(or){mo(ot,ot.return,or)}}}else if(x.tag===6){if(L===null){ot=x;try{var Yn=ot.stateNode;ie?$u(Yn):qu(Yn,ot.memoizedProps)}catch(or){mo(ot,ot.return,or)}}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===y)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===y)break e;for(;x.sibling===null;){if(x.return===null||x.return===y)break e;L===x&&(L=null),x=x.return}L===x&&(L=null),x.sibling.return=x.return,x=x.sibling}}W&4&&(W=y.updateQueue,W!==null&&(L=W.retryQueue,L!==null&&(W.retryQueue=null,Ou(y,L))));break;case 19:Rs(x,y),fs(y),W&4&&(W=y.updateQueue,W!==null&&(y.updateQueue=null,Ou(y,W)));break;case 30:break;case 21:break;default:Rs(x,y),fs(y)}}function fs(y){var x=y.flags;if(x&2){try{if(xs){for(var L,W=y.return;W!==null;){if(Rh(W)){L=W;break}W=W.return}if(L==null)throw Error(g(160));switch(L.tag){case 27:if(Ho){var ie=L.stateNode,be=Nl(y);Lf(y,be,ie);break}case 5:var ot=L.stateNode;L.flags&32&&(Xl(ot),L.flags&=-33);var kt=Nl(y);Lf(y,kt,ot);break;case 3:case 4:var gn=L.stateNode.containerInfo,Yn=Nl(y);xc(y,Yn,gn);break;default:throw Error(g(161))}}}catch(or){mo(y,y.return,or)}y.flags&=-3}x&4096&&(y.flags&=-4097)}function Lu(y){if(y.subtreeFlags&1024)for(y=y.child;y!==null;){var x=y;Lu(x),x.tag===5&&x.flags&1024&&ip(x.stateNode),y=y.sibling}}function Vl(y,x){if(x.subtreeFlags&8772)for(x=x.child;x!==null;)kh(y,x.alternate,x),x=x.sibling}function Ul(y){for(y=y.child;y!==null;){var x=y;switch(x.tag){case 0:case 11:case 14:case 15:pl(4,x,x.return),Ul(x);break;case 1:ua(x,x.return);var L=x.stateNode;typeof L.componentWillUnmount=="function"&&Ha(x,x.return,L),Ul(x);break;case 27:Ho&&Qh(x.stateNode);case 26:case 5:ua(x,x.return),Ul(x);break;case 22:x.memoizedState===null&&Ul(x);break;case 30:Ul(x);break;default:Ul(x)}y=y.sibling}}function os(y,x,L){for(L=L&&(x.subtreeFlags&8772)!==0,x=x.child;x!==null;){var W=x.alternate,ie=y,be=x,ot=be.flags;switch(be.tag){case 0:case 11:case 15:os(ie,be,L),Mh(4,be);break;case 1:if(os(ie,be,L),W=be,ie=W.stateNode,typeof ie.componentDidMount=="function")try{ie.componentDidMount()}catch(Yn){mo(W,W.return,Yn)}if(W=be,ie=W.updateQueue,ie!==null){var kt=W.stateNode;try{var gn=ie.shared.hiddenCallbacks;if(gn!==null)for(ie.shared.hiddenCallbacks=null,ie=0;ie<gn.length;ie++)qn(gn[ie],kt)}catch(Yn){mo(W,W.return,Yn)}}L&&ot&64&&Du(be),Ih(be,be.return);break;case 27:Ho&&Dh(be);case 26:case 5:os(ie,be,L),L&&W===null&&ot&4&&qp(be),Ih(be,be.return);break;case 12:os(ie,be,L);break;case 13:os(ie,be,L),L&&ot&4&&Wp(ie,be);break;case 22:be.memoizedState===null&&os(ie,be,L),Ih(be,be.return);break;case 30:break;default:os(ie,be,L)}x=x.sibling}}function Dd(y,x){var L=null;y!==null&&y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(L=y.memoizedState.cachePool.pool),y=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(y=x.memoizedState.cachePool.pool),y!==L&&(y!=null&&y.refCount++,L!=null&&Yt(L))}function hn(y,x){y=null,x.alternate!==null&&(y=x.alternate.memoizedState.cache),x=x.memoizedState.cache,x!==y&&(x.refCount++,y!=null&&Yt(y))}function Wa(y,x,L,W){if(x.subtreeFlags&10256)for(x=x.child;x!==null;)zu(y,x,L,W),x=x.sibling}function zu(y,x,L,W){var ie=x.flags;switch(x.tag){case 0:case 11:case 15:Wa(y,x,L,W),ie&2048&&Mh(9,x);break;case 1:Wa(y,x,L,W);break;case 3:Wa(y,x,L,W),ie&2048&&(y=null,x.alternate!==null&&(y=x.alternate.memoizedState.cache),x=x.memoizedState.cache,x!==y&&(x.refCount++,y!=null&&Yt(y)));break;case 12:if(ie&2048){Wa(y,x,L,W),y=x.stateNode;try{var be=x.memoizedProps,ot=be.id,kt=be.onPostCommit;typeof kt=="function"&&kt(ot,x.alternate===null?"mount":"update",y.passiveEffectDuration,-0)}catch(gn){mo(x,x.return,gn)}}else Wa(y,x,L,W);break;case 13:Wa(y,x,L,W);break;case 23:break;case 22:be=x.stateNode,ot=x.alternate,x.memoizedState!==null?be._visibility&2?Wa(y,x,L,W):bc(y,x):be._visibility&2?Wa(y,x,L,W):(be._visibility|=2,ml(y,x,L,W,(x.subtreeFlags&10256)!==0)),ie&2048&&Dd(ot,x);break;case 24:Wa(y,x,L,W),ie&2048&&hn(x.alternate,x);break;default:Wa(y,x,L,W)}}function ml(y,x,L,W,ie){for(ie=ie&&(x.subtreeFlags&10256)!==0,x=x.child;x!==null;){var be=y,ot=x,kt=L,gn=W,Yn=ot.flags;switch(ot.tag){case 0:case 11:case 15:ml(be,ot,kt,gn,ie),Mh(8,ot);break;case 23:break;case 22:var or=ot.stateNode;ot.memoizedState!==null?or._visibility&2?ml(be,ot,kt,gn,ie):bc(be,ot):(or._visibility|=2,ml(be,ot,kt,gn,ie)),ie&&Yn&2048&&Dd(ot.alternate,ot);break;case 24:ml(be,ot,kt,gn,ie),ie&&Yn&2048&&hn(ot.alternate,ot);break;default:ml(be,ot,kt,gn,ie)}x=x.sibling}}function bc(y,x){if(x.subtreeFlags&10256)for(x=x.child;x!==null;){var L=y,W=x,ie=W.flags;switch(W.tag){case 22:bc(L,W),ie&2048&&Dd(W.alternate,W);break;case 24:bc(L,W),ie&2048&&hn(W.alternate,W);break;default:bc(L,W)}x=x.sibling}}function gl(y){if(y.subtreeFlags&hr)for(y=y.child;y!==null;)_l(y),y=y.sibling}function _l(y){switch(y.tag){case 26:gl(y),y.flags&hr&&(y.memoizedState!==null?Sl(qr,y.memoizedState,y.memoizedProps):rr(y.type,y.memoizedProps));break;case 5:gl(y),y.flags&hr&&rr(y.type,y.memoizedProps);break;case 3:case 4:if(ks){var x=qr;qr=Kl(y.stateNode.containerInfo),gl(y),qr=x}else gl(y);break;case 22:y.memoizedState===null&&(x=y.alternate,x!==null&&x.memoizedState!==null?(x=hr,hr=16777216,gl(y),hr=x):gl(y));break;default:gl(y)}}function Oh(y){var x=y.alternate;if(x!==null&&(y=x.child,y!==null)){x.child=null;do x=y.sibling,y.sibling=null,y=x;while(y!==null)}}function Ks(y){var x=y.deletions;if((y.flags&16)!==0){if(x!==null)for(var L=0;L<x.length;L++){var W=x[L];Kn=W,rg(W,y)}Oh(y)}if(y.subtreeFlags&10256)for(y=y.child;y!==null;)Ur(y),y=y.sibling}function Ur(y){switch(y.tag){case 0:case 11:case 15:Ks(y),y.flags&2048&&pl(9,y,y.return);break;case 3:Ks(y);break;case 12:Ks(y);break;case 22:var x=y.stateNode;y.memoizedState!==null&&x._visibility&2&&(y.return===null||y.return.tag!==13)?(x._visibility&=-3,wc(y)):Ks(y);break;default:Ks(y)}}function wc(y){var x=y.deletions;if((y.flags&16)!==0){if(x!==null)for(var L=0;L<x.length;L++){var W=x[L];Kn=W,rg(W,y)}Oh(y)}for(y=y.child;y!==null;){switch(x=y,x.tag){case 0:case 11:case 15:pl(8,x,x.return),wc(x);break;case 22:L=x.stateNode,L._visibility&2&&(L._visibility&=-3,wc(x));break;default:wc(x)}y=y.sibling}}function rg(y,x){for(;Kn!==null;){var L=Kn;switch(L.tag){case 0:case 11:case 15:pl(8,L,x);break;case 23:case 22:if(L.memoizedState!==null&&L.memoizedState.cachePool!==null){var W=L.memoizedState.cachePool.pool;W!=null&&W.refCount++}break;case 24:Yt(L.memoizedState.cache)}if(W=L.child,W!==null)W.return=L,Kn=W;else e:for(L=y;Kn!==null;){W=Kn;var ie=W.sibling,be=W.return;if(Da(W),W===L){Kn=null;break e}if(ie!==null){ie.return=be,Kn=ie;break e}Kn=be}}}function Zp(y){var x=Zh(y);if(x!=null){if(typeof x.memoizedProps["data-testname"]!="string")throw Error(g(364));return x}if(y=E_(y),y===null)throw Error(g(362));return y.stateNode.current}function kd(y,x){var L=y.tag;switch(x.$$typeof){case si:if(y.type===x.value)return!0;break;case Mi:e:{for(x=x.value,y=[y,0],L=0;L<y.length;){var W=y[L++],ie=W.tag,be=y[L++],ot=x[be];if(ie!==5&&ie!==26&&ie!==27||!Uu(W)){for(;ot!=null&&kd(W,ot);)be++,ot=x[be];if(be===x.length){x=!0;break e}else for(W=W.child;W!==null;)y.push(W,be),W=W.sibling}}x=!1}return x;case yr:if((L===5||L===26||L===27)&&Qs(y.stateNode,x.value))return!0;break;case Xr:if((L===5||L===6||L===26||L===27)&&(y=ba(y),y!==null&&0<=y.indexOf(x.value)))return!0;break;case Qr:if((L===5||L===26||L===27)&&(y=y.memoizedProps["data-testname"],typeof y=="string"&&y.toLowerCase()===x.value.toLowerCase()))return!0;break;default:throw Error(g(365))}return!1}function Yp(y){switch(y.$$typeof){case si:return"<"+(F(y.value)||"Unknown")+">";case Mi:return":has("+(Yp(y)||"")+")";case yr:return'[role="'+y.value+'"]';case Xr:return'"'+y.value+'"';case Qr:return'[data-testname="'+y.value+'"]';default:throw Error(g(365))}}function Yi(y,x){var L=[];y=[y,0];for(var W=0;W<y.length;){var ie=y[W++],be=ie.tag,ot=y[W++],kt=x[ot];if(be!==5&&be!==26&&be!==27||!Uu(ie)){for(;kt!=null&&kd(ie,kt);)ot++,kt=x[ot];if(ot===x.length)L.push(ie);else for(ie=ie.child;ie!==null;)y.push(ie,ot),ie=ie.sibling}}return L}function Bf(y,x){if(!Hd)throw Error(g(363));y=Zp(y),y=Yi(y,x),x=[],y=Array.from(y);for(var L=0;L<y.length;){var W=y[L++],ie=W.tag;if(ie===5||ie===26||ie===27)Uu(W)||x.push(W.stateNode);else for(W=W.child;W!==null;)y.push(W),W=W.sibling}return x}function da(){if((Dr&2)!==0&&Zn!==0)return Zn&-Zn;if(Zr.T!==null){var y=ed;return y!==0?y:tr()}return $d()}function ig(){Co===0&&(Co=(Zn&536870912)===0||Ci?Z():536870912);var y=rt.current;return y!==null&&(y.flags|=32),Co}function ka(y,x,L){(y===hi&&(Fn===2||Fn===9)||y.cancelPendingCommit!==null)&&(Fu(y,0),$c(y,Zn,Co,!1)),ge(y,L),((Dr&2)===0||y!==hi)&&(y===hi&&((Dr&2)===0&&(as|=L),Xi===4&&$c(y,Zn,Co,!1)),zn(y))}function og(y,x,L){if((Dr&6)!==0)throw Error(g(327));var W=!L&&(x&124)===0&&(x&y.expiredLanes)===0||j(y,x),ie=W?Ld(y,x):Od(y,x,!0),be=W;do{if(ie===0){Ii&&!W&&$c(y,x,0,!1);break}else{if(L=y.current.alternate,be&&!ag(L)){ie=Od(y,x,!1),be=!1;continue}if(ie===2){if(be=x,y.errorRecoveryDisabledLanes&be)var ot=0;else ot=y.pendingLanes&-536870913,ot=ot!==0?ot:ot&536870912?536870912:0;if(ot!==0){x=ot;e:{var kt=y;ie=ga;var gn=pa&&kt.current.memoizedState.isDehydrated;if(gn&&(Fu(kt,ot).flags|=256),ot=Od(kt,ot,!1),ot!==2){if(xo&&!gn){kt.errorRecoveryDisabledLanes|=be,as|=be,ie=4;break e}be=vi,vi=ie,be!==null&&(vi===null?vi=be:vi.push.apply(vi,be))}ie=ot}if(be=!1,ie!==2)continue}}if(ie===1){Fu(y,0),$c(y,x,0,!0);break}e:{switch(W=y,be=ie,be){case 0:case 1:throw Error(g(345));case 4:if((x&4194048)!==x)break;case 6:$c(W,x,Co,!Oi);break e;case 2:vi=null;break;case 3:case 5:break;default:throw Error(g(329))}if((x&62914560)===x&&(ie=Ni+300-ta(),10<ie)){if($c(W,x,Co,!Oi),H(W,0,!0)!==0)break e;W.timeoutHandle=am(sg.bind(null,W,L,vi,No,uo,x,Co,as,Bs,Oi,be,2,-0,0),ie);break e}sg(W,L,vi,No,uo,x,Co,as,Bs,Oi,be,0,-0,0)}}break}while(!0);zn(y)}function sg(y,x,L,W,ie,be,ot,kt,gn,Yn,or,vr,Er,Ri){if(y.timeoutHandle=xl,vr=x.subtreeFlags,(vr&8192||(vr&16785408)===16785408)&&(eu(),_l(x),vr=cm(),vr!==null)){y.cancelPendingCommit=vr(Gf.bind(null,y,x,be,L,W,ie,ot,kt,gn,or,1,Er,Ri)),$c(y,be,ot,!Yn);return}Gf(y,x,be,L,W,ie,ot,kt,gn)}function ag(y){for(var x=y;;){var L=x.tag;if((L===0||L===11||L===15)&&x.flags&16384&&(L=x.updateQueue,L!==null&&(L=L.stores,L!==null)))for(var W=0;W<L.length;W++){var ie=L[W],be=ie.getSnapshot;ie=ie.value;try{if(!Fs(be(),ie))return!1}catch{return!1}}if(L=x.child,x.subtreeFlags&16384&&L!==null)L.return=x,x=L;else{if(x===y)break;for(;x.sibling===null;){if(x.return===null||x.return===y)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function $c(y,x,L,W){x&=~na,x&=~as,y.suspendedLanes|=x,y.pingedLanes&=~x,W&&(y.warmLanes|=x),W=y.expirationTimes;for(var ie=x;0<ie;){var be=31-Os(ie),ot=1<<be;W[be]=-1,ie&=~ot}L!==0&&oe(y,L,x)}function Lh(){return(Dr&6)===0?($n(0),!1):!0}function Xp(){if(wr!==null){if(Fn===0)var y=wr.return;else y=wr,Ic=du=null,io(y),bt=null,Pt=0,y=wr;for(;y!==null;)Id(y.alternate,y),y=y.return;wr=null}}function Fu(y,x){var L=y.timeoutHandle;L!==xl&&(y.timeoutHandle=xl,Wl(L)),L=y.cancelPendingCommit,L!==null&&(y.cancelPendingCommit=null,L()),Xp(),hi=y,wr=L=Tc(y.current,null),Zn=x,Fn=0,Gr=null,Oi=!1,Ii=j(y,x),xo=!1,Bs=Co=na=as=ss=Xi=0,vi=ga=null,uo=!1,(x&8)!==0&&(x|=x&32);var W=y.entangledLanes;if(W!==0)for(y=y.entanglements,W&=x;0<W;){var ie=31-Os(W),be=1<<ie;x|=y[ie],W&=~be}return bo=x,ca(),L}function Nf(y,x){Pe=null,Zr.H=Xe,x===d||x===b?(x=Kt(),Fn=3):x===_?(x=Kt(),Fn=4):Fn=x===Sn?8:x!==null&&typeof x=="object"&&typeof x.then=="function"?6:1,Gr=x,wr===null&&(Xi=1,li(y,xe(x,y.current)))}function zh(){var y=rt.current;return y===null?!0:(Zn&4194048)===Zn?zt===null:(Zn&62914560)===Zn||(Zn&536870912)!==0?y===zt:!1}function Vf(){var y=Zr.H;return Zr.H=Xe,y===null?Xe:y}function Hc(){var y=Zr.A;return Zr.A=ri,y}function qc(){Xi=4,Oi||(Zn&4194048)!==Zn&&rt.current!==null||(Ii=!0),(ss&134217727)===0&&(as&134217727)===0||hi===null||$c(hi,Zn,Co,!1)}function Od(y,x,L){var W=Dr;Dr|=2;var ie=Vf(),be=Hc();(hi!==y||Zn!==x)&&(No=null,Fu(y,x)),x=!1;var ot=Xi;e:do try{if(Fn!==0&&wr!==null){var kt=wr,gn=Gr;switch(Fn){case 8:Xp(),ot=6;break e;case 3:case 2:case 9:case 6:rt.current===null&&(x=!0);var Yn=Fn;if(Fn=0,Gr=null,yl(y,kt,gn,Yn),L&&Ii){ot=0;break e}break;default:Yn=Fn,Fn=0,Gr=null,yl(y,kt,gn,Yn)}}Uf(),ot=Xi;break}catch(or){Nf(y,or)}while(!0);return x&&y.shellSuspendCounter++,Ic=du=null,Dr=W,Zr.H=ie,Zr.A=be,wr===null&&(hi=null,Zn=0,ca()),ot}function Uf(){for(;wr!==null;)jf(wr)}function Ld(y,x){var L=Dr;Dr|=2;var W=Vf(),ie=Hc();hi!==y||Zn!==x?(No=null,wo=ta()+500,Fu(y,x)):Ii=j(y,x);e:do try{if(Fn!==0&&wr!==null){x=wr;var be=Gr;t:switch(Fn){case 1:Fn=0,Gr=null,yl(y,x,be,1);break;case 2:case 9:if(co(be)){Fn=0,Gr=null,Kp(x);break}x=function(){Fn!==2&&Fn!==9||hi!==y||(Fn=7),zn(y)},be.then(x,x);break e;case 3:Fn=7;break e;case 4:Fn=5;break e;case 7:co(be)?(Fn=0,Gr=null,Kp(x)):(Fn=0,Gr=null,yl(y,x,be,7));break;case 5:var ot=null;switch(wr.tag){case 26:ot=wr.memoizedState;case 5:case 27:var kt=wr,gn=kt.type,Yn=kt.pendingProps;if(ot?pp(ot):Ec(gn,Yn)){Fn=0,Gr=null;var or=kt.sibling;if(or!==null)wr=or;else{var vr=kt.return;vr!==null?(wr=vr,Bu(vr)):wr=null}break t}}Fn=0,Gr=null,yl(y,x,be,5);break;case 6:Fn=0,Gr=null,yl(y,x,be,6);break;case 8:Xp(),Xi=6;break e;default:throw Error(g(462))}}lg();break}catch(Er){Nf(y,Er)}while(!0);return Ic=du=null,Zr.H=W,Zr.A=ie,Dr=L,wr!==null?0:(hi=null,Zn=0,ca(),Xi)}function lg(){for(;wr!==null&&!gp();)jf(wr)}function jf(y){var x=Iu(y.alternate,y,bo);y.memoizedProps=y.pendingProps,x===null?Bu(y):wr=x}function Kp(y){var x=y,L=x.alternate;switch(x.tag){case 15:case 0:x=Ad(L,x,x.pendingProps,x.type,void 0,Zn);break;case 11:x=Ad(L,x,x.pendingProps,x.type.render,x.ref,Zn);break;case 5:io(x);default:Id(L,x),x=wr=Zc(x,bo),x=Iu(L,x,bo)}y.memoizedProps=y.pendingProps,x===null?Bu(y):wr=x}function yl(y,x,L,W){Ic=du=null,io(x),bt=null,Pt=0;var ie=x.return;try{if(If(y,ie,x,L,Zn)){Xi=1,li(y,xe(L,y.current)),wr=null;return}}catch(be){if(ie!==null)throw wr=ie,be;Xi=1,li(y,xe(L,y.current)),wr=null;return}x.flags&32768?(Ci||W===1?y=!0:Ii||(Zn&536870912)!==0?y=!1:(Oi=y=!0,(W===2||W===9||W===3||W===6)&&(W=rt.current,W!==null&&W.tag===13&&(W.flags|=16384))),Fh(x,y)):Bu(x)}function Bu(y){var x=y;do{if((x.flags&32768)!==0){Fh(x,Oi);return}y=x.return;var L=hs(x.alternate,x,bo);if(L!==null){wr=L;return}if(x=x.sibling,x!==null){wr=x;return}wr=x=y}while(x!==null);Xi===0&&(Xi=5)}function Fh(y,x){do{var L=eg(y.alternate,y);if(L!==null){L.flags&=32767,wr=L;return}if(L=y.return,L!==null&&(L.flags|=32768,L.subtreeFlags=0,L.deletions=null),!x&&(y=y.sibling,y!==null)){wr=y;return}wr=y=L}while(y!==null);Xi=6,wr=null}function Gf(y,x,L,W,ie,be,ot,kt,gn){y.cancelPendingCommit=null;do Fd();while(Ji!==0);if((Dr&6)!==0)throw Error(g(327));if(x!==null){if(x===y.current)throw Error(g(177));if(be=x.lanes|x.childLanes,be|=q,ae(y,L,be,ot,kt,gn),y===hi&&(wr=hi=null,Zn=0),Ta=x,Ns=y,ra=L,Ql=be,ec=ie,Pl=W,(x.subtreeFlags&10256)!==0||(x.flags&10256)!==0?(y.callbackNode=null,y.callbackPriority=0,Wc(yp,function(){return Sc(),null})):(y.callbackNode=null,y.callbackPriority=0),W=(x.flags&13878)!==0,(x.subtreeFlags&13878)!==0||W){W=Zr.T,Zr.T=null,ie=ma(),ps(2),ot=Dr,Dr|=4;try{ng(y,x,L)}finally{Dr=ot,ps(ie),Zr.T=W}}Ji=1,Bh(),zd(),Jp()}}function Bh(){if(Ji===1){Ji=0;var y=Ns,x=Ta,L=(x.flags&13878)!==0;if((x.subtreeFlags&13878)!==0||L){L=Zr.T,Zr.T=null;var W=ma();ps(2);var ie=Dr;Dr|=4;try{Ff(x,y),Gd(y.containerInfo)}finally{Dr=ie,ps(W),Zr.T=L}}y.current=x,Ji=2}}function zd(){if(Ji===2){Ji=0;var y=Ns,x=Ta,L=(x.flags&8772)!==0;if((x.subtreeFlags&8772)!==0||L){L=Zr.T,Zr.T=null;var W=ma();ps(2);var ie=Dr;Dr|=4;try{kh(y,x.alternate,x)}finally{Dr=ie,ps(W),Zr.T=L}}Ji=3}}function Jp(){if(Ji===4||Ji===3){Ji=0,vm();var y=Ns,x=Ta,L=ra,W=Pl;(x.subtreeFlags&10256)!==0||(x.flags&10256)!==0?Ji=5:(Ji=0,Ta=Ns=null,Qp(y,y.pendingLanes));var ie=y.pendingLanes;if(ie===0&&(Ki=null),K(L),x=x.stateNode,wa&&typeof wa.onCommitFiberRoot=="function")try{wa.onCommitFiberRoot(Jd,x,void 0,(x.current.flags&128)===128)}catch{}if(W!==null){x=Zr.T,ie=ma(),ps(2),Zr.T=null;try{for(var be=y.onRecoverableError,ot=0;ot<W.length;ot++){var kt=W[ot];be(kt.value,{componentStack:kt.stack})}}finally{Zr.T=x,ps(ie)}}(ra&3)!==0&&Fd(),zn(y),ie=y.pendingLanes,(L&4194090)!==0&&(ie&42)!==0?y===Ml?tc++:(tc=0,Ml=y):tc=0,$n(0)}}function Qp(y,x){(y.pooledCacheLanes&=x)===0&&(x=y.pooledCache,x!=null&&(y.pooledCache=null,Yt(x)))}function Fd(y){return Bh(),zd(),Jp(),Sc()}function Sc(){if(Ji!==5)return!1;var y=Ns,x=Ql;Ql=0;var L=K(ra),W=32>L?32:L;L=Zr.T;var ie=ma();try{ps(W),Zr.T=null,W=ec,ec=null;var be=Ns,ot=ra;if(Ji=0,Ta=Ns=null,ra=0,(Dr&6)!==0)throw Error(g(331));var kt=Dr;if(Dr|=4,Ur(be.current),zu(be,be.current,ot,W),Dr=kt,$n(0,!1),wa&&typeof wa.onPostCommitFiberRoot=="function")try{wa.onPostCommitFiberRoot(Jd,be)}catch{}return!0}finally{ps(ie),Zr.T=L,Qp(y,x)}}function em(y,x,L){x=xe(L,x),x=Zs(y.stateNode,x,2),y=Ct(y,x,2),y!==null&&(ge(y,2),zn(y))}function mo(y,x,L){if(y.tag===3)em(y,y,L);else for(;x!==null;){if(x.tag===3){em(x,y,L);break}else if(x.tag===1){var W=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof W.componentDidCatch=="function"&&(Ki===null||!Ki.has(W))){y=xe(L,y),L=Gc(2),W=Ct(x,L,2),W!==null&&(ci(L,W,x,y),ge(W,2),zn(W));break}}x=x.return}}function tm(y,x,L){var W=y.pingCache;if(W===null){W=y.pingCache=new $i;var ie=new Set;W.set(x,ie)}else ie=W.get(x),ie===void 0&&(ie=new Set,W.set(x,ie));ie.has(L)||(xo=!0,ie.add(L),y=w_.bind(null,y,x,L),x.then(y,y))}function w_(y,x,L){var W=y.pingCache;W!==null&&W.delete(x),y.pingedLanes|=y.suspendedLanes&L,y.warmLanes&=~L,hi===y&&(Zn&L)===L&&(Xi===4||Xi===3&&(Zn&62914560)===Zn&&300>ta()-Ni?(Dr&2)===0&&Fu(y,0):na|=L,Bs===Zn&&(Bs=0)),zn(y)}function $f(y,x){x===0&&(x=X()),y=we(y,x),y!==null&&(ge(y,x),zn(y))}function Hf(y){var x=y.memoizedState,L=0;x!==null&&(L=x.retryLane),$f(y,L)}function qf(y,x){var L=0;switch(y.tag){case 13:var W=y.stateNode,ie=y.memoizedState;ie!==null&&(L=ie.retryLane);break;case 19:W=y.stateNode;break;case 22:W=y.stateNode._retryCache;break;default:throw Error(g(314))}W!==null&&W.delete(x),$f(y,L)}function Wc(y,x){return Pc(y,x)}function nm(y,x,L,W){this.tag=y,this.key=L,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=W,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nh(y){return y=y.prototype,!(!y||!y.isReactComponent)}function Tc(y,x){var L=y.alternate;return L===null?(L=c(y.tag,x,y.key,y.mode),L.elementType=y.elementType,L.type=y.type,L.stateNode=y.stateNode,L.alternate=y,y.alternate=L):(L.pendingProps=x,L.type=y.type,L.flags=0,L.subtreeFlags=0,L.deletions=null),L.flags=y.flags&65011712,L.childLanes=y.childLanes,L.lanes=y.lanes,L.child=y.child,L.memoizedProps=y.memoizedProps,L.memoizedState=y.memoizedState,L.updateQueue=y.updateQueue,x=y.dependencies,L.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},L.sibling=y.sibling,L.index=y.index,L.ref=y.ref,L.refCleanup=y.refCleanup,L}function Zc(y,x){y.flags&=65011714;var L=y.alternate;return L===null?(y.childLanes=0,y.lanes=x,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=L.childLanes,y.lanes=L.lanes,y.child=L.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=L.memoizedProps,y.memoizedState=L.memoizedState,y.updateQueue=L.updateQueue,y.type=L.type,x=L.dependencies,y.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext}),y}function jl(y,x,L,W,ie,be){var ot=0;if(W=y,typeof y=="function")Nh(y)&&(ot=1);else if(typeof y=="string")ot=ks&&Ho?ou(y,L,Ls.current)?26:mp(y)?27:5:ks?ou(y,L,Ls.current)?26:5:Ho&&mp(y)?27:5;else e:switch(y){case qh:return y=c(31,L,x,ie),y.elementType=qh,y.lanes=be,y;case Ud:return Yc(L.children,ie,be,x);case cg:ot=8,ie|=24;break;case jd:return y=c(12,L,x,ie|2),y.elementType=jd,y.lanes=be,y;case Hh:return y=c(13,L,x,ie),y.elementType=Hh,y.lanes=be,y;case Kc:return y=c(19,L,x,ie),y.elementType=Kc,y.lanes=be,y;default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case S_:case $l:ot=10;break e;case ug:ot=9;break e;case $h:ot=11;break e;case Xf:ot=14;break e;case Hl:ot=16,W=null;break e}ot=29,L=Error(g(130,y===null?"null":typeof y,"")),W=null}return x=c(ot,L,x,ie),x.elementType=y,x.type=W,x.lanes=be,x}function Yc(y,x,L,W){return y=c(7,y,W,x),y.lanes=L,y}function ha(y,x,L){return y=c(6,y,null,x),y.lanes=L,y}function Bd(y,x,L){return x=c(4,y.children!==null?y.children:[],y.key,x),x.lanes=L,x.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},x}function Vh(y,x,L,W,ie,be,ot,kt){this.tag=1,this.containerInfo=y,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=xl,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=se(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=se(0),this.hiddenUpdates=se(null),this.identifierPrefix=W,this.onUncaughtError=ie,this.onCaughtError=be,this.onRecoverableError=ot,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=kt,this.incompleteTransitions=new Map}function Uh(y,x,L,W,ie,be,ot,kt,gn,Yn,or,vr){return y=new Vh(y,x,L,ot,kt,gn,Yn,vr),x=1,be===!0&&(x|=24),be=c(3,null,null,x),y.current=be,be.stateNode=y,x=Gt(),x.refCount++,y.pooledCache=x,x.refCount++,be.memoizedState={element:W,isDehydrated:L,cache:x},it(be),y}function Wf(y){return y?(y=au,y):au}function Zf(y){var x=y._reactInternals;if(x===void 0)throw typeof y.render=="function"?Error(g(188)):(y=Object.keys(y).join(","),Error(g(268,y)));return y=r(x),y=y!==null?E(y):null,y===null?null:Qc(y.stateNode)}function jh(y,x,L,W,ie,be){ie=Wf(ie),W.context===null?W.context=ie:W.pendingContext=ie,W=et(x),W.payload={element:L},be=be===void 0?null:be,be!==null&&(W.callback=be),L=Ct(y,W,x),L!==null&&(ka(L,y,x),dt(L,y,x))}function Nd(y,x){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var L=y.retryLane;y.retryLane=L!==0&&L<x?L:x}}function Xc(y,x){Nd(y,x),(y=y.alternate)&&Nd(y,x)}var Ai={},Gh=kL(),fa=EM(),Yf=Object.assign,rm=Symbol.for("react.element"),Gl=Symbol.for("react.transitional.element"),Vd=Symbol.for("react.portal"),Ud=Symbol.for("react.fragment"),cg=Symbol.for("react.strict_mode"),jd=Symbol.for("react.profiler"),S_=Symbol.for("react.provider"),ug=Symbol.for("react.consumer"),$l=Symbol.for("react.context"),$h=Symbol.for("react.forward_ref"),Hh=Symbol.for("react.suspense"),Kc=Symbol.for("react.suspense_list"),Xf=Symbol.for("react.memo"),Hl=Symbol.for("react.lazy"),qh=Symbol.for("react.activity"),Kf=Symbol.for("react.memo_cache_sentinel"),Jc=Symbol.iterator,Nu=Symbol.for("react.client.reference"),vl=Array.isArray,Zr=Gh.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Jf=s.rendererVersion,im=s.rendererPackageName,Qf=s.extraDevToolsConfig,Qc=s.getPublicInstance,ep=s.getRootHostContext,om=s.getChildHostContext,tp=s.prepareForCommit,Gd=s.resetAfterCommit,T_=s.createInstance;s.cloneMutableInstance;var ql=s.appendInitialChild,sm=s.finalizeInitialChildren,np=s.shouldSetTextContent,Wh=s.createTextInstance;s.cloneMutableTextInstance;var am=s.scheduleTimeout,Wl=s.cancelTimeout,xl=s.noTimeout,Js=s.isPrimaryRenderer;s.warnsIfNotActing;var xs=s.supportsMutation,bl=s.supportsPersistence,pa=s.supportsHydration,Zh=s.getInstanceFromNode;s.beforeActiveInstanceBlur;var rp=s.preparePortalMount;s.prepareScopeUpdate,s.getInstanceFromScope;var ps=s.setCurrentUpdatePriority,ma=s.getCurrentUpdatePriority,$d=s.resolveUpdatePriority;s.trackSchedulerEvent,s.resolveEventType,s.resolveEventTimeStamp;var In=s.shouldAttemptEagerTransition,lm=s.detachDeletedInstance;s.requestPostPaintCallback;var Cc=s.maySuspendCommit,Ec=s.preloadInstance,eu=s.startSuspendingCommit,rr=s.suspendInstance;s.suspendOnActiveViewTransition;var cm=s.waitForCommitToBeReady,Vu=s.NotPendingTransition,Zl=s.HostTransitionContext,ip=s.resetFormInstance;s.bindToConsole;var op=s.supportsMicrotasks,C_=s.scheduleMicrotask,Hd=s.supportsTestSelectors,E_=s.findFiberRoot,A_=s.getBoundingRect,ba=s.getTextContent,Uu=s.isHiddenSubtree,Qs=s.matchAccessibilityRole,tu=s.setFocusIfFocusable,dg=s.setupIntersectionObserver,um=s.appendChild,dm=s.appendChildToContainer,sp=s.commitTextUpdate,ju=s.commitMount,Yl=s.commitUpdate,ki=s.insertBefore,Gu=s.insertInContainerBefore,hm=s.removeChild,hg=s.removeChildFromContainer,Xl=s.resetTextContent,fm=s.hideInstance,$u=s.hideTextInstance,Hu=s.unhideInstance,qu=s.unhideTextInstance;s.cancelViewTransitionName,s.cancelRootViewTransitionName,s.restoreRootViewTransitionName,s.cloneRootViewTransitionContainer,s.removeRootViewTransitionClone,s.measureClonedInstance,s.hasInstanceChanged,s.hasInstanceAffectedParent,s.startViewTransition,s.startGestureTransition,s.stopGestureTransition,s.getCurrentGestureOffset,s.subscribeToGestureDirection,s.createViewTransitionInstance;var ln=s.clearContainer;s.createFragmentInstance,s.updateFragmentInstanceFiber,s.commitNewChildToFragmentInstance,s.deleteChildFromFragmentInstance;var wn=s.cloneInstance,Wu=s.createContainerChildSet,oo=s.appendChildToContainerChildSet,yt=s.finalizeContainerChildren,Yh=s.replaceContainerChildren,nu=s.cloneHiddenInstance,Xh=s.cloneHiddenTextInstance,Zu=s.isSuspenseInstancePending,ap=s.isSuspenseInstanceFallback,wl=s.getSuspenseInstanceFallbackErrorDetails,qd=s.registerSuspenseInstanceRetry,fg=s.canHydrateFormStateMarker,P_=s.isFormStateMarkerMatching,pm=s.getNextHydratableSibling,lp=s.getNextHydratableSiblingAfterSingleton,mm=s.getFirstHydratableChild,pg=s.getFirstHydratableChildWithinContainer,mg=s.getFirstHydratableChildWithinSuspenseInstance,cp=s.getFirstHydratableChildWithinSingleton,Kh=s.canHydrateInstance,Wd=s.canHydrateTextInstance,gm=s.canHydrateSuspenseInstance,gg=s.hydrateInstance,M_=s.hydrateTextInstance,_g=s.hydrateSuspenseInstance,yg=s.getNextHydratableInstanceAfterSuspenseInstance,Ds=s.commitHydratedContainer,ru=s.commitHydratedSuspenseInstance,Zd=s.clearSuspenseBoundary,Fi=s.clearSuspenseBoundaryFromContainer,jr=s.shouldDeleteUnhydratedTailInstances;s.diffHydratedPropsForDevWarnings,s.diffHydratedTextForDevWarnings,s.describeHydratableInstanceForDevWarnings;var vg=s.validateHydratableInstance,iu=s.validateHydratableTextInstance,ks=s.supportsResources,ou=s.isHostHoistableType,Kl=s.getHoistableRoot,up=s.getResource,Jh=s.acquireResource,dp=s.releaseResource,hp=s.hydrateHoistable,ea=s.mountHoistable,Ac=s.unmountHoistable,Yd=s.createHoistableInstance,fp=s.prepareToCommitHoistables,_m=s.mayResourceSuspendCommit,pp=s.preloadResource,Sl=s.suspendResource,Ho=s.supportsSingletons,zo=s.resolveSingletonInstance,Xd=s.acquireSingletonInstance,Qh=s.releaseSingletonInstance,mp=s.isHostSingletonType,su=s.isSingletonScope,Fo=[],Jl=-1,au={},Os=Math.clz32?Math.clz32:O,Yu=Math.log,ym=Math.LN2,Xu=256,lu=4194304,Pc=fa.unstable_scheduleCallback,Kd=fa.unstable_cancelCallback,gp=fa.unstable_shouldYield,vm=fa.unstable_requestPaint,ta=fa.unstable_now,Ku=fa.unstable_ImmediatePriority,_p=fa.unstable_UserBlockingPriority,yp=fa.unstable_NormalPriority,xm=fa.unstable_IdlePriority,xg=fa.log,vp=fa.unstable_setDisableYieldValue,Jd=null,wa=null,xp,bm,ef=!1,wm=new WeakMap,Ju=[],Qu=0,tf=null,bp=0,Za=[],Ya=0,Pi=null,Oa=1,Mc="",Ls=z(null),cu=z(null),Xa=z(null),Qd=z(null),zs=null,Wo=null,Ci=!1,Tl=null,Bi=!1,Ka=Error(g(519)),Fs=typeof Object.is=="function"?Object.is:Se,uu=z(null),du=null,Ic=null,nf=typeof AbortController<"u"?AbortController:function(){var y=[],x=this.signal={aborted:!1,addEventListener:function(L,W){y.push(W)}};this.abort=function(){x.aborted=!0,y.forEach(function(L){return L()})}},I_=fa.unstable_scheduleCallback,R_=fa.unstable_NormalPriority,Bo={$$typeof:$l,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},hu=null,bs=null,Rc=!1,Cl=!1,El=!1,Sa=0,Al=null,La=0,ed=0,rf=null,h=Zr.S;Zr.S=function(y,x){typeof x=="object"&&x!==null&&typeof x.then=="function"&&Br(y,x),h!==null&&h(y,x)};var n=z(null),a=Object.prototype.hasOwnProperty,d=Error(g(460)),_=Error(g(474)),b=Error(g(542)),T={then:function(){}},P=null,k=[],G=0,q=0,te=!1,Y=!1,re=z(null),le=z(0),ce=0,Pe=null,me=null,Me=null,Le=!1,Fe=!1,Ze=!1,He=0,Ye=0,qe=null,We=0,Xe={readContext:pt,use:$s,useCallback:gr,useContext:gr,useEffect:gr,useImperativeHandle:gr,useLayoutEffect:gr,useInsertionEffect:gr,useMemo:gr,useReducer:gr,useRef:gr,useState:gr,useDebugValue:gr,useDeferredValue:gr,useTransition:gr,useSyncExternalStore:gr,useId:gr,useHostTransitionStatus:gr,useFormState:gr,useActionState:gr,useOptimistic:gr,useMemoCache:gr,useCacheRefresh:gr},Tt={readContext:pt,use:$s,useCallback:function(y,x){return yi().memoizedState=[y,x===void 0?null:x],y},useContext:pt,useEffect:wh,useImperativeHandle:function(y,x,L){L=L!=null?L.concat([y]):null,Eu(4194308,4,Au.bind(null,x,y),L)},useLayoutEffect:function(y,x){return Eu(4194308,4,y,x)},useInsertionEffect:function(y,x){Eu(4,2,y,x)},useMemo:function(y,x){var L=yi();x=x===void 0?null:x;var W=y();if(Ze){ye(!0);try{y()}finally{ye(!1)}}return L.memoizedState=[W,x],W},useReducer:function(y,x,L){var W=yi();if(L!==void 0){var ie=L(x);if(Ze){ye(!0);try{L(x)}finally{ye(!1)}}}else ie=x;return W.memoizedState=W.baseState=ie,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:ie},W.queue=y,y=y.dispatch=Pf.bind(null,Pe,y),[W.memoizedState,y]},useRef:function(y){var x=yi();return y={current:y},x.memoizedState=y},useState:function(y){y=Ua(y);var x=y.queue,L=Ga.bind(null,Pe,x);return x.dispatch=L,[y.memoizedState,L]},useDebugValue:Ef,useDeferredValue:function(y,x){var L=yi();return Vc(L,y,x)},useTransition:function(){var y=Ua(!1);return y=Ch.bind(null,Pe,y.queue,!0,!1),yi().memoizedState=y,[!1,y]},useSyncExternalStore:function(y,x,L){var W=Pe,ie=yi();if(Ci){if(L===void 0)throw Error(g(407));L=L()}else{if(L=x(),hi===null)throw Error(g(349));(Zn&124)!==0||pd(W,x,L)}ie.memoizedState=L;var be={value:L,getSnapshot:x};return ie.queue=be,wh(hc.bind(null,W,be,y),[y]),W.flags|=2048,dl(9,Hs(),md.bind(null,W,be,L,x),null),L},useId:function(){var y=yi(),x=hi.identifierPrefix;if(Ci){var L=Mc,W=Oa;L=(W&~(1<<32-Os(W)-1)).toString(32)+L,x=""+x+"R"+L,L=He++,0<L&&(x+="H"+L.toString(32)),x+=""}else L=We++,x=""+x+"r"+L.toString(32)+"";return y.memoizedState=x},useHostTransitionStatus:mc,useFormState:Sf,useActionState:Sf,useOptimistic:function(y){var x=yi();x.memoizedState=x.baseState=y;var L={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return x.queue=L,x=bd.bind(null,Pe,!0,L),L.dispatch=x,[y,x]},useMemoCache:ul,useCacheRefresh:function(){return yi().memoizedState=xd.bind(null,Pe)}},ht={readContext:pt,use:$s,useCallback:Th,useContext:pt,useEffect:Cf,useImperativeHandle:Gp,useInsertionEffect:Sh,useLayoutEffect:Wr,useMemo:pc,useReducer:dc,useRef:Tf,useState:function(){return dc(Oo)},useDebugValue:Ef,useDeferredValue:function(y,x){var L=Hr();return vd(L,me.memoizedState,y,x)},useTransition:function(){var y=dc(Oo)[0],x=Hr().memoizedState;return[typeof y=="boolean"?y:rs(y),x]},useSyncExternalStore:Cu,useId:Hp,useHostTransitionStatus:mc,useFormState:_d,useActionState:_d,useOptimistic:function(y,x){var L=Hr();return bf(L,me,y,x)},useMemoCache:ul,useCacheRefresh:Af},Lt={readContext:pt,use:$s,useCallback:Th,useContext:pt,useEffect:Cf,useImperativeHandle:Gp,useInsertionEffect:Sh,useLayoutEffect:Wr,useMemo:pc,useReducer:zl,useRef:Tf,useState:function(){return zl(Oo)},useDebugValue:Ef,useDeferredValue:function(y,x){var L=Hr();return me===null?Vc(L,y,x):vd(L,me.memoizedState,y,x)},useTransition:function(){var y=zl(Oo)[0],x=Hr().memoizedState;return[typeof y=="boolean"?y:rs(y),x]},useSyncExternalStore:Cu,useId:Hp,useHostTransitionStatus:mc,useFormState:yd,useActionState:yd,useOptimistic:function(y,x){var L=Hr();return me!==null?bf(L,me,y,x):(L.baseState=y,[y,L.queue.dispatch])},useMemoCache:ul,useCacheRefresh:Af},bt=null,Pt=0,nn=Mf(!0),St=Mf(!1),rt=z(null),zt=null,wt=z(0),Zt={enqueueSetState:function(y,x,L){y=y._reactInternals;var W=da(),ie=et(W);ie.payload=x,L!=null&&(ie.callback=L),x=Ct(y,ie,W),x!==null&&(ka(x,y,W),dt(x,y,W))},enqueueReplaceState:function(y,x,L){y=y._reactInternals;var W=da(),ie=et(W);ie.tag=1,ie.payload=x,L!=null&&(ie.callback=L),x=Ct(y,ie,W),x!==null&&(ka(x,y,W),dt(x,y,W))},enqueueForceUpdate:function(y,x){y=y._reactInternals;var L=da(),W=et(L);W.tag=2,x!=null&&(W.callback=x),x=Ct(y,W,L),x!==null&&(ka(x,y,L),dt(x,y,L))}},sn=typeof reportError=="function"?reportError:function(y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var x=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof y=="object"&&y!==null&&typeof y.message=="string"?String(y.message):String(y),error:y});if(!window.dispatchEvent(x))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",y);return}console.error(y)},Sn=Error(g(461)),Ht=!1,en={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},Nn=!1,En=!1,Gn=!1,Vn=typeof WeakSet=="function"?WeakSet:Set,Kn=null,ir=null,dr=!1,qr=null,hr=8192,ri={getCacheForType:function(y){var x=pt(Bo),L=x.data.get(y);return L===void 0&&(L=y(),x.data.set(y,L)),L}},si=0,Mi=1,yr=2,Qr=3,Xr=4;if(typeof Symbol=="function"&&Symbol.for){var ei=Symbol.for;si=ei("selector.component"),Mi=ei("selector.has_pseudo_class"),yr=ei("selector.role"),Qr=ei("selector.test_id"),Xr=ei("selector.text")}var $i=typeof WeakMap=="function"?WeakMap:Map,Dr=0,hi=null,wr=null,Zn=0,Fn=0,Gr=null,Oi=!1,Ii=!1,xo=!1,bo=0,Xi=0,ss=0,as=0,na=0,Co=0,Bs=0,ga=null,vi=null,uo=!1,Ni=0,wo=1/0,No=null,Ki=null,Ji=0,Ns=null,Ta=null,ra=0,Ql=0,ec=null,Pl=null,tc=0,Ml=null;return Ai.attemptContinuousHydration=function(y){if(y.tag===13){var x=we(y,67108864);x!==null&&ka(x,y,67108864),Xc(y,67108864)}},Ai.attemptHydrationAtCurrentPriority=function(y){if(y.tag===13){var x=da();x=pe(x);var L=we(y,x);L!==null&&ka(L,y,x),Xc(y,x)}},Ai.attemptSynchronousHydration=function(y){switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var x=N(y.pendingLanes);if(x!==0){for(y.pendingLanes|=2,y.entangledLanes|=2;x;){var L=1<<31-Os(x);y.entanglements[1]|=L,x&=~L}zn(y),(Dr&6)===0&&(wo=ta()+500,$n(0))}}break;case 13:x=we(y,2),x!==null&&ka(x,y,2),Lh(),Xc(y,2)}},Ai.batchedUpdates=function(y,x){return y(x)},Ai.createComponentSelector=function(y){return{$$typeof:si,value:y}},Ai.createContainer=function(y,x,L,W,ie,be,ot,kt,gn,Yn){return Uh(y,x,!1,null,L,W,be,ot,kt,gn,Yn,null)},Ai.createHasPseudoClassSelector=function(y){return{$$typeof:Mi,value:y}},Ai.createHydrationContainer=function(y,x,L,W,ie,be,ot,kt,gn,Yn,or,vr,Er){return y=Uh(L,W,!0,y,ie,be,kt,gn,Yn,or,vr,Er),y.context=Wf(null),L=y.current,W=da(),W=pe(W),ie=et(W),ie.callback=x??null,Ct(L,ie,W),x=W,y.current.lanes=x,ge(y,x),zn(y),y},Ai.createPortal=function(y,x,L){var W=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vd,key:W==null?null:""+W,children:y,containerInfo:x,implementation:L}},Ai.createRoleSelector=function(y){return{$$typeof:yr,value:y}},Ai.createTestNameSelector=function(y){return{$$typeof:Qr,value:y}},Ai.createTextSelector=function(y){return{$$typeof:Xr,value:y}},Ai.defaultOnCaughtError=function(y){console.error(y)},Ai.defaultOnRecoverableError=function(y){sn(y)},Ai.defaultOnUncaughtError=function(y){sn(y)},Ai.deferredUpdates=function(y){var x=Zr.T,L=ma();try{return ps(32),Zr.T=null,y()}finally{ps(L),Zr.T=x}},Ai.discreteUpdates=function(y,x,L,W,ie){var be=Zr.T,ot=ma();try{return ps(2),Zr.T=null,y(x,L,W,ie)}finally{ps(ot),Zr.T=be,Dr===0&&(wo=ta()+500)}},Ai.findAllNodes=Bf,Ai.findBoundingRects=function(y,x){if(!Hd)throw Error(g(363));x=Bf(y,x),y=[];for(var L=0;L<x.length;L++)y.push(A_(x[L]));for(x=y.length-1;0<x;x--){L=y[x];for(var W=L.x,ie=W+L.width,be=L.y,ot=be+L.height,kt=x-1;0<=kt;kt--)if(x!==kt){var gn=y[kt],Yn=gn.x,or=Yn+gn.width,vr=gn.y,Er=vr+gn.height;if(W>=Yn&&be>=vr&&ie<=or&&ot<=Er){y.splice(x,1);break}else if(W!==Yn||L.width!==gn.width||Er<be||vr>ot){if(!(be!==vr||L.height!==gn.height||or<W||Yn>ie)){Yn>W&&(gn.width+=Yn-W,gn.x=W),or<ie&&(gn.width=ie-Yn),y.splice(x,1);break}}else{vr>be&&(gn.height+=vr-be,gn.y=be),Er<ot&&(gn.height=ot-vr),y.splice(x,1);break}}}return y},Ai.findHostInstance=Zf,Ai.findHostInstanceWithNoPortals=function(y){return y=r(y),y=y!==null?A(y):null,y===null?null:Qc(y.stateNode)},Ai.findHostInstanceWithWarning=function(y){return Zf(y)},Ai.flushPassiveEffects=Fd,Ai.flushSyncFromReconciler=function(y){var x=Dr;Dr|=1;var L=Zr.T,W=ma();try{if(ps(2),Zr.T=null,y)return y()}finally{ps(W),Zr.T=L,Dr=x,(Dr&6)===0&&$n(0)}},Ai.flushSyncWork=Lh,Ai.focusWithin=function(y,x){if(!Hd)throw Error(g(363));for(y=Zp(y),x=Yi(y,x),x=Array.from(x),y=0;y<x.length;){var L=x[y++],W=L.tag;if(!Uu(L)){if((W===5||W===26||W===27)&&tu(L.stateNode))return!0;for(L=L.child;L!==null;)x.push(L),L=L.sibling}}return!1},Ai.getFindAllNodesFailureDescription=function(y,x){if(!Hd)throw Error(g(363));var L=0,W=[];y=[Zp(y),0];for(var ie=0;ie<y.length;){var be=y[ie++],ot=be.tag,kt=y[ie++],gn=x[kt];if((ot!==5&&ot!==26&&ot!==27||!Uu(be))&&(kd(be,gn)&&(W.push(Yp(gn)),kt++,kt>L&&(L=kt)),kt<x.length))for(be=be.child;be!==null;)y.push(be,kt),be=be.sibling}if(L<x.length){for(y=[];L<x.length;L++)y.push(Yp(x[L]));return`findAllNodes was able to match part of the selector:
  `+(W.join(" > ")+`

No matching component was found for:
  `)+y.join(" > ")}return null},Ai.getPublicRootInstance=function(y){if(y=y.current,!y.child)return null;switch(y.child.tag){case 27:case 5:return Qc(y.child.stateNode);default:return y.child.stateNode}},Ai.injectIntoDevTools=function(){var y={bundleType:0,version:Jf,rendererPackageName:im,currentDispatcherRef:Zr,reconcilerVersion:"19.1.0"};if(Qf!==null&&(y.rendererConfig=Qf),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")y=!1;else{var x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(x.isDisabled||!x.supportsFiber)y=!0;else{try{Jd=x.inject(y),wa=x}catch{}y=!!x.checkDCE}}return y},Ai.isAlreadyRendering=function(){return(Dr&6)!==0},Ai.observeVisibleRects=function(y,x,L,W){if(!Hd)throw Error(g(363));y=Bf(y,x);var ie=dg(y,L,W).disconnect;return{disconnect:function(){ie()}}},Ai.shouldError=function(){return null},Ai.shouldSuspend=function(){return!1},Ai.startHostTransition=function(y,x,L,W){if(y.tag!==5)throw Error(g(476));var ie=$p(y).queue;Ch(y,ie,x,Vu,L===null?p:function(){var be=$p(y).next.queue;return gc(y,be,{},da()),L(W)})},Ai.updateContainer=function(y,x,L,W){var ie=x.current,be=da();return jh(ie,be,y,x,L,W),be},Ai.updateContainerSync=function(y,x,L,W){return jh(x.current,2,y,x,L,W),2},Ai},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})})(iw)),iw.exports}var G4;function OU(){return G4||(G4=1,rw.exports=kU()),rw.exports}var LU=OU();const zU=al(LU);var ow={exports:{}},uf={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $4;function FU(){return $4||($4=1,uf.ConcurrentRoot=1,uf.ContinuousEventPriority=8,uf.DefaultEventPriority=32,uf.DiscreteEventPriority=2,uf.IdleEventPriority=268435456,uf.LegacyRoot=0,uf.NoEventPriority=0),uf}var H4;function BU(){return H4||(H4=1,ow.exports=FU()),ow.exports}var eb=BU(),NU=Zi();const q4={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let W4=!1,Z4=!1;const fx=".react-konva-event",VU=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,UU=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,jU={};function tb(t,s,c=jU){if(!W4&&"zIndex"in s&&(console.warn(UU),W4=!0),!Z4&&s.draggable){var p=s.x!==void 0||s.y!==void 0,g=s.onDragEnd||s.onDragMove;p&&!g&&(console.warn(VU),Z4=!0)}for(var v in c)if(!q4[v]){var S=v.slice(0,2)==="on",r=c[v]!==s[v];if(S&&r){var E=v.substr(2).toLowerCase();E.substr(0,7)==="content"&&(E="content"+E.substr(7,1).toUpperCase()+E.substr(8)),t.off(E,c[v])}var A=!s.hasOwnProperty(v);A&&t.setAttr(v,void 0)}var I=s._useStrictMode,F={},z=!1;const R={};for(var v in s)if(!q4[v]){var S=v.slice(0,2)==="on",D=c[v]!==s[v];if(S&&D){var E=v.substr(2).toLowerCase();E.substr(0,7)==="content"&&(E="content"+E.substr(7,1).toUpperCase()+E.substr(8)),s[v]&&(R[E]=s[v])}!S&&(s[v]!==c[v]||I&&s[v]!==t.getAttr(v))&&(z=!0,F[v]=s[v])}z&&(t.setAttrs(F),Vp(t));for(var E in R)t.off(E+fx),t.on(E+fx,R[E])}function Vp(t){if(!NU.Konva.autoDrawEnabled){var s=t.getLayer()||t.getStage();s&&s.batchDraw()}}var sw=EM();const hR={},GU={};hx.Node.prototype._applyProps=tb;let fR=eb.DefaultEventPriority;function $U(t,s){if(typeof s=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${s}`);return}t.add(s),Vp(t)}function HU(t,s,c){let p=hx[t];p||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),p=hx.Group);const g={},v={};for(var S in s)if(S!=="ref"){var r=S.slice(0,2)==="on";r?v[S]=s[S]:g[S]=s[S]}const E=new p(g);return tb(E,v),E}function qU(t,s,c){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function WU(t,s,c){return!1}function ZU(t){return t}function YU(){return null}function XU(){return null}function KU(t,s,c,p){return GU}function JU(){}function QU(t){}function ej(t,s){return!1}function tj(){return hR}function nj(){return hR}const rj=setTimeout,ij=clearTimeout,oj=!0,sj=t=>{t()},aj=-1;function lj(t,s){return!1}const cj=!1,uj=!1,dj=!0,hj=!1,fj=!1;function pj(t,s){s.parent===t?s.moveToTop():t.add(s),Vp(t)}function mj(t,s){s.parent===t?s.moveToTop():t.add(s),Vp(t)}function pR(t,s,c){s._remove(),t.add(s),s.setZIndex(c.getZIndex()),Vp(t)}function gj(t,s,c){pR(t,s,c)}function _j(t,s){s.destroy(),s.off(fx),Vp(t)}function yj(t,s){s.destroy(),s.off(fx),Vp(t)}function vj(t,s,c){console.error(`Text components are not yet supported in ReactKonva. You text is: "${c}"`)}function xj(t,s,c){}function bj(t,s,c,p){tb(t,p,c)}function wj(t){t.hide(),Vp(t)}function Sj(t){}function Tj(t,s){(s.visible==null||s.visible)&&t.show()}function Cj(t,s){}function Ej(t){}function Aj(){}function Pj(){return eb.DefaultEventPriority}function Mj(){}function Ij(){return null}function Rj(t){fR=t}function Dj(){return fR}function kj(){return eb.DiscreteEventPriority}function Oj(){return!1}function Lj(){}function zj(){return!1}function Fj(){return!0}function Bj(){}function Nj(){}function Vj(){return null}const Uj=null;function jj(){}const Gj=Object.freeze(Object.defineProperty({__proto__:null,NotPendingTransition:Uj,appendChild:pj,appendChildToContainer:mj,appendInitialChild:$U,cancelTimeout:ij,clearContainer:Ej,commitMount:xj,commitTextUpdate:vj,commitUpdate:bj,createInstance:HU,createTextInstance:qU,detachDeletedInstance:Aj,finalizeInitialChildren:WU,getChildHostContext:nj,getCurrentEventPriority:Pj,getCurrentUpdatePriority:Dj,getInstanceFromScope:Ij,getPublicInstance:ZU,getRootHostContext:tj,hideInstance:wj,hideTextInstance:Sj,idlePriority:sw.unstable_IdlePriority,insertBefore:pR,insertInContainerBefore:gj,isPrimaryRenderer:cj,maySuspendCommit:zj,noTimeout:aj,now:sw.unstable_now,preloadInstance:Fj,prepareForCommit:YU,preparePortalMount:XU,prepareScopeUpdate:Mj,prepareUpdate:KU,removeChild:_j,removeChildFromContainer:yj,requestPostPaintCallback:Lj,resetAfterCommit:JU,resetFormInstance:jj,resetTextContent:QU,resolveUpdatePriority:kj,run:sw.unstable_runWithPriority,scheduleMicrotask:sj,scheduleTimeout:rj,setCurrentUpdatePriority:Rj,shouldAttemptEagerTransition:Oj,shouldDeprioritizeSubtree:ej,shouldSetTextContent:lj,startSuspendingCommit:Bj,supportsHydration:fj,supportsMicrotasks:oj,supportsMutation:dj,supportsPersistence:hj,suspendInstance:Nj,unhideInstance:Tj,unhideTextInstance:Cj,waitForCommitToBeReady:Vj,warnsIfNotActing:uj},Symbol.toStringTag,{value:"Module"}));function mR(t,s,c){if(!t)return;if(c(t)===!0)return t;let p=t.child;for(;p;){const g=mR(p,s,c);if(g)return g;p=p.sibling}}function gR(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const US=gR(Te.createContext(null));class _R extends Te.Component{render(){return Te.createElement(US.Provider,{value:this._reactInternals},this.props.children)}}function $j(){const t=Te.useContext(US);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const s=Te.useId();return Te.useMemo(()=>{for(const c of[t,t?.alternate]){if(!c)continue;const p=mR(c,!1,g=>{let v=g.memoizedState;for(;v;){if(v.memoizedState===s)return!0;v=v.next}});if(p)return p}},[t,s])}const Hj=Symbol.for("react.context"),qj=t=>t!==null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===Hj;function Wj(){const t=$j(),[s]=Te.useState(()=>new Map);s.clear();let c=t;for(;c;){const p=c.type;qj(p)&&p!==US&&!s.has(p)&&s.set(p,Te.use(gR(p))),c=c.return}return s}function Zj(){const t=Wj();return Te.useMemo(()=>Array.from(t.keys()).reduce((s,c)=>p=>Te.createElement(s,null,Te.createElement(c.Provider,{...p,value:t.get(c)})),s=>Te.createElement(_R,{...s})),[t])}if(Do.version.indexOf("19")===-1)throw new Error("react-konva version 19 is only compatible with React 19. Make sure to have the last version of react-konva and react or downgrade react-konva to version 18.");function Yj(t){const s=Do.useRef({});return Do.useLayoutEffect(()=>{s.current=t}),Do.useLayoutEffect(()=>()=>{s.current={}},[]),s.current}const Xj=()=>{const t=Do.useRef(0);return Do.useMemo(()=>{t.current++},[]),t.current>1},Kj=t=>{const s=Do.useRef(null),c=Do.useRef(null),p=Do.useRef(null),g=Yj(t),v=Zj(),S=Do.useRef(!1),r=A=>{const{forwardedRef:I}=t;I&&(typeof I=="function"?I(A):I.current=A)},E=Xj();return Do.useLayoutEffect(()=>S.current&&E?()=>{S.current=!1,r(null),Xg.updateContainer(null,p.current,null),c.current.destroy()}:(S.current=!0,c.current=new hx.Stage({width:t.width,height:t.height,container:s.current}),r(c.current),p.current=Xg.createContainer(c.current,eb.ConcurrentRoot,null,!1,null,"",console.error,console.error,console.error,null),Xg.updateContainer(Do.createElement(v,{},t.children),p.current,null,()=>{}),()=>{E||(r(null),Xg.updateContainer(null,p.current,null),c.current.destroy())}),[]),Do.useLayoutEffect(()=>{r(c.current),tb(c.current,t,g),Xg.updateContainer(Do.createElement(v,{},t.children),p.current,null)}),Do.createElement("div",{ref:s,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},yR="Layer",vR="Line",Xg=zU(Gj);Xg.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:Do.version,rendererPackageName:"react-konva"});const xR=Do.forwardRef((t,s)=>Do.createElement(_R,{},Do.createElement(Kj,{...t,forwardedRef:s}))),v_="http://34.172.63.27:5000/api/projects",Jj=async t=>{const s=await fetch(`${v_}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!s.ok){const c=await s.json();throw new Error(c.message||"Project creation failed")}return s.json()},$w=async()=>{try{const t=await fetch(`${v_}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to fetch projects")}return await t.json()}catch(t){throw console.error("Fetch user projects failed:",t),t}},Qj=async()=>{const t=await fetch(`${v_}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const p=await t.json();throw new Error(p.message||"Failed to fetch projects")}const c=(await t.json())[0];if(!c)throw new Error("No projects found for this user");return c},bR=async t=>{const s=await fetch(`${v_}/${t}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const c=await s.json();throw new Error(c.message||"Failed to fetch project")}return s.json()},eG=async(t,s)=>{const c=await fetch(`${v_}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!c.ok){const p=await c.json();throw new Error(p.message||"Failed to update project")}return c.json()},wR=async t=>{try{const s=await fetch(`${v_}/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const c=await s.json();throw new Error(c.message||`Failed to delete project with ID: ${t}`)}return s.status===204?{message:"Project deleted successfully"}:s.json()}catch(s){throw console.error("Error deleting project:",s),new Error(s.message||"An unexpected error occurred")}},Hw=(t,s=5)=>{if(t.length<4)return t;const c=[t[0],t[1]];for(let r=2;r<t.length-2;r+=2){const E=c[c.length-2],A=c[c.length-1],I=t[r],F=t[r+1];Math.sqrt((I-E)**2+(F-A)**2)>s&&c.push(I,F)}const p=c[c.length-2],g=c[c.length-1],v=t[t.length-2],S=t[t.length-1];return Math.sqrt((v-p)**2+(S-g)**2)>s/2&&c.push(v,S),c},tG=(t,s=.2)=>{if(t.length<6)return t;const c=[t[0],t[1]];for(let p=2;p<t.length-2;p+=2){const g=t[p-2],v=t[p-1],S=t[p],r=t[p+1],E=t[p+2],A=t[p+3],I=S+(g+E-2*S)*s,F=r+(v+A-2*r)*s;c.push(I,F)}return c.push(t[t.length-2],t[t.length-1]),c},nG=(t,s=8)=>{if(t.length<4)return t;const c=Hw(t,3);if(c.length<4)return c;const p=[],g=c.slice();g.unshift(c[0],c[1]),g.push(c[c.length-2],c[c.length-1]);for(let v=2;v<g.length-4;v+=2){const S={x:g[v-2],y:g[v-1]},r={x:g[v],y:g[v+1]},E={x:g[v+2],y:g[v+3]},A={x:g[v+4],y:g[v+5]};for(let I=0;I<=s;I++){const F=I/s,z=.5*((-S.x+3*r.x-3*E.x+A.x)*(F*F*F)+(2*S.x-5*r.x+4*E.x-A.x)*(F*F)+(-S.x+E.x)*F+2*r.x),R=.5*((-S.y+3*r.y-3*E.y+A.y)*(F*F*F)+(2*S.y-5*r.y+4*E.y-A.y)*(F*F)+(-S.y+E.y)*F+2*r.y);p.push(z,R)}}return Hw(p,2)},rG=(t,s)=>s.current?{type:"FeatureCollection",features:t.map(p=>{const g=p.points,v=[];for(let S=0;S<g.length;S+=2){const r=g[S],E=g[S+1],A=s.current.unproject([r,E]);v.push([A.lng,A.lat])}return{type:"Feature",geometry:{type:"LineString",coordinates:v},properties:{}}})}:(console.error("Map reference is not available!"),null),iG=(t,s,c,p)=>{p.current=!0;const g=t.target.getStage().getPointerPosition();c([...s,{points:[g.x,g.y],rawPoints:[g.x,g.y]}])},oG=(t,s,c,p)=>{if(!p.current)return;const v=t.target.getStage().getPointerPosition(),S=s[s.length-1],r=S.rawPoints.concat([v.x,v.y]),E=Hw(r,5),A=tG(E),I={...S,points:A,rawPoints:r},F=s.slice(0,-1).concat(I);c(F)},sG=async t=>{if(!t)return null;try{const s=await bR(t,{credentials:"include"});return!s||!s._id?null:s}catch(s){return console.error("Project validation failed:",s),null}},aG=(t,s,c,p)=>{const g=[];if(c){const[v,S]=s.points,r=t.unproject([v,S]);g.push({type:"Feature",geometry:{type:"Point",coordinates:[r.lng,r.lat]},properties:{text:String(p)}})}else{const[v,S]=s.points,[r,E]=s.points.slice(-2),A=t.unproject([v,S]),I=t.unproject([r,E]);g.push({type:"Feature",geometry:{type:"Point",coordinates:[A.lng,A.lat]},properties:{text:String(p)}},{type:"Feature",geometry:{type:"Point",coordinates:[I.lng,I.lat]},properties:{text:String(p)}})}return g},lG=async(t,s,c,p,g,v,S,r,E,A,I=5,F,z)=>{const R=t.current;if(!R)return;p.current=!1;const D=JSON.parse(localStorage.getItem("user")),O=localStorage.getItem("projectId"),N=localStorage.getItem("authToken"),H=F?"#19b8b7":"#000000",j=F?"#ffffff":"#19b8b7";if(s.length>0){const Ae=s.length-1,ne={...s[Ae]};ne.rawPoints?.length>=4&&(ne.points=nG(ne.rawPoints,6));const xe=[...s];xe[Ae]=ne,c(xe),s=xe}if(E&&s.length>0){const Ae=s.length-1,ne={...s[Ae]};if(ne.points.length>=4){const[xe,Ce]=ne.points;ne.points=[...ne.points,xe,Ce];const Re=[...s];Re[Ae]=ne,c(Re),s=Re}}const V=rG(s,t);if(JSON.stringify(V).length>1e5){Po.fire({icon:"info",title:"Feature Too Large",text:"This feature is too large to save. Try simplifying it."});return}const X=fS(),se=E?"WHC":"WHO",ge=`${se}_${X}`,ae=`${se}_${X}`,oe=R.getLayer("custom-points-layer")?"custom-points-layer":void 0;let fe="",pe="";const K=()=>{try{R.getLayer(fe)&&R.removeLayer(fe),R.getSource(pe)&&R.removeSource(pe),R.getLayer(ae)&&R.removeLayer(ae),R.getSource(ge)&&R.removeSource(ge),R.getStyle().layers.filter(Ae=>Ae.id.startsWith(se+"_")).forEach(Ae=>{try{R.removeLayer(Ae.id)}catch{}}),Object.keys(R.getStyle().sources).filter(Ae=>Ae.startsWith(se+"_")).forEach(Ae=>{try{R.removeSource(Ae)}catch{}})}catch(Ae){console.warn("cleanupMapArtifacts error:",Ae)}};if(R.addSource(ge,{type:"geojson",data:V,lineMetrics:!0}),R.addLayer({id:ae,type:"line",source:ge,layout:{"line-join":"round","line-cap":"round"},slot:"top",paint:{"line-color":H,"line-opacity":.5,"line-width":3,"line-dasharray":parseFloat(I)<2?[.5,.5]:[],"line-blur":.5}},oe),s.length>0&&s.at(-1).points.length>=4){const Ae=aG(R,s.at(-1),E,I);pe=`${ge}-0`,fe=`${ge}-0`,R.getLayer(fe)&&R.removeLayer(fe),R.getSource(pe)&&R.removeSource(pe),R.addSource(pe,{type:"geojson",data:{type:"FeatureCollection",features:Ae}}),R.addLayer({id:fe,type:"symbol",source:pe,slot:"top",layout:{"text-field":["get","text"],"text-size":18,"text-anchor":"bottom","text-offset":[0,.5]},paint:{"text-color":j,"text-halo-width":2,"text-halo-color":F?"#19b8b7":"#ffffff"}},oe)}if(R.getLayer("custom-points-layer"))try{R.moveLayer("custom-points-layer")}catch(Ae){console.warn("Could not move custom-points-layer:",Ae)}if(!await sG(O)){Po.fire({icon:"warning",title:"No Project Selected",text:"Please create or select a valid project before saving features."}).then(Ae=>{K(),c([])});return}const J="Wave Height Layer";let de=J;if(typeof S?.current=="function"&&S.current(Ae=>{const ne=Ae.map(Ce=>Ce.name);let xe=1;for(;ne.includes(de);)de=`${J} ${xe++}`;return Ae}),de||(de=`${J} ${X.slice(0,6)}`),V.features.length>0){const Ae=V.features[0];try{await r({geometry:Ae.geometry,properties:{labelValue:I,closedMode:E,isFront:!1,owner:D?.id,project:O},name:de,sourceId:ge},N),typeof S?.current=="function"&&S.current(ne=>{let xe=de;const Ce=ne.map(Re=>Re.name);if(Ce.includes(xe)){let Re=1;for(;Ce.includes(`${xe} ${Re}`);)Re++;xe=`${xe} ${Re}`}return[...ne,{id:ae,sourceID:ge,name:xe,visible:!0,locked:!1}]})}catch(ne){console.error("Error saving feature:",ne),Po.fire({icon:"error",title:"Save Failed",text:"Could not save feature. The visual layers will be removed."}),K()}}c([])};function _i(t,s){if(t==null)return{};var c={};for(var p in t)if({}.hasOwnProperty.call(t,p)){if(s.indexOf(p)!==-1)continue;c[p]=t[p]}return c}const cG=t=>({components:{MuiLocalizationProvider:{defaultProps:{localeText:Nt({},t)}}}}),SR={previousMonth:"Previous month",nextMonth:"Next month",openPreviousView:"Open previous view",openNextView:"Open next view",calendarViewSwitchingButtonAriaLabel:t=>t==="year"?"year view is open, switch to calendar view":"calendar view is open, switch to year view",start:"Start",end:"End",startDate:"Start date",startTime:"Start time",endDate:"End date",endTime:"End time",cancelButtonLabel:"Cancel",clearButtonLabel:"Clear",okButtonLabel:"OK",todayButtonLabel:"Today",nextStepButtonLabel:"Next",datePickerToolbarTitle:"Select date",dateTimePickerToolbarTitle:"Select date & time",timePickerToolbarTitle:"Select time",dateRangePickerToolbarTitle:"Select date range",timeRangePickerToolbarTitle:"Select time range",clockLabelText:(t,s)=>`Select ${t}. ${s?`Selected time is ${s}`:"No time selected"}`,hoursClockNumberText:t=>`${t} hours`,minutesClockNumberText:t=>`${t} minutes`,secondsClockNumberText:t=>`${t} seconds`,selectViewText:t=>`Select ${t}`,calendarWeekNumberHeaderLabel:"Week number",calendarWeekNumberHeaderText:"#",calendarWeekNumberAriaLabelText:t=>`Week ${t}`,calendarWeekNumberText:t=>`${t}`,openDatePickerDialogue:t=>t?`Choose date, selected date is ${t}`:"Choose date",openTimePickerDialogue:t=>t?`Choose time, selected time is ${t}`:"Choose time",openRangePickerDialogue:t=>t?`Choose range, selected range is ${t}`:"Choose range",fieldClearLabel:"Clear",timeTableLabel:"pick time",dateTableLabel:"pick date",fieldYearPlaceholder:t=>"Y".repeat(t.digitAmount),fieldMonthPlaceholder:t=>t.contentType==="letter"?"MMMM":"MM",fieldDayPlaceholder:()=>"DD",fieldWeekDayPlaceholder:t=>t.contentType==="letter"?"EEEE":"EE",fieldHoursPlaceholder:()=>"hh",fieldMinutesPlaceholder:()=>"mm",fieldSecondsPlaceholder:()=>"ss",fieldMeridiemPlaceholder:()=>"aa",year:"Year",month:"Month",day:"Day",weekDay:"Week day",hours:"Hours",minutes:"Minutes",seconds:"Seconds",meridiem:"Meridiem",empty:"Empty"},uG=SR;cG(SR);const dG=["localeText"],qw=Te.createContext(null),jS=function(s){const{localeText:c}=s,p=_i(s,dG),{adapter:g,localeText:v}=Te.useContext(qw)??{adapter:void 0,localeText:void 0},S=_s({props:p,name:"MuiLocalizationProvider"}),{children:r,dateAdapter:E,dateFormats:A,dateLibInstance:I,adapterLocale:F,localeText:z}=S,R=Te.useMemo(()=>Nt({},z,v,c),[z,v,c]),D=Te.useMemo(()=>{if(!E)return g||null;const H=new E({locale:F,formats:A,instance:I});if(!H.isMUIAdapter)throw new Error(["MUI X: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/quickstart/#installation"].join(`
`));return H},[E,F,A,I,g]),O=Te.useMemo(()=>D?{minDate:D.date("1900-01-01T00:00:00.000"),maxDate:D.date("2099-12-31T00:00:00.000")}:null,[D]),N=Te.useMemo(()=>({utils:D,adapter:D,defaultDates:O,localeText:R}),[O,D,R]);return ue.jsx(qw.Provider,{value:N,children:r})},GS=()=>{const t=Te.useContext(qw);if(t===null)throw new Error(["MUI X: Can not find the date and time pickers localization context.","It looks like you forgot to wrap your component in LocalizationProvider.","This can also happen if you are bundling multiple versions of the `@mui/x-date-pickers` package"].join(`
`));if(t.adapter===null)throw new Error(["MUI X: Can not find the date and time pickers adapter from its localization context.","It looks like you forgot to pass a `dateAdapter` to your LocalizationProvider."].join(`
`));const s=Te.useMemo(()=>Nt({},uG,t.localeText),[t.localeText]);return Te.useMemo(()=>Nt({},t,{localeText:s}),[t,s])},Ko=()=>GS().adapter,Up=()=>GS().localeText,Ww=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],Zw=["disablePast","disableFuture","minTime","maxTime","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],TR=["minDateTime","maxDateTime"],hG=[...Ww,...Zw,...TR],CR=t=>hG.reduce((s,c)=>(t.hasOwnProperty(c)&&(s[c]=t[c]),s),{}),fG=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef","unstableStartFieldRef","unstableEndFieldRef","enableAccessibleFieldDOMStructure","disabled","readOnly","dateSeparator","autoFocus","focused"],ER=(t,s)=>Te.useMemo(()=>{const c=Nt({},t),p={},g=v=>{c.hasOwnProperty(v)&&(p[v]=c[v],delete c[v])};return fG.forEach(g),s==="date"?Ww.forEach(g):s==="time"?Zw.forEach(g):s==="date-time"&&(Ww.forEach(g),Zw.forEach(g),TR.forEach(g)),{forwardedProps:c,internalProps:p}},[t,s]),ly=(t,s)=>t.length!==s.length?!1:s.every(c=>t.includes(c)),pG=({openTo:t,defaultOpenTo:s,views:c,defaultViews:p})=>{const g=c??p;let v;if(t!=null)v=t;else if(g.includes(s))v=s;else if(g.length>0)v=g[0];else throw new Error("MUI X: The `views` prop must contain at least one view.");return{views:g,openTo:v}},px=(t,s,c)=>{let p=s;return p=t.setHours(p,t.getHours(c)),p=t.setMinutes(p,t.getMinutes(c)),p=t.setSeconds(p,t.getSeconds(c)),p=t.setMilliseconds(p,t.getMilliseconds(c)),p},Vy=({date:t,disableFuture:s,disablePast:c,maxDate:p,minDate:g,isDateDisabled:v,adapter:S,timezone:r})=>{const E=px(S,S.date(void 0,r),t);c&&S.isBefore(g,E)&&(g=E),s&&S.isAfter(p,E)&&(p=E);let A=t,I=t;for(S.isBefore(t,g)&&(A=g,I=null),S.isAfter(t,p)&&(I&&(I=p),A=null);A||I;){if(A&&S.isAfter(A,p)&&(A=null),I&&S.isBefore(I,g)&&(I=null),A){if(!v(A))return A;A=S.addDays(A,1)}if(I){if(!v(I))return I;I=S.addDays(I,-1)}}return null},mG=(t,s)=>t.isValid(s)?s:null,Y4=(t,s,c)=>s==null||!t.isValid(s)?c:s,gG=(t,s,c)=>!t.isValid(s)&&s!=null&&!t.isValid(c)&&c!=null?!0:t.isEqual(s,c),$S=(t,s)=>{const p=[t.startOfYear(s)];for(;p.length<12;){const g=p[p.length-1];p.push(t.addMonths(g,1))}return p},AR=(t,s,c)=>c==="date"?t.startOfDay(t.date(void 0,s)):t.date(void 0,s),_G=["year","month","day"],X4=t=>_G.includes(t),HS=(t,{format:s,views:c},p)=>{if(s!=null)return s;const g=t.formats;return ly(c,["year"])?g.year:ly(c,["month"])?g.month:ly(c,["day"])?g.dayOfMonth:ly(c,["month","year"])?`${g.month} ${g.year}`:ly(c,["day","month"])?`${g.month} ${g.dayOfMonth}`:p?/en/.test(t.getCurrentLocaleCode())?g.normalDateWithWeekday:g.normalDate:g.keyboardDate},yG=(t,s)=>{const c=t.startOfWeek(s);return[0,1,2,3,4,5,6].map(p=>t.addDays(c,p))},PR=(t,s)=>{const c=t.formatTokenMap[s];if(c==null)throw new Error([`MUI X: The token "${s}" is not supported by the Date and Time Pickers.`,"Please try using another token or open an issue on https://github.com/mui/mui-x/issues/new/choose if you think it should be supported."].join(`
`));return typeof c=="string"?{type:c,contentType:c==="meridiem"?"letter":"digit",maxLength:void 0}:{type:c.sectionType,contentType:c.contentType,maxLength:c.maxLength}},nb=(t,s)=>{const c=[],p=t.date(void 0,"default"),g=t.startOfWeek(p),v=t.endOfWeek(p);let S=g;for(;t.isBefore(S,v);)c.push(S),S=t.addDays(S,1);return c.map(r=>t.formatByString(r,s))},MR=(t,s,c,p)=>{switch(c){case"month":return $S(t,t.date(void 0,s)).map(g=>t.formatByString(g,p));case"weekDay":return nb(t,p);case"meridiem":{const g=t.date(void 0,s);return[t.startOfDay(g),t.endOfDay(g)].map(v=>t.formatByString(v,p))}default:return[]}},K4="s",vG=["0","1","2","3","4","5","6","7","8","9"],xG=t=>{const s=t.date(void 0);return t.formatByString(t.setSeconds(s,0),K4)==="0"?vG:Array.from({length:10}).map((p,g)=>t.formatByString(t.setSeconds(s,g),K4))},Zm=(t,s)=>{if(s[0]==="0")return t;const c=[];let p="";for(let g=0;g<t.length;g+=1){p+=t[g];const v=s.indexOf(p);v>-1&&(c.push(v.toString()),p="")}return c.join("")},qS=(t,s)=>s[0]==="0"?t:t.split("").map(c=>s[Number(c)]).join(""),J4=(t,s)=>{const c=Zm(t,s);return c!==" "&&!Number.isNaN(Number(c))},WS=(t,s)=>Number(t).toString().padStart(s,"0"),IR=(t,s,c,p,g)=>{if(g.type==="day"&&g.contentType==="digit-with-letter"){const S=t.setDate(c.longestMonth,s);return t.formatByString(S,g.format)}let v=s.toString();return g.hasLeadingZerosInInput&&(v=WS(v,g.maxLength)),qS(v,p)},ZS=(t,s,c)=>{let p=t.value||t.placeholder;const g=s==="non-input"?t.hasLeadingZerosInFormat:t.hasLeadingZerosInInput;return s==="non-input"&&t.hasLeadingZerosInInput&&!t.hasLeadingZerosInFormat&&(p=Number(Zm(p,c)).toString()),["input-rtl","input-ltr"].includes(s)&&t.contentType==="digit"&&!g&&p.length===1&&(p=`${p}`),s==="input-rtl"&&(p=`${p}`),p},Q4=(t,s,c,p)=>t.formatByString(t.parse(s,c),p),bG=(t,s)=>t.formatByString(t.date(void 0,"system"),s).length===4,RR=(t,s,c,p)=>{if(s!=="digit")return!1;const g=t.date(void 0,"default");switch(c){case"year":return t.lib==="dayjs"&&p==="YY"?!0:t.formatByString(t.setYear(g,1),p).startsWith("0");case"month":return t.formatByString(t.startOfYear(g),p).length>1;case"day":return t.formatByString(t.startOfMonth(g),p).length>1;case"weekDay":return t.formatByString(t.startOfWeek(g),p).length>1;case"hours":return t.formatByString(t.setHours(g,1),p).length>1;case"minutes":return t.formatByString(t.setMinutes(g,1),p).length>1;case"seconds":return t.formatByString(t.setSeconds(g,1),p).length>1;default:throw new Error("Invalid section type")}},wG=(t,s,c)=>{const p=s.some(E=>E.type==="day"),g=[],v=[];for(let E=0;E<s.length;E+=1){const A=s[E];p&&A.type==="weekDay"||(g.push(A.format),v.push(ZS(A,"non-input",c)))}const S=g.join(" "),r=v.join(" ");return t.parse(r,S)},SG=t=>t.map(s=>`${s.startSeparator}${s.value||s.placeholder}${s.endSeparator}`).join(""),TG=(t,s,c)=>{const g=t.map(v=>{const S=ZS(v,c?"input-rtl":"input-ltr",s);return`${v.startSeparator}${S}${v.endSeparator}`}).join("");return c?`${g}`:g},CG=(t,s,c)=>{const p=t.date(void 0,c),g=t.endOfYear(p),v=t.endOfDay(p),{maxDaysInMonth:S,longestMonth:r}=$S(t,p).reduce((E,A)=>{const I=t.getDaysInMonth(A);return I>E.maxDaysInMonth?{maxDaysInMonth:I,longestMonth:A}:E},{maxDaysInMonth:0,longestMonth:null});return{year:({format:E})=>({minimum:0,maximum:bG(t,E)?9999:99}),month:()=>({minimum:1,maximum:t.getMonth(g)+1}),day:({currentDate:E})=>({minimum:1,maximum:t.isValid(E)?t.getDaysInMonth(E):S,longestMonth:r}),weekDay:({format:E,contentType:A})=>{if(A==="digit"){const I=nb(t,E).map(Number);return{minimum:Math.min(...I),maximum:Math.max(...I)}}return{minimum:1,maximum:7}},hours:({format:E})=>{const A=t.getHours(v);return Zm(t.formatByString(t.endOfDay(p),E),s)!==A.toString()?{minimum:1,maximum:Number(Zm(t.formatByString(t.startOfDay(p),E),s))}:{minimum:0,maximum:A}},minutes:()=>({minimum:0,maximum:t.getMinutes(v)}),seconds:()=>({minimum:0,maximum:t.getSeconds(v)}),meridiem:()=>({minimum:0,maximum:1}),empty:()=>({minimum:0,maximum:0})}},EG=(t,s,c,p)=>{switch(s.type){case"year":return t.setYear(p,t.getYear(c));case"month":return t.setMonth(p,t.getMonth(c));case"weekDay":{let g=t.formatByString(c,s.format);s.hasLeadingZerosInInput&&(g=WS(g,s.maxLength));const v=nb(t,s.format),S=v.indexOf(g),E=v.indexOf(s.value)-S;return t.addDays(c,E)}case"day":return t.setDate(p,t.getDate(c));case"meridiem":{const g=t.getHours(c)<12,v=t.getHours(p);return g&&v>=12?t.addHours(p,-12):!g&&v<12?t.addHours(p,12):p}case"hours":return t.setHours(p,t.getHours(c));case"minutes":return t.setMinutes(p,t.getMinutes(c));case"seconds":return t.setSeconds(p,t.getSeconds(c));default:return p}},eP={year:1,month:2,day:3,weekDay:4,hours:5,minutes:6,seconds:7,meridiem:8,empty:9},tP=(t,s,c,p,g)=>[...c].sort((v,S)=>eP[v.type]-eP[S.type]).reduce((v,S)=>!g||S.modified?EG(t,S,s,v):v,p),AG=()=>navigator.userAgent.toLowerCase().includes("android"),PG=(t,s)=>{const c={};if(!s)return t.forEach((E,A)=>{const I=A===0?null:A-1,F=A===t.length-1?null:A+1;c[A]={leftIndex:I,rightIndex:F}}),{neighbors:c,startIndex:0,endIndex:t.length-1};const p={},g={};let v=0,S=0,r=t.length-1;for(;r>=0;){S=t.findIndex((E,A)=>A>=v&&E.endSeparator?.includes(" ")&&E.endSeparator!==" / "),S===-1&&(S=t.length-1);for(let E=S;E>=v;E-=1)g[E]=r,p[r]=E,r-=1;v=S+1}return t.forEach((E,A)=>{const I=g[A],F=I===0?null:p[I-1],z=I===t.length-1?null:p[I+1];c[A]={leftIndex:F,rightIndex:z}}),{neighbors:c,startIndex:p[0],endIndex:p[t.length-1]}},Yw=(t,s)=>{if(t==null)return null;if(t==="all")return"all";if(typeof t=="string"){const c=s.findIndex(p=>p.type===t);return c===-1?null:c}return t},MG=({adapter:t,format:s})=>{let c=10,p=s,g=t.expandFormat(s);for(;g!==p;)if(p=g,g=t.expandFormat(p),c-=1,c<0)throw new Error("MUI X: The format expansion seems to be in an infinite loop. Please open an issue with the format passed to the component.");return g},IG=({adapter:t,expandedFormat:s})=>{const c=[],{start:p,end:g}=t.escapedCharacters,v=new RegExp(`(\\${p}[^\\${g}]*\\${g})+`,"g");let S=null;for(;S=v.exec(s);)c.push({start:S.index,end:v.lastIndex-1});return c},RG=(t,s,c,p)=>{switch(c.type){case"year":return s.fieldYearPlaceholder({digitAmount:t.formatByString(t.date(void 0,"default"),p).length,format:p});case"month":return s.fieldMonthPlaceholder({contentType:c.contentType,format:p});case"day":return s.fieldDayPlaceholder({format:p});case"weekDay":return s.fieldWeekDayPlaceholder({contentType:c.contentType,format:p});case"hours":return s.fieldHoursPlaceholder({format:p});case"minutes":return s.fieldMinutesPlaceholder({format:p});case"seconds":return s.fieldSecondsPlaceholder({format:p});case"meridiem":return s.fieldMeridiemPlaceholder({format:p});default:return p}},DG=({adapter:t,date:s,shouldRespectLeadingZeros:c,localeText:p,localizedDigits:g,now:v,token:S,startSeparator:r})=>{if(S==="")throw new Error("MUI X: Should not call `commitToken` with an empty token");const E=PR(t,S),A=RR(t,E.contentType,E.type,S),I=c?A:E.contentType==="digit",F=t.isValid(s);let z=F?t.formatByString(s,S):"",R=null;if(I)if(A)R=z===""?t.formatByString(v,S).length:z.length;else{if(E.maxLength==null)throw new Error(`MUI X: The token ${S} should have a 'maxLength' property on it's adapter`);R=E.maxLength,F&&(z=qS(WS(Zm(z,g),R),g))}return Nt({},E,{format:S,maxLength:R,value:z,placeholder:RG(t,p,E,S),hasLeadingZerosInFormat:A,hasLeadingZerosInInput:I,startSeparator:r,endSeparator:"",modified:!1})},kG=t=>{const{adapter:s,expandedFormat:c,escapedParts:p}=t,g=s.date(void 0),v=[];let S="";const r=Object.keys(s.formatTokenMap).sort((R,D)=>D.length-R.length),E=/^([a-zA-Z]+)/,A=new RegExp(`^(${r.join("|")})*$`),I=new RegExp(`^(${r.join("|")})`),F=R=>p.find(D=>D.start<=R&&D.end>=R);let z=0;for(;z<c.length;){const R=F(z),D=R!=null,O=E.exec(c.slice(z))?.[1];if(!D&&O!=null&&A.test(O)){let N=O;for(;N.length>0;){const H=I.exec(N)[1];N=N.slice(H.length),v.push(DG(Nt({},t,{now:g,token:H,startSeparator:S}))),S=""}z+=O.length}else{const N=c[z];D&&R?.start===z||R?.end===z||(v.length===0?S+=N:(v[v.length-1].endSeparator+=N,v[v.length-1].isEndFormatSeparator=!0)),z+=1}}return v.length===0&&S.length>0&&v.push({type:"empty",contentType:"letter",maxLength:null,format:"",value:"",placeholder:"",hasLeadingZerosInFormat:!1,hasLeadingZerosInInput:!1,startSeparator:S,endSeparator:"",modified:!1}),v},OG=({isRtl:t,formatDensity:s,sections:c})=>c.map(p=>{const g=v=>{let S=v;return t&&S!==null&&S.includes(" ")&&(S=`${S}`),s==="spacious"&&["/",".","-"].includes(S)&&(S=` ${S} `),S};return p.startSeparator=g(p.startSeparator),p.endSeparator=g(p.endSeparator),p}),nP=t=>{let s=MG(t);t.isRtl&&t.enableAccessibleFieldDOMStructure&&(s=s.split(" ").reverse().join(" "));const c=IG(Nt({},t,{expandedFormat:s})),p=kG(Nt({},t,{expandedFormat:s,escapedParts:c}));return OG(Nt({},t,{sections:p}))},YS=Te.createContext(null),x_=()=>{const t=Te.useContext(YS);if(t==null)throw new Error("MUI X: The `usePickerContext` hook can only be called inside the context of a Picker component");return t},XS=()=>Te.useContext(YS),DR=Te.createContext(()=>!0);function LG(){return Te.useContext(DR)}const kR=Te.createContext(null);function OR(){return Te.useContext(kR)}const LR=Te.createContext(null),zR=Te.createContext({ownerState:{isPickerDisabled:!1,isPickerReadOnly:!1,isPickerValueEmpty:!1,isPickerOpen:!1,pickerVariant:"desktop",pickerOrientation:"portrait"},rootRefObject:{current:null},labelId:void 0,dismissViews:()=>{},hasUIView:!0,getCurrentViewMode:()=>"UI",triggerElement:null,viewContainerRole:null,defaultActionBarActions:[],onPopperExited:void 0});function FR(t){const{contextValue:s,actionsContextValue:c,privateContextValue:p,fieldPrivateContextValue:g,isValidContextValue:v,localeText:S,children:r}=t;return ue.jsx(YS.Provider,{value:s,children:ue.jsx(LR.Provider,{value:c,children:ue.jsx(zR.Provider,{value:p,children:ue.jsx(kR.Provider,{value:g,children:ue.jsx(DR.Provider,{value:v,children:ue.jsx(jS,{localeText:S,children:r})})})})})})}const zG=()=>{const t=Te.useContext(LR);if(t==null)throw new Error(["MUI X: The `usePickerActionsContext` can only be called in fields that are used as a slot of a Picker component"].join(`
`));return t},FG=()=>GS().defaultDates,rb=t=>{const s=Ko(),c=Te.useRef(void 0);return c.current===void 0&&(c.current=s.date(void 0,t)),c.current};function BG(t){return ui("MuiTypography",t)}oi("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const NG={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},VG=MV(),UG=t=>{const{align:s,gutterBottom:c,noWrap:p,paragraph:g,variant:v,classes:S}=t,r={root:["root",v,t.align!=="inherit"&&`align${ar(s)}`,c&&"gutterBottom",p&&"noWrap",g&&"paragraph"]};return ti(r,BG,S)},jG=Cn("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.variant&&s[c.variant],c.align!=="inherit"&&s[`align${ar(c.align)}`],c.noWrap&&s.noWrap,c.gutterBottom&&s.gutterBottom,c.paragraph&&s.paragraph]}})(_o(({theme:t})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([s,c])=>s!=="inherit"&&c&&typeof c=="object").map(([s,c])=>({props:{variant:s},style:c})),...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{color:(t.vars||t).palette[s].main}})),...Object.entries(t.palette?.text||{}).filter(([,s])=>typeof s=="string").map(([s])=>({props:{color:`text${ar(s)}`},style:{color:(t.vars||t).palette.text[s]}})),{props:({ownerState:s})=>s.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:s})=>s.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:s})=>s.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:s})=>s.paragraph,style:{marginBottom:16}}]}))),rP={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Jm=Te.forwardRef(function(s,c){const{color:p,...g}=To({props:s,name:"MuiTypography"}),v=!NG[p],S=VG({...g,...v&&{color:p}}),{align:r="inherit",className:E,component:A,gutterBottom:I=!1,noWrap:F=!1,paragraph:z=!1,variant:R="body1",variantMapping:D=rP,...O}=S,N={...S,align:r,color:p,className:E,component:A,gutterBottom:I,noWrap:F,paragraph:z,variant:R,variantMapping:D},H=A||(z?"p":D[R]||rP[R])||"span",j=UG(N);return ue.jsx(jG,{as:H,ref:c,className:Ar(j.root,E),...O,ownerState:N,style:{...r!=="inherit"&&{"--Typography-textAlign":r},...O.style}})});function iP(...t){return t.reduce((s,c)=>c==null?s:function(...g){s.apply(this,g),c.apply(this,g)},()=>{})}function GG(t){return ui("MuiSvgIcon",t)}oi("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const $G=t=>{const{color:s,fontSize:c,classes:p}=t,g={root:["root",s!=="inherit"&&`color${ar(s)}`,`fontSize${ar(c)}`]};return ti(g,GG,p)},HG=Cn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.color!=="inherit"&&s[`color${ar(c.color)}`],s[`fontSize${ar(c.fontSize)}`]]}})(_o(({theme:t})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:t.transitions?.create?.("fill",{duration:(t.vars??t).transitions?.duration?.shorter}),variants:[{props:s=>!s.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:t.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:t.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:t.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,s])=>s&&s.main).map(([s])=>({props:{color:s},style:{color:(t.vars??t).palette?.[s]?.main}})),{props:{color:"action"},style:{color:(t.vars??t).palette?.action?.active}},{props:{color:"disabled"},style:{color:(t.vars??t).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),Xw=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiSvgIcon"}),{children:g,className:v,color:S="inherit",component:r="svg",fontSize:E="medium",htmlColor:A,inheritViewBox:I=!1,titleAccess:F,viewBox:z="0 0 24 24",...R}=p,D=Te.isValidElement(g)&&g.type==="svg",O={...p,color:S,component:r,fontSize:E,instanceFontSize:s.fontSize,inheritViewBox:I,viewBox:z,hasSvgAsChild:D},N={};I||(N.viewBox=z);const H=$G(O);return ue.jsxs(HG,{as:r,className:Ar(H.root,v),focusable:"false",color:A,"aria-hidden":F?void 0:!0,role:F?"img":void 0,ref:c,...N,...R,...D&&g.props,ownerState:O,children:[D?g.props.children:g,F?ue.jsx("title",{children:F}):null]})});Xw.muiName="SvgIcon";function xh(t,s){function c(p,g){return ue.jsx(Xw,{"data-testid":void 0,ref:g,...p,children:t})}return c.muiName=Xw.muiName,Te.memo(Te.forwardRef(c))}function BR(t,s=166){let c;function p(...g){const v=()=>{t.apply(this,g)};clearTimeout(c),c=setTimeout(v,s)}return p.clear=()=>{clearTimeout(c)},p}function gf(t){return As(t).defaultView||window}function oP(t,s){typeof t=="function"?t(s):t&&(t.current=s)}function qG(t,s){const c=t.charCodeAt(2);return t[0]==="o"&&t[1]==="n"&&c>=65&&c<=90&&typeof s=="function"}function WG(t,s){if(!t)return s;function c(S,r){const E={};return Object.keys(r).forEach(A=>{qG(A,r[A])&&typeof S[A]=="function"&&(E[A]=(...I)=>{S[A](...I),r[A](...I)})}),E}if(typeof t=="function"||typeof s=="function")return S=>{const r=typeof s=="function"?s(S):s,E=typeof t=="function"?t({...S,...r}):t,A=Ar(S?.className,r?.className,E?.className),I=c(E,r);return{...r,...E,...I,...!!A&&{className:A},...r?.style&&E?.style&&{style:{...r.style,...E.style}},...r?.sx&&E?.sx&&{sx:[...Array.isArray(r.sx)?r.sx:[r.sx],...Array.isArray(E.sx)?E.sx:[E.sx]]}}};const p=s,g=c(t,p),v=Ar(p?.className,t?.className);return{...s,...t,...g,...!!v&&{className:v},...p?.style&&t?.style&&{style:{...p.style,...t.style}},...p?.sx&&t?.sx&&{sx:[...Array.isArray(p.sx)?p.sx:[p.sx],...Array.isArray(t.sx)?t.sx:[t.sx]]}}}const NR=Tn.oneOfType([Tn.func,Tn.object]),sP={};function VR(t,s){const c=Te.useRef(sP);return c.current===sP&&(c.current=t(s)),c}class mx{static create(){return new mx}static use(){const s=VR(mx.create).current,[c,p]=Te.useState(!1);return s.shouldMount=c,s.setShouldMount=p,Te.useEffect(s.mountEffect,[c]),s}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=YG(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...s){this.mount().then(()=>this.ref.current?.start(...s))}stop(...s){this.mount().then(()=>this.ref.current?.stop(...s))}pulsate(...s){this.mount().then(()=>this.ref.current?.pulsate(...s))}}function ZG(){return mx.use()}function YG(){let t,s;const c=new Promise((p,g)=>{t=p,s=g});return c.resolve=t,c.reject=s,c}function Kw(t,s){return Kw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,p){return c.__proto__=p,c},Kw(t,s)}function KS(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,Kw(t,s)}function XG(t,s){return t.classList?!!s&&t.classList.contains(s):(" "+(t.className.baseVal||t.className)+" ").indexOf(" "+s+" ")!==-1}function KG(t,s){t.classList?t.classList.add(s):XG(t,s)||(typeof t.className=="string"?t.className=t.className+" "+s:t.setAttribute("class",(t.className&&t.className.baseVal||"")+" "+s))}function aP(t,s){return t.replace(new RegExp("(^|\\s)"+s+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function JG(t,s){t.classList?t.classList.remove(s):typeof t.className=="string"?t.className=aP(t.className,s):t.setAttribute("class",aP(t.className&&t.className.baseVal||"",s))}const lP={disabled:!1},gx=Do.createContext(null);var UR=function(s){return s.scrollTop},wy="unmounted",Bm="exited",Nm="entering",Kg="entered",Jw="exiting",fd=(function(t){KS(s,t);function s(p,g){var v;v=t.call(this,p,g)||this;var S=g,r=S&&!S.isMounting?p.enter:p.appear,E;return v.appearStatus=null,p.in?r?(E=Bm,v.appearStatus=Nm):E=Kg:p.unmountOnExit||p.mountOnEnter?E=wy:E=Bm,v.state={status:E},v.nextCallback=null,v}s.getDerivedStateFromProps=function(g,v){var S=g.in;return S&&v.status===wy?{status:Bm}:null};var c=s.prototype;return c.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},c.componentDidUpdate=function(g){var v=null;if(g!==this.props){var S=this.state.status;this.props.in?S!==Nm&&S!==Kg&&(v=Nm):(S===Nm||S===Kg)&&(v=Jw)}this.updateStatus(!1,v)},c.componentWillUnmount=function(){this.cancelNextCallback()},c.getTimeouts=function(){var g=this.props.timeout,v,S,r;return v=S=r=g,g!=null&&typeof g!="number"&&(v=g.exit,S=g.enter,r=g.appear!==void 0?g.appear:S),{exit:v,enter:S,appear:r}},c.updateStatus=function(g,v){if(g===void 0&&(g=!1),v!==null)if(this.cancelNextCallback(),v===Nm){if(this.props.unmountOnExit||this.props.mountOnEnter){var S=this.props.nodeRef?this.props.nodeRef.current:i1.findDOMNode(this);S&&UR(S)}this.performEnter(g)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Bm&&this.setState({status:wy})},c.performEnter=function(g){var v=this,S=this.props.enter,r=this.context?this.context.isMounting:g,E=this.props.nodeRef?[r]:[i1.findDOMNode(this),r],A=E[0],I=E[1],F=this.getTimeouts(),z=r?F.appear:F.enter;if(!g&&!S||lP.disabled){this.safeSetState({status:Kg},function(){v.props.onEntered(A)});return}this.props.onEnter(A,I),this.safeSetState({status:Nm},function(){v.props.onEntering(A,I),v.onTransitionEnd(z,function(){v.safeSetState({status:Kg},function(){v.props.onEntered(A,I)})})})},c.performExit=function(){var g=this,v=this.props.exit,S=this.getTimeouts(),r=this.props.nodeRef?void 0:i1.findDOMNode(this);if(!v||lP.disabled){this.safeSetState({status:Bm},function(){g.props.onExited(r)});return}this.props.onExit(r),this.safeSetState({status:Jw},function(){g.props.onExiting(r),g.onTransitionEnd(S.exit,function(){g.safeSetState({status:Bm},function(){g.props.onExited(r)})})})},c.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},c.safeSetState=function(g,v){v=this.setNextCallback(v),this.setState(g,v)},c.setNextCallback=function(g){var v=this,S=!0;return this.nextCallback=function(r){S&&(S=!1,v.nextCallback=null,g(r))},this.nextCallback.cancel=function(){S=!1},this.nextCallback},c.onTransitionEnd=function(g,v){this.setNextCallback(v);var S=this.props.nodeRef?this.props.nodeRef.current:i1.findDOMNode(this),r=g==null&&!this.props.addEndListener;if(!S||r){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var E=this.props.nodeRef?[this.nextCallback]:[S,this.nextCallback],A=E[0],I=E[1];this.props.addEndListener(A,I)}g!=null&&setTimeout(this.nextCallback,g)},c.render=function(){var g=this.state.status;if(g===wy)return null;var v=this.props,S=v.children;v.in,v.mountOnEnter,v.unmountOnExit,v.appear,v.enter,v.exit,v.timeout,v.addEndListener,v.onEnter,v.onEntering,v.onEntered,v.onExit,v.onExiting,v.onExited,v.nodeRef;var r=_i(v,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Do.createElement(gx.Provider,{value:null},typeof S=="function"?S(g,r):Do.cloneElement(Do.Children.only(S),r))},s})(Do.Component);fd.contextType=gx;fd.propTypes={};function qg(){}fd.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:qg,onEntering:qg,onEntered:qg,onExit:qg,onExiting:qg,onExited:qg};fd.UNMOUNTED=wy;fd.EXITED=Bm;fd.ENTERING=Nm;fd.ENTERED=Kg;fd.EXITING=Jw;var QG=function(s,c){return s&&c&&c.split(" ").forEach(function(p){return KG(s,p)})},aw=function(s,c){return s&&c&&c.split(" ").forEach(function(p){return JG(s,p)})},JS=(function(t){KS(s,t);function s(){for(var p,g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return p=t.call.apply(t,[this].concat(v))||this,p.appliedClasses={appear:{},enter:{},exit:{}},p.onEnter=function(r,E){var A=p.resolveArguments(r,E),I=A[0],F=A[1];p.removeClasses(I,"exit"),p.addClass(I,F?"appear":"enter","base"),p.props.onEnter&&p.props.onEnter(r,E)},p.onEntering=function(r,E){var A=p.resolveArguments(r,E),I=A[0],F=A[1],z=F?"appear":"enter";p.addClass(I,z,"active"),p.props.onEntering&&p.props.onEntering(r,E)},p.onEntered=function(r,E){var A=p.resolveArguments(r,E),I=A[0],F=A[1],z=F?"appear":"enter";p.removeClasses(I,z),p.addClass(I,z,"done"),p.props.onEntered&&p.props.onEntered(r,E)},p.onExit=function(r){var E=p.resolveArguments(r),A=E[0];p.removeClasses(A,"appear"),p.removeClasses(A,"enter"),p.addClass(A,"exit","base"),p.props.onExit&&p.props.onExit(r)},p.onExiting=function(r){var E=p.resolveArguments(r),A=E[0];p.addClass(A,"exit","active"),p.props.onExiting&&p.props.onExiting(r)},p.onExited=function(r){var E=p.resolveArguments(r),A=E[0];p.removeClasses(A,"exit"),p.addClass(A,"exit","done"),p.props.onExited&&p.props.onExited(r)},p.resolveArguments=function(r,E){return p.props.nodeRef?[p.props.nodeRef.current,r]:[r,E]},p.getClassNames=function(r){var E=p.props.classNames,A=typeof E=="string",I=A&&E?E+"-":"",F=A?""+I+r:E[r],z=A?F+"-active":E[r+"Active"],R=A?F+"-done":E[r+"Done"];return{baseClassName:F,activeClassName:z,doneClassName:R}},p}var c=s.prototype;return c.addClass=function(g,v,S){var r=this.getClassNames(v)[S+"ClassName"],E=this.getClassNames("enter"),A=E.doneClassName;v==="appear"&&S==="done"&&A&&(r+=" "+A),S==="active"&&g&&UR(g),r&&(this.appliedClasses[v][S]=r,QG(g,r))},c.removeClasses=function(g,v){var S=this.appliedClasses[v],r=S.base,E=S.active,A=S.done;this.appliedClasses[v]={},r&&aw(g,r),E&&aw(g,E),A&&aw(g,A)},c.render=function(){var g=this.props;g.classNames;var v=_i(g,["classNames"]);return Do.createElement(fd,Nt({},v,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},s})(Do.Component);JS.defaultProps={classNames:""};JS.propTypes={};function e$(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function QS(t,s){var c=function(v){return s&&Te.isValidElement(v)?s(v):v},p=Object.create(null);return t&&Te.Children.map(t,function(g){return g}).forEach(function(g){p[g.key]=c(g)}),p}function t$(t,s){t=t||{},s=s||{};function c(I){return I in s?s[I]:t[I]}var p=Object.create(null),g=[];for(var v in t)v in s?g.length&&(p[v]=g,g=[]):g.push(v);var S,r={};for(var E in s){if(p[E])for(S=0;S<p[E].length;S++){var A=p[E][S];r[p[E][S]]=c(A)}r[E]=c(E)}for(S=0;S<g.length;S++)r[g[S]]=c(g[S]);return r}function $m(t,s,c){return c[s]!=null?c[s]:t.props[s]}function n$(t,s){return QS(t.children,function(c){return Te.cloneElement(c,{onExited:s.bind(null,c),in:!0,appear:$m(c,"appear",t),enter:$m(c,"enter",t),exit:$m(c,"exit",t)})})}function r$(t,s,c){var p=QS(t.children),g=t$(s,p);return Object.keys(g).forEach(function(v){var S=g[v];if(Te.isValidElement(S)){var r=v in s,E=v in p,A=s[v],I=Te.isValidElement(A)&&!A.props.in;E&&(!r||I)?g[v]=Te.cloneElement(S,{onExited:c.bind(null,S),in:!0,exit:$m(S,"exit",t),enter:$m(S,"enter",t)}):!E&&r&&!I?g[v]=Te.cloneElement(S,{in:!1}):E&&r&&Te.isValidElement(A)&&(g[v]=Te.cloneElement(S,{onExited:c.bind(null,S),in:A.props.in,exit:$m(S,"exit",t),enter:$m(S,"enter",t)}))}}),g}var i$=Object.values||function(t){return Object.keys(t).map(function(s){return t[s]})},o$={component:"div",childFactory:function(s){return s}},av=(function(t){KS(s,t);function s(p,g){var v;v=t.call(this,p,g)||this;var S=v.handleExited.bind(e$(v));return v.state={contextValue:{isMounting:!0},handleExited:S,firstRender:!0},v}var c=s.prototype;return c.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},c.componentWillUnmount=function(){this.mounted=!1},s.getDerivedStateFromProps=function(g,v){var S=v.children,r=v.handleExited,E=v.firstRender;return{children:E?n$(g,r):r$(g,S,r),firstRender:!1}},c.handleExited=function(g,v){var S=QS(this.props.children);g.key in S||(g.props.onExited&&g.props.onExited(v),this.mounted&&this.setState(function(r){var E=Nt({},r.children);return delete E[g.key],{children:E}}))},c.render=function(){var g=this.props,v=g.component,S=g.childFactory,r=_i(g,["component","childFactory"]),E=this.state.contextValue,A=i$(this.state.children).map(S);return delete r.appear,delete r.enter,delete r.exit,v===null?Do.createElement(gx.Provider,{value:E},A):Do.createElement(gx.Provider,{value:E},Do.createElement(v,r,A))},s})(Do.Component);av.propTypes={};av.defaultProps=o$;const s$=[];function a$(t){Te.useEffect(t,s$)}class eT{static create(){return new eT}currentId=null;start(s,c){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,c()},s)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function Lp(){const t=VR(eT.create).current;return a$(t.disposeEffect),t}function l$(t){const{className:s,classes:c,pulsate:p=!1,rippleX:g,rippleY:v,rippleSize:S,in:r,onExited:E,timeout:A}=t,[I,F]=Te.useState(!1),z=Ar(s,c.ripple,c.rippleVisible,p&&c.ripplePulsate),R={width:S,height:S,top:-(S/2)+v,left:-(S/2)+g},D=Ar(c.child,I&&c.childLeaving,p&&c.childPulsate);return!r&&!I&&F(!0),Te.useEffect(()=>{if(!r&&E!=null){const O=setTimeout(E,A);return()=>{clearTimeout(O)}}},[E,r,A]),ue.jsx("span",{className:z,style:R,children:ue.jsx("span",{className:D})})}const mu=oi("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Qw=550,c$=80,u$=ov`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,d$=ov`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,h$=ov`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,f$=Cn("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),p$=Cn(l$,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${mu.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${u$};
    animation-duration: ${Qw}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${mu.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${mu.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${mu.childLeaving} {
    opacity: 0;
    animation-name: ${d$};
    animation-duration: ${Qw}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${mu.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${h$};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,m$=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiTouchRipple"}),{center:g=!1,classes:v={},className:S,...r}=p,[E,A]=Te.useState([]),I=Te.useRef(0),F=Te.useRef(null);Te.useEffect(()=>{F.current&&(F.current(),F.current=null)},[E]);const z=Te.useRef(!1),R=Lp(),D=Te.useRef(null),O=Te.useRef(null),N=Te.useCallback(Z=>{const{pulsate:X,rippleX:se,rippleY:ge,rippleSize:ae,cb:oe}=Z;A(fe=>[...fe,ue.jsx(p$,{classes:{ripple:Ar(v.ripple,mu.ripple),rippleVisible:Ar(v.rippleVisible,mu.rippleVisible),ripplePulsate:Ar(v.ripplePulsate,mu.ripplePulsate),child:Ar(v.child,mu.child),childLeaving:Ar(v.childLeaving,mu.childLeaving),childPulsate:Ar(v.childPulsate,mu.childPulsate)},timeout:Qw,pulsate:X,rippleX:se,rippleY:ge,rippleSize:ae},I.current)]),I.current+=1,F.current=oe},[v]),H=Te.useCallback((Z={},X={},se=()=>{})=>{const{pulsate:ge=!1,center:ae=g||X.pulsate,fakeElement:oe=!1}=X;if(Z?.type==="mousedown"&&z.current){z.current=!1;return}Z?.type==="touchstart"&&(z.current=!0);const fe=oe?null:O.current,pe=fe?fe.getBoundingClientRect():{width:0,height:0,left:0,top:0};let K,ye,J;if(ae||Z===void 0||Z.clientX===0&&Z.clientY===0||!Z.clientX&&!Z.touches)K=Math.round(pe.width/2),ye=Math.round(pe.height/2);else{const{clientX:de,clientY:Ae}=Z.touches&&Z.touches.length>0?Z.touches[0]:Z;K=Math.round(de-pe.left),ye=Math.round(Ae-pe.top)}if(ae)J=Math.sqrt((2*pe.width**2+pe.height**2)/3),J%2===0&&(J+=1);else{const de=Math.max(Math.abs((fe?fe.clientWidth:0)-K),K)*2+2,Ae=Math.max(Math.abs((fe?fe.clientHeight:0)-ye),ye)*2+2;J=Math.sqrt(de**2+Ae**2)}Z?.touches?D.current===null&&(D.current=()=>{N({pulsate:ge,rippleX:K,rippleY:ye,rippleSize:J,cb:se})},R.start(c$,()=>{D.current&&(D.current(),D.current=null)})):N({pulsate:ge,rippleX:K,rippleY:ye,rippleSize:J,cb:se})},[g,N,R]),j=Te.useCallback(()=>{H({},{pulsate:!0})},[H]),V=Te.useCallback((Z,X)=>{if(R.clear(),Z?.type==="touchend"&&D.current){D.current(),D.current=null,R.start(0,()=>{V(Z,X)});return}D.current=null,A(se=>se.length>0?se.slice(1):se),F.current=X},[R]);return Te.useImperativeHandle(c,()=>({pulsate:j,start:H,stop:V}),[j,H,V]),ue.jsx(f$,{className:Ar(mu.root,v.root,S),ref:O,...r,children:ue.jsx(av,{component:null,exit:!0,children:E})})});function g$(t){return ui("MuiButtonBase",t)}const _$=oi("MuiButtonBase",["root","disabled","focusVisible"]),y$=t=>{const{disabled:s,focusVisible:c,focusVisibleClassName:p,classes:g}=t,S=ti({root:["root",s&&"disabled",c&&"focusVisible"]},g$,g);return c&&p&&(S.root+=` ${p}`),S},v$=Cn("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${_$.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),Uy=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiButtonBase"}),{action:g,centerRipple:v=!1,children:S,className:r,component:E="button",disabled:A=!1,disableRipple:I=!1,disableTouchRipple:F=!1,focusRipple:z=!1,focusVisibleClassName:R,LinkComponent:D="a",onBlur:O,onClick:N,onContextMenu:H,onDragLeave:j,onFocus:V,onFocusVisible:Z,onKeyDown:X,onKeyUp:se,onMouseDown:ge,onMouseLeave:ae,onMouseUp:oe,onTouchEnd:fe,onTouchMove:pe,onTouchStart:K,tabIndex:ye=0,TouchRippleProps:J,touchRippleRef:de,type:Ae,...ne}=p,xe=Te.useRef(null),Ce=ZG(),Re=So(Ce.ref,de),[Ee,Oe]=Te.useState(!1);A&&Ee&&Oe(!1),Te.useImperativeHandle(g,()=>({focusVisible:()=>{Oe(!0),xe.current.focus()}}),[]);const Be=Ce.shouldMount&&!I&&!A;Te.useEffect(()=>{Ee&&z&&!I&&Ce.pulsate()},[I,z,Ee,Ce]);const at=df(Ce,"start",ge,F),ut=df(Ce,"stop",H,F),nt=df(Ce,"stop",j,F),$e=df(Ce,"stop",oe,F),ct=df(Ce,"stop",pt=>{Ee&&pt.preventDefault(),ae&&ae(pt)},F),At=df(Ce,"start",K,F),xt=df(Ce,"stop",fe,F),It=df(Ce,"stop",pe,F),jt=df(Ce,"stop",pt=>{lx(pt.target)||Oe(!1),O&&O(pt)},!1),cn=_r(pt=>{xe.current||(xe.current=pt.currentTarget),lx(pt.target)&&(Oe(!0),Z&&Z(pt)),V&&V(pt)}),Se=()=>{const pt=xe.current;return E&&E!=="button"&&!(pt.tagName==="A"&&pt.href)},mt=_r(pt=>{z&&!pt.repeat&&Ee&&pt.key===" "&&Ce.stop(pt,()=>{Ce.start(pt)}),pt.target===pt.currentTarget&&Se()&&pt.key===" "&&pt.preventDefault(),X&&X(pt),pt.target===pt.currentTarget&&Se()&&pt.key==="Enter"&&!A&&(pt.preventDefault(),N&&N(pt))}),Ke=_r(pt=>{z&&pt.key===" "&&Ee&&!pt.defaultPrevented&&Ce.stop(pt,()=>{Ce.pulsate(pt)}),se&&se(pt),N&&pt.target===pt.currentTarget&&Se()&&pt.key===" "&&!pt.defaultPrevented&&N(pt)});let Ue=E;Ue==="button"&&(ne.href||ne.to)&&(Ue=D);const je={};Ue==="button"?(je.type=Ae===void 0?"button":Ae,je.disabled=A):(!ne.href&&!ne.to&&(je.role="button"),A&&(je["aria-disabled"]=A));const gt=So(c,xe),Ot={...p,centerRipple:v,component:E,disabled:A,disableRipple:I,disableTouchRipple:F,focusRipple:z,tabIndex:ye,focusVisible:Ee},Ft=y$(Ot);return ue.jsxs(v$,{as:Ue,className:Ar(Ft.root,r),ownerState:Ot,onBlur:jt,onClick:N,onContextMenu:ut,onFocus:cn,onKeyDown:mt,onKeyUp:Ke,onMouseDown:at,onMouseLeave:ct,onMouseUp:$e,onDragLeave:nt,onTouchEnd:xt,onTouchMove:It,onTouchStart:At,ref:gt,tabIndex:A?-1:ye,type:Ae,...je,...ne,children:[S,Be?ue.jsx(m$,{ref:Re,center:v,...J}):null]})});function df(t,s,c,p=!1){return _r(g=>(c&&c(g),p||t[s](g),!0))}function x$(t){return ui("MuiCircularProgress",t)}oi("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Dp=44,eS=ov`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,tS=ov`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,b$=typeof eS!="string"?DS`
        animation: ${eS} 1.4s linear infinite;
      `:null,w$=typeof tS!="string"?DS`
        animation: ${tS} 1.4s ease-in-out infinite;
      `:null,S$=t=>{const{classes:s,variant:c,color:p,disableShrink:g}=t,v={root:["root",c,`color${ar(p)}`],svg:["svg"],circle:["circle",`circle${ar(c)}`,g&&"circleDisableShrink"]};return ti(v,x$,s)},T$=Cn("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,s[c.variant],s[`color${ar(c.color)}`]]}})(_o(({theme:t})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("transform")}},{props:{variant:"indeterminate"},style:b$||{animation:`${eS} 1.4s linear infinite`}},...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{color:(t.vars||t).palette[s].main}}))]}))),C$=Cn("svg",{name:"MuiCircularProgress",slot:"Svg"})({display:"block"}),E$=Cn("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.circle,s[`circle${ar(c.variant)}`],c.disableShrink&&s.circleDisableShrink]}})(_o(({theme:t})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:s})=>s.variant==="indeterminate"&&!s.disableShrink,style:w$||{animation:`${tS} 1.4s ease-in-out infinite`}}]}))),jR=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiCircularProgress"}),{className:g,color:v="primary",disableShrink:S=!1,size:r=40,style:E,thickness:A=3.6,value:I=0,variant:F="indeterminate",...z}=p,R={...p,color:v,disableShrink:S,size:r,thickness:A,value:I,variant:F},D=S$(R),O={},N={},H={};if(F==="determinate"){const j=2*Math.PI*((Dp-A)/2);O.strokeDasharray=j.toFixed(3),H["aria-valuenow"]=Math.round(I),O.strokeDashoffset=`${((100-I)/100*j).toFixed(3)}px`,N.transform="rotate(-90deg)"}return ue.jsx(T$,{className:Ar(D.root,g),style:{width:r,height:r,...N,...E},ownerState:R,ref:c,role:"progressbar",...H,...z,children:ue.jsx(C$,{className:D.svg,ownerState:R,viewBox:`${Dp/2} ${Dp/2} ${Dp} ${Dp}`,children:ue.jsx(E$,{className:D.circle,style:O,ownerState:R,cx:Dp,cy:Dp,r:(Dp-A)/2,fill:"none",strokeWidth:A})})})});function A$(t){return ui("MuiIconButton",t)}const cP=oi("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge","loading","loadingIndicator","loadingWrapper"]),P$=t=>{const{classes:s,disabled:c,color:p,edge:g,size:v,loading:S}=t,r={root:["root",S&&"loading",c&&"disabled",p!=="default"&&`color${ar(p)}`,g&&`edge${ar(g)}`,`size${ar(v)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]};return ti(r,A$,s)},M$=Cn(Uy,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.loading&&s.loading,c.color!=="default"&&s[`color${ar(c.color)}`],c.edge&&s[`edge${ar(c.edge)}`],s[`size${ar(c.size)}`]]}})(_o(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:s=>!s.disableRipple,style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity),"&:hover":{backgroundColor:"var(--IconButton-hoverBg)","@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),_o(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{color:(t.vars||t).palette[s].main}})),...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette[s].main,(t.vars||t).palette.action.hoverOpacity)}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${cP.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled},[`&.${cP.loading}`]:{color:"transparent"}}))),I$=Cn("span",{name:"MuiIconButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:(t.vars||t).palette.action.disabled,variants:[{props:{loading:!0},style:{display:"flex"}}]})),_x=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiIconButton"}),{edge:g=!1,children:v,className:S,color:r="default",disabled:E=!1,disableFocusRipple:A=!1,size:I="medium",id:F,loading:z=null,loadingIndicator:R,...D}=p,O=Np(F),N=R??ue.jsx(jR,{"aria-labelledby":O,color:"inherit",size:16}),H={...p,edge:g,color:r,disabled:E,disableFocusRipple:A,loading:z,loadingIndicator:N,size:I},j=P$(H);return ue.jsxs(M$,{id:z?O:F,className:Ar(j.root,S),centerRipple:!0,focusRipple:!A,disabled:E||z,ref:c,...D,ownerState:H,children:[typeof z=="boolean"&&ue.jsx("span",{className:j.loadingWrapper,style:{display:"contents"},children:ue.jsx(I$,{className:j.loadingIndicator,ownerState:H,children:z&&N})}),v]})}),R$=xh(ue.jsx("path",{d:"M7 10l5 5 5-5z"})),D$=xh(ue.jsx("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"})),k$=xh(ue.jsx("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})),O$=xh(ue.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}));xh(ue.jsxs(Te.Fragment,{children:[ue.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),ue.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}));xh(ue.jsx("path",{d:"M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"}));xh(ue.jsxs(Te.Fragment,{children:[ue.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),ue.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}));const L$=xh(ue.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));function z$(t){return ui("MuiPickersArrowSwitcher",t)}oi("MuiPickersArrowSwitcher",["root","spacer","button","previousIconButton","nextIconButton","leftArrowIcon","rightArrowIcon"]);const Na=()=>Te.useContext(zR),F$=["children","className","slots","slotProps","isNextDisabled","isNextHidden","onGoToNext","nextLabel","isPreviousDisabled","isPreviousHidden","onGoToPrevious","previousLabel","labelId","classes"],B$=["ownerState"],N$=["ownerState"],V$=Cn("div",{name:"MuiPickersArrowSwitcher",slot:"Root"})({display:"flex"}),U$=Cn("div",{name:"MuiPickersArrowSwitcher",slot:"Spacer"})(({theme:t})=>({width:t.spacing(3)})),uP=Cn(_x,{name:"MuiPickersArrowSwitcher",slot:"Button"})({variants:[{props:{isButtonHidden:!0},style:{visibility:"hidden"}}]}),j$=t=>ti({root:["root"],spacer:["spacer"],button:["button"],previousIconButton:["previousIconButton"],nextIconButton:["nextIconButton"],leftArrowIcon:["leftArrowIcon"],rightArrowIcon:["rightArrowIcon"]},z$,t),G$=Te.forwardRef(function(s,c){const p=Su(),g=_s({props:s,name:"MuiPickersArrowSwitcher"}),{children:v,className:S,slots:r,slotProps:E,isNextDisabled:A,isNextHidden:I,onGoToNext:F,nextLabel:z,isPreviousDisabled:R,isPreviousHidden:D,onGoToPrevious:O,previousLabel:N,labelId:H,classes:j}=g,V=_i(g,F$),{ownerState:Z}=Na(),X=j$(j),se={isDisabled:A,isHidden:I,goTo:F,label:z},ge={isDisabled:R,isHidden:D,goTo:O,label:N},ae=r?.previousIconButton??uP,oe=ji({elementType:ae,externalSlotProps:E?.previousIconButton,additionalProps:{size:"medium",title:ge.label,"aria-label":ge.label,disabled:ge.isDisabled,edge:"end",onClick:ge.goTo},ownerState:Nt({},Z,{isButtonHidden:ge.isHidden??!1}),className:Ar(X.button,X.previousIconButton)}),fe=r?.nextIconButton??uP,pe=ji({elementType:fe,externalSlotProps:E?.nextIconButton,additionalProps:{size:"medium",title:se.label,"aria-label":se.label,disabled:se.isDisabled,edge:"start",onClick:se.goTo},ownerState:Nt({},Z,{isButtonHidden:se.isHidden??!1}),className:Ar(X.button,X.nextIconButton)}),K=r?.leftArrowIcon??D$,ye=ji({elementType:K,externalSlotProps:E?.leftArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:Z,className:X.leftArrowIcon}),J=_i(ye,B$),de=r?.rightArrowIcon??k$,Ae=ji({elementType:de,externalSlotProps:E?.rightArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:Z,className:X.rightArrowIcon}),ne=_i(Ae,N$);return ue.jsxs(V$,Nt({ref:c,className:Ar(X.root,S),ownerState:Z},V,{children:[ue.jsx(ae,Nt({},oe,{children:p?ue.jsx(de,Nt({},ne)):ue.jsx(K,Nt({},J))})),v?ue.jsx(Jm,{variant:"subtitle1",component:"span",id:H,children:v}):ue.jsx(U$,{className:X.spacer,ownerState:Z}),ue.jsx(fe,Nt({},pe,{children:p?ue.jsx(K,Nt({},J)):ue.jsx(de,Nt({},ne))}))]}))}),$$=["hours","minutes","seconds"],H$=t=>$$.includes(t),dP=(t,s)=>s.getHours(t)*3600+s.getMinutes(t)*60+s.getSeconds(t),q$=(t,s)=>(c,p)=>t?s.isAfter(c,p):dP(c,s)>dP(p,s),GR={hasNextStep:!1,hasSeveralSteps:!1,goToNextStep:()=>{},areViewsInSameStep:()=>!0};function W$(t){const{steps:s,isViewMatchingStep:c,onStepChange:p}=t;return g=>{if(s==null)return GR;const v=s.findIndex(r=>c(g.view,r)),S=v===-1||v===s.length-1?null:s[v+1];return{hasNextStep:S!=null,hasSeveralSteps:s.length>1,goToNextStep:()=>{S!=null&&p(Nt({},g,{step:S}))},areViewsInSameStep:(r,E)=>{const A=s.find(F=>c(r,F)),I=s.find(F=>c(E,F));return A===I}}}}function $R({onChange:t,onViewChange:s,openTo:c,view:p,views:g,autoFocus:v,focusedView:S,onFocusedViewChange:r,getStepNavigation:E}){const A=Te.useRef(c),I=Te.useRef(g),F=Te.useRef(g.includes(c)?c:g[0]),[z,R]=ff({name:"useViews",state:"view",controlled:p,default:F.current}),D=Te.useRef(v?z:null),[O,N]=ff({name:"useViews",state:"focusedView",controlled:S,default:D.current}),H=E?E({setView:R,view:z,defaultView:F.current,views:g}):GR;Te.useEffect(()=>{(A.current&&A.current!==c||I.current&&I.current.some(oe=>!g.includes(oe)))&&(R(g.includes(c)?c:g[0]),I.current=g,A.current=c)},[c,R,z,g]);const j=g.indexOf(z),V=g[j-1]??null,Z=g[j+1]??null,X=_r((oe,fe)=>{N(fe?oe:pe=>oe===pe?null:pe),r?.(oe,fe)}),se=_r(oe=>{X(oe,!0),oe!==z&&(R(oe),s&&s(oe))}),ge=_r(()=>{Z&&se(Z)}),ae=_r((oe,fe,pe)=>{const K=fe==="finish",ye=pe?g.indexOf(pe)<g.length-1:!!Z;t(oe,K&&ye?"partial":fe,pe);let de=null;if(pe!=null&&pe!==z?de=pe:K&&(de=z),de==null)return;const Ae=g[g.indexOf(de)+1];Ae==null||!H.areViewsInSameStep(de,Ae)||se(Ae)});return Nt({},H,{view:z,setView:se,focusedView:O,setFocusedView:X,nextView:Z,previousView:V,defaultView:g.includes(c)?c:g[0],goToNextView:ge,setValueAndGoToNextView:ae})}function Z$(t,{disableFuture:s,maxDate:c,timezone:p}){const g=Ko();return Te.useMemo(()=>{const v=g.date(void 0,p),S=g.startOfMonth(s&&g.isBefore(v,c)?v:c);return!g.isAfter(S,t)},[s,c,t,g,p])}function Y$(t,{disablePast:s,minDate:c,timezone:p}){const g=Ko();return Te.useMemo(()=>{const v=g.date(void 0,p),S=g.startOfMonth(s&&g.isAfter(v,c)?v:c);return!g.isBefore(S,t)},[s,c,t,g,p])}const jy=36,ib=2,ob=320,X$=280,tT=336,K$=Cn("div")({overflow:"hidden",width:ob,maxHeight:tT,display:"flex",flexDirection:"column",margin:"0 auto"}),lv=({name:t,timezone:s,value:c,defaultValue:p,referenceDate:g,onChange:v,valueManager:S})=>{const r=Ko(),[E,A]=ff({name:t,state:"value",controlled:c,default:p??S.emptyValue}),I=Te.useMemo(()=>S.getTimezone(r,E),[r,S,E]),F=_r(O=>I==null?O:S.setTimezone(r,I,O)),z=Te.useMemo(()=>s||I||(g?r.getTimezone(Array.isArray(g)?g[0]:g):"default"),[s,I,g,r]),R=Te.useMemo(()=>S.setTimezone(r,z,E),[S,r,z,E]),D=_r((O,...N)=>{const H=F(O);A(H),v?.(H,...N)});return{value:R,handleValueChange:D,timezone:z}},lh={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7},J$=t=>Math.max(...t.map(s=>lh[s.type]??1)),cy=(t,s,c)=>{if(s===lh.year)return t.startOfYear(c);if(s===lh.month)return t.startOfMonth(c);if(s===lh.day)return t.startOfDay(c);let p=c;return s<lh.minutes&&(p=t.setMinutes(p,0)),s<lh.seconds&&(p=t.setSeconds(p,0)),s<lh.milliseconds&&(p=t.setMilliseconds(p,0)),p},Q$=({props:t,adapter:s,granularity:c,timezone:p,getTodayDate:g})=>{let v=g?g():cy(s,c,AR(s,p));t.minDate!=null&&s.isAfterDay(t.minDate,v)&&(v=cy(s,c,t.minDate)),t.maxDate!=null&&s.isBeforeDay(t.maxDate,v)&&(v=cy(s,c,t.maxDate));const S=q$(t.disableIgnoringDatePartForTimeValidation??!1,s);return t.minTime!=null&&S(t.minTime,v)&&(v=cy(s,c,t.disableIgnoringDatePartForTimeValidation?t.minTime:px(s,v,t.minTime))),t.maxTime!=null&&S(v,t.maxTime)&&(v=cy(s,c,t.disableIgnoringDatePartForTimeValidation?t.maxTime:px(s,v,t.maxTime))),v},eH=["value","referenceDate"],_h={emptyValue:null,getTodayValue:AR,getInitialReferenceValue:t=>{let{value:s,referenceDate:c}=t,p=_i(t,eH);return p.adapter.isValid(s)?s:c??Q$(p)},cleanValue:mG,areValuesEqual:gG,isSameError:(t,s)=>t===s,hasError:t=>t!=null,defaultErrorState:null,getTimezone:(t,s)=>t.isValid(s)?t.getTimezone(s):null,setTimezone:(t,s,c)=>c==null?null:t.setTimezone(c,s)},tH={updateReferenceValue:(t,s,c)=>t.isValid(s)?s:c,getSectionsFromValue:(t,s)=>s(t),getV7HiddenInputValueFromSections:SG,getV6InputValueFromSections:TG,parseValueStr:(t,s,c)=>c(t.trim(),s),getDateFromSection:t=>t,getDateSectionsFromValue:t=>t,updateDateInValue:(t,s,c)=>c,clearDateSections:t=>t.map(s=>Nt({},s,{value:""}))},Ay=Te.createContext({});function gs(t,s){const{className:c,elementType:p,ownerState:g,externalForwardedProps:v,internalForwardedProps:S,shouldForwardComponentProp:r=!1,...E}=s,{component:A,slots:I={[t]:void 0},slotProps:F={[t]:void 0},...z}=v,R=I[t]||p,D=ad(F[t],g),{props:{component:O,...N},internalRef:H}=AI({className:c,...E,externalForwardedProps:t==="root"?z:void 0,externalSlotProps:D}),j=So(H,D?.ref,s.ref),V=t==="root"?O||A:O,Z=EI(R,{...t==="root"&&!A&&!I[t]&&S,...t!=="root"&&!I[t]&&S,...N,...V&&!r&&{as:V},...V&&r&&{component:V},ref:j},g);return[R,Z]}function nH(t){return ui("MuiList",t)}oi("MuiList",["root","padding","dense","subheader"]);const rH=t=>{const{classes:s,disablePadding:c,dense:p,subheader:g}=t;return ti({root:["root",!c&&"padding",p&&"dense",g&&"subheader"]},nH,s)},iH=Cn("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,!c.disablePadding&&s.padding,c.dense&&s.dense,c.subheader&&s.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),HR=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiList"}),{children:g,className:v,component:S="ul",dense:r=!1,disablePadding:E=!1,subheader:A,...I}=p,F=Te.useMemo(()=>({dense:r}),[r]),z={...p,component:S,dense:r,disablePadding:E},R=rH(z);return ue.jsx(Ay.Provider,{value:F,children:ue.jsxs(iH,{as:S,className:Ar(R.root,v),ref:c,ownerState:z,...I,children:[A,g]})})});function qR(t=window){const s=t.document.documentElement.clientWidth;return t.innerWidth-s}function lw(t,s,c){return t===s?t.firstChild:s&&s.nextElementSibling?s.nextElementSibling:c?null:t.firstChild}function hP(t,s,c){return t===s?c?t.firstChild:t.lastChild:s&&s.previousElementSibling?s.previousElementSibling:c?null:t.lastChild}function WR(t,s){if(s===void 0)return!0;let c=t.innerText;return c===void 0&&(c=t.textContent),c=c.trim().toLowerCase(),c.length===0?!1:s.repeating?c[0]===s.keys[0]:c.startsWith(s.keys.join(""))}function uy(t,s,c,p,g,v){let S=!1,r=g(t,s,s?c:!1);for(;r;){if(r===t.firstChild){if(S)return!1;S=!0}const E=p?!1:r.disabled||r.getAttribute("aria-disabled")==="true";if(!r.hasAttribute("tabindex")||!WR(r,v)||E)r=g(t,r,c);else return r.focus(),!0}return!1}const oH=Te.forwardRef(function(s,c){const{actions:p,autoFocus:g=!1,autoFocusItem:v=!1,children:S,className:r,disabledItemsFocusable:E=!1,disableListWrap:A=!1,onKeyDown:I,variant:F="selectedMenu",...z}=s,R=Te.useRef(null),D=Te.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});la(()=>{g&&R.current.focus()},[g]),Te.useImperativeHandle(p,()=>({adjustStyleForScrollbar:(V,{direction:Z})=>{const X=!R.current.style.width;if(V.clientHeight<R.current.clientHeight&&X){const se=`${qR(gf(V))}px`;R.current.style[Z==="rtl"?"paddingLeft":"paddingRight"]=se,R.current.style.width=`calc(100% + ${se})`}return R.current}}),[]);const O=V=>{const Z=R.current,X=V.key;if(V.ctrlKey||V.metaKey||V.altKey){I&&I(V);return}const ge=As(Z).activeElement;if(X==="ArrowDown")V.preventDefault(),uy(Z,ge,A,E,lw);else if(X==="ArrowUp")V.preventDefault(),uy(Z,ge,A,E,hP);else if(X==="Home")V.preventDefault(),uy(Z,null,A,E,lw);else if(X==="End")V.preventDefault(),uy(Z,null,A,E,hP);else if(X.length===1){const ae=D.current,oe=X.toLowerCase(),fe=performance.now();ae.keys.length>0&&(fe-ae.lastTime>500?(ae.keys=[],ae.repeating=!0,ae.previousKeyMatched=!0):ae.repeating&&oe!==ae.keys[0]&&(ae.repeating=!1)),ae.lastTime=fe,ae.keys.push(oe);const pe=ge&&!ae.repeating&&WR(ge,ae);ae.previousKeyMatched&&(pe||uy(Z,ge,!1,E,lw,ae))?V.preventDefault():ae.previousKeyMatched=!1}I&&I(V)},N=So(R,c);let H=-1;Te.Children.forEach(S,(V,Z)=>{if(!Te.isValidElement(V)){H===Z&&(H+=1,H>=S.length&&(H=-1));return}V.props.disabled||(F==="selectedMenu"&&V.props.selected||H===-1)&&(H=Z),H===Z&&(V.props.disabled||V.props.muiSkipListHighlight||V.type.muiSkipListHighlight)&&(H+=1,H>=S.length&&(H=-1))});const j=Te.Children.map(S,(V,Z)=>{if(Z===H){const X={};return v&&(X.autoFocus=!0),V.props.tabIndex===void 0&&F==="selectedMenu"&&(X.tabIndex=0),Te.cloneElement(V,X)}return V});return ue.jsx(HR,{role:"menu",ref:N,className:r,onKeyDown:O,tabIndex:g?0:-1,...z,children:j})});function sH(t,s){return Array.isArray(s)?s.every(c=>t.indexOf(c)!==-1):t.indexOf(s)!==-1}const aH=t=>{setTimeout(t,0)},ZR=(t=document)=>{const s=t.activeElement;return s?s.shadowRoot?ZR(s.shadowRoot):s:null},Dl=t=>ZR(As(t)),lH="@media (pointer: fine)";function cH(t){return ui("MuiPickersDay",t)}const Dm=oi("MuiPickersDay",["root","dayWithMargin","dayOutsideMonth","hiddenDaySpacingFiller","today","selected","disabled"]);function YR(t){const{disabled:s,selected:c,today:p,outsideCurrentMonth:g,day:v,disableMargin:S,disableHighlightToday:r,showDaysOutsideCurrentMonth:E}=t,A=Ko(),{ownerState:I}=Na();return Te.useMemo(()=>Nt({},I,{day:v,isDaySelected:c??!1,isDayDisabled:s??!1,isDayCurrent:p??!1,isDayOutsideMonth:g??!1,isDayStartOfWeek:A.isSameDay(v,A.startOfWeek(v)),isDayEndOfWeek:A.isSameDay(v,A.endOfWeek(v)),disableMargin:S??!1,disableHighlightToday:r??!1,showDaysOutsideCurrentMonth:E??!1}),[A,I,v,c,s,p,g,S,r,E])}const uH=["autoFocus","className","classes","hidden","isAnimating","onClick","onDaySelect","onFocus","onBlur","onKeyDown","onMouseDown","onMouseEnter","children","isFirstVisibleCell","isLastVisibleCell","day","selected","disabled","today","outsideCurrentMonth","disableMargin","disableHighlightToday","showDaysOutsideCurrentMonth"],dH=(t,s)=>{const{isDaySelected:c,isDayDisabled:p,isDayCurrent:g,isDayOutsideMonth:v,disableMargin:S,disableHighlightToday:r,showDaysOutsideCurrentMonth:E}=s,A=v&&!E;return ti({root:["root",c&&!A&&"selected",p&&"disabled",!S&&"dayWithMargin",!r&&g&&"today",v&&E&&"dayOutsideMonth",A&&"hiddenDaySpacingFiller"],hiddenDaySpacingFiller:["hiddenDaySpacingFiller"]},cH,t)},XR=({theme:t})=>Nt({},t.typography.caption,{width:jy,height:jy,borderRadius:"50%",padding:0,backgroundColor:"transparent",transition:t.transitions.create("background-color",{duration:t.transitions.duration.short}),color:(t.vars||t).palette.text.primary,"@media (pointer: fine)":{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:gh(t.palette.primary.main,t.palette.action.hoverOpacity)}},"&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.focusOpacity})`:gh(t.palette.primary.main,t.palette.action.focusOpacity),[`&.${Dm.selected}`]:{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${Dm.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,fontWeight:t.typography.fontWeightMedium,"&:hover":{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${Dm.disabled}:not(.${Dm.selected})`]:{color:(t.vars||t).palette.text.disabled},[`&.${Dm.disabled}&.${Dm.selected}`]:{opacity:.6},variants:[{props:{disableMargin:!1},style:{margin:`0 ${ib}px`}},{props:{isDayOutsideMonth:!0,showDaysOutsideCurrentMonth:!0},style:{color:(t.vars||t).palette.text.secondary}},{props:{disableHighlightToday:!1,isDayCurrent:!0},style:{[`&:not(.${Dm.selected})`]:{border:`1px solid ${(t.vars||t).palette.text.secondary}`}}}]}),KR=(t,s)=>{const{ownerState:c}=t;return[s.root,!c.disableMargin&&s.dayWithMargin,!c.disableHighlightToday&&c.isDayCurrent&&s.today,!c.isDayOutsideMonth&&c.showDaysOutsideCurrentMonth&&s.dayOutsideMonth,c.isDayOutsideMonth&&!c.showDaysOutsideCurrentMonth&&s.hiddenDaySpacingFiller]},hH=Cn(Uy,{name:"MuiPickersDay",slot:"Root",overridesResolver:KR})(XR),fH=Cn("div",{name:"MuiPickersDay",slot:"Root",overridesResolver:KR})(({theme:t})=>Nt({},XR({theme:t}),{opacity:0,pointerEvents:"none"})),dy=()=>{},pH=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersDay"}),{autoFocus:g=!1,className:v,classes:S,isAnimating:r,onClick:E,onDaySelect:A,onFocus:I=dy,onBlur:F=dy,onKeyDown:z=dy,onMouseDown:R=dy,onMouseEnter:D=dy,children:O,day:N,selected:H,disabled:j,today:V,outsideCurrentMonth:Z,disableMargin:X,disableHighlightToday:se,showDaysOutsideCurrentMonth:ge}=p,ae=_i(p,uH),oe=YR({day:N,selected:H,disabled:j,today:V,outsideCurrentMonth:Z,disableMargin:X,disableHighlightToday:se,showDaysOutsideCurrentMonth:ge}),fe=dH(S,oe),pe=Ko(),K=Te.useRef(null),ye=So(K,c);la(()=>{g&&!j&&!r&&!Z&&K.current.focus()},[g,j,r,Z]);const J=Ae=>{R(Ae),Z&&Ae.preventDefault()},de=Ae=>{Ae.defaultMuiPrevented=!0,j||A(N),Z&&Ae.currentTarget.focus(),E&&E(Ae)};return Z&&!ge?ue.jsx(fH,{className:Ar(fe.root,fe.hiddenDaySpacingFiller,v),ownerState:oe,role:ae.role}):ue.jsx(hH,Nt({className:Ar(fe.root,v),ref:ye,centerRipple:!0,disabled:j,tabIndex:H?0:-1,onKeyDown:Ae=>z(Ae,N),onFocus:Ae=>I(Ae,N),onBlur:Ae=>F(Ae,N),onMouseEnter:Ae=>D(Ae,N),onClick:de,onMouseDown:J},ae,{ownerState:oe,children:O??pe.format(N,"dayOfMonth")}))}),mH=Te.memo(pH),Wg=t=>t.saveQuery!=null,JR=({stateResponse:{localizedDigits:t,sectionsValueBoundaries:s,state:c,timezone:p,setCharacterQuery:g,setTempAndroidValueStr:v,updateSectionValue:S}})=>{const r=Ko(),E=({keyPressed:F,sectionIndex:z},R,D)=>{const O=F.toLowerCase(),N=c.sections[z];if(c.characterQuery!=null&&(!D||D(c.characterQuery.value))&&c.characterQuery.sectionIndex===z){const j=`${c.characterQuery.value}${O}`,V=R(j,N);if(!Wg(V))return g({sectionIndex:z,value:j,sectionType:N.type}),V}const H=R(O,N);return Wg(H)&&!H.saveQuery?(g(null),null):(g({sectionIndex:z,value:O,sectionType:N.type}),Wg(H)?null:H)},A=F=>{const z=(O,N,H)=>{const j=N.filter(V=>V.toLowerCase().startsWith(H));return j.length===0?{saveQuery:!1}:{sectionValue:j[0],shouldGoToNextSection:j.length===1}},R=(O,N,H,j)=>{const V=Z=>MR(r,p,N.type,Z);if(N.contentType==="letter")return z(N.format,V(N.format),O);if(H&&j!=null&&PR(r,H).contentType==="letter"){const Z=V(H),X=z(H,Z,O);return Wg(X)?{saveQuery:!1}:Nt({},X,{sectionValue:j(X.sectionValue,Z)})}return{saveQuery:!1}};return E(F,(O,N)=>{switch(N.type){case"month":{const H=j=>Q4(r,j,r.formats.month,N.format);return R(O,N,r.formats.month,H)}case"weekDay":{const H=(j,V)=>V.indexOf(j).toString();return R(O,N,r.formats.weekday,H)}case"meridiem":return R(O,N);default:return{saveQuery:!1}}})},I=F=>{const z=({queryValue:D,skipIfBelowMinimum:O,section:N})=>{const H=Zm(D,t),j=Number(H),V=s[N.type]({currentDate:null,format:N.format,contentType:N.contentType});if(j>V.maximum)return{saveQuery:!1};if(O&&j<V.minimum)return{saveQuery:!0};const Z=j*10>V.maximum||H.length===V.maximum.toString().length;return{sectionValue:IR(r,j,V,t,N),shouldGoToNextSection:Z}};return E(F,(D,O)=>{if(O.contentType==="digit"||O.contentType==="digit-with-letter")return z({queryValue:D,skipIfBelowMinimum:!1,section:O});if(O.type==="month"){RR(r,"digit","month","MM");const N=z({queryValue:D,skipIfBelowMinimum:!0,section:{type:O.type,format:"MM",hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2}});if(Wg(N))return N;const H=Q4(r,N.sectionValue,"MM",O.format);return Nt({},N,{sectionValue:H})}if(O.type==="weekDay"){const N=z({queryValue:D,skipIfBelowMinimum:!0,section:O});if(Wg(N))return N;const H=nb(r,O.format)[Number(N.sectionValue)-1];return Nt({},N,{sectionValue:H})}return{saveQuery:!1}},D=>J4(D,t))};return _r(F=>{const z=c.sections[F.sectionIndex],D=J4(F.keyPressed,t)?I(Nt({},F,{keyPressed:qS(F.keyPressed,t)})):A(F);if(D==null){v(null);return}S({section:z,newSectionValue:D.sectionValue,shouldGoToNextSection:D.shouldGoToNextSection})})},cv=({props:t,value:s,timezone:c,adapter:p})=>{if(s===null)return null;const{shouldDisableDate:g,shouldDisableMonth:v,shouldDisableYear:S,disablePast:r,disableFuture:E,minDate:A,maxDate:I}=t,F=p.date(void 0,c);switch(!0){case!p.isValid(s):return"invalidDate";case!!(g&&g(s)):return"shouldDisableDate";case!!(v&&v(s)):return"shouldDisableMonth";case!!(S&&S(s)):return"shouldDisableYear";case!!(E&&p.isAfterDay(s,F)):return"disableFuture";case!!(r&&p.isBeforeDay(s,F)):return"disablePast";case!!(A&&p.isBeforeDay(s,A)):return"minDate";case!!(I&&p.isAfterDay(s,I)):return"maxDate";default:return null}};cv.valueManager=_h;function QR(t){const{props:s,validator:c,value:p,timezone:g,onError:v}=t,S=Ko(),r=Te.useRef(c.valueManager.defaultErrorState),E=c({adapter:S,value:p,timezone:g,props:s}),A=c.valueManager.hasError(E);Te.useEffect(()=>{v&&!c.valueManager.isSameError(E,r.current)&&v(E,p),r.current=E},[c,v,E,p]);const I=_r(F=>c({adapter:S,value:F,timezone:g,props:s}));return{validationError:E,hasValidationError:A,getValidationErrorForNewValue:I}}const gH=5e3,eD=t=>{const s=Ko(),c=Up(),p=Su(),{manager:{validator:g,valueType:v,internal_valueManager:S,internal_fieldValueManager:r},internalPropsWithDefaults:E,internalPropsWithDefaults:{value:A,defaultValue:I,referenceDate:F,onChange:z,format:R,formatDensity:D="dense",selectedSections:O,onSelectedSectionsChange:N,shouldRespectLeadingZeros:H=!1,timezone:j,enableAccessibleFieldDOMStructure:V=!0},forwardedProps:{error:Z}}=t,{value:X,handleValueChange:se,timezone:ge}=lv({name:"a field component",timezone:j,value:A,defaultValue:I,referenceDate:F,onChange:z,valueManager:S}),ae=Te.useRef(X);Te.useEffect(()=>{ae.current=X},[X]);const{hasValidationError:oe}=QR({props:E,validator:g,timezone:ge,value:X,onError:E.onError}),fe=Te.useMemo(()=>Z!==void 0?Z:oe,[oe,Z]),pe=Te.useMemo(()=>xG(s),[s]),K=Te.useMemo(()=>CG(s,pe,ge),[s,pe,ge]),ye=Te.useCallback(Ke=>r.getSectionsFromValue(Ke,Ue=>nP({adapter:s,localeText:c,localizedDigits:pe,format:R,date:Ue,formatDensity:D,shouldRespectLeadingZeros:H,enableAccessibleFieldDOMStructure:V,isRtl:p})),[r,R,c,pe,p,H,s,D,V]),[J,de]=Te.useState(()=>{const Ke=ye(X),Ue={sections:Ke,lastExternalValue:X,lastSectionsDependencies:{format:R,isRtl:p,locale:s.locale},tempValueStrAndroid:null,characterQuery:null},je=J$(Ke),gt=S.getInitialReferenceValue({referenceDate:F,value:X,adapter:s,props:E,granularity:je,timezone:ge});return Nt({},Ue,{referenceValue:gt})}),[Ae,ne]=ff({controlled:O,default:null,name:"useField",state:"selectedSections"}),xe=Ke=>{ne(Ke),N?.(Ke)},Ce=Te.useMemo(()=>Yw(Ae,J.sections),[Ae,J.sections]),Re=Ce==="all"?0:Ce,Ee=Te.useMemo(()=>PG(J.sections,p&&!V),[J.sections,p,V]),Oe=Te.useMemo(()=>J.sections.every(Ke=>Ke.value===""),[J.sections]),Be=Ke=>{const Ue={validationError:g({adapter:s,value:Ke,timezone:ge,props:E})};se(Ke,Ue)},at=(Ke,Ue)=>{const je=[...J.sections];return je[Ke]=Nt({},je[Ke],{value:Ue,modified:!0}),je},ut=Te.useRef(null),nt=Lp(),$e=Ke=>{Re!=null&&(ut.current={sectionIndex:Re,value:Ke},nt.start(0,()=>{ut.current=null}))},ct=()=>{S.areValuesEqual(s,X,S.emptyValue)?de(Ke=>Nt({},Ke,{sections:Ke.sections.map(Ue=>Nt({},Ue,{value:""})),tempValueStrAndroid:null,characterQuery:null})):(de(Ke=>Nt({},Ke,{characterQuery:null})),Be(S.emptyValue))},At=()=>{if(Re==null)return;const Ke=J.sections[Re];Ke.value!==""&&($e(""),r.getDateFromSection(X,Ke)===null?de(Ue=>Nt({},Ue,{sections:at(Re,""),tempValueStrAndroid:null,characterQuery:null})):(de(Ue=>Nt({},Ue,{characterQuery:null})),Be(r.updateDateInValue(X,Ke,null))))},xt=Ke=>{const Ue=(gt,Ot)=>{const Ft=s.parse(gt,R);if(!s.isValid(Ft))return null;const pt=nP({adapter:s,localeText:c,localizedDigits:pe,format:R,date:Ft,formatDensity:D,shouldRespectLeadingZeros:H,enableAccessibleFieldDOMStructure:V,isRtl:p});return tP(s,Ft,pt,Ot,!1)},je=r.parseValueStr(Ke,J.referenceValue,Ue);Be(je)},It=Lp(),jt=({section:Ke,newSectionValue:Ue,shouldGoToNextSection:je})=>{nt.clear(),It.clear();const gt=r.getDateFromSection(X,Ke);je&&Re<J.sections.length-1&&xe(Re+1);const Ot=at(Re,Ue),Ft=r.getDateSectionsFromValue(Ot,Ke),pt=wG(s,Ft,pe);if(s.isValid(pt)){const dn=tP(s,pt,Ft,r.getDateFromSection(J.referenceValue,Ke),!0);return gt==null&&It.start(0,()=>{ae.current===X&&de(An=>Nt({},An,{sections:r.clearDateSections(J.sections,Ke),tempValueStrAndroid:null}))}),Be(r.updateDateInValue(X,Ke,dn))}return Ft.every(dn=>dn.value!=="")&&(gt==null||s.isValid(gt))?($e(Ue),Be(r.updateDateInValue(X,Ke,pt))):gt!=null?($e(Ue),Be(r.updateDateInValue(X,Ke,null))):de(dn=>Nt({},dn,{sections:Ot,tempValueStrAndroid:null}))},cn=Ke=>de(Ue=>Nt({},Ue,{tempValueStrAndroid:Ke})),Se=_r(Ke=>{de(Ue=>Nt({},Ue,{characterQuery:Ke}))});if(X!==J.lastExternalValue){let Ke;ut.current!=null&&!s.isValid(r.getDateFromSection(X,J.sections[ut.current.sectionIndex]))?Ke=at(ut.current.sectionIndex,ut.current.value):Ke=ye(X),de(Ue=>Nt({},Ue,{lastExternalValue:X,sections:Ke,sectionsDependencies:{format:R,isRtl:p,locale:s.locale},referenceValue:r.updateReferenceValue(s,X,Ue.referenceValue),tempValueStrAndroid:null}))}if(p!==J.lastSectionsDependencies.isRtl||R!==J.lastSectionsDependencies.format||s.locale!==J.lastSectionsDependencies.locale){const Ke=ye(X);de(Ue=>Nt({},Ue,{lastSectionsDependencies:{format:R,isRtl:p,locale:s.locale},sections:Ke,tempValueStrAndroid:null,characterQuery:null}))}J.characterQuery!=null&&!fe&&Re==null&&Se(null),J.characterQuery!=null&&J.sections[J.characterQuery.sectionIndex]?.type!==J.characterQuery.sectionType&&Se(null),Te.useEffect(()=>{ut.current!=null&&(ut.current=null)});const mt=Lp();return Te.useEffect(()=>(J.characterQuery!=null&&mt.start(gH,()=>Se(null)),()=>{}),[J.characterQuery,Se,mt]),Te.useEffect(()=>{J.tempValueStrAndroid!=null&&Re!=null&&At()},[J.sections]),{activeSectionIndex:Re,areAllSectionsEmpty:Oe,error:fe,localizedDigits:pe,parsedSelectedSections:Ce,sectionOrder:Ee,sectionsValueBoundaries:K,state:J,timezone:ge,value:X,clearValue:ct,clearActiveSection:At,setCharacterQuery:Se,setSelectedSections:xe,setTempAndroidValueStr:cn,updateSectionValue:jt,updateValueFromValueStr:xt,getSectionsFromValue:ye}};function tD(t){const{manager:{internal_useApplyDefaultValuesToFieldInternalProps:s},internalProps:c,skipContextFieldRefAssignment:p}=t,g=XS(),v=OR(),S=So(c.unstableFieldRef,p?null:v?.fieldRef),r=g?.setValue,E=Te.useCallback((I,F)=>r?.(I,{validationError:F.validationError,shouldClose:!1}),[r]),A=Te.useMemo(()=>v!=null&&g!=null?Nt({value:g.value,onChange:E,timezone:g.timezone,disabled:g.disabled,readOnly:g.readOnly,autoFocus:g.autoFocus&&!g.open,focused:g.open?!0:void 0,format:g.fieldFormat,formatDensity:v.formatDensity,enableAccessibleFieldDOMStructure:v.enableAccessibleFieldDOMStructure,selectedSections:v.selectedSections,onSelectedSectionsChange:v.onSelectedSectionsChange,unstableFieldRef:S},c):c,[g,v,c,E,S]);return s(A)}function nT(t){const{focused:s,domGetters:c,stateResponse:{parsedSelectedSections:p,state:g}}=t;if(!c.isReady())return;const v=As(c.getRoot()).getSelection();if(!v)return;if(p==null){v.rangeCount>0&&v.getRangeAt(0).startContainer instanceof Node&&c.getRoot().contains(v.getRangeAt(0).startContainer)&&v.removeAllRanges(),s&&c.getRoot().blur();return}if(!c.getRoot().contains(Dl(c.getRoot())))return;const S=new window.Range;let r;p==="all"?r=c.getRoot():g.sections[p].type==="empty"?r=c.getSectionContainer(p):r=c.getSectionContent(p),S.selectNodeContents(r),r.focus(),v.removeAllRanges(),v.addRange(S)}function nD(t){const s=Ko(),{manager:{internal_fieldValueManager:c},internalPropsWithDefaults:{minutesStep:p,disabled:g,readOnly:v},stateResponse:{state:S,value:r,activeSectionIndex:E,parsedSelectedSections:A,sectionsValueBoundaries:I,localizedDigits:F,timezone:z,sectionOrder:R,clearValue:D,clearActiveSection:O,setSelectedSections:N,updateSectionValue:H}}=t;return _r(j=>{if(!g)switch(!0){case((j.ctrlKey||j.metaKey)&&String.fromCharCode(j.keyCode)==="A"&&!j.shiftKey&&!j.altKey):{j.preventDefault(),N("all");break}case j.key==="ArrowRight":{if(j.preventDefault(),A==null)N(R.startIndex);else if(A==="all")N(R.endIndex);else{const V=R.neighbors[A].rightIndex;V!==null&&N(V)}break}case j.key==="ArrowLeft":{if(j.preventDefault(),A==null)N(R.endIndex);else if(A==="all")N(R.startIndex);else{const V=R.neighbors[A].leftIndex;V!==null&&N(V)}break}case j.key==="Delete":{if(j.preventDefault(),v)break;A==null||A==="all"?D():O();break}case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(j.key):{if(j.preventDefault(),v||E==null)break;A==="all"&&N(E);const V=S.sections[E],Z=yH(s,z,V,j.key,I,F,c.getDateFromSection(r,V),{minutesStep:p});H({section:V,newSectionValue:Z,shouldGoToNextSection:!1});break}}})}function _H(t){switch(t){case"ArrowUp":return 1;case"ArrowDown":return-1;case"PageUp":return 5;case"PageDown":return-5;default:return 0}}function yH(t,s,c,p,g,v,S,r){const E=_H(p),A=p==="Home",I=p==="End",F=c.value===""||A||I,z=()=>{const D=g[c.type]({currentDate:S,format:c.format,contentType:c.contentType}),O=j=>IR(t,j,D,v,c),N=c.type==="minutes"&&r?.minutesStep?r.minutesStep:1;let H;if(F){if(c.type==="year"&&!I&&!A)return t.formatByString(t.date(void 0,s),c.format);E>0||A?H=D.minimum:H=D.maximum}else H=parseInt(Zm(c.value,v),10)+E*N;return H%N!==0&&((E<0||A)&&(H+=N-(N+H)%N),(E>0||I)&&(H-=H%N)),H>D.maximum?O(D.minimum+(H-D.maximum-1)%(D.maximum-D.minimum+1)):H<D.minimum?O(D.maximum-(D.minimum-H-1)%(D.maximum-D.minimum+1)):O(H)},R=()=>{const D=MR(t,s,c.type,c.format);if(D.length===0)return c.value;if(F)return E>0||A?D[0]:D[D.length-1];const H=((D.indexOf(c.value)+E)%D.length+D.length)%D.length;return D[H]};return c.contentType==="digit"||c.contentType==="digit-with-letter"?z():R()}function vH(t){const{manager:s,focused:c,setFocused:p,domGetters:g,stateResponse:v,applyCharacterEditing:S,internalPropsWithDefaults:r,stateResponse:{parsedSelectedSections:E,sectionOrder:A,state:I,clearValue:F,setCharacterQuery:z,setSelectedSections:R,updateValueFromValueStr:D},internalPropsWithDefaults:{disabled:O=!1,readOnly:N=!1}}=t,H=nD({manager:s,internalPropsWithDefaults:r,stateResponse:v}),j=Lp(),V=_r(ae=>{O||!g.isReady()||(p(!0),E==="all"?j.start(0,()=>{const oe=document.getSelection().getRangeAt(0).startOffset;if(oe===0){R(A.startIndex);return}let fe=0,pe=0;for(;pe<oe&&fe<I.sections.length;){const K=I.sections[fe];fe+=1,pe+=`${K.startSeparator}${K.value||K.placeholder}${K.endSeparator}`.length}R(fe-1)}):c?g.getRoot().contains(ae.target)||R(A.startIndex):(p(!0),R(A.startIndex)))}),Z=_r(ae=>{if(!g.isReady()||E!=="all")return;const fe=ae.target.textContent??"";g.getRoot().innerHTML=I.sections.map(pe=>`${pe.startSeparator}${pe.value||pe.placeholder}${pe.endSeparator}`).join(""),nT({focused:c,domGetters:g,stateResponse:v}),fe.length===0||fe.charCodeAt(0)===10?(F(),R("all")):fe.length>1?D(fe):(E==="all"&&R(0),S({keyPressed:fe,sectionIndex:0}))}),X=_r(ae=>{if(N||E!=="all"){ae.preventDefault();return}const oe=ae.clipboardData.getData("text");ae.preventDefault(),z(null),D(oe)}),se=_r(()=>{if(c||O||!g.isReady())return;const ae=Dl(g.getRoot());p(!0),g.getSectionIndexFromDOMElement(ae)!=null||R(A.startIndex)}),ge=_r(()=>{setTimeout(()=>{if(!g.isReady())return;const ae=Dl(g.getRoot());!g.getRoot().contains(ae)&&(p(!1),R(null))})});return{onKeyDown:H,onBlur:ge,onFocus:se,onClick:V,onPaste:X,onInput:Z,contentEditable:E==="all",tabIndex:E===0?-1:0}}function xH(t){const{manager:{internal_fieldValueManager:s},stateResponse:{areAllSectionsEmpty:c,state:p,updateValueFromValueStr:g}}=t,v=_r(r=>{g(r.target.value)});return{value:Te.useMemo(()=>c?"":s.getV7HiddenInputValueFromSections(p.sections),[c,p.sections,s]),onChange:v}}function bH(t){const{stateResponse:{setSelectedSections:s},internalPropsWithDefaults:{disabled:c=!1}}=t,p=Te.useCallback(g=>v=>{c||v.isDefaultPrevented()||s(g)},[c,s]);return Te.useCallback(g=>({"data-sectionindex":g,onClick:p(g)}),[p])}function wH(t){const s=Ko(),c=Up(),{focused:p,domGetters:g,stateResponse:v,applyCharacterEditing:S,manager:{internal_fieldValueManager:r},stateResponse:{parsedSelectedSections:E,sectionsValueBoundaries:A,state:I,value:F,clearActiveSection:z,setCharacterQuery:R,setSelectedSections:D,updateSectionValue:O,updateValueFromValueStr:N},internalPropsWithDefaults:{disabled:H=!1,readOnly:j=!1}}=t,V=E==="all",Z=!V&&!H&&!j,X=_r(pe=>{if(!g.isReady())return;const K=I.sections[pe];g.getSectionContent(pe).innerHTML=K.value||K.placeholder,nT({focused:p,domGetters:g,stateResponse:v})}),se=_r(pe=>{if(!g.isReady())return;const K=pe.target,ye=K.textContent??"",J=g.getSectionIndexFromDOMElement(K),de=I.sections[J];if(j){X(J);return}if(ye.length===0){if(de.value===""){X(J);return}const Ae=pe.nativeEvent.inputType;if(Ae==="insertParagraph"||Ae==="insertLineBreak"){X(J);return}X(J),z();return}S({keyPressed:ye,sectionIndex:J}),X(J)}),ge=_r(pe=>{pe.preventDefault()}),ae=_r(pe=>{if(pe.preventDefault(),j||H||typeof E!="number")return;const K=I.sections[E],ye=pe.clipboardData.getData("text"),J=/^[a-zA-Z]+$/.test(ye),de=/^[0-9]+$/.test(ye),Ae=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(ye);K.contentType==="letter"&&J||K.contentType==="digit"&&de||K.contentType==="digit-with-letter"&&Ae?(R(null),O({section:K,newSectionValue:ye,shouldGoToNextSection:!0})):!J&&!de&&(R(null),N(ye))}),oe=_r(pe=>{pe.preventDefault(),pe.dataTransfer.dropEffect="none"}),fe=Te.useCallback(pe=>()=>{H||D(pe)},[H,D]);return Te.useCallback((pe,K)=>{const ye=A[pe.type]({currentDate:r.getDateFromSection(F,pe),contentType:pe.contentType,format:pe.format});return{onInput:se,onPaste:ae,onMouseUp:ge,onDragOver:oe,onFocus:fe(K),"aria-readonly":j,"aria-valuenow":TH(pe,s),"aria-valuemin":ye.minimum,"aria-valuemax":ye.maximum,"aria-valuetext":pe.value?SH(pe,s):c.empty,"aria-label":c[pe.type],"aria-disabled":H,tabIndex:V||K>0?-1:0,contentEditable:!V&&!H&&!j,role:"spinbutton","data-range-position":pe.dateName||void 0,spellCheck:Z?!1:void 0,autoCapitalize:Z?"off":void 0,autoCorrect:Z?"off":void 0,children:pe.value||pe.placeholder,inputMode:pe.contentType==="letter"?"text":"numeric"}},[A,V,H,j,Z,c,s,se,ae,ge,oe,fe,r,F])}function SH(t,s){if(t.value)switch(t.type){case"month":{if(t.contentType==="digit"){const p=s.setMonth(s.date(),Number(t.value)-1);return s.isValid(p)?s.format(p,"month"):""}const c=s.parse(t.value,t.format);return c&&s.isValid(c)?s.format(c,"month"):void 0}case"day":if(t.contentType==="digit"){const c=s.setDate(s.startOfYear(s.date()),Number(t.value));return s.isValid(c)?s.format(c,"dayOfMonthFull"):""}return t.value;case"weekDay":return;default:return}}function TH(t,s){if(t.value)switch(t.type){case"weekDay":return t.contentType==="letter"?void 0:Number(t.value);case"meridiem":{const c=s.parse(`01:00 ${t.value}`,`${s.formats.hours12h}:${s.formats.minutes} ${t.format}`);return c?s.getHours(c)>=12?1:0:void 0}case"day":return t.contentType==="digit-with-letter"?parseInt(t.value,10):Number(t.value);case"month":{if(t.contentType==="digit")return Number(t.value);const c=s.parse(t.value,t.format);return c?s.getMonth(c)+1:void 0}default:return t.contentType!=="letter"?Number(t.value):void 0}}const CH=t=>{const{props:s,manager:c,skipContextFieldRefAssignment:p,manager:{valueType:g,internal_useOpenPickerButtonAriaLabel:v}}=t,{internalProps:S,forwardedProps:r}=ER(s,g),E=tD({manager:c,internalProps:S,skipContextFieldRefAssignment:p}),{sectionListRef:A,onBlur:I,onClick:F,onFocus:z,onInput:R,onPaste:D,onKeyDown:O,onClear:N,clearable:H}=r,{disabled:j=!1,readOnly:V=!1,autoFocus:Z=!1,focused:X,unstableFieldRef:se}=E,ge=Te.useRef(null),ae=So(A,ge),oe=Te.useMemo(()=>({isReady:()=>ge.current!=null,getRoot:()=>ge.current.getRoot(),getSectionContainer:Ke=>ge.current.getSectionContainer(Ke),getSectionContent:Ke=>ge.current.getSectionContent(Ke),getSectionIndexFromDOMElement:Ke=>ge.current.getSectionIndexFromDOMElement(Ke)}),[ge]),fe=eD({manager:c,internalPropsWithDefaults:E,forwardedProps:r}),{areAllSectionsEmpty:pe,error:K,parsedSelectedSections:ye,sectionOrder:J,state:de,value:Ae,clearValue:ne,setSelectedSections:xe}=fe,Ce=JR({stateResponse:fe}),Re=v(Ae),[Ee,Oe]=Te.useState(!1);function Be(Ke=0){if(j||!ge.current||fP(ge)!=null)return;const Ue=Yw(Ke,de.sections);Oe(!0),ge.current.getSectionContent(Ue).focus()}const at=vH({manager:c,internalPropsWithDefaults:E,stateResponse:fe,applyCharacterEditing:Ce,focused:Ee,setFocused:Oe,domGetters:oe}),ut=xH({manager:c,stateResponse:fe}),nt=bH({stateResponse:fe,internalPropsWithDefaults:E}),$e=wH({manager:c,stateResponse:fe,applyCharacterEditing:Ce,internalPropsWithDefaults:E,domGetters:oe,focused:Ee}),ct=_r(Ke=>{O?.(Ke),at.onKeyDown(Ke)}),At=_r(Ke=>{I?.(Ke),at.onBlur(Ke)}),xt=_r(Ke=>{z?.(Ke),at.onFocus(Ke)}),It=_r(Ke=>{Ke.isDefaultPrevented()||(F?.(Ke),at.onClick(Ke))}),jt=_r(Ke=>{D?.(Ke),at.onPaste(Ke)}),cn=_r(Ke=>{R?.(Ke),at.onInput(Ke)}),Se=_r((Ke,...Ue)=>{Ke.preventDefault(),N?.(Ke,...Ue),ne(),pP(ge)?xe(J.startIndex):Be(0)}),mt=Te.useMemo(()=>de.sections.map((Ke,Ue)=>{const je=$e(Ke,Ue);return{container:nt(Ue),content:$e(Ke,Ue),before:{children:Ke.startSeparator},after:{children:Ke.endSeparator,"data-range-position":Ke.isEndFormatSeparator?je["data-range-position"]:void 0}}}),[de.sections,nt,$e]);return Te.useEffect(()=>{if(ge.current==null)throw new Error(["MUI X: The `sectionListRef` prop has not been initialized by `PickersSectionList`","You probably tried to pass a component to the `textField` slot that contains an `<input />` element instead of a `PickersSectionList`.","","If you want to keep using an `<input />` HTML element for the editing, please add the `enableAccessibleFieldDOMStructure={false}` prop to your Picker or Field component:","","<DatePicker enableAccessibleFieldDOMStructure={false} slots={{ textField: MyCustomTextField }} />","","Learn more about the field accessible DOM structure on the MUI documentation: https://mui.com/x/react-date-pickers/fields/#fields-to-edit-a-single-element"].join(`
`));Z&&!j&&ge.current&&ge.current.getSectionContent(J.startIndex).focus()},[]),la(()=>{if(!(!Ee||!ge.current)){if(ye==="all")ge.current.getRoot().focus();else if(typeof ye=="number"){const Ke=ge.current.getSectionContent(ye);Ke&&Ke.focus()}}},[ye,Ee]),la(()=>{nT({focused:Ee,domGetters:oe,stateResponse:fe})}),Te.useImperativeHandle(se,()=>({getSections:()=>de.sections,getActiveSectionIndex:()=>fP(ge),setSelectedSections:Ke=>{if(j||!ge.current)return;const Ue=Yw(Ke,de.sections);Oe((Ue==="all"?0:Ue)!==null),xe(Ke)},focusField:Be,isFieldFocused:()=>pP(ge)})),Nt({},r,at,{onBlur:At,onClick:It,onFocus:xt,onInput:cn,onPaste:jt,onKeyDown:ct,onClear:Se},ut,{error:K,clearable:!!(H&&!pe&&!V&&!j),focused:X??Ee,sectionListRef:ae,enableAccessibleFieldDOMStructure:!0,elements:mt,areAllSectionsEmpty:pe,disabled:j,readOnly:V,autoFocus:Z,openPickerAriaLabel:Re})};function fP(t){const s=Dl(t.current?.getRoot());return!s||!t.current||!t.current.getRoot().contains(s)?null:t.current.getSectionIndexFromDOMElement(s)}function pP(t){const s=Dl(t.current?.getRoot());return!!t.current&&t.current.getRoot().contains(s)}const Qg=t=>t.replace(/[\u2066\u2067\u2068\u2069]/g,""),EH=(t,s,c)=>{let p=0,g=c?1:0;const v=[];for(let S=0;S<t.length;S+=1){const r=t[S],E=ZS(r,c?"input-rtl":"input-ltr",s),A=`${r.startSeparator}${E}${r.endSeparator}`,I=Qg(A).length,F=A.length,z=Qg(E),R=g+(z===""?0:E.indexOf(z[0]))+r.startSeparator.length,D=R+z.length;v.push(Nt({},r,{start:p,end:p+I,startInInput:R,endInInput:D})),p+=I,g+=F}return v},AH=t=>{const s=Su(),c=Lp(),p=Lp(),{props:g,manager:v,skipContextFieldRefAssignment:S,manager:{valueType:r,internal_valueManager:E,internal_fieldValueManager:A,internal_useOpenPickerButtonAriaLabel:I}}=t,{internalProps:F,forwardedProps:z}=ER(g,r),R=tD({manager:v,internalProps:F,skipContextFieldRefAssignment:S}),{onFocus:D,onClick:O,onPaste:N,onBlur:H,onKeyDown:j,onClear:V,clearable:Z,inputRef:X,placeholder:se}=z,{readOnly:ge=!1,disabled:ae=!1,autoFocus:oe=!1,focused:fe,unstableFieldRef:pe}=R,K=Te.useRef(null),ye=So(X,K),J=eD({manager:v,internalPropsWithDefaults:R,forwardedProps:z}),{activeSectionIndex:de,areAllSectionsEmpty:Ae,error:ne,localizedDigits:xe,parsedSelectedSections:Ce,sectionOrder:Re,state:Ee,value:Oe,clearValue:Be,clearActiveSection:at,setCharacterQuery:ut,setSelectedSections:nt,setTempAndroidValueStr:$e,updateSectionValue:ct,updateValueFromValueStr:At,getSectionsFromValue:xt}=J,It=JR({stateResponse:J}),jt=I(Oe),cn=Te.useMemo(()=>EH(Ee.sections,xe,s),[Ee.sections,xe,s]);function Se(){const On=K.current.selectionStart??0;let Bn;On<=cn[0].startInInput||On>=cn[cn.length-1].endInInput?Bn=1:Bn=cn.findIndex(Pr=>Pr.startInInput-Pr.startSeparator.length>On);const kn=Bn===-1?cn.length-1:Bn-1;nt(kn)}function mt(On=0){Dl(K.current)!==K.current&&(K.current?.focus(),nt(On))}const Ke=_r(On=>{D?.(On);const Bn=K.current;c.start(0,()=>{!Bn||Bn!==K.current||de==null&&(Bn.value.length&&Number(Bn.selectionEnd)-Number(Bn.selectionStart)===Bn.value.length?nt("all"):Se())})}),Ue=_r((On,...Bn)=>{On.isDefaultPrevented()||(O?.(On,...Bn),Se())}),je=_r(On=>{if(N?.(On),On.preventDefault(),ge||ae)return;const Bn=On.clipboardData.getData("text");if(typeof Ce=="number"){const kn=Ee.sections[Ce],Pr=/^[a-zA-Z]+$/.test(Bn),mr=/^[0-9]+$/.test(Bn),ni=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(Bn);if(kn.contentType==="letter"&&Pr||kn.contentType==="digit"&&mr||kn.contentType==="digit-with-letter"&&ni){ut(null),ct({section:kn,newSectionValue:Bn,shouldGoToNextSection:!0});return}if(Pr||mr)return}ut(null),At(Bn)}),gt=_r(On=>{H?.(On),nt(null)}),Ot=_r(On=>{if(ge)return;const Bn=On.target.value;if(Bn===""){Be();return}const kn=On.nativeEvent.data,Pr=kn&&kn.length>1,mr=Pr?kn:Bn,ni=Qg(mr);if(Ce==="all"&&nt(de),de==null||Pr){At(Pr?kn:ni);return}let tr;if(Ce==="all"&&ni.length===1)tr=ni;else{const Br=Qg(A.getV6InputValueFromSections(cn,xe,s));let Tr=-1,Fr=-1;for(let Yr=0;Yr<Br.length;Yr+=1)Tr===-1&&Br[Yr]!==ni[Yr]&&(Tr=Yr),Fr===-1&&Br[Br.length-Yr-1]!==ni[ni.length-Yr-1]&&(Fr=Yr);const di=cn[de];if(Tr<di.start||Br.length-Fr-1>di.end)return;const ds=ni.length-Br.length+di.end-Qg(di.endSeparator||"").length;tr=ni.slice(di.start+Qg(di.startSeparator||"").length,ds)}if(tr.length===0){AG()&&$e(mr),at();return}It({keyPressed:tr,sectionIndex:de})}),Ft=_r((On,...Bn)=>{On.preventDefault(),V?.(On,...Bn),Be(),mP(K)?nt(Re.startIndex):mt(0)}),pt=nD({manager:v,internalPropsWithDefaults:R,stateResponse:J}),dn=_r(On=>{j?.(On),pt(On)}),An=Te.useMemo(()=>se!==void 0?se:A.getV6InputValueFromSections(xt(E.emptyValue),xe,s),[se,A,xt,E.emptyValue,xe,s]),Gt=Te.useMemo(()=>Ee.tempValueStrAndroid??A.getV6InputValueFromSections(Ee.sections,xe,s),[Ee.sections,A,Ee.tempValueStrAndroid,xe,s]);Te.useEffect(()=>{K.current&&K.current===Dl(K.current)&&nt("all")},[]),la(()=>{function On(){if(!K.current)return;if(Ce==null){K.current.scrollLeft&&(K.current.scrollLeft=0);return}if(K.current!==Dl(K.current))return;const Bn=K.current.scrollTop;if(Ce==="all")K.current.select();else{const kn=cn[Ce],Pr=kn.type==="empty"?kn.startInInput-kn.startSeparator.length:kn.startInInput,mr=kn.type==="empty"?kn.endInInput+kn.endSeparator.length:kn.endInInput;(Pr!==K.current.selectionStart||mr!==K.current.selectionEnd)&&K.current===Dl(K.current)&&K.current.setSelectionRange(Pr,mr),p.start(0,()=>{K.current&&K.current===Dl(K.current)&&K.current.selectionStart===K.current.selectionEnd&&(K.current.selectionStart!==Pr||K.current.selectionEnd!==mr)&&On()})}K.current.scrollTop=Bn}On()});const Yt=Te.useMemo(()=>de==null||Ee.sections[de].contentType==="letter"?"text":"numeric",[de,Ee.sections]),$n=!(K.current&&K.current===Dl(K.current))&&Ae;return Te.useImperativeHandle(pe,()=>({getSections:()=>Ee.sections,getActiveSectionIndex:()=>{const On=K.current.selectionStart??0,Bn=K.current.selectionEnd??0;if(On===0&&Bn===0)return null;const kn=On<=cn[0].startInInput?1:cn.findIndex(Pr=>Pr.startInInput-Pr.startSeparator.length>On);return kn===-1?cn.length-1:kn-1},setSelectedSections:On=>nt(On),focusField:mt,isFieldFocused:()=>mP(K)})),Nt({},z,{error:ne,clearable:!!(Z&&!Ae&&!ge&&!ae),onBlur:gt,onClick:Ue,onFocus:Ke,onPaste:je,onKeyDown:dn,onClear:Ft,inputRef:ye,enableAccessibleFieldDOMStructure:!1,placeholder:An,inputMode:Yt,autoComplete:"off",value:$n?"":Gt,onChange:Ot,focused:fe,disabled:ae,readOnly:ge,autoFocus:oe,openPickerAriaLabel:jt})};function mP(t){return t.current===Dl(t.current)}const PH=t=>{const s=OR();return(t.props.enableAccessibleFieldDOMStructure??s?.enableAccessibleFieldDOMStructure??!0?CH:AH)(t)};function MH(t={}){const{enableAccessibleFieldDOMStructure:s=!0}=t;return Te.useMemo(()=>({valueType:"date",validator:cv,internal_valueManager:_h,internal_fieldValueManager:tH,internal_enableAccessibleFieldDOMStructure:s,internal_useApplyDefaultValuesToFieldInternalProps:RH,internal_useOpenPickerButtonAriaLabel:IH}),[s])}function IH(t){const s=Ko(),c=Up();return Te.useMemo(()=>{const p=s.isValid(t)?s.format(t,"fullDate"):null;return c.openDatePickerDialogue(p)},[t,c,s])}function RH(t){const s=Ko(),c=uv(t);return Te.useMemo(()=>Nt({},t,c,{format:t.format??s.formats.keyboardDate}),[t,c,s])}function uv(t){const s=Ko(),c=FG();return Te.useMemo(()=>({disablePast:t.disablePast??!1,disableFuture:t.disableFuture??!1,minDate:Y4(s,t.minDate,c.minDate),maxDate:Y4(s,t.maxDate,c.maxDate)}),[t.minDate,t.maxDate,t.disableFuture,t.disablePast,s,c])}const DH=t=>{const s=MH(t);return PH({manager:s,props:t})};function y1(t){return parseInt(t,10)||0}const kH={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function OH(t){for(const s in t)return!1;return!0}function gP(t){return OH(t)||t.outerHeightStyle===0&&!t.overflowing}const LH=Te.forwardRef(function(s,c){const{onChange:p,maxRows:g,minRows:v=1,style:S,value:r,...E}=s,{current:A}=Te.useRef(r!=null),I=Te.useRef(null),F=So(c,I),z=Te.useRef(null),R=Te.useRef(null),D=Te.useCallback(()=>{const V=I.current,Z=R.current;if(!V||!Z)return;const se=gf(V).getComputedStyle(V);if(se.width==="0px")return{outerHeightStyle:0,overflowing:!1};Z.style.width=se.width,Z.value=V.value||s.placeholder||"x",Z.value.slice(-1)===`
`&&(Z.value+=" ");const ge=se.boxSizing,ae=y1(se.paddingBottom)+y1(se.paddingTop),oe=y1(se.borderBottomWidth)+y1(se.borderTopWidth),fe=Z.scrollHeight;Z.value="x";const pe=Z.scrollHeight;let K=fe;v&&(K=Math.max(Number(v)*pe,K)),g&&(K=Math.min(Number(g)*pe,K)),K=Math.max(K,pe);const ye=K+(ge==="border-box"?ae+oe:0),J=Math.abs(K-fe)<=1;return{outerHeightStyle:ye,overflowing:J}},[g,v,s.placeholder]),O=_r(()=>{const V=I.current,Z=D();if(!V||!Z||gP(Z))return!1;const X=Z.outerHeightStyle;return z.current!=null&&z.current!==X}),N=Te.useCallback(()=>{const V=I.current,Z=D();if(!V||!Z||gP(Z))return;const X=Z.outerHeightStyle;z.current!==X&&(z.current=X,V.style.height=`${X}px`),V.style.overflow=Z.overflowing?"hidden":""},[D]),H=Te.useRef(-1);la(()=>{const V=BR(N),Z=I?.current;if(!Z)return;const X=gf(Z);X.addEventListener("resize",V);let se;return typeof ResizeObserver<"u"&&(se=new ResizeObserver(()=>{O()&&(se.unobserve(Z),cancelAnimationFrame(H.current),N(),H.current=requestAnimationFrame(()=>{se.observe(Z)}))}),se.observe(Z)),()=>{V.clear(),cancelAnimationFrame(H.current),X.removeEventListener("resize",V),se&&se.disconnect()}},[D,N,O]),la(()=>{N()});const j=V=>{A||N();const Z=V.target,X=Z.value.length,se=Z.value.endsWith(`
`),ge=Z.selectionStart===X;se&&ge&&Z.setSelectionRange(X,X),p&&p(V)};return ue.jsxs(Te.Fragment,{children:[ue.jsx("textarea",{value:r,onChange:j,ref:F,rows:v,style:S,...E}),ue.jsx("textarea",{"aria-hidden":!0,className:s.className,readOnly:!0,ref:R,tabIndex:-1,style:{...kH.shadow,...S,paddingTop:0,paddingBottom:0}})]})});function b_({props:t,states:s,muiFormControl:c}){return s.reduce((p,g)=>(p[g]=t[g],c&&typeof t[g]>"u"&&(p[g]=c[g]),p),{})}const sb=Te.createContext(void 0);function yf(){return Te.useContext(sb)}function _P(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function yx(t,s=!1){return t&&(_P(t.value)&&t.value!==""||s&&_P(t.defaultValue)&&t.defaultValue!=="")}function zH(t){return t.startAdornment}function FH(t){return ui("MuiInputBase",t)}const u_=oi("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var yP;const ab=(t,s)=>{const{ownerState:c}=t;return[s.root,c.formControl&&s.formControl,c.startAdornment&&s.adornedStart,c.endAdornment&&s.adornedEnd,c.error&&s.error,c.size==="small"&&s.sizeSmall,c.multiline&&s.multiline,c.color&&s[`color${ar(c.color)}`],c.fullWidth&&s.fullWidth,c.hiddenLabel&&s.hiddenLabel]},lb=(t,s)=>{const{ownerState:c}=t;return[s.input,c.size==="small"&&s.inputSizeSmall,c.multiline&&s.inputMultiline,c.type==="search"&&s.inputTypeSearch,c.startAdornment&&s.inputAdornedStart,c.endAdornment&&s.inputAdornedEnd,c.hiddenLabel&&s.inputHiddenLabel]},BH=t=>{const{classes:s,color:c,disabled:p,error:g,endAdornment:v,focused:S,formControl:r,fullWidth:E,hiddenLabel:A,multiline:I,readOnly:F,size:z,startAdornment:R,type:D}=t,O={root:["root",`color${ar(c)}`,p&&"disabled",g&&"error",E&&"fullWidth",S&&"focused",r&&"formControl",z&&z!=="medium"&&`size${ar(z)}`,I&&"multiline",R&&"adornedStart",v&&"adornedEnd",A&&"hiddenLabel",F&&"readOnly"],input:["input",p&&"disabled",D==="search"&&"inputTypeSearch",I&&"inputMultiline",z==="small"&&"inputSizeSmall",A&&"inputHiddenLabel",R&&"inputAdornedStart",v&&"inputAdornedEnd",F&&"readOnly"]};return ti(O,FH,s)},cb=Cn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:ab})(_o(({theme:t})=>({...t.typography.body1,color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${u_.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:s})=>s.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:s,size:c})=>s.multiline&&c==="small",style:{paddingTop:1}},{props:({ownerState:s})=>s.fullWidth,style:{width:"100%"}}]}))),ub=Cn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:lb})(_o(({theme:t})=>{const s=t.palette.mode==="light",c={color:"currentColor",...t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:s?.42:.5},transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})},p={opacity:"0 !important"},g=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:s?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":c,"&::-moz-placeholder":c,"&::-ms-input-placeholder":c,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${u_.formControl} &`]:{"&::-webkit-input-placeholder":p,"&::-moz-placeholder":p,"&::-ms-input-placeholder":p,"&:focus::-webkit-input-placeholder":g,"&:focus::-moz-placeholder":g,"&:focus::-ms-input-placeholder":g},[`&.${u_.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},variants:[{props:({ownerState:v})=>!v.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:v})=>v.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),vP=PV({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),rT=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiInputBase"}),{"aria-describedby":g,autoComplete:v,autoFocus:S,className:r,color:E,components:A={},componentsProps:I={},defaultValue:F,disabled:z,disableInjectingGlobalStyles:R,endAdornment:D,error:O,fullWidth:N=!1,id:H,inputComponent:j="input",inputProps:V={},inputRef:Z,margin:X,maxRows:se,minRows:ge,multiline:ae=!1,name:oe,onBlur:fe,onChange:pe,onClick:K,onFocus:ye,onKeyDown:J,onKeyUp:de,placeholder:Ae,readOnly:ne,renderSuffix:xe,rows:Ce,size:Re,slotProps:Ee={},slots:Oe={},startAdornment:Be,type:at="text",value:ut,...nt}=p,$e=V.value!=null?V.value:ut,{current:ct}=Te.useRef($e!=null),At=Te.useRef(),xt=Te.useCallback(kn=>{},[]),It=So(At,Z,V.ref,xt),[jt,cn]=Te.useState(!1),Se=yf(),mt=b_({props:p,muiFormControl:Se,states:["color","disabled","error","hiddenLabel","size","required","filled"]});mt.focused=Se?Se.focused:jt,Te.useEffect(()=>{!Se&&z&&jt&&(cn(!1),fe&&fe())},[Se,z,jt,fe]);const Ke=Se&&Se.onFilled,Ue=Se&&Se.onEmpty,je=Te.useCallback(kn=>{yx(kn)?Ke&&Ke():Ue&&Ue()},[Ke,Ue]);la(()=>{ct&&je({value:$e})},[$e,je,ct]);const gt=kn=>{ye&&ye(kn),V.onFocus&&V.onFocus(kn),Se&&Se.onFocus?Se.onFocus(kn):cn(!0)},Ot=kn=>{fe&&fe(kn),V.onBlur&&V.onBlur(kn),Se&&Se.onBlur?Se.onBlur(kn):cn(!1)},Ft=(kn,...Pr)=>{if(!ct){const mr=kn.target||At.current;if(mr==null)throw new Error(pf(1));je({value:mr.value})}V.onChange&&V.onChange(kn,...Pr),pe&&pe(kn,...Pr)};Te.useEffect(()=>{je(At.current)},[]);const pt=kn=>{At.current&&kn.currentTarget===kn.target&&At.current.focus(),K&&K(kn)};let dn=j,An=V;ae&&dn==="input"&&(Ce?An={type:void 0,minRows:Ce,maxRows:Ce,...An}:An={type:void 0,maxRows:se,minRows:ge,...An},dn=LH);const Gt=kn=>{je(kn.animationName==="mui-auto-fill-cancel"?At.current:{value:"x"})};Te.useEffect(()=>{Se&&Se.setAdornedStart(!!Be)},[Se,Be]);const Yt={...p,color:mt.color||"primary",disabled:mt.disabled,endAdornment:D,error:mt.error,focused:mt.focused,formControl:Se,fullWidth:N,hiddenLabel:mt.hiddenLabel,multiline:ae,size:mt.size,startAdornment:Be,type:at},zn=BH(Yt),$n=Oe.root||A.Root||cb,On=Ee.root||I.root||{},Bn=Oe.input||A.Input||ub;return An={...An,...Ee.input??I.input},ue.jsxs(Te.Fragment,{children:[!R&&typeof vP=="function"&&(yP||(yP=ue.jsx(vP,{}))),ue.jsxs($n,{...On,ref:c,onClick:pt,...nt,...!dh($n)&&{ownerState:{...Yt,...On.ownerState}},className:Ar(zn.root,On.className,r,ne&&"MuiInputBase-readOnly"),children:[Be,ue.jsx(sb.Provider,{value:null,children:ue.jsx(Bn,{"aria-invalid":mt.error,"aria-describedby":g,autoComplete:v,autoFocus:S,defaultValue:F,disabled:mt.disabled,id:H,onAnimationStart:Gt,name:oe,placeholder:Ae,readOnly:ne,required:mt.required,rows:Ce,value:$e,onKeyDown:J,onKeyUp:de,type:at,...An,...!dh(Bn)&&{as:dn,ownerState:{...Yt,...An.ownerState}},ref:It,className:Ar(zn.input,An.className,ne&&"MuiInputBase-readOnly"),onBlur:Ot,onChange:Ft,onFocus:gt})}),D,xe?xe({...mt,startAdornment:Be}):null]})]})});function NH(t){return ui("MuiInput",t)}const hy={...u_,...oi("MuiInput",["root","underline","input"])},VH=t=>{const{classes:s,disableUnderline:c}=t,g=ti({root:["root",!c&&"underline"],input:["input"]},NH,s);return{...s,...g}},UH=Cn(cb,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[...ab(t,s),!c.disableUnderline&&s.underline]}})(_o(({theme:t})=>{let c=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(c=t.alpha(t.vars.palette.common.onBackground,t.vars.opacity.inputUnderline)),{position:"relative",variants:[{props:({ownerState:p})=>p.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:p})=>!p.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${hy.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${hy.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${c}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${hy.disabled}, .${hy.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${c}`}},[`&.${hy.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(il()).map(([p])=>({props:{color:p,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[p].main}`}}}))]}})),jH=Cn(ub,{name:"MuiInput",slot:"Input",overridesResolver:lb})({}),iT=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiInput"}),{disableUnderline:g=!1,components:v={},componentsProps:S,fullWidth:r=!1,inputComponent:E="input",multiline:A=!1,slotProps:I,slots:F={},type:z="text",...R}=p,D=VH(p),N={root:{ownerState:{disableUnderline:g}}},H=I??S?sl(I??S,N):N,j=F.root??v.Root??UH,V=F.input??v.Input??jH;return ue.jsx(rT,{slots:{root:j,input:V},slotProps:H,fullWidth:r,inputComponent:E,multiline:A,ref:c,type:z,...R,classes:D})});iT.muiName="Input";function GH(t){return ui("MuiFilledInput",t)}const km={...u_,...oi("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},$H=t=>{const{classes:s,disableUnderline:c,startAdornment:p,endAdornment:g,size:v,hiddenLabel:S,multiline:r}=t,E={root:["root",!c&&"underline",p&&"adornedStart",g&&"adornedEnd",v==="small"&&`size${ar(v)}`,S&&"hiddenLabel",r&&"multiline"],input:["input"]},A=ti(E,GH,s);return{...s,...A}},HH=Cn(cb,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[...ab(t,s),!c.disableUnderline&&s.underline]}})(_o(({theme:t})=>{const s=t.palette.mode==="light",c=s?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",p=s?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",g=s?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",v=s?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:g,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p}},[`&.${km.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p},[`&.${km.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:v},variants:[{props:({ownerState:S})=>!S.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${km.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${km.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?t.alpha(t.vars.palette.common.onBackground,t.vars.opacity.inputUnderline):c}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${km.disabled}, .${km.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${km.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(il()).map(([S])=>({props:{disableUnderline:!1,color:S},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[S]?.main}`}}})),{props:({ownerState:S})=>S.startAdornment,style:{paddingLeft:12}},{props:({ownerState:S})=>S.endAdornment,style:{paddingRight:12}},{props:({ownerState:S})=>S.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:S,size:r})=>S.multiline&&r==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:S})=>S.multiline&&S.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:S})=>S.multiline&&S.hiddenLabel&&S.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),qH=Cn(ub,{name:"MuiFilledInput",slot:"Input",overridesResolver:lb})(_o(({theme:t})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:s})=>s.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:s})=>s.startAdornment,style:{paddingLeft:0}},{props:({ownerState:s})=>s.endAdornment,style:{paddingRight:0}},{props:({ownerState:s})=>s.hiddenLabel&&s.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:s})=>s.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),oT=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiFilledInput"}),{disableUnderline:g=!1,components:v={},componentsProps:S,fullWidth:r=!1,hiddenLabel:E,inputComponent:A="input",multiline:I=!1,slotProps:F,slots:z={},type:R="text",...D}=p,O={...p,disableUnderline:g,fullWidth:r,inputComponent:A,multiline:I,type:R},N=$H(p),H={root:{ownerState:O},input:{ownerState:O}},j=F??S?sl(H,F??S):H,V=z.root??v.Root??HH,Z=z.input??v.Input??qH;return ue.jsx(rT,{slots:{root:V,input:Z},slotProps:j,fullWidth:r,inputComponent:A,multiline:I,ref:c,type:R,...D,classes:N})});oT.muiName="Input";var xP;const WH=Cn("fieldset",{name:"MuiNotchedOutlined",shouldForwardProp:hd})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),ZH=Cn("legend",{name:"MuiNotchedOutlined",shouldForwardProp:hd})(_o(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:s})=>!s.withLabel,style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:({ownerState:s})=>s.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:s})=>s.withLabel&&s.notched,style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]})));function YH(t){const{children:s,classes:c,className:p,label:g,notched:v,...S}=t,r=g!=null&&g!=="",E={...t,notched:v,withLabel:r};return ue.jsx(WH,{"aria-hidden":!0,className:p,ownerState:E,...S,children:ue.jsx(ZH,{ownerState:E,children:r?ue.jsx("span",{children:g}):xP||(xP=ue.jsx("span",{className:"notranslate","aria-hidden":!0,children:""}))})})}function XH(t){return ui("MuiOutlinedInput",t)}const oh={...u_,...oi("MuiOutlinedInput",["root","notchedOutline","input"])},KH=t=>{const{classes:s}=t,p=ti({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},XH,s);return{...s,...p}},JH=Cn(cb,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:ab})(_o(({theme:t})=>{const s=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${oh.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${oh.notchedOutline}`]:{borderColor:t.vars?t.alpha(t.vars.palette.common.onBackground,.23):s}},[`&.${oh.focused} .${oh.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(t.palette).filter(il()).map(([c])=>({props:{color:c},style:{[`&.${oh.focused} .${oh.notchedOutline}`]:{borderColor:(t.vars||t).palette[c].main}}})),{props:{},style:{[`&.${oh.error} .${oh.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${oh.disabled} .${oh.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}}},{props:({ownerState:c})=>c.startAdornment,style:{paddingLeft:14}},{props:({ownerState:c})=>c.endAdornment,style:{paddingRight:14}},{props:({ownerState:c})=>c.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:c,size:p})=>c.multiline&&p==="small",style:{padding:"8.5px 14px"}}]}})),QH=Cn(YH,{name:"MuiOutlinedInput",slot:"NotchedOutline"})(_o(({theme:t})=>{const s=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?t.alpha(t.vars.palette.common.onBackground,.23):s}})),eq=Cn(ub,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:lb})(_o(({theme:t})=>({padding:"16.5px 14px",...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:s})=>s.multiline,style:{padding:0}},{props:({ownerState:s})=>s.startAdornment,style:{paddingLeft:0}},{props:({ownerState:s})=>s.endAdornment,style:{paddingRight:0}}]}))),sT=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiOutlinedInput"}),{components:g={},fullWidth:v=!1,inputComponent:S="input",label:r,multiline:E=!1,notched:A,slots:I={},slotProps:F={},type:z="text",...R}=p,D=KH(p),O=yf(),N=b_({props:p,muiFormControl:O,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),H={...p,color:N.color||"primary",disabled:N.disabled,error:N.error,focused:N.focused,formControl:O,fullWidth:v,hiddenLabel:N.hiddenLabel,multiline:E,size:N.size,type:z},j=I.root??g.Root??JH,V=I.input??g.Input??eq,[Z,X]=gs("notchedOutline",{elementType:QH,className:D.notchedOutline,shouldForwardComponentProp:!0,ownerState:H,externalForwardedProps:{slots:I,slotProps:F},additionalProps:{label:r!=null&&r!==""&&N.required?ue.jsxs(Te.Fragment,{children:[r,"","*"]}):r}});return ue.jsx(rT,{slots:{root:j,input:V},slotProps:F,renderSuffix:se=>ue.jsx(Z,{...X,notched:typeof A<"u"?A:!!(se.startAdornment||se.filled||se.focused)}),fullWidth:v,inputComponent:S,multiline:E,ref:c,type:z,...R,classes:{...D,notchedOutline:null}})});sT.muiName="Input";function tq(t){return ui("MuiFormLabel",t)}const Py=oi("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),nq=t=>{const{classes:s,color:c,focused:p,disabled:g,error:v,filled:S,required:r}=t,E={root:["root",`color${ar(c)}`,g&&"disabled",v&&"error",S&&"filled",p&&"focused",r&&"required"],asterisk:["asterisk",v&&"error"]};return ti(E,tq,s)},rq=Cn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.color==="secondary"&&s.colorSecondary,c.filled&&s.filled]}})(_o(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(t.palette).filter(il()).map(([s])=>({props:{color:s},style:{[`&.${Py.focused}`]:{color:(t.vars||t).palette[s].main}}})),{props:{},style:{[`&.${Py.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Py.error}`]:{color:(t.vars||t).palette.error.main}}}]}))),iq=Cn("span",{name:"MuiFormLabel",slot:"Asterisk"})(_o(({theme:t})=>({[`&.${Py.error}`]:{color:(t.vars||t).palette.error.main}}))),oq=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiFormLabel"}),{children:g,className:v,color:S,component:r="label",disabled:E,error:A,filled:I,focused:F,required:z,...R}=p,D=yf(),O=b_({props:p,muiFormControl:D,states:["color","required","focused","disabled","error","filled"]}),N={...p,color:O.color||"primary",component:r,disabled:O.disabled,error:O.error,filled:O.filled,focused:O.focused,required:O.required},H=nq(N);return ue.jsxs(rq,{as:r,ownerState:N,className:Ar(H.root,v),ref:c,...R,children:[g,O.required&&ue.jsxs(iq,{ownerState:N,"aria-hidden":!0,className:H.asterisk,children:["","*"]})]})});function sq(t){return ui("MuiInputLabel",t)}oi("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const aq=t=>{const{classes:s,formControl:c,size:p,shrink:g,disableAnimation:v,variant:S,required:r}=t,E={root:["root",c&&"formControl",!v&&"animated",g&&"shrink",p&&p!=="medium"&&`size${ar(p)}`,S],asterisk:[r&&"asterisk"]},A=ti(E,sq,s);return{...s,...A}},lq=Cn(oq,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[{[`& .${Py.asterisk}`]:s.asterisk},s.root,c.formControl&&s.formControl,c.size==="small"&&s.sizeSmall,c.shrink&&s.shrink,!c.disableAnimation&&s.animated,c.focused&&s.focused,s[c.variant]]}})(_o(({theme:t})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:s})=>s.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:s})=>s.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:s})=>!s.disableAnimation,style:{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:s,ownerState:c})=>s==="filled"&&c.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:s,ownerState:c,size:p})=>s==="filled"&&c.shrink&&p==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:s,ownerState:c})=>s==="outlined"&&c.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),rD=Te.forwardRef(function(s,c){const p=To({name:"MuiInputLabel",props:s}),{disableAnimation:g=!1,margin:v,shrink:S,variant:r,className:E,...A}=p,I=yf();let F=S;typeof F>"u"&&I&&(F=I.filled||I.focused||I.adornedStart);const z=b_({props:p,muiFormControl:I,states:["size","variant","required","focused"]}),R={...p,disableAnimation:g,formControl:I,shrink:F,size:z.size,variant:z.variant,required:z.required,focused:z.focused},D=aq(R);return ue.jsx(lq,{"data-shrink":F,ref:c,className:Ar(D.root,E),...A,ownerState:R,classes:D})});function cq(t){return ui("MuiFormControl",t)}oi("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const uq=t=>{const{classes:s,margin:c,fullWidth:p}=t,g={root:["root",c!=="none"&&`margin${ar(c)}`,p&&"fullWidth"]};return ti(g,cq,s)},dq=Cn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,s[`margin${ar(c.margin)}`],c.fullWidth&&s.fullWidth]}})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),iD=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiFormControl"}),{children:g,className:v,color:S="primary",component:r="div",disabled:E=!1,error:A=!1,focused:I,fullWidth:F=!1,hiddenLabel:z=!1,margin:R="none",required:D=!1,size:O="medium",variant:N="outlined",...H}=p,j={...p,color:S,component:r,disabled:E,error:A,fullWidth:F,hiddenLabel:z,margin:R,required:D,size:O,variant:N},V=uq(j),[Z,X]=Te.useState(()=>{let de=!1;return g&&Te.Children.forEach(g,Ae=>{if(!W1(Ae,["Input","Select"]))return;const ne=W1(Ae,["Select"])?Ae.props.input:Ae;ne&&zH(ne.props)&&(de=!0)}),de}),[se,ge]=Te.useState(()=>{let de=!1;return g&&Te.Children.forEach(g,Ae=>{W1(Ae,["Input","Select"])&&(yx(Ae.props,!0)||yx(Ae.props.inputProps,!0))&&(de=!0)}),de}),[ae,oe]=Te.useState(!1);E&&ae&&oe(!1);const fe=I!==void 0&&!E?I:ae;let pe;Te.useRef(!1);const K=Te.useCallback(()=>{ge(!0)},[]),ye=Te.useCallback(()=>{ge(!1)},[]),J=Te.useMemo(()=>({adornedStart:Z,setAdornedStart:X,color:S,disabled:E,error:A,filled:se,focused:fe,fullWidth:F,hiddenLabel:z,size:O,onBlur:()=>{oe(!1)},onFocus:()=>{oe(!0)},onEmpty:ye,onFilled:K,registerEffect:pe,required:D,variant:N}),[Z,S,E,A,se,fe,F,z,pe,ye,K,D,O,N]);return ue.jsx(sb.Provider,{value:J,children:ue.jsx(dq,{as:r,ownerState:j,className:Ar(V.root,v),ref:c,...H,children:g})})});function hq(t){return ui("MuiFormHelperText",t)}const bP=oi("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var wP;const fq=t=>{const{classes:s,contained:c,size:p,disabled:g,error:v,filled:S,focused:r,required:E}=t,A={root:["root",g&&"disabled",v&&"error",p&&`size${ar(p)}`,c&&"contained",r&&"focused",S&&"filled",E&&"required"]};return ti(A,hq,s)},pq=Cn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.size&&s[`size${ar(c.size)}`],c.contained&&s.contained,c.filled&&s.filled]}})(_o(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${bP.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${bP.error}`]:{color:(t.vars||t).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:s})=>s.contained,style:{marginLeft:14,marginRight:14}}]}))),oD=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiFormHelperText"}),{children:g,className:v,component:S="p",disabled:r,error:E,filled:A,focused:I,margin:F,required:z,variant:R,...D}=p,O=yf(),N=b_({props:p,muiFormControl:O,states:["variant","size","disabled","error","filled","focused","required"]}),H={...p,component:S,contained:N.variant==="filled"||N.variant==="outlined",variant:N.variant,size:N.size,disabled:N.disabled,error:N.error,filled:N.filled,focused:N.focused,required:N.required};delete H.ownerState;const j=fq(H);return ue.jsx(pq,{as:S,className:Ar(j.root,v),ref:c,...D,ownerState:H,children:g===" "?wP||(wP=ue.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):g})});function dv(t){return parseInt(Te.version,10)>=19?t?.props?.ref||null:t?.ref||null}const sD=t=>t.scrollTop;function vx(t,s){const{timeout:c,easing:p,style:g={}}=t;return{duration:g.transitionDuration??(typeof c=="number"?c:c[s.mode]||0),easing:g.transitionTimingFunction??(typeof p=="object"?p[s.mode]:p),delay:g.transitionDelay}}function nS(t){return`scale(${t}, ${t**2})`}const mq={entering:{opacity:1,transform:nS(1)},entered:{opacity:1,transform:"none"}},cw=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),xx=Te.forwardRef(function(s,c){const{addEndListener:p,appear:g=!0,children:v,easing:S,in:r,onEnter:E,onEntered:A,onEntering:I,onExit:F,onExited:z,onExiting:R,style:D,timeout:O="auto",TransitionComponent:N=fd,...H}=s,j=Lp(),V=Te.useRef(),Z=y_(),X=Te.useRef(null),se=So(X,dv(v),c),ge=de=>Ae=>{if(de){const ne=X.current;Ae===void 0?de(ne):de(ne,Ae)}},ae=ge(I),oe=ge((de,Ae)=>{sD(de);const{duration:ne,delay:xe,easing:Ce}=vx({style:D,timeout:O,easing:S},{mode:"enter"});let Re;O==="auto"?(Re=Z.transitions.getAutoHeightDuration(de.clientHeight),V.current=Re):Re=ne,de.style.transition=[Z.transitions.create("opacity",{duration:Re,delay:xe}),Z.transitions.create("transform",{duration:cw?Re:Re*.666,delay:xe,easing:Ce})].join(","),E&&E(de,Ae)}),fe=ge(A),pe=ge(R),K=ge(de=>{const{duration:Ae,delay:ne,easing:xe}=vx({style:D,timeout:O,easing:S},{mode:"exit"});let Ce;O==="auto"?(Ce=Z.transitions.getAutoHeightDuration(de.clientHeight),V.current=Ce):Ce=Ae,de.style.transition=[Z.transitions.create("opacity",{duration:Ce,delay:ne}),Z.transitions.create("transform",{duration:cw?Ce:Ce*.666,delay:cw?ne:ne||Ce*.333,easing:xe})].join(","),de.style.opacity=0,de.style.transform=nS(.75),F&&F(de)}),ye=ge(z),J=de=>{O==="auto"&&j.start(V.current||0,de),p&&p(X.current,de)};return ue.jsx(N,{appear:g,in:r,nodeRef:X,onEnter:oe,onEntered:fe,onEntering:ae,onExit:K,onExited:ye,onExiting:pe,addEndListener:J,timeout:O==="auto"?null:O,...H,children:(de,{ownerState:Ae,...ne})=>Te.cloneElement(v,{style:{opacity:0,transform:nS(.75),visibility:de==="exited"&&!r?"hidden":void 0,...mq[de],...D,...v.props.style},ref:se,...ne})})});xx&&(xx.muiSupportAuto=!0);function gq(t){const s=As(t);return s.body===t?gf(t).innerWidth>s.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function My(t,s){s?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function SP(t){return parseInt(gf(t).getComputedStyle(t).paddingRight,10)||0}function _q(t){const c=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(t.tagName),p=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return c||p}function TP(t,s,c,p,g){const v=[s,c,...p];[].forEach.call(t.children,S=>{const r=!v.includes(S),E=!_q(S);r&&E&&My(S,g)})}function uw(t,s){let c=-1;return t.some((p,g)=>s(p)?(c=g,!0):!1),c}function yq(t,s){const c=[],p=t.container;if(!s.disableScrollLock){if(gq(p)){const S=qR(gf(p));c.push({value:p.style.paddingRight,property:"padding-right",el:p}),p.style.paddingRight=`${SP(p)+S}px`;const r=As(p).querySelectorAll(".mui-fixed");[].forEach.call(r,E=>{c.push({value:E.style.paddingRight,property:"padding-right",el:E}),E.style.paddingRight=`${SP(E)+S}px`})}let v;if(p.parentNode instanceof DocumentFragment)v=As(p).body;else{const S=p.parentElement,r=gf(p);v=S?.nodeName==="HTML"&&r.getComputedStyle(S).overflowY==="scroll"?S:p}c.push({value:v.style.overflow,property:"overflow",el:v},{value:v.style.overflowX,property:"overflow-x",el:v},{value:v.style.overflowY,property:"overflow-y",el:v}),v.style.overflow="hidden"}return()=>{c.forEach(({value:v,el:S,property:r})=>{v?S.style.setProperty(r,v):S.style.removeProperty(r)})}}function vq(t){const s=[];return[].forEach.call(t.children,c=>{c.getAttribute("aria-hidden")==="true"&&s.push(c)}),s}class xq{constructor(){this.modals=[],this.containers=[]}add(s,c){let p=this.modals.indexOf(s);if(p!==-1)return p;p=this.modals.length,this.modals.push(s),s.modalRef&&My(s.modalRef,!1);const g=vq(c);TP(c,s.mount,s.modalRef,g,!0);const v=uw(this.containers,S=>S.container===c);return v!==-1?(this.containers[v].modals.push(s),p):(this.containers.push({modals:[s],container:c,restore:null,hiddenSiblings:g}),p)}mount(s,c){const p=uw(this.containers,v=>v.modals.includes(s)),g=this.containers[p];g.restore||(g.restore=yq(g,c))}remove(s,c=!0){const p=this.modals.indexOf(s);if(p===-1)return p;const g=uw(this.containers,S=>S.modals.includes(s)),v=this.containers[g];if(v.modals.splice(v.modals.indexOf(s),1),this.modals.splice(p,1),v.modals.length===0)v.restore&&v.restore(),s.modalRef&&My(s.modalRef,c),TP(v.container,s.mount,s.modalRef,v.hiddenSiblings,!1),this.containers.splice(g,1);else{const S=v.modals[v.modals.length-1];S.modalRef&&My(S.modalRef,!1)}return p}isTopModal(s){return this.modals.length>0&&this.modals[this.modals.length-1]===s}}const bq=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function wq(t){const s=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(s)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:s}function Sq(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const s=p=>t.ownerDocument.querySelector(`input[type="radio"]${p}`);let c=s(`[name="${t.name}"]:checked`);return c||(c=s(`[name="${t.name}"]`)),c!==t}function Tq(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||Sq(t))}function Cq(t){const s=[],c=[];return Array.from(t.querySelectorAll(bq)).forEach((p,g)=>{const v=wq(p);v===-1||!Tq(p)||(v===0?s.push(p):c.push({documentOrder:g,tabIndex:v,node:p}))}),c.sort((p,g)=>p.tabIndex===g.tabIndex?p.documentOrder-g.documentOrder:p.tabIndex-g.tabIndex).map(p=>p.node).concat(s)}function Eq(){return!0}function aD(t){const{children:s,disableAutoFocus:c=!1,disableEnforceFocus:p=!1,disableRestoreFocus:g=!1,getTabbable:v=Cq,isEnabled:S=Eq,open:r}=t,E=Te.useRef(!1),A=Te.useRef(null),I=Te.useRef(null),F=Te.useRef(null),z=Te.useRef(null),R=Te.useRef(!1),D=Te.useRef(null),O=So(dv(s),D),N=Te.useRef(null);Te.useEffect(()=>{!r||!D.current||(R.current=!c)},[c,r]),Te.useEffect(()=>{if(!r||!D.current)return;const V=As(D.current);return D.current.contains(V.activeElement)||(D.current.hasAttribute("tabIndex")||D.current.setAttribute("tabIndex","-1"),R.current&&D.current.focus()),()=>{g||(F.current&&F.current.focus&&(E.current=!0,F.current.focus()),F.current=null)}},[r]),Te.useEffect(()=>{if(!r||!D.current)return;const V=As(D.current),Z=ge=>{N.current=ge,!(p||!S()||ge.key!=="Tab")&&V.activeElement===D.current&&ge.shiftKey&&(E.current=!0,I.current&&I.current.focus())},X=()=>{const ge=D.current;if(ge===null)return;if(!V.hasFocus()||!S()||E.current){E.current=!1;return}if(ge.contains(V.activeElement)||p&&V.activeElement!==A.current&&V.activeElement!==I.current)return;if(V.activeElement!==z.current)z.current=null;else if(z.current!==null)return;if(!R.current)return;let ae=[];if((V.activeElement===A.current||V.activeElement===I.current)&&(ae=v(D.current)),ae.length>0){const oe=!!(N.current?.shiftKey&&N.current?.key==="Tab"),fe=ae[0],pe=ae[ae.length-1];typeof fe!="string"&&typeof pe!="string"&&(oe?pe.focus():fe.focus())}else ge.focus()};V.addEventListener("focusin",X),V.addEventListener("keydown",Z,!0);const se=setInterval(()=>{V.activeElement&&V.activeElement.tagName==="BODY"&&X()},50);return()=>{clearInterval(se),V.removeEventListener("focusin",X),V.removeEventListener("keydown",Z,!0)}},[c,p,g,S,r,v]);const H=V=>{F.current===null&&(F.current=V.relatedTarget),R.current=!0,z.current=V.target;const Z=s.props.onFocus;Z&&Z(V)},j=V=>{F.current===null&&(F.current=V.relatedTarget),R.current=!0};return ue.jsxs(Te.Fragment,{children:[ue.jsx("div",{tabIndex:r?0:-1,onFocus:j,ref:A,"data-testid":"sentinelStart"}),Te.cloneElement(s,{ref:O,onFocus:H}),ue.jsx("div",{tabIndex:r?0:-1,onFocus:j,ref:I,"data-testid":"sentinelEnd"})]})}function Aq(t){return typeof t=="function"?t():t}const lD=Te.forwardRef(function(s,c){const{children:p,container:g,disablePortal:v=!1}=s,[S,r]=Te.useState(null),E=So(Te.isValidElement(p)?dv(p):null,c);if(la(()=>{v||r(Aq(g)||document.body)},[g,v]),la(()=>{if(S&&!v)return oP(c,S),()=>{oP(c,null)}},[c,S,v]),v){if(Te.isValidElement(p)){const A={ref:E};return Te.cloneElement(p,A)}return p}return S&&IM.createPortal(p,S)}),Pq={entering:{opacity:1},entered:{opacity:1}},Ym=Te.forwardRef(function(s,c){const p=y_(),g={enter:p.transitions.duration.enteringScreen,exit:p.transitions.duration.leavingScreen},{addEndListener:v,appear:S=!0,children:r,easing:E,in:A,onEnter:I,onEntered:F,onEntering:z,onExit:R,onExited:D,onExiting:O,style:N,timeout:H=g,TransitionComponent:j=fd,...V}=s,Z=Te.useRef(null),X=So(Z,dv(r),c),se=J=>de=>{if(J){const Ae=Z.current;de===void 0?J(Ae):J(Ae,de)}},ge=se(z),ae=se((J,de)=>{sD(J);const Ae=vx({style:N,timeout:H,easing:E},{mode:"enter"});J.style.webkitTransition=p.transitions.create("opacity",Ae),J.style.transition=p.transitions.create("opacity",Ae),I&&I(J,de)}),oe=se(F),fe=se(O),pe=se(J=>{const de=vx({style:N,timeout:H,easing:E},{mode:"exit"});J.style.webkitTransition=p.transitions.create("opacity",de),J.style.transition=p.transitions.create("opacity",de),R&&R(J)}),K=se(D),ye=J=>{v&&v(Z.current,J)};return ue.jsx(j,{appear:S,in:A,nodeRef:Z,onEnter:ae,onEntered:oe,onEntering:ge,onExit:pe,onExited:K,onExiting:fe,addEndListener:ye,timeout:H,...V,children:(J,{ownerState:de,...Ae})=>Te.cloneElement(r,{style:{opacity:0,visibility:J==="exited"&&!A?"hidden":void 0,...Pq[J],...N,...r.props.style},ref:X,...Ae})})});function Mq(t){return ui("MuiBackdrop",t)}oi("MuiBackdrop",["root","invisible"]);const Iq=t=>{const{classes:s,invisible:c}=t;return ti({root:["root",c&&"invisible"]},Mq,s)},Rq=Cn("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.invisible&&s.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),cD=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiBackdrop"}),{children:g,className:v,component:S="div",invisible:r=!1,open:E,components:A={},componentsProps:I={},slotProps:F={},slots:z={},TransitionComponent:R,transitionDuration:D,...O}=p,N={...p,component:S,invisible:r},H=Iq(N),j={transition:R,root:A.Root,...z},V={...I,...F},Z={component:S,slots:j,slotProps:V},[X,se]=gs("root",{elementType:Rq,externalForwardedProps:Z,className:Ar(H.root,v),ownerState:N}),[ge,ae]=gs("transition",{elementType:Ym,externalForwardedProps:Z,ownerState:N});return ue.jsx(ge,{in:E,timeout:D,...O,...ae,children:ue.jsx(X,{"aria-hidden":!0,...se,classes:H,ref:c,children:g})})});function Dq(t){return typeof t=="function"?t():t}function kq(t){return t?t.props.hasOwnProperty("in"):!1}const CP=()=>{},v1=new xq;function Oq(t){const{container:s,disableEscapeKeyDown:c=!1,disableScrollLock:p=!1,closeAfterTransition:g=!1,onTransitionEnter:v,onTransitionExited:S,children:r,onClose:E,open:A,rootRef:I}=t,F=Te.useRef({}),z=Te.useRef(null),R=Te.useRef(null),D=So(R,I),[O,N]=Te.useState(!A),H=kq(r);let j=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(j=!1);const V=()=>As(z.current),Z=()=>(F.current.modalRef=R.current,F.current.mount=z.current,F.current),X=()=>{v1.mount(Z(),{disableScrollLock:p}),R.current&&(R.current.scrollTop=0)},se=_r(()=>{const de=Dq(s)||V().body;v1.add(Z(),de),R.current&&X()}),ge=()=>v1.isTopModal(Z()),ae=_r(de=>{z.current=de,de&&(A&&ge()?X():R.current&&My(R.current,j))}),oe=Te.useCallback(()=>{v1.remove(Z(),j)},[j]);Te.useEffect(()=>()=>{oe()},[oe]),Te.useEffect(()=>{A?se():(!H||!g)&&oe()},[A,oe,H,g,se]);const fe=de=>Ae=>{de.onKeyDown?.(Ae),!(Ae.key!=="Escape"||Ae.which===229||!ge())&&(c||(Ae.stopPropagation(),E&&E(Ae,"escapeKeyDown")))},pe=de=>Ae=>{de.onClick?.(Ae),Ae.target===Ae.currentTarget&&E&&E(Ae,"backdropClick")};return{getRootProps:(de={})=>{const Ae=Cy(t);delete Ae.onTransitionEnter,delete Ae.onTransitionExited;const ne={...Ae,...de};return{role:"presentation",...ne,onKeyDown:fe(ne),ref:D}},getBackdropProps:(de={})=>{const Ae=de;return{"aria-hidden":!0,...Ae,onClick:pe(Ae),open:A}},getTransitionProps:()=>{const de=()=>{N(!1),v&&v()},Ae=()=>{N(!0),S&&S(),g&&oe()};return{onEnter:iP(de,r?.props.onEnter??CP),onExited:iP(Ae,r?.props.onExited??CP)}},rootRef:D,portalRef:ae,isTopModal:ge,exited:O,hasTransition:H}}function Lq(t){return ui("MuiModal",t)}oi("MuiModal",["root","hidden","backdrop"]);const zq=t=>{const{open:s,exited:c,classes:p}=t;return ti({root:["root",!s&&c&&"hidden"],backdrop:["backdrop"]},Lq,p)},Fq=Cn("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,!c.open&&c.exited&&s.hidden]}})(_o(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:s})=>!s.open&&s.exited,style:{visibility:"hidden"}}]}))),Bq=Cn(cD,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),uD=Te.forwardRef(function(s,c){const p=To({name:"MuiModal",props:s}),{BackdropComponent:g=Bq,BackdropProps:v,classes:S,className:r,closeAfterTransition:E=!1,children:A,container:I,component:F,components:z={},componentsProps:R={},disableAutoFocus:D=!1,disableEnforceFocus:O=!1,disableEscapeKeyDown:N=!1,disablePortal:H=!1,disableRestoreFocus:j=!1,disableScrollLock:V=!1,hideBackdrop:Z=!1,keepMounted:X=!1,onClose:se,onTransitionEnter:ge,onTransitionExited:ae,open:oe,slotProps:fe={},slots:pe={},theme:K,...ye}=p,J={...p,closeAfterTransition:E,disableAutoFocus:D,disableEnforceFocus:O,disableEscapeKeyDown:N,disablePortal:H,disableRestoreFocus:j,disableScrollLock:V,hideBackdrop:Z,keepMounted:X},{getRootProps:de,getBackdropProps:Ae,getTransitionProps:ne,portalRef:xe,isTopModal:Ce,exited:Re,hasTransition:Ee}=Oq({...J,rootRef:c}),Oe={...J,exited:Re},Be=zq(Oe),at={};if(A.props.tabIndex===void 0&&(at.tabIndex="-1"),Ee){const{onEnter:xt,onExited:It}=ne();at.onEnter=xt,at.onExited=It}const ut={slots:{root:z.Root,backdrop:z.Backdrop,...pe},slotProps:{...R,...fe}},[nt,$e]=gs("root",{ref:c,elementType:Fq,externalForwardedProps:{...ut,...ye,component:F},getSlotProps:de,ownerState:Oe,className:Ar(r,Be?.root,!Oe.open&&Oe.exited&&Be?.hidden)}),[ct,At]=gs("backdrop",{ref:v?.ref,elementType:g,externalForwardedProps:ut,shouldForwardComponentProp:!0,additionalProps:v,getSlotProps:xt=>Ae({...xt,onClick:It=>{xt?.onClick&&xt.onClick(It)}}),className:Ar(v?.className,Be?.backdrop),ownerState:Oe});return!X&&!oe&&(!Ee||Re)?null:ue.jsx(lD,{ref:xe,container:I,disablePortal:H,children:ue.jsxs(nt,{...$e,children:[!Z&&g?ue.jsx(ct,{...At}):null,ue.jsx(aD,{disableEnforceFocus:O,disableAutoFocus:D,disableRestoreFocus:j,isEnabled:Ce,open:oe,children:Te.cloneElement(A,at)})]})})});function Nq(t){return ui("MuiPaper",t)}oi("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Vq=t=>{const{square:s,elevation:c,variant:p,classes:g}=t,v={root:["root",p,!s&&"rounded",p==="elevation"&&`elevation${c}`]};return ti(v,Nq,g)},Uq=Cn("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,s[c.variant],!c.square&&s.rounded,c.variant==="elevation"&&s[`elevation${c.elevation}`]]}})(_o(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:s})=>!s.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),db=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiPaper"}),g=y_(),{className:v,component:S="div",elevation:r=1,square:E=!1,variant:A="elevation",...I}=p,F={...p,component:S,elevation:r,square:E,variant:A},z=Vq(F);return ue.jsx(Uq,{as:S,ownerState:F,className:Ar(z.root,v),ref:c,...I,style:{...A==="elevation"&&{"--Paper-shadow":(g.vars||g).shadows[r],...g.vars&&{"--Paper-overlay":g.vars.overlays?.[r]},...!g.vars&&g.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${gh("#fff",jw(r))}, ${gh("#fff",jw(r))})`}},...I.style}})});function jq(t){return ui("MuiPopover",t)}oi("MuiPopover",["root","paper"]);function EP(t,s){let c=0;return typeof s=="number"?c=s:s==="center"?c=t.height/2:s==="bottom"&&(c=t.height),c}function AP(t,s){let c=0;return typeof s=="number"?c=s:s==="center"?c=t.width/2:s==="right"&&(c=t.width),c}function PP(t){return[t.horizontal,t.vertical].map(s=>typeof s=="number"?`${s}px`:s).join(" ")}function x1(t){return typeof t=="function"?t():t}const Gq=t=>{const{classes:s}=t;return ti({root:["root"],paper:["paper"]},jq,s)},$q=Cn(uD,{name:"MuiPopover",slot:"Root"})({}),dD=Cn(db,{name:"MuiPopover",slot:"Paper"})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Hq=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiPopover"}),{action:g,anchorEl:v,anchorOrigin:S={vertical:"top",horizontal:"left"},anchorPosition:r,anchorReference:E="anchorEl",children:A,className:I,container:F,elevation:z=8,marginThreshold:R=16,open:D,PaperProps:O={},slots:N={},slotProps:H={},transformOrigin:j={vertical:"top",horizontal:"left"},TransitionComponent:V,transitionDuration:Z="auto",TransitionProps:X={},disableScrollLock:se=!1,...ge}=p,ae=Te.useRef(),oe={...p,anchorOrigin:S,anchorReference:E,elevation:z,marginThreshold:R,transformOrigin:j,TransitionComponent:V,transitionDuration:Z,TransitionProps:X},fe=Gq(oe),pe=Te.useCallback(()=>{if(E==="anchorPosition")return r;const xt=x1(v),jt=(xt&&xt.nodeType===1?xt:As(ae.current).body).getBoundingClientRect();return{top:jt.top+EP(jt,S.vertical),left:jt.left+AP(jt,S.horizontal)}},[v,S.horizontal,S.vertical,r,E]),K=Te.useCallback(xt=>({vertical:EP(xt,j.vertical),horizontal:AP(xt,j.horizontal)}),[j.horizontal,j.vertical]),ye=Te.useCallback(xt=>{const It={width:xt.offsetWidth,height:xt.offsetHeight},jt=K(It);if(E==="none")return{top:null,left:null,transformOrigin:PP(jt)};const cn=pe();let Se=cn.top-jt.vertical,mt=cn.left-jt.horizontal;const Ke=Se+It.height,Ue=mt+It.width,je=gf(x1(v)),gt=je.innerHeight-R,Ot=je.innerWidth-R;if(R!==null&&Se<R){const Ft=Se-R;Se-=Ft,jt.vertical+=Ft}else if(R!==null&&Ke>gt){const Ft=Ke-gt;Se-=Ft,jt.vertical+=Ft}if(R!==null&&mt<R){const Ft=mt-R;mt-=Ft,jt.horizontal+=Ft}else if(Ue>Ot){const Ft=Ue-Ot;mt-=Ft,jt.horizontal+=Ft}return{top:`${Math.round(Se)}px`,left:`${Math.round(mt)}px`,transformOrigin:PP(jt)}},[v,E,pe,K,R]),[J,de]=Te.useState(D),Ae=Te.useCallback(()=>{const xt=ae.current;if(!xt)return;const It=ye(xt);It.top!==null&&xt.style.setProperty("top",It.top),It.left!==null&&(xt.style.left=It.left),xt.style.transformOrigin=It.transformOrigin,de(!0)},[ye]);Te.useEffect(()=>(se&&window.addEventListener("scroll",Ae),()=>window.removeEventListener("scroll",Ae)),[v,se,Ae]);const ne=()=>{Ae()},xe=()=>{de(!1)};Te.useEffect(()=>{D&&Ae()}),Te.useImperativeHandle(g,()=>D?{updatePosition:()=>{Ae()}}:null,[D,Ae]),Te.useEffect(()=>{if(!D)return;const xt=BR(()=>{Ae()}),It=gf(x1(v));return It.addEventListener("resize",xt),()=>{xt.clear(),It.removeEventListener("resize",xt)}},[v,D,Ae]);let Ce=Z;const Re={slots:{transition:V,...N},slotProps:{transition:X,paper:O,...H}},[Ee,Oe]=gs("transition",{elementType:xx,externalForwardedProps:Re,ownerState:oe,getSlotProps:xt=>({...xt,onEntering:(It,jt)=>{xt.onEntering?.(It,jt),ne()},onExited:It=>{xt.onExited?.(It),xe()}}),additionalProps:{appear:!0,in:D}});Z==="auto"&&!Ee.muiSupportAuto&&(Ce=void 0);const Be=F||(v?As(x1(v)).body:void 0),[at,{slots:ut,slotProps:nt,...$e}]=gs("root",{ref:c,elementType:$q,externalForwardedProps:{...Re,...ge},shouldForwardComponentProp:!0,additionalProps:{slots:{backdrop:N.backdrop},slotProps:{backdrop:WG(typeof H.backdrop=="function"?H.backdrop(oe):H.backdrop,{invisible:!0})},container:Be,open:D},ownerState:oe,className:Ar(fe.root,I)}),[ct,At]=gs("paper",{ref:ae,className:fe.paper,elementType:dD,externalForwardedProps:Re,shouldForwardComponentProp:!0,additionalProps:{elevation:z,style:J?void 0:{opacity:0}},ownerState:oe});return ue.jsx(at,{...$e,...!dh(at)&&{slots:ut,slotProps:nt,disableScrollLock:se},children:ue.jsx(Ee,{...Oe,timeout:Ce,children:ue.jsx(ct,{...At,children:A})})})});function qq(t){return ui("MuiMenu",t)}oi("MuiMenu",["root","paper","list"]);const Wq={vertical:"top",horizontal:"right"},Zq={vertical:"top",horizontal:"left"},Yq=t=>{const{classes:s}=t;return ti({root:["root"],paper:["paper"],list:["list"]},qq,s)},Xq=Cn(Hq,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiMenu",slot:"Root"})({}),Kq=Cn(dD,{name:"MuiMenu",slot:"Paper"})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Jq=Cn(oH,{name:"MuiMenu",slot:"List"})({outline:0}),Qq=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiMenu"}),{autoFocus:g=!0,children:v,className:S,disableAutoFocusItem:r=!1,MenuListProps:E={},onClose:A,open:I,PaperProps:F={},PopoverClasses:z,transitionDuration:R="auto",TransitionProps:{onEntering:D,...O}={},variant:N="selectedMenu",slots:H={},slotProps:j={},...V}=p,Z=Su(),X={...p,autoFocus:g,disableAutoFocusItem:r,MenuListProps:E,onEntering:D,PaperProps:F,transitionDuration:R,TransitionProps:O,variant:N},se=Yq(X),ge=g&&!r&&I,ae=Te.useRef(null),oe=(Ce,Re)=>{ae.current&&ae.current.adjustStyleForScrollbar(Ce,{direction:Z?"rtl":"ltr"}),D&&D(Ce,Re)},fe=Ce=>{Ce.key==="Tab"&&(Ce.preventDefault(),A&&A(Ce,"tabKeyDown"))};let pe=-1;Te.Children.map(v,(Ce,Re)=>{Te.isValidElement(Ce)&&(Ce.props.disabled||(N==="selectedMenu"&&Ce.props.selected||pe===-1)&&(pe=Re))});const K={slots:H,slotProps:{list:E,transition:O,paper:F,...j}},ye=ji({elementType:H.root,externalSlotProps:j.root,ownerState:X,className:[se.root,S]}),[J,de]=gs("paper",{className:se.paper,elementType:Kq,externalForwardedProps:K,shouldForwardComponentProp:!0,ownerState:X}),[Ae,ne]=gs("list",{className:Ar(se.list,E.className),elementType:Jq,shouldForwardComponentProp:!0,externalForwardedProps:K,getSlotProps:Ce=>({...Ce,onKeyDown:Re=>{fe(Re),Ce.onKeyDown?.(Re)}}),ownerState:X}),xe=typeof K.slotProps.transition=="function"?K.slotProps.transition(X):K.slotProps.transition;return ue.jsx(Xq,{onClose:A,anchorOrigin:{vertical:"bottom",horizontal:Z?"right":"left"},transformOrigin:Z?Wq:Zq,slots:{root:H.root,paper:J,backdrop:H.backdrop,...H.transition&&{transition:H.transition}},slotProps:{root:ye,paper:de,backdrop:typeof j.backdrop=="function"?j.backdrop(X):j.backdrop,transition:{...xe,onEntering:(...Ce)=>{oe(...Ce),xe?.onEntering?.(...Ce)}}},open:I,ref:c,transitionDuration:R,ownerState:X,...V,classes:z,children:ue.jsx(Ae,{actions:ae,autoFocus:g&&(pe===-1||r),autoFocusItem:ge,variant:N,...ne,children:v})})});function eW(t){return ui("MuiNativeSelect",t)}const aT=oi("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),tW=t=>{const{classes:s,variant:c,disabled:p,multiple:g,open:v,error:S}=t,r={select:["select",c,p&&"disabled",g&&"multiple",S&&"error"],icon:["icon",`icon${ar(c)}`,v&&"iconOpen",p&&"disabled"]};return ti(r,eW,s)},hD=Cn("select",{name:"MuiNativeSelect"})(({theme:t})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${aT.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(t.vars||t).palette.background.paper},variants:[{props:({ownerState:s})=>s.variant!=="filled"&&s.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(t.vars||t).shape.borderRadius,"&:focus":{borderRadius:(t.vars||t).shape.borderRadius},"&&&":{paddingRight:32}}}]})),nW=Cn(hD,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:hd,overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.select,s[c.variant],c.error&&s.error,{[`&.${aT.multiple}`]:s.multiple}]}})({}),fD=Cn("svg",{name:"MuiNativeSelect"})(({theme:t})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(t.vars||t).palette.action.active,[`&.${aT.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:({ownerState:s})=>s.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),rW=Cn(fD,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.icon,c.variant&&s[`icon${ar(c.variant)}`],c.open&&s.iconOpen]}})({}),iW=Te.forwardRef(function(s,c){const{className:p,disabled:g,error:v,IconComponent:S,inputRef:r,variant:E="standard",...A}=s,I={...s,disabled:g,variant:E,error:v},F=tW(I);return ue.jsxs(Te.Fragment,{children:[ue.jsx(nW,{ownerState:I,className:Ar(F.select,p),disabled:g,ref:r||c,...A}),s.multiple?null:ue.jsx(rW,{as:S,ownerState:I,className:F.icon})]})});function pD(t){return ui("MuiSelect",t)}const fy=oi("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var MP;const oW=Cn(hD,{name:"MuiSelect",slot:"Select",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[{[`&.${fy.select}`]:s.select},{[`&.${fy.select}`]:s[c.variant]},{[`&.${fy.error}`]:s.error},{[`&.${fy.multiple}`]:s.multiple}]}})({[`&.${fy.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),sW=Cn(fD,{name:"MuiSelect",slot:"Icon",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.icon,c.variant&&s[`icon${ar(c.variant)}`],c.open&&s.iconOpen]}})({}),aW=Cn("input",{shouldForwardProp:t=>Kx(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput"})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function IP(t,s){return typeof s=="object"&&s!==null?t===s:String(t)===String(s)}function lW(t){return t==null||typeof t=="string"&&!t.trim()}const cW=t=>{const{classes:s,variant:c,disabled:p,multiple:g,open:v,error:S}=t,r={select:["select",c,p&&"disabled",g&&"multiple",S&&"error"],icon:["icon",`icon${ar(c)}`,v&&"iconOpen",p&&"disabled"],nativeInput:["nativeInput"]};return ti(r,pD,s)},uW=Te.forwardRef(function(s,c){const{"aria-describedby":p,"aria-label":g,autoFocus:v,autoWidth:S,children:r,className:E,defaultOpen:A,defaultValue:I,disabled:F,displayEmpty:z,error:R=!1,IconComponent:D,inputRef:O,labelId:N,MenuProps:H={},multiple:j,name:V,onBlur:Z,onChange:X,onClose:se,onFocus:ge,onOpen:ae,open:oe,readOnly:fe,renderValue:pe,required:K,SelectDisplayProps:ye={},tabIndex:J,type:de,value:Ae,variant:ne="standard",...xe}=s,[Ce,Re]=ff({controlled:Ae,default:I,name:"Select"}),[Ee,Oe]=ff({controlled:oe,default:A,name:"Select"}),Be=Te.useRef(null),at=Te.useRef(null),[ut,nt]=Te.useState(null),{current:$e}=Te.useRef(oe!=null),[ct,At]=Te.useState(),xt=So(c,O),It=Te.useCallback(tr=>{at.current=tr,tr&&nt(tr)},[]),jt=ut?.parentNode;Te.useImperativeHandle(xt,()=>({focus:()=>{at.current.focus()},node:Be.current,value:Ce}),[Ce]),Te.useEffect(()=>{A&&Ee&&ut&&!$e&&(At(S?null:jt.clientWidth),at.current.focus())},[ut,S]),Te.useEffect(()=>{v&&at.current.focus()},[v]),Te.useEffect(()=>{if(!N)return;const tr=As(at.current).getElementById(N);if(tr){const Br=()=>{getSelection().isCollapsed&&at.current.focus()};return tr.addEventListener("click",Br),()=>{tr.removeEventListener("click",Br)}}},[N]);const cn=(tr,Br)=>{tr?ae&&ae(Br):se&&se(Br),$e||(At(S?null:jt.clientWidth),Oe(tr))},Se=tr=>{tr.button===0&&(tr.preventDefault(),at.current.focus(),cn(!0,tr))},mt=tr=>{cn(!1,tr)},Ke=Te.Children.toArray(r),Ue=tr=>{const Br=Ke.find(Tr=>Tr.props.value===tr.target.value);Br!==void 0&&(Re(Br.props.value),X&&X(tr,Br))},je=tr=>Br=>{let Tr;if(Br.currentTarget.hasAttribute("tabindex")){if(j){Tr=Array.isArray(Ce)?Ce.slice():[];const Fr=Ce.indexOf(tr.props.value);Fr===-1?Tr.push(tr.props.value):Tr.splice(Fr,1)}else Tr=tr.props.value;if(tr.props.onClick&&tr.props.onClick(Br),Ce!==Tr&&(Re(Tr),X)){const Fr=Br.nativeEvent||Br,di=new Fr.constructor(Fr.type,Fr);Object.defineProperty(di,"target",{writable:!0,value:{value:Tr,name:V}}),X(di,tr)}j||cn(!1,Br)}},gt=tr=>{fe||[" ","ArrowUp","ArrowDown","Enter"].includes(tr.key)&&(tr.preventDefault(),cn(!0,tr))},Ot=ut!==null&&Ee,Ft=tr=>{!Ot&&Z&&(Object.defineProperty(tr,"target",{writable:!0,value:{value:Ce,name:V}}),Z(tr))};delete xe["aria-invalid"];let pt,dn;const An=[];let Gt=!1;(yx({value:Ce})||z)&&(pe?pt=pe(Ce):Gt=!0);const Yt=Ke.map(tr=>{if(!Te.isValidElement(tr))return null;let Br;if(j){if(!Array.isArray(Ce))throw new Error(pf(2));Br=Ce.some(Tr=>IP(Tr,tr.props.value)),Br&&Gt&&An.push(tr.props.children)}else Br=IP(Ce,tr.props.value),Br&&Gt&&(dn=tr.props.children);return Te.cloneElement(tr,{"aria-selected":Br?"true":"false",onClick:je(tr),onKeyUp:Tr=>{Tr.key===" "&&Tr.preventDefault(),tr.props.onKeyUp&&tr.props.onKeyUp(Tr)},role:"option",selected:Br,value:void 0,"data-value":tr.props.value})});Gt&&(j?An.length===0?pt=null:pt=An.reduce((tr,Br,Tr)=>(tr.push(Br),Tr<An.length-1&&tr.push(", "),tr),[]):pt=dn);let zn=ct;!S&&$e&&ut&&(zn=jt.clientWidth);let $n;typeof J<"u"?$n=J:$n=F?null:0;const On=ye.id||(V?`mui-component-select-${V}`:void 0),Bn={...s,variant:ne,value:Ce,open:Ot,error:R},kn=cW(Bn),Pr={...H.PaperProps,...typeof H.slotProps?.paper=="function"?H.slotProps.paper(Bn):H.slotProps?.paper},mr={...H.MenuListProps,...typeof H.slotProps?.list=="function"?H.slotProps.list(Bn):H.slotProps?.list},ni=Np();return ue.jsxs(Te.Fragment,{children:[ue.jsx(oW,{as:"div",ref:It,tabIndex:$n,role:"combobox","aria-controls":Ot?ni:void 0,"aria-disabled":F?"true":void 0,"aria-expanded":Ot?"true":"false","aria-haspopup":"listbox","aria-label":g,"aria-labelledby":[N,On].filter(Boolean).join(" ")||void 0,"aria-describedby":p,"aria-required":K?"true":void 0,"aria-invalid":R?"true":void 0,onKeyDown:gt,onMouseDown:F||fe?null:Se,onBlur:Ft,onFocus:ge,...ye,ownerState:Bn,className:Ar(ye.className,kn.select,E),id:On,children:lW(pt)?MP||(MP=ue.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):pt}),ue.jsx(aW,{"aria-invalid":R,value:Array.isArray(Ce)?Ce.join(","):Ce,name:V,ref:Be,"aria-hidden":!0,onChange:Ue,tabIndex:-1,disabled:F,className:kn.nativeInput,autoFocus:v,required:K,...xe,ownerState:Bn}),ue.jsx(sW,{as:D,className:kn.icon,ownerState:Bn}),ue.jsx(Qq,{id:`menu-${V||""}`,anchorEl:jt,open:Ot,onClose:mt,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...H,slotProps:{...H.slotProps,list:{"aria-labelledby":N,role:"listbox","aria-multiselectable":j?"true":void 0,disableListWrap:!0,id:ni,...mr},paper:{...Pr,style:{minWidth:zn,...Pr!=null?Pr.style:null}}},children:Yt})]})}),dW=xh(ue.jsx("path",{d:"M7 10l5 5 5-5z"})),hW=t=>{const{classes:s}=t,p=ti({root:["root"]},pD,s);return{...s,...p}},lT={name:"MuiSelect",slot:"Root",shouldForwardProp:t=>hd(t)&&t!=="variant"},fW=Cn(iT,lT)(""),pW=Cn(sT,lT)(""),mW=Cn(oT,lT)(""),mD=Te.forwardRef(function(s,c){const p=To({name:"MuiSelect",props:s}),{autoWidth:g=!1,children:v,classes:S={},className:r,defaultOpen:E=!1,displayEmpty:A=!1,IconComponent:I=dW,id:F,input:z,inputProps:R,label:D,labelId:O,MenuProps:N,multiple:H=!1,native:j=!1,onClose:V,onOpen:Z,open:X,renderValue:se,SelectDisplayProps:ge,variant:ae="outlined",...oe}=p,fe=j?iW:uW,pe=yf(),K=b_({props:p,muiFormControl:pe,states:["variant","error"]}),ye=K.variant||ae,J={...p,variant:ye,classes:S},de=hW(J),{root:Ae,...ne}=de,xe=z||{standard:ue.jsx(fW,{ownerState:J}),outlined:ue.jsx(pW,{label:D,ownerState:J}),filled:ue.jsx(mW,{ownerState:J})}[ye],Ce=So(c,dv(xe));return ue.jsx(Te.Fragment,{children:Te.cloneElement(xe,{inputComponent:fe,inputProps:{children:v,error:K.error,IconComponent:I,variant:ye,type:void 0,multiple:H,...j?{id:F}:{autoWidth:g,defaultOpen:E,displayEmpty:A,labelId:O,MenuProps:N,onClose:V,onOpen:Z,open:X,renderValue:se,SelectDisplayProps:{id:F,...ge}},...R,classes:R?sl(ne,R.classes):ne,...z?z.props.inputProps:{}},...(H&&j||A)&&ye==="outlined"?{notched:!0}:{},ref:Ce,className:Ar(xe.props.className,r,de.root),...!z&&{variant:ye},...oe})})});mD.muiName="Select";function gW(t){return ui("MuiTextField",t)}oi("MuiTextField",["root"]);const _W={standard:iT,filled:oT,outlined:sT},yW=t=>{const{classes:s}=t;return ti({root:["root"]},gW,s)},vW=Cn(iD,{name:"MuiTextField",slot:"Root"})({}),xW=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiTextField"}),{autoComplete:g,autoFocus:v=!1,children:S,className:r,color:E="primary",defaultValue:A,disabled:I=!1,error:F=!1,FormHelperTextProps:z,fullWidth:R=!1,helperText:D,id:O,InputLabelProps:N,inputProps:H,InputProps:j,inputRef:V,label:Z,maxRows:X,minRows:se,multiline:ge=!1,name:ae,onBlur:oe,onChange:fe,onFocus:pe,placeholder:K,required:ye=!1,rows:J,select:de=!1,SelectProps:Ae,slots:ne={},slotProps:xe={},type:Ce,value:Re,variant:Ee="outlined",...Oe}=p,Be={...p,autoFocus:v,color:E,disabled:I,error:F,fullWidth:R,multiline:ge,required:ye,select:de,variant:Ee},at=yW(Be),ut=Np(O),nt=D&&ut?`${ut}-helper-text`:void 0,$e=Z&&ut?`${ut}-label`:void 0,ct=_W[Ee],At={slots:ne,slotProps:{input:j,inputLabel:N,htmlInput:H,formHelperText:z,select:Ae,...xe}},xt={},It=At.slotProps.inputLabel;Ee==="outlined"&&(It&&typeof It.shrink<"u"&&(xt.notched=It.shrink),xt.label=Z),de&&((!Ae||!Ae.native)&&(xt.id=void 0),xt["aria-describedby"]=void 0);const[jt,cn]=gs("root",{elementType:vW,shouldForwardComponentProp:!0,externalForwardedProps:{...At,...Oe},ownerState:Be,className:Ar(at.root,r),ref:c,additionalProps:{disabled:I,error:F,fullWidth:R,required:ye,color:E,variant:Ee}}),[Se,mt]=gs("input",{elementType:ct,externalForwardedProps:At,additionalProps:xt,ownerState:Be}),[Ke,Ue]=gs("inputLabel",{elementType:rD,externalForwardedProps:At,ownerState:Be}),[je,gt]=gs("htmlInput",{elementType:"input",externalForwardedProps:At,ownerState:Be}),[Ot,Ft]=gs("formHelperText",{elementType:oD,externalForwardedProps:At,ownerState:Be}),[pt,dn]=gs("select",{elementType:mD,externalForwardedProps:At,ownerState:Be}),An=ue.jsx(Se,{"aria-describedby":nt,autoComplete:g,autoFocus:v,defaultValue:A,fullWidth:R,multiline:ge,name:ae,rows:J,maxRows:X,minRows:se,type:Ce,value:Re,id:ut,inputRef:V,onBlur:oe,onChange:fe,onFocus:pe,placeholder:K,inputProps:gt,slots:{input:ne.htmlInput?je:void 0},...mt});return ue.jsxs(jt,{...cn,children:[Z!=null&&Z!==""&&ue.jsx(Ke,{htmlFor:ut,id:$e,...Ue,children:Z}),de?ue.jsx(pt,{"aria-describedby":nt,id:ut,labelId:$e,value:Re,input:An,...dn,children:S}):An,D&&ue.jsx(Ot,{id:nt,...Ft,children:D})]})});function bW(t){return ui("MuiInputAdornment",t)}const RP=oi("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var DP;const wW=(t,s)=>{const{ownerState:c}=t;return[s.root,s[`position${ar(c.position)}`],c.disablePointerEvents===!0&&s.disablePointerEvents,s[c.variant]]},SW=t=>{const{classes:s,disablePointerEvents:c,hiddenLabel:p,position:g,size:v,variant:S}=t,r={root:["root",c&&"disablePointerEvents",g&&`position${ar(g)}`,S,p&&"hiddenLabel",v&&`size${ar(v)}`]};return ti(r,bW,s)},TW=Cn("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:wW})(_o(({theme:t})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${RP.positionStart}&:not(.${RP.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),CW=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiInputAdornment"}),{children:g,className:v,component:S="div",disablePointerEvents:r=!1,disableTypography:E=!1,position:A,variant:I,...F}=p,z=yf()||{};let R=I;I&&z.variant,z&&!R&&(R=z.variant);const D={...p,hiddenLabel:z.hiddenLabel,size:z.size,disablePointerEvents:r,position:A,variant:R},O=SW(D);return ue.jsx(sb.Provider,{value:null,children:ue.jsx(TW,{as:S,ownerState:D,className:Ar(O.root,v),ref:c,...F,children:typeof g=="string"&&!E?ue.jsx(Jm,{color:"textSecondary",children:g}):ue.jsxs(Te.Fragment,{children:[A==="start"?DP||(DP=ue.jsx("span",{className:"notranslate","aria-hidden":!0,children:""})):null,g]})})})}),Vm=7;function cT(t){const{ownerState:s}=Na(),c=Su();return Te.useMemo(()=>Nt({},s,{isFieldDisabled:t.disabled??!1,isFieldReadOnly:t.readOnly??!1,isFieldRequired:t.required??!1,fieldDirection:c?"rtl":"ltr"}),[s,t.disabled,t.readOnly,t.required,c])}function EW(t){return ui("MuiPickersTextField",t)}oi("MuiPickersTextField",["root","focused","disabled","error","required"]);function AW(t){return ui("MuiPickersInputBase",t)}const n_=oi("MuiPickersInputBase",["root","focused","disabled","error","notchedOutline","sectionContent","sectionBefore","sectionAfter","adornedStart","adornedEnd","input","inputSizeSmall","activeBar"]);function PW(t){return ui("MuiPickersSectionList",t)}const py=oi("MuiPickersSectionList",["root","section","sectionContent"]),MW=["slots","slotProps","elements","sectionListRef","classes"],gD=Cn("div",{name:"MuiPickersSectionList",slot:"Root"})({direction:"ltr /*! @noflip */",outline:"none"}),_D=Cn("span",{name:"MuiPickersSectionList",slot:"Section"})({}),yD=Cn("span",{name:"MuiPickersSectionList",slot:"SectionSeparator"})({whiteSpace:"pre"}),vD=Cn("span",{name:"MuiPickersSectionList",slot:"SectionContent"})({outline:"none"}),IW=t=>ti({root:["root"],section:["section"],sectionContent:["sectionContent"]},PW,t);function RW(t){const{slots:s,slotProps:c,element:p,classes:g}=t,{ownerState:v}=Na(),S=s?.section??_D,r=ji({elementType:S,externalSlotProps:c?.section,externalForwardedProps:p.container,className:g.section,ownerState:v}),E=s?.sectionContent??vD,A=ji({elementType:E,externalSlotProps:c?.sectionContent,externalForwardedProps:p.content,additionalProps:{suppressContentEditableWarning:!0},className:g.sectionContent,ownerState:v}),I=s?.sectionSeparator??yD,F=ji({elementType:I,externalSlotProps:c?.sectionSeparator,externalForwardedProps:p.before,ownerState:Nt({},v,{separatorPosition:"before"})}),z=ji({elementType:I,externalSlotProps:c?.sectionSeparator,externalForwardedProps:p.after,ownerState:Nt({},v,{separatorPosition:"after"})});return ue.jsxs(S,Nt({},r,{children:[ue.jsx(I,Nt({},F)),ue.jsx(E,Nt({},A)),ue.jsx(I,Nt({},z))]}))}const DW=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersSectionList"}),{slots:g,slotProps:v,elements:S,sectionListRef:r,classes:E}=p,A=_i(p,MW),I=IW(E),{ownerState:F}=Na(),z=Te.useRef(null),R=So(c,z),D=H=>{if(!z.current)throw new Error(`MUI X: Cannot call sectionListRef.${H} before the mount of the component.`);return z.current};Te.useImperativeHandle(r,()=>({getRoot(){return D("getRoot")},getSectionContainer(H){return D("getSectionContainer").querySelector(`.${py.section}[data-sectionindex="${H}"]`)},getSectionContent(H){return D("getSectionContent").querySelector(`.${py.section}[data-sectionindex="${H}"] .${py.sectionContent}`)},getSectionIndexFromDOMElement(H){const j=D("getSectionIndexFromDOMElement");if(H==null||!j.contains(H))return null;let V=null;return H.classList.contains(py.section)?V=H:H.classList.contains(py.sectionContent)&&(V=H.parentElement),V==null?null:Number(V.dataset.sectionindex)}}));const O=g?.root??gD,N=ji({elementType:O,externalSlotProps:v?.root,externalForwardedProps:A,additionalProps:{ref:R,suppressContentEditableWarning:!0},className:I.root,ownerState:F});return ue.jsx(O,Nt({},N,{children:N.contentEditable?S.map(({content:H,before:j,after:V})=>`${j.children}${H.children}${V.children}`).join(""):ue.jsx(Te.Fragment,{children:S.map((H,j)=>ue.jsx(RW,{slots:g,slotProps:v,element:H,classes:I},j))})}))}),xD=Te.createContext(null),hb=()=>{const t=Te.useContext(xD);if(t==null)throw new Error(["MUI X: The `usePickerTextFieldOwnerState` can only be called in components that are used inside a PickerTextField component"].join(`
`));return t},kW=["elements","areAllSectionsEmpty","defaultValue","label","value","onChange","id","autoFocus","endAdornment","startAdornment","renderSuffix","slots","slotProps","contentEditable","tabIndex","onInput","onPaste","onKeyDown","fullWidth","name","readOnly","inputProps","inputRef","sectionListRef","onFocus","onBlur","classes","ownerState"],OW=t=>Math.round(t*1e5)/1e5,fb=Cn("div",{name:"MuiPickersInputBase",slot:"Root"})(({theme:t})=>Nt({},t.typography.body1,{color:(t.vars||t).palette.text.primary,cursor:"text",padding:0,display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",boxSizing:"border-box",letterSpacing:`${OW(.15/16)}em`,variants:[{props:{isInputInFullWidth:!0},style:{width:"100%"}}]})),uT=Cn(gD,{name:"MuiPickersInputBase",slot:"SectionsContainer"})(({theme:t})=>({padding:"4px 0 5px",fontFamily:t.typography.fontFamily,fontSize:"inherit",lineHeight:"1.4375em",flexGrow:1,outline:"none",display:"flex",flexWrap:"nowrap",overflow:"hidden",letterSpacing:"inherit",width:"182px",variants:[{props:{fieldDirection:"rtl"},style:{justifyContent:"end"}},{props:{inputSize:"small"},style:{paddingTop:1}},{props:{hasStartAdornment:!1,isFieldFocused:!1,isFieldValueEmpty:!0},style:{color:"currentColor",opacity:0}},{props:{hasStartAdornment:!1,isFieldFocused:!1,isFieldValueEmpty:!0,inputHasLabel:!1},style:t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:t.palette.mode==="light"?.42:.5}},{props:{hasStartAdornment:!1,isFieldFocused:!1,isFieldValueEmpty:!0,inputHasLabel:!0,isLabelShrunk:!0},style:t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:t.palette.mode==="light"?.42:.5}}]})),LW=Cn(_D,{name:"MuiPickersInputBase",slot:"Section"})(({theme:t})=>({fontFamily:t.typography.fontFamily,fontSize:"inherit",letterSpacing:"inherit",lineHeight:"1.4375em",display:"inline-block",whiteSpace:"nowrap"})),zW=Cn(vD,{name:"MuiPickersInputBase",slot:"SectionContent",overridesResolver:(t,s)=>s.content})(({theme:t})=>({fontFamily:t.typography.fontFamily,lineHeight:"1.4375em",letterSpacing:"inherit",width:"fit-content",outline:"none"})),FW=Cn(yD,{name:"MuiPickersInputBase",slot:"Separator"})(()=>({whiteSpace:"pre",letterSpacing:"inherit"})),BW=Cn("input",{name:"MuiPickersInputBase",slot:"Input",overridesResolver:(t,s)=>s.hiddenInput})(Nt({},PI)),NW=Cn("div",{name:"MuiPickersInputBase",slot:"ActiveBar"})(({theme:t,ownerState:s})=>({display:"none",position:"absolute",height:2,bottom:2,borderTopLeftRadius:2,borderTopRightRadius:2,transition:t.transitions.create(["width","left"],{duration:t.transitions.duration.shortest}),backgroundColor:(t.vars||t).palette.primary.main,'[data-active-range-position="start"] &, [data-active-range-position="end"] &':{display:"block"},'[data-active-range-position="start"] &':{left:s.sectionOffsets[0]},'[data-active-range-position="end"] &':{left:s.sectionOffsets[1]}})),VW=(t,s)=>{const{isFieldFocused:c,isFieldDisabled:p,isFieldReadOnly:g,hasFieldError:v,inputSize:S,isInputInFullWidth:r,inputColor:E,hasStartAdornment:A,hasEndAdornment:I}=s,F={root:["root",c&&!p&&"focused",p&&"disabled",g&&"readOnly",v&&"error",r&&"fullWidth",`color${ar(E)}`,S==="small"&&"inputSizeSmall",A&&"adornedStart",I&&"adornedEnd"],notchedOutline:["notchedOutline"],input:["input"],sectionsContainer:["sectionsContainer"],sectionContent:["sectionContent"],sectionBefore:["sectionBefore"],sectionAfter:["sectionAfter"],activeBar:["activeBar"]};return ti(F,AW,t)};function kP(t,s,c,p){if(t.content.id){const g=s.current?.querySelectorAll(`[data-sectionindex="${c}"] [data-range-position="${p}"]`);if(g)return Array.from(g).reduce((v,S)=>v+S.offsetWidth,0)}return 0}function UW(t,s){let c=0;if(s.current?.getAttribute("data-active-range-position")==="end")for(let g=t.length-1;g>=t.length/2;g-=1)c+=kP(t[g],s,g,"end");else for(let g=0;g<t.length/2;g+=1)c+=kP(t[g],s,g,"start");return{activeBarWidth:c,sectionOffsets:[s.current?.querySelector('[data-sectionindex="0"]')?.offsetLeft||0,s.current?.querySelector(`[data-sectionindex="${t.length/2}"]`)?.offsetLeft||0]}}const dT=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersInputBase"}),{elements:g,areAllSectionsEmpty:v,value:S,onChange:r,id:E,endAdornment:A,startAdornment:I,renderSuffix:F,slots:z,slotProps:R,contentEditable:D,tabIndex:O,onInput:N,onPaste:H,onKeyDown:j,name:V,readOnly:Z,inputProps:X,inputRef:se,sectionListRef:ge,onFocus:ae,onBlur:oe,classes:fe,ownerState:pe}=p,K=_i(p,kW),ye=hb(),J=Te.useRef(null),de=Te.useRef(null),Ae=Te.useRef([]),ne=So(c,J),xe=So(X?.ref,se),Ce=yf();if(!Ce)throw new Error("MUI X: PickersInputBase should always be used inside a PickersTextField component");const Re=pe??ye,Ee=xt=>{Ce.onFocus?.(xt),ae?.(xt)},Oe=xt=>{Ee(xt)},Be=xt=>{if(j?.(xt),xt.key==="Enter"&&!xt.defaultMuiPrevented){if(J.current?.dataset.multiInput)return;const It=J.current?.closest("form"),jt=It?.querySelector('[type="submit"]');if(!It||!jt)return;xt.preventDefault(),It.requestSubmit(jt)}},at=xt=>{Ce.onBlur?.(xt),oe?.(xt)};Te.useEffect(()=>{Ce&&Ce.setAdornedStart(!!I)},[Ce,I]),Te.useEffect(()=>{Ce&&(v?Ce.onEmpty():Ce.onFilled())},[Ce,v]);const ut=VW(fe,Re),nt=z?.root||fb,$e=ji({elementType:nt,externalSlotProps:R?.root,externalForwardedProps:K,additionalProps:{"aria-invalid":Ce.error,ref:ne},className:ut.root,ownerState:Re}),ct=z?.input||uT,At=g.some(xt=>xt.content["data-range-position"]!==void 0);return Te.useEffect(()=>{if(!At||!Re.isPickerOpen)return;const{activeBarWidth:xt,sectionOffsets:It}=UW(g,J);Ae.current=[It[0],It[1]],de.current&&(de.current.style.width=`${xt}px`)},[g,At,Re.isPickerOpen]),ue.jsxs(nt,Nt({},$e,{children:[I,ue.jsx(DW,{sectionListRef:ge,elements:g,contentEditable:D,tabIndex:O,className:ut.sectionsContainer,onFocus:Ee,onBlur:at,onInput:N,onPaste:H,onKeyDown:Be,slots:{root:ct,section:LW,sectionContent:zW,sectionSeparator:FW},slotProps:{root:Nt({},R?.input,{ownerState:Re}),sectionContent:{className:n_.sectionContent},sectionSeparator:({separatorPosition:xt})=>({className:xt==="before"?n_.sectionBefore:n_.sectionAfter})}}),A,F?F(Nt({},Ce)):null,ue.jsx(BW,Nt({name:V,className:ut.input,value:S,onChange:r,id:E,"aria-hidden":"true",tabIndex:-1,readOnly:Z,required:Ce.required,disabled:Ce.disabled,onFocus:Oe},X,{ref:xe})),At&&ue.jsx(NW,{className:ut.activeBar,ref:de,ownerState:{sectionOffsets:Ae.current}})]}))});function jW(t){return ui("MuiPickersOutlinedInput",t)}const sd=Nt({},n_,oi("MuiPickersOutlinedInput",["root","notchedOutline","input"])),GW=["children","className","label","notched","shrink"],$W=Cn("fieldset",{name:"MuiPickersOutlinedInput",slot:"NotchedOutline"})(({theme:t})=>{const s=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%",borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:s}}),OP=Cn("span")(({theme:t})=>({fontFamily:t.typography.fontFamily,fontSize:"inherit"})),HW=Cn("legend",{shouldForwardProp:t=>fh(t)&&t!=="notched"})(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:{inputHasLabel:!1},style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:{inputHasLabel:!0},style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:{inputHasLabel:!0,notched:!0},style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]}));function qW(t){const{className:s,label:c,notched:p}=t,g=_i(t,GW),v=hb();return ue.jsx($W,Nt({"aria-hidden":!0,className:s},g,{ownerState:v,children:ue.jsx(HW,{ownerState:v,notched:p,children:c?ue.jsx(OP,{children:c}):ue.jsx(OP,{className:"notranslate",children:""})})}))}const WW=["label","autoFocus","ownerState","classes","notched"],ZW=Cn(fb,{name:"MuiPickersOutlinedInput",slot:"Root"})(({theme:t})=>{const s=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{padding:"0 14px",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${sd.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${sd.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:s}},[`&.${sd.focused} .${sd.notchedOutline}`]:{borderStyle:"solid",borderWidth:2},[`&.${sd.disabled}`]:{[`& .${sd.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled},"*":{color:(t.vars||t).palette.action.disabled}},[`&.${sd.error} .${sd.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},variants:Object.keys((t.vars??t).palette).filter(c=>(t.vars??t).palette[c]?.main??!1).map(c=>({props:{inputColor:c},style:{[`&.${sd.focused}:not(.${sd.error}) .${sd.notchedOutline}`]:{borderColor:(t.vars||t).palette[c].main}}}))}}),YW=Cn(uT,{name:"MuiPickersOutlinedInput",slot:"SectionsContainer"})({padding:"16.5px 0",variants:[{props:{inputSize:"small"},style:{padding:"8.5px 0"}}]}),XW=t=>{const c=ti({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},jW,t);return Nt({},t,c)},bD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersOutlinedInput"}),{label:g,classes:v,notched:S}=p,r=_i(p,WW),E=yf(),A=XW(v);return ue.jsx(dT,Nt({slots:{root:ZW,input:YW},renderSuffix:I=>ue.jsx(qW,{shrink:!!(S||I.adornedStart||I.focused||I.filled),notched:!!(S||I.adornedStart||I.focused||I.filled),className:A.notchedOutline,label:g!=null&&g!==""&&E?.required?ue.jsxs(Te.Fragment,{children:[g,"","*"]}):g})},r,{label:g,classes:A,ref:c}))});bD.muiName="Input";function KW(t){return ui("MuiPickersFilledInput",t)}const Om=Nt({},n_,oi("MuiPickersFilledInput",["root","underline","input"])),JW=["label","autoFocus","disableUnderline","hiddenLabel","classes"],QW=Cn(fb,{name:"MuiPickersFilledInput",slot:"Root",shouldForwardProp:t=>fh(t)&&t!=="disableUnderline"})(({theme:t})=>{const s=t.palette.mode==="light",c=s?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",p=s?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",g=s?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",v=s?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:g,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p}},[`&.${Om.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:p},[`&.${Om.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:v},variants:[...Object.keys((t.vars??t).palette).filter(S=>(t.vars??t).palette[S].main).map(S=>({props:{inputColor:S,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[S]?.main}`}}})),{props:{disableUnderline:!1},style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Om.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Om.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:c}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Om.disabled}, .${Om.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Om.disabled}:before`]:{borderBottomStyle:"dotted"}}},{props:{hasStartAdornment:!0},style:{paddingLeft:12}},{props:{hasEndAdornment:!0},style:{paddingRight:12}}]}}),eZ=Cn(uT,{name:"MuiPickersFilledInput",slot:"sectionsContainer",shouldForwardProp:t=>fh(t)&&t!=="hiddenLabel"})({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,variants:[{props:{inputSize:"small"},style:{paddingTop:21,paddingBottom:4}},{props:{hasStartAdornment:!0},style:{paddingLeft:0}},{props:{hasEndAdornment:!0},style:{paddingRight:0}},{props:{hiddenLabel:!0},style:{paddingTop:16,paddingBottom:17}},{props:{hiddenLabel:!0,inputSize:"small"},style:{paddingTop:8,paddingBottom:9}}]}),tZ=(t,s)=>{const{inputHasUnderline:c}=s,g=ti({root:["root",c&&"underline"],input:["input"]},KW,t);return Nt({},t,g)},wD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersFilledInput"}),{label:g,disableUnderline:v=!1,hiddenLabel:S=!1,classes:r}=p,E=_i(p,JW),A=hb(),I=Nt({},A,{inputHasUnderline:!v}),F=tZ(r,I);return ue.jsx(dT,Nt({slots:{root:QW,input:eZ},slotProps:{root:{disableUnderline:v},input:{hiddenLabel:S}}},E,{label:g,classes:F,ref:c,ownerState:I}))});wD.muiName="Input";function nZ(t){return ui("MuiPickersFilledInput",t)}const my=Nt({},n_,oi("MuiPickersInput",["root","underline","input"])),rZ=["label","autoFocus","disableUnderline","ownerState","classes"],iZ=Cn(fb,{name:"MuiPickersInput",slot:"Root",shouldForwardProp:t=>fh(t)&&t!=="disableUnderline"})(({theme:t})=>{let c=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(c=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{"label + &":{marginTop:16},variants:[...Object.keys((t.vars??t).palette).filter(p=>(t.vars??t).palette[p].main).map(p=>({props:{inputColor:p,inputHasUnderline:!0},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[p].main}`}}})),{props:{inputHasUnderline:!0},style:{"&::after":{background:"red",left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${my.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${my.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${c}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${my.disabled}, .${my.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${c}`}},[`&.${my.disabled}:before`]:{borderBottomStyle:"dotted"}}}]}}),oZ=(t,s)=>{const{inputHasUnderline:c}=s,g=ti({root:["root",!c&&"underline"],input:["input"]},nZ,t);return Nt({},t,g)},SD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersInput"}),{label:g,disableUnderline:v=!1,classes:S}=p,r=_i(p,rZ),E=hb(),A=Nt({},E,{inputHasUnderline:!v}),I=oZ(S,A);return ue.jsx(dT,Nt({slots:{root:iZ},slotProps:{root:{disableUnderline:v}}},r,{ownerState:A,label:g,classes:I,ref:c}))});SD.muiName="Input";const sZ=["onFocus","onBlur","className","classes","color","disabled","error","variant","required","hiddenLabel","InputProps","inputProps","inputRef","sectionListRef","elements","areAllSectionsEmpty","onClick","onKeyDown","onKeyUp","onPaste","onInput","endAdornment","startAdornment","tabIndex","contentEditable","focused","value","onChange","fullWidth","id","name","helperText","FormHelperTextProps","label","InputLabelProps","data-active-range-position"],aZ={standard:SD,filled:wD,outlined:bD},lZ=Cn(iD,{name:"MuiPickersTextField",slot:"Root"})({maxWidth:"100%"}),cZ=(t,s)=>{const{isFieldFocused:c,isFieldDisabled:p,isFieldRequired:g}=s;return ti({root:["root",c&&!p&&"focused",p&&"disabled",g&&"required"]},EW,t)},TD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersTextField"}),{onFocus:g,onBlur:v,className:S,classes:r,color:E="primary",disabled:A=!1,error:I=!1,variant:F="outlined",required:z=!1,hiddenLabel:R=!1,InputProps:D,inputProps:O,inputRef:N,sectionListRef:H,elements:j,areAllSectionsEmpty:V,onClick:Z,onKeyDown:X,onKeyUp:se,onPaste:ge,onInput:ae,endAdornment:oe,startAdornment:fe,tabIndex:pe,contentEditable:K,focused:ye,value:J,onChange:de,fullWidth:Ae,id:ne,name:xe,helperText:Ce,FormHelperTextProps:Re,label:Ee,InputLabelProps:Oe,"data-active-range-position":Be}=p,at=_i(p,sZ),ut=Te.useRef(null),nt=So(c,ut),$e=Np(ne),ct=Ce&&$e?`${$e}-helper-text`:void 0,At=Ee&&$e?`${$e}-label`:void 0,xt=cT({disabled:p.disabled,required:p.required,readOnly:D?.readOnly}),It=Te.useMemo(()=>Nt({},xt,{isFieldValueEmpty:V,isFieldFocused:ye??!1,hasFieldError:I??!1,inputSize:p.size??"medium",inputColor:E??"primary",isInputInFullWidth:Ae??!1,hasStartAdornment:!!(fe??D?.startAdornment),hasEndAdornment:!!(oe??D?.endAdornment),inputHasLabel:!!Ee,isLabelShrunk:!!Oe?.shrink}),[xt,V,ye,I,p.size,E,Ae,fe,oe,D?.startAdornment,D?.endAdornment,Ee,Oe?.shrink]),jt=cZ(r,It),cn=aZ[F],Se={};return F==="outlined"?(Oe&&typeof Oe.shrink<"u"&&(Se.notched=Oe.shrink),Se.label=Ee):F==="filled"&&(Se.hiddenLabel=R),ue.jsx(xD.Provider,{value:It,children:ue.jsxs(lZ,Nt({className:Ar(jt.root,S),ref:nt,focused:ye,disabled:A,variant:F,error:I,color:E,fullWidth:Ae,required:z,ownerState:It},at,{children:[Ee!=null&&Ee!==""&&ue.jsx(rD,Nt({htmlFor:$e,id:At},Oe,{children:Ee})),ue.jsx(cn,Nt({elements:j,areAllSectionsEmpty:V,onClick:Z,onKeyDown:X,onKeyUp:se,onInput:ae,onPaste:ge,onFocus:g,onBlur:v,endAdornment:oe,startAdornment:fe,tabIndex:pe,contentEditable:K,value:J,onChange:de,id:$e,fullWidth:Ae,inputProps:O,inputRef:N,sectionListRef:H,label:Ee,name:xe,role:"group","aria-labelledby":At,"aria-describedby":ct,"aria-live":ct?"polite":void 0,"data-active-range-position":Be},Se,D)),Ce&&ue.jsx(oD,Nt({id:ct},Re,{children:Ce}))]}))})}),uZ=["enableAccessibleFieldDOMStructure"],dZ=["InputProps","readOnly","onClear","clearable","clearButtonPosition","openPickerButtonPosition","openPickerAriaLabel"],hZ=["onPaste","onKeyDown","inputMode","readOnly","InputProps","inputProps","inputRef","onClear","clearable","clearButtonPosition","openPickerButtonPosition","openPickerAriaLabel"],fZ=["ownerState"],pZ=["ownerState"],mZ=["ownerState"],gZ=["ownerState"],_Z=["InputProps","inputProps"],dw=()=>{},yZ=t=>{let{enableAccessibleFieldDOMStructure:s}=t,c=_i(t,uZ);if(s){const{InputProps:j,readOnly:V,onClear:Z,clearable:X,clearButtonPosition:se,openPickerButtonPosition:ge,openPickerAriaLabel:ae}=c,oe=_i(c,dZ),fe=Vm>=6&&oe?.slotProps?.input?Iy(oe?.slotProps?.input,j):dw;return{clearable:X,onClear:Z,clearButtonPosition:se,openPickerButtonPosition:ge,openPickerAriaLabel:ae,textFieldProps:Nt({},oe,Vm>=6&&oe?.slotProps?.input?{slotProps:Nt({},oe?.slotProps,{input:pe=>Nt({},ad(fe,pe),{readOnly:V})})}:{InputProps:Nt({},j??{},{readOnly:V})})}}const{onPaste:p,onKeyDown:g,inputMode:v,readOnly:S,InputProps:r,inputProps:E,inputRef:A,onClear:I,clearable:F,clearButtonPosition:z,openPickerButtonPosition:R,openPickerAriaLabel:D}=c,O=_i(c,hZ),N=Vm>=6&&O?.slotProps?.input?Iy(O?.slotProps?.input,r):dw,H=Vm>=6&&O?.slotProps?.htmlInput?Iy(O?.slotProps?.htmlInput,E):dw;return{clearable:F,onClear:I,clearButtonPosition:z,openPickerButtonPosition:R,openPickerAriaLabel:D,textFieldProps:Nt({},O,Vm>=6&&(O?.slotProps?.input||O?.slotProps?.htmlInput)?{slotProps:Nt({},O?.slotProps,{input:j=>Nt({},ad(N,j),{readOnly:S}),htmlInput:j=>Nt({},ad(H,j),{inputMode:v,onPaste:p,onKeyDown:g,ref:A})})}:{InputProps:Nt({},r??{},{readOnly:S}),inputProps:Nt({},E??{},{inputMode:v,onPaste:p,onKeyDown:g,ref:A})})}},hT=Te.createContext({slots:{},slotProps:{},inputRef:void 0});function vZ(t){const{fieldResponse:s,defaultOpenPickerIcon:c}=t,p=Up(),g=XS(),v=Te.useContext(hT),{textFieldProps:S,onClear:r,clearable:E,openPickerAriaLabel:A,clearButtonPosition:I="end",openPickerButtonPosition:F="end"}=yZ(s),z=cT(S),R=_r(Re=>{Re.preventDefault(),g?.setOpen(Ee=>!Ee)}),D=g?g.triggerStatus:"hidden",O=E?I:null,N=D!=="hidden"?F:null,H=v.slots.textField??(s.enableAccessibleFieldDOMStructure===!1?xW:TD),j=v.slots.inputAdornment??CW,V=ji({elementType:j,externalSlotProps:v.slotProps.inputAdornment,additionalProps:{position:"start"},ownerState:Nt({},z,{position:"start"})}),Z=_i(V,fZ),X=ji({elementType:j,externalSlotProps:v.slotProps.inputAdornment,additionalProps:{position:"end"},ownerState:Nt({},z,{position:"end"})}),se=_i(X,pZ),ge=v.slots.openPickerButton??_x,ae=ji({elementType:ge,externalSlotProps:v.slotProps.openPickerButton,additionalProps:{disabled:D==="disabled",onClick:R,"aria-label":A,edge:S.variant!=="standard"?N:!1},ownerState:z}),oe=_i(ae,mZ),fe=v.slots.openPickerIcon??c,pe=ji({elementType:fe,externalSlotProps:v.slotProps.openPickerIcon,ownerState:z}),K=v.slots.clearButton??_x,ye=ji({elementType:K,externalSlotProps:v.slotProps.clearButton,className:"clearButton",additionalProps:{title:p.fieldClearLabel,tabIndex:-1,onClick:r,disabled:s.disabled||s.readOnly,edge:S.variant!=="standard"&&O!==N?O:!1},ownerState:z}),J=_i(ye,gZ),de=v.slots.clearIcon??L$,Ae=ji({elementType:de,externalSlotProps:v.slotProps.clearIcon,additionalProps:{fontSize:"small"},ownerState:z});S.ref=So(S.ref,g?.rootRef);const ne={},xe=ad((Vm>=6&&S?.slotProps?.input)??S.InputProps,z);g&&(ne.ref=g.triggerRef),!xe?.startAdornment&&(O==="start"||N==="start")&&(ne.startAdornment=ue.jsxs(j,Nt({},Z,{children:[N==="start"&&ue.jsx(ge,Nt({},oe,{children:ue.jsx(fe,Nt({},pe))})),O==="start"&&ue.jsx(K,Nt({},J,{children:ue.jsx(de,Nt({},Ae))}))]}))),!xe?.endAdornment&&(O==="end"||N==="end")&&(ne.endAdornment=ue.jsxs(j,Nt({},se,{children:[O==="end"&&ue.jsx(K,Nt({},J,{children:ue.jsx(de,Nt({},Ae))})),N==="end"&&ue.jsx(ge,Nt({},oe,{children:ue.jsx(fe,Nt({},pe))}))]}))),!ne?.endAdornment&&!ne?.startAdornment&&v.slots.inputAdornment&&(ne.endAdornment=ue.jsx(j,Nt({},se))),O!=null&&(S.sx=[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(S.sx)?S.sx:[S.sx]]);const Ce=Vm>=6&&S?.slotProps?.input?ad(Iy(xe,ne),z):Nt({},xe,ne);return delete S?.slotProps?.input,s.enableAccessibleFieldDOMStructure&&delete S?.slotProps,ue.jsx(H,Nt({},S,{InputProps:Ce}))}function Iy(t,s){return t?s?c=>Nt({},ad(s,c),ad(t,c)):t:s}function xZ(t){const{ref:s,externalForwardedProps:c,slotProps:p}=t,g=Te.useContext(hT),v=XS(),S=cT(c),{InputProps:r,inputProps:E}=c,A=_i(c,_Z),I=ji({elementType:TD,externalSlotProps:Iy(g.slotProps.textField,p?.textField),externalForwardedProps:A,additionalProps:{ref:s,sx:v?.rootSx,label:v?.label,name:v?.name,className:v?.rootClassName,inputRef:g.inputRef},ownerState:S});return I.inputProps=Nt({},E,I.inputProps),I.InputProps=Nt({},r,I.InputProps),I}function bZ(t){const{slots:s={},slotProps:c={},inputRef:p,children:g}=t,v=Te.useMemo(()=>({inputRef:p,slots:{openPickerButton:s.openPickerButton,openPickerIcon:s.openPickerIcon,textField:s.textField,inputAdornment:s.inputAdornment,clearIcon:s.clearIcon,clearButton:s.clearButton},slotProps:{openPickerButton:c.openPickerButton,openPickerIcon:c.openPickerIcon,textField:c.textField,inputAdornment:c.inputAdornment,clearIcon:c.clearIcon,clearButton:c.clearButton}}),[p,s.openPickerButton,s.openPickerIcon,s.textField,s.inputAdornment,s.clearIcon,s.clearButton,c.openPickerButton,c.openPickerIcon,c.textField,c.inputAdornment,c.clearIcon,c.clearButton]);return ue.jsx(hT.Provider,{value:v,children:g})}const wZ=["slots","slotProps"],CD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiDateField"}),{slots:g,slotProps:v}=p,S=_i(p,wZ),r=xZ({slotProps:v,ref:c,externalForwardedProps:S}),E=DH(r);return ue.jsx(bZ,{slots:g,slotProps:v,inputRef:S.inputRef,children:ue.jsx(vZ,{fieldResponse:E,defaultOpenPickerIcon:O$})})}),ED=({shouldDisableDate:t,shouldDisableMonth:s,shouldDisableYear:c,minDate:p,maxDate:g,disableFuture:v,disablePast:S,timezone:r})=>{const E=Ko();return Te.useCallback(A=>cv({adapter:E,value:A,timezone:r,props:{shouldDisableDate:t,shouldDisableMonth:s,shouldDisableYear:c,minDate:p,maxDate:g,disableFuture:v,disablePast:S}})!==null,[E,t,s,c,p,g,v,S,r])},SZ=(t,s)=>(c,p)=>{switch(p.type){case"setVisibleDate":return Nt({},c,{slideDirection:p.direction,currentMonth:p.month,isMonthSwitchingAnimating:!s.isSameMonth(p.month,c.currentMonth)&&!t&&!p.skipAnimation,focusedDay:p.focusedDay});case"changeMonthTimezone":{const g=p.newTimezone;if(s.getTimezone(c.currentMonth)===g)return c;let v=s.setTimezone(c.currentMonth,g);return s.getMonth(v)!==s.getMonth(c.currentMonth)&&(v=s.setMonth(v,s.getMonth(c.currentMonth))),Nt({},c,{currentMonth:v})}case"finishMonthSwitchingAnimation":return Nt({},c,{isMonthSwitchingAnimating:!1});default:throw new Error("missing support")}},TZ=t=>{const{value:s,referenceDate:c,disableFuture:p,disablePast:g,maxDate:v,minDate:S,onMonthChange:r,onYearChange:E,reduceAnimations:A,shouldDisableDate:I,timezone:F,getCurrentMonthFromVisibleDate:z}=t,R=Ko(),D=Te.useRef(SZ(!!A,R)).current,O=Te.useMemo(()=>_h.getInitialReferenceValue({value:s,adapter:R,timezone:F,props:t,referenceDate:c,granularity:lh.day}),[c,F]),[N,H]=Te.useReducer(D,{isMonthSwitchingAnimating:!1,focusedDay:O,currentMonth:R.startOfMonth(O),slideDirection:"left"}),j=ED({shouldDisableDate:I,minDate:S,maxDate:v,disableFuture:p,disablePast:g,timezone:F});Te.useEffect(()=>{H({type:"changeMonthTimezone",newTimezone:R.getTimezone(O)})},[O,R]);const V=_r(({target:X,reason:se})=>{if(se==="cell-interaction"&&N.focusedDay!=null&&R.isSameDay(X,N.focusedDay))return;const ge=se==="cell-interaction";let ae,oe;if(se==="cell-interaction")ae=z(X,N.currentMonth),oe=X;else if(ae=R.isSameMonth(X,N.currentMonth)?N.currentMonth:R.startOfMonth(X),oe=X,j(oe)){const K=R.startOfMonth(X),ye=R.endOfMonth(X);oe=Vy({adapter:R,date:oe,minDate:R.isBefore(S,K)?K:S,maxDate:R.isAfter(v,ye)?ye:v,disablePast:g,disableFuture:p,isDateDisabled:j,timezone:F})}const fe=!R.isSameMonth(N.currentMonth,ae),pe=!R.isSameYear(N.currentMonth,ae);fe&&r?.(ae),pe&&E?.(R.startOfYear(ae)),H({type:"setVisibleDate",month:ae,direction:R.isAfterDay(ae,N.currentMonth)?"left":"right",focusedDay:N.focusedDay!=null&&oe!=null&&R.isSameDay(oe,N.focusedDay)?N.focusedDay:oe,skipAnimation:ge})}),Z=Te.useCallback(()=>{H({type:"finishMonthSwitchingAnimation"})},[]);return{referenceDate:O,calendarState:N,setVisibleDate:V,isDateDisabled:j,onMonthSwitchingAnimationEnd:Z}},CZ=t=>ui("MuiPickersFadeTransitionGroup",t);oi("MuiPickersFadeTransitionGroup",["root"]);const EZ=["children"],AZ=t=>ti({root:["root"]},CZ,t),PZ=Cn(av,{name:"MuiPickersFadeTransitionGroup",slot:"Root"})({display:"block",position:"relative"});function AD(t){const s=_s({props:t,name:"MuiPickersFadeTransitionGroup"}),{className:c,reduceAnimations:p,transKey:g,classes:v}=s,{children:S}=s,r=_i(s,EZ),E=AZ(v),A=y_();return p?S:ue.jsx(PZ,{className:Ar(E.root,c),ownerState:r,children:ue.jsx(Ym,{appear:!1,mountOnEnter:!0,unmountOnExit:!0,timeout:{appear:A.transitions.duration.enteringScreen,enter:A.transitions.duration.enteringScreen,exit:0},children:S},g)})}const MZ=t=>ui("MuiPickersSlideTransition",t),pu=oi("MuiPickersSlideTransition",["root","slideEnter-left","slideEnter-right","slideEnterActive","slideExit","slideExitActiveLeft-left","slideExitActiveLeft-right"]),IZ=["children","className","reduceAnimations","slideDirection","transKey","classes"],RZ=(t,s)=>{const{slideDirection:c}=s,p={root:["root"],exit:["slideExit"],enterActive:["slideEnterActive"],enter:[`slideEnter-${c}`],exitActive:[`slideExitActiveLeft-${c}`]};return ti(p,MZ,t)},DZ=Cn(av,{name:"MuiPickersSlideTransition",slot:"Root",overridesResolver:(t,s)=>[s.root,{[`.${pu["slideEnter-left"]}`]:s["slideEnter-left"]},{[`.${pu["slideEnter-right"]}`]:s["slideEnter-right"]},{[`.${pu.slideEnterActive}`]:s.slideEnterActive},{[`.${pu.slideExit}`]:s.slideExit},{[`.${pu["slideExitActiveLeft-left"]}`]:s["slideExitActiveLeft-left"]},{[`.${pu["slideExitActiveLeft-right"]}`]:s["slideExitActiveLeft-right"]}]})(({theme:t})=>{const s=t.transitions.create("transform",{duration:t.transitions.duration.complex,easing:"cubic-bezier(0.35, 0.8, 0.4, 1)"});return{display:"block",position:"relative",overflowX:"hidden","& > *":{position:"absolute",top:0,right:0,left:0},[`& .${pu["slideEnter-left"]}`]:{willChange:"transform",transform:"translate(100%)",zIndex:1},[`& .${pu["slideEnter-right"]}`]:{willChange:"transform",transform:"translate(-100%)",zIndex:1},[`& .${pu.slideEnterActive}`]:{transform:"translate(0%)",transition:s},[`& .${pu.slideExit}`]:{transform:"translate(0%)"},[`& .${pu["slideExitActiveLeft-left"]}`]:{willChange:"transform",transform:"translate(-100%)",transition:s,zIndex:0},[`& .${pu["slideExitActiveLeft-right"]}`]:{willChange:"transform",transform:"translate(100%)",transition:s,zIndex:0}}});function kZ(t){const s=_s({props:t,name:"MuiPickersSlideTransition"}),{children:c,className:p,reduceAnimations:g,slideDirection:v,transKey:S,classes:r}=s,E=_i(s,IZ),{ownerState:A}=Na(),I=Nt({},A,{slideDirection:v}),F=RZ(r,I),z=y_();if(g)return ue.jsx("div",{className:Ar(F.root,p),children:c});const R={exit:F.exit,enterActive:F.enterActive,enter:F.enter,exitActive:F.exitActive};return ue.jsx(DZ,{className:Ar(F.root,p),childFactory:D=>Te.cloneElement(D,{classNames:R}),role:"presentation",ownerState:I,children:ue.jsx(JS,Nt({mountOnEnter:!0,unmountOnExit:!0,timeout:z.transitions.duration.complex,classNames:R},E,{children:c}),S)})}const OZ=t=>ui("MuiDayCalendar",t);oi("MuiDayCalendar",["root","header","weekDayLabel","loadingContainer","slideTransition","monthContainer","weekContainer","weekNumberLabel","weekNumber"]);const LZ=["parentProps","day","focusedDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"],zZ=["ownerState"],FZ=t=>ti({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},OZ,t),PD=(jy+ib*2)*6,BZ=Cn("div",{name:"MuiDayCalendar",slot:"Root"})({}),NZ=Cn("div",{name:"MuiDayCalendar",slot:"Header"})({display:"flex",justifyContent:"center",alignItems:"center"}),VZ=Cn(Jm,{name:"MuiDayCalendar",slot:"WeekDayLabel"})(({theme:t})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(t.vars||t).palette.text.secondary})),UZ=Cn(Jm,{name:"MuiDayCalendar",slot:"WeekNumberLabel"})(({theme:t})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(t.vars||t).palette.text.disabled})),jZ=Cn(Jm,{name:"MuiDayCalendar",slot:"WeekNumber"})(({theme:t})=>Nt({},t.typography.caption,{width:jy,height:jy,padding:0,margin:`0 ${ib}px`,color:(t.vars||t).palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"})),GZ=Cn("div",{name:"MuiDayCalendar",slot:"LoadingContainer"})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:PD}),$Z=Cn(kZ,{name:"MuiDayCalendar",slot:"SlideTransition"})({minHeight:PD}),HZ=Cn("div",{name:"MuiDayCalendar",slot:"MonthContainer"})({overflow:"hidden"}),qZ=Cn("div",{name:"MuiDayCalendar",slot:"WeekContainer"})({margin:`${ib}px 0`,display:"flex",justifyContent:"center"});function WZ(t){let{parentProps:s,day:c,focusedDay:p,selectedDays:g,isDateDisabled:v,currentMonthNumber:S,isViewFocused:r}=t,E=_i(t,LZ);const{disabled:A,disableHighlightToday:I,isMonthSwitchingAnimating:F,showDaysOutsideCurrentMonth:z,slots:R,slotProps:D,timezone:O}=s,N=Ko(),H=rb(O),j=p!=null&&N.isSameDay(c,p),V=r&&j,Z=g.some(J=>N.isSameDay(J,c)),X=N.isSameDay(c,H),se=Te.useMemo(()=>A||v(c),[A,v,c]),ge=Te.useMemo(()=>N.getMonth(c)!==S,[N,c,S]),ae=YR({day:c,selected:Z,disabled:se,today:X,outsideCurrentMonth:ge,disableMargin:void 0,disableHighlightToday:I,showDaysOutsideCurrentMonth:z}),oe=R?.day??mH,fe=ji({elementType:oe,externalSlotProps:D?.day,additionalProps:Nt({disableHighlightToday:I,showDaysOutsideCurrentMonth:z,role:"gridcell",isAnimating:F,"data-timestamp":N.toJsDate(c).valueOf()},E),ownerState:Nt({},ae,{day:c,isDayDisabled:se,isDaySelected:Z})}),pe=_i(fe,zZ),K=Te.useMemo(()=>{const J=N.startOfMonth(N.setMonth(c,S));return z?N.isSameDay(c,N.startOfWeek(J)):N.isSameDay(c,J)},[S,c,z,N]),ye=Te.useMemo(()=>{const J=N.endOfMonth(N.setMonth(c,S));return z?N.isSameDay(c,N.endOfWeek(J)):N.isSameDay(c,J)},[S,c,z,N]);return ue.jsx(oe,Nt({},pe,{day:c,disabled:se,autoFocus:!ge&&V,today:X,outsideCurrentMonth:ge,isFirstVisibleCell:K,isLastVisibleCell:ye,selected:Z,tabIndex:j?0:-1,"aria-selected":Z,"aria-current":X?"date":void 0}))}function ZZ(t){const s=_s({props:t,name:"MuiDayCalendar"}),c=Ko(),{onFocusedDayChange:p,className:g,classes:v,currentMonth:S,selectedDays:r,focusedDay:E,loading:A,onSelectedDaysChange:I,onMonthSwitchingAnimationEnd:F,readOnly:z,reduceAnimations:R,renderLoading:D=()=>ue.jsx("span",{children:"..."}),slideDirection:O,TransitionProps:N,disablePast:H,disableFuture:j,minDate:V,maxDate:Z,shouldDisableDate:X,shouldDisableMonth:se,shouldDisableYear:ge,dayOfWeekFormatter:ae=It=>c.format(It,"weekdayShort").charAt(0).toUpperCase(),hasFocus:oe,onFocusedViewChange:fe,gridLabelId:pe,displayWeekNumber:K,fixedWeekNumber:ye,timezone:J}=s,de=rb(J),Ae=FZ(v),ne=Su(),xe=ED({shouldDisableDate:X,shouldDisableMonth:se,shouldDisableYear:ge,minDate:V,maxDate:Z,disablePast:H,disableFuture:j,timezone:J}),Ce=Up(),Re=_r(It=>{z||I(It)}),Ee=It=>{xe(It)||(p(It),fe?.(!0))},Oe=_r((It,jt)=>{switch(It.key){case"ArrowUp":Ee(c.addDays(jt,-7)),It.preventDefault();break;case"ArrowDown":Ee(c.addDays(jt,7)),It.preventDefault();break;case"ArrowLeft":{const cn=c.addDays(jt,ne?1:-1),Se=c.addMonths(jt,ne?1:-1),mt=Vy({adapter:c,date:cn,minDate:ne?cn:c.startOfMonth(Se),maxDate:ne?c.endOfMonth(Se):cn,isDateDisabled:xe,timezone:J});Ee(mt||cn),It.preventDefault();break}case"ArrowRight":{const cn=c.addDays(jt,ne?-1:1),Se=c.addMonths(jt,ne?-1:1),mt=Vy({adapter:c,date:cn,minDate:ne?c.startOfMonth(Se):cn,maxDate:ne?cn:c.endOfMonth(Se),isDateDisabled:xe,timezone:J});Ee(mt||cn),It.preventDefault();break}case"Home":Ee(c.startOfWeek(jt)),It.preventDefault();break;case"End":Ee(c.endOfWeek(jt)),It.preventDefault();break;case"PageUp":Ee(c.addMonths(jt,1)),It.preventDefault();break;case"PageDown":Ee(c.addMonths(jt,-1)),It.preventDefault();break}}),Be=_r((It,jt)=>Ee(jt)),at=_r((It,jt)=>{E!=null&&c.isSameDay(E,jt)&&fe?.(!1)}),ut=c.getMonth(S),nt=c.getYear(S),$e=Te.useMemo(()=>r.filter(It=>!!It).map(It=>c.startOfDay(It)),[c,r]),ct=`${nt}-${ut}`,At=Te.useMemo(()=>Te.createRef(),[ct]),xt=Te.useMemo(()=>{const It=c.getWeekArray(S);let jt=c.addMonths(S,1);for(;ye&&It.length<ye;){const cn=c.getWeekArray(jt),Se=c.isSameDay(It[It.length-1][0],cn[0][0]);cn.slice(Se?1:0).forEach(mt=>{It.length<ye&&It.push(mt)}),jt=c.addMonths(jt,1)}return It},[S,ye,c]);return ue.jsxs(BZ,{role:"grid","aria-labelledby":pe,className:Ae.root,children:[ue.jsxs(NZ,{role:"row",className:Ae.header,children:[K&&ue.jsx(UZ,{variant:"caption",role:"columnheader","aria-label":Ce.calendarWeekNumberHeaderLabel,className:Ae.weekNumberLabel,children:Ce.calendarWeekNumberHeaderText}),yG(c,de).map((It,jt)=>ue.jsx(VZ,{variant:"caption",role:"columnheader","aria-label":c.format(It,"weekday"),className:Ae.weekDayLabel,children:ae(It)},jt.toString()))]}),A?ue.jsx(GZ,{className:Ae.loadingContainer,children:D()}):ue.jsx($Z,Nt({transKey:ct,onExited:F,reduceAnimations:R,slideDirection:O,className:Ar(g,Ae.slideTransition)},N,{nodeRef:At,children:ue.jsx(HZ,{ref:At,role:"rowgroup",className:Ae.monthContainer,children:xt.map((It,jt)=>ue.jsxs(qZ,{role:"row",className:Ae.weekContainer,"aria-rowindex":jt+1,children:[K&&ue.jsx(jZ,{className:Ae.weekNumber,role:"rowheader","aria-label":Ce.calendarWeekNumberAriaLabelText(c.getWeekNumber(It[0])),children:Ce.calendarWeekNumberText(c.getWeekNumber(It[0]))}),It.map((cn,Se)=>ue.jsx(WZ,{parentProps:s,day:cn,selectedDays:$e,isViewFocused:oe,focusedDay:E,onKeyDown:Oe,onFocus:Be,onBlur:at,onDaySelect:Re,isDateDisabled:xe,currentMonthNumber:ut,"aria-colindex":Se+1},cn.toString()))]},`week-${It[0]}`))})}))]})}function MD(t){return ui("MuiMonthCalendar",t)}const b1=oi("MuiMonthCalendar",["root","button","disabled","selected"]),YZ=["autoFocus","classes","disabled","selected","value","onClick","onKeyDown","onFocus","onBlur","slots","slotProps"],XZ=(t,s)=>{const c={button:["button",s.isMonthDisabled&&"disabled",s.isMonthSelected&&"selected"]};return ti(c,MD,t)},KZ=Cn("button",{name:"MuiMonthCalendar",slot:"Button",overridesResolver:(t,s)=>[s.button,{[`&.${b1.disabled}`]:s.disabled},{[`&.${b1.selected}`]:s.selected}]})(({theme:t})=>Nt({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:gh(t.palette.action.active,t.palette.action.hoverOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:gh(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${b1.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${b1.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})),JZ=Te.memo(function(s){const{autoFocus:c,classes:p,disabled:g,selected:v,value:S,onClick:r,onKeyDown:E,onFocus:A,onBlur:I,slots:F,slotProps:z}=s,R=_i(s,YZ),D=Te.useRef(null),{ownerState:O}=Na(),N=Nt({},O,{isMonthDisabled:g,isMonthSelected:v}),H=XZ(p,N);la(()=>{c&&D.current?.focus()},[c]);const j=F?.monthButton??KZ,V=ji({elementType:j,externalSlotProps:z?.monthButton,externalForwardedProps:R,additionalProps:{disabled:g,ref:D,type:"button",role:"radio","aria-checked":v,onClick:Z=>r(Z,S),onKeyDown:Z=>E(Z,S),onFocus:Z=>A(Z,S),onBlur:Z=>I(Z,S)},ownerState:N,className:H.button});return ue.jsx(j,Nt({},V))}),QZ=["autoFocus","className","currentMonth","classes","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","shouldDisableMonth","readOnly","disableHighlightToday","onMonthFocus","hasFocus","onFocusedViewChange","monthsPerRow","timezone","gridLabelId","slots","slotProps"],eY=t=>ti({root:["root"]},MD,t);function tY(t,s){const c=_s({props:t,name:s}),p=uv(c);return Nt({},c,p,{monthsPerRow:c.monthsPerRow??3})}const LP=(t,s,c,p,g)=>!!(t===s&&p&&g.isSameYear(c,p)),nY=Cn("div",{name:"MuiMonthCalendar",slot:"Root",shouldForwardProp:t=>fh(t)&&t!=="monthsPerRow"})({display:"flex",flexWrap:"wrap",justifyContent:"space-evenly",rowGap:16,padding:"8px 0",width:ob,boxSizing:"border-box",variants:[{props:{monthsPerRow:3},style:{columnGap:24}},{props:{monthsPerRow:4},style:{columnGap:0}}]}),rY=Te.forwardRef(function(s,c){const p=tY(s,"MuiMonthCalendar"),{autoFocus:g,className:v,currentMonth:S,classes:r,value:E,defaultValue:A,referenceDate:I,disabled:F,disableFuture:z,disablePast:R,maxDate:D,minDate:O,onChange:N,shouldDisableMonth:H,readOnly:j,onMonthFocus:V,hasFocus:Z,onFocusedViewChange:X,monthsPerRow:se,timezone:ge,gridLabelId:ae,slots:oe,slotProps:fe}=p,pe=_i(p,QZ),{value:K,handleValueChange:ye,timezone:J}=lv({name:"MonthCalendar",timezone:ge,value:E,defaultValue:A,referenceDate:I,onChange:N,valueManager:_h}),de=rb(J),Ae=Su(),ne=Ko(),{ownerState:xe}=Na(),Ce=Te.useMemo(()=>_h.getInitialReferenceValue({value:K,adapter:ne,props:p,timezone:J,referenceDate:I,granularity:lh.month}),[]),Re=eY(r),Ee=Te.useMemo(()=>ne.getMonth(de),[ne,de]),Oe=Te.useMemo(()=>K!=null?ne.getMonth(K):null,[K,ne]),[Be,at]=Te.useState(()=>Oe||ne.getMonth(Ce)),[ut,nt]=ff({name:"MonthCalendar",state:"hasFocus",controlled:Z,default:g??!1}),$e=_r(Se=>{nt(Se),X&&X(Se)}),ct=Te.useCallback(Se=>{const mt=ne.startOfMonth(R&&ne.isAfter(de,O)?de:O),Ke=ne.startOfMonth(z&&ne.isBefore(de,D)?de:D),Ue=ne.startOfMonth(Se);return ne.isBefore(Ue,mt)||ne.isAfter(Ue,Ke)?!0:H?H(Ue):!1},[z,R,D,O,de,H,ne]),At=_r((Se,mt)=>{if(j)return;const Ke=K&&S&&!ne.isSameYear(K,S)?ne.setYear(K,ne.getYear(S)):K,Ue=ne.setMonth(Ke??Ce,mt);ye(Ue)}),xt=_r(Se=>{ct(ne.setMonth(K??S??Ce,Se))||(at(Se),$e(!0),V&&V(Se))});Te.useEffect(()=>{at(Se=>Oe!==null&&Se!==Oe?Oe:Se)},[Oe]);const It=_r((Se,mt)=>{switch(Se.key){case"ArrowUp":xt((12+mt-3)%12),Se.preventDefault();break;case"ArrowDown":xt((12+mt+3)%12),Se.preventDefault();break;case"ArrowLeft":xt((12+mt+(Ae?1:-1))%12),Se.preventDefault();break;case"ArrowRight":xt((12+mt+(Ae?-1:1))%12),Se.preventDefault();break}}),jt=_r((Se,mt)=>{xt(mt)}),cn=_r((Se,mt)=>{Be===mt&&$e(!1)});return ue.jsx(nY,Nt({ref:c,className:Ar(Re.root,v),ownerState:xe,role:"radiogroup","aria-labelledby":ae,monthsPerRow:se},pe,{children:$S(ne,S??K??Ce).map(Se=>{const mt=ne.getMonth(Se),Ke=ne.format(Se,"monthShort"),Ue=ne.format(Se,"month"),je=LP(mt,Oe,Se,K,ne),gt=F||ct(Se);return ue.jsx(JZ,{selected:je,value:mt,onClick:At,onKeyDown:It,autoFocus:ut&&mt===Be,disabled:gt,tabIndex:mt===Be&&!gt?0:-1,onFocus:jt,onBlur:cn,"aria-current":LP(mt,Ee,Se,de,ne)?"date":void 0,"aria-label":Ue,slots:oe,slotProps:fe,classes:r,children:Ke},Ke)})}))});function ID(t){return ui("MuiYearCalendar",t)}const w1=oi("MuiYearCalendar",["root","button","disabled","selected"]),iY=["autoFocus","classes","disabled","selected","value","onClick","onKeyDown","onFocus","onBlur","slots","slotProps"],oY=(t,s)=>{const c={button:["button",s.isYearDisabled&&"disabled",s.isYearSelected&&"selected"]};return ti(c,ID,t)},sY=Cn("button",{name:"MuiYearCalendar",slot:"Button",overridesResolver:(t,s)=>[s.button,{[`&.${w1.disabled}`]:s.disabled},{[`&.${w1.selected}`]:s.selected}]})(({theme:t})=>Nt({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.focusOpacity})`:gh(t.palette.action.active,t.palette.action.focusOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:gh(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${w1.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${w1.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})),aY=Te.memo(function(s){const{autoFocus:c,classes:p,disabled:g,selected:v,value:S,onClick:r,onKeyDown:E,onFocus:A,onBlur:I,slots:F,slotProps:z}=s,R=_i(s,iY),D=Te.useRef(null),{ownerState:O}=Na(),N=Nt({},O,{isYearDisabled:g,isYearSelected:v}),H=oY(p,N);la(()=>{c&&D.current?.focus()},[c]);const j=F?.yearButton??sY,V=ji({elementType:j,externalSlotProps:z?.yearButton,externalForwardedProps:R,additionalProps:{disabled:g,ref:D,type:"button",role:"radio","aria-checked":v,onClick:Z=>r(Z,S),onKeyDown:Z=>E(Z,S),onFocus:Z=>A(Z,S),onBlur:Z=>I(Z,S)},ownerState:N,className:H.button});return ue.jsx(j,Nt({},V))}),lY=["autoFocus","className","classes","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsOrder","yearsPerRow","timezone","gridLabelId","slots","slotProps"],cY=t=>ti({root:["root"]},ID,t);function uY(t,s){const c=_s({props:t,name:s}),p=uv(c);return Nt({},c,p,{yearsPerRow:c.yearsPerRow??3,yearsOrder:c.yearsOrder??"asc"})}const dY=Cn("div",{name:"MuiYearCalendar",slot:"Root",shouldForwardProp:t=>fh(t)&&t!=="yearsPerRow"})({display:"flex",flexWrap:"wrap",justifyContent:"space-evenly",rowGap:12,padding:"6px 0",overflowY:"auto",height:"100%",width:ob,maxHeight:X$,boxSizing:"border-box",position:"relative",variants:[{props:{yearsPerRow:3},style:{columnGap:24}},{props:{yearsPerRow:4},style:{columnGap:0,padding:"0 2px"}}]}),hY=Cn("div",{name:"MuiYearCalendar",slot:"ButtonFiller"})({height:36,width:72}),fY=Te.forwardRef(function(s,c){const p=uY(s,"MuiYearCalendar"),{autoFocus:g,className:v,classes:S,value:r,defaultValue:E,referenceDate:A,disabled:I,disableFuture:F,disablePast:z,maxDate:R,minDate:D,onChange:O,readOnly:N,shouldDisableYear:H,onYearFocus:j,hasFocus:V,onFocusedViewChange:Z,yearsOrder:X,yearsPerRow:se,timezone:ge,gridLabelId:ae,slots:oe,slotProps:fe}=p,pe=_i(p,lY),{value:K,handleValueChange:ye,timezone:J}=lv({name:"YearCalendar",timezone:ge,value:r,defaultValue:E,referenceDate:A,onChange:O,valueManager:_h}),de=rb(J),Ae=Su(),ne=Ko(),{ownerState:xe}=Na(),Ce=Te.useMemo(()=>_h.getInitialReferenceValue({value:K,adapter:ne,props:p,timezone:J,referenceDate:A,granularity:lh.year}),[]),Re=cY(S),Ee=Te.useMemo(()=>ne.getYear(de),[ne,de]),Oe=Te.useMemo(()=>K!=null?ne.getYear(K):null,[K,ne]),[Be,at]=Te.useState(()=>Oe||ne.getYear(Ce)),[ut,nt]=ff({name:"YearCalendar",state:"hasFocus",controlled:V,default:g??!1}),$e=_r(Ot=>{nt(Ot),Z&&Z(Ot)}),ct=Te.useCallback(Ot=>{if(z&&ne.isBeforeYear(Ot,de)||F&&ne.isAfterYear(Ot,de)||D&&ne.isBeforeYear(Ot,D)||R&&ne.isAfterYear(Ot,R))return!0;if(!H)return!1;const Ft=ne.startOfYear(Ot);return H(Ft)},[F,z,R,D,de,H,ne]),At=_r((Ot,Ft)=>{if(N)return;const pt=ne.setYear(K??Ce,Ft);ye(pt)}),xt=_r(Ot=>{ct(ne.setYear(K??Ce,Ot))||(at(Ot),$e(!0),j?.(Ot))});Te.useEffect(()=>{at(Ot=>Oe!==null&&Ot!==Oe?Oe:Ot)},[Oe]);const It=X!=="desc"?se*1:se*-1,jt=Ae&&X==="asc"||!Ae&&X==="desc"?-1:1,cn=_r((Ot,Ft)=>{switch(Ot.key){case"ArrowUp":xt(Ft-It),Ot.preventDefault();break;case"ArrowDown":xt(Ft+It),Ot.preventDefault();break;case"ArrowLeft":xt(Ft-jt),Ot.preventDefault();break;case"ArrowRight":xt(Ft+jt),Ot.preventDefault();break}}),Se=_r((Ot,Ft)=>{xt(Ft)}),mt=_r((Ot,Ft)=>{Be===Ft&&$e(!1)}),Ke=Te.useRef(null),Ue=So(c,Ke);Te.useEffect(()=>{if(g||Ke.current===null)return;const Ot=Ke.current.querySelector('[tabindex="0"]');if(!Ot)return;const Ft=Ot.offsetHeight,pt=Ot.offsetTop,dn=Ke.current.clientHeight,An=Ke.current.scrollTop,Gt=pt+Ft;Ft>dn||pt<An||(Ke.current.scrollTop=Gt-dn/2-Ft/2)},[g]);const je=ne.getYearRange([D,R]);X==="desc"&&je.reverse();let gt=se-je.length%se;return gt===se&&(gt=0),ue.jsxs(dY,Nt({ref:Ue,className:Ar(Re.root,v),ownerState:xe,role:"radiogroup","aria-labelledby":ae,yearsPerRow:se},pe,{children:[je.map(Ot=>{const Ft=ne.getYear(Ot),pt=Ft===Oe,dn=I||ct(Ot);return ue.jsx(aY,{selected:pt,value:Ft,onClick:At,onKeyDown:cn,autoFocus:ut&&Ft===Be,disabled:dn,tabIndex:Ft===Be&&!dn?0:-1,onFocus:Se,onBlur:mt,"aria-current":Ee===Ft?"date":void 0,slots:oe,slotProps:fe,classes:S,children:ne.format(Ot,"year")},ne.format(Ot,"year"))}),Array.from({length:gt},(Ot,Ft)=>ue.jsx(hY,{},Ft))]}))}),pY=t=>ui("MuiPickersCalendarHeader",t),mY=oi("MuiPickersCalendarHeader",["root","labelContainer","label","switchViewButton","switchViewIcon"]),gY=["slots","slotProps","currentMonth","disabled","disableFuture","disablePast","maxDate","minDate","onMonthChange","onViewChange","view","reduceAnimations","views","labelId","className","classes","timezone","format"],_Y=["ownerState"],yY=t=>ti({root:["root"],labelContainer:["labelContainer"],label:["label"],switchViewButton:["switchViewButton"],switchViewIcon:["switchViewIcon"]},pY,t),vY=Cn("div",{name:"MuiPickersCalendarHeader",slot:"Root"})({display:"flex",alignItems:"center",marginTop:12,marginBottom:4,paddingLeft:24,paddingRight:12,maxHeight:40,minHeight:40}),xY=Cn("div",{name:"MuiPickersCalendarHeader",slot:"LabelContainer"})(({theme:t})=>Nt({display:"flex",overflow:"hidden",alignItems:"center",cursor:"pointer",marginRight:"auto"},t.typography.body1,{fontWeight:t.typography.fontWeightMedium})),bY=Cn("div",{name:"MuiPickersCalendarHeader",slot:"Label"})({marginRight:6}),wY=Cn(_x,{name:"MuiPickersCalendarHeader",slot:"SwitchViewButton"})({marginRight:"auto",variants:[{props:{view:"year"},style:{[`.${mY.switchViewIcon}`]:{transform:"rotate(180deg)"}}}]}),SY=Cn(R$,{name:"MuiPickersCalendarHeader",slot:"SwitchViewIcon"})(({theme:t})=>({willChange:"transform",transition:t.transitions.create("transform"),transform:"rotate(0deg)"})),TY=Te.forwardRef(function(s,c){const p=Up(),g=Ko(),v=_s({props:s,name:"MuiPickersCalendarHeader"}),{slots:S,slotProps:r,currentMonth:E,disabled:A,disableFuture:I,disablePast:F,maxDate:z,minDate:R,onMonthChange:D,onViewChange:O,view:N,reduceAnimations:H,views:j,labelId:V,className:Z,classes:X,timezone:se,format:ge=`${g.formats.month} ${g.formats.year}`}=v,ae=_i(v,gY),{ownerState:oe}=Na(),fe=yY(X),pe=S?.switchViewButton??wY,K=ji({elementType:pe,externalSlotProps:r?.switchViewButton,additionalProps:{size:"small","aria-label":p.calendarViewSwitchingButtonAriaLabel(N)},ownerState:Nt({},oe,{view:N}),className:fe.switchViewButton}),ye=S?.switchViewIcon??SY,J=ji({elementType:ye,externalSlotProps:r?.switchViewIcon,ownerState:oe,className:fe.switchViewIcon}),de=_i(J,_Y),Ae=()=>D(g.addMonths(E,1)),ne=()=>D(g.addMonths(E,-1)),xe=Z$(E,{disableFuture:I,maxDate:z,timezone:se}),Ce=Y$(E,{disablePast:F,minDate:R,timezone:se}),Re=()=>{if(!(j.length===1||!O||A))if(j.length===2)O(j.find(Oe=>Oe!==N)||j[0]);else{const Oe=j.indexOf(N)!==0?0:1;O(j[Oe])}};if(j.length===1&&j[0]==="year")return null;const Ee=g.formatByString(E,ge);return ue.jsxs(vY,Nt({},ae,{ownerState:oe,className:Ar(fe.root,Z),ref:c,children:[ue.jsxs(xY,{role:"presentation",onClick:Re,ownerState:oe,"aria-live":"polite",className:fe.labelContainer,children:[ue.jsx(AD,{reduceAnimations:H,transKey:Ee,children:ue.jsx(bY,{id:V,ownerState:oe,className:fe.label,children:Ee})}),j.length>1&&!A&&ue.jsx(pe,Nt({},K,{children:ue.jsx(ye,Nt({},de))}))]}),ue.jsx(Ym,{in:N==="day",appear:!H,enter:!H,children:ue.jsx(G$,{slots:S,slotProps:r,onGoToPrevious:ne,isPreviousDisabled:Ce,previousLabel:p.previousMonth,onGoToNext:Ae,isNextDisabled:xe,nextLabel:p.nextMonth})})]}))}),RD=JI({themeId:sv}),CY="@media (prefers-reduced-motion: reduce)",r_=typeof navigator<"u"&&navigator.userAgent.match(/android\s(\d+)|OS\s(\d+)/i),zP=r_&&r_[1]?parseInt(r_[1],10):null,FP=r_&&r_[2]?parseInt(r_[2],10):null,EY=zP&&zP<10||FP&&FP<13||!1;function DD(t){const s=RD(CY,{defaultMatches:!1});return t??(s||EY)}const AY=t=>ui("MuiDateCalendar",t);oi("MuiDateCalendar",["root","viewTransitionContainer"]);const PY=["autoFocus","onViewChange","value","defaultValue","referenceDate","disableFuture","disablePast","onChange","onYearChange","onMonthChange","reduceAnimations","shouldDisableDate","shouldDisableMonth","shouldDisableYear","view","views","openTo","className","classes","disabled","readOnly","minDate","maxDate","disableHighlightToday","focusedView","onFocusedViewChange","showDaysOutsideCurrentMonth","fixedWeekNumber","dayOfWeekFormatter","slots","slotProps","loading","renderLoading","displayWeekNumber","yearsOrder","yearsPerRow","monthsPerRow","timezone"],MY=t=>ti({root:["root"],viewTransitionContainer:["viewTransitionContainer"]},AY,t);function IY(t,s){const c=_s({props:t,name:s}),p=DD(c.reduceAnimations),g=uv(c);return Nt({},c,g,{loading:c.loading??!1,openTo:c.openTo??"day",views:c.views??["year","day"],reduceAnimations:p,renderLoading:c.renderLoading??(()=>ue.jsx("span",{children:"..."}))})}const RY=Cn(K$,{name:"MuiDateCalendar",slot:"Root"})({display:"flex",flexDirection:"column",height:tT}),DY=Cn(AD,{name:"MuiDateCalendar",slot:"ViewTransitionContainer"})({}),kY=Te.forwardRef(function(s,c){const p=Ko(),{ownerState:g}=Na(),v=Np(),S=IY(s,"MuiDateCalendar"),{autoFocus:r,onViewChange:E,value:A,defaultValue:I,referenceDate:F,disableFuture:z,disablePast:R,onChange:D,onMonthChange:O,reduceAnimations:N,shouldDisableDate:H,shouldDisableMonth:j,shouldDisableYear:V,view:Z,views:X,openTo:se,className:ge,classes:ae,disabled:oe,readOnly:fe,minDate:pe,maxDate:K,disableHighlightToday:ye,focusedView:J,onFocusedViewChange:de,showDaysOutsideCurrentMonth:Ae,fixedWeekNumber:ne,dayOfWeekFormatter:xe,slots:Ce,slotProps:Re,loading:Ee,renderLoading:Oe,displayWeekNumber:Be,yearsOrder:at,yearsPerRow:ut,monthsPerRow:nt,timezone:$e}=S,ct=_i(S,PY),{value:At,handleValueChange:xt,timezone:It}=lv({name:"DateCalendar",timezone:$e,value:A,defaultValue:I,referenceDate:F,onChange:D,valueManager:_h}),{view:jt,setView:cn,focusedView:Se,setFocusedView:mt,goToNextView:Ke,setValueAndGoToNextView:Ue}=$R({view:Z,views:X,openTo:se,onChange:xt,onViewChange:E,autoFocus:r,focusedView:J,onFocusedViewChange:de}),{referenceDate:je,calendarState:gt,setVisibleDate:Ot,isDateDisabled:Ft,onMonthSwitchingAnimationEnd:pt}=TZ({value:At,referenceDate:F,reduceAnimations:N,onMonthChange:O,minDate:pe,maxDate:K,shouldDisableDate:H,disablePast:R,disableFuture:z,timezone:It,getCurrentMonthFromVisibleDate:(Tr,Fr)=>p.isSameMonth(Tr,Fr)?Fr:p.startOfMonth(Tr)}),dn=oe&&At||pe,An=oe&&At||K,Gt=`${v}-grid-label`,Yt=Se!==null,zn=Ce?.calendarHeader??TY,$n=ji({elementType:zn,externalSlotProps:Re?.calendarHeader,additionalProps:{views:X,view:jt,currentMonth:gt.currentMonth,onViewChange:cn,onMonthChange:Tr=>Ot({target:Tr,reason:"header-navigation"}),minDate:dn,maxDate:An,disabled:oe,disablePast:R,disableFuture:z,reduceAnimations:N,timezone:It,labelId:Gt},ownerState:g}),On=_r(Tr=>{const Fr=p.startOfMonth(Tr),di=p.endOfMonth(Tr),Mo=Ft(Tr)?Vy({adapter:p,date:Tr,minDate:p.isBefore(pe,Fr)?Fr:pe,maxDate:p.isAfter(K,di)?di:K,disablePast:R,disableFuture:z,isDateDisabled:Ft,timezone:It}):Tr;Mo?(Ue(Mo,"finish"),Ot({target:Mo,reason:"cell-interaction"})):(Ke(),Ot({target:Fr,reason:"cell-interaction"}))}),Bn=_r(Tr=>{const Fr=p.startOfYear(Tr),di=p.endOfYear(Tr),Mo=Ft(Tr)?Vy({adapter:p,date:Tr,minDate:p.isBefore(pe,Fr)?Fr:pe,maxDate:p.isAfter(K,di)?di:K,disablePast:R,disableFuture:z,isDateDisabled:Ft,timezone:It}):Tr;Mo?(Ue(Mo,"finish"),Ot({target:Mo,reason:"cell-interaction"})):(Ke(),Ot({target:Fr,reason:"cell-interaction"}))}),kn=_r(Tr=>xt(Tr&&px(p,Tr,At??je),"finish",jt));Te.useEffect(()=>{p.isValid(At)&&Ot({target:At,reason:"controlled-value-change"})},[At]);const Pr=MY(ae),mr={disablePast:R,disableFuture:z,maxDate:K,minDate:pe},ni={disableHighlightToday:ye,readOnly:fe,disabled:oe,timezone:It,gridLabelId:Gt,slots:Ce,slotProps:Re},tr=Te.useRef(jt);Te.useEffect(()=>{tr.current!==jt&&(Se===tr.current&&mt(jt,!0),tr.current=jt)},[Se,mt,jt]);const Br=Te.useMemo(()=>[At],[At]);return ue.jsxs(RY,Nt({ref:c,className:Ar(Pr.root,ge),ownerState:g},ct,{children:[ue.jsx(zn,Nt({},$n,{slots:Ce,slotProps:Re})),ue.jsx(DY,{reduceAnimations:N,className:Pr.viewTransitionContainer,transKey:jt,ownerState:g,children:ue.jsxs("div",{children:[jt==="year"&&ue.jsx(fY,Nt({},mr,ni,{value:At,onChange:Bn,shouldDisableYear:V,hasFocus:Yt,onFocusedViewChange:Tr=>mt("year",Tr),yearsOrder:at,yearsPerRow:ut,referenceDate:je})),jt==="month"&&ue.jsx(rY,Nt({},mr,ni,{currentMonth:gt.currentMonth,hasFocus:Yt,className:ge,value:At,onChange:On,shouldDisableMonth:j,onFocusedViewChange:Tr=>mt("month",Tr),monthsPerRow:nt,referenceDate:je})),jt==="day"&&ue.jsx(ZZ,Nt({},gt,mr,ni,{onMonthSwitchingAnimationEnd:pt,hasFocus:Yt,onFocusedDayChange:Tr=>Ot({target:Tr,reason:"cell-interaction"}),reduceAnimations:N,selectedDays:Br,onSelectedDaysChange:kn,shouldDisableDate:H,shouldDisableMonth:j,shouldDisableYear:V,onFocusedViewChange:Tr=>mt("day",Tr),showDaysOutsideCurrentMonth:Ae,fixedWeekNumber:ne,dayOfWeekFormatter:xe,displayWeekNumber:Be,loading:Ee,renderLoading:Oe}))]})})]}))});function OY(t){return ui("MuiPickersToolbar",t)}oi("MuiPickersToolbar",["root","title","content"]);function kD(){const{ownerState:t}=Na(),s=Su();return Te.useMemo(()=>Nt({},t,{toolbarDirection:s?"rtl":"ltr"}),[t,s])}const LY=["children","className","classes","toolbarTitle","hidden","titleId","classes","landscapeDirection"],zY=t=>ti({root:["root"],title:["title"],content:["content"]},OY,t),FY=Cn("div",{name:"MuiPickersToolbar",slot:"Root"})(({theme:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",padding:t.spacing(2,3),variants:[{props:{pickerOrientation:"landscape"},style:{height:"auto",maxWidth:160,padding:16,justifyContent:"flex-start",flexWrap:"wrap"}}]})),BY=Cn("div",{name:"MuiPickersToolbar",slot:"Content",shouldForwardProp:t=>fh(t)&&t!=="landscapeDirection"})({display:"flex",flexWrap:"wrap",width:"100%",flex:1,justifyContent:"space-between",alignItems:"center",flexDirection:"row",variants:[{props:{pickerOrientation:"landscape"},style:{justifyContent:"flex-start",alignItems:"flex-start",flexDirection:"column"}},{props:{pickerOrientation:"landscape",landscapeDirection:"row"},style:{flexDirection:"row"}}]}),NY=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersToolbar"}),{children:g,className:v,classes:S,toolbarTitle:r,hidden:E,titleId:A,landscapeDirection:I}=p,F=_i(p,LY),z=kD(),R=zY(S);return E?null:ue.jsxs(FY,Nt({ref:c,className:Ar(R.root,v),ownerState:z},F,{children:[ue.jsx(Jm,{color:"text.secondary",variant:"overline",id:A,className:R.title,children:r}),ue.jsx(BY,{className:R.content,ownerState:z,landscapeDirection:I,children:g})]}))});function VY(t){return ui("MuiDatePickerToolbar",t)}oi("MuiDatePickerToolbar",["root","title"]);const UY=["toolbarFormat","toolbarPlaceholder","className","classes"],jY=t=>ti({root:["root"],title:["title"]},VY,t),GY=Cn(NY,{name:"MuiDatePickerToolbar",slot:"Root"})({}),$Y=Cn(Jm,{name:"MuiDatePickerToolbar",slot:"Title"})({variants:[{props:{pickerOrientation:"landscape"},style:{margin:"auto 16px auto auto"}}]}),HY=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiDatePickerToolbar"}),{toolbarFormat:g,toolbarPlaceholder:v="",className:S,classes:r}=p,E=_i(p,UY),A=Ko(),{value:I,views:F,orientation:z}=x_(),R=Up(),D=kD(),O=jY(r),N=Te.useMemo(()=>{if(!A.isValid(I))return v;const H=HS(A,{format:g,views:F},!0);return A.formatByString(I,H)},[I,g,v,A,F]);return ue.jsx(GY,Nt({ref:c,toolbarTitle:R.datePickerToolbarTitle,className:Ar(O.root,S)},E,{children:ue.jsx($Y,{variant:"h4",align:z==="landscape"?"left":"center",ownerState:D,className:O.title,children:N})}))});function OD(t,s){const c=_s({props:t,name:s}),p=uv(c),g=Te.useMemo(()=>c.localeText?.toolbarTitle==null?c.localeText:Nt({},c.localeText,{datePickerToolbarTitle:c.localeText.toolbarTitle}),[c.localeText]);return Nt({},c,p,{localeText:g},pG({views:c.views,openTo:c.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{slots:Nt({toolbar:HY},c.slots)})}var lc="top",bu="bottom",wu="right",cc="left",fT="auto",hv=[lc,bu,wu,cc],d_="start",Gy="end",qY="clippingParents",LD="viewport",gy="popper",WY="reference",BP=hv.reduce(function(t,s){return t.concat([s+"-"+d_,s+"-"+Gy])},[]),zD=[].concat(hv,[fT]).reduce(function(t,s){return t.concat([s,s+"-"+d_,s+"-"+Gy])},[]),ZY="beforeRead",YY="read",XY="afterRead",KY="beforeMain",JY="main",QY="afterMain",eX="beforeWrite",tX="write",nX="afterWrite",rX=[ZY,YY,XY,KY,JY,QY,eX,tX,nX];function yh(t){return t?(t.nodeName||"").toLowerCase():null}function Fc(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var s=t.ownerDocument;return s&&s.defaultView||window}return t}function Xm(t){var s=Fc(t).Element;return t instanceof s||t instanceof Element}function xu(t){var s=Fc(t).HTMLElement;return t instanceof s||t instanceof HTMLElement}function pT(t){if(typeof ShadowRoot>"u")return!1;var s=Fc(t).ShadowRoot;return t instanceof s||t instanceof ShadowRoot}function iX(t){var s=t.state;Object.keys(s.elements).forEach(function(c){var p=s.styles[c]||{},g=s.attributes[c]||{},v=s.elements[c];!xu(v)||!yh(v)||(Object.assign(v.style,p),Object.keys(g).forEach(function(S){var r=g[S];r===!1?v.removeAttribute(S):v.setAttribute(S,r===!0?"":r)}))})}function oX(t){var s=t.state,c={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(s.elements.popper.style,c.popper),s.styles=c,s.elements.arrow&&Object.assign(s.elements.arrow.style,c.arrow),function(){Object.keys(s.elements).forEach(function(p){var g=s.elements[p],v=s.attributes[p]||{},S=Object.keys(s.styles.hasOwnProperty(p)?s.styles[p]:c[p]),r=S.reduce(function(E,A){return E[A]="",E},{});!xu(g)||!yh(g)||(Object.assign(g.style,r),Object.keys(v).forEach(function(E){g.removeAttribute(E)}))})}}const sX={name:"applyStyles",enabled:!0,phase:"write",fn:iX,effect:oX,requires:["computeStyles"]};function ph(t){return t.split("-")[0]}var qm=Math.max,bx=Math.min,h_=Math.round;function rS(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(s){return s.brand+"/"+s.version}).join(" "):navigator.userAgent}function FD(){return!/^((?!chrome|android).)*safari/i.test(rS())}function f_(t,s,c){s===void 0&&(s=!1),c===void 0&&(c=!1);var p=t.getBoundingClientRect(),g=1,v=1;s&&xu(t)&&(g=t.offsetWidth>0&&h_(p.width)/t.offsetWidth||1,v=t.offsetHeight>0&&h_(p.height)/t.offsetHeight||1);var S=Xm(t)?Fc(t):window,r=S.visualViewport,E=!FD()&&c,A=(p.left+(E&&r?r.offsetLeft:0))/g,I=(p.top+(E&&r?r.offsetTop:0))/v,F=p.width/g,z=p.height/v;return{width:F,height:z,top:I,right:A+F,bottom:I+z,left:A,x:A,y:I}}function mT(t){var s=f_(t),c=t.offsetWidth,p=t.offsetHeight;return Math.abs(s.width-c)<=1&&(c=s.width),Math.abs(s.height-p)<=1&&(p=s.height),{x:t.offsetLeft,y:t.offsetTop,width:c,height:p}}function BD(t,s){var c=s.getRootNode&&s.getRootNode();if(t.contains(s))return!0;if(c&&pT(c)){var p=s;do{if(p&&t.isSameNode(p))return!0;p=p.parentNode||p.host}while(p)}return!1}function _f(t){return Fc(t).getComputedStyle(t)}function aX(t){return["table","td","th"].indexOf(yh(t))>=0}function jp(t){return((Xm(t)?t.ownerDocument:t.document)||window.document).documentElement}function pb(t){return yh(t)==="html"?t:t.assignedSlot||t.parentNode||(pT(t)?t.host:null)||jp(t)}function NP(t){return!xu(t)||_f(t).position==="fixed"?null:t.offsetParent}function lX(t){var s=/firefox/i.test(rS()),c=/Trident/i.test(rS());if(c&&xu(t)){var p=_f(t);if(p.position==="fixed")return null}var g=pb(t);for(pT(g)&&(g=g.host);xu(g)&&["html","body"].indexOf(yh(g))<0;){var v=_f(g);if(v.transform!=="none"||v.perspective!=="none"||v.contain==="paint"||["transform","perspective"].indexOf(v.willChange)!==-1||s&&v.willChange==="filter"||s&&v.filter&&v.filter!=="none")return g;g=g.parentNode}return null}function fv(t){for(var s=Fc(t),c=NP(t);c&&aX(c)&&_f(c).position==="static";)c=NP(c);return c&&(yh(c)==="html"||yh(c)==="body"&&_f(c).position==="static")?s:c||lX(t)||s}function gT(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Ry(t,s,c){return qm(t,bx(s,c))}function cX(t,s,c){var p=Ry(t,s,c);return p>c?c:p}function ND(){return{top:0,right:0,bottom:0,left:0}}function VD(t){return Object.assign({},ND(),t)}function UD(t,s){return s.reduce(function(c,p){return c[p]=t,c},{})}var uX=function(s,c){return s=typeof s=="function"?s(Object.assign({},c.rects,{placement:c.placement})):s,VD(typeof s!="number"?s:UD(s,hv))};function dX(t){var s,c=t.state,p=t.name,g=t.options,v=c.elements.arrow,S=c.modifiersData.popperOffsets,r=ph(c.placement),E=gT(r),A=[cc,wu].indexOf(r)>=0,I=A?"height":"width";if(!(!v||!S)){var F=uX(g.padding,c),z=mT(v),R=E==="y"?lc:cc,D=E==="y"?bu:wu,O=c.rects.reference[I]+c.rects.reference[E]-S[E]-c.rects.popper[I],N=S[E]-c.rects.reference[E],H=fv(v),j=H?E==="y"?H.clientHeight||0:H.clientWidth||0:0,V=O/2-N/2,Z=F[R],X=j-z[I]-F[D],se=j/2-z[I]/2+V,ge=Ry(Z,se,X),ae=E;c.modifiersData[p]=(s={},s[ae]=ge,s.centerOffset=ge-se,s)}}function hX(t){var s=t.state,c=t.options,p=c.element,g=p===void 0?"[data-popper-arrow]":p;g!=null&&(typeof g=="string"&&(g=s.elements.popper.querySelector(g),!g)||BD(s.elements.popper,g)&&(s.elements.arrow=g))}const fX={name:"arrow",enabled:!0,phase:"main",fn:dX,effect:hX,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function p_(t){return t.split("-")[1]}var pX={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mX(t,s){var c=t.x,p=t.y,g=s.devicePixelRatio||1;return{x:h_(c*g)/g||0,y:h_(p*g)/g||0}}function VP(t){var s,c=t.popper,p=t.popperRect,g=t.placement,v=t.variation,S=t.offsets,r=t.position,E=t.gpuAcceleration,A=t.adaptive,I=t.roundOffsets,F=t.isFixed,z=S.x,R=z===void 0?0:z,D=S.y,O=D===void 0?0:D,N=typeof I=="function"?I({x:R,y:O}):{x:R,y:O};R=N.x,O=N.y;var H=S.hasOwnProperty("x"),j=S.hasOwnProperty("y"),V=cc,Z=lc,X=window;if(A){var se=fv(c),ge="clientHeight",ae="clientWidth";if(se===Fc(c)&&(se=jp(c),_f(se).position!=="static"&&r==="absolute"&&(ge="scrollHeight",ae="scrollWidth")),se=se,g===lc||(g===cc||g===wu)&&v===Gy){Z=bu;var oe=F&&se===X&&X.visualViewport?X.visualViewport.height:se[ge];O-=oe-p.height,O*=E?1:-1}if(g===cc||(g===lc||g===bu)&&v===Gy){V=wu;var fe=F&&se===X&&X.visualViewport?X.visualViewport.width:se[ae];R-=fe-p.width,R*=E?1:-1}}var pe=Object.assign({position:r},A&&pX),K=I===!0?mX({x:R,y:O},Fc(c)):{x:R,y:O};if(R=K.x,O=K.y,E){var ye;return Object.assign({},pe,(ye={},ye[Z]=j?"0":"",ye[V]=H?"0":"",ye.transform=(X.devicePixelRatio||1)<=1?"translate("+R+"px, "+O+"px)":"translate3d("+R+"px, "+O+"px, 0)",ye))}return Object.assign({},pe,(s={},s[Z]=j?O+"px":"",s[V]=H?R+"px":"",s.transform="",s))}function gX(t){var s=t.state,c=t.options,p=c.gpuAcceleration,g=p===void 0?!0:p,v=c.adaptive,S=v===void 0?!0:v,r=c.roundOffsets,E=r===void 0?!0:r,A={placement:ph(s.placement),variation:p_(s.placement),popper:s.elements.popper,popperRect:s.rects.popper,gpuAcceleration:g,isFixed:s.options.strategy==="fixed"};s.modifiersData.popperOffsets!=null&&(s.styles.popper=Object.assign({},s.styles.popper,VP(Object.assign({},A,{offsets:s.modifiersData.popperOffsets,position:s.options.strategy,adaptive:S,roundOffsets:E})))),s.modifiersData.arrow!=null&&(s.styles.arrow=Object.assign({},s.styles.arrow,VP(Object.assign({},A,{offsets:s.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-placement":s.placement})}const _X={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:gX,data:{}};var S1={passive:!0};function yX(t){var s=t.state,c=t.instance,p=t.options,g=p.scroll,v=g===void 0?!0:g,S=p.resize,r=S===void 0?!0:S,E=Fc(s.elements.popper),A=[].concat(s.scrollParents.reference,s.scrollParents.popper);return v&&A.forEach(function(I){I.addEventListener("scroll",c.update,S1)}),r&&E.addEventListener("resize",c.update,S1),function(){v&&A.forEach(function(I){I.removeEventListener("scroll",c.update,S1)}),r&&E.removeEventListener("resize",c.update,S1)}}const vX={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:yX,data:{}};var xX={left:"right",right:"left",bottom:"top",top:"bottom"};function Y1(t){return t.replace(/left|right|bottom|top/g,function(s){return xX[s]})}var bX={start:"end",end:"start"};function UP(t){return t.replace(/start|end/g,function(s){return bX[s]})}function _T(t){var s=Fc(t),c=s.pageXOffset,p=s.pageYOffset;return{scrollLeft:c,scrollTop:p}}function yT(t){return f_(jp(t)).left+_T(t).scrollLeft}function wX(t,s){var c=Fc(t),p=jp(t),g=c.visualViewport,v=p.clientWidth,S=p.clientHeight,r=0,E=0;if(g){v=g.width,S=g.height;var A=FD();(A||!A&&s==="fixed")&&(r=g.offsetLeft,E=g.offsetTop)}return{width:v,height:S,x:r+yT(t),y:E}}function SX(t){var s,c=jp(t),p=_T(t),g=(s=t.ownerDocument)==null?void 0:s.body,v=qm(c.scrollWidth,c.clientWidth,g?g.scrollWidth:0,g?g.clientWidth:0),S=qm(c.scrollHeight,c.clientHeight,g?g.scrollHeight:0,g?g.clientHeight:0),r=-p.scrollLeft+yT(t),E=-p.scrollTop;return _f(g||c).direction==="rtl"&&(r+=qm(c.clientWidth,g?g.clientWidth:0)-v),{width:v,height:S,x:r,y:E}}function vT(t){var s=_f(t),c=s.overflow,p=s.overflowX,g=s.overflowY;return/auto|scroll|overlay|hidden/.test(c+g+p)}function jD(t){return["html","body","#document"].indexOf(yh(t))>=0?t.ownerDocument.body:xu(t)&&vT(t)?t:jD(pb(t))}function Dy(t,s){var c;s===void 0&&(s=[]);var p=jD(t),g=p===((c=t.ownerDocument)==null?void 0:c.body),v=Fc(p),S=g?[v].concat(v.visualViewport||[],vT(p)?p:[]):p,r=s.concat(S);return g?r:r.concat(Dy(pb(S)))}function iS(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function TX(t,s){var c=f_(t,!1,s==="fixed");return c.top=c.top+t.clientTop,c.left=c.left+t.clientLeft,c.bottom=c.top+t.clientHeight,c.right=c.left+t.clientWidth,c.width=t.clientWidth,c.height=t.clientHeight,c.x=c.left,c.y=c.top,c}function jP(t,s,c){return s===LD?iS(wX(t,c)):Xm(s)?TX(s,c):iS(SX(jp(t)))}function CX(t){var s=Dy(pb(t)),c=["absolute","fixed"].indexOf(_f(t).position)>=0,p=c&&xu(t)?fv(t):t;return Xm(p)?s.filter(function(g){return Xm(g)&&BD(g,p)&&yh(g)!=="body"}):[]}function EX(t,s,c,p){var g=s==="clippingParents"?CX(t):[].concat(s),v=[].concat(g,[c]),S=v[0],r=v.reduce(function(E,A){var I=jP(t,A,p);return E.top=qm(I.top,E.top),E.right=bx(I.right,E.right),E.bottom=bx(I.bottom,E.bottom),E.left=qm(I.left,E.left),E},jP(t,S,p));return r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}function GD(t){var s=t.reference,c=t.element,p=t.placement,g=p?ph(p):null,v=p?p_(p):null,S=s.x+s.width/2-c.width/2,r=s.y+s.height/2-c.height/2,E;switch(g){case lc:E={x:S,y:s.y-c.height};break;case bu:E={x:S,y:s.y+s.height};break;case wu:E={x:s.x+s.width,y:r};break;case cc:E={x:s.x-c.width,y:r};break;default:E={x:s.x,y:s.y}}var A=g?gT(g):null;if(A!=null){var I=A==="y"?"height":"width";switch(v){case d_:E[A]=E[A]-(s[I]/2-c[I]/2);break;case Gy:E[A]=E[A]+(s[I]/2-c[I]/2);break}}return E}function $y(t,s){s===void 0&&(s={});var c=s,p=c.placement,g=p===void 0?t.placement:p,v=c.strategy,S=v===void 0?t.strategy:v,r=c.boundary,E=r===void 0?qY:r,A=c.rootBoundary,I=A===void 0?LD:A,F=c.elementContext,z=F===void 0?gy:F,R=c.altBoundary,D=R===void 0?!1:R,O=c.padding,N=O===void 0?0:O,H=VD(typeof N!="number"?N:UD(N,hv)),j=z===gy?WY:gy,V=t.rects.popper,Z=t.elements[D?j:z],X=EX(Xm(Z)?Z:Z.contextElement||jp(t.elements.popper),E,I,S),se=f_(t.elements.reference),ge=GD({reference:se,element:V,placement:g}),ae=iS(Object.assign({},V,ge)),oe=z===gy?ae:se,fe={top:X.top-oe.top+H.top,bottom:oe.bottom-X.bottom+H.bottom,left:X.left-oe.left+H.left,right:oe.right-X.right+H.right},pe=t.modifiersData.offset;if(z===gy&&pe){var K=pe[g];Object.keys(fe).forEach(function(ye){var J=[wu,bu].indexOf(ye)>=0?1:-1,de=[lc,bu].indexOf(ye)>=0?"y":"x";fe[ye]+=K[de]*J})}return fe}function AX(t,s){s===void 0&&(s={});var c=s,p=c.placement,g=c.boundary,v=c.rootBoundary,S=c.padding,r=c.flipVariations,E=c.allowedAutoPlacements,A=E===void 0?zD:E,I=p_(p),F=I?r?BP:BP.filter(function(D){return p_(D)===I}):hv,z=F.filter(function(D){return A.indexOf(D)>=0});z.length===0&&(z=F);var R=z.reduce(function(D,O){return D[O]=$y(t,{placement:O,boundary:g,rootBoundary:v,padding:S})[ph(O)],D},{});return Object.keys(R).sort(function(D,O){return R[D]-R[O]})}function PX(t){if(ph(t)===fT)return[];var s=Y1(t);return[UP(t),s,UP(s)]}function MX(t){var s=t.state,c=t.options,p=t.name;if(!s.modifiersData[p]._skip){for(var g=c.mainAxis,v=g===void 0?!0:g,S=c.altAxis,r=S===void 0?!0:S,E=c.fallbackPlacements,A=c.padding,I=c.boundary,F=c.rootBoundary,z=c.altBoundary,R=c.flipVariations,D=R===void 0?!0:R,O=c.allowedAutoPlacements,N=s.options.placement,H=ph(N),j=H===N,V=E||(j||!D?[Y1(N)]:PX(N)),Z=[N].concat(V).reduce(function(at,ut){return at.concat(ph(ut)===fT?AX(s,{placement:ut,boundary:I,rootBoundary:F,padding:A,flipVariations:D,allowedAutoPlacements:O}):ut)},[]),X=s.rects.reference,se=s.rects.popper,ge=new Map,ae=!0,oe=Z[0],fe=0;fe<Z.length;fe++){var pe=Z[fe],K=ph(pe),ye=p_(pe)===d_,J=[lc,bu].indexOf(K)>=0,de=J?"width":"height",Ae=$y(s,{placement:pe,boundary:I,rootBoundary:F,altBoundary:z,padding:A}),ne=J?ye?wu:cc:ye?bu:lc;X[de]>se[de]&&(ne=Y1(ne));var xe=Y1(ne),Ce=[];if(v&&Ce.push(Ae[K]<=0),r&&Ce.push(Ae[ne]<=0,Ae[xe]<=0),Ce.every(function(at){return at})){oe=pe,ae=!1;break}ge.set(pe,Ce)}if(ae)for(var Re=D?3:1,Ee=function(ut){var nt=Z.find(function($e){var ct=ge.get($e);if(ct)return ct.slice(0,ut).every(function(At){return At})});if(nt)return oe=nt,"break"},Oe=Re;Oe>0;Oe--){var Be=Ee(Oe);if(Be==="break")break}s.placement!==oe&&(s.modifiersData[p]._skip=!0,s.placement=oe,s.reset=!0)}}const IX={name:"flip",enabled:!0,phase:"main",fn:MX,requiresIfExists:["offset"],data:{_skip:!1}};function GP(t,s,c){return c===void 0&&(c={x:0,y:0}),{top:t.top-s.height-c.y,right:t.right-s.width+c.x,bottom:t.bottom-s.height+c.y,left:t.left-s.width-c.x}}function $P(t){return[lc,wu,bu,cc].some(function(s){return t[s]>=0})}function RX(t){var s=t.state,c=t.name,p=s.rects.reference,g=s.rects.popper,v=s.modifiersData.preventOverflow,S=$y(s,{elementContext:"reference"}),r=$y(s,{altBoundary:!0}),E=GP(S,p),A=GP(r,g,v),I=$P(E),F=$P(A);s.modifiersData[c]={referenceClippingOffsets:E,popperEscapeOffsets:A,isReferenceHidden:I,hasPopperEscaped:F},s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-reference-hidden":I,"data-popper-escaped":F})}const DX={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:RX};function kX(t,s,c){var p=ph(t),g=[cc,lc].indexOf(p)>=0?-1:1,v=typeof c=="function"?c(Object.assign({},s,{placement:t})):c,S=v[0],r=v[1];return S=S||0,r=(r||0)*g,[cc,wu].indexOf(p)>=0?{x:r,y:S}:{x:S,y:r}}function OX(t){var s=t.state,c=t.options,p=t.name,g=c.offset,v=g===void 0?[0,0]:g,S=zD.reduce(function(I,F){return I[F]=kX(F,s.rects,v),I},{}),r=S[s.placement],E=r.x,A=r.y;s.modifiersData.popperOffsets!=null&&(s.modifiersData.popperOffsets.x+=E,s.modifiersData.popperOffsets.y+=A),s.modifiersData[p]=S}const LX={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:OX};function zX(t){var s=t.state,c=t.name;s.modifiersData[c]=GD({reference:s.rects.reference,element:s.rects.popper,placement:s.placement})}const FX={name:"popperOffsets",enabled:!0,phase:"read",fn:zX,data:{}};function BX(t){return t==="x"?"y":"x"}function NX(t){var s=t.state,c=t.options,p=t.name,g=c.mainAxis,v=g===void 0?!0:g,S=c.altAxis,r=S===void 0?!1:S,E=c.boundary,A=c.rootBoundary,I=c.altBoundary,F=c.padding,z=c.tether,R=z===void 0?!0:z,D=c.tetherOffset,O=D===void 0?0:D,N=$y(s,{boundary:E,rootBoundary:A,padding:F,altBoundary:I}),H=ph(s.placement),j=p_(s.placement),V=!j,Z=gT(H),X=BX(Z),se=s.modifiersData.popperOffsets,ge=s.rects.reference,ae=s.rects.popper,oe=typeof O=="function"?O(Object.assign({},s.rects,{placement:s.placement})):O,fe=typeof oe=="number"?{mainAxis:oe,altAxis:oe}:Object.assign({mainAxis:0,altAxis:0},oe),pe=s.modifiersData.offset?s.modifiersData.offset[s.placement]:null,K={x:0,y:0};if(se){if(v){var ye,J=Z==="y"?lc:cc,de=Z==="y"?bu:wu,Ae=Z==="y"?"height":"width",ne=se[Z],xe=ne+N[J],Ce=ne-N[de],Re=R?-ae[Ae]/2:0,Ee=j===d_?ge[Ae]:ae[Ae],Oe=j===d_?-ae[Ae]:-ge[Ae],Be=s.elements.arrow,at=R&&Be?mT(Be):{width:0,height:0},ut=s.modifiersData["arrow#persistent"]?s.modifiersData["arrow#persistent"].padding:ND(),nt=ut[J],$e=ut[de],ct=Ry(0,ge[Ae],at[Ae]),At=V?ge[Ae]/2-Re-ct-nt-fe.mainAxis:Ee-ct-nt-fe.mainAxis,xt=V?-ge[Ae]/2+Re+ct+$e+fe.mainAxis:Oe+ct+$e+fe.mainAxis,It=s.elements.arrow&&fv(s.elements.arrow),jt=It?Z==="y"?It.clientTop||0:It.clientLeft||0:0,cn=(ye=pe?.[Z])!=null?ye:0,Se=ne+At-cn-jt,mt=ne+xt-cn,Ke=Ry(R?bx(xe,Se):xe,ne,R?qm(Ce,mt):Ce);se[Z]=Ke,K[Z]=Ke-ne}if(r){var Ue,je=Z==="x"?lc:cc,gt=Z==="x"?bu:wu,Ot=se[X],Ft=X==="y"?"height":"width",pt=Ot+N[je],dn=Ot-N[gt],An=[lc,cc].indexOf(H)!==-1,Gt=(Ue=pe?.[X])!=null?Ue:0,Yt=An?pt:Ot-ge[Ft]-ae[Ft]-Gt+fe.altAxis,zn=An?Ot+ge[Ft]+ae[Ft]-Gt-fe.altAxis:dn,$n=R&&An?cX(Yt,Ot,zn):Ry(R?Yt:pt,Ot,R?zn:dn);se[X]=$n,K[X]=$n-Ot}s.modifiersData[p]=K}}const VX={name:"preventOverflow",enabled:!0,phase:"main",fn:NX,requiresIfExists:["offset"]};function UX(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function jX(t){return t===Fc(t)||!xu(t)?_T(t):UX(t)}function GX(t){var s=t.getBoundingClientRect(),c=h_(s.width)/t.offsetWidth||1,p=h_(s.height)/t.offsetHeight||1;return c!==1||p!==1}function $X(t,s,c){c===void 0&&(c=!1);var p=xu(s),g=xu(s)&&GX(s),v=jp(s),S=f_(t,g,c),r={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(p||!p&&!c)&&((yh(s)!=="body"||vT(v))&&(r=jX(s)),xu(s)?(E=f_(s,!0),E.x+=s.clientLeft,E.y+=s.clientTop):v&&(E.x=yT(v))),{x:S.left+r.scrollLeft-E.x,y:S.top+r.scrollTop-E.y,width:S.width,height:S.height}}function HX(t){var s=new Map,c=new Set,p=[];t.forEach(function(v){s.set(v.name,v)});function g(v){c.add(v.name);var S=[].concat(v.requires||[],v.requiresIfExists||[]);S.forEach(function(r){if(!c.has(r)){var E=s.get(r);E&&g(E)}}),p.push(v)}return t.forEach(function(v){c.has(v.name)||g(v)}),p}function qX(t){var s=HX(t);return rX.reduce(function(c,p){return c.concat(s.filter(function(g){return g.phase===p}))},[])}function WX(t){var s;return function(){return s||(s=new Promise(function(c){Promise.resolve().then(function(){s=void 0,c(t())})})),s}}function ZX(t){var s=t.reduce(function(c,p){var g=c[p.name];return c[p.name]=g?Object.assign({},g,p,{options:Object.assign({},g.options,p.options),data:Object.assign({},g.data,p.data)}):p,c},{});return Object.keys(s).map(function(c){return s[c]})}var HP={placement:"bottom",modifiers:[],strategy:"absolute"};function qP(){for(var t=arguments.length,s=new Array(t),c=0;c<t;c++)s[c]=arguments[c];return!s.some(function(p){return!(p&&typeof p.getBoundingClientRect=="function")})}function YX(t){t===void 0&&(t={});var s=t,c=s.defaultModifiers,p=c===void 0?[]:c,g=s.defaultOptions,v=g===void 0?HP:g;return function(r,E,A){A===void 0&&(A=v);var I={placement:"bottom",orderedModifiers:[],options:Object.assign({},HP,v),modifiersData:{},elements:{reference:r,popper:E},attributes:{},styles:{}},F=[],z=!1,R={state:I,setOptions:function(H){var j=typeof H=="function"?H(I.options):H;O(),I.options=Object.assign({},v,I.options,j),I.scrollParents={reference:Xm(r)?Dy(r):r.contextElement?Dy(r.contextElement):[],popper:Dy(E)};var V=qX(ZX([].concat(p,I.options.modifiers)));return I.orderedModifiers=V.filter(function(Z){return Z.enabled}),D(),R.update()},forceUpdate:function(){if(!z){var H=I.elements,j=H.reference,V=H.popper;if(qP(j,V)){I.rects={reference:$X(j,fv(V),I.options.strategy==="fixed"),popper:mT(V)},I.reset=!1,I.placement=I.options.placement,I.orderedModifiers.forEach(function(fe){return I.modifiersData[fe.name]=Object.assign({},fe.data)});for(var Z=0;Z<I.orderedModifiers.length;Z++){if(I.reset===!0){I.reset=!1,Z=-1;continue}var X=I.orderedModifiers[Z],se=X.fn,ge=X.options,ae=ge===void 0?{}:ge,oe=X.name;typeof se=="function"&&(I=se({state:I,options:ae,name:oe,instance:R})||I)}}}},update:WX(function(){return new Promise(function(N){R.forceUpdate(),N(I)})}),destroy:function(){O(),z=!0}};if(!qP(r,E))return R;R.setOptions(A).then(function(N){!z&&A.onFirstUpdate&&A.onFirstUpdate(N)});function D(){I.orderedModifiers.forEach(function(N){var H=N.name,j=N.options,V=j===void 0?{}:j,Z=N.effect;if(typeof Z=="function"){var X=Z({state:I,name:H,instance:R,options:V}),se=function(){};F.push(X||se)}})}function O(){F.forEach(function(N){return N()}),F=[]}return R}}var XX=[vX,FX,_X,sX,LX,IX,VX,fX,DX],KX=YX({defaultModifiers:XX});function JX(t){return ui("MuiPopper",t)}oi("MuiPopper",["root"]);function QX(t,s){if(s==="ltr")return t;switch(t){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return t}}function oS(t){return typeof t=="function"?t():t}function eK(t){return t.nodeType!==void 0}const tK=t=>{const{classes:s}=t;return ti({root:["root"]},JX,s)},nK={},rK=Te.forwardRef(function(s,c){const{anchorEl:p,children:g,direction:v,disablePortal:S,modifiers:r,open:E,placement:A,popperOptions:I,popperRef:F,slotProps:z={},slots:R={},TransitionProps:D,ownerState:O,...N}=s,H=Te.useRef(null),j=So(H,c),V=Te.useRef(null),Z=So(V,F),X=Te.useRef(Z);la(()=>{X.current=Z},[Z]),Te.useImperativeHandle(F,()=>V.current,[]);const se=QX(A,v),[ge,ae]=Te.useState(se),[oe,fe]=Te.useState(oS(p));Te.useEffect(()=>{V.current&&V.current.forceUpdate()}),Te.useEffect(()=>{p&&fe(oS(p))},[p]),la(()=>{if(!oe||!E)return;const de=xe=>{ae(xe.placement)};let Ae=[{name:"preventOverflow",options:{altBoundary:S}},{name:"flip",options:{altBoundary:S}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:({state:xe})=>{de(xe)}}];r!=null&&(Ae=Ae.concat(r)),I&&I.modifiers!=null&&(Ae=Ae.concat(I.modifiers));const ne=KX(oe,H.current,{placement:se,...I,modifiers:Ae});return X.current(ne),()=>{ne.destroy(),X.current(null)}},[oe,S,r,E,I,se]);const pe={placement:ge};D!==null&&(pe.TransitionProps=D);const K=tK(s),ye=R.root??"div",J=ji({elementType:ye,externalSlotProps:z.root,externalForwardedProps:N,additionalProps:{role:"tooltip",ref:j},ownerState:s,className:K.root});return ue.jsx(ye,{...J,children:typeof g=="function"?g(pe):g})}),iK=Te.forwardRef(function(s,c){const{anchorEl:p,children:g,container:v,direction:S="ltr",disablePortal:r=!1,keepMounted:E=!1,modifiers:A,open:I,placement:F="bottom",popperOptions:z=nK,popperRef:R,style:D,transition:O=!1,slotProps:N={},slots:H={},...j}=s,[V,Z]=Te.useState(!0),X=()=>{Z(!1)},se=()=>{Z(!0)};if(!E&&!I&&(!O||V))return null;let ge;if(v)ge=v;else if(p){const fe=oS(p);ge=fe&&eK(fe)?As(fe).body:As(null).body}const ae=!I&&E&&(!O||V)?"none":void 0,oe=O?{in:I,onEnter:X,onExited:se}:void 0;return ue.jsx(lD,{disablePortal:r,container:ge,children:ue.jsx(rK,{anchorEl:p,direction:S,disablePortal:r,modifiers:A,ref:c,open:O?!V:I,placement:F,popperOptions:z,popperRef:R,slotProps:N,slots:H,...j,style:{position:"fixed",top:0,left:0,display:ae,...D},TransitionProps:oe,children:g})})}),oK=Cn(iK,{name:"MuiPopper",slot:"Root"})({}),sK=Te.forwardRef(function(s,c){const p=Su(),g=To({props:s,name:"MuiPopper"}),{anchorEl:v,component:S,components:r,componentsProps:E,container:A,disablePortal:I,keepMounted:F,modifiers:z,open:R,placement:D,popperOptions:O,popperRef:N,transition:H,slots:j,slotProps:V,...Z}=g,X=j?.root??r?.Root,se={anchorEl:v,container:A,disablePortal:I,keepMounted:F,modifiers:z,open:R,placement:D,popperOptions:O,popperRef:N,transition:H,...Z};return ue.jsx(oK,{as:S,direction:p?"rtl":"ltr",slots:{root:X},slotProps:V??E,...se,ref:c})});function aK(t){return ui("MuiPickerPopper",t)}oi("MuiPickerPopper",["root","paper"]);const lK=["PaperComponent","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],cK=t=>ti({root:["root"],paper:["paper"]},aK,t),uK=Cn(sK,{name:"MuiPickerPopper",slot:"Root"})(({theme:t})=>({zIndex:t.zIndex.modal})),dK=Cn(db,{name:"MuiPickerPopper",slot:"Paper"})({outline:0,transformOrigin:"top center",variants:[{props:({popperPlacement:t})=>new Set(["top","top-start","top-end"]).has(t),style:{transformOrigin:"bottom center"}}]});function hK(t,s){return s.documentElement.clientWidth<t.clientX||s.documentElement.clientHeight<t.clientY}function fK(t,s){const c=Te.useRef(!1),p=Te.useRef(!1),g=Te.useRef(null),v=Te.useRef(!1);Te.useEffect(()=>{if(!t)return;function E(){v.current=!0}return document.addEventListener("mousedown",E,!0),document.addEventListener("touchstart",E,!0),()=>{document.removeEventListener("mousedown",E,!0),document.removeEventListener("touchstart",E,!0),v.current=!1}},[t]);const S=_r(E=>{if(!v.current)return;const A=p.current;p.current=!1;const I=As(g.current);if(!g.current||"clientX"in E&&hK(E,I))return;if(c.current){c.current=!1;return}let F;E.composedPath?F=E.composedPath().indexOf(g.current)>-1:F=!I.documentElement.contains(E.target)||g.current.contains(E.target),!F&&!A&&s(E)}),r=E=>{E.defaultMuiPrevented||(p.current=!0)};return Te.useEffect(()=>{if(t){const E=As(g.current),A=()=>{c.current=!0};return E.addEventListener("touchstart",S),E.addEventListener("touchmove",A),()=>{E.removeEventListener("touchstart",S),E.removeEventListener("touchmove",A)}}},[t,S]),Te.useEffect(()=>{if(t){const E=As(g.current);return E.addEventListener("click",S),()=>{E.removeEventListener("click",S),p.current=!1}}},[t,S]),[g,r,r]}const pK=Te.forwardRef((t,s)=>{const{PaperComponent:c,ownerState:p,children:g,paperSlotProps:v,paperClasses:S,onPaperClick:r,onPaperTouchStart:E}=t,A=_i(t,lK),I=ji({elementType:c,externalSlotProps:v,additionalProps:{tabIndex:-1,elevation:8,ref:s},className:S,ownerState:p});return ue.jsx(c,Nt({},A,I,{onClick:F=>{r(F),I.onClick?.(F)},onTouchStart:F=>{E(F),I.onTouchStart?.(F)},ownerState:p,children:g}))});function mK(t){const s=_s({props:t,name:"MuiPickerPopper"}),{children:c,placement:p="bottom-start",slots:g,slotProps:v,classes:S}=s,{open:r,popupRef:E,reduceAnimations:A}=x_(),{ownerState:I,rootRefObject:F}=Na(),{dismissViews:z,getCurrentViewMode:R,onPopperExited:D,triggerElement:O,viewContainerRole:N}=Na();Te.useEffect(()=>{function ne(xe){r&&xe.key==="Escape"&&z()}return document.addEventListener("keydown",ne),()=>{document.removeEventListener("keydown",ne)}},[z,r]);const H=Te.useRef(null);Te.useEffect(()=>{N==="tooltip"||R()==="field"||(r?H.current=Dl(F.current):H.current&&H.current instanceof HTMLElement&&setTimeout(()=>{H.current instanceof HTMLElement&&H.current.focus()}))},[r,N,R,F]);const j=cK(S),V=_r(()=>{N==="tooltip"?aH(()=>{F.current?.contains(Dl(F.current))||E.current?.contains(Dl(E.current))||z()}):z()}),[Z,X,se]=fK(r,V),ge=Te.useRef(null),ae=So(ge,E),oe=So(ae,Z),fe=ne=>{ne.key==="Escape"&&(ne.stopPropagation(),z())},pe=g?.desktopTransition??A?Ym:xx,K=g?.desktopTrapFocus??aD,ye=g?.desktopPaper??dK,J=g?.popper??uK,de=ji({elementType:J,externalSlotProps:v?.popper,additionalProps:{transition:!0,role:N??void 0,open:r,placement:p,anchorEl:O,onKeyDown:fe},className:j.root,ownerState:I}),Ae=Te.useMemo(()=>Nt({},I,{popperPlacement:de.placement}),[I,de.placement]);return ue.jsx(J,Nt({},de,{children:({TransitionProps:ne})=>ue.jsx(K,Nt({open:r,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:N==="tooltip",isEnabled:()=>!0},v?.desktopTrapFocus,{children:ue.jsx(pe,Nt({},ne,v?.desktopTransition,{onExited:xe=>{D?.(),v?.desktopTransition?.onExited?.(xe),ne?.onExited?.()},children:ue.jsx(pK,{PaperComponent:ye,ownerState:Ae,ref:oe,onPaperClick:X,onPaperTouchStart:se,paperClasses:j.paper,paperSlotProps:v?.desktopPaper,children:c})}))}))}))}function WP(){return typeof window>"u"?"portrait":window.screen&&window.screen.orientation&&window.screen.orientation.angle?Math.abs(window.screen.orientation.angle)===90?"landscape":"portrait":window.orientation&&Math.abs(Number(window.orientation))===90?"landscape":"portrait"}function gK(t,s){const[c,p]=Te.useState(WP);return la(()=>{const g=()=>{p(WP())};return window.addEventListener("orientationchange",g),()=>{window.removeEventListener("orientationchange",g)}},[]),sH(t,["hours","minutes","seconds"])?"portrait":s??c}function _K(t){const{props:s,valueManager:c,validator:p}=t,{value:g,defaultValue:v,onChange:S,referenceDate:r,timezone:E,onAccept:A,closeOnSelect:I,open:F,onOpen:z,onClose:R}=s,{current:D}=Te.useRef(v),{current:O}=Te.useRef(g!==void 0),{current:N}=Te.useRef(F!==void 0),H=Ko(),{timezone:j,value:V,handleValueChange:Z}=lv({name:"a picker component",timezone:E,value:g,defaultValue:D,referenceDate:r,onChange:S,valueManager:c}),[X,se]=Te.useState(()=>({open:!1,lastExternalValue:V,clockShallowValue:void 0,lastCommittedValue:V,hasBeenModifiedSinceMount:!1})),{getValidationErrorForNewValue:ge}=QR({props:s,validator:p,timezone:j,value:V,onError:s.onError}),ae=_r(K=>{const ye=typeof K=="function"?K(X.open):K;N||se(J=>Nt({},J,{open:ye})),ye&&z&&z(),ye||R?.()}),oe=_r((K,ye)=>{const{changeImportance:J="accept",skipPublicationIfPristine:de=!1,validationError:Ae,shortcut:ne,shouldClose:xe=J==="accept"}=ye??{};let Ce,Re;!de&&!O&&!X.hasBeenModifiedSinceMount?(Ce=!0,Re=J==="accept"):(Ce=!c.areValuesEqual(H,K,V),Re=J==="accept"&&!c.areValuesEqual(H,K,X.lastCommittedValue)),se(Be=>Nt({},Be,{clockShallowValue:Ce?void 0:Be.clockShallowValue,lastCommittedValue:Re?K:Be.lastCommittedValue,hasBeenModifiedSinceMount:!0}));let Ee=null;const Oe=()=>(Ee||(Ee={validationError:Ae??ge(K)},ne&&(Ee.shortcut=ne)),Ee);Ce&&Z(K,Oe()),Re&&A&&A(K,Oe()),xe&&ae(!1)});V!==X.lastExternalValue&&se(K=>Nt({},K,{lastExternalValue:V,clockShallowValue:void 0,hasBeenModifiedSinceMount:!0}));const fe=_r((K,ye="partial")=>{if(ye==="shallow"){se(J=>Nt({},J,{clockShallowValue:K,hasBeenModifiedSinceMount:!0}));return}oe(K,{changeImportance:ye==="finish"&&I?"accept":"set"})});Te.useEffect(()=>{if(N){if(F===void 0)throw new Error("You must not mix controlling and uncontrolled mode for `open` prop");se(K=>Nt({},K,{open:F}))}},[N,F]);const pe=Te.useMemo(()=>c.cleanValue(H,X.clockShallowValue===void 0?V:X.clockShallowValue),[H,c,X.clockShallowValue,V]);return{timezone:j,state:X,setValue:oe,setValueFromView:fe,setOpen:ae,value:V,viewValue:pe}}const yK=["className","sx"],$D=({ref:t,props:s,valueManager:c,valueType:p,variant:g,validator:v,onPopperExited:S,autoFocusView:r,rendererInterceptor:E,localeText:A,viewContainerRole:I,getStepNavigation:F})=>{const{views:z,view:R,openTo:D,onViewChange:O,viewRenderers:N,reduceAnimations:H,orientation:j,disableOpenPicker:V,closeOnSelect:Z,disabled:X,readOnly:se,formatDensity:ge,enableAccessibleFieldDOMStructure:ae,selectedSections:oe,onSelectedSectionsChange:fe,format:pe,label:K,autoFocus:ye,name:J}=s,{className:de,sx:Ae}=s,ne=_i(s,yK),xe=Np(),Ce=Ko(),Re=DD(H),Ee=gK(z,j),{current:Oe}=Te.useRef(D??null),[Be,at]=Te.useState(null),ut=Te.useRef(null),nt=Te.useRef(null),$e=Te.useRef(null),ct=So(t,$e),{timezone:At,state:xt,setOpen:It,setValue:jt,setValueFromView:cn,value:Se,viewValue:mt}=_K({props:s,valueManager:c,validator:v}),{view:Ke,setView:Ue,defaultView:je,focusedView:gt,setFocusedView:Ot,setValueAndGoToNextView:Ft,goToNextStep:pt,hasNextStep:dn,hasSeveralSteps:An}=$R({view:R,views:z,openTo:D,onChange:cn,onViewChange:O,autoFocus:r,getStepNavigation:F}),Gt=_r(()=>jt(c.emptyValue)),Yt=_r(()=>jt(c.getTodayValue(Ce,At,p))),zn=_r(()=>jt(Se)),$n=_r(()=>jt(xt.lastCommittedValue,{skipPublicationIfPristine:!0})),On=_r(()=>{jt(Se,{skipPublicationIfPristine:!0})}),{hasUIView:Bn,viewModeLookup:kn,timeViewsCount:Pr}=Te.useMemo(()=>z.reduce((yo,ca)=>{const Va=N[ca]==null?"field":"UI";return yo.viewModeLookup[ca]=Va,Va==="UI"&&(yo.hasUIView=!0,H$(ca)&&(yo.timeViewsCount+=1)),yo},{hasUIView:!1,viewModeLookup:{},timeViewsCount:0}),[N,z]),mr=kn[Ke],ni=_r(()=>mr),[tr,Br]=Te.useState(mr==="UI"?Ke:null);tr!==Ke&&kn[Ke]==="UI"&&Br(Ke),la(()=>{mr==="field"&&xt.open&&(It(!1),setTimeout(()=>{nt?.current?.setSelectedSections(Ke),nt?.current?.focusField(Ke)}))},[Ke]),la(()=>{if(!xt.open)return;let yo=Ke;mr==="field"&&tr!=null&&(yo=tr),yo!==je&&kn[yo]==="UI"&&kn[je]==="UI"&&(yo=je),yo!==Ke&&Ue(yo),Ot(yo,!0)},[xt.open]);const Tr=Te.useMemo(()=>({isPickerValueEmpty:c.areValuesEqual(Ce,Se,c.emptyValue),isPickerOpen:xt.open,isPickerDisabled:s.disabled??!1,isPickerReadOnly:s.readOnly??!1,pickerOrientation:Ee,pickerVariant:g}),[Ce,c,Se,xt.open,Ee,g,s.disabled,s.readOnly]),Fr=Te.useMemo(()=>V||!Bn?"hidden":X||se?"disabled":"enabled",[V,Bn,X,se]),di=_r(pt),Mo=Te.useMemo(()=>Z&&!An?[]:["cancel","nextOrAccept"],[Z,An]),ds=Te.useMemo(()=>({setValue:jt,setOpen:It,clearValue:Gt,setValueToToday:Yt,acceptValueChanges:zn,cancelValueChanges:$n,setView:Ue,goToNextStep:di}),[jt,It,Gt,Yt,zn,$n,Ue,di]),Yr=Te.useMemo(()=>Nt({},ds,{value:Se,timezone:At,open:xt.open,views:z,view:tr,initialView:Oe,disabled:X??!1,readOnly:se??!1,autoFocus:ye??!1,variant:g,orientation:Ee,popupRef:ut,reduceAnimations:Re,triggerRef:at,triggerStatus:Fr,hasNextStep:dn,fieldFormat:pe??"",name:J,label:K,rootSx:Ae,rootRef:ct,rootClassName:de}),[ds,Se,ct,g,Ee,Re,X,se,pe,de,J,K,Ae,Fr,dn,At,xt.open,tr,z,Oe,ye]),co=Te.useMemo(()=>({dismissViews:On,ownerState:Tr,hasUIView:Bn,getCurrentViewMode:ni,rootRefObject:$e,labelId:xe,triggerElement:Be,viewContainerRole:I,defaultActionBarActions:Mo,onPopperExited:S}),[On,Tr,Bn,ni,xe,Be,I,Mo,S]),ya=Te.useMemo(()=>({formatDensity:ge,enableAccessibleFieldDOMStructure:ae,selectedSections:oe,onSelectedSectionsChange:fe,fieldRef:nt}),[ge,ae,oe,fe,nt]);return{providerProps:{localeText:A,contextValue:Yr,privateContextValue:co,actionsContextValue:ds,fieldPrivateContextValue:ya,isValidContextValue:yo=>{const ca=v({adapter:Ce,value:yo,timezone:At,props:s});return!c.hasError(ca)}},renderCurrentView:()=>{if(tr==null)return null;const yo=N[tr];if(yo==null)return null;const ca=Nt({},ne,{views:z,timezone:At,value:mt,onChange:Ft,view:tr,onViewChange:Ue,showViewSwitcher:Pr>1,timeViewsCount:Pr},I==="tooltip"?{focusedView:null,onFocusedViewChange:()=>{}}:{focusedView:gt,onFocusedViewChange:Ot});return E?ue.jsx(E,{viewRenderers:N,popperView:tr,rendererProps:ca}):yo(ca)},ownerState:Tr}};function HD(t){return ui("MuiPickersLayout",t)}const Lm=oi("MuiPickersLayout",["root","landscape","contentWrapper","toolbar","actionBar","tabs","shortcuts"]);function vK(t){return ui("MuiButton",t)}const zm=oi("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),xK=Te.createContext({}),bK=Te.createContext(void 0),wK=t=>{const{color:s,disableElevation:c,fullWidth:p,size:g,variant:v,loading:S,loadingPosition:r,classes:E}=t,A={root:["root",S&&"loading",v,`${v}${ar(s)}`,`size${ar(g)}`,`${v}Size${ar(g)}`,`color${ar(s)}`,c&&"disableElevation",p&&"fullWidth",S&&`loadingPosition${ar(r)}`],startIcon:["icon","startIcon",`iconSize${ar(g)}`],endIcon:["icon","endIcon",`iconSize${ar(g)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},I=ti(A,vK,E);return{...E,...I}},qD=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],SK=Cn(Uy,{shouldForwardProp:t=>hd(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,s[c.variant],s[`${c.variant}${ar(c.color)}`],s[`size${ar(c.size)}`],s[`${c.variant}Size${ar(c.size)}`],c.color==="inherit"&&s.colorInherit,c.disableElevation&&s.disableElevation,c.fullWidth&&s.fullWidth,c.loading&&s.loading]}})(_o(({theme:t})=>{const s=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],c=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${zm.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${zm.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${zm.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${zm.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(il()).map(([p])=>({props:{color:p},style:{"--variant-textColor":(t.vars||t).palette[p].main,"--variant-outlinedColor":(t.vars||t).palette[p].main,"--variant-outlinedBorder":t.alpha((t.vars||t).palette[p].main,.5),"--variant-containedColor":(t.vars||t).palette[p].contrastText,"--variant-containedBg":(t.vars||t).palette[p].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[p].dark,"--variant-textBg":t.alpha((t.vars||t).palette[p].main,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[p].main,"--variant-outlinedBg":t.alpha((t.vars||t).palette[p].main,(t.vars||t).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:s,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:c,"--variant-textBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${zm.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${zm.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${zm.loading}`]:{color:"transparent"}}}]}})),TK=Cn("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.startIcon,c.loading&&s.startIconLoadingStart,s[`iconSize${ar(c.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...qD]})),CK=Cn("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.endIcon,c.loading&&s.endIconLoadingEnd,s[`iconSize${ar(c.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...qD]})),EK=Cn("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),ZP=Cn("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),Fm=Te.forwardRef(function(s,c){const p=Te.useContext(xK),g=Te.useContext(bK),v=By(p,s),S=To({props:v,name:"MuiButton"}),{children:r,color:E="primary",component:A="button",className:I,disabled:F=!1,disableElevation:z=!1,disableFocusRipple:R=!1,endIcon:D,focusVisibleClassName:O,fullWidth:N=!1,id:H,loading:j=null,loadingIndicator:V,loadingPosition:Z="center",size:X="medium",startIcon:se,type:ge,variant:ae="text",...oe}=S,fe=Np(H),pe=V??ue.jsx(jR,{"aria-labelledby":fe,color:"inherit",size:16}),K={...S,color:E,component:A,disabled:F,disableElevation:z,disableFocusRipple:R,fullWidth:N,loading:j,loadingIndicator:pe,loadingPosition:Z,size:X,type:ge,variant:ae},ye=wK(K),J=(se||j&&Z==="start")&&ue.jsx(TK,{className:ye.startIcon,ownerState:K,children:se||ue.jsx(ZP,{className:ye.loadingIconPlaceholder,ownerState:K})}),de=(D||j&&Z==="end")&&ue.jsx(CK,{className:ye.endIcon,ownerState:K,children:D||ue.jsx(ZP,{className:ye.loadingIconPlaceholder,ownerState:K})}),Ae=g||"",ne=typeof j=="boolean"?ue.jsx("span",{className:ye.loadingWrapper,style:{display:"contents"},children:j&&ue.jsx(EK,{className:ye.loadingIndicator,ownerState:K,children:pe})}):null;return ue.jsxs(SK,{ownerState:K,className:Ar(p.className,ye.root,I,Ae),component:A,disabled:F||j,focusRipple:!R,focusVisibleClassName:Ar(ye.focusVisible,O),ref:c,type:ge,id:j?fe:H,...oe,classes:ye,children:[J,Z!=="end"&&ne,r,Z==="end"&&ne,de]})});function AK(t){return ui("MuiDialogActions",t)}oi("MuiDialogActions",["root","spacing"]);const PK=t=>{const{classes:s,disableSpacing:c}=t;return ti({root:["root",!c&&"spacing"]},AK,s)},MK=Cn("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,!c.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),IK=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiDialogActions"}),{className:g,disableSpacing:v=!1,...S}=p,r={...p,disableSpacing:v},E=PK(r);return ue.jsx(MK,{className:Ar(E.root,g),ownerState:r,ref:c,...S})}),RK=["actions"],DK=Cn(IK,{name:"MuiPickersLayout",slot:"ActionBar"})({});function kK(t){const{actions:s}=t,c=_i(t,RK),p=Up(),{clearValue:g,setValueToToday:v,acceptValueChanges:S,cancelValueChanges:r,goToNextStep:E,hasNextStep:A}=x_();if(s==null||s.length===0)return null;const I=s?.map(F=>{switch(F){case"clear":return ue.jsx(Fm,{onClick:g,children:p.clearButtonLabel},F);case"cancel":return ue.jsx(Fm,{onClick:r,children:p.cancelButtonLabel},F);case"accept":return ue.jsx(Fm,{onClick:S,children:p.okButtonLabel},F);case"today":return ue.jsx(Fm,{onClick:v,children:p.todayButtonLabel},F);case"next":return ue.jsx(Fm,{onClick:E,children:p.nextStepButtonLabel},F);case"nextOrAccept":return A?ue.jsx(Fm,{onClick:E,children:p.nextStepButtonLabel},F):ue.jsx(Fm,{onClick:S,children:p.okButtonLabel},F);default:return null}});return ue.jsx(DK,Nt({},c,{children:I}))}const OK=Te.memo(kK);function LK(t){return ui("MuiListItem",t)}oi("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);const zK=oi("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function FK(t){return ui("MuiListItemSecondaryAction",t)}oi("MuiListItemSecondaryAction",["root","disableGutters"]);const BK=t=>{const{disableGutters:s,classes:c}=t;return ti({root:["root",s&&"disableGutters"]},FK,c)},NK=Cn("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.disableGutters&&s.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:t})=>t.disableGutters,style:{right:0}}]}),WD=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiListItemSecondaryAction"}),{className:g,...v}=p,S=Te.useContext(Ay),r={...p,disableGutters:S.disableGutters},E=BK(r);return ue.jsx(NK,{className:Ar(E.root,g),ownerState:r,ref:c,...v})});WD.muiName="ListItemSecondaryAction";const VK=(t,s)=>{const{ownerState:c}=t;return[s.root,c.dense&&s.dense,c.alignItems==="flex-start"&&s.alignItemsFlexStart,c.divider&&s.divider,!c.disableGutters&&s.gutters,!c.disablePadding&&s.padding,c.hasSecondaryAction&&s.secondaryAction]},UK=t=>{const{alignItems:s,classes:c,dense:p,disableGutters:g,disablePadding:v,divider:S,hasSecondaryAction:r}=t;return ti({root:["root",p&&"dense",!g&&"gutters",!v&&"padding",S&&"divider",s==="flex-start"&&"alignItemsFlexStart",r&&"secondaryAction"],container:["container"]},LK,c)},jK=Cn("div",{name:"MuiListItem",slot:"Root",overridesResolver:VK})(_o(({theme:t})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:s})=>!s.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:s})=>!s.disablePadding&&s.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:s})=>!s.disablePadding&&!s.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:s})=>!s.disablePadding&&!!s.secondaryAction,style:{paddingRight:48}},{props:({ownerState:s})=>!!s.secondaryAction,style:{[`& > .${zK.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:s})=>s.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:s})=>s.button,style:{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:s})=>s.hasSecondaryAction,style:{paddingRight:48}}]}))),GK=Cn("li",{name:"MuiListItem",slot:"Container"})({position:"relative"}),$K=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiListItem"}),{alignItems:g="center",children:v,className:S,component:r,components:E={},componentsProps:A={},ContainerComponent:I="li",ContainerProps:{className:F,...z}={},dense:R=!1,disableGutters:D=!1,disablePadding:O=!1,divider:N=!1,secondaryAction:H,slotProps:j={},slots:V={},...Z}=p,X=Te.useContext(Ay),se=Te.useMemo(()=>({dense:R||X.dense||!1,alignItems:g,disableGutters:D}),[g,X.dense,R,D]),ge=Te.useRef(null),ae=Te.Children.toArray(v),oe=ae.length&&W1(ae[ae.length-1],["ListItemSecondaryAction"]),fe={...p,alignItems:g,dense:se.dense,disableGutters:D,disablePadding:O,divider:N,hasSecondaryAction:oe},pe=UK(fe),K=So(ge,c),ye=V.root||E.Root||jK,J=j.root||A.root||{},de={className:Ar(pe.root,J.className,S),...Z};let Ae=r||"li";return oe?(Ae=!de.component&&!r?"div":Ae,I==="li"&&(Ae==="li"?Ae="div":de.component==="li"&&(de.component="div")),ue.jsx(Ay.Provider,{value:se,children:ue.jsxs(GK,{as:I,className:Ar(pe.container,F),ref:K,ownerState:fe,...z,children:[ue.jsx(ye,{...J,...!dh(ye)&&{as:Ae,ownerState:{...fe,...J.ownerState}},...de,children:ae}),ae.pop()]})})):ue.jsx(Ay.Provider,{value:se,children:ue.jsxs(ye,{...J,as:Ae,ref:K,...!dh(ye)&&{ownerState:{...fe,...J.ownerState}},...de,children:[ae,H&&ue.jsx(WD,{children:H})]})})}),HK=xh(ue.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function qK(t){return ui("MuiChip",t)}const no=oi("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),WK=t=>{const{classes:s,disabled:c,size:p,color:g,iconColor:v,onDelete:S,clickable:r,variant:E}=t,A={root:["root",E,c&&"disabled",`size${ar(p)}`,`color${ar(g)}`,r&&"clickable",r&&`clickableColor${ar(g)}`,S&&"deletable",S&&`deletableColor${ar(g)}`,`${E}${ar(g)}`],label:["label",`label${ar(p)}`],avatar:["avatar",`avatar${ar(p)}`,`avatarColor${ar(g)}`],icon:["icon",`icon${ar(p)}`,`iconColor${ar(v)}`],deleteIcon:["deleteIcon",`deleteIcon${ar(p)}`,`deleteIconColor${ar(g)}`,`deleteIcon${ar(E)}Color${ar(g)}`]};return ti(A,qK,s)},ZK=Cn("div",{name:"MuiChip",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t,{color:p,iconColor:g,clickable:v,onDelete:S,size:r,variant:E}=c;return[{[`& .${no.avatar}`]:s.avatar},{[`& .${no.avatar}`]:s[`avatar${ar(r)}`]},{[`& .${no.avatar}`]:s[`avatarColor${ar(p)}`]},{[`& .${no.icon}`]:s.icon},{[`& .${no.icon}`]:s[`icon${ar(r)}`]},{[`& .${no.icon}`]:s[`iconColor${ar(g)}`]},{[`& .${no.deleteIcon}`]:s.deleteIcon},{[`& .${no.deleteIcon}`]:s[`deleteIcon${ar(r)}`]},{[`& .${no.deleteIcon}`]:s[`deleteIconColor${ar(p)}`]},{[`& .${no.deleteIcon}`]:s[`deleteIcon${ar(E)}Color${ar(p)}`]},s.root,s[`size${ar(r)}`],s[`color${ar(p)}`],v&&s.clickable,v&&p!=="default"&&s[`clickableColor${ar(p)})`],S&&s.deletable,S&&p!=="default"&&s[`deletableColor${ar(p)}`],s[E],s[`${E}${ar(p)}`]]}})(_o(({theme:t})=>{const s=t.palette.mode==="light"?t.palette.grey[700]:t.palette.grey[300];return{maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${no.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${no.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:s,fontSize:t.typography.pxToRem(12)},[`& .${no.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${no.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${no.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${no.icon}`]:{marginLeft:5,marginRight:-6},[`& .${no.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:t.alpha((t.vars||t).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.alpha((t.vars||t).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${no.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${no.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(t.palette).filter(il(["contrastText"])).map(([c])=>({props:{color:c},style:{backgroundColor:(t.vars||t).palette[c].main,color:(t.vars||t).palette[c].contrastText,[`& .${no.deleteIcon}`]:{color:t.alpha((t.vars||t).palette[c].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[c].contrastText}}}})),{props:c=>c.iconColor===c.color,style:{[`& .${no.icon}`]:{color:t.vars?t.vars.palette.Chip.defaultIconColor:s}}},{props:c=>c.iconColor===c.color&&c.color!=="default",style:{[`& .${no.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${no.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette.action.selected,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.focusOpacity}`)}}},...Object.entries(t.palette).filter(il(["dark"])).map(([c])=>({props:{color:c,onDelete:!0},style:{[`&.${no.focusVisible}`]:{background:(t.vars||t).palette[c].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.selected,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`)},[`&.${no.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette.action.selected,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.focusOpacity}`)},"&:active":{boxShadow:(t.vars||t).shadows[1]}}},...Object.entries(t.palette).filter(il(["dark"])).map(([c])=>({props:{color:c,clickable:!0},style:{[`&:hover, &.${no.focusVisible}`]:{backgroundColor:(t.vars||t).palette[c].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${no.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${no.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${no.avatar}`]:{marginLeft:4},[`& .${no.avatarSmall}`]:{marginLeft:2},[`& .${no.icon}`]:{marginLeft:4},[`& .${no.iconSmall}`]:{marginLeft:2},[`& .${no.deleteIcon}`]:{marginRight:5},[`& .${no.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(t.palette).filter(il()).map(([c])=>({props:{variant:"outlined",color:c},style:{color:(t.vars||t).palette[c].main,border:`1px solid ${t.alpha((t.vars||t).palette[c].main,.7)}`,[`&.${no.clickable}:hover`]:{backgroundColor:t.alpha((t.vars||t).palette[c].main,(t.vars||t).palette.action.hoverOpacity)},[`&.${no.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette[c].main,(t.vars||t).palette.action.focusOpacity)},[`& .${no.deleteIcon}`]:{color:t.alpha((t.vars||t).palette[c].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[c].main}}}}))]}})),YK=Cn("span",{name:"MuiChip",slot:"Label",overridesResolver:(t,s)=>{const{ownerState:c}=t,{size:p}=c;return[s.label,s[`label${ar(p)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function YP(t){return t.key==="Backspace"||t.key==="Delete"}const XK=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiChip"}),{avatar:g,className:v,clickable:S,color:r="default",component:E,deleteIcon:A,disabled:I=!1,icon:F,label:z,onClick:R,onDelete:D,onKeyDown:O,onKeyUp:N,size:H="medium",variant:j="filled",tabIndex:V,skipFocusWhenDisabled:Z=!1,slots:X={},slotProps:se={},...ge}=p,ae=Te.useRef(null),oe=So(ae,c),fe=nt=>{nt.stopPropagation(),D&&D(nt)},pe=nt=>{nt.currentTarget===nt.target&&YP(nt)&&nt.preventDefault(),O&&O(nt)},K=nt=>{nt.currentTarget===nt.target&&D&&YP(nt)&&D(nt),N&&N(nt)},ye=S!==!1&&R?!0:S,J=ye||D?Uy:E||"div",de={...p,component:J,disabled:I,size:H,color:r,iconColor:Te.isValidElement(F)&&F.props.color||r,onDelete:!!D,clickable:ye,variant:j},Ae=WK(de),ne=J===Uy?{component:E||"div",focusVisibleClassName:Ae.focusVisible,...D&&{disableRipple:!0}}:{};let xe=null;D&&(xe=A&&Te.isValidElement(A)?Te.cloneElement(A,{className:Ar(A.props.className,Ae.deleteIcon),onClick:fe}):ue.jsx(HK,{className:Ae.deleteIcon,onClick:fe}));let Ce=null;g&&Te.isValidElement(g)&&(Ce=Te.cloneElement(g,{className:Ar(Ae.avatar,g.props.className)}));let Re=null;F&&Te.isValidElement(F)&&(Re=Te.cloneElement(F,{className:Ar(Ae.icon,F.props.className)}));const Ee={slots:X,slotProps:se},[Oe,Be]=gs("root",{elementType:ZK,externalForwardedProps:{...Ee,...ge},ownerState:de,shouldForwardComponentProp:!0,ref:oe,className:Ar(Ae.root,v),additionalProps:{disabled:ye&&I?!0:void 0,tabIndex:Z&&I?-1:V,...ne},getSlotProps:nt=>({...nt,onClick:$e=>{nt.onClick?.($e),R?.($e)},onKeyDown:$e=>{nt.onKeyDown?.($e),pe($e)},onKeyUp:$e=>{nt.onKeyUp?.($e),K($e)}})}),[at,ut]=gs("label",{elementType:YK,externalForwardedProps:Ee,ownerState:de,className:Ae.label});return ue.jsxs(Oe,{as:J,...Be,children:[Ce||Re,ue.jsx(at,{...ut,children:z}),xe]})}),KK=["items","changeImportance"],JK=["getValue"],QK=Cn(HR,{name:"MuiPickersLayout",slot:"Shortcuts"})({});function eJ(t){const{items:s,changeImportance:c="accept"}=t,p=_i(t,KK),{setValue:g}=zG(),v=LG();if(s==null||s.length===0)return null;const S=s.map(r=>{let{getValue:E}=r,A=_i(r,JK);const I=E({isValid:v});return Nt({},A,{label:A.label,onClick:()=>{g(I,{changeImportance:c,shortcut:A})},disabled:!v(I)})});return ue.jsx(QK,Nt({dense:!0,sx:[{maxHeight:tT,maxWidth:200,overflow:"auto"},...Array.isArray(p.sx)?p.sx:[p.sx]]},p,{children:S.map(r=>ue.jsx($K,{children:ue.jsx(XK,Nt({},r))},r.id??r.label))}))}const tJ=["ownerState"];function nJ(t){return t.view!==null}const rJ=(t,s)=>{const{pickerOrientation:c}=s;return ti({root:["root",c==="landscape"&&"landscape"],contentWrapper:["contentWrapper"],toolbar:["toolbar"],actionBar:["actionBar"],tabs:["tabs"],landscape:["landscape"],shortcuts:["shortcuts"]},HD,t)},iJ=t=>{const{ownerState:s,defaultActionBarActions:c}=Na(),{view:p}=x_(),g=Su(),{children:v,slots:S,slotProps:r,classes:E}=t,A=Te.useMemo(()=>Nt({},s,{layoutDirection:g?"rtl":"ltr",hasShortcuts:!1}),[s,g]),I=rJ(E,A),F=S?.actionBar??OK,z=ji({elementType:F,externalSlotProps:r?.actionBar,additionalProps:{actions:c},className:I.actionBar,ownerState:A}),R=_i(z,tJ),D=ue.jsx(F,Nt({},R)),O=S?.toolbar,N=ji({elementType:O,externalSlotProps:r?.toolbar,className:I.toolbar,ownerState:A}),H=nJ(N)&&O?ue.jsx(O,Nt({},N)):null,j=v,V=S?.tabs,Z=p&&V?ue.jsx(V,Nt({className:I.tabs},r?.tabs)):null,X=S?.shortcuts??eJ,se=ji({elementType:X,externalSlotProps:r?.shortcuts,className:I.shortcuts,ownerState:A}),ge=Array.isArray(se?.items)&&se.items.length>0,ae=p&&X?ue.jsx(X,Nt({},se)):null;return{toolbar:H,content:j,tabs:Z,actionBar:D,shortcuts:ae,ownerState:Nt({},A,{hasShortcuts:ge})}},oJ=(t,s)=>{const{pickerOrientation:c}=s;return ti({root:["root",c==="landscape"&&"landscape"],contentWrapper:["contentWrapper"]},HD,t)},sJ=Cn("div",{name:"MuiPickersLayout",slot:"Root"})({display:"grid",gridAutoColumns:"max-content auto max-content",gridAutoRows:"max-content auto max-content",[`& .${Lm.actionBar}`]:{gridColumn:"1 / 4",gridRow:3},variants:[{props:{pickerOrientation:"landscape",hasShortcuts:!1},style:{[`& .${Lm.toolbar}`]:{gridColumn:1,gridRow:"1 / 3"}}},{props:{pickerOrientation:"landscape",hasShortcuts:!0},style:{[`& .${Lm.toolbar}`]:{gridColumn:"2 / 4",gridRow:1,maxWidth:"max-content"},[`& .${Lm.shortcuts}`]:{gridColumn:1,gridRow:2}}},{props:{pickerOrientation:"portrait"},style:{[`& .${Lm.toolbar}`]:{gridColumn:"2 / 4",gridRow:1},[`& .${Lm.shortcuts}`]:{gridColumn:1,gridRow:"2 / 3"}}},{props:{hasShortcuts:!0,layoutDirection:"rtl"},style:{[`& .${Lm.shortcuts}`]:{gridColumn:4}}}]}),aJ=Cn("div",{name:"MuiPickersLayout",slot:"ContentWrapper"})({gridColumn:"2 / 4",gridRow:2,display:"flex",flexDirection:"column"}),ZD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiPickersLayout"}),{toolbar:g,content:v,tabs:S,actionBar:r,shortcuts:E,ownerState:A}=iJ(p),{orientation:I,variant:F}=x_(),{sx:z,className:R,classes:D}=p,O=oJ(D,A);return ue.jsxs(sJ,{ref:c,sx:z,className:Ar(O.root,R),ownerState:A,children:[I==="landscape"?E:g,I==="landscape"?g:E,ue.jsx(aJ,{className:O.contentWrapper,ownerState:A,children:F==="desktop"?ue.jsxs(Te.Fragment,{children:[v,S]}):ue.jsxs(Te.Fragment,{children:[S,v]})}),r]})});function YD(t){const{steps:s}=t;return W$({steps:s,isViewMatchingStep:(c,p)=>p.views==null||p.views.includes(c),onStepChange:({step:c,defaultView:p,setView:g,view:v,views:S})=>{const r=c.views==null?p:c.views.find(E=>S.includes(E));r!==v&&g(r)}})}const lJ=["props","steps"],cJ=["ownerState"],uJ=t=>{let{props:s,steps:c}=t,p=_i(t,lJ);const{slots:g,slotProps:v,label:S,inputRef:r,localeText:E}=s,A=YD({steps:c}),{providerProps:I,renderCurrentView:F,ownerState:z}=$D(Nt({},p,{props:s,localeText:E,autoFocusView:!0,viewContainerRole:"dialog",variant:"desktop",getStepNavigation:A})),R=I.privateContextValue.labelId,D=v?.toolbar?.hidden??!1,O=g.field,N=ji({elementType:O,externalSlotProps:v?.field,additionalProps:Nt({},D&&{id:R}),ownerState:z}),H=_i(N,cJ),j=g.layout??ZD;let V=R;D&&(S?V=`${R}-label`:V=void 0);const Z=Nt({},v,{toolbar:Nt({},v?.toolbar,{titleId:R}),popper:Nt({"aria-labelledby":V},v?.popper)});return{renderPicker:()=>ue.jsxs(FR,Nt({},I,{children:[ue.jsx(O,Nt({},H,{slots:g,slotProps:Z,inputRef:r})),ue.jsx(mK,{slots:g,slotProps:Z,children:ue.jsx(j,Nt({},Z?.layout,{slots:g,slotProps:Z,children:F()}))})]}))}},i_=({view:t,onViewChange:s,views:c,focusedView:p,onFocusedViewChange:g,value:v,defaultValue:S,referenceDate:r,onChange:E,className:A,classes:I,disableFuture:F,disablePast:z,minDate:R,maxDate:D,shouldDisableDate:O,shouldDisableMonth:N,shouldDisableYear:H,reduceAnimations:j,onMonthChange:V,monthsPerRow:Z,onYearChange:X,yearsOrder:se,yearsPerRow:ge,slots:ae,slotProps:oe,loading:fe,renderLoading:pe,disableHighlightToday:K,readOnly:ye,disabled:J,showDaysOutsideCurrentMonth:de,dayOfWeekFormatter:Ae,sx:ne,autoFocus:xe,fixedWeekNumber:Ce,displayWeekNumber:Re,timezone:Ee})=>ue.jsx(kY,{view:t,onViewChange:s,views:c.filter(X4),focusedView:p&&X4(p)?p:null,onFocusedViewChange:g,value:v,defaultValue:S,referenceDate:r,onChange:E,className:A,classes:I,disableFuture:F,disablePast:z,minDate:R,maxDate:D,shouldDisableDate:O,shouldDisableMonth:N,shouldDisableYear:H,reduceAnimations:j,onMonthChange:V,monthsPerRow:Z,onYearChange:X,yearsOrder:se,yearsPerRow:ge,slots:ae,slotProps:oe,loading:fe,renderLoading:pe,disableHighlightToday:K,readOnly:ye,disabled:J,showDaysOutsideCurrentMonth:de,dayOfWeekFormatter:Ae,sx:ne,autoFocus:xe,fixedWeekNumber:Ce,displayWeekNumber:Re,timezone:Ee}),XD=Te.forwardRef(function(s,c){const p=Ko(),g=OD(s,"MuiDesktopDatePicker"),v=Nt({day:i_,month:i_,year:i_},g.viewRenderers),S=Nt({},g,{closeOnSelect:g.closeOnSelect??!0,viewRenderers:v,format:HS(p,g,!1),yearsPerRow:g.yearsPerRow??4,slots:Nt({field:CD},g.slots),slotProps:Nt({},g.slotProps,{field:E=>Nt({},ad(g.slotProps?.field,E),CR(g)),toolbar:Nt({hidden:!0},g.slotProps?.toolbar)})}),{renderPicker:r}=uJ({ref:c,props:S,valueManager:_h,valueType:"date",validator:cv,steps:null});return r()});XD.propTypes={autoFocus:Tn.bool,className:Tn.string,closeOnSelect:Tn.bool,dayOfWeekFormatter:Tn.func,defaultValue:Tn.object,disabled:Tn.bool,disableFuture:Tn.bool,disableHighlightToday:Tn.bool,disableOpenPicker:Tn.bool,disablePast:Tn.bool,displayWeekNumber:Tn.bool,enableAccessibleFieldDOMStructure:Tn.any,fixedWeekNumber:Tn.number,format:Tn.string,formatDensity:Tn.oneOf(["dense","spacious"]),inputRef:NR,label:Tn.node,loading:Tn.bool,localeText:Tn.object,maxDate:Tn.object,minDate:Tn.object,monthsPerRow:Tn.oneOf([3,4]),name:Tn.string,onAccept:Tn.func,onChange:Tn.func,onClose:Tn.func,onError:Tn.func,onMonthChange:Tn.func,onOpen:Tn.func,onSelectedSectionsChange:Tn.func,onViewChange:Tn.func,onYearChange:Tn.func,open:Tn.bool,openTo:Tn.oneOf(["day","month","year"]),orientation:Tn.oneOf(["landscape","portrait"]),readOnly:Tn.bool,reduceAnimations:Tn.bool,referenceDate:Tn.object,renderLoading:Tn.func,selectedSections:Tn.oneOfType([Tn.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Tn.number]),shouldDisableDate:Tn.func,shouldDisableMonth:Tn.func,shouldDisableYear:Tn.func,showDaysOutsideCurrentMonth:Tn.bool,slotProps:Tn.object,slots:Tn.object,sx:Tn.oneOfType([Tn.arrayOf(Tn.oneOfType([Tn.func,Tn.object,Tn.bool])),Tn.func,Tn.object]),timezone:Tn.string,value:Tn.object,view:Tn.oneOf(["day","month","year"]),viewRenderers:Tn.shape({day:Tn.func,month:Tn.func,year:Tn.func}),views:Tn.arrayOf(Tn.oneOf(["day","month","year"]).isRequired),yearsOrder:Tn.oneOf(["asc","desc"]),yearsPerRow:Tn.oneOf([3,4])};function dJ(t){return ui("MuiDialogContent",t)}oi("MuiDialogContent",["root","dividers"]);const hJ=oi("MuiDialogTitle",["root"]),fJ=t=>{const{classes:s,dividers:c}=t;return ti({root:["root",c&&"dividers"]},dJ,s)},pJ=Cn("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.root,c.dividers&&s.dividers]}})(_o(({theme:t})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:s})=>s.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:s})=>!s.dividers,style:{[`.${hJ.root} + &`]:{paddingTop:0}}}]}))),mJ=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiDialogContent"}),{className:g,dividers:v=!1,...S}=p,r={...p,dividers:v},E=fJ(r);return ue.jsx(pJ,{className:Ar(E.root,g),ownerState:r,ref:c,...S})});function gJ(t){return ui("MuiDialog",t)}const ky=oi("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),_J=Te.createContext({}),yJ=Cn(cD,{name:"MuiDialog",slot:"Backdrop",overrides:(t,s)=>s.backdrop})({zIndex:-1}),vJ=t=>{const{classes:s,scroll:c,maxWidth:p,fullWidth:g,fullScreen:v}=t,S={root:["root"],container:["container",`scroll${ar(c)}`],paper:["paper",`paperScroll${ar(c)}`,`paperWidth${ar(String(p))}`,g&&"paperFullWidth",v&&"paperFullScreen"]};return ti(S,gJ,s)},xJ=Cn(uD,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),bJ=Cn("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.container,s[`scroll${ar(c.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),wJ=Cn(db,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,s)=>{const{ownerState:c}=t;return[s.paper,s[`scrollPaper${ar(c.scroll)}`],s[`paperWidth${ar(String(c.maxWidth))}`],c.fullWidth&&s.paperFullWidth,c.fullScreen&&s.paperFullScreen]}})(_o(({theme:t})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:s})=>!s.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${ky.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(t.breakpoints.values).filter(s=>s!=="xs").map(s=>({props:{maxWidth:s},style:{maxWidth:`${t.breakpoints.values[s]}${t.breakpoints.unit}`,[`&.${ky.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[s]+64)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:s})=>s.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:s})=>s.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${ky.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),SJ=Te.forwardRef(function(s,c){const p=To({props:s,name:"MuiDialog"}),g=y_(),v={enter:g.transitions.duration.enteringScreen,exit:g.transitions.duration.leavingScreen},{"aria-describedby":S,"aria-labelledby":r,"aria-modal":E=!0,BackdropComponent:A,BackdropProps:I,children:F,className:z,disableEscapeKeyDown:R=!1,fullScreen:D=!1,fullWidth:O=!1,maxWidth:N="sm",onClick:H,onClose:j,open:V,PaperComponent:Z=db,PaperProps:X={},scroll:se="paper",slots:ge={},slotProps:ae={},TransitionComponent:oe=Ym,transitionDuration:fe=v,TransitionProps:pe,...K}=p,ye={...p,disableEscapeKeyDown:R,fullScreen:D,fullWidth:O,maxWidth:N,scroll:se},J=vJ(ye),de=Te.useRef(),Ae=cn=>{de.current=cn.target===cn.currentTarget},ne=cn=>{H&&H(cn),de.current&&(de.current=null,j&&j(cn,"backdropClick"))},xe=Np(r),Ce=Te.useMemo(()=>({titleId:xe}),[xe]),Re={transition:oe,...ge},Ee={transition:pe,paper:X,backdrop:I,...ae},Oe={slots:Re,slotProps:Ee},[Be,at]=gs("root",{elementType:xJ,shouldForwardComponentProp:!0,externalForwardedProps:Oe,ownerState:ye,className:Ar(J.root,z),ref:c}),[ut,nt]=gs("backdrop",{elementType:yJ,shouldForwardComponentProp:!0,externalForwardedProps:Oe,ownerState:ye}),[$e,ct]=gs("paper",{elementType:wJ,shouldForwardComponentProp:!0,externalForwardedProps:Oe,ownerState:ye,className:Ar(J.paper,X.className)}),[At,xt]=gs("container",{elementType:bJ,externalForwardedProps:Oe,ownerState:ye,className:J.container}),[It,jt]=gs("transition",{elementType:Ym,externalForwardedProps:Oe,ownerState:ye,additionalProps:{appear:!0,in:V,timeout:fe,role:"presentation"}});return ue.jsx(Be,{closeAfterTransition:!0,slots:{backdrop:ut},slotProps:{backdrop:{transitionDuration:fe,as:A,...nt}},disableEscapeKeyDown:R,onClose:j,open:V,onClick:ne,...at,...K,children:ue.jsx(It,{...jt,children:ue.jsx(At,{onMouseDown:Ae,...xt,children:ue.jsx($e,{as:Z,elevation:24,role:"dialog","aria-describedby":S,"aria-labelledby":xe,"aria-modal":E,...ct,children:ue.jsx(_J.Provider,{value:Ce,children:F})})})})})}),TJ=Cn(SJ)({[`& .${ky.container}`]:{outline:0},[`& .${ky.paper}`]:{outline:0,minWidth:ob}}),CJ=Cn(mJ)({"&:first-of-type":{padding:0}});function EJ(t){const{children:s,slots:c,slotProps:p}=t,{open:g}=x_(),{dismissViews:v,onPopperExited:S}=Na(),r=c?.dialog??TJ,E=c?.mobileTransition??Ym;return ue.jsx(r,Nt({open:g,onClose:()=>{v(),S?.()}},p?.dialog,{TransitionComponent:E,TransitionProps:p?.mobileTransition,PaperComponent:c?.mobilePaper,PaperProps:p?.mobilePaper,children:ue.jsx(CJ,{children:s})}))}const AJ=["props","steps"],PJ=["ownerState"],MJ=t=>{let{props:s,steps:c}=t,p=_i(t,AJ);const{slots:g,slotProps:v,label:S,inputRef:r,localeText:E}=s,A=YD({steps:c}),{providerProps:I,renderCurrentView:F,ownerState:z}=$D(Nt({},p,{props:s,localeText:E,autoFocusView:!0,viewContainerRole:"dialog",variant:"mobile",getStepNavigation:A})),R=I.privateContextValue.labelId,D=v?.toolbar?.hidden??!1,O=g.field,N=ji({elementType:O,externalSlotProps:v?.field,additionalProps:Nt({},D&&{id:R}),ownerState:z}),H=_i(N,PJ),j=g.layout??ZD;let V=R;D&&(S?V=`${R}-label`:V=void 0);const Z=Nt({},v,{toolbar:Nt({},v?.toolbar,{titleId:R}),mobilePaper:Nt({"aria-labelledby":V},v?.mobilePaper)});return{renderPicker:()=>ue.jsxs(FR,Nt({},I,{children:[ue.jsx(O,Nt({},H,{slots:g,slotProps:Z,inputRef:r})),ue.jsx(EJ,{slots:g,slotProps:Z,children:ue.jsx(j,Nt({},Z?.layout,{slots:g,slotProps:Z,children:F()}))})]}))}},KD=Te.forwardRef(function(s,c){const p=Ko(),g=OD(s,"MuiMobileDatePicker"),v=Nt({day:i_,month:i_,year:i_},g.viewRenderers),S=Nt({},g,{viewRenderers:v,format:HS(p,g,!1),slots:Nt({field:CD},g.slots),slotProps:Nt({},g.slotProps,{field:E=>Nt({},ad(g.slotProps?.field,E),CR(g)),toolbar:Nt({hidden:!1},g.slotProps?.toolbar)})}),{renderPicker:r}=MJ({ref:c,props:S,valueManager:_h,valueType:"date",validator:cv,steps:null});return r()});KD.propTypes={autoFocus:Tn.bool,className:Tn.string,closeOnSelect:Tn.bool,dayOfWeekFormatter:Tn.func,defaultValue:Tn.object,disabled:Tn.bool,disableFuture:Tn.bool,disableHighlightToday:Tn.bool,disableOpenPicker:Tn.bool,disablePast:Tn.bool,displayWeekNumber:Tn.bool,enableAccessibleFieldDOMStructure:Tn.any,fixedWeekNumber:Tn.number,format:Tn.string,formatDensity:Tn.oneOf(["dense","spacious"]),inputRef:NR,label:Tn.node,loading:Tn.bool,localeText:Tn.object,maxDate:Tn.object,minDate:Tn.object,monthsPerRow:Tn.oneOf([3,4]),name:Tn.string,onAccept:Tn.func,onChange:Tn.func,onClose:Tn.func,onError:Tn.func,onMonthChange:Tn.func,onOpen:Tn.func,onSelectedSectionsChange:Tn.func,onViewChange:Tn.func,onYearChange:Tn.func,open:Tn.bool,openTo:Tn.oneOf(["day","month","year"]),orientation:Tn.oneOf(["landscape","portrait"]),readOnly:Tn.bool,reduceAnimations:Tn.bool,referenceDate:Tn.object,renderLoading:Tn.func,selectedSections:Tn.oneOfType([Tn.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Tn.number]),shouldDisableDate:Tn.func,shouldDisableMonth:Tn.func,shouldDisableYear:Tn.func,showDaysOutsideCurrentMonth:Tn.bool,slotProps:Tn.object,slots:Tn.object,sx:Tn.oneOfType([Tn.arrayOf(Tn.oneOfType([Tn.func,Tn.object,Tn.bool])),Tn.func,Tn.object]),timezone:Tn.string,value:Tn.object,view:Tn.oneOf(["day","month","year"]),viewRenderers:Tn.shape({day:Tn.func,month:Tn.func,year:Tn.func}),views:Tn.arrayOf(Tn.oneOf(["day","month","year"]).isRequired),yearsOrder:Tn.oneOf(["asc","desc"]),yearsPerRow:Tn.oneOf([3,4])};const IJ=["desktopModeMediaQuery"],JD=Te.forwardRef(function(s,c){const p=_s({props:s,name:"MuiDatePicker"}),{desktopModeMediaQuery:g=lH}=p,v=_i(p,IJ);return RD(g,{defaultMatches:!0})?ue.jsx(XD,Nt({ref:c},v)):ue.jsx(KD,Nt({ref:c},v))});var X1={exports:{}},RJ=X1.exports,XP;function DJ(){return XP||(XP=1,(function(t,s){(function(c,p){t.exports=p()})(RJ,(function(){var c=1e3,p=6e4,g=36e5,v="millisecond",S="second",r="minute",E="hour",A="day",I="week",F="month",z="quarter",R="year",D="date",O="Invalid Date",N=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,H=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,j={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(J){var de=["th","st","nd","rd"],Ae=J%100;return"["+J+(de[(Ae-20)%10]||de[Ae]||de[0])+"]"}},V=function(J,de,Ae){var ne=String(J);return!ne||ne.length>=de?J:""+Array(de+1-ne.length).join(Ae)+J},Z={s:V,z:function(J){var de=-J.utcOffset(),Ae=Math.abs(de),ne=Math.floor(Ae/60),xe=Ae%60;return(de<=0?"+":"-")+V(ne,2,"0")+":"+V(xe,2,"0")},m:function J(de,Ae){if(de.date()<Ae.date())return-J(Ae,de);var ne=12*(Ae.year()-de.year())+(Ae.month()-de.month()),xe=de.clone().add(ne,F),Ce=Ae-xe<0,Re=de.clone().add(ne+(Ce?-1:1),F);return+(-(ne+(Ae-xe)/(Ce?xe-Re:Re-xe))||0)},a:function(J){return J<0?Math.ceil(J)||0:Math.floor(J)},p:function(J){return{M:F,y:R,w:I,d:A,D,h:E,m:r,s:S,ms:v,Q:z}[J]||String(J||"").toLowerCase().replace(/s$/,"")},u:function(J){return J===void 0}},X="en",se={};se[X]=j;var ge="$isDayjsObject",ae=function(J){return J instanceof K||!(!J||!J[ge])},oe=function J(de,Ae,ne){var xe;if(!de)return X;if(typeof de=="string"){var Ce=de.toLowerCase();se[Ce]&&(xe=Ce),Ae&&(se[Ce]=Ae,xe=Ce);var Re=de.split("-");if(!xe&&Re.length>1)return J(Re[0])}else{var Ee=de.name;se[Ee]=de,xe=Ee}return!ne&&xe&&(X=xe),xe||!ne&&X},fe=function(J,de){if(ae(J))return J.clone();var Ae=typeof de=="object"?de:{};return Ae.date=J,Ae.args=arguments,new K(Ae)},pe=Z;pe.l=oe,pe.i=ae,pe.w=function(J,de){return fe(J,{locale:de.$L,utc:de.$u,x:de.$x,$offset:de.$offset})};var K=(function(){function J(Ae){this.$L=oe(Ae.locale,null,!0),this.parse(Ae),this.$x=this.$x||Ae.x||{},this[ge]=!0}var de=J.prototype;return de.parse=function(Ae){this.$d=(function(ne){var xe=ne.date,Ce=ne.utc;if(xe===null)return new Date(NaN);if(pe.u(xe))return new Date;if(xe instanceof Date)return new Date(xe);if(typeof xe=="string"&&!/Z$/i.test(xe)){var Re=xe.match(N);if(Re){var Ee=Re[2]-1||0,Oe=(Re[7]||"0").substring(0,3);return Ce?new Date(Date.UTC(Re[1],Ee,Re[3]||1,Re[4]||0,Re[5]||0,Re[6]||0,Oe)):new Date(Re[1],Ee,Re[3]||1,Re[4]||0,Re[5]||0,Re[6]||0,Oe)}}return new Date(xe)})(Ae),this.init()},de.init=function(){var Ae=this.$d;this.$y=Ae.getFullYear(),this.$M=Ae.getMonth(),this.$D=Ae.getDate(),this.$W=Ae.getDay(),this.$H=Ae.getHours(),this.$m=Ae.getMinutes(),this.$s=Ae.getSeconds(),this.$ms=Ae.getMilliseconds()},de.$utils=function(){return pe},de.isValid=function(){return this.$d.toString()!==O},de.isSame=function(Ae,ne){var xe=fe(Ae);return this.startOf(ne)<=xe&&xe<=this.endOf(ne)},de.isAfter=function(Ae,ne){return fe(Ae)<this.startOf(ne)},de.isBefore=function(Ae,ne){return this.endOf(ne)<fe(Ae)},de.$g=function(Ae,ne,xe){return pe.u(Ae)?this[ne]:this.set(xe,Ae)},de.unix=function(){return Math.floor(this.valueOf()/1e3)},de.valueOf=function(){return this.$d.getTime()},de.startOf=function(Ae,ne){var xe=this,Ce=!!pe.u(ne)||ne,Re=pe.p(Ae),Ee=function(At,xt){var It=pe.w(xe.$u?Date.UTC(xe.$y,xt,At):new Date(xe.$y,xt,At),xe);return Ce?It:It.endOf(A)},Oe=function(At,xt){return pe.w(xe.toDate()[At].apply(xe.toDate("s"),(Ce?[0,0,0,0]:[23,59,59,999]).slice(xt)),xe)},Be=this.$W,at=this.$M,ut=this.$D,nt="set"+(this.$u?"UTC":"");switch(Re){case R:return Ce?Ee(1,0):Ee(31,11);case F:return Ce?Ee(1,at):Ee(0,at+1);case I:var $e=this.$locale().weekStart||0,ct=(Be<$e?Be+7:Be)-$e;return Ee(Ce?ut-ct:ut+(6-ct),at);case A:case D:return Oe(nt+"Hours",0);case E:return Oe(nt+"Minutes",1);case r:return Oe(nt+"Seconds",2);case S:return Oe(nt+"Milliseconds",3);default:return this.clone()}},de.endOf=function(Ae){return this.startOf(Ae,!1)},de.$set=function(Ae,ne){var xe,Ce=pe.p(Ae),Re="set"+(this.$u?"UTC":""),Ee=(xe={},xe[A]=Re+"Date",xe[D]=Re+"Date",xe[F]=Re+"Month",xe[R]=Re+"FullYear",xe[E]=Re+"Hours",xe[r]=Re+"Minutes",xe[S]=Re+"Seconds",xe[v]=Re+"Milliseconds",xe)[Ce],Oe=Ce===A?this.$D+(ne-this.$W):ne;if(Ce===F||Ce===R){var Be=this.clone().set(D,1);Be.$d[Ee](Oe),Be.init(),this.$d=Be.set(D,Math.min(this.$D,Be.daysInMonth())).$d}else Ee&&this.$d[Ee](Oe);return this.init(),this},de.set=function(Ae,ne){return this.clone().$set(Ae,ne)},de.get=function(Ae){return this[pe.p(Ae)]()},de.add=function(Ae,ne){var xe,Ce=this;Ae=Number(Ae);var Re=pe.p(ne),Ee=function(at){var ut=fe(Ce);return pe.w(ut.date(ut.date()+Math.round(at*Ae)),Ce)};if(Re===F)return this.set(F,this.$M+Ae);if(Re===R)return this.set(R,this.$y+Ae);if(Re===A)return Ee(1);if(Re===I)return Ee(7);var Oe=(xe={},xe[r]=p,xe[E]=g,xe[S]=c,xe)[Re]||1,Be=this.$d.getTime()+Ae*Oe;return pe.w(Be,this)},de.subtract=function(Ae,ne){return this.add(-1*Ae,ne)},de.format=function(Ae){var ne=this,xe=this.$locale();if(!this.isValid())return xe.invalidDate||O;var Ce=Ae||"YYYY-MM-DDTHH:mm:ssZ",Re=pe.z(this),Ee=this.$H,Oe=this.$m,Be=this.$M,at=xe.weekdays,ut=xe.months,nt=xe.meridiem,$e=function(xt,It,jt,cn){return xt&&(xt[It]||xt(ne,Ce))||jt[It].slice(0,cn)},ct=function(xt){return pe.s(Ee%12||12,xt,"0")},At=nt||function(xt,It,jt){var cn=xt<12?"AM":"PM";return jt?cn.toLowerCase():cn};return Ce.replace(H,(function(xt,It){return It||(function(jt){switch(jt){case"YY":return String(ne.$y).slice(-2);case"YYYY":return pe.s(ne.$y,4,"0");case"M":return Be+1;case"MM":return pe.s(Be+1,2,"0");case"MMM":return $e(xe.monthsShort,Be,ut,3);case"MMMM":return $e(ut,Be);case"D":return ne.$D;case"DD":return pe.s(ne.$D,2,"0");case"d":return String(ne.$W);case"dd":return $e(xe.weekdaysMin,ne.$W,at,2);case"ddd":return $e(xe.weekdaysShort,ne.$W,at,3);case"dddd":return at[ne.$W];case"H":return String(Ee);case"HH":return pe.s(Ee,2,"0");case"h":return ct(1);case"hh":return ct(2);case"a":return At(Ee,Oe,!0);case"A":return At(Ee,Oe,!1);case"m":return String(Oe);case"mm":return pe.s(Oe,2,"0");case"s":return String(ne.$s);case"ss":return pe.s(ne.$s,2,"0");case"SSS":return pe.s(ne.$ms,3,"0");case"Z":return Re}return null})(xt)||Re.replace(":","")}))},de.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},de.diff=function(Ae,ne,xe){var Ce,Re=this,Ee=pe.p(ne),Oe=fe(Ae),Be=(Oe.utcOffset()-this.utcOffset())*p,at=this-Oe,ut=function(){return pe.m(Re,Oe)};switch(Ee){case R:Ce=ut()/12;break;case F:Ce=ut();break;case z:Ce=ut()/3;break;case I:Ce=(at-Be)/6048e5;break;case A:Ce=(at-Be)/864e5;break;case E:Ce=at/g;break;case r:Ce=at/p;break;case S:Ce=at/c;break;default:Ce=at}return xe?Ce:pe.a(Ce)},de.daysInMonth=function(){return this.endOf(F).$D},de.$locale=function(){return se[this.$L]},de.locale=function(Ae,ne){if(!Ae)return this.$L;var xe=this.clone(),Ce=oe(Ae,ne,!0);return Ce&&(xe.$L=Ce),xe},de.clone=function(){return pe.w(this.$d,this)},de.toDate=function(){return new Date(this.valueOf())},de.toJSON=function(){return this.isValid()?this.toISOString():null},de.toISOString=function(){return this.$d.toISOString()},de.toString=function(){return this.$d.toUTCString()},J})(),ye=K.prototype;return fe.prototype=ye,[["$ms",v],["$s",S],["$m",r],["$H",E],["$W",A],["$M",F],["$y",R],["$D",D]].forEach((function(J){ye[J[1]]=function(de){return this.$g(de,J[0],J[1])}})),fe.extend=function(J,de){return J.$i||(J(de,K,fe),J.$i=!0),fe},fe.locale=oe,fe.isDayjs=ae,fe.unix=function(J){return fe(1e3*J)},fe.en=se[X],fe.Ls=se,fe.p={},fe}))})(X1)),X1.exports}var kJ=DJ();const Es=al(kJ);var K1={exports:{}},OJ=K1.exports,KP;function LJ(){return KP||(KP=1,(function(t,s){(function(c,p){t.exports=p()})(OJ,(function(){var c="week",p="year";return function(g,v,S){var r=v.prototype;r.week=function(E){if(E===void 0&&(E=null),E!==null)return this.add(7*(E-this.week()),"day");var A=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var I=S(this).startOf(p).add(1,p).date(A),F=S(this).endOf(c);if(I.isBefore(F))return 1}var z=S(this).startOf(p).date(A).startOf(c).subtract(1,"millisecond"),R=this.diff(z,c,!0);return R<0?S(this).startOf("week").week():Math.ceil(R)},r.weeks=function(E){return E===void 0&&(E=null),this.week(E)}}}))})(K1)),K1.exports}var zJ=LJ();const FJ=al(zJ);var J1={exports:{}},BJ=J1.exports,JP;function NJ(){return JP||(JP=1,(function(t,s){(function(c,p){t.exports=p()})(BJ,(function(){var c={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},p=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,g=/\d/,v=/\d\d/,S=/\d\d?/,r=/\d*[^-_:/,()\s\d]+/,E={},A=function(N){return(N=+N)+(N>68?1900:2e3)},I=function(N){return function(H){this[N]=+H}},F=[/[+-]\d\d:?(\d\d)?|Z/,function(N){(this.zone||(this.zone={})).offset=(function(H){if(!H||H==="Z")return 0;var j=H.match(/([+-]|\d\d)/g),V=60*j[1]+(+j[2]||0);return V===0?0:j[0]==="+"?-V:V})(N)}],z=function(N){var H=E[N];return H&&(H.indexOf?H:H.s.concat(H.f))},R=function(N,H){var j,V=E.meridiem;if(V){for(var Z=1;Z<=24;Z+=1)if(N.indexOf(V(Z,0,H))>-1){j=Z>12;break}}else j=N===(H?"pm":"PM");return j},D={A:[r,function(N){this.afternoon=R(N,!1)}],a:[r,function(N){this.afternoon=R(N,!0)}],Q:[g,function(N){this.month=3*(N-1)+1}],S:[g,function(N){this.milliseconds=100*+N}],SS:[v,function(N){this.milliseconds=10*+N}],SSS:[/\d{3}/,function(N){this.milliseconds=+N}],s:[S,I("seconds")],ss:[S,I("seconds")],m:[S,I("minutes")],mm:[S,I("minutes")],H:[S,I("hours")],h:[S,I("hours")],HH:[S,I("hours")],hh:[S,I("hours")],D:[S,I("day")],DD:[v,I("day")],Do:[r,function(N){var H=E.ordinal,j=N.match(/\d+/);if(this.day=j[0],H)for(var V=1;V<=31;V+=1)H(V).replace(/\[|\]/g,"")===N&&(this.day=V)}],w:[S,I("week")],ww:[v,I("week")],M:[S,I("month")],MM:[v,I("month")],MMM:[r,function(N){var H=z("months"),j=(z("monthsShort")||H.map((function(V){return V.slice(0,3)}))).indexOf(N)+1;if(j<1)throw new Error;this.month=j%12||j}],MMMM:[r,function(N){var H=z("months").indexOf(N)+1;if(H<1)throw new Error;this.month=H%12||H}],Y:[/[+-]?\d+/,I("year")],YY:[v,function(N){this.year=A(N)}],YYYY:[/\d{4}/,I("year")],Z:F,ZZ:F};function O(N){var H,j;H=N,j=E&&E.formats;for(var V=(N=H.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(fe,pe,K){var ye=K&&K.toUpperCase();return pe||j[K]||c[K]||j[ye].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(J,de,Ae){return de||Ae.slice(1)}))}))).match(p),Z=V.length,X=0;X<Z;X+=1){var se=V[X],ge=D[se],ae=ge&&ge[0],oe=ge&&ge[1];V[X]=oe?{regex:ae,parser:oe}:se.replace(/^\[|\]$/g,"")}return function(fe){for(var pe={},K=0,ye=0;K<Z;K+=1){var J=V[K];if(typeof J=="string")ye+=J.length;else{var de=J.regex,Ae=J.parser,ne=fe.slice(ye),xe=de.exec(ne)[0];Ae.call(pe,xe),fe=fe.replace(xe,"")}}return(function(Ce){var Re=Ce.afternoon;if(Re!==void 0){var Ee=Ce.hours;Re?Ee<12&&(Ce.hours+=12):Ee===12&&(Ce.hours=0),delete Ce.afternoon}})(pe),pe}}return function(N,H,j){j.p.customParseFormat=!0,N&&N.parseTwoDigitYear&&(A=N.parseTwoDigitYear);var V=H.prototype,Z=V.parse;V.parse=function(X){var se=X.date,ge=X.utc,ae=X.args;this.$u=ge;var oe=ae[1];if(typeof oe=="string"){var fe=ae[2]===!0,pe=ae[3]===!0,K=fe||pe,ye=ae[2];pe&&(ye=ae[2]),E=this.$locale(),!fe&&ye&&(E=j.Ls[ye]),this.$d=(function(ne,xe,Ce,Re){try{if(["x","X"].indexOf(xe)>-1)return new Date((xe==="X"?1e3:1)*ne);var Ee=O(xe)(ne),Oe=Ee.year,Be=Ee.month,at=Ee.day,ut=Ee.hours,nt=Ee.minutes,$e=Ee.seconds,ct=Ee.milliseconds,At=Ee.zone,xt=Ee.week,It=new Date,jt=at||(Oe||Be?1:It.getDate()),cn=Oe||It.getFullYear(),Se=0;Oe&&!Be||(Se=Be>0?Be-1:It.getMonth());var mt,Ke=ut||0,Ue=nt||0,je=$e||0,gt=ct||0;return At?new Date(Date.UTC(cn,Se,jt,Ke,Ue,je,gt+60*At.offset*1e3)):Ce?new Date(Date.UTC(cn,Se,jt,Ke,Ue,je,gt)):(mt=new Date(cn,Se,jt,Ke,Ue,je,gt),xt&&(mt=Re(mt).week(xt).toDate()),mt)}catch{return new Date("")}})(se,oe,ge,j),this.init(),ye&&ye!==!0&&(this.$L=this.locale(ye).$L),K&&se!=this.format(oe)&&(this.$d=new Date("")),E={}}else if(oe instanceof Array)for(var J=oe.length,de=1;de<=J;de+=1){ae[1]=oe[de-1];var Ae=j.apply(this,ae);if(Ae.isValid()){this.$d=Ae.$d,this.$L=Ae.$L,this.init();break}de===J&&(this.$d=new Date(""))}else Z.call(this,X)}}}))})(J1)),J1.exports}var VJ=NJ();const UJ=al(VJ);var Q1={exports:{}},jJ=Q1.exports,QP;function GJ(){return QP||(QP=1,(function(t,s){(function(c,p){t.exports=p()})(jJ,(function(){var c={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(p,g,v){var S=g.prototype,r=S.format;v.en.formats=c,S.format=function(E){E===void 0&&(E="YYYY-MM-DDTHH:mm:ssZ");var A=this.$locale().formats,I=(function(F,z){return F.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(R,D,O){var N=O&&O.toUpperCase();return D||z[O]||c[O]||z[N].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(H,j,V){return j||V.slice(1)}))}))})(E,A===void 0?{}:A);return r.call(this,I)}}}))})(Q1)),Q1.exports}var $J=GJ();const HJ=al($J);var ex={exports:{}},qJ=ex.exports,eM;function WJ(){return eM||(eM=1,(function(t,s){(function(c,p){t.exports=p()})(qJ,(function(){return function(c,p,g){p.prototype.isBetween=function(v,S,r,E){var A=g(v),I=g(S),F=(E=E||"()")[0]==="(",z=E[1]===")";return(F?this.isAfter(A,r):!this.isBefore(A,r))&&(z?this.isBefore(I,r):!this.isAfter(I,r))||(F?this.isBefore(A,r):!this.isAfter(A,r))&&(z?this.isAfter(I,r):!this.isBefore(I,r))}}}))})(ex)),ex.exports}var ZJ=WJ();const YJ=al(ZJ);var tx={exports:{}},XJ=tx.exports,tM;function KJ(){return tM||(tM=1,(function(t,s){(function(c,p){t.exports=p()})(XJ,(function(){return function(c,p){var g=p.prototype,v=g.format;g.format=function(S){var r=this,E=this.$locale();if(!this.isValid())return v.bind(this)(S);var A=this.$utils(),I=(S||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(F){switch(F){case"Q":return Math.ceil((r.$M+1)/3);case"Do":return E.ordinal(r.$D);case"gggg":return r.weekYear();case"GGGG":return r.isoWeekYear();case"wo":return E.ordinal(r.week(),"W");case"w":case"ww":return A.s(r.week(),F==="w"?1:2,"0");case"W":case"WW":return A.s(r.isoWeek(),F==="W"?1:2,"0");case"k":case"kk":return A.s(String(r.$H===0?24:r.$H),F==="k"?1:2,"0");case"X":return Math.floor(r.$d.getTime()/1e3);case"x":return r.$d.getTime();case"z":return"["+r.offsetName()+"]";case"zzz":return"["+r.offsetName("long")+"]";default:return F}}));return v.bind(this)(I)}}}))})(tx)),tx.exports}var JJ=KJ();const QJ=al(JJ);Es.extend(HJ);Es.extend(FJ);Es.extend(YJ);Es.extend(QJ);const eQ={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},tQ={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},hw=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),nM=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`);class QD{isMUIAdapter=!0;isTimezoneCompatible=!0;lib="dayjs";escapedCharacters={start:"[",end:"]"};formatTokenMap=eQ;constructor({locale:s,formats:c}={}){this.locale=s,this.formats=Nt({},tQ,c),Es.extend(UJ)}setLocaleToValue=s=>{const c=this.getCurrentLocaleCode();return c===s.locale()?s:s.locale(c)};hasUTCPlugin=()=>typeof Es.utc<"u";hasTimezonePlugin=()=>typeof Es.tz<"u";isSame=(s,c,p)=>{const g=this.setTimezone(c,this.getTimezone(s));return s.format(p)===g.format(p)};cleanTimezone=s=>{switch(s){case"default":return;case"system":return Es.tz.guess();default:return s}};createSystemDate=s=>{let c;if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const p=Es.tz.guess();p==="UTC"?c=Es(s):c=Es.tz(s,p)}else c=Es(s);return this.setLocaleToValue(c)};createUTCDate=s=>{if(!this.hasUTCPlugin())throw new Error(hw);return this.setLocaleToValue(Es.utc(s))};createTZDate=(s,c)=>{if(!this.hasUTCPlugin())throw new Error(hw);if(!this.hasTimezonePlugin())throw new Error(nM);const p=s!==void 0&&!s.endsWith("Z");return this.setLocaleToValue(Es(s).tz(this.cleanTimezone(c),p))};getLocaleFormats=()=>{const s=Es.Ls,c=this.locale||"en";let p=s[c];return p===void 0&&(p=s.en),p.formats};adjustOffset=s=>{if(!this.hasTimezonePlugin())return s;const c=this.getTimezone(s);if(c!=="UTC"){const p=s.tz(this.cleanTimezone(c),!0);if(p.$offset===(s.$offset??0))return s;s.$offset=p.$offset}return s};date=(s,c="default")=>s===null?null:c==="UTC"?this.createUTCDate(s):c==="system"||c==="default"&&!this.hasTimezonePlugin()?this.createSystemDate(s):this.createTZDate(s,c);getInvalidDate=()=>Es(new Date("Invalid date"));getTimezone=s=>{if(this.hasTimezonePlugin()){const c=s.$x?.$timezone;if(c)return c}return this.hasUTCPlugin()&&s.isUTC()?"UTC":"system"};setTimezone=(s,c)=>{if(this.getTimezone(s)===c)return s;if(c==="UTC"){if(!this.hasUTCPlugin())throw new Error(hw);return s.utc()}if(c==="system")return s.local();if(!this.hasTimezonePlugin()){if(c==="default")return s;throw new Error(nM)}return this.setLocaleToValue(Es.tz(s,this.cleanTimezone(c)))};toJsDate=s=>s.toDate();parse=(s,c)=>s===""?null:Es(s,c,this.locale,!0);getCurrentLocaleCode=()=>this.locale||"en";is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||"");expandFormat=s=>{const c=this.getLocaleFormats(),p=g=>g.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(v,S,r)=>S||r.slice(1));return s.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(g,v,S)=>{const r=S&&S.toUpperCase();return v||c[S]||p(c[r])})};isValid=s=>s==null?!1:s.isValid();format=(s,c)=>this.formatByString(s,this.formats[c]);formatByString=(s,c)=>this.setLocaleToValue(s).format(c);formatNumber=s=>s;isEqual=(s,c)=>s===null&&c===null?!0:s===null||c===null?!1:s.toDate().getTime()===c.toDate().getTime();isSameYear=(s,c)=>this.isSame(s,c,"YYYY");isSameMonth=(s,c)=>this.isSame(s,c,"YYYY-MM");isSameDay=(s,c)=>this.isSame(s,c,"YYYY-MM-DD");isSameHour=(s,c)=>s.isSame(c,"hour");isAfter=(s,c)=>s>c;isAfterYear=(s,c)=>this.hasUTCPlugin()?!this.isSameYear(s,c)&&s.utc()>c.utc():s.isAfter(c,"year");isAfterDay=(s,c)=>this.hasUTCPlugin()?!this.isSameDay(s,c)&&s.utc()>c.utc():s.isAfter(c,"day");isBefore=(s,c)=>s<c;isBeforeYear=(s,c)=>this.hasUTCPlugin()?!this.isSameYear(s,c)&&s.utc()<c.utc():s.isBefore(c,"year");isBeforeDay=(s,c)=>this.hasUTCPlugin()?!this.isSameDay(s,c)&&s.utc()<c.utc():s.isBefore(c,"day");isWithinRange=(s,[c,p])=>s>=c&&s<=p;startOfYear=s=>this.adjustOffset(s.startOf("year"));startOfMonth=s=>this.adjustOffset(s.startOf("month"));startOfWeek=s=>this.adjustOffset(this.setLocaleToValue(s).startOf("week"));startOfDay=s=>this.adjustOffset(s.startOf("day"));endOfYear=s=>this.adjustOffset(s.endOf("year"));endOfMonth=s=>this.adjustOffset(s.endOf("month"));endOfWeek=s=>this.adjustOffset(this.setLocaleToValue(s).endOf("week"));endOfDay=s=>this.adjustOffset(s.endOf("day"));addYears=(s,c)=>this.adjustOffset(s.add(c,"year"));addMonths=(s,c)=>this.adjustOffset(s.add(c,"month"));addWeeks=(s,c)=>this.adjustOffset(s.add(c,"week"));addDays=(s,c)=>this.adjustOffset(s.add(c,"day"));addHours=(s,c)=>this.adjustOffset(s.add(c,"hour"));addMinutes=(s,c)=>this.adjustOffset(s.add(c,"minute"));addSeconds=(s,c)=>this.adjustOffset(s.add(c,"second"));getYear=s=>s.year();getMonth=s=>s.month();getDate=s=>s.date();getHours=s=>s.hour();getMinutes=s=>s.minute();getSeconds=s=>s.second();getMilliseconds=s=>s.millisecond();setYear=(s,c)=>this.adjustOffset(s.set("year",c));setMonth=(s,c)=>this.adjustOffset(s.set("month",c));setDate=(s,c)=>this.adjustOffset(s.set("date",c));setHours=(s,c)=>this.adjustOffset(s.set("hour",c));setMinutes=(s,c)=>this.adjustOffset(s.set("minute",c));setSeconds=(s,c)=>this.adjustOffset(s.set("second",c));setMilliseconds=(s,c)=>this.adjustOffset(s.set("millisecond",c));getDaysInMonth=s=>s.daysInMonth();getWeekArray=s=>{const c=this.startOfWeek(this.startOfMonth(s)),p=this.endOfWeek(this.endOfMonth(s));let g=0,v=c;const S=[];for(;v<p;){const r=Math.floor(g/7);S[r]=S[r]||[],S[r].push(v),v=this.addDays(v,1),g+=1}return S};getWeekNumber=s=>s.week();getDayOfWeek(s){return s.day()+1}getYearRange=([s,c])=>{const p=this.startOfYear(s),g=this.endOfYear(c),v=[];let S=p;for(;this.isBefore(S,g);)v.push(S),S=this.addYears(S,1);return v}}const nQ=ll`
  from { opacity: 0; }
  to { opacity: 1; }
`,rQ=ll`
  from { 
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }
  to { 
    opacity: 1;
    transform: translateY(0) scale(1);
  }
`,iQ=ll`
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
`,oQ=ll`
  0% { background-position: -200px 0; }
  100% { background-position: calc(200px + 100%) 0; }
`,sQ=pn.div`
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
  backdrop-filter: blur(12px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: ${({theme:t})=>t.zIndex?.loadingScreen||1e3};
  padding: 1rem;
  animation: ${nQ} 0.3s ease-out;
`,aQ=pn.div`
  background: ${({theme:t})=>t.colors?.lightBackground||"#ffffff"};
  padding: 0;
  border-radius: 24px;
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  width: 100%;
  max-width: 480px;
  font-family: ${({theme:t})=>t.fonts?.regular||"system-ui, -apple-system, sans-serif"};
  overflow: hidden;
  z-index: ${({theme:t})=>t.zIndex?.loadingScreen||1e3};
  position: relative;
  animation: ${rQ} 0.4s cubic-bezier(0.16, 1, 0.3, 1);

  @media (max-width: 640px) {
    margin: 1rem;
    border-radius: 20px;
    max-height: 90vh;
    overflow-y: auto;
  }
`,lQ=pn.div`
  background: linear-gradient(135deg, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}dd);
  padding: 2rem 2rem 1.5rem 2rem;
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
    animation: ${oQ} 3s ease-in-out infinite;
  }

  @media (max-width: 640px) {
    padding: 1.5rem 1.5rem 1rem 1.5rem;
  }
`,cQ=pn.div`
  width: 60px;
  height: 60px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
`,uQ=pn.h2`
  margin: 0;
  font-size: 1.75rem;
  font-weight: 700;
  color: white;
  line-height: 1.2;

  @media (max-width: 640px) {
    font-size: 1.5rem;
  }
`,dQ=pn.p`
  margin: 0.5rem 0 0 0;
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.95rem;
  font-weight: 400;
`,hQ=pn.div`
  padding: 2rem;

  @media (max-width: 640px) {
    padding: 1.5rem;
  }
`,T1=pn.div`
  width: 100%;
  margin-bottom: 1.5rem;

  &:last-of-type {
    margin-bottom: 2rem;
  }
`,C1=pn.label`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};

  svg {
    color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
    font-size: 0.9rem;
  }
`,rM=pn.div`
  position: relative;
  width: 100%;
`,xT=uh`
  width: 100%;
  padding: 0.875rem 1rem;
  border: 2px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};
  border-radius: 12px;
  font-size: 0.95rem;
  font-family: ${({theme:t})=>t.fonts?.regular||"inherit"};
  box-sizing: border-box;
  background: ${({theme:t})=>t.colors?.background||"#ffffff"};
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  position: relative;

  &::placeholder {
    color: ${({theme:t})=>t.colors?.textSecondary||"#94a3b8"};
  }

  &:focus {
    outline: none;
    border-color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
    box-shadow: 0 0 0 3px ${({theme:t})=>t.colors?.highlight||"#3b82f6"}20;
    transform: translateY(-1px);
  }

  &:hover:not(:focus) {
    border-color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"}60;
  }
`,fQ=pn.input`
  ${xT}
`,pQ=pn.textarea`
  ${xT}
  resize: vertical;
  min-height: 80px;
  font-family: ${({theme:t})=>t.fonts?.regular||"inherit"};
`,mQ=pn.div`
  position: relative;
  width: 100%;
`,gQ=pn.select`
  ${xT}
  appearance: none;
  cursor: pointer;
  padding-right: 3rem;

  &:focus + svg {
    color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
    transform: translateY(-50%) rotate(180deg);
  }
`,_Q=pn(ww)`
  position: absolute;
  top: 50%;
  right: 1rem;
  transform: translateY(-50%) ${({$open:t})=>t?"rotate(180deg)":"rotate(0deg)"};
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  pointer-events: none;
  color: ${({theme:t})=>t.colors?.textSecondary||"#94a3b8"};
  font-size: 0.875rem;
`,yQ=pn.div`
  .MuiTextField-root {
    width: 100%;
  }

  .MuiInputBase-root {
    background-color: ${({theme:t})=>t.colors?.background||"#ffffff"};
    border: 2px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};
    border-radius: 12px !important;
    padding: 0.875rem 1rem;
    font-family: ${({theme:t})=>t.fonts?.regular||"inherit"};
    font-size: 0.95rem;
    color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);

    &::before, &::after {
      display: none;
    }

    &:hover:not(.Mui-focused) {
      border-color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"}60;
    }

    &.Mui-focused {
      border-color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
      box-shadow: 0 0 0 3px ${({theme:t})=>t.colors?.highlight||"#3b82f6"}20;
      transform: translateY(-1px);
    }

    .MuiSvgIcon-root {
      color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
    }
  }

  .MuiInputBase-input {
    padding: 0;
  }
`,vQ=pn.div`
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding: 1.5rem 2rem 2rem 2rem;
  background: ${({theme:t})=>t.colors?.background||"#f8fafc"};
  border-top: 1px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};

  @media (max-width: 640px) {
    padding: 1rem 1.5rem 1.5rem 1.5rem;
    flex-direction: column-reverse;
    gap: 0.5rem;
  }
`,xQ=uh`
  background: linear-gradient(135deg, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}dd);
  color: white;
  box-shadow: 0 4px 12px ${({theme:t})=>t.colors?.highlight||"#3b82f6"}30;

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px ${({theme:t})=>t.colors?.highlight||"#3b82f6"}40;
    animation: ${iQ} 0.3s ease;
  }

  &:active {
    transform: translateY(-1px);
  }

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  &:hover::before {
    left: 100%;
  }
`,bQ=uh`
  background: ${({theme:t})=>t.colors?.lightBackground||"#ffffff"};
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
  border: 2px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};

  &:hover {
    background: ${({theme:t})=>t.colors?.background||"#f1f5f9"};
    border-color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
    transform: translateY(-1px);
  }
`,iM=pn.button`
  padding: 0.75rem 1.5rem;
  font-size: 0.9rem;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-family: ${({theme:t})=>t.fonts?.medium||"inherit"};
  transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  position: relative;
  overflow: hidden;

  ${({$primary:t})=>t?xQ:bQ}

  @media (max-width: 640px) {
    padding: 0.875rem 1.5rem;
  }
`,wQ=pn.button`
  position: absolute;
  top: 1.5rem;
  right: 1.5rem;
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 10;
  backdrop-filter: blur(10px);

  &:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
  }

  @media (max-width: 640px) {
    top: 1rem;
    right: 1rem;
    width: 36px;
    height: 36px;
  }
`,wx=({visible:t,onClose:s,onSubmit:c,projectName:p,setProjectName:g,chartType:v,setChartType:S,description:r,setDescription:E,forecastDate:A,setForecastDate:I})=>{const[F,z]=Te.useState(!1);AM();const R=Te.useRef(null),D=Te.useRef(null),O=()=>{const H=[];if(p.trim()||H.push("Project Name"),H.length>0){Po.fire({toast:!0,position:"top-end",icon:"error",title:`${H.join(" and ")} ${H.length===1?"is":"are"} required!`,showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}c()},N=H=>{H.target===H.currentTarget&&s()};return Te.useEffect(()=>{const H=j=>{const V=R.current&&!R.current.contains(j.target),Z=D.current&&!D.current.contains(j.target);V&&Z&&s()};return document.addEventListener("mousedown",H),()=>document.removeEventListener("mousedown",H)},[s]),t?ue.jsx(sQ,{onClick:N,children:ue.jsxs(aQ,{ref:R,children:[ue.jsx(wQ,{onClick:s,"aria-label":"Close modal",children:""}),ue.jsxs(lQ,{children:[ue.jsx(cQ,{children:ue.jsx(f5,{})}),ue.jsx(uQ,{children:"Create New Project"}),ue.jsx(dQ,{children:"Set up your project with all the details"})]}),ue.jsxs(hQ,{children:[ue.jsxs(T1,{children:[ue.jsxs(C1,{htmlFor:"projectName",children:[ue.jsx(f5,{}),"Project Name"]}),ue.jsx(rM,{children:ue.jsx(fQ,{id:"projectName",value:p,onChange:H=>g(H.target.value),placeholder:"Enter a descriptive project name",autoFocus:!0})})]}),ue.jsxs(T1,{children:[ue.jsxs(C1,{htmlFor:"description",children:[ue.jsx(WL,{}),"Description"]}),ue.jsx(rM,{children:ue.jsx(pQ,{id:"description",value:r,onChange:H=>E(H.target.value),placeholder:"Briefly describe your project goals and objectives"})})]}),ue.jsxs(T1,{children:[ue.jsxs(C1,{htmlFor:"chartType",children:[ue.jsx(kM,{}),"Chart Type"]}),ue.jsxs(mQ,{children:[ue.jsxs(gQ,{id:"chartType",value:v,onChange:H=>S(H.target.value),onClick:()=>z(H=>!H),onBlur:()=>z(!1),children:[ue.jsx("option",{value:"Wave Analysis",children:"Wave Analysis"}),ue.jsx("option",{value:"24",children:"24"}),ue.jsx("option",{value:"36",children:"36"}),ue.jsx("option",{value:"48",children:"48"})]}),ue.jsx(_Q,{$open:F})]})]}),ue.jsxs(T1,{children:[ue.jsxs(C1,{htmlFor:"forecastDate",children:[ue.jsx(DM,{}),"Forecast Date"]}),ue.jsx(yQ,{ref:D,children:ue.jsx(jS,{dateAdapter:QD,children:ue.jsx(JD,{value:Es(),onChange:H=>I(H),disabled:!0,slotProps:{textField:{fullWidth:!0,variant:"filled",InputProps:{disableUnderline:!0}}}})})})]})]}),ue.jsxs(vQ,{children:[ue.jsx(iM,{onClick:s,children:"Cancel"}),ue.jsx(iM,{$primary:!0,onClick:O,children:"Create Project"})]})]})}):null},SQ=pn.div`
  position: fixed;
  z-index: 100;
  bottom: 5rem;
  left: 50%;
  margin-left: -10rem;
  transform: translateX(-50%);
  transform-origin: center bottom;
  
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  padding: ${({theme:t})=>t.spacing.medium||"1.25rem"};
  border-radius: ${({theme:t})=>t.borderRadius.xlarge||"16px"};
  border: 1px solid ${({theme:t})=>t.colors.textPrimary};
  font-family: ${({theme:t})=>t.fonts.regular||"'Inter', sans-serif"};
  color: ${({theme:t})=>t.colors.textPrimary};
  
  width: 320px;
  max-width: 380px;
  max-height: clamp(300px, 40vh, 500px);
  text-align: center;
  overflow-y: auto;

  /* Hide scrollbar but keep scrolling */
  scrollbar-width: none; /* Firefox */
  ms-overflow-style: none; /* IE/Edge */
  &::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }

  box-shadow: ${({theme:t})=>t.isDark?"0 20px 40px -12px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.05)":"0 20px 40px -12px rgba(0,0,0,0.25), 0 0 0 1px rgba(0,0,0,0.08)"};

  transform: scale(1);
  transition: all 0.3s cubic-bezier(0.4,0,0.2,1);

  &:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: ${({theme:t})=>t.isDark?"0 32px 64px -12px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.1)":"0 32px 64px -12px rgba(0,0,0,0.35), 0 0 0 1px rgba(0,0,0,0.08)"};
    border-color: ${({theme:t})=>t.isDark?"rgba(59,130,246,0.3)":"rgba(59,130,246,0.2)"};
  }

  &:active {
    transform: translateY(-2px) scale(1.01);
  }

  /* Responsive */
  @media (max-width: 480px) {
    width: calc(100vw - 2rem);
    max-width: calc(100vw - 2rem);
    max-height: clamp(240px, 45vh, 400px);
    bottom: ${({theme:t})=>t.spacing.medium||"1rem"};
    padding: 1rem;
  }
`,TQ=pn.div`
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  color: ${({isDarkMode:t})=>t?"#f0f0f0":"#2a2a2a"};
  font-weight: 600;
  font-size: 1.1rem;
  letter-spacing: -0.02em;
  
  /* Add wave icon */
  &::before {
    content: '';
    font-size: 1.3rem;
    filter: ${({isDarkMode:t})=>t?"brightness(1.1)":"brightness(0.95)"};
  }
`,CQ=pn.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 2.8rem;
  height: 2.5rem;
  background: ${({isDarkMode:t})=>t?"linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%)":"linear-gradient(135deg, #3b82f6 0%, #6366f1 100%)"};
  color: white;
  border-radius: 12px;
  font-weight: 700;
  font-size: 1rem;
  box-shadow: 
    0 4px 12px ${({isDarkMode:t})=>t?"rgba(79, 70, 229, 0.4)":"rgba(59, 130, 246, 0.3)"},
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  transition: all 0.2s ease;
  
  &::after {
    content: 'ft';
    font-size: 0.7rem;
    margin-left: 0.2rem;
    opacity: 0.85;
    font-weight: 500;
  }
`,EQ=Cn(HV)(({isDarkMode:t})=>({color:t?"#6366f1":"#3b82f6",height:8,padding:"15px 0",marginTop:"0.5rem","& .MuiSlider-track":{height:8,borderRadius:4,background:t?"linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%)":"linear-gradient(90deg, #3b82f6 0%, #6366f1 100%)",border:"none",boxShadow:"inset 0 1px 2px rgba(0,0,0,0.15)"},"& .MuiSlider-rail":{height:8,borderRadius:4,backgroundColor:t?"rgba(255,255,255,0.12)":"rgba(0,0,0,0.08)",border:`1px solid ${t?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.04)"}`},"& .MuiSlider-thumb":{height:24,width:24,backgroundColor:"#fff",border:`3px solid ${t?"#6366f1":"#3b82f6"}`,boxShadow:`0 4px 12px ${t?"rgba(99, 102, 241, 0.4)":"rgba(59, 130, 246, 0.4)"}, 0 2px 4px rgba(0,0,0,0.1)`,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)","&::before":{content:'""',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"8px",height:"8px",borderRadius:"50%",background:t?"#6366f1":"#3b82f6"},"&:hover, &.Mui-focusVisible":{boxShadow:`0 6px 20px ${t?"rgba(99, 102, 241, 0.6)":"rgba(59, 130, 246, 0.6)"}, 0 2px 8px rgba(0,0,0,0.15)`,transform:"scale(1.1)"},"&.Mui-active":{boxShadow:`0 8px 24px ${t?"rgba(99, 102, 241, 0.8)":"rgba(59, 130, 246, 0.8)"}, 0 0 0 8px ${t?"rgba(99, 102, 241, 0.16)":"rgba(59, 130, 246, 0.16)"}`,transform:"scale(1.15)"}},"& .MuiSlider-mark":{backgroundColor:t?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.3)",height:3,width:1.5,borderRadius:1,"&.MuiSlider-markActive":{backgroundColor:"currentColor",opacity:.8}},"& .MuiSlider-markLabel":{fontSize:"0.72rem",fontWeight:500,color:t?"rgba(255,255,255,0.65)":"rgba(0,0,0,0.65)",transform:"translateY(8px)"}})),AQ=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:8,label:"8"},{value:10,label:"10"},{value:12,label:"12"},{value:15,label:"15"}],PQ=({mapRef:t,drawCounter:s,setDrawCounter:c,isDarkMode:p,setLayersRef:g,closedMode:v,lineCount:S})=>{const[r,E]=Te.useState([]),A=Te.useRef(!1),[I,F]=Te.useState(3),[z,R]=Te.useState(!1);return Te.useEffect(()=>{const D=O=>O.preventDefault();return document.body.addEventListener("touchmove",D,{passive:!1}),()=>{document.body.removeEventListener("touchmove",D)}},[]),ue.jsxs("div",{children:[ue.jsxs(SQ,{isDarkMode:p,children:[ue.jsxs(TQ,{isDarkMode:p,children:["Wave Height",ue.jsx(CQ,{isDarkMode:p,children:I})]}),ue.jsx(EQ,{value:I,onChange:(D,O)=>F(O),step:1,marks:AQ,min:1,max:15,valueLabelDisplay:"off",isDarkMode:p,"aria-label":"Wave height in feet"})]}),ue.jsxs(xR,{width:window.innerWidth,height:window.innerHeight,onPointerDown:D=>iG(D,r,E,A),onPointerMove:D=>oG(D,r,E,A),onPointerUp:()=>lG(t,r,E,A,s,c,g,Mx,v,S,I,p),style:{position:"absolute",top:0,left:0,zIndex:10,pointerEvents:"auto"},children:[ue.jsx(yR,{children:r.map((D,O)=>ue.jsx(vR,{points:D.points,stroke:p?"#ffffff":"#000000",strokeWidth:2.5,tension:.3,lineCap:"round",lineJoin:"round",bezier:!1,opacity:.9},O))}),z&&ue.jsx(wx,{onClose:()=>R(!1)})]})]})},MQ=(t,s)=>s.current?{type:"FeatureCollection",features:t.map(p=>{const g=[];for(let v=0;v<p.points.length;v+=2){const S=p.points[v],r=p.points[v+1],E=s.current.unproject([S,r]);g.push([E.lng,E.lat])}return{type:"Feature",geometry:{type:"LineString",coordinates:g},properties:{color:p.color}}})}:(console.error("Map reference is not available!"),null),IQ=(t,s,c,p,g)=>{p.current=!0;const v=t.target.getStage().getPointerPosition();c([...s,{points:[v.x,v.y],color:g}])},RQ=(t,s,c,p)=>{if(!p.current)return;const v=t.target.getStage().getPointerPosition(),S={...s[s.length-1]};S.points=[...S.points,v.x,v.y];const r=[...s.slice(0,-1),S];c(r)},DQ=async(t,s,c,p,g,v,S,r,E,A)=>{const I=t.current;if(!I)return;p.current=!1;const F=MQ(s,t);if(!F)return;const z=fS(),R=`SF_${z}`,D=`SF_${z}_bg`,O=`SF_${z}_dash`,N=I.getLayer("custom-points-layer")?"custom-points-layer":void 0;I.getSource(R)&&I.removeSource(R),I.getLayer(D)&&I.removeLayer(D),I.getLayer(O)&&I.removeLayer(O),I.addSource(R,{type:"geojson",data:F});const H="#0000FF",j="#FF0000";I.addLayer({id:D,type:"line",source:R,slot:"top",paint:{"line-color":H,"line-width":6,"line-opacity":.8}},N),I.addLayer({id:O,type:"line",source:R,slot:"top",paint:{"line-color":j,"line-width":6,"line-dasharray":[0,4,3]}},N);const V=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1],[0,3.5,3,.5]];let Z=0;function X(se){if(!I.getLayer(O)){console.warn(`Layer '${O}' does not exist. Reloading page.`),window.location.reload();return}const ge=parseInt(se/150%V.length);ge!==Z&&(I.setPaintProperty(O,"line-dasharray",V[ge]),Z=ge),requestAnimationFrame(X)}if(X(0),typeof S?.current=="function"){const se="Surface Front Layer";S.current(ge=>{let ae=1,oe=se;const fe=ge.map(K=>K.name);JSON.parse(localStorage.getItem("user"));const pe=localStorage.getItem("projectId");for(;fe.includes(oe);)oe=`${se} ${ae++}`;if(F.features.length>0){const K=F.features[0];r({geometry:K.geometry,properties:{isFront:!0,project:pe},name:oe,sourceId:R}).catch(ye=>{console.error("Error saving feature:",ye)})}return[...ge,{id:O,sourceID:R,name:oe,visible:!0,locked:!1}]})}A.current=!A.current,c([])},kQ=({mapRef:t,drawCounter:s,setDrawCounter:c,setLayersRef:p,closedMode:g})=>{const[v,S]=Te.useState([]),r=Te.useRef(!1),E=Te.useRef(!0);Te.useEffect(()=>{const I=F=>F.preventDefault();return document.body.addEventListener("touchmove",I,{passive:!1}),()=>{document.body.removeEventListener("touchmove",I)}},[]);const A=I=>{const F=E.current?"red":"blue";IQ(I,v,S,r,F)};return ue.jsx("div",{children:ue.jsx(xR,{width:window.innerWidth,height:window.innerHeight,onPointerDown:A,onPointerMove:I=>RQ(I,v,S,r),onPointerUp:()=>DQ(t,v,S,r,s,c,p,Mx,g,E),style:{position:"absolute",top:0,left:0,zIndex:10,pointerEvents:"auto"},children:ue.jsx(yR,{children:v.map((I,F)=>ue.jsx(vR,{points:I.points,stroke:I.color,strokeWidth:2,tension:.5,lineCap:"round",lineJoin:"round"},F))})})})},OQ=pn.div`
  position: fixed;
  bottom: 1.8rem;
  left: 0.5rem;
  width: clamp(18rem, 25vw, 24rem);
  max-height: clamp(12rem, 20vh, 18rem);
  padding: 1rem 1.25rem;
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid ${({theme:t})=>t.colors.border||"#e5e7eb"};
  border-radius: 0.75rem;
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.08),
    0 2px 4px rgba(0, 0, 0, 0.04);
  z-index: 50;
  overflow-y: auto;
  transition: all 0.3s ease;

  /* Custom scrollbar */
  &::-webkit-scrollbar {
    width: 4px;
  }
  
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  
  &::-webkit-scrollbar-thumb {
    background: ${({theme:t})=>t.colors.border||"#d1d5db"};
    border-radius: 2px;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: ${({theme:t})=>t.colors.textSecondary||"#9ca3af"};
  }

  /* Responsive breakpoints */
  @media (max-width: 1200px) {
    width: clamp(16rem, 28vw, 22rem);
    padding: 0.875rem 1rem;
    bottom: 1.5rem;
    right: 0.5rem;
  }

  /* Dark theme enhancements */
  ${({theme:t})=>t.colors.background===CM.colors.background&&`
    background: ${({theme:s})=>s?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
    border-color: ${t.colors.border||"#374151"};
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.25),
      0 2px 4px rgba(0, 0, 0, 0.15);
  `}
`,LQ=pn.h3`
  font-weight: 600;
  font-size: clamp(0.875rem, 1.5vw, 1rem);
  color: ${({theme:t})=>t.colors.textPrimary};
  margin-bottom: 0.625rem;
  border-bottom: 1px solid ${({theme:t})=>t.colors.border||"#e5e7eb"};
  padding-bottom: 0.375rem;
  letter-spacing: 0.025em;
  position: relative;

  &::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 2rem;
    height: 2px;
    background: linear-gradient(90deg, #01a0da, #0ea5e9);
    border-radius: 1px;
  }
`,zQ=pn.ul`
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem 0.875rem;

  @media (max-width: 1200px) {
    gap: 0.25rem 0.75rem;
  }
`,FQ=pn.li`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: clamp(0.75rem, 1.2vw, 0.825rem);
  color: ${({theme:t})=>t.colors.textPrimary};
  font-weight: 500;
  transition: color 0.2s ease;
  
  &:hover {
    color: ${({theme:t})=>t.colors.textSecondary||"#6b7280"};
  }

  @media (max-width: 1200px) {
    gap: 0.4rem;
    font-size: clamp(0.7rem, 1.1vw, 0.8rem);
  }
`,BQ=pn.span`
  width: 1.25rem;
  height: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;

  @media (max-width: 1200px) {
    width: 1.125rem;
    height: 1.125rem;
  }
`;pn.div`
  height: 0.25rem;
  width: 1rem;
  background-color: ${({color:t})=>t};
  border-radius: ${({rounded:t})=>t?"9999px":"0.125rem"};
  transition: transform 0.2s ease;

  &:hover {
    transform: scale(1.1);
  }
`;const oM=pn.span`
  font-weight: 700;
  font-size: clamp(0.875rem, 1.4vw, 1rem);
  color: ${({color:t})=>t};
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease;

  &:hover {
    transform: scale(1.1);
  }
`,NQ=pn.div`
  margin-top: 0.75rem;
  padding-top: 0.5rem;
  font-size: clamp(0.625rem, 1vw, 0.7rem);
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: ${({theme:t})=>t.colors.textSecondary||"#6b7280"};
  border-top: 1px solid ${({theme:t})=>t.colors.border||"#f3f4f6"};
  font-weight: 500;

  strong {
    color: #01a0da;
    font-weight: 600;
    letter-spacing: 0.025em;
  }

  @media (max-width: 1200px) {
    margin-top: 0.625rem;
    padding-top: 0.375rem;
  }
`,sM=pn.img`
  width: 1.25rem;
  height: 1.25rem;
  object-fit: contain;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
  transition: transform 0.2s ease;

  &:hover {
    transform: scale(1.1);
  }

  @media (max-width: 1200px) {
    width: 1.125rem;
    height: 1.125rem;
  }
`,VQ=pn.div`
  width: 1.5rem;
  height: 0.25rem;
  background-image: linear-gradient(
    to right, 
    #2563eb 25%, 
    #ef4444 25%, 
    #ef4444 50%, 
    #2563eb 50%, 
    #2563eb 75%, 
    #ef4444 75%
  );
  background-size: 100% 100%;
  border-radius: 0.125rem;
  transition: transform 0.2s ease;

  &:hover {
    transform: scale(1.1);
  }

  @media (max-width: 1200px) {
    width: 1.25rem;
  }
`,_y=({label:t,symbol:s})=>ue.jsxs(FQ,{children:[ue.jsx(BQ,{children:s}),ue.jsx("span",{children:t})]}),UQ=()=>ue.jsxs(OQ,{children:[ue.jsx(LQ,{children:"Legend"}),ue.jsxs(zQ,{children:[ue.jsx(_y,{label:"Wave Heights",symbol:ue.jsx(sM,{src:"/wave.png",alt:"Wave Height"})}),ue.jsx(_y,{label:"Tropical Cyclone",symbol:ue.jsx(sM,{src:"/hurricane.png",alt:"Tropical Cyclone"})}),ue.jsx(_y,{label:"LPA",symbol:ue.jsx(oM,{color:"#dc2626",children:"L"})}),ue.jsx(_y,{label:"HPA",symbol:ue.jsx(oM,{color:"#2563eb",children:"H"})}),ue.jsx(_y,{label:"Surface Fronts",symbol:ue.jsx(VQ,{})})]}),ue.jsxs(NQ,{children:[ue.jsxs("span",{children:["Checked: ",ue.jsx("strong",{children:"JAE"})]}),ue.jsxs("span",{children:["By: ",ue.jsx("strong",{children:"KSBB"})]})]})]}),jQ=pn.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: ${({theme:t})=>t.colors.loadingBackground||"rgba(0, 0, 0, 0.4)"};
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
`,GQ=pn.div`
  background: white;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
  background: ${({theme:t})=>t.colors.lightBackground};
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  animation: modalSlideIn 0.3s ease-out;

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
`,$Q=pn.div`
  padding: 24px 24px 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 24px;
`,HQ=pn.h2`
  font-size: 24px;
  font-weight: 700;
  color: ${({theme:t})=>t.colors.textPrimary};
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
`,qQ=pn.button`
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  color: #6b7280;
  transition: all 0.2s ease;

  &:hover {
    background: #f3f4f6;
    color: #374151;
  }
`,WQ=pn.div`
  padding: 0 24px 24px 24px;
`,aM=pn.div`
  margin-bottom: 32px;

  &:last-child {
    margin-bottom: 0;
  }
`,lM=pn.h3`
  font-size: 18px;
  font-weight: 600;
  color: ${({theme:t})=>t.colors.textPrimary};
  margin: 0 0 16px 0;
  display: flex;
  align-items: center;
  gap: 8px;
`,ZQ=pn.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
`,fw=pn.div`
  display: flex;
  flex-direction: column;
`,pw=pn.label`
  font-size: 14px;
  font-weight: 500;
  color: #374151;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
`,mw=pn.input`
  padding: 12px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
  background: ${({theme:t})=>t.colors.lightBackground};
  color: #6b7280;
  cursor: not-allowed;
  
  &:focus {
    outline: none;
    border-color: #d1d5db;
  }
`,YQ=pn.div`
  border: 2px dashed ${t=>t.$isDragActive?"#3b82f6":t.$hasFile?"#10b981":"#d1d5db"};
  border-radius: 12px;
  padding: 48px 24px;
  text-align: center;
  background: ${({isDarkMode:t,$isDragActive:s,$hasFile:c})=>s?t?"#1e293b":"#eff6ff":c?t?"#374151":"#f0fdf4":t?"#2c3e50":"#fafafa"};
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;

  &:hover {
    border-color: ${({$hasFile:t})=>t?"#10b981":"#3b82f6"};
    background: ${({isDarkMode:t,$hasFile:s})=>s?t?"#3c556e":"#f0f7fdff":t?"#3e4a59":"#f0f7fdff"};
  }
`,XQ=pn.div`
  display: flex;
  justify-content: center;
  margin-bottom: 16px;
  
  svg {
    width: 48px;
    height: 48px;
    color: ${t=>t.$hasFile?"#10b981":"#6b7280"};
  }
`,KQ=pn.div`
  h4 {
    font-size: 18px;
    font-weight: 600;
    color: ${({theme:t,$hasFile:s,isDarkMode:c})=>s?c?"#059669":"#10b981":t.colors.textPrimary};
    margin: 0 0 8px 0;
  }
  
  p {
    font-size: 14px;
    color: #6b7280;
    margin: 0;
  }
`,JQ=pn.div`
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  border-radius: 8px;
  padding: 16px;
  margin-top: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
`,QQ=pn.div`
  background: #10b981;
  border-radius: 8px;
  padding: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  
  svg {
    width: 20px;
    height: 20px;
    color: white;
  }
`,eee=pn.div`
  flex: 1;
  
  h5 {
    font-size: 14px;
    font-weight: 600;
    color: #065f46;
    margin: 0 0 4px 0;
  }
  
  p {
    font-size: 12px;
    color: #6b7280;
    margin: 0;
  }
`,tee=pn.button`
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  color: #6b7280;
  transition: all 0.2s ease;

  &:hover {
    background: #fee2e2;
    color: #dc2626;
  }
`,nee=pn.input`
  display: none;
`,ree=pn.div`
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 32px;
  padding-top: 24px;
  border-top: 1px solid #e5e7eb;
`,cM=pn.button`
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 8px;

  ${t=>t.$variant==="primary"?`
    background: #3b82f6;
    color: white;
    border: 2px solid #3b82f6;
    
    &:hover:not(:disabled) {
      background: #2563eb;
      border-color: #2563eb;
    }
    
    &:disabled {
      background: #9ca3af;
      border-color: #9ca3af;
      cursor: not-allowed;
    }
  `:`
    background: white;
    color: #374151;
    border: 2px solid #d1d5db;
    
    &:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
  `}
`,iee=pn.div`
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  padding: 12px 16px;
  margin-top: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #dc2626;
  font-size: 14px;
  
  svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }
`,oee=pn.button`
  background: #3b82f6;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  margin-top: 12px;
  transition: background 0.2s ease;

  &:hover {
    background: #2563eb;
  }
`,see=t=>{if(t===0)return"0 Bytes";const s=1024,c=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,p)).toFixed(2))+" "+c[p]},sS=({visible:t,onClose:s,onSubmit:c,projectTitle:p="Sample Title",projectType:g="Wave Analysis",forecastDate:v="",isSubmitting:S=!1,isDarkMode:r})=>{const[E,A]=Te.useState(!1),[I,F]=Te.useState(null),[z,R]=Te.useState(""),D=Te.useRef(null);if(!t)return null;const O=oe=>{oe.preventDefault(),oe.stopPropagation(),A(!0)},N=oe=>{oe.preventDefault(),oe.stopPropagation(),A(!1)},H=oe=>{oe.preventDefault(),oe.stopPropagation()},j=oe=>{oe.preventDefault(),oe.stopPropagation(),A(!1);const fe=oe.dataTransfer.files;Z(fe[0])},V=oe=>{const fe=oe.target.files[0];Z(fe)},Z=oe=>{if(R(""),!oe)return;if(!oe.name.toLowerCase().endsWith(".zip")){R("Please select a ZIP file only.");return}const fe=50*1024*1024;if(oe.size>fe){R("File size must be less than 50MB.");return}F(oe)},X=()=>{D.current?.click()},se=()=>{F(null),R(""),D.current&&(D.current.value="")},ge=()=>{if(!I){R("Please select a ZIP file to submit.");return}c(I)},ae=()=>{F(null),R(""),D.current&&(D.current.value=""),s()};return ue.jsxs(jQ,{onClick:oe=>oe.target===oe.currentTarget&&ae(),children:[ue.jsxs(GQ,{children:[ue.jsxs($Q,{children:[ue.jsxs(HQ,{children:[ue.jsx(o1,{size:28}),"Submit Project"]}),ue.jsx(qQ,{onClick:ae,children:ue.jsx(l5,{size:24})})]}),ue.jsxs(WQ,{children:[ue.jsxs(aM,{children:[ue.jsxs(lM,{children:[ue.jsx(c5,{size:20}),"Project Information"]}),ue.jsxs(ZQ,{children:[ue.jsxs(fw,{children:[ue.jsxs(pw,{children:[ue.jsx(NL,{size:16}),"Title"]}),ue.jsx(mw,{type:"text",value:p,readOnly:!0,disabled:!0})]}),ue.jsxs(fw,{children:[ue.jsxs(pw,{children:[ue.jsx(c5,{size:16}),"Type"]}),ue.jsx(mw,{type:"text",value:g,readOnly:!0,disabled:!0})]}),ue.jsxs(fw,{children:[ue.jsxs(pw,{children:[ue.jsx(OL,{size:16}),"Forecast Date"]}),ue.jsx(mw,{type:"text",value:v,readOnly:!0,disabled:!0})]})]})]}),ue.jsxs(aM,{children:[ue.jsxs(lM,{children:[ue.jsx(o1,{size:20}),"Upload Project File"]}),ue.jsxs(YQ,{$isDragActive:E,$hasFile:!!I,onDragEnter:O,onDragLeave:N,onDragOver:H,onDrop:j,onClick:X,isDarkMode:r,children:[ue.jsx(XQ,{$hasFile:!!I,children:I?ue.jsx(u5,{}):ue.jsx(o1,{})}),ue.jsx(KQ,{$hasFile:!!I,children:I?ue.jsxs(ue.Fragment,{children:[ue.jsx("h4",{children:"File Ready for Upload"}),ue.jsx("p",{children:"Click to change file or drag a new one here"})]}):ue.jsxs(ue.Fragment,{children:[ue.jsx("h4",{children:"Drop your ZIP file here"}),ue.jsx("p",{children:"or click to browse files (ZIP format only, max 50MB)"})]})}),!I&&ue.jsx(oee,{type:"button",children:"Choose File"})]}),ue.jsx(nee,{ref:D,type:"file",accept:".zip",onChange:V}),I&&ue.jsxs(JQ,{children:[ue.jsx(QQ,{children:ue.jsx(u5,{})}),ue.jsxs(eee,{children:[ue.jsx("h5",{children:I.name}),ue.jsxs("p",{children:[see(I.size),"  ZIP Archive"]})]}),ue.jsx(tee,{onClick:se,children:ue.jsx(l5,{size:16})})]}),z&&ue.jsxs(iee,{children:[ue.jsx(LL,{}),z]})]}),ue.jsxs(ree,{children:[ue.jsx(cM,{onClick:ae,disabled:S,children:"Cancel"}),ue.jsx(cM,{$variant:"primary",onClick:ge,disabled:!I||S,children:S?ue.jsxs(ue.Fragment,{children:[ue.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid #ffffff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Submitting..."]}):ue.jsxs(ue.Fragment,{children:[ue.jsx(o1,{size:16}),"Submit Project"]})})]})]})]}),ue.jsx("style",{jsx:!0,children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})},E1=43200,uM=1440,dM=Symbol.for("constructDateFrom");function bT(t,s){return typeof t=="function"?t(s):t&&typeof t=="object"&&dM in t?t[dM](s):t instanceof Date?new t.constructor(s):new Date(s)}function Fp(t,s){return bT(t,t)}let aee={};function lee(){return aee}function hM(t){const s=Fp(t),c=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return c.setUTCFullYear(s.getFullYear()),+t-+c}function wT(t,...s){const c=bT.bind(null,t||s.find(p=>typeof p=="object"));return s.map(c)}function nx(t,s){const c=+Fp(t)-+Fp(s);return c<0?-1:c>0?1:c}function cee(t){return bT(t,Date.now())}function uee(t,s,c){const[p,g]=wT(c?.in,t,s),v=p.getFullYear()-g.getFullYear(),S=p.getMonth()-g.getMonth();return v*12+S}function dee(t){return s=>{const p=(t?Math[t]:Math.trunc)(s);return p===0?0:p}}function hee(t,s){return+Fp(t)-+Fp(s)}function fee(t,s){const c=Fp(t);return c.setHours(23,59,59,999),c}function pee(t,s){const c=Fp(t),p=c.getMonth();return c.setFullYear(c.getFullYear(),p+1,0),c.setHours(23,59,59,999),c}function mee(t,s){const c=Fp(t);return+fee(c)==+pee(c)}function gee(t,s,c){const[p,g,v]=wT(c?.in,t,t,s),S=nx(g,v),r=Math.abs(uee(g,v));if(r<1)return 0;g.getMonth()===1&&g.getDate()>27&&g.setDate(30),g.setMonth(g.getMonth()-S*r);let E=nx(g,v)===-S;mee(p)&&r===1&&nx(p,v)===1&&(E=!1);const A=S*(r-+E);return A===0?0:A}function _ee(t,s,c){const p=hee(t,s)/1e3;return dee(c?.roundingMethod)(p)}const yee={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},vee=(t,s,c)=>{let p;const g=yee[t];return typeof g=="string"?p=g:s===1?p=g.one:p=g.other.replace("{{count}}",s.toString()),c?.addSuffix?c.comparison&&c.comparison>0?"in "+p:p+" ago":p};function gw(t){return(s={})=>{const c=s.width?String(s.width):t.defaultWidth;return t.formats[c]||t.formats[t.defaultWidth]}}const xee={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},bee={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},wee={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},See={date:gw({formats:xee,defaultWidth:"full"}),time:gw({formats:bee,defaultWidth:"full"}),dateTime:gw({formats:wee,defaultWidth:"full"})},Tee={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Cee=(t,s,c,p)=>Tee[t];function yy(t){return(s,c)=>{const p=c?.context?String(c.context):"standalone";let g;if(p==="formatting"&&t.formattingValues){const S=t.defaultFormattingWidth||t.defaultWidth,r=c?.width?String(c.width):S;g=t.formattingValues[r]||t.formattingValues[S]}else{const S=t.defaultWidth,r=c?.width?String(c.width):t.defaultWidth;g=t.values[r]||t.values[S]}const v=t.argumentCallback?t.argumentCallback(s):s;return g[v]}}const Eee={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Aee={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Pee={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Mee={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Iee={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ree={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Dee=(t,s)=>{const c=Number(t),p=c%100;if(p>20||p<10)switch(p%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"},kee={ordinalNumber:Dee,era:yy({values:Eee,defaultWidth:"wide"}),quarter:yy({values:Aee,defaultWidth:"wide",argumentCallback:t=>t-1}),month:yy({values:Pee,defaultWidth:"wide"}),day:yy({values:Mee,defaultWidth:"wide"}),dayPeriod:yy({values:Iee,defaultWidth:"wide",formattingValues:Ree,defaultFormattingWidth:"wide"})};function vy(t){return(s,c={})=>{const p=c.width,g=p&&t.matchPatterns[p]||t.matchPatterns[t.defaultMatchWidth],v=s.match(g);if(!v)return null;const S=v[0],r=p&&t.parsePatterns[p]||t.parsePatterns[t.defaultParseWidth],E=Array.isArray(r)?Lee(r,F=>F.test(S)):Oee(r,F=>F.test(S));let A;A=t.valueCallback?t.valueCallback(E):E,A=c.valueCallback?c.valueCallback(A):A;const I=s.slice(S.length);return{value:A,rest:I}}}function Oee(t,s){for(const c in t)if(Object.prototype.hasOwnProperty.call(t,c)&&s(t[c]))return c}function Lee(t,s){for(let c=0;c<t.length;c++)if(s(t[c]))return c}function zee(t){return(s,c={})=>{const p=s.match(t.matchPattern);if(!p)return null;const g=p[0],v=s.match(t.parsePattern);if(!v)return null;let S=t.valueCallback?t.valueCallback(v[0]):v[0];S=c.valueCallback?c.valueCallback(S):S;const r=s.slice(g.length);return{value:S,rest:r}}}const Fee=/^(\d+)(th|st|nd|rd)?/i,Bee=/\d+/i,Nee={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Vee={any:[/^b/i,/^(a|c)/i]},Uee={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},jee={any:[/1/i,/2/i,/3/i,/4/i]},Gee={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},$ee={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Hee={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},qee={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Wee={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Zee={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Yee={ordinalNumber:zee({matchPattern:Fee,parsePattern:Bee,valueCallback:t=>parseInt(t,10)}),era:vy({matchPatterns:Nee,defaultMatchWidth:"wide",parsePatterns:Vee,defaultParseWidth:"any"}),quarter:vy({matchPatterns:Uee,defaultMatchWidth:"wide",parsePatterns:jee,defaultParseWidth:"any",valueCallback:t=>t+1}),month:vy({matchPatterns:Gee,defaultMatchWidth:"wide",parsePatterns:$ee,defaultParseWidth:"any"}),day:vy({matchPatterns:Hee,defaultMatchWidth:"wide",parsePatterns:qee,defaultParseWidth:"any"}),dayPeriod:vy({matchPatterns:Wee,defaultMatchWidth:"any",parsePatterns:Zee,defaultParseWidth:"any"})},Xee={code:"en-US",formatDistance:vee,formatLong:See,formatRelative:Cee,localize:kee,match:Yee,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Kee(t,s,c){const p=lee(),g=c?.locale??p.locale??Xee,v=2520,S=nx(t,s);if(isNaN(S))throw new RangeError("Invalid time value");const r=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:S}),[E,A]=wT(c?.in,...S>0?[s,t]:[t,s]),I=_ee(A,E),F=(hM(A)-hM(E))/1e3,z=Math.round((I-F)/60);let R;if(z<2)return c?.includeSeconds?I<5?g.formatDistance("lessThanXSeconds",5,r):I<10?g.formatDistance("lessThanXSeconds",10,r):I<20?g.formatDistance("lessThanXSeconds",20,r):I<40?g.formatDistance("halfAMinute",0,r):I<60?g.formatDistance("lessThanXMinutes",1,r):g.formatDistance("xMinutes",1,r):z===0?g.formatDistance("lessThanXMinutes",1,r):g.formatDistance("xMinutes",z,r);if(z<45)return g.formatDistance("xMinutes",z,r);if(z<90)return g.formatDistance("aboutXHours",1,r);if(z<uM){const D=Math.round(z/60);return g.formatDistance("aboutXHours",D,r)}else{if(z<v)return g.formatDistance("xDays",1,r);if(z<E1){const D=Math.round(z/uM);return g.formatDistance("xDays",D,r)}else if(z<E1*2)return R=Math.round(z/E1),g.formatDistance("aboutXMonths",R,r)}if(R=gee(A,E),R<12){const D=Math.round(z/E1);return g.formatDistance("xMonths",D,r)}else{const D=R%12,O=Math.trunc(R/12);return D<3?g.formatDistance("aboutXYears",O,r):D<9?g.formatDistance("overXYears",O,r):g.formatDistance("almostXYears",O+1,r)}}function Jee(t,s){return Kee(t,cee(t),s)}const Qee=ll`
  from { opacity: 0; }
  to { opacity: 1; }
`,e6=ll`
  from { 
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  to { 
    opacity: 1;
    transform: translateY(0) scale(1);
  }
`;ll`
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
`;const fM=pn.div`
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
  backdrop-filter: blur(8px);
  z-index: ${({theme:t})=>t.zIndex?.loadingScreen||1e3};
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  animation: ${Qee} 0.3s ease-out;
`,ete=pn.div`
  background: ${({theme:t})=>t.colors?.lightBackground||"#ffffff"};
  border-radius: 20px;
  padding: 0;
  width: 100%;
  max-width: 520px;
  max-height: 85vh;
  position: relative;
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  font-family: ${({theme:t})=>t.fonts?.regular||"system-ui, -apple-system, sans-serif"};
  overflow: hidden;
  animation: ${e6} 0.4s cubic-bezier(0.16, 1, 0.3, 1);

  @media (max-width: 640px) {
    margin: 1rem;
    max-height: 90vh;
    border-radius: 16px;
  }
`,tte=pn.div`
  padding: 2rem 2rem 1rem 2rem;
  background: linear-gradient(135deg, ${({theme:t})=>t.colors?.lightBackground||"#ffffff"} 0%, ${({theme:t})=>t.colors?.background||"#f8fafc"} 100%);
  border-bottom: 1px solid ${({theme:t})=>t.colors?.border||"rgba(0, 0, 0, 0.08)"};
  position: sticky;
  top: 0;
  z-index: 10;

  @media (max-width: 640px) {
    padding: 1.5rem 1.5rem 1rem 1.5rem;
  }
`,nte=pn.h2`
  margin: 0;
  font-size: 1.75rem;
  font-weight: 700;
  background: linear-gradient(135deg, ${({theme:t})=>t.colors?.textPrimary||"#1a202c"}, ${({theme:t})=>t.colors?.textSecondary||"#4a5568"});
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1.2;

  @media (max-width: 640px) {
    font-size: 1.5rem;
  }
`,rte=pn.p`
  margin: 0.5rem 0 0 0;
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
  font-size: 0.95rem;
  font-weight: 400;
`,ite=pn.div`
  padding: 0 2rem 2rem 2rem;
  max-height: calc(85vh - 140px);
  overflow-y: auto;
  
  /* Custom scrollbar */
  scrollbar-width: thin;
  scrollbar-color: ${({theme:t})=>t.colors?.scrollThumb||"#cbd5e1"} transparent;

  &::-webkit-scrollbar {
    width: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: ${({theme:t})=>t.colors?.scrollThumb||"#cbd5e1"};
    border-radius: 3px;
    
    &:hover {
      background: ${({theme:t})=>t.colors?.scrollThumbHover||"#94a3b8"};
    }
  }

  @media (max-width: 640px) {
    padding: 0 1.5rem 1.5rem 1.5rem;
  }
`,ote=pn.div`
  background: ${({theme:t})=>t.colors?.background||"#ffffff"};
  border: 1px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};
  border-radius: 12px;
  padding: 1.25rem;
  margin-bottom: 1rem;
  width: 100%;
  text-align: left;
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  position: relative;
  overflow: hidden;

  &:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.5s;
  }

  &:hover {
    background: ${({theme:t})=>t.colors?.highlight||"#3b82f6"}08;
    border-color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"}40;
    transform: translateY(-2px);
    box-shadow: 
      0 10px 25px -5px rgba(0, 0, 0, 0.1),
      0 8px 10px -6px rgba(0, 0, 0, 0.1),
      0 0 0 1px ${({theme:t})=>t.colors?.highlight||"#3b82f6"}20;

    &:before {
      left: 100%;
    }
  }

  &:last-child {
    margin-bottom: 0;
  }
`,t6=pn.button`
  background: none;
  border: none;
  padding: 0;
  width: 100%;
  text-align: left;
  cursor: pointer;
  
  &:active {
    transform: translateY(-1px);
  }
`,ste=pn.div`
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 0.75rem;
`,ate=pn.h4`
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
  line-height: 1.4;
  flex: 1;
  padding-right: 1rem;
`,lte=pn.span`
  background: linear-gradient(135deg, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}, ${({theme:t})=>t.colors?.highlight||"#3b82f6"}dd);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.025em;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
`,cte=pn.p`
  margin: 0 0 0.75rem 0;
  font-size: 0.9rem;
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
`,ute=pn.div`
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 0.8rem;
  color: ${({theme:t})=>t.colors?.textSecondary||"#94a3b8"};
`,pM=pn.span`
  display: flex;
  align-items: center;
  gap: 0.25rem;
  
  &:before {
    content: '';
    color: ${({theme:t})=>t.colors?.highlight||"#3b82f6"};
    font-weight: bold;
  }

  &:first-child:before {
    content: '';
  }
`,dte=pn.button`
  position: absolute;
  top: 1.5rem;
  right: 1.5rem;
  background: ${({theme:t})=>t.colors?.background||"#f1f5f9"};
  border: 1px solid ${({theme:t})=>t.colors?.border||"#e2e8f0"};
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 10;

  &:hover {
    background: ${({theme:t})=>t.colors?.highlight||"#ef4444"};
    color: white;
    border-color: ${({theme:t})=>t.colors?.highlight||"#ef4444"};
    transform: scale(1.05);
  }

  @media (max-width: 640px) {
    top: 1rem;
    right: 1rem;
    width: 36px;
    height: 36px;
  }
`,hte=pn.button`
  background: none;
  border: none;
  font-size: 1.5rem;
  color: ${({theme:t})=>t.colors?.deleteIcon||"#ef4444"};
  cursor: pointer;
  transition: all 0.2s ease;
  opacity: 0.6;
  padding: 0.5rem;
  line-height: 1;

  &:hover {
    opacity: 1;
    transform: scale(1.1);
  }
`,fte=pn.div`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  
  ${t6} {
    flex-grow: 1;
  }
`,pte=pn.div`
  text-align: center;
  padding: 3rem 1rem;
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
`,mte=pn.div`
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
`,gte=pn.h3`
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
`,_te=pn.p`
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.5;
`,yte=pn.div`
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: ${({theme:t})=>t.colors?.lightBackground||"#ffffff"};
  border-radius: 12px;
  padding: 2rem;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  z-index: ${({theme:t})=>t.zIndex?.modal||1001};
  animation: ${e6} 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  text-align: center;
`,vte=pn.h3`
  margin: 0 0 1rem 0;
  font-size: 1.25rem;
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
`,xte=pn.p`
  margin: 0 0 1.5rem 0;
  color: ${({theme:t})=>t.colors?.textSecondary||"#64748b"};
`,bte=pn.div`
  display: flex;
  gap: 1rem;
  justify-content: center;
`,n6=pn.button`
  background-color: ${({theme:t})=>t.colors?.danger||"#ef4444"};
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s ease;
  font-weight: 600;
  
  &:hover {
    background-color: ${({theme:t})=>t.colors?.dangerHover||"#dc2626"};
  }
`,wte=pn(n6)`
  background-color: ${({theme:t})=>t.colors?.secondaryButton||"#e2e8f0"};
  color: ${({theme:t})=>t.colors?.textPrimary||"#1e293b"};
  
  &:hover {
    background-color: ${({theme:t})=>t.colors?.secondaryButtonHover||"#cbd5e1"};
  }
`,aS=({visible:t,onClose:s,projects:c,onSelect:p,onDelete:g})=>{const[v,S]=Te.useState(null);if(!t)return null;const r=z=>{localStorage.setItem("projectId",z._id),localStorage.setItem("projectName",z.name),localStorage.setItem("chartType",z.chartType||"12"),localStorage.setItem("forecastDate",z.forecastDate),p&&p(z),s(),window.location.reload()},E=z=>{z.target===z.currentTarget&&s()},A=(z,R)=>{z.stopPropagation(),S(R)},I=async()=>{if(v)try{await g(v._id),S(null)}catch(z){console.error("Failed to delete project:",z)}},F=()=>{S(null)};return ue.jsxs(fM,{onClick:E,children:[ue.jsxs(ete,{children:[ue.jsx(dte,{onClick:s,"aria-label":"Close modal",children:""}),ue.jsxs(tte,{children:[ue.jsx(nte,{children:"Your Projects"}),ue.jsx(rte,{children:"Select a project to continue working"})]}),ue.jsx(ite,{children:c.length>0?c.map(z=>ue.jsx(ote,{children:ue.jsxs(fte,{children:[ue.jsxs(t6,{onClick:()=>r(z),children:[ue.jsxs(ste,{children:[ue.jsx(ate,{children:z.name}),ue.jsx(lte,{children:"Active"})]}),z.description&&ue.jsx(cte,{children:z.description}),ue.jsxs(ute,{children:[z.createdAt&&ue.jsxs(pM,{children:["Created ",Jee(new Date(z.createdAt),{addSuffix:!0})]}),z.chartType&&ue.jsxs(pM,{children:["Chart Type ",z.chartType]})]})]}),ue.jsx(hte,{onClick:R=>A(R,z),"aria-label":`Delete ${z.name}`,children:""})]})},z._id)):ue.jsxs(pte,{children:[ue.jsx(mte,{children:""}),ue.jsx(gte,{children:"No Projects Yet"}),ue.jsxs(_te,{children:["You haven't created any projects yet.",ue.jsx("br",{}),"Create your first project to get started!"]})]})})]}),v&&ue.jsx(fM,{children:ue.jsxs(yte,{children:[ue.jsx(vte,{children:"Delete Project?"}),ue.jsxs(xte,{children:['Are you sure you want to permanently delete "',v.name,'"? This action cannot be undone.']}),ue.jsxs(bte,{children:[ue.jsx(wte,{onClick:F,children:"Cancel"}),ue.jsx(n6,{onClick:I,children:"Delete"})]})]})})]})},Ste=pn.div`
  position: fixed;
  top: 6.3rem;
  left: 1.8rem;
  z-index: ${({theme:t})=>t.zIndex.stickyHeader};
  font-family: ${({theme:t})=>t.fonts.regular};
`,Tte=ll`
  0%, 100% { border-color: transparent; }
  50% { border-color: #f59e0b; }  // amber/orange
`,Cte=pn.button`
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  color: ${({theme:t})=>t.colors.textPrimary};
  border: 1px solid ${({theme:t})=>t.colors.border||"#ccc"};
  padding: 0.45rem 0.9rem;
  font-size: 0.95rem;
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  cursor: pointer;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
  transition: all 0.2s ease-in-out;

  &:hover {
    background: ${({theme:t})=>t.colors.background};
    transform: scale(1.03);
  }

  /* Only apply blink when blink prop is true */
  ${({blink:t})=>t&&uh`
      animation: ${Tte} 0.5s ease-in-out 6; /* 6 times = 3 seconds total */
    `}
`,Ete=pn.div`
  margin-top: 0.5rem;
  background: ${({theme:t})=>t.colors.lightBackground};
  border: 1px solid ${({theme:t})=>t.colors.border||"#ddd"};
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  min-width: 180px;
  display: flex;
  flex-direction: column;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
`,Sy=pn.button`
  background: transparent;
  border: none;
  padding: 0.75rem 1.25rem;
  font-size: 0.95rem;
  text-align: left;
  cursor: pointer;
  color: ${({$danger:t,theme:s})=>t?s.mainColors.blue:s.colors.textPrimary};
  border-radius: ${({theme:t})=>t.borderRadius.small};
  transition: background-color 0.2s ease;

  &:hover {
    background: ${({theme:t})=>t.colors.background};
  }
`,Ate=pn.div`
  position: absolute;
  top: 3.5rem;
  left: 100%;
  margin-left: 0.5rem;
  background: ${({theme:t})=>t.colors.lightBackground};
  border: 1px solid ${({theme:t})=>t.colors.border||"#ccc"};
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  display: flex;
  flex-direction: column;
  min-width: 160px;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
`,_w=pn(Sy)`
  padding: 0.65rem 1rem;
`,Pte=pn.div`
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: ${({theme:t})=>t.colors.loadingBackground};
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: ${({theme:t})=>t.zIndex.loadingScreen};
  color: ${({theme:t})=>t.colors.loadingText};
  font-size: 1.6rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  user-select: none;
`;function A1(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var yw={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var mM;function Mte(){return mM||(mM=1,(function(t,s){(function(c){t.exports=c()})(function(){return(function c(p,g,v){function S(A,I){if(!g[A]){if(!p[A]){var F=typeof A1=="function"&&A1;if(!I&&F)return F(A,!0);if(r)return r(A,!0);var z=new Error("Cannot find module '"+A+"'");throw z.code="MODULE_NOT_FOUND",z}var R=g[A]={exports:{}};p[A][0].call(R.exports,function(D){var O=p[A][1][D];return S(O||D)},R,R.exports,c,p,g,v)}return g[A].exports}for(var r=typeof A1=="function"&&A1,E=0;E<v.length;E++)S(v[E]);return S})({1:[function(c,p,g){var v=c("./utils"),S=c("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";g.encode=function(E){for(var A,I,F,z,R,D,O,N=[],H=0,j=E.length,V=j,Z=v.getTypeOf(E)!=="string";H<E.length;)V=j-H,F=Z?(A=E[H++],I=H<j?E[H++]:0,H<j?E[H++]:0):(A=E.charCodeAt(H++),I=H<j?E.charCodeAt(H++):0,H<j?E.charCodeAt(H++):0),z=A>>2,R=(3&A)<<4|I>>4,D=1<V?(15&I)<<2|F>>6:64,O=2<V?63&F:64,N.push(r.charAt(z)+r.charAt(R)+r.charAt(D)+r.charAt(O));return N.join("")},g.decode=function(E){var A,I,F,z,R,D,O=0,N=0,H="data:";if(E.substr(0,H.length)===H)throw new Error("Invalid base64 input, it looks like a data url.");var j,V=3*(E=E.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(E.charAt(E.length-1)===r.charAt(64)&&V--,E.charAt(E.length-2)===r.charAt(64)&&V--,V%1!=0)throw new Error("Invalid base64 input, bad content length.");for(j=S.uint8array?new Uint8Array(0|V):new Array(0|V);O<E.length;)A=r.indexOf(E.charAt(O++))<<2|(z=r.indexOf(E.charAt(O++)))>>4,I=(15&z)<<4|(R=r.indexOf(E.charAt(O++)))>>2,F=(3&R)<<6|(D=r.indexOf(E.charAt(O++))),j[N++]=A,R!==64&&(j[N++]=I),D!==64&&(j[N++]=F);return j}},{"./support":30,"./utils":32}],2:[function(c,p,g){var v=c("./external"),S=c("./stream/DataWorker"),r=c("./stream/Crc32Probe"),E=c("./stream/DataLengthProbe");function A(I,F,z,R,D){this.compressedSize=I,this.uncompressedSize=F,this.crc32=z,this.compression=R,this.compressedContent=D}A.prototype={getContentWorker:function(){var I=new S(v.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new E("data_length")),F=this;return I.on("end",function(){if(this.streamInfo.data_length!==F.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),I},getCompressedWorker:function(){return new S(v.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},A.createWorkerFrom=function(I,F,z){return I.pipe(new r).pipe(new E("uncompressedSize")).pipe(F.compressWorker(z)).pipe(new E("compressedSize")).withStreamInfo("compression",F)},p.exports=A},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(c,p,g){var v=c("./stream/GenericWorker");g.STORE={magic:"\0\0",compressWorker:function(){return new v("STORE compression")},uncompressWorker:function(){return new v("STORE decompression")}},g.DEFLATE=c("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(c,p,g){var v=c("./utils"),S=(function(){for(var r,E=[],A=0;A<256;A++){r=A;for(var I=0;I<8;I++)r=1&r?3988292384^r>>>1:r>>>1;E[A]=r}return E})();p.exports=function(r,E){return r!==void 0&&r.length?v.getTypeOf(r)!=="string"?(function(A,I,F,z){var R=S,D=z+F;A^=-1;for(var O=z;O<D;O++)A=A>>>8^R[255&(A^I[O])];return-1^A})(0|E,r,r.length,0):(function(A,I,F,z){var R=S,D=z+F;A^=-1;for(var O=z;O<D;O++)A=A>>>8^R[255&(A^I.charCodeAt(O))];return-1^A})(0|E,r,r.length,0):0}},{"./utils":32}],5:[function(c,p,g){g.base64=!1,g.binary=!1,g.dir=!1,g.createFolders=!0,g.date=null,g.compression=null,g.compressionOptions=null,g.comment=null,g.unixPermissions=null,g.dosPermissions=null},{}],6:[function(c,p,g){var v=null;v=typeof Promise<"u"?Promise:c("lie"),p.exports={Promise:v}},{lie:37}],7:[function(c,p,g){var v=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",S=c("pako"),r=c("./utils"),E=c("./stream/GenericWorker"),A=v?"uint8array":"array";function I(F,z){E.call(this,"FlateWorker/"+F),this._pako=null,this._pakoAction=F,this._pakoOptions=z,this.meta={}}g.magic="\b\0",r.inherits(I,E),I.prototype.processChunk=function(F){this.meta=F.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(A,F.data),!1)},I.prototype.flush=function(){E.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},I.prototype.cleanUp=function(){E.prototype.cleanUp.call(this),this._pako=null},I.prototype._createPako=function(){this._pako=new S[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var F=this;this._pako.onData=function(z){F.push({data:z,meta:F.meta})}},g.compressWorker=function(F){return new I("Deflate",F)},g.uncompressWorker=function(){return new I("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(c,p,g){function v(R,D){var O,N="";for(O=0;O<D;O++)N+=String.fromCharCode(255&R),R>>>=8;return N}function S(R,D,O,N,H,j){var V,Z,X=R.file,se=R.compression,ge=j!==A.utf8encode,ae=r.transformTo("string",j(X.name)),oe=r.transformTo("string",A.utf8encode(X.name)),fe=X.comment,pe=r.transformTo("string",j(fe)),K=r.transformTo("string",A.utf8encode(fe)),ye=oe.length!==X.name.length,J=K.length!==fe.length,de="",Ae="",ne="",xe=X.dir,Ce=X.date,Re={crc32:0,compressedSize:0,uncompressedSize:0};D&&!O||(Re.crc32=R.crc32,Re.compressedSize=R.compressedSize,Re.uncompressedSize=R.uncompressedSize);var Ee=0;D&&(Ee|=8),ge||!ye&&!J||(Ee|=2048);var Oe=0,Be=0;xe&&(Oe|=16),H==="UNIX"?(Be=798,Oe|=(function(ut,nt){var $e=ut;return ut||($e=nt?16893:33204),(65535&$e)<<16})(X.unixPermissions,xe)):(Be=20,Oe|=(function(ut){return 63&(ut||0)})(X.dosPermissions)),V=Ce.getUTCHours(),V<<=6,V|=Ce.getUTCMinutes(),V<<=5,V|=Ce.getUTCSeconds()/2,Z=Ce.getUTCFullYear()-1980,Z<<=4,Z|=Ce.getUTCMonth()+1,Z<<=5,Z|=Ce.getUTCDate(),ye&&(Ae=v(1,1)+v(I(ae),4)+oe,de+="up"+v(Ae.length,2)+Ae),J&&(ne=v(1,1)+v(I(pe),4)+K,de+="uc"+v(ne.length,2)+ne);var at="";return at+=`
\0`,at+=v(Ee,2),at+=se.magic,at+=v(V,2),at+=v(Z,2),at+=v(Re.crc32,4),at+=v(Re.compressedSize,4),at+=v(Re.uncompressedSize,4),at+=v(ae.length,2),at+=v(de.length,2),{fileRecord:F.LOCAL_FILE_HEADER+at+ae+de,dirRecord:F.CENTRAL_FILE_HEADER+v(Be,2)+at+v(pe.length,2)+"\0\0\0\0"+v(Oe,4)+v(N,4)+ae+de+pe}}var r=c("../utils"),E=c("../stream/GenericWorker"),A=c("../utf8"),I=c("../crc32"),F=c("../signature");function z(R,D,O,N){E.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=D,this.zipPlatform=O,this.encodeFileName=N,this.streamFiles=R,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(z,E),z.prototype.push=function(R){var D=R.meta.percent||0,O=this.entriesCount,N=this._sources.length;this.accumulate?this.contentBuffer.push(R):(this.bytesWritten+=R.data.length,E.prototype.push.call(this,{data:R.data,meta:{currentFile:this.currentFile,percent:O?(D+100*(O-N-1))/O:100}}))},z.prototype.openedSource=function(R){this.currentSourceOffset=this.bytesWritten,this.currentFile=R.file.name;var D=this.streamFiles&&!R.file.dir;if(D){var O=S(R,D,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:O.fileRecord,meta:{percent:0}})}else this.accumulate=!0},z.prototype.closedSource=function(R){this.accumulate=!1;var D=this.streamFiles&&!R.file.dir,O=S(R,D,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(O.dirRecord),D)this.push({data:(function(N){return F.DATA_DESCRIPTOR+v(N.crc32,4)+v(N.compressedSize,4)+v(N.uncompressedSize,4)})(R),meta:{percent:100}});else for(this.push({data:O.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},z.prototype.flush=function(){for(var R=this.bytesWritten,D=0;D<this.dirRecords.length;D++)this.push({data:this.dirRecords[D],meta:{percent:100}});var O=this.bytesWritten-R,N=(function(H,j,V,Z,X){var se=r.transformTo("string",X(Z));return F.CENTRAL_DIRECTORY_END+"\0\0\0\0"+v(H,2)+v(H,2)+v(j,4)+v(V,4)+v(se.length,2)+se})(this.dirRecords.length,O,R,this.zipComment,this.encodeFileName);this.push({data:N,meta:{percent:100}})},z.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},z.prototype.registerPrevious=function(R){this._sources.push(R);var D=this;return R.on("data",function(O){D.processChunk(O)}),R.on("end",function(){D.closedSource(D.previous.streamInfo),D._sources.length?D.prepareNextSource():D.end()}),R.on("error",function(O){D.error(O)}),this},z.prototype.resume=function(){return!!E.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},z.prototype.error=function(R){var D=this._sources;if(!E.prototype.error.call(this,R))return!1;for(var O=0;O<D.length;O++)try{D[O].error(R)}catch{}return!0},z.prototype.lock=function(){E.prototype.lock.call(this);for(var R=this._sources,D=0;D<R.length;D++)R[D].lock()},p.exports=z},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(c,p,g){var v=c("../compressions"),S=c("./ZipFileWorker");g.generateWorker=function(r,E,A){var I=new S(E.streamFiles,A,E.platform,E.encodeFileName),F=0;try{r.forEach(function(z,R){F++;var D=(function(j,V){var Z=j||V,X=v[Z];if(!X)throw new Error(Z+" is not a valid compression method !");return X})(R.options.compression,E.compression),O=R.options.compressionOptions||E.compressionOptions||{},N=R.dir,H=R.date;R._compressWorker(D,O).withStreamInfo("file",{name:z,dir:N,date:H,comment:R.comment||"",unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions}).pipe(I)}),I.entriesCount=F}catch(z){I.error(z)}return I}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(c,p,g){function v(){if(!(this instanceof v))return new v;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var S=new v;for(var r in this)typeof this[r]!="function"&&(S[r]=this[r]);return S}}(v.prototype=c("./object")).loadAsync=c("./load"),v.support=c("./support"),v.defaults=c("./defaults"),v.version="3.10.1",v.loadAsync=function(S,r){return new v().loadAsync(S,r)},v.external=c("./external"),p.exports=v},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(c,p,g){var v=c("./utils"),S=c("./external"),r=c("./utf8"),E=c("./zipEntries"),A=c("./stream/Crc32Probe"),I=c("./nodejsUtils");function F(z){return new S.Promise(function(R,D){var O=z.decompressed.getContentWorker().pipe(new A);O.on("error",function(N){D(N)}).on("end",function(){O.streamInfo.crc32!==z.decompressed.crc32?D(new Error("Corrupted zip : CRC32 mismatch")):R()}).resume()})}p.exports=function(z,R){var D=this;return R=v.extend(R||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),I.isNode&&I.isStream(z)?S.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):v.prepareContent("the loaded zip file",z,!0,R.optimizedBinaryString,R.base64).then(function(O){var N=new E(R);return N.load(O),N}).then(function(O){var N=[S.Promise.resolve(O)],H=O.files;if(R.checkCRC32)for(var j=0;j<H.length;j++)N.push(F(H[j]));return S.Promise.all(N)}).then(function(O){for(var N=O.shift(),H=N.files,j=0;j<H.length;j++){var V=H[j],Z=V.fileNameStr,X=v.resolve(V.fileNameStr);D.file(X,V.decompressed,{binary:!0,optimizedBinaryString:!0,date:V.date,dir:V.dir,comment:V.fileCommentStr.length?V.fileCommentStr:null,unixPermissions:V.unixPermissions,dosPermissions:V.dosPermissions,createFolders:R.createFolders}),V.dir||(D.file(X).unsafeOriginalName=Z)}return N.zipComment.length&&(D.comment=N.zipComment),D})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(c,p,g){var v=c("../utils"),S=c("../stream/GenericWorker");function r(E,A){S.call(this,"Nodejs stream input adapter for "+E),this._upstreamEnded=!1,this._bindStream(A)}v.inherits(r,S),r.prototype._bindStream=function(E){var A=this;(this._stream=E).pause(),E.on("data",function(I){A.push({data:I,meta:{percent:0}})}).on("error",function(I){A.isPaused?this.generatedError=I:A.error(I)}).on("end",function(){A.isPaused?A._upstreamEnded=!0:A.end()})},r.prototype.pause=function(){return!!S.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!S.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},p.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(c,p,g){var v=c("readable-stream").Readable;function S(r,E,A){v.call(this,E),this._helper=r;var I=this;r.on("data",function(F,z){I.push(F)||I._helper.pause(),A&&A(z)}).on("error",function(F){I.emit("error",F)}).on("end",function(){I.push(null)})}c("../utils").inherits(S,v),S.prototype._read=function(){this._helper.resume()},p.exports=S},{"../utils":32,"readable-stream":16}],14:[function(c,p,g){p.exports={isNode:typeof Buffer<"u",newBufferFrom:function(v,S){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(v,S);if(typeof v=="number")throw new Error('The "data" argument must not be a number');return new Buffer(v,S)},allocBuffer:function(v){if(Buffer.alloc)return Buffer.alloc(v);var S=new Buffer(v);return S.fill(0),S},isBuffer:function(v){return Buffer.isBuffer(v)},isStream:function(v){return v&&typeof v.on=="function"&&typeof v.pause=="function"&&typeof v.resume=="function"}}},{}],15:[function(c,p,g){function v(X,se,ge){var ae,oe=r.getTypeOf(se),fe=r.extend(ge||{},I);fe.date=fe.date||new Date,fe.compression!==null&&(fe.compression=fe.compression.toUpperCase()),typeof fe.unixPermissions=="string"&&(fe.unixPermissions=parseInt(fe.unixPermissions,8)),fe.unixPermissions&&16384&fe.unixPermissions&&(fe.dir=!0),fe.dosPermissions&&16&fe.dosPermissions&&(fe.dir=!0),fe.dir&&(X=H(X)),fe.createFolders&&(ae=N(X))&&j.call(this,ae,!0);var pe=oe==="string"&&fe.binary===!1&&fe.base64===!1;ge&&ge.binary!==void 0||(fe.binary=!pe),(se instanceof F&&se.uncompressedSize===0||fe.dir||!se||se.length===0)&&(fe.base64=!1,fe.binary=!0,se="",fe.compression="STORE",oe="string");var K=null;K=se instanceof F||se instanceof E?se:D.isNode&&D.isStream(se)?new O(X,se):r.prepareContent(X,se,fe.binary,fe.optimizedBinaryString,fe.base64);var ye=new z(X,K,fe);this.files[X]=ye}var S=c("./utf8"),r=c("./utils"),E=c("./stream/GenericWorker"),A=c("./stream/StreamHelper"),I=c("./defaults"),F=c("./compressedObject"),z=c("./zipObject"),R=c("./generate"),D=c("./nodejsUtils"),O=c("./nodejs/NodejsStreamInputAdapter"),N=function(X){X.slice(-1)==="/"&&(X=X.substring(0,X.length-1));var se=X.lastIndexOf("/");return 0<se?X.substring(0,se):""},H=function(X){return X.slice(-1)!=="/"&&(X+="/"),X},j=function(X,se){return se=se!==void 0?se:I.createFolders,X=H(X),this.files[X]||v.call(this,X,null,{dir:!0,createFolders:se}),this.files[X]};function V(X){return Object.prototype.toString.call(X)==="[object RegExp]"}var Z={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(X){var se,ge,ae;for(se in this.files)ae=this.files[se],(ge=se.slice(this.root.length,se.length))&&se.slice(0,this.root.length)===this.root&&X(ge,ae)},filter:function(X){var se=[];return this.forEach(function(ge,ae){X(ge,ae)&&se.push(ae)}),se},file:function(X,se,ge){if(arguments.length!==1)return X=this.root+X,v.call(this,X,se,ge),this;if(V(X)){var ae=X;return this.filter(function(fe,pe){return!pe.dir&&ae.test(fe)})}var oe=this.files[this.root+X];return oe&&!oe.dir?oe:null},folder:function(X){if(!X)return this;if(V(X))return this.filter(function(oe,fe){return fe.dir&&X.test(oe)});var se=this.root+X,ge=j.call(this,se),ae=this.clone();return ae.root=ge.name,ae},remove:function(X){X=this.root+X;var se=this.files[X];if(se||(X.slice(-1)!=="/"&&(X+="/"),se=this.files[X]),se&&!se.dir)delete this.files[X];else for(var ge=this.filter(function(oe,fe){return fe.name.slice(0,X.length)===X}),ae=0;ae<ge.length;ae++)delete this.files[ge[ae].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(X){var se,ge={};try{if((ge=r.extend(X||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:S.utf8encode})).type=ge.type.toLowerCase(),ge.compression=ge.compression.toUpperCase(),ge.type==="binarystring"&&(ge.type="string"),!ge.type)throw new Error("No output type specified.");r.checkSupport(ge.type),ge.platform!=="darwin"&&ge.platform!=="freebsd"&&ge.platform!=="linux"&&ge.platform!=="sunos"||(ge.platform="UNIX"),ge.platform==="win32"&&(ge.platform="DOS");var ae=ge.comment||this.comment||"";se=R.generateWorker(this,ge,ae)}catch(oe){(se=new E("error")).error(oe)}return new A(se,ge.type||"string",ge.mimeType)},generateAsync:function(X,se){return this.generateInternalStream(X).accumulate(se)},generateNodeStream:function(X,se){return(X=X||{}).type||(X.type="nodebuffer"),this.generateInternalStream(X).toNodejsStream(se)}};p.exports=Z},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(c,p,g){p.exports=c("stream")},{stream:void 0}],17:[function(c,p,g){var v=c("./DataReader");function S(r){v.call(this,r);for(var E=0;E<this.data.length;E++)r[E]=255&r[E]}c("../utils").inherits(S,v),S.prototype.byteAt=function(r){return this.data[this.zero+r]},S.prototype.lastIndexOfSignature=function(r){for(var E=r.charCodeAt(0),A=r.charCodeAt(1),I=r.charCodeAt(2),F=r.charCodeAt(3),z=this.length-4;0<=z;--z)if(this.data[z]===E&&this.data[z+1]===A&&this.data[z+2]===I&&this.data[z+3]===F)return z-this.zero;return-1},S.prototype.readAndCheckSignature=function(r){var E=r.charCodeAt(0),A=r.charCodeAt(1),I=r.charCodeAt(2),F=r.charCodeAt(3),z=this.readData(4);return E===z[0]&&A===z[1]&&I===z[2]&&F===z[3]},S.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var E=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,E},p.exports=S},{"../utils":32,"./DataReader":18}],18:[function(c,p,g){var v=c("../utils");function S(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}S.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var E,A=0;for(this.checkOffset(r),E=this.index+r-1;E>=this.index;E--)A=(A<<8)+this.byteAt(E);return this.index+=r,A},readString:function(r){return v.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},p.exports=S},{"../utils":32}],19:[function(c,p,g){var v=c("./Uint8ArrayReader");function S(r){v.call(this,r)}c("../utils").inherits(S,v),S.prototype.readData=function(r){this.checkOffset(r);var E=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,E},p.exports=S},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(c,p,g){var v=c("./DataReader");function S(r){v.call(this,r)}c("../utils").inherits(S,v),S.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},S.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},S.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},S.prototype.readData=function(r){this.checkOffset(r);var E=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,E},p.exports=S},{"../utils":32,"./DataReader":18}],21:[function(c,p,g){var v=c("./ArrayReader");function S(r){v.call(this,r)}c("../utils").inherits(S,v),S.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var E=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,E},p.exports=S},{"../utils":32,"./ArrayReader":17}],22:[function(c,p,g){var v=c("../utils"),S=c("../support"),r=c("./ArrayReader"),E=c("./StringReader"),A=c("./NodeBufferReader"),I=c("./Uint8ArrayReader");p.exports=function(F){var z=v.getTypeOf(F);return v.checkSupport(z),z!=="string"||S.uint8array?z==="nodebuffer"?new A(F):S.uint8array?new I(v.transformTo("uint8array",F)):new r(v.transformTo("array",F)):new E(F)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(c,p,g){g.LOCAL_FILE_HEADER="PK",g.CENTRAL_FILE_HEADER="PK",g.CENTRAL_DIRECTORY_END="PK",g.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",g.ZIP64_CENTRAL_DIRECTORY_END="PK",g.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(c,p,g){var v=c("./GenericWorker"),S=c("../utils");function r(E){v.call(this,"ConvertWorker to "+E),this.destType=E}S.inherits(r,v),r.prototype.processChunk=function(E){this.push({data:S.transformTo(this.destType,E.data),meta:E.meta})},p.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(c,p,g){var v=c("./GenericWorker"),S=c("../crc32");function r(){v.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}c("../utils").inherits(r,v),r.prototype.processChunk=function(E){this.streamInfo.crc32=S(E.data,this.streamInfo.crc32||0),this.push(E)},p.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(c,p,g){var v=c("../utils"),S=c("./GenericWorker");function r(E){S.call(this,"DataLengthProbe for "+E),this.propName=E,this.withStreamInfo(E,0)}v.inherits(r,S),r.prototype.processChunk=function(E){if(E){var A=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=A+E.data.length}S.prototype.processChunk.call(this,E)},p.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(c,p,g){var v=c("../utils"),S=c("./GenericWorker");function r(E){S.call(this,"DataWorker");var A=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,E.then(function(I){A.dataIsReady=!0,A.data=I,A.max=I&&I.length||0,A.type=v.getTypeOf(I),A.isPaused||A._tickAndRepeat()},function(I){A.error(I)})}v.inherits(r,S),r.prototype.cleanUp=function(){S.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!S.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,v.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(v.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var E=null,A=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":E=this.data.substring(this.index,A);break;case"uint8array":E=this.data.subarray(this.index,A);break;case"array":case"nodebuffer":E=this.data.slice(this.index,A)}return this.index=A,this.push({data:E,meta:{percent:this.max?this.index/this.max*100:0}})},p.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(c,p,g){function v(S){this.name=S||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}v.prototype={push:function(S){this.emit("data",S)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(S){this.emit("error",S)}return!0},error:function(S){return!this.isFinished&&(this.isPaused?this.generatedError=S:(this.isFinished=!0,this.emit("error",S),this.previous&&this.previous.error(S),this.cleanUp()),!0)},on:function(S,r){return this._listeners[S].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(S,r){if(this._listeners[S])for(var E=0;E<this._listeners[S].length;E++)this._listeners[S][E].call(this,r)},pipe:function(S){return S.registerPrevious(this)},registerPrevious:function(S){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=S.streamInfo,this.mergeStreamInfo(),this.previous=S;var r=this;return S.on("data",function(E){r.processChunk(E)}),S.on("end",function(){r.end()}),S.on("error",function(E){r.error(E)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var S=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),S=!0),this.previous&&this.previous.resume(),!S},flush:function(){},processChunk:function(S){this.push(S)},withStreamInfo:function(S,r){return this.extraStreamInfo[S]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var S in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,S)&&(this.streamInfo[S]=this.extraStreamInfo[S])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var S="Worker "+this.name;return this.previous?this.previous+" -> "+S:S}},p.exports=v},{}],29:[function(c,p,g){var v=c("../utils"),S=c("./ConvertWorker"),r=c("./GenericWorker"),E=c("../base64"),A=c("../support"),I=c("../external"),F=null;if(A.nodestream)try{F=c("../nodejs/NodejsStreamOutputAdapter")}catch{}function z(D,O){return new I.Promise(function(N,H){var j=[],V=D._internalType,Z=D._outputType,X=D._mimeType;D.on("data",function(se,ge){j.push(se),O&&O(ge)}).on("error",function(se){j=[],H(se)}).on("end",function(){try{var se=(function(ge,ae,oe){switch(ge){case"blob":return v.newBlob(v.transformTo("arraybuffer",ae),oe);case"base64":return E.encode(ae);default:return v.transformTo(ge,ae)}})(Z,(function(ge,ae){var oe,fe=0,pe=null,K=0;for(oe=0;oe<ae.length;oe++)K+=ae[oe].length;switch(ge){case"string":return ae.join("");case"array":return Array.prototype.concat.apply([],ae);case"uint8array":for(pe=new Uint8Array(K),oe=0;oe<ae.length;oe++)pe.set(ae[oe],fe),fe+=ae[oe].length;return pe;case"nodebuffer":return Buffer.concat(ae);default:throw new Error("concat : unsupported type '"+ge+"'")}})(V,j),X);N(se)}catch(ge){H(ge)}j=[]}).resume()})}function R(D,O,N){var H=O;switch(O){case"blob":case"arraybuffer":H="uint8array";break;case"base64":H="string"}try{this._internalType=H,this._outputType=O,this._mimeType=N,v.checkSupport(H),this._worker=D.pipe(new S(H)),D.lock()}catch(j){this._worker=new r("error"),this._worker.error(j)}}R.prototype={accumulate:function(D){return z(this,D)},on:function(D,O){var N=this;return D==="data"?this._worker.on(D,function(H){O.call(N,H.data,H.meta)}):this._worker.on(D,function(){v.delay(O,arguments,N)}),this},resume:function(){return v.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(D){if(v.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new F(this,{objectMode:this._outputType!=="nodebuffer"},D)}},p.exports=R},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(c,p,g){if(g.base64=!0,g.array=!0,g.string=!0,g.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",g.nodebuffer=typeof Buffer<"u",g.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")g.blob=!1;else{var v=new ArrayBuffer(0);try{g.blob=new Blob([v],{type:"application/zip"}).size===0}catch{try{var S=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);S.append(v),g.blob=S.getBlob("application/zip").size===0}catch{g.blob=!1}}}try{g.nodestream=!!c("readable-stream").Readable}catch{g.nodestream=!1}},{"readable-stream":16}],31:[function(c,p,g){for(var v=c("./utils"),S=c("./support"),r=c("./nodejsUtils"),E=c("./stream/GenericWorker"),A=new Array(256),I=0;I<256;I++)A[I]=252<=I?6:248<=I?5:240<=I?4:224<=I?3:192<=I?2:1;A[254]=A[254]=1;function F(){E.call(this,"utf-8 decode"),this.leftOver=null}function z(){E.call(this,"utf-8 encode")}g.utf8encode=function(R){return S.nodebuffer?r.newBufferFrom(R,"utf-8"):(function(D){var O,N,H,j,V,Z=D.length,X=0;for(j=0;j<Z;j++)(64512&(N=D.charCodeAt(j)))==55296&&j+1<Z&&(64512&(H=D.charCodeAt(j+1)))==56320&&(N=65536+(N-55296<<10)+(H-56320),j++),X+=N<128?1:N<2048?2:N<65536?3:4;for(O=S.uint8array?new Uint8Array(X):new Array(X),j=V=0;V<X;j++)(64512&(N=D.charCodeAt(j)))==55296&&j+1<Z&&(64512&(H=D.charCodeAt(j+1)))==56320&&(N=65536+(N-55296<<10)+(H-56320),j++),N<128?O[V++]=N:(N<2048?O[V++]=192|N>>>6:(N<65536?O[V++]=224|N>>>12:(O[V++]=240|N>>>18,O[V++]=128|N>>>12&63),O[V++]=128|N>>>6&63),O[V++]=128|63&N);return O})(R)},g.utf8decode=function(R){return S.nodebuffer?v.transformTo("nodebuffer",R).toString("utf-8"):(function(D){var O,N,H,j,V=D.length,Z=new Array(2*V);for(O=N=0;O<V;)if((H=D[O++])<128)Z[N++]=H;else if(4<(j=A[H]))Z[N++]=65533,O+=j-1;else{for(H&=j===2?31:j===3?15:7;1<j&&O<V;)H=H<<6|63&D[O++],j--;1<j?Z[N++]=65533:H<65536?Z[N++]=H:(H-=65536,Z[N++]=55296|H>>10&1023,Z[N++]=56320|1023&H)}return Z.length!==N&&(Z.subarray?Z=Z.subarray(0,N):Z.length=N),v.applyFromCharCode(Z)})(R=v.transformTo(S.uint8array?"uint8array":"array",R))},v.inherits(F,E),F.prototype.processChunk=function(R){var D=v.transformTo(S.uint8array?"uint8array":"array",R.data);if(this.leftOver&&this.leftOver.length){if(S.uint8array){var O=D;(D=new Uint8Array(O.length+this.leftOver.length)).set(this.leftOver,0),D.set(O,this.leftOver.length)}else D=this.leftOver.concat(D);this.leftOver=null}var N=(function(j,V){var Z;for((V=V||j.length)>j.length&&(V=j.length),Z=V-1;0<=Z&&(192&j[Z])==128;)Z--;return Z<0||Z===0?V:Z+A[j[Z]]>V?Z:V})(D),H=D;N!==D.length&&(S.uint8array?(H=D.subarray(0,N),this.leftOver=D.subarray(N,D.length)):(H=D.slice(0,N),this.leftOver=D.slice(N,D.length))),this.push({data:g.utf8decode(H),meta:R.meta})},F.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:g.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},g.Utf8DecodeWorker=F,v.inherits(z,E),z.prototype.processChunk=function(R){this.push({data:g.utf8encode(R.data),meta:R.meta})},g.Utf8EncodeWorker=z},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(c,p,g){var v=c("./support"),S=c("./base64"),r=c("./nodejsUtils"),E=c("./external");function A(O){return O}function I(O,N){for(var H=0;H<O.length;++H)N[H]=255&O.charCodeAt(H);return N}c("setimmediate"),g.newBlob=function(O,N){g.checkSupport("blob");try{return new Blob([O],{type:N})}catch{try{var H=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return H.append(O),H.getBlob(N)}catch{throw new Error("Bug : can't construct the Blob.")}}};var F={stringifyByChunk:function(O,N,H){var j=[],V=0,Z=O.length;if(Z<=H)return String.fromCharCode.apply(null,O);for(;V<Z;)N==="array"||N==="nodebuffer"?j.push(String.fromCharCode.apply(null,O.slice(V,Math.min(V+H,Z)))):j.push(String.fromCharCode.apply(null,O.subarray(V,Math.min(V+H,Z)))),V+=H;return j.join("")},stringifyByChar:function(O){for(var N="",H=0;H<O.length;H++)N+=String.fromCharCode(O[H]);return N},applyCanBeUsed:{uint8array:(function(){try{return v.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return v.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function z(O){var N=65536,H=g.getTypeOf(O),j=!0;if(H==="uint8array"?j=F.applyCanBeUsed.uint8array:H==="nodebuffer"&&(j=F.applyCanBeUsed.nodebuffer),j)for(;1<N;)try{return F.stringifyByChunk(O,H,N)}catch{N=Math.floor(N/2)}return F.stringifyByChar(O)}function R(O,N){for(var H=0;H<O.length;H++)N[H]=O[H];return N}g.applyFromCharCode=z;var D={};D.string={string:A,array:function(O){return I(O,new Array(O.length))},arraybuffer:function(O){return D.string.uint8array(O).buffer},uint8array:function(O){return I(O,new Uint8Array(O.length))},nodebuffer:function(O){return I(O,r.allocBuffer(O.length))}},D.array={string:z,array:A,arraybuffer:function(O){return new Uint8Array(O).buffer},uint8array:function(O){return new Uint8Array(O)},nodebuffer:function(O){return r.newBufferFrom(O)}},D.arraybuffer={string:function(O){return z(new Uint8Array(O))},array:function(O){return R(new Uint8Array(O),new Array(O.byteLength))},arraybuffer:A,uint8array:function(O){return new Uint8Array(O)},nodebuffer:function(O){return r.newBufferFrom(new Uint8Array(O))}},D.uint8array={string:z,array:function(O){return R(O,new Array(O.length))},arraybuffer:function(O){return O.buffer},uint8array:A,nodebuffer:function(O){return r.newBufferFrom(O)}},D.nodebuffer={string:z,array:function(O){return R(O,new Array(O.length))},arraybuffer:function(O){return D.nodebuffer.uint8array(O).buffer},uint8array:function(O){return R(O,new Uint8Array(O.length))},nodebuffer:A},g.transformTo=function(O,N){if(N=N||"",!O)return N;g.checkSupport(O);var H=g.getTypeOf(N);return D[H][O](N)},g.resolve=function(O){for(var N=O.split("/"),H=[],j=0;j<N.length;j++){var V=N[j];V==="."||V===""&&j!==0&&j!==N.length-1||(V===".."?H.pop():H.push(V))}return H.join("/")},g.getTypeOf=function(O){return typeof O=="string"?"string":Object.prototype.toString.call(O)==="[object Array]"?"array":v.nodebuffer&&r.isBuffer(O)?"nodebuffer":v.uint8array&&O instanceof Uint8Array?"uint8array":v.arraybuffer&&O instanceof ArrayBuffer?"arraybuffer":void 0},g.checkSupport=function(O){if(!v[O.toLowerCase()])throw new Error(O+" is not supported by this platform")},g.MAX_VALUE_16BITS=65535,g.MAX_VALUE_32BITS=-1,g.pretty=function(O){var N,H,j="";for(H=0;H<(O||"").length;H++)j+="\\x"+((N=O.charCodeAt(H))<16?"0":"")+N.toString(16).toUpperCase();return j},g.delay=function(O,N,H){setImmediate(function(){O.apply(H||null,N||[])})},g.inherits=function(O,N){function H(){}H.prototype=N.prototype,O.prototype=new H},g.extend=function(){var O,N,H={};for(O=0;O<arguments.length;O++)for(N in arguments[O])Object.prototype.hasOwnProperty.call(arguments[O],N)&&H[N]===void 0&&(H[N]=arguments[O][N]);return H},g.prepareContent=function(O,N,H,j,V){return E.Promise.resolve(N).then(function(Z){return v.blob&&(Z instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(Z))!==-1)&&typeof FileReader<"u"?new E.Promise(function(X,se){var ge=new FileReader;ge.onload=function(ae){X(ae.target.result)},ge.onerror=function(ae){se(ae.target.error)},ge.readAsArrayBuffer(Z)}):Z}).then(function(Z){var X=g.getTypeOf(Z);return X?(X==="arraybuffer"?Z=g.transformTo("uint8array",Z):X==="string"&&(V?Z=S.decode(Z):H&&j!==!0&&(Z=(function(se){return I(se,v.uint8array?new Uint8Array(se.length):new Array(se.length))})(Z))),Z):E.Promise.reject(new Error("Can't read the data of '"+O+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(c,p,g){var v=c("./reader/readerFor"),S=c("./utils"),r=c("./signature"),E=c("./zipEntry"),A=c("./support");function I(F){this.files=[],this.loadOptions=F}I.prototype={checkSignature:function(F){if(!this.reader.readAndCheckSignature(F)){this.reader.index-=4;var z=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+S.pretty(z)+", expected "+S.pretty(F)+")")}},isSignature:function(F,z){var R=this.reader.index;this.reader.setIndex(F);var D=this.reader.readString(4)===z;return this.reader.setIndex(R),D},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var F=this.reader.readData(this.zipCommentLength),z=A.uint8array?"uint8array":"array",R=S.transformTo(z,F);this.zipComment=this.loadOptions.decodeFileName(R)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var F,z,R,D=this.zip64EndOfCentralSize-44;0<D;)F=this.reader.readInt(2),z=this.reader.readInt(4),R=this.reader.readData(z),this.zip64ExtensibleData[F]={id:F,length:z,value:R}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var F,z;for(F=0;F<this.files.length;F++)z=this.files[F],this.reader.setIndex(z.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),z.readLocalPart(this.reader),z.handleUTF8(),z.processAttributes()},readCentralDir:function(){var F;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(F=new E({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(F);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var F=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(F<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(F);var z=F;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===S.MAX_VALUE_16BITS||this.diskWithCentralDirStart===S.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===S.MAX_VALUE_16BITS||this.centralDirRecords===S.MAX_VALUE_16BITS||this.centralDirSize===S.MAX_VALUE_32BITS||this.centralDirOffset===S.MAX_VALUE_32BITS){if(this.zip64=!0,(F=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(F),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var R=this.centralDirOffset+this.centralDirSize;this.zip64&&(R+=20,R+=12+this.zip64EndOfCentralSize);var D=z-R;if(0<D)this.isSignature(z,r.CENTRAL_FILE_HEADER)||(this.reader.zero=D);else if(D<0)throw new Error("Corrupted zip: missing "+Math.abs(D)+" bytes.")},prepareReader:function(F){this.reader=v(F)},load:function(F){this.prepareReader(F),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},p.exports=I},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(c,p,g){var v=c("./reader/readerFor"),S=c("./utils"),r=c("./compressedObject"),E=c("./crc32"),A=c("./utf8"),I=c("./compressions"),F=c("./support");function z(R,D){this.options=R,this.loadOptions=D}z.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(R){var D,O;if(R.skip(22),this.fileNameLength=R.readInt(2),O=R.readInt(2),this.fileName=R.readData(this.fileNameLength),R.skip(O),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((D=(function(N){for(var H in I)if(Object.prototype.hasOwnProperty.call(I,H)&&I[H].magic===N)return I[H];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+S.pretty(this.compressionMethod)+" unknown (inner file : "+S.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,D,R.readData(this.compressedSize))},readCentralPart:function(R){this.versionMadeBy=R.readInt(2),R.skip(2),this.bitFlag=R.readInt(2),this.compressionMethod=R.readString(2),this.date=R.readDate(),this.crc32=R.readInt(4),this.compressedSize=R.readInt(4),this.uncompressedSize=R.readInt(4);var D=R.readInt(2);if(this.extraFieldsLength=R.readInt(2),this.fileCommentLength=R.readInt(2),this.diskNumberStart=R.readInt(2),this.internalFileAttributes=R.readInt(2),this.externalFileAttributes=R.readInt(4),this.localHeaderOffset=R.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");R.skip(D),this.readExtraFields(R),this.parseZIP64ExtraField(R),this.fileComment=R.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var R=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),R==0&&(this.dosPermissions=63&this.externalFileAttributes),R==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var R=v(this.extraFields[1].value);this.uncompressedSize===S.MAX_VALUE_32BITS&&(this.uncompressedSize=R.readInt(8)),this.compressedSize===S.MAX_VALUE_32BITS&&(this.compressedSize=R.readInt(8)),this.localHeaderOffset===S.MAX_VALUE_32BITS&&(this.localHeaderOffset=R.readInt(8)),this.diskNumberStart===S.MAX_VALUE_32BITS&&(this.diskNumberStart=R.readInt(4))}},readExtraFields:function(R){var D,O,N,H=R.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});R.index+4<H;)D=R.readInt(2),O=R.readInt(2),N=R.readData(O),this.extraFields[D]={id:D,length:O,value:N};R.setIndex(H)},handleUTF8:function(){var R=F.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=A.utf8decode(this.fileName),this.fileCommentStr=A.utf8decode(this.fileComment);else{var D=this.findExtraFieldUnicodePath();if(D!==null)this.fileNameStr=D;else{var O=S.transformTo(R,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(O)}var N=this.findExtraFieldUnicodeComment();if(N!==null)this.fileCommentStr=N;else{var H=S.transformTo(R,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(H)}}},findExtraFieldUnicodePath:function(){var R=this.extraFields[28789];if(R){var D=v(R.value);return D.readInt(1)!==1||E(this.fileName)!==D.readInt(4)?null:A.utf8decode(D.readData(R.length-5))}return null},findExtraFieldUnicodeComment:function(){var R=this.extraFields[25461];if(R){var D=v(R.value);return D.readInt(1)!==1||E(this.fileComment)!==D.readInt(4)?null:A.utf8decode(D.readData(R.length-5))}return null}},p.exports=z},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(c,p,g){function v(D,O,N){this.name=D,this.dir=N.dir,this.date=N.date,this.comment=N.comment,this.unixPermissions=N.unixPermissions,this.dosPermissions=N.dosPermissions,this._data=O,this._dataBinary=N.binary,this.options={compression:N.compression,compressionOptions:N.compressionOptions}}var S=c("./stream/StreamHelper"),r=c("./stream/DataWorker"),E=c("./utf8"),A=c("./compressedObject"),I=c("./stream/GenericWorker");v.prototype={internalStream:function(D){var O=null,N="string";try{if(!D)throw new Error("No output type specified.");var H=(N=D.toLowerCase())==="string"||N==="text";N!=="binarystring"&&N!=="text"||(N="string"),O=this._decompressWorker();var j=!this._dataBinary;j&&!H&&(O=O.pipe(new E.Utf8EncodeWorker)),!j&&H&&(O=O.pipe(new E.Utf8DecodeWorker))}catch(V){(O=new I("error")).error(V)}return new S(O,N,"")},async:function(D,O){return this.internalStream(D).accumulate(O)},nodeStream:function(D,O){return this.internalStream(D||"nodebuffer").toNodejsStream(O)},_compressWorker:function(D,O){if(this._data instanceof A&&this._data.compression.magic===D.magic)return this._data.getCompressedWorker();var N=this._decompressWorker();return this._dataBinary||(N=N.pipe(new E.Utf8EncodeWorker)),A.createWorkerFrom(N,D,O)},_decompressWorker:function(){return this._data instanceof A?this._data.getContentWorker():this._data instanceof I?this._data:new r(this._data)}};for(var F=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],z=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},R=0;R<F.length;R++)v.prototype[F[R]]=z;p.exports=v},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(c,p,g){(function(v){var S,r,E=v.MutationObserver||v.WebKitMutationObserver;if(E){var A=0,I=new E(D),F=v.document.createTextNode("");I.observe(F,{characterData:!0}),S=function(){F.data=A=++A%2}}else if(v.setImmediate||v.MessageChannel===void 0)S="document"in v&&"onreadystatechange"in v.document.createElement("script")?function(){var O=v.document.createElement("script");O.onreadystatechange=function(){D(),O.onreadystatechange=null,O.parentNode.removeChild(O),O=null},v.document.documentElement.appendChild(O)}:function(){setTimeout(D,0)};else{var z=new v.MessageChannel;z.port1.onmessage=D,S=function(){z.port2.postMessage(0)}}var R=[];function D(){var O,N;r=!0;for(var H=R.length;H;){for(N=R,R=[],O=-1;++O<H;)N[O]();H=R.length}r=!1}p.exports=function(O){R.push(O)!==1||r||S()}}).call(this,typeof Jg<"u"?Jg:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(c,p,g){var v=c("immediate");function S(){}var r={},E=["REJECTED"],A=["FULFILLED"],I=["PENDING"];function F(H){if(typeof H!="function")throw new TypeError("resolver must be a function");this.state=I,this.queue=[],this.outcome=void 0,H!==S&&O(this,H)}function z(H,j,V){this.promise=H,typeof j=="function"&&(this.onFulfilled=j,this.callFulfilled=this.otherCallFulfilled),typeof V=="function"&&(this.onRejected=V,this.callRejected=this.otherCallRejected)}function R(H,j,V){v(function(){var Z;try{Z=j(V)}catch(X){return r.reject(H,X)}Z===H?r.reject(H,new TypeError("Cannot resolve promise with itself")):r.resolve(H,Z)})}function D(H){var j=H&&H.then;if(H&&(typeof H=="object"||typeof H=="function")&&typeof j=="function")return function(){j.apply(H,arguments)}}function O(H,j){var V=!1;function Z(ge){V||(V=!0,r.reject(H,ge))}function X(ge){V||(V=!0,r.resolve(H,ge))}var se=N(function(){j(X,Z)});se.status==="error"&&Z(se.value)}function N(H,j){var V={};try{V.value=H(j),V.status="success"}catch(Z){V.status="error",V.value=Z}return V}(p.exports=F).prototype.finally=function(H){if(typeof H!="function")return this;var j=this.constructor;return this.then(function(V){return j.resolve(H()).then(function(){return V})},function(V){return j.resolve(H()).then(function(){throw V})})},F.prototype.catch=function(H){return this.then(null,H)},F.prototype.then=function(H,j){if(typeof H!="function"&&this.state===A||typeof j!="function"&&this.state===E)return this;var V=new this.constructor(S);return this.state!==I?R(V,this.state===A?H:j,this.outcome):this.queue.push(new z(V,H,j)),V},z.prototype.callFulfilled=function(H){r.resolve(this.promise,H)},z.prototype.otherCallFulfilled=function(H){R(this.promise,this.onFulfilled,H)},z.prototype.callRejected=function(H){r.reject(this.promise,H)},z.prototype.otherCallRejected=function(H){R(this.promise,this.onRejected,H)},r.resolve=function(H,j){var V=N(D,j);if(V.status==="error")return r.reject(H,V.value);var Z=V.value;if(Z)O(H,Z);else{H.state=A,H.outcome=j;for(var X=-1,se=H.queue.length;++X<se;)H.queue[X].callFulfilled(j)}return H},r.reject=function(H,j){H.state=E,H.outcome=j;for(var V=-1,Z=H.queue.length;++V<Z;)H.queue[V].callRejected(j);return H},F.resolve=function(H){return H instanceof this?H:r.resolve(new this(S),H)},F.reject=function(H){var j=new this(S);return r.reject(j,H)},F.all=function(H){var j=this;if(Object.prototype.toString.call(H)!=="[object Array]")return this.reject(new TypeError("must be an array"));var V=H.length,Z=!1;if(!V)return this.resolve([]);for(var X=new Array(V),se=0,ge=-1,ae=new this(S);++ge<V;)oe(H[ge],ge);return ae;function oe(fe,pe){j.resolve(fe).then(function(K){X[pe]=K,++se!==V||Z||(Z=!0,r.resolve(ae,X))},function(K){Z||(Z=!0,r.reject(ae,K))})}},F.race=function(H){var j=this;if(Object.prototype.toString.call(H)!=="[object Array]")return this.reject(new TypeError("must be an array"));var V=H.length,Z=!1;if(!V)return this.resolve([]);for(var X=-1,se=new this(S);++X<V;)ge=H[X],j.resolve(ge).then(function(ae){Z||(Z=!0,r.resolve(se,ae))},function(ae){Z||(Z=!0,r.reject(se,ae))});var ge;return se}},{immediate:36}],38:[function(c,p,g){var v={};(0,c("./lib/utils/common").assign)(v,c("./lib/deflate"),c("./lib/inflate"),c("./lib/zlib/constants")),p.exports=v},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(c,p,g){var v=c("./zlib/deflate"),S=c("./utils/common"),r=c("./utils/strings"),E=c("./zlib/messages"),A=c("./zlib/zstream"),I=Object.prototype.toString,F=0,z=-1,R=0,D=8;function O(H){if(!(this instanceof O))return new O(H);this.options=S.assign({level:z,method:D,chunkSize:16384,windowBits:15,memLevel:8,strategy:R,to:""},H||{});var j=this.options;j.raw&&0<j.windowBits?j.windowBits=-j.windowBits:j.gzip&&0<j.windowBits&&j.windowBits<16&&(j.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;var V=v.deflateInit2(this.strm,j.level,j.method,j.windowBits,j.memLevel,j.strategy);if(V!==F)throw new Error(E[V]);if(j.header&&v.deflateSetHeader(this.strm,j.header),j.dictionary){var Z;if(Z=typeof j.dictionary=="string"?r.string2buf(j.dictionary):I.call(j.dictionary)==="[object ArrayBuffer]"?new Uint8Array(j.dictionary):j.dictionary,(V=v.deflateSetDictionary(this.strm,Z))!==F)throw new Error(E[V]);this._dict_set=!0}}function N(H,j){var V=new O(j);if(V.push(H,!0),V.err)throw V.msg||E[V.err];return V.result}O.prototype.push=function(H,j){var V,Z,X=this.strm,se=this.options.chunkSize;if(this.ended)return!1;Z=j===~~j?j:j===!0?4:0,typeof H=="string"?X.input=r.string2buf(H):I.call(H)==="[object ArrayBuffer]"?X.input=new Uint8Array(H):X.input=H,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new S.Buf8(se),X.next_out=0,X.avail_out=se),(V=v.deflate(X,Z))!==1&&V!==F)return this.onEnd(V),!(this.ended=!0);X.avail_out!==0&&(X.avail_in!==0||Z!==4&&Z!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(S.shrinkBuf(X.output,X.next_out))):this.onData(S.shrinkBuf(X.output,X.next_out)))}while((0<X.avail_in||X.avail_out===0)&&V!==1);return Z===4?(V=v.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===F):Z!==2||(this.onEnd(F),!(X.avail_out=0))},O.prototype.onData=function(H){this.chunks.push(H)},O.prototype.onEnd=function(H){H===F&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},g.Deflate=O,g.deflate=N,g.deflateRaw=function(H,j){return(j=j||{}).raw=!0,N(H,j)},g.gzip=function(H,j){return(j=j||{}).gzip=!0,N(H,j)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(c,p,g){var v=c("./zlib/inflate"),S=c("./utils/common"),r=c("./utils/strings"),E=c("./zlib/constants"),A=c("./zlib/messages"),I=c("./zlib/zstream"),F=c("./zlib/gzheader"),z=Object.prototype.toString;function R(O){if(!(this instanceof R))return new R(O);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},O||{});var N=this.options;N.raw&&0<=N.windowBits&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),!(0<=N.windowBits&&N.windowBits<16)||O&&O.windowBits||(N.windowBits+=32),15<N.windowBits&&N.windowBits<48&&(15&N.windowBits)==0&&(N.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var H=v.inflateInit2(this.strm,N.windowBits);if(H!==E.Z_OK)throw new Error(A[H]);this.header=new F,v.inflateGetHeader(this.strm,this.header)}function D(O,N){var H=new R(N);if(H.push(O,!0),H.err)throw H.msg||A[H.err];return H.result}R.prototype.push=function(O,N){var H,j,V,Z,X,se,ge=this.strm,ae=this.options.chunkSize,oe=this.options.dictionary,fe=!1;if(this.ended)return!1;j=N===~~N?N:N===!0?E.Z_FINISH:E.Z_NO_FLUSH,typeof O=="string"?ge.input=r.binstring2buf(O):z.call(O)==="[object ArrayBuffer]"?ge.input=new Uint8Array(O):ge.input=O,ge.next_in=0,ge.avail_in=ge.input.length;do{if(ge.avail_out===0&&(ge.output=new S.Buf8(ae),ge.next_out=0,ge.avail_out=ae),(H=v.inflate(ge,E.Z_NO_FLUSH))===E.Z_NEED_DICT&&oe&&(se=typeof oe=="string"?r.string2buf(oe):z.call(oe)==="[object ArrayBuffer]"?new Uint8Array(oe):oe,H=v.inflateSetDictionary(this.strm,se)),H===E.Z_BUF_ERROR&&fe===!0&&(H=E.Z_OK,fe=!1),H!==E.Z_STREAM_END&&H!==E.Z_OK)return this.onEnd(H),!(this.ended=!0);ge.next_out&&(ge.avail_out!==0&&H!==E.Z_STREAM_END&&(ge.avail_in!==0||j!==E.Z_FINISH&&j!==E.Z_SYNC_FLUSH)||(this.options.to==="string"?(V=r.utf8border(ge.output,ge.next_out),Z=ge.next_out-V,X=r.buf2string(ge.output,V),ge.next_out=Z,ge.avail_out=ae-Z,Z&&S.arraySet(ge.output,ge.output,V,Z,0),this.onData(X)):this.onData(S.shrinkBuf(ge.output,ge.next_out)))),ge.avail_in===0&&ge.avail_out===0&&(fe=!0)}while((0<ge.avail_in||ge.avail_out===0)&&H!==E.Z_STREAM_END);return H===E.Z_STREAM_END&&(j=E.Z_FINISH),j===E.Z_FINISH?(H=v.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===E.Z_OK):j!==E.Z_SYNC_FLUSH||(this.onEnd(E.Z_OK),!(ge.avail_out=0))},R.prototype.onData=function(O){this.chunks.push(O)},R.prototype.onEnd=function(O){O===E.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg},g.Inflate=R,g.inflate=D,g.inflateRaw=function(O,N){return(N=N||{}).raw=!0,D(O,N)},g.ungzip=D},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(c,p,g){var v=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";g.assign=function(E){for(var A=Array.prototype.slice.call(arguments,1);A.length;){var I=A.shift();if(I){if(typeof I!="object")throw new TypeError(I+"must be non-object");for(var F in I)I.hasOwnProperty(F)&&(E[F]=I[F])}}return E},g.shrinkBuf=function(E,A){return E.length===A?E:E.subarray?E.subarray(0,A):(E.length=A,E)};var S={arraySet:function(E,A,I,F,z){if(A.subarray&&E.subarray)E.set(A.subarray(I,I+F),z);else for(var R=0;R<F;R++)E[z+R]=A[I+R]},flattenChunks:function(E){var A,I,F,z,R,D;for(A=F=0,I=E.length;A<I;A++)F+=E[A].length;for(D=new Uint8Array(F),A=z=0,I=E.length;A<I;A++)R=E[A],D.set(R,z),z+=R.length;return D}},r={arraySet:function(E,A,I,F,z){for(var R=0;R<F;R++)E[z+R]=A[I+R]},flattenChunks:function(E){return[].concat.apply([],E)}};g.setTyped=function(E){E?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,S)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,r))},g.setTyped(v)},{}],42:[function(c,p,g){var v=c("./common"),S=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var E=new v.Buf8(256),A=0;A<256;A++)E[A]=252<=A?6:248<=A?5:240<=A?4:224<=A?3:192<=A?2:1;function I(F,z){if(z<65537&&(F.subarray&&r||!F.subarray&&S))return String.fromCharCode.apply(null,v.shrinkBuf(F,z));for(var R="",D=0;D<z;D++)R+=String.fromCharCode(F[D]);return R}E[254]=E[254]=1,g.string2buf=function(F){var z,R,D,O,N,H=F.length,j=0;for(O=0;O<H;O++)(64512&(R=F.charCodeAt(O)))==55296&&O+1<H&&(64512&(D=F.charCodeAt(O+1)))==56320&&(R=65536+(R-55296<<10)+(D-56320),O++),j+=R<128?1:R<2048?2:R<65536?3:4;for(z=new v.Buf8(j),O=N=0;N<j;O++)(64512&(R=F.charCodeAt(O)))==55296&&O+1<H&&(64512&(D=F.charCodeAt(O+1)))==56320&&(R=65536+(R-55296<<10)+(D-56320),O++),R<128?z[N++]=R:(R<2048?z[N++]=192|R>>>6:(R<65536?z[N++]=224|R>>>12:(z[N++]=240|R>>>18,z[N++]=128|R>>>12&63),z[N++]=128|R>>>6&63),z[N++]=128|63&R);return z},g.buf2binstring=function(F){return I(F,F.length)},g.binstring2buf=function(F){for(var z=new v.Buf8(F.length),R=0,D=z.length;R<D;R++)z[R]=F.charCodeAt(R);return z},g.buf2string=function(F,z){var R,D,O,N,H=z||F.length,j=new Array(2*H);for(R=D=0;R<H;)if((O=F[R++])<128)j[D++]=O;else if(4<(N=E[O]))j[D++]=65533,R+=N-1;else{for(O&=N===2?31:N===3?15:7;1<N&&R<H;)O=O<<6|63&F[R++],N--;1<N?j[D++]=65533:O<65536?j[D++]=O:(O-=65536,j[D++]=55296|O>>10&1023,j[D++]=56320|1023&O)}return I(j,D)},g.utf8border=function(F,z){var R;for((z=z||F.length)>F.length&&(z=F.length),R=z-1;0<=R&&(192&F[R])==128;)R--;return R<0||R===0?z:R+E[F[R]]>z?R:z}},{"./common":41}],43:[function(c,p,g){p.exports=function(v,S,r,E){for(var A=65535&v|0,I=v>>>16&65535|0,F=0;r!==0;){for(r-=F=2e3<r?2e3:r;I=I+(A=A+S[E++]|0)|0,--F;);A%=65521,I%=65521}return A|I<<16|0}},{}],44:[function(c,p,g){p.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(c,p,g){var v=(function(){for(var S,r=[],E=0;E<256;E++){S=E;for(var A=0;A<8;A++)S=1&S?3988292384^S>>>1:S>>>1;r[E]=S}return r})();p.exports=function(S,r,E,A){var I=v,F=A+E;S^=-1;for(var z=A;z<F;z++)S=S>>>8^I[255&(S^r[z])];return-1^S}},{}],46:[function(c,p,g){var v,S=c("../utils/common"),r=c("./trees"),E=c("./adler32"),A=c("./crc32"),I=c("./messages"),F=0,z=4,R=0,D=-2,O=-1,N=4,H=2,j=8,V=9,Z=286,X=30,se=19,ge=2*Z+1,ae=15,oe=3,fe=258,pe=fe+oe+1,K=42,ye=113,J=1,de=2,Ae=3,ne=4;function xe(Se,mt){return Se.msg=I[mt],mt}function Ce(Se){return(Se<<1)-(4<Se?9:0)}function Re(Se){for(var mt=Se.length;0<=--mt;)Se[mt]=0}function Ee(Se){var mt=Se.state,Ke=mt.pending;Ke>Se.avail_out&&(Ke=Se.avail_out),Ke!==0&&(S.arraySet(Se.output,mt.pending_buf,mt.pending_out,Ke,Se.next_out),Se.next_out+=Ke,mt.pending_out+=Ke,Se.total_out+=Ke,Se.avail_out-=Ke,mt.pending-=Ke,mt.pending===0&&(mt.pending_out=0))}function Oe(Se,mt){r._tr_flush_block(Se,0<=Se.block_start?Se.block_start:-1,Se.strstart-Se.block_start,mt),Se.block_start=Se.strstart,Ee(Se.strm)}function Be(Se,mt){Se.pending_buf[Se.pending++]=mt}function at(Se,mt){Se.pending_buf[Se.pending++]=mt>>>8&255,Se.pending_buf[Se.pending++]=255&mt}function ut(Se,mt){var Ke,Ue,je=Se.max_chain_length,gt=Se.strstart,Ot=Se.prev_length,Ft=Se.nice_match,pt=Se.strstart>Se.w_size-pe?Se.strstart-(Se.w_size-pe):0,dn=Se.window,An=Se.w_mask,Gt=Se.prev,Yt=Se.strstart+fe,zn=dn[gt+Ot-1],$n=dn[gt+Ot];Se.prev_length>=Se.good_match&&(je>>=2),Ft>Se.lookahead&&(Ft=Se.lookahead);do if(dn[(Ke=mt)+Ot]===$n&&dn[Ke+Ot-1]===zn&&dn[Ke]===dn[gt]&&dn[++Ke]===dn[gt+1]){gt+=2,Ke++;do;while(dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&dn[++gt]===dn[++Ke]&&gt<Yt);if(Ue=fe-(Yt-gt),gt=Yt-fe,Ot<Ue){if(Se.match_start=mt,Ft<=(Ot=Ue))break;zn=dn[gt+Ot-1],$n=dn[gt+Ot]}}while((mt=Gt[mt&An])>pt&&--je!=0);return Ot<=Se.lookahead?Ot:Se.lookahead}function nt(Se){var mt,Ke,Ue,je,gt,Ot,Ft,pt,dn,An,Gt=Se.w_size;do{if(je=Se.window_size-Se.lookahead-Se.strstart,Se.strstart>=Gt+(Gt-pe)){for(S.arraySet(Se.window,Se.window,Gt,Gt,0),Se.match_start-=Gt,Se.strstart-=Gt,Se.block_start-=Gt,mt=Ke=Se.hash_size;Ue=Se.head[--mt],Se.head[mt]=Gt<=Ue?Ue-Gt:0,--Ke;);for(mt=Ke=Gt;Ue=Se.prev[--mt],Se.prev[mt]=Gt<=Ue?Ue-Gt:0,--Ke;);je+=Gt}if(Se.strm.avail_in===0)break;if(Ot=Se.strm,Ft=Se.window,pt=Se.strstart+Se.lookahead,dn=je,An=void 0,An=Ot.avail_in,dn<An&&(An=dn),Ke=An===0?0:(Ot.avail_in-=An,S.arraySet(Ft,Ot.input,Ot.next_in,An,pt),Ot.state.wrap===1?Ot.adler=E(Ot.adler,Ft,An,pt):Ot.state.wrap===2&&(Ot.adler=A(Ot.adler,Ft,An,pt)),Ot.next_in+=An,Ot.total_in+=An,An),Se.lookahead+=Ke,Se.lookahead+Se.insert>=oe)for(gt=Se.strstart-Se.insert,Se.ins_h=Se.window[gt],Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[gt+1])&Se.hash_mask;Se.insert&&(Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[gt+oe-1])&Se.hash_mask,Se.prev[gt&Se.w_mask]=Se.head[Se.ins_h],Se.head[Se.ins_h]=gt,gt++,Se.insert--,!(Se.lookahead+Se.insert<oe)););}while(Se.lookahead<pe&&Se.strm.avail_in!==0)}function $e(Se,mt){for(var Ke,Ue;;){if(Se.lookahead<pe){if(nt(Se),Se.lookahead<pe&&mt===F)return J;if(Se.lookahead===0)break}if(Ke=0,Se.lookahead>=oe&&(Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[Se.strstart+oe-1])&Se.hash_mask,Ke=Se.prev[Se.strstart&Se.w_mask]=Se.head[Se.ins_h],Se.head[Se.ins_h]=Se.strstart),Ke!==0&&Se.strstart-Ke<=Se.w_size-pe&&(Se.match_length=ut(Se,Ke)),Se.match_length>=oe)if(Ue=r._tr_tally(Se,Se.strstart-Se.match_start,Se.match_length-oe),Se.lookahead-=Se.match_length,Se.match_length<=Se.max_lazy_match&&Se.lookahead>=oe){for(Se.match_length--;Se.strstart++,Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[Se.strstart+oe-1])&Se.hash_mask,Ke=Se.prev[Se.strstart&Se.w_mask]=Se.head[Se.ins_h],Se.head[Se.ins_h]=Se.strstart,--Se.match_length!=0;);Se.strstart++}else Se.strstart+=Se.match_length,Se.match_length=0,Se.ins_h=Se.window[Se.strstart],Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[Se.strstart+1])&Se.hash_mask;else Ue=r._tr_tally(Se,0,Se.window[Se.strstart]),Se.lookahead--,Se.strstart++;if(Ue&&(Oe(Se,!1),Se.strm.avail_out===0))return J}return Se.insert=Se.strstart<oe-1?Se.strstart:oe-1,mt===z?(Oe(Se,!0),Se.strm.avail_out===0?Ae:ne):Se.last_lit&&(Oe(Se,!1),Se.strm.avail_out===0)?J:de}function ct(Se,mt){for(var Ke,Ue,je;;){if(Se.lookahead<pe){if(nt(Se),Se.lookahead<pe&&mt===F)return J;if(Se.lookahead===0)break}if(Ke=0,Se.lookahead>=oe&&(Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[Se.strstart+oe-1])&Se.hash_mask,Ke=Se.prev[Se.strstart&Se.w_mask]=Se.head[Se.ins_h],Se.head[Se.ins_h]=Se.strstart),Se.prev_length=Se.match_length,Se.prev_match=Se.match_start,Se.match_length=oe-1,Ke!==0&&Se.prev_length<Se.max_lazy_match&&Se.strstart-Ke<=Se.w_size-pe&&(Se.match_length=ut(Se,Ke),Se.match_length<=5&&(Se.strategy===1||Se.match_length===oe&&4096<Se.strstart-Se.match_start)&&(Se.match_length=oe-1)),Se.prev_length>=oe&&Se.match_length<=Se.prev_length){for(je=Se.strstart+Se.lookahead-oe,Ue=r._tr_tally(Se,Se.strstart-1-Se.prev_match,Se.prev_length-oe),Se.lookahead-=Se.prev_length-1,Se.prev_length-=2;++Se.strstart<=je&&(Se.ins_h=(Se.ins_h<<Se.hash_shift^Se.window[Se.strstart+oe-1])&Se.hash_mask,Ke=Se.prev[Se.strstart&Se.w_mask]=Se.head[Se.ins_h],Se.head[Se.ins_h]=Se.strstart),--Se.prev_length!=0;);if(Se.match_available=0,Se.match_length=oe-1,Se.strstart++,Ue&&(Oe(Se,!1),Se.strm.avail_out===0))return J}else if(Se.match_available){if((Ue=r._tr_tally(Se,0,Se.window[Se.strstart-1]))&&Oe(Se,!1),Se.strstart++,Se.lookahead--,Se.strm.avail_out===0)return J}else Se.match_available=1,Se.strstart++,Se.lookahead--}return Se.match_available&&(Ue=r._tr_tally(Se,0,Se.window[Se.strstart-1]),Se.match_available=0),Se.insert=Se.strstart<oe-1?Se.strstart:oe-1,mt===z?(Oe(Se,!0),Se.strm.avail_out===0?Ae:ne):Se.last_lit&&(Oe(Se,!1),Se.strm.avail_out===0)?J:de}function At(Se,mt,Ke,Ue,je){this.good_length=Se,this.max_lazy=mt,this.nice_length=Ke,this.max_chain=Ue,this.func=je}function xt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*ge),this.dyn_dtree=new S.Buf16(2*(2*X+1)),this.bl_tree=new S.Buf16(2*(2*se+1)),Re(this.dyn_ltree),Re(this.dyn_dtree),Re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(ae+1),this.heap=new S.Buf16(2*Z+1),Re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*Z+1),Re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function It(Se){var mt;return Se&&Se.state?(Se.total_in=Se.total_out=0,Se.data_type=H,(mt=Se.state).pending=0,mt.pending_out=0,mt.wrap<0&&(mt.wrap=-mt.wrap),mt.status=mt.wrap?K:ye,Se.adler=mt.wrap===2?0:1,mt.last_flush=F,r._tr_init(mt),R):xe(Se,D)}function jt(Se){var mt=It(Se);return mt===R&&(function(Ke){Ke.window_size=2*Ke.w_size,Re(Ke.head),Ke.max_lazy_match=v[Ke.level].max_lazy,Ke.good_match=v[Ke.level].good_length,Ke.nice_match=v[Ke.level].nice_length,Ke.max_chain_length=v[Ke.level].max_chain,Ke.strstart=0,Ke.block_start=0,Ke.lookahead=0,Ke.insert=0,Ke.match_length=Ke.prev_length=oe-1,Ke.match_available=0,Ke.ins_h=0})(Se.state),mt}function cn(Se,mt,Ke,Ue,je,gt){if(!Se)return D;var Ot=1;if(mt===O&&(mt=6),Ue<0?(Ot=0,Ue=-Ue):15<Ue&&(Ot=2,Ue-=16),je<1||V<je||Ke!==j||Ue<8||15<Ue||mt<0||9<mt||gt<0||N<gt)return xe(Se,D);Ue===8&&(Ue=9);var Ft=new xt;return(Se.state=Ft).strm=Se,Ft.wrap=Ot,Ft.gzhead=null,Ft.w_bits=Ue,Ft.w_size=1<<Ft.w_bits,Ft.w_mask=Ft.w_size-1,Ft.hash_bits=je+7,Ft.hash_size=1<<Ft.hash_bits,Ft.hash_mask=Ft.hash_size-1,Ft.hash_shift=~~((Ft.hash_bits+oe-1)/oe),Ft.window=new S.Buf8(2*Ft.w_size),Ft.head=new S.Buf16(Ft.hash_size),Ft.prev=new S.Buf16(Ft.w_size),Ft.lit_bufsize=1<<je+6,Ft.pending_buf_size=4*Ft.lit_bufsize,Ft.pending_buf=new S.Buf8(Ft.pending_buf_size),Ft.d_buf=1*Ft.lit_bufsize,Ft.l_buf=3*Ft.lit_bufsize,Ft.level=mt,Ft.strategy=gt,Ft.method=Ke,jt(Se)}v=[new At(0,0,0,0,function(Se,mt){var Ke=65535;for(Ke>Se.pending_buf_size-5&&(Ke=Se.pending_buf_size-5);;){if(Se.lookahead<=1){if(nt(Se),Se.lookahead===0&&mt===F)return J;if(Se.lookahead===0)break}Se.strstart+=Se.lookahead,Se.lookahead=0;var Ue=Se.block_start+Ke;if((Se.strstart===0||Se.strstart>=Ue)&&(Se.lookahead=Se.strstart-Ue,Se.strstart=Ue,Oe(Se,!1),Se.strm.avail_out===0)||Se.strstart-Se.block_start>=Se.w_size-pe&&(Oe(Se,!1),Se.strm.avail_out===0))return J}return Se.insert=0,mt===z?(Oe(Se,!0),Se.strm.avail_out===0?Ae:ne):(Se.strstart>Se.block_start&&(Oe(Se,!1),Se.strm.avail_out),J)}),new At(4,4,8,4,$e),new At(4,5,16,8,$e),new At(4,6,32,32,$e),new At(4,4,16,16,ct),new At(8,16,32,32,ct),new At(8,16,128,128,ct),new At(8,32,128,256,ct),new At(32,128,258,1024,ct),new At(32,258,258,4096,ct)],g.deflateInit=function(Se,mt){return cn(Se,mt,j,15,8,0)},g.deflateInit2=cn,g.deflateReset=jt,g.deflateResetKeep=It,g.deflateSetHeader=function(Se,mt){return Se&&Se.state?Se.state.wrap!==2?D:(Se.state.gzhead=mt,R):D},g.deflate=function(Se,mt){var Ke,Ue,je,gt;if(!Se||!Se.state||5<mt||mt<0)return Se?xe(Se,D):D;if(Ue=Se.state,!Se.output||!Se.input&&Se.avail_in!==0||Ue.status===666&&mt!==z)return xe(Se,Se.avail_out===0?-5:D);if(Ue.strm=Se,Ke=Ue.last_flush,Ue.last_flush=mt,Ue.status===K)if(Ue.wrap===2)Se.adler=0,Be(Ue,31),Be(Ue,139),Be(Ue,8),Ue.gzhead?(Be(Ue,(Ue.gzhead.text?1:0)+(Ue.gzhead.hcrc?2:0)+(Ue.gzhead.extra?4:0)+(Ue.gzhead.name?8:0)+(Ue.gzhead.comment?16:0)),Be(Ue,255&Ue.gzhead.time),Be(Ue,Ue.gzhead.time>>8&255),Be(Ue,Ue.gzhead.time>>16&255),Be(Ue,Ue.gzhead.time>>24&255),Be(Ue,Ue.level===9?2:2<=Ue.strategy||Ue.level<2?4:0),Be(Ue,255&Ue.gzhead.os),Ue.gzhead.extra&&Ue.gzhead.extra.length&&(Be(Ue,255&Ue.gzhead.extra.length),Be(Ue,Ue.gzhead.extra.length>>8&255)),Ue.gzhead.hcrc&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending,0)),Ue.gzindex=0,Ue.status=69):(Be(Ue,0),Be(Ue,0),Be(Ue,0),Be(Ue,0),Be(Ue,0),Be(Ue,Ue.level===9?2:2<=Ue.strategy||Ue.level<2?4:0),Be(Ue,3),Ue.status=ye);else{var Ot=j+(Ue.w_bits-8<<4)<<8;Ot|=(2<=Ue.strategy||Ue.level<2?0:Ue.level<6?1:Ue.level===6?2:3)<<6,Ue.strstart!==0&&(Ot|=32),Ot+=31-Ot%31,Ue.status=ye,at(Ue,Ot),Ue.strstart!==0&&(at(Ue,Se.adler>>>16),at(Ue,65535&Se.adler)),Se.adler=1}if(Ue.status===69)if(Ue.gzhead.extra){for(je=Ue.pending;Ue.gzindex<(65535&Ue.gzhead.extra.length)&&(Ue.pending!==Ue.pending_buf_size||(Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),Ee(Se),je=Ue.pending,Ue.pending!==Ue.pending_buf_size));)Be(Ue,255&Ue.gzhead.extra[Ue.gzindex]),Ue.gzindex++;Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),Ue.gzindex===Ue.gzhead.extra.length&&(Ue.gzindex=0,Ue.status=73)}else Ue.status=73;if(Ue.status===73)if(Ue.gzhead.name){je=Ue.pending;do{if(Ue.pending===Ue.pending_buf_size&&(Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),Ee(Se),je=Ue.pending,Ue.pending===Ue.pending_buf_size)){gt=1;break}gt=Ue.gzindex<Ue.gzhead.name.length?255&Ue.gzhead.name.charCodeAt(Ue.gzindex++):0,Be(Ue,gt)}while(gt!==0);Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),gt===0&&(Ue.gzindex=0,Ue.status=91)}else Ue.status=91;if(Ue.status===91)if(Ue.gzhead.comment){je=Ue.pending;do{if(Ue.pending===Ue.pending_buf_size&&(Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),Ee(Se),je=Ue.pending,Ue.pending===Ue.pending_buf_size)){gt=1;break}gt=Ue.gzindex<Ue.gzhead.comment.length?255&Ue.gzhead.comment.charCodeAt(Ue.gzindex++):0,Be(Ue,gt)}while(gt!==0);Ue.gzhead.hcrc&&Ue.pending>je&&(Se.adler=A(Se.adler,Ue.pending_buf,Ue.pending-je,je)),gt===0&&(Ue.status=103)}else Ue.status=103;if(Ue.status===103&&(Ue.gzhead.hcrc?(Ue.pending+2>Ue.pending_buf_size&&Ee(Se),Ue.pending+2<=Ue.pending_buf_size&&(Be(Ue,255&Se.adler),Be(Ue,Se.adler>>8&255),Se.adler=0,Ue.status=ye)):Ue.status=ye),Ue.pending!==0){if(Ee(Se),Se.avail_out===0)return Ue.last_flush=-1,R}else if(Se.avail_in===0&&Ce(mt)<=Ce(Ke)&&mt!==z)return xe(Se,-5);if(Ue.status===666&&Se.avail_in!==0)return xe(Se,-5);if(Se.avail_in!==0||Ue.lookahead!==0||mt!==F&&Ue.status!==666){var Ft=Ue.strategy===2?(function(pt,dn){for(var An;;){if(pt.lookahead===0&&(nt(pt),pt.lookahead===0)){if(dn===F)return J;break}if(pt.match_length=0,An=r._tr_tally(pt,0,pt.window[pt.strstart]),pt.lookahead--,pt.strstart++,An&&(Oe(pt,!1),pt.strm.avail_out===0))return J}return pt.insert=0,dn===z?(Oe(pt,!0),pt.strm.avail_out===0?Ae:ne):pt.last_lit&&(Oe(pt,!1),pt.strm.avail_out===0)?J:de})(Ue,mt):Ue.strategy===3?(function(pt,dn){for(var An,Gt,Yt,zn,$n=pt.window;;){if(pt.lookahead<=fe){if(nt(pt),pt.lookahead<=fe&&dn===F)return J;if(pt.lookahead===0)break}if(pt.match_length=0,pt.lookahead>=oe&&0<pt.strstart&&(Gt=$n[Yt=pt.strstart-1])===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]){zn=pt.strstart+fe;do;while(Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Gt===$n[++Yt]&&Yt<zn);pt.match_length=fe-(zn-Yt),pt.match_length>pt.lookahead&&(pt.match_length=pt.lookahead)}if(pt.match_length>=oe?(An=r._tr_tally(pt,1,pt.match_length-oe),pt.lookahead-=pt.match_length,pt.strstart+=pt.match_length,pt.match_length=0):(An=r._tr_tally(pt,0,pt.window[pt.strstart]),pt.lookahead--,pt.strstart++),An&&(Oe(pt,!1),pt.strm.avail_out===0))return J}return pt.insert=0,dn===z?(Oe(pt,!0),pt.strm.avail_out===0?Ae:ne):pt.last_lit&&(Oe(pt,!1),pt.strm.avail_out===0)?J:de})(Ue,mt):v[Ue.level].func(Ue,mt);if(Ft!==Ae&&Ft!==ne||(Ue.status=666),Ft===J||Ft===Ae)return Se.avail_out===0&&(Ue.last_flush=-1),R;if(Ft===de&&(mt===1?r._tr_align(Ue):mt!==5&&(r._tr_stored_block(Ue,0,0,!1),mt===3&&(Re(Ue.head),Ue.lookahead===0&&(Ue.strstart=0,Ue.block_start=0,Ue.insert=0))),Ee(Se),Se.avail_out===0))return Ue.last_flush=-1,R}return mt!==z?R:Ue.wrap<=0?1:(Ue.wrap===2?(Be(Ue,255&Se.adler),Be(Ue,Se.adler>>8&255),Be(Ue,Se.adler>>16&255),Be(Ue,Se.adler>>24&255),Be(Ue,255&Se.total_in),Be(Ue,Se.total_in>>8&255),Be(Ue,Se.total_in>>16&255),Be(Ue,Se.total_in>>24&255)):(at(Ue,Se.adler>>>16),at(Ue,65535&Se.adler)),Ee(Se),0<Ue.wrap&&(Ue.wrap=-Ue.wrap),Ue.pending!==0?R:1)},g.deflateEnd=function(Se){var mt;return Se&&Se.state?(mt=Se.state.status)!==K&&mt!==69&&mt!==73&&mt!==91&&mt!==103&&mt!==ye&&mt!==666?xe(Se,D):(Se.state=null,mt===ye?xe(Se,-3):R):D},g.deflateSetDictionary=function(Se,mt){var Ke,Ue,je,gt,Ot,Ft,pt,dn,An=mt.length;if(!Se||!Se.state||(gt=(Ke=Se.state).wrap)===2||gt===1&&Ke.status!==K||Ke.lookahead)return D;for(gt===1&&(Se.adler=E(Se.adler,mt,An,0)),Ke.wrap=0,An>=Ke.w_size&&(gt===0&&(Re(Ke.head),Ke.strstart=0,Ke.block_start=0,Ke.insert=0),dn=new S.Buf8(Ke.w_size),S.arraySet(dn,mt,An-Ke.w_size,Ke.w_size,0),mt=dn,An=Ke.w_size),Ot=Se.avail_in,Ft=Se.next_in,pt=Se.input,Se.avail_in=An,Se.next_in=0,Se.input=mt,nt(Ke);Ke.lookahead>=oe;){for(Ue=Ke.strstart,je=Ke.lookahead-(oe-1);Ke.ins_h=(Ke.ins_h<<Ke.hash_shift^Ke.window[Ue+oe-1])&Ke.hash_mask,Ke.prev[Ue&Ke.w_mask]=Ke.head[Ke.ins_h],Ke.head[Ke.ins_h]=Ue,Ue++,--je;);Ke.strstart=Ue,Ke.lookahead=oe-1,nt(Ke)}return Ke.strstart+=Ke.lookahead,Ke.block_start=Ke.strstart,Ke.insert=Ke.lookahead,Ke.lookahead=0,Ke.match_length=Ke.prev_length=oe-1,Ke.match_available=0,Se.next_in=Ft,Se.input=pt,Se.avail_in=Ot,Ke.wrap=gt,R},g.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(c,p,g){p.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(c,p,g){p.exports=function(v,S){var r,E,A,I,F,z,R,D,O,N,H,j,V,Z,X,se,ge,ae,oe,fe,pe,K,ye,J,de;r=v.state,E=v.next_in,J=v.input,A=E+(v.avail_in-5),I=v.next_out,de=v.output,F=I-(S-v.avail_out),z=I+(v.avail_out-257),R=r.dmax,D=r.wsize,O=r.whave,N=r.wnext,H=r.window,j=r.hold,V=r.bits,Z=r.lencode,X=r.distcode,se=(1<<r.lenbits)-1,ge=(1<<r.distbits)-1;e:do{V<15&&(j+=J[E++]<<V,V+=8,j+=J[E++]<<V,V+=8),ae=Z[j&se];t:for(;;){if(j>>>=oe=ae>>>24,V-=oe,(oe=ae>>>16&255)===0)de[I++]=65535&ae;else{if(!(16&oe)){if((64&oe)==0){ae=Z[(65535&ae)+(j&(1<<oe)-1)];continue t}if(32&oe){r.mode=12;break e}v.msg="invalid literal/length code",r.mode=30;break e}fe=65535&ae,(oe&=15)&&(V<oe&&(j+=J[E++]<<V,V+=8),fe+=j&(1<<oe)-1,j>>>=oe,V-=oe),V<15&&(j+=J[E++]<<V,V+=8,j+=J[E++]<<V,V+=8),ae=X[j&ge];n:for(;;){if(j>>>=oe=ae>>>24,V-=oe,!(16&(oe=ae>>>16&255))){if((64&oe)==0){ae=X[(65535&ae)+(j&(1<<oe)-1)];continue n}v.msg="invalid distance code",r.mode=30;break e}if(pe=65535&ae,V<(oe&=15)&&(j+=J[E++]<<V,(V+=8)<oe&&(j+=J[E++]<<V,V+=8)),R<(pe+=j&(1<<oe)-1)){v.msg="invalid distance too far back",r.mode=30;break e}if(j>>>=oe,V-=oe,(oe=I-F)<pe){if(O<(oe=pe-oe)&&r.sane){v.msg="invalid distance too far back",r.mode=30;break e}if(ye=H,(K=0)===N){if(K+=D-oe,oe<fe){for(fe-=oe;de[I++]=H[K++],--oe;);K=I-pe,ye=de}}else if(N<oe){if(K+=D+N-oe,(oe-=N)<fe){for(fe-=oe;de[I++]=H[K++],--oe;);if(K=0,N<fe){for(fe-=oe=N;de[I++]=H[K++],--oe;);K=I-pe,ye=de}}}else if(K+=N-oe,oe<fe){for(fe-=oe;de[I++]=H[K++],--oe;);K=I-pe,ye=de}for(;2<fe;)de[I++]=ye[K++],de[I++]=ye[K++],de[I++]=ye[K++],fe-=3;fe&&(de[I++]=ye[K++],1<fe&&(de[I++]=ye[K++]))}else{for(K=I-pe;de[I++]=de[K++],de[I++]=de[K++],de[I++]=de[K++],2<(fe-=3););fe&&(de[I++]=de[K++],1<fe&&(de[I++]=de[K++]))}break}}break}}while(E<A&&I<z);E-=fe=V>>3,j&=(1<<(V-=fe<<3))-1,v.next_in=E,v.next_out=I,v.avail_in=E<A?A-E+5:5-(E-A),v.avail_out=I<z?z-I+257:257-(I-z),r.hold=j,r.bits=V}},{}],49:[function(c,p,g){var v=c("../utils/common"),S=c("./adler32"),r=c("./crc32"),E=c("./inffast"),A=c("./inftrees"),I=1,F=2,z=0,R=-2,D=1,O=852,N=592;function H(K){return(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24)}function j(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function V(K){var ye;return K&&K.state?(ye=K.state,K.total_in=K.total_out=ye.total=0,K.msg="",ye.wrap&&(K.adler=1&ye.wrap),ye.mode=D,ye.last=0,ye.havedict=0,ye.dmax=32768,ye.head=null,ye.hold=0,ye.bits=0,ye.lencode=ye.lendyn=new v.Buf32(O),ye.distcode=ye.distdyn=new v.Buf32(N),ye.sane=1,ye.back=-1,z):R}function Z(K){var ye;return K&&K.state?((ye=K.state).wsize=0,ye.whave=0,ye.wnext=0,V(K)):R}function X(K,ye){var J,de;return K&&K.state?(de=K.state,ye<0?(J=0,ye=-ye):(J=1+(ye>>4),ye<48&&(ye&=15)),ye&&(ye<8||15<ye)?R:(de.window!==null&&de.wbits!==ye&&(de.window=null),de.wrap=J,de.wbits=ye,Z(K))):R}function se(K,ye){var J,de;return K?(de=new j,(K.state=de).window=null,(J=X(K,ye))!==z&&(K.state=null),J):R}var ge,ae,oe=!0;function fe(K){if(oe){var ye;for(ge=new v.Buf32(512),ae=new v.Buf32(32),ye=0;ye<144;)K.lens[ye++]=8;for(;ye<256;)K.lens[ye++]=9;for(;ye<280;)K.lens[ye++]=7;for(;ye<288;)K.lens[ye++]=8;for(A(I,K.lens,0,288,ge,0,K.work,{bits:9}),ye=0;ye<32;)K.lens[ye++]=5;A(F,K.lens,0,32,ae,0,K.work,{bits:5}),oe=!1}K.lencode=ge,K.lenbits=9,K.distcode=ae,K.distbits=5}function pe(K,ye,J,de){var Ae,ne=K.state;return ne.window===null&&(ne.wsize=1<<ne.wbits,ne.wnext=0,ne.whave=0,ne.window=new v.Buf8(ne.wsize)),de>=ne.wsize?(v.arraySet(ne.window,ye,J-ne.wsize,ne.wsize,0),ne.wnext=0,ne.whave=ne.wsize):(de<(Ae=ne.wsize-ne.wnext)&&(Ae=de),v.arraySet(ne.window,ye,J-de,Ae,ne.wnext),(de-=Ae)?(v.arraySet(ne.window,ye,J-de,de,0),ne.wnext=de,ne.whave=ne.wsize):(ne.wnext+=Ae,ne.wnext===ne.wsize&&(ne.wnext=0),ne.whave<ne.wsize&&(ne.whave+=Ae))),0}g.inflateReset=Z,g.inflateReset2=X,g.inflateResetKeep=V,g.inflateInit=function(K){return se(K,15)},g.inflateInit2=se,g.inflate=function(K,ye){var J,de,Ae,ne,xe,Ce,Re,Ee,Oe,Be,at,ut,nt,$e,ct,At,xt,It,jt,cn,Se,mt,Ke,Ue,je=0,gt=new v.Buf8(4),Ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!K||!K.state||!K.output||!K.input&&K.avail_in!==0)return R;(J=K.state).mode===12&&(J.mode=13),xe=K.next_out,Ae=K.output,Re=K.avail_out,ne=K.next_in,de=K.input,Ce=K.avail_in,Ee=J.hold,Oe=J.bits,Be=Ce,at=Re,mt=z;e:for(;;)switch(J.mode){case D:if(J.wrap===0){J.mode=13;break}for(;Oe<16;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(2&J.wrap&&Ee===35615){gt[J.check=0]=255&Ee,gt[1]=Ee>>>8&255,J.check=r(J.check,gt,2,0),Oe=Ee=0,J.mode=2;break}if(J.flags=0,J.head&&(J.head.done=!1),!(1&J.wrap)||(((255&Ee)<<8)+(Ee>>8))%31){K.msg="incorrect header check",J.mode=30;break}if((15&Ee)!=8){K.msg="unknown compression method",J.mode=30;break}if(Oe-=4,Se=8+(15&(Ee>>>=4)),J.wbits===0)J.wbits=Se;else if(Se>J.wbits){K.msg="invalid window size",J.mode=30;break}J.dmax=1<<Se,K.adler=J.check=1,J.mode=512&Ee?10:12,Oe=Ee=0;break;case 2:for(;Oe<16;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(J.flags=Ee,(255&J.flags)!=8){K.msg="unknown compression method",J.mode=30;break}if(57344&J.flags){K.msg="unknown header flags set",J.mode=30;break}J.head&&(J.head.text=Ee>>8&1),512&J.flags&&(gt[0]=255&Ee,gt[1]=Ee>>>8&255,J.check=r(J.check,gt,2,0)),Oe=Ee=0,J.mode=3;case 3:for(;Oe<32;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.head&&(J.head.time=Ee),512&J.flags&&(gt[0]=255&Ee,gt[1]=Ee>>>8&255,gt[2]=Ee>>>16&255,gt[3]=Ee>>>24&255,J.check=r(J.check,gt,4,0)),Oe=Ee=0,J.mode=4;case 4:for(;Oe<16;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.head&&(J.head.xflags=255&Ee,J.head.os=Ee>>8),512&J.flags&&(gt[0]=255&Ee,gt[1]=Ee>>>8&255,J.check=r(J.check,gt,2,0)),Oe=Ee=0,J.mode=5;case 5:if(1024&J.flags){for(;Oe<16;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.length=Ee,J.head&&(J.head.extra_len=Ee),512&J.flags&&(gt[0]=255&Ee,gt[1]=Ee>>>8&255,J.check=r(J.check,gt,2,0)),Oe=Ee=0}else J.head&&(J.head.extra=null);J.mode=6;case 6:if(1024&J.flags&&(Ce<(ut=J.length)&&(ut=Ce),ut&&(J.head&&(Se=J.head.extra_len-J.length,J.head.extra||(J.head.extra=new Array(J.head.extra_len)),v.arraySet(J.head.extra,de,ne,ut,Se)),512&J.flags&&(J.check=r(J.check,de,ut,ne)),Ce-=ut,ne+=ut,J.length-=ut),J.length))break e;J.length=0,J.mode=7;case 7:if(2048&J.flags){if(Ce===0)break e;for(ut=0;Se=de[ne+ut++],J.head&&Se&&J.length<65536&&(J.head.name+=String.fromCharCode(Se)),Se&&ut<Ce;);if(512&J.flags&&(J.check=r(J.check,de,ut,ne)),Ce-=ut,ne+=ut,Se)break e}else J.head&&(J.head.name=null);J.length=0,J.mode=8;case 8:if(4096&J.flags){if(Ce===0)break e;for(ut=0;Se=de[ne+ut++],J.head&&Se&&J.length<65536&&(J.head.comment+=String.fromCharCode(Se)),Se&&ut<Ce;);if(512&J.flags&&(J.check=r(J.check,de,ut,ne)),Ce-=ut,ne+=ut,Se)break e}else J.head&&(J.head.comment=null);J.mode=9;case 9:if(512&J.flags){for(;Oe<16;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(Ee!==(65535&J.check)){K.msg="header crc mismatch",J.mode=30;break}Oe=Ee=0}J.head&&(J.head.hcrc=J.flags>>9&1,J.head.done=!0),K.adler=J.check=0,J.mode=12;break;case 10:for(;Oe<32;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}K.adler=J.check=H(Ee),Oe=Ee=0,J.mode=11;case 11:if(J.havedict===0)return K.next_out=xe,K.avail_out=Re,K.next_in=ne,K.avail_in=Ce,J.hold=Ee,J.bits=Oe,2;K.adler=J.check=1,J.mode=12;case 12:if(ye===5||ye===6)break e;case 13:if(J.last){Ee>>>=7&Oe,Oe-=7&Oe,J.mode=27;break}for(;Oe<3;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}switch(J.last=1&Ee,Oe-=1,3&(Ee>>>=1)){case 0:J.mode=14;break;case 1:if(fe(J),J.mode=20,ye!==6)break;Ee>>>=2,Oe-=2;break e;case 2:J.mode=17;break;case 3:K.msg="invalid block type",J.mode=30}Ee>>>=2,Oe-=2;break;case 14:for(Ee>>>=7&Oe,Oe-=7&Oe;Oe<32;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if((65535&Ee)!=(Ee>>>16^65535)){K.msg="invalid stored block lengths",J.mode=30;break}if(J.length=65535&Ee,Oe=Ee=0,J.mode=15,ye===6)break e;case 15:J.mode=16;case 16:if(ut=J.length){if(Ce<ut&&(ut=Ce),Re<ut&&(ut=Re),ut===0)break e;v.arraySet(Ae,de,ne,ut,xe),Ce-=ut,ne+=ut,Re-=ut,xe+=ut,J.length-=ut;break}J.mode=12;break;case 17:for(;Oe<14;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(J.nlen=257+(31&Ee),Ee>>>=5,Oe-=5,J.ndist=1+(31&Ee),Ee>>>=5,Oe-=5,J.ncode=4+(15&Ee),Ee>>>=4,Oe-=4,286<J.nlen||30<J.ndist){K.msg="too many length or distance symbols",J.mode=30;break}J.have=0,J.mode=18;case 18:for(;J.have<J.ncode;){for(;Oe<3;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.lens[Ot[J.have++]]=7&Ee,Ee>>>=3,Oe-=3}for(;J.have<19;)J.lens[Ot[J.have++]]=0;if(J.lencode=J.lendyn,J.lenbits=7,Ke={bits:J.lenbits},mt=A(0,J.lens,0,19,J.lencode,0,J.work,Ke),J.lenbits=Ke.bits,mt){K.msg="invalid code lengths set",J.mode=30;break}J.have=0,J.mode=19;case 19:for(;J.have<J.nlen+J.ndist;){for(;At=(je=J.lencode[Ee&(1<<J.lenbits)-1])>>>16&255,xt=65535&je,!((ct=je>>>24)<=Oe);){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(xt<16)Ee>>>=ct,Oe-=ct,J.lens[J.have++]=xt;else{if(xt===16){for(Ue=ct+2;Oe<Ue;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(Ee>>>=ct,Oe-=ct,J.have===0){K.msg="invalid bit length repeat",J.mode=30;break}Se=J.lens[J.have-1],ut=3+(3&Ee),Ee>>>=2,Oe-=2}else if(xt===17){for(Ue=ct+3;Oe<Ue;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}Oe-=ct,Se=0,ut=3+(7&(Ee>>>=ct)),Ee>>>=3,Oe-=3}else{for(Ue=ct+7;Oe<Ue;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}Oe-=ct,Se=0,ut=11+(127&(Ee>>>=ct)),Ee>>>=7,Oe-=7}if(J.have+ut>J.nlen+J.ndist){K.msg="invalid bit length repeat",J.mode=30;break}for(;ut--;)J.lens[J.have++]=Se}}if(J.mode===30)break;if(J.lens[256]===0){K.msg="invalid code -- missing end-of-block",J.mode=30;break}if(J.lenbits=9,Ke={bits:J.lenbits},mt=A(I,J.lens,0,J.nlen,J.lencode,0,J.work,Ke),J.lenbits=Ke.bits,mt){K.msg="invalid literal/lengths set",J.mode=30;break}if(J.distbits=6,J.distcode=J.distdyn,Ke={bits:J.distbits},mt=A(F,J.lens,J.nlen,J.ndist,J.distcode,0,J.work,Ke),J.distbits=Ke.bits,mt){K.msg="invalid distances set",J.mode=30;break}if(J.mode=20,ye===6)break e;case 20:J.mode=21;case 21:if(6<=Ce&&258<=Re){K.next_out=xe,K.avail_out=Re,K.next_in=ne,K.avail_in=Ce,J.hold=Ee,J.bits=Oe,E(K,at),xe=K.next_out,Ae=K.output,Re=K.avail_out,ne=K.next_in,de=K.input,Ce=K.avail_in,Ee=J.hold,Oe=J.bits,J.mode===12&&(J.back=-1);break}for(J.back=0;At=(je=J.lencode[Ee&(1<<J.lenbits)-1])>>>16&255,xt=65535&je,!((ct=je>>>24)<=Oe);){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(At&&(240&At)==0){for(It=ct,jt=At,cn=xt;At=(je=J.lencode[cn+((Ee&(1<<It+jt)-1)>>It)])>>>16&255,xt=65535&je,!(It+(ct=je>>>24)<=Oe);){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}Ee>>>=It,Oe-=It,J.back+=It}if(Ee>>>=ct,Oe-=ct,J.back+=ct,J.length=xt,At===0){J.mode=26;break}if(32&At){J.back=-1,J.mode=12;break}if(64&At){K.msg="invalid literal/length code",J.mode=30;break}J.extra=15&At,J.mode=22;case 22:if(J.extra){for(Ue=J.extra;Oe<Ue;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.length+=Ee&(1<<J.extra)-1,Ee>>>=J.extra,Oe-=J.extra,J.back+=J.extra}J.was=J.length,J.mode=23;case 23:for(;At=(je=J.distcode[Ee&(1<<J.distbits)-1])>>>16&255,xt=65535&je,!((ct=je>>>24)<=Oe);){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if((240&At)==0){for(It=ct,jt=At,cn=xt;At=(je=J.distcode[cn+((Ee&(1<<It+jt)-1)>>It)])>>>16&255,xt=65535&je,!(It+(ct=je>>>24)<=Oe);){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}Ee>>>=It,Oe-=It,J.back+=It}if(Ee>>>=ct,Oe-=ct,J.back+=ct,64&At){K.msg="invalid distance code",J.mode=30;break}J.offset=xt,J.extra=15&At,J.mode=24;case 24:if(J.extra){for(Ue=J.extra;Oe<Ue;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}J.offset+=Ee&(1<<J.extra)-1,Ee>>>=J.extra,Oe-=J.extra,J.back+=J.extra}if(J.offset>J.dmax){K.msg="invalid distance too far back",J.mode=30;break}J.mode=25;case 25:if(Re===0)break e;if(ut=at-Re,J.offset>ut){if((ut=J.offset-ut)>J.whave&&J.sane){K.msg="invalid distance too far back",J.mode=30;break}nt=ut>J.wnext?(ut-=J.wnext,J.wsize-ut):J.wnext-ut,ut>J.length&&(ut=J.length),$e=J.window}else $e=Ae,nt=xe-J.offset,ut=J.length;for(Re<ut&&(ut=Re),Re-=ut,J.length-=ut;Ae[xe++]=$e[nt++],--ut;);J.length===0&&(J.mode=21);break;case 26:if(Re===0)break e;Ae[xe++]=J.length,Re--,J.mode=21;break;case 27:if(J.wrap){for(;Oe<32;){if(Ce===0)break e;Ce--,Ee|=de[ne++]<<Oe,Oe+=8}if(at-=Re,K.total_out+=at,J.total+=at,at&&(K.adler=J.check=J.flags?r(J.check,Ae,at,xe-at):S(J.check,Ae,at,xe-at)),at=Re,(J.flags?Ee:H(Ee))!==J.check){K.msg="incorrect data check",J.mode=30;break}Oe=Ee=0}J.mode=28;case 28:if(J.wrap&&J.flags){for(;Oe<32;){if(Ce===0)break e;Ce--,Ee+=de[ne++]<<Oe,Oe+=8}if(Ee!==(4294967295&J.total)){K.msg="incorrect length check",J.mode=30;break}Oe=Ee=0}J.mode=29;case 29:mt=1;break e;case 30:mt=-3;break e;case 31:return-4;case 32:default:return R}return K.next_out=xe,K.avail_out=Re,K.next_in=ne,K.avail_in=Ce,J.hold=Ee,J.bits=Oe,(J.wsize||at!==K.avail_out&&J.mode<30&&(J.mode<27||ye!==4))&&pe(K,K.output,K.next_out,at-K.avail_out)?(J.mode=31,-4):(Be-=K.avail_in,at-=K.avail_out,K.total_in+=Be,K.total_out+=at,J.total+=at,J.wrap&&at&&(K.adler=J.check=J.flags?r(J.check,Ae,at,K.next_out-at):S(J.check,Ae,at,K.next_out-at)),K.data_type=J.bits+(J.last?64:0)+(J.mode===12?128:0)+(J.mode===20||J.mode===15?256:0),(Be==0&&at===0||ye===4)&&mt===z&&(mt=-5),mt)},g.inflateEnd=function(K){if(!K||!K.state)return R;var ye=K.state;return ye.window&&(ye.window=null),K.state=null,z},g.inflateGetHeader=function(K,ye){var J;return K&&K.state?(2&(J=K.state).wrap)==0?R:((J.head=ye).done=!1,z):R},g.inflateSetDictionary=function(K,ye){var J,de=ye.length;return K&&K.state?(J=K.state).wrap!==0&&J.mode!==11?R:J.mode===11&&S(1,ye,de,0)!==J.check?-3:pe(K,ye,de,de)?(J.mode=31,-4):(J.havedict=1,z):R},g.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(c,p,g){var v=c("../utils/common"),S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],E=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],A=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];p.exports=function(I,F,z,R,D,O,N,H){var j,V,Z,X,se,ge,ae,oe,fe,pe=H.bits,K=0,ye=0,J=0,de=0,Ae=0,ne=0,xe=0,Ce=0,Re=0,Ee=0,Oe=null,Be=0,at=new v.Buf16(16),ut=new v.Buf16(16),nt=null,$e=0;for(K=0;K<=15;K++)at[K]=0;for(ye=0;ye<R;ye++)at[F[z+ye]]++;for(Ae=pe,de=15;1<=de&&at[de]===0;de--);if(de<Ae&&(Ae=de),de===0)return D[O++]=20971520,D[O++]=20971520,H.bits=1,0;for(J=1;J<de&&at[J]===0;J++);for(Ae<J&&(Ae=J),K=Ce=1;K<=15;K++)if(Ce<<=1,(Ce-=at[K])<0)return-1;if(0<Ce&&(I===0||de!==1))return-1;for(ut[1]=0,K=1;K<15;K++)ut[K+1]=ut[K]+at[K];for(ye=0;ye<R;ye++)F[z+ye]!==0&&(N[ut[F[z+ye]]++]=ye);if(ge=I===0?(Oe=nt=N,19):I===1?(Oe=S,Be-=257,nt=r,$e-=257,256):(Oe=E,nt=A,-1),K=J,se=O,xe=ye=Ee=0,Z=-1,X=(Re=1<<(ne=Ae))-1,I===1&&852<Re||I===2&&592<Re)return 1;for(;;){for(ae=K-xe,fe=N[ye]<ge?(oe=0,N[ye]):N[ye]>ge?(oe=nt[$e+N[ye]],Oe[Be+N[ye]]):(oe=96,0),j=1<<K-xe,J=V=1<<ne;D[se+(Ee>>xe)+(V-=j)]=ae<<24|oe<<16|fe|0,V!==0;);for(j=1<<K-1;Ee&j;)j>>=1;if(j!==0?(Ee&=j-1,Ee+=j):Ee=0,ye++,--at[K]==0){if(K===de)break;K=F[z+N[ye]]}if(Ae<K&&(Ee&X)!==Z){for(xe===0&&(xe=Ae),se+=J,Ce=1<<(ne=K-xe);ne+xe<de&&!((Ce-=at[ne+xe])<=0);)ne++,Ce<<=1;if(Re+=1<<ne,I===1&&852<Re||I===2&&592<Re)return 1;D[Z=Ee&X]=Ae<<24|ne<<16|se-O|0}}return Ee!==0&&(D[se+Ee]=K-xe<<24|64<<16|0),H.bits=Ae,0}},{"../utils/common":41}],51:[function(c,p,g){p.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(c,p,g){var v=c("../utils/common"),S=0,r=1;function E(je){for(var gt=je.length;0<=--gt;)je[gt]=0}var A=0,I=29,F=256,z=F+1+I,R=30,D=19,O=2*z+1,N=15,H=16,j=7,V=256,Z=16,X=17,se=18,ge=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ae=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pe=new Array(2*(z+2));E(pe);var K=new Array(2*R);E(K);var ye=new Array(512);E(ye);var J=new Array(256);E(J);var de=new Array(I);E(de);var Ae,ne,xe,Ce=new Array(R);function Re(je,gt,Ot,Ft,pt){this.static_tree=je,this.extra_bits=gt,this.extra_base=Ot,this.elems=Ft,this.max_length=pt,this.has_stree=je&&je.length}function Ee(je,gt){this.dyn_tree=je,this.max_code=0,this.stat_desc=gt}function Oe(je){return je<256?ye[je]:ye[256+(je>>>7)]}function Be(je,gt){je.pending_buf[je.pending++]=255&gt,je.pending_buf[je.pending++]=gt>>>8&255}function at(je,gt,Ot){je.bi_valid>H-Ot?(je.bi_buf|=gt<<je.bi_valid&65535,Be(je,je.bi_buf),je.bi_buf=gt>>H-je.bi_valid,je.bi_valid+=Ot-H):(je.bi_buf|=gt<<je.bi_valid&65535,je.bi_valid+=Ot)}function ut(je,gt,Ot){at(je,Ot[2*gt],Ot[2*gt+1])}function nt(je,gt){for(var Ot=0;Ot|=1&je,je>>>=1,Ot<<=1,0<--gt;);return Ot>>>1}function $e(je,gt,Ot){var Ft,pt,dn=new Array(N+1),An=0;for(Ft=1;Ft<=N;Ft++)dn[Ft]=An=An+Ot[Ft-1]<<1;for(pt=0;pt<=gt;pt++){var Gt=je[2*pt+1];Gt!==0&&(je[2*pt]=nt(dn[Gt]++,Gt))}}function ct(je){var gt;for(gt=0;gt<z;gt++)je.dyn_ltree[2*gt]=0;for(gt=0;gt<R;gt++)je.dyn_dtree[2*gt]=0;for(gt=0;gt<D;gt++)je.bl_tree[2*gt]=0;je.dyn_ltree[2*V]=1,je.opt_len=je.static_len=0,je.last_lit=je.matches=0}function At(je){8<je.bi_valid?Be(je,je.bi_buf):0<je.bi_valid&&(je.pending_buf[je.pending++]=je.bi_buf),je.bi_buf=0,je.bi_valid=0}function xt(je,gt,Ot,Ft){var pt=2*gt,dn=2*Ot;return je[pt]<je[dn]||je[pt]===je[dn]&&Ft[gt]<=Ft[Ot]}function It(je,gt,Ot){for(var Ft=je.heap[Ot],pt=Ot<<1;pt<=je.heap_len&&(pt<je.heap_len&&xt(gt,je.heap[pt+1],je.heap[pt],je.depth)&&pt++,!xt(gt,Ft,je.heap[pt],je.depth));)je.heap[Ot]=je.heap[pt],Ot=pt,pt<<=1;je.heap[Ot]=Ft}function jt(je,gt,Ot){var Ft,pt,dn,An,Gt=0;if(je.last_lit!==0)for(;Ft=je.pending_buf[je.d_buf+2*Gt]<<8|je.pending_buf[je.d_buf+2*Gt+1],pt=je.pending_buf[je.l_buf+Gt],Gt++,Ft===0?ut(je,pt,gt):(ut(je,(dn=J[pt])+F+1,gt),(An=ge[dn])!==0&&at(je,pt-=de[dn],An),ut(je,dn=Oe(--Ft),Ot),(An=ae[dn])!==0&&at(je,Ft-=Ce[dn],An)),Gt<je.last_lit;);ut(je,V,gt)}function cn(je,gt){var Ot,Ft,pt,dn=gt.dyn_tree,An=gt.stat_desc.static_tree,Gt=gt.stat_desc.has_stree,Yt=gt.stat_desc.elems,zn=-1;for(je.heap_len=0,je.heap_max=O,Ot=0;Ot<Yt;Ot++)dn[2*Ot]!==0?(je.heap[++je.heap_len]=zn=Ot,je.depth[Ot]=0):dn[2*Ot+1]=0;for(;je.heap_len<2;)dn[2*(pt=je.heap[++je.heap_len]=zn<2?++zn:0)]=1,je.depth[pt]=0,je.opt_len--,Gt&&(je.static_len-=An[2*pt+1]);for(gt.max_code=zn,Ot=je.heap_len>>1;1<=Ot;Ot--)It(je,dn,Ot);for(pt=Yt;Ot=je.heap[1],je.heap[1]=je.heap[je.heap_len--],It(je,dn,1),Ft=je.heap[1],je.heap[--je.heap_max]=Ot,je.heap[--je.heap_max]=Ft,dn[2*pt]=dn[2*Ot]+dn[2*Ft],je.depth[pt]=(je.depth[Ot]>=je.depth[Ft]?je.depth[Ot]:je.depth[Ft])+1,dn[2*Ot+1]=dn[2*Ft+1]=pt,je.heap[1]=pt++,It(je,dn,1),2<=je.heap_len;);je.heap[--je.heap_max]=je.heap[1],(function($n,On){var Bn,kn,Pr,mr,ni,tr,Br=On.dyn_tree,Tr=On.max_code,Fr=On.stat_desc.static_tree,di=On.stat_desc.has_stree,Mo=On.stat_desc.extra_bits,ds=On.stat_desc.extra_base,Yr=On.stat_desc.max_length,co=0;for(mr=0;mr<=N;mr++)$n.bl_count[mr]=0;for(Br[2*$n.heap[$n.heap_max]+1]=0,Bn=$n.heap_max+1;Bn<O;Bn++)Yr<(mr=Br[2*Br[2*(kn=$n.heap[Bn])+1]+1]+1)&&(mr=Yr,co++),Br[2*kn+1]=mr,Tr<kn||($n.bl_count[mr]++,ni=0,ds<=kn&&(ni=Mo[kn-ds]),tr=Br[2*kn],$n.opt_len+=tr*(mr+ni),di&&($n.static_len+=tr*(Fr[2*kn+1]+ni)));if(co!==0){do{for(mr=Yr-1;$n.bl_count[mr]===0;)mr--;$n.bl_count[mr]--,$n.bl_count[mr+1]+=2,$n.bl_count[Yr]--,co-=2}while(0<co);for(mr=Yr;mr!==0;mr--)for(kn=$n.bl_count[mr];kn!==0;)Tr<(Pr=$n.heap[--Bn])||(Br[2*Pr+1]!==mr&&($n.opt_len+=(mr-Br[2*Pr+1])*Br[2*Pr],Br[2*Pr+1]=mr),kn--)}})(je,gt),$e(dn,zn,je.bl_count)}function Se(je,gt,Ot){var Ft,pt,dn=-1,An=gt[1],Gt=0,Yt=7,zn=4;for(An===0&&(Yt=138,zn=3),gt[2*(Ot+1)+1]=65535,Ft=0;Ft<=Ot;Ft++)pt=An,An=gt[2*(Ft+1)+1],++Gt<Yt&&pt===An||(Gt<zn?je.bl_tree[2*pt]+=Gt:pt!==0?(pt!==dn&&je.bl_tree[2*pt]++,je.bl_tree[2*Z]++):Gt<=10?je.bl_tree[2*X]++:je.bl_tree[2*se]++,dn=pt,zn=(Gt=0)===An?(Yt=138,3):pt===An?(Yt=6,3):(Yt=7,4))}function mt(je,gt,Ot){var Ft,pt,dn=-1,An=gt[1],Gt=0,Yt=7,zn=4;for(An===0&&(Yt=138,zn=3),Ft=0;Ft<=Ot;Ft++)if(pt=An,An=gt[2*(Ft+1)+1],!(++Gt<Yt&&pt===An)){if(Gt<zn)for(;ut(je,pt,je.bl_tree),--Gt!=0;);else pt!==0?(pt!==dn&&(ut(je,pt,je.bl_tree),Gt--),ut(je,Z,je.bl_tree),at(je,Gt-3,2)):Gt<=10?(ut(je,X,je.bl_tree),at(je,Gt-3,3)):(ut(je,se,je.bl_tree),at(je,Gt-11,7));dn=pt,zn=(Gt=0)===An?(Yt=138,3):pt===An?(Yt=6,3):(Yt=7,4)}}E(Ce);var Ke=!1;function Ue(je,gt,Ot,Ft){at(je,(A<<1)+(Ft?1:0),3),(function(pt,dn,An,Gt){At(pt),Be(pt,An),Be(pt,~An),v.arraySet(pt.pending_buf,pt.window,dn,An,pt.pending),pt.pending+=An})(je,gt,Ot)}g._tr_init=function(je){Ke||((function(){var gt,Ot,Ft,pt,dn,An=new Array(N+1);for(pt=Ft=0;pt<I-1;pt++)for(de[pt]=Ft,gt=0;gt<1<<ge[pt];gt++)J[Ft++]=pt;for(J[Ft-1]=pt,pt=dn=0;pt<16;pt++)for(Ce[pt]=dn,gt=0;gt<1<<ae[pt];gt++)ye[dn++]=pt;for(dn>>=7;pt<R;pt++)for(Ce[pt]=dn<<7,gt=0;gt<1<<ae[pt]-7;gt++)ye[256+dn++]=pt;for(Ot=0;Ot<=N;Ot++)An[Ot]=0;for(gt=0;gt<=143;)pe[2*gt+1]=8,gt++,An[8]++;for(;gt<=255;)pe[2*gt+1]=9,gt++,An[9]++;for(;gt<=279;)pe[2*gt+1]=7,gt++,An[7]++;for(;gt<=287;)pe[2*gt+1]=8,gt++,An[8]++;for($e(pe,z+1,An),gt=0;gt<R;gt++)K[2*gt+1]=5,K[2*gt]=nt(gt,5);Ae=new Re(pe,ge,F+1,z,N),ne=new Re(K,ae,0,R,N),xe=new Re(new Array(0),oe,0,D,j)})(),Ke=!0),je.l_desc=new Ee(je.dyn_ltree,Ae),je.d_desc=new Ee(je.dyn_dtree,ne),je.bl_desc=new Ee(je.bl_tree,xe),je.bi_buf=0,je.bi_valid=0,ct(je)},g._tr_stored_block=Ue,g._tr_flush_block=function(je,gt,Ot,Ft){var pt,dn,An=0;0<je.level?(je.strm.data_type===2&&(je.strm.data_type=(function(Gt){var Yt,zn=4093624447;for(Yt=0;Yt<=31;Yt++,zn>>>=1)if(1&zn&&Gt.dyn_ltree[2*Yt]!==0)return S;if(Gt.dyn_ltree[18]!==0||Gt.dyn_ltree[20]!==0||Gt.dyn_ltree[26]!==0)return r;for(Yt=32;Yt<F;Yt++)if(Gt.dyn_ltree[2*Yt]!==0)return r;return S})(je)),cn(je,je.l_desc),cn(je,je.d_desc),An=(function(Gt){var Yt;for(Se(Gt,Gt.dyn_ltree,Gt.l_desc.max_code),Se(Gt,Gt.dyn_dtree,Gt.d_desc.max_code),cn(Gt,Gt.bl_desc),Yt=D-1;3<=Yt&&Gt.bl_tree[2*fe[Yt]+1]===0;Yt--);return Gt.opt_len+=3*(Yt+1)+5+5+4,Yt})(je),pt=je.opt_len+3+7>>>3,(dn=je.static_len+3+7>>>3)<=pt&&(pt=dn)):pt=dn=Ot+5,Ot+4<=pt&&gt!==-1?Ue(je,gt,Ot,Ft):je.strategy===4||dn===pt?(at(je,2+(Ft?1:0),3),jt(je,pe,K)):(at(je,4+(Ft?1:0),3),(function(Gt,Yt,zn,$n){var On;for(at(Gt,Yt-257,5),at(Gt,zn-1,5),at(Gt,$n-4,4),On=0;On<$n;On++)at(Gt,Gt.bl_tree[2*fe[On]+1],3);mt(Gt,Gt.dyn_ltree,Yt-1),mt(Gt,Gt.dyn_dtree,zn-1)})(je,je.l_desc.max_code+1,je.d_desc.max_code+1,An+1),jt(je,je.dyn_ltree,je.dyn_dtree)),ct(je),Ft&&At(je)},g._tr_tally=function(je,gt,Ot){return je.pending_buf[je.d_buf+2*je.last_lit]=gt>>>8&255,je.pending_buf[je.d_buf+2*je.last_lit+1]=255&gt,je.pending_buf[je.l_buf+je.last_lit]=255&Ot,je.last_lit++,gt===0?je.dyn_ltree[2*Ot]++:(je.matches++,gt--,je.dyn_ltree[2*(J[Ot]+F+1)]++,je.dyn_dtree[2*Oe(gt)]++),je.last_lit===je.lit_bufsize-1},g._tr_align=function(je){at(je,2,3),ut(je,V,pe),(function(gt){gt.bi_valid===16?(Be(gt,gt.bi_buf),gt.bi_buf=0,gt.bi_valid=0):8<=gt.bi_valid&&(gt.pending_buf[gt.pending++]=255&gt.bi_buf,gt.bi_buf>>=8,gt.bi_valid-=8)})(je)}},{"../utils/common":41}],53:[function(c,p,g){p.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(c,p,g){(function(v){(function(S,r){if(!S.setImmediate){var E,A,I,F,z=1,R={},D=!1,O=S.document,N=Object.getPrototypeOf&&Object.getPrototypeOf(S);N=N&&N.setTimeout?N:S,E={}.toString.call(S.process)==="[object process]"?function(Z){process.nextTick(function(){j(Z)})}:(function(){if(S.postMessage&&!S.importScripts){var Z=!0,X=S.onmessage;return S.onmessage=function(){Z=!1},S.postMessage("","*"),S.onmessage=X,Z}})()?(F="setImmediate$"+Math.random()+"$",S.addEventListener?S.addEventListener("message",V,!1):S.attachEvent("onmessage",V),function(Z){S.postMessage(F+Z,"*")}):S.MessageChannel?((I=new MessageChannel).port1.onmessage=function(Z){j(Z.data)},function(Z){I.port2.postMessage(Z)}):O&&"onreadystatechange"in O.createElement("script")?(A=O.documentElement,function(Z){var X=O.createElement("script");X.onreadystatechange=function(){j(Z),X.onreadystatechange=null,A.removeChild(X),X=null},A.appendChild(X)}):function(Z){setTimeout(j,0,Z)},N.setImmediate=function(Z){typeof Z!="function"&&(Z=new Function(""+Z));for(var X=new Array(arguments.length-1),se=0;se<X.length;se++)X[se]=arguments[se+1];var ge={callback:Z,args:X};return R[z]=ge,E(z),z++},N.clearImmediate=H}function H(Z){delete R[Z]}function j(Z){if(D)setTimeout(j,0,Z);else{var X=R[Z];if(X){D=!0;try{(function(se){var ge=se.callback,ae=se.args;switch(ae.length){case 0:ge();break;case 1:ge(ae[0]);break;case 2:ge(ae[0],ae[1]);break;case 3:ge(ae[0],ae[1],ae[2]);break;default:ge.apply(r,ae)}})(X)}finally{H(Z),D=!1}}}}function V(Z){Z.source===S&&typeof Z.data=="string"&&Z.data.indexOf(F)===0&&j(+Z.data.slice(F.length))}})(typeof self>"u"?v===void 0?this:v:self)}).call(this,typeof Jg<"u"?Jg:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(yw)),yw.exports}var Ite=Mte();const Rte=al(Ite),r6=()=>{zL()},lS=async({projectName:t,chartType:s,description:c,forecastDate:p,onNew:g,setShowModal:v,setMainOpen:S,setProjectOpen:r,setProjectName:E,setChartType:A,setDescription:I})=>{if(!t.trim()){Po.fire({toast:!0,position:"top-end",icon:"error",title:"Project Name is required!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}try{const z=await Jj({name:t,chartType:s,description:c,forecastDate:p});localStorage.setItem("projectId",z._id),localStorage.setItem("projectName",t),localStorage.setItem("chartType",s),localStorage.setItem("forecastDate",p),g&&g({name:t,chartType:s,description:c,forecastDate:p}),Po.fire({toast:!0,position:"top-end",icon:"success",title:`Project "${t}" created successfully`,showConfirmButton:!1,timer:2e3}),v(!1),S(!1),r(!1),E(""),A(""),I(""),setTimeout(()=>window.location.reload(),1500)}catch(F){Po.fire({toast:!0,position:"top-end",icon:"error",title:F.message,showConfirmButton:!1,timer:3e3})}};async function i6(t,s){const c=localStorage.getItem("isDarkMode")==="true",p=localStorage.getItem("projectName")||"map_snapshots",g=async(z,R=6e3,D=200)=>{const O=Math.floor(R/D);for(let N=0;N<O;N++){if(localStorage.getItem(z))return!0;await new Promise(j=>setTimeout(j,D))}return!1};localStorage.removeItem("map_snapshot_light"),localStorage.removeItem("map_snapshot_dark"),Po.fire({title:"Downloading...",html:"Please wait while we prepare the ZIP file.",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>Po.showLoading()}),typeof t=="function"&&t(!c),await g(c?"map_snapshot_light":"map_snapshot_dark"),typeof t=="function"&&t(c),await g(c?"map_snapshot_dark":"map_snapshot_light");const r=localStorage.getItem("map_snapshot_light"),E=localStorage.getItem("map_snapshot_dark"),A=new Rte;if(r&&A.file("map_snapshot_light.png",r.split(",")[1],{base64:!0}),E&&A.file("map_snapshot_dark.png",E.split(",")[1],{base64:!0}),s&&s.type==="FeatureCollection"&&Array.isArray(s.features)){const z=JSON.stringify(s,null,2);A.file("features.geojson",z)}else console.error("Invalid or malformed GeoJSON:",s),Po.fire({icon:"error",title:"Invalid GeoJSON Format",text:"The provided GeoJSON is not valid. It will not be included in the download.",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1});const I=await A.generateAsync({type:"blob"}),F=document.createElement("a");F.href=URL.createObjectURL(I),F.download=`${p.replace(/\s+/g,"_")}.zip`,document.body.appendChild(F),F.click(),document.body.removeChild(F),Po.close(),Po.fire({icon:"success",title:"Downloaded",text:"Snapshots and GeoJSON exported as ZIP.",toast:!0,position:"top-end",timer:3e3,showConfirmButton:!1,willOpen:z=>{z.style.zIndex="9999"}})}const Dte=({blink:t,onNew:s,onSave:c,onView:p,onExport:g,mapRef:v,features:S,isDarkMode:r,setIsDarkMode:E,setMapLoaded:A,isLoading:I})=>{const[F,z]=Te.useState(!1),[R,D]=Te.useState(!1),[O,N]=Te.useState(!1),[H,j]=Te.useState(!1),[V,Z]=Te.useState(!1),[X,se]=Te.useState(""),[ge,ae]=Te.useState([]),[oe,fe]=Te.useState(!1),[pe,K]=Te.useState(""),[ye,J]=Te.useState("Wave Analysis"),[de,Ae]=Te.useState(!1),ne=Te.useRef(null),[xe,Ce]=Te.useState(Es());Te.useEffect(()=>{const Oe=Be=>{ne.current&&!ne.current.contains(Be.target)&&(z(!1),D(!1))};return document.addEventListener("mousedown",Oe),()=>document.removeEventListener("mousedown",Oe)},[]);const Re=async Oe=>{Z(!0);try{const Be=new FormData;Be.append("projectFile",Oe),Be.append("projectId",localStorage.getItem("projectId")),console.log("Submitting file:",Oe),j(!1)}catch(Be){console.error("Submission failed:",Be)}finally{Z(!1)}},Ee=async Oe=>{try{await wR(Oe),localStorage.removeItem("projectId"),localStorage.removeItem("projectName");const Be=await $w();ae(Be),window.location.reload()}catch(Be){console.error("Failed to delete project:",Be)}};return ue.jsxs(Ste,{ref:ne,children:[ue.jsx(Cte,{onClick:()=>{z(!F),D(!1)},blink:t&&!localStorage.getItem("projectId"),children:""}),F&&ue.jsxs(Ete,{children:[ue.jsx(Sy,{onClick:()=>D(!R),"aria-expanded":R,children:"Project"}),R&&ue.jsxs(Ate,{children:[ue.jsx(_w,{onClick:()=>N(!0),children:"New Project"}),ue.jsx(_w,{onClick:async()=>{try{const Oe=await $w();ae(Oe),fe(!0)}catch{Po.fire({toast:!0,position:"top-end",icon:"error",title:"Failed to load projects",showConfirmButton:!1,timer:2500})}},children:"Open Project"}),ue.jsx(_w,{onClick:async()=>{i6(E,S)},children:"Export Project"})]}),ue.jsx(Sy,{onClick:p,children:"View"}),ue.jsx(Sy,{onClick:()=>j(!0),children:"Submit"}),ue.jsx(Sy,{onClick:r6,$danger:!0,children:"Logout"})]}),O&&ue.jsx(wx,{visible:O,onClose:()=>N(!1),onSubmit:()=>lS({projectName:X,chartType:ye,description:pe,forecastDate:xe,onNew:s,setShowModal:N,setMainOpen:z,setProjectOpen:D,setProjectName:se,setChartType:J,setDescription:K}),projectName:X,setProjectName:se,chartType:ye,setChartType:J,description:pe,setDescription:K,forecastDate:xe,setForecastDate:Ce}),oe&&ue.jsx(aS,{visible:oe,projects:ge,onClose:()=>fe(!1),onDelete:Ee,onSelect:Oe=>{console.log("Selected project:",Oe),localStorage.setItem("projectId",Oe._id),localStorage.setItem("projectName",Oe.name),localStorage.setItem("chartType",Oe.chartType||"12"),c&&c(Oe),z(!1),D(!1),fe(!1)}}),de&&ue.jsx(Pte,{children:"Exporting map, please wait..."}),H&&ue.jsx(sS,{visible:H,onClose:()=>j(!1),onSubmit:Re,projectTitle:localStorage.getItem("projectName")||"Untitled Project",projectType:localStorage.getItem("chartType")||"Wave Analysis",forecastDate:xe||"Not set",isSubmitting:V,isDarkMode:r})]})};ll`
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
`;const mb=ll`
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
`,kte=ll`
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(59, 130, 246, 0);
  }
`,Ote=ll`
  0%, 100% { 
    border-color: transparent;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  }
  50% { 
    border-color: rgba(255, 99, 132, 0.6);
    box-shadow: 
      0 8px 32px 0 rgba(31, 38, 135, 0.37),
      0 0 20px rgba(255, 99, 132, 0.4),
      inset 0 0 20px rgba(255, 99, 132, 0.1);
  }
`,gM=pn.div`
  background: ${({theme:t})=>t?.colors?.bgPrimary};
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  
  padding: ${({theme:t})=>t.spacing.medium||"1.5rem"};
  border-radius: ${({theme:t})=>t.borderRadius.xlarge||"16px"};
  border: 1px solid ${({theme:t})=>t.colors.textPrimary};
  font-family: ${({theme:t})=>t.fonts.regular||"'Inter', sans-serif"};
  color: ${({theme:t})=>t.colors.textPrimary};

  width: 320px;
  max-width: 380px;
  max-height: clamp(400px, 55vh, 600px);
  overflow-y: auto;

  /* Hide scrollbar but keep scrolling */
  scrollbar-width: none; /* Firefox */
  ms-overflow-style: none; /* IE/Edge */
  &::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }

  box-shadow: ${({theme:t})=>t.isDark?"0 25px 50px -12px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05)":"0 25px 50px -12px rgba(0,0,0,0.25), 0 0 0 1px rgba(0,0,0,0.05)"};
  
  transform: scale(1);
  transition: all 0.3s cubic-bezier(0.4,0,0.2,1);

  &:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: ${({theme:t})=>t.isDark?"0 32px 64px -12px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.1)":"0 32px 64px -12px rgba(0,0,0,0.35), 0 0 0 1px rgba(0,0,0,0.08)"};
    border-color: ${({theme:t})=>t.isDark?"rgba(59,130,246,0.3)":"rgba(59,130,246,0.2)"};
  }

  &:active {
    transform: translateY(-2px) scale(1.01);
  }

  /* Blink animation when no project is selected */
  ${t=>t.$shouldBlink&&uh`
      animation: ${Ote} 0.8s ease-in-out 3;
    `}

  /* Responsive */
  @media (max-width: 768px) {
    width: calc(100vw - 2rem);
    max-width: calc(100vw - 2rem);
    max-height: clamp(320px, 55vh, 500px);
    right: 1rem;
    bottom: ${({theme:t})=>t.spacing.medium||"1rem"};
    padding: 1.25rem;
  }
`,_M=pn.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
  padding: 0 1.5rem 1rem;   /* keep inner spacing */
  margin-left: -1.5rem;     /* cancel container padding */
  margin-right: -1.5rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
`,yM=pn.h3`
  margin: 0;
  font-size: 1.125rem;
  font-weight: 600;
  color: ${({theme:t})=>t?.colors?.textPrimary||"#1f2937"};
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-left: 3.5rem; 


`,Lte=pn.div`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
`,zte=pn.button`
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.2) 0%, 
    rgba(255, 255, 255, 0.1) 100%
  );
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  
  color: ${({theme:t})=>t?.colors?.textPrimary||"#2d3748"};
  border: 1px solid rgba(255, 255, 255, 0.3);
  padding: 0.5rem;
  font-size: 0.9rem;
  border-radius: 8px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  
  box-shadow: 
    0 4px 16px 0 rgba(31, 38, 135, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  &:hover {
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.3) 0%, 
      rgba(255, 255, 255, 0.2) 100%
    );
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-1px) scale(1.05);
    box-shadow: 
      0 8px 24px 0 rgba(31, 38, 135, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
  }

  &:active {
    transform: translateY(0) scale(0.98);
  }
`,Fte=pn(zte)`
  color: ${({theme:t})=>t?.isDark?"#60a5fa":"#3b82f6"};
`,Bte=pn.div`
  display: ${({$visible:t})=>t?"block":"none"};
  position: absolute;
  top: 3rem;
  left: 0;
  margin-top: 0.75rem;
  min-width: 220px;
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.18) 0%,
    rgba(255, 255, 255, 0.08) 100%
  );
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 14px;
  padding: 6px;
  
  box-shadow: 
    0 20px 80px 0 rgba(31, 38, 135, 0.45),
    0 10px 40px 0 rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  
  animation: ${mb} 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  z-index: 1001;
`,Ty=pn.button`
  width: 100%;
  background: transparent;
  border: 1px solid transparent;
  padding: 0.875rem 1.25rem;
  font-size: 0.95rem;
  font-weight: 500;
  text-align: left;
  cursor: pointer;
  position: relative;
  
  color: ${({$danger:t})=>t?"#ef4444":"inherit"};
  
  border-radius: 12px;
  margin: 2px 0;
  
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  gap: 0.75rem;

  &:hover {
    background: linear-gradient(135deg,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.1) 100%
    );
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateX(4px);
    
    box-shadow: 
      0 4px 16px 0 rgba(31, 38, 135, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);

    ${({$danger:t})=>t&&uh`
        background: linear-gradient(135deg,
          rgba(239, 68, 68, 0.15) 0%,
          rgba(239, 68, 68, 0.05) 100%
        );
        border-color: rgba(239, 68, 68, 0.3);
        box-shadow: 
          0 4px 16px 0 rgba(239, 68, 68, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.4);
      `}
  }

  &:active {
    transform: translateX(2px) scale(0.98);
  }
`,Nte=pn.div`
  position: absolute;
  top: 0;
  left: calc(100% - 12px);
  min-width: 200px;
  
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.18) 0%,
    rgba(255, 255, 255, 0.08) 100%
  );
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 14px;
  padding: 6px;
  
  box-shadow: 
    0 20px 80px 0 rgba(31, 38, 135, 0.45),
    0 10px 40px 0 rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  
  animation: ${mb} 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
`,vw=pn(Ty)`
  padding: 0.75rem 1rem;
  font-size: 0.9rem;
  margin: 1px 0;
  
  &:hover {
    transform: translateX(-6px);
    background: linear-gradient(135deg,
      rgba(139, 92, 246, 0.15) 0%,
      rgba(139, 92, 246, 0.05) 100%
    );
    border-color: rgba(139, 92, 246, 0.3);
    box-shadow: 
      0 4px 16px 0 rgba(139, 92, 246, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }
`,P1=pn.div`
  display: flex;
  align-items: flex-start;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
  
  &:last-child {
    margin-bottom: 0;
  }
  
  &:hover {
    transform: translateX(4px);
  }
`,M1=pn.div`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  border-radius: 8px;
  background: ${({iconType:t,theme:s})=>{const c={project:"rgba(34, 197, 94, 0.1)",chart:"rgba(168, 85, 247, 0.1)",date:"rgba(59, 130, 246, 0.1)"};return c[t]||c.project}};
  color: ${({iconType:t,theme:s})=>{const c={project:"#22c55e",chart:"#8b5cf6",date:"#3b82f6"};return c[t]||c.project}};
  margin-right: 0.75rem;
  flex-shrink: 0;
`,I1=pn.div`
  flex: 1;
  min-width: 0;
`,R1=pn.div`
  font-size: 0.75rem;
  font-weight: 500;
    color: ${({theme:t})=>t.colors.textPrimary};
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.25rem;
`,D1=pn.div`
  font-size: 0.95rem;
  font-weight: 500;
  color: ${({theme:t})=>t?.colors?.textPrimary||"#1f2937"};
  word-break: break-word;
  line-height: 1.4;
`,vM=pn.div`
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 200;
  backdrop-filter: blur(8px);
  animation: ${mb} 0.3s ease-out;
`,xM=pn.div`
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.95) 0%,
    rgba(255, 255, 255, 0.85) 100%
  );
  backdrop-filter: blur(20px);
  padding: 2rem;
  border-radius: 20px;
  width: 100%;
  max-width: 500px;
  margin: 1rem;
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #1f2937;
  transform: scale(0.95);
  animation: ${mb} 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;

  h2, h3 {
    margin: 0 0 1.5rem 0;
    font-size: 1.5rem;
    font-weight: 600;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  @media (max-width: 768px) {
    padding: 1.5rem;
    margin: 0.5rem;
  }
`,bM=pn.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.1) 0%,
    rgba(255, 255, 255, 0.05) 100%
  );
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  
  color: #1f2937;
  font-size: 1.8rem;
  font-weight: 600;
  letter-spacing: 0.05em;
  user-select: none;
  
  animation: ${kte} 2s ease-in-out infinite;
  
  text-shadow: 
    0 2px 10px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 255, 255, 0.5);
`,k1=pn.div`
  margin-bottom: 1.5rem;
  
  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    font-size: 0.875rem;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
`,xw=pn.input`
  width: 100%;
  padding: 1rem;
  font-size: 0.95rem;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  background: rgba(248, 250, 252, 0.8);
  color: #1f2937;
  box-sizing: border-box;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  &:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.9);
  }
`,wM=pn.div`
  display: flex;
  gap: 1rem;
  margin-top: 2rem;

  @media (max-width: 768px) {
    flex-direction: column;
  }
`,O1=pn.button`
  padding: 1rem 1.5rem;
  font-size: 0.9rem;
  border: none;
  border-radius: 12px;
  font-weight: 500;
  cursor: ${({disabled:t})=>t?"not-allowed":"pointer"};
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  flex: 1;
  min-height: 48px;
  position: relative;
  overflow: hidden;
  
  ${({disabled:t,danger:s})=>t?uh`
        background: rgba(148, 163, 184, 0.3);
        color: #94a3b8;
      `:s?uh`
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        border: 1px solid rgba(239, 68, 68, 0.3);
        
        &:hover {
          background: linear-gradient(135deg, #dc2626, #b91c1c);
          box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
      `:uh`
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      border: 1px solid rgba(59, 130, 246, 0.3);
      
      &:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
      }
    `}

  &:hover {
    transform: ${({disabled:t})=>t?"none":"translateY(-2px)"};
  }
`,Vte=({blink:t,setBlink:s,projectId:c,onNew:p,onSave:g,onView:v,features:S,isDarkMode:r,setIsDarkMode:E,setIsLoading:A,isLoading:I})=>{const[F,z]=Te.useState(!1),[R,D]=Te.useState(!1),[O,N]=Te.useState(!1),[H,j]=Te.useState(!1),[V,Z]=Te.useState(!1),[X,se]=Te.useState([]),[ge,ae]=Te.useState(!1),[oe,fe]=Te.useState(!1),pe=Te.useRef(null),[K,ye]=Te.useState(Es()),[J,de]=Te.useState(""),[Ae,ne]=Te.useState(""),[xe,Ce]=Te.useState(""),[Re,Ee]=Te.useState(!1),[Oe,Be]=Te.useState(""),[at,ut]=Te.useState(""),[nt,$e]=Te.useState(""),[ct,At]=Te.useState(!1),[xt,It]=Te.useState("");AM(),Te.useEffect(()=>{const Ke=Ue=>{pe.current&&!pe.current.contains(Ue.target)&&(z(!1),D(!1))};return document.addEventListener("mousedown",Ke),()=>document.removeEventListener("mousedown",Ke)},[]),Te.useEffect(()=>{(async()=>{const Ue=localStorage.getItem("projectId");if(!Ue){Po.fire({icon:"warning",title:"No Project Selected",text:"Please create or select a valid project before continuing."}),A(!1);return}try{const je=await bR(Ue);if(!je){Po.fire({icon:"warning",title:"Project Not Found",text:"The selected project could not be loaded."}),A(!1);return}de(je.name),ne(je.chartType),Ce(je.description||"");const Ot=new Date(je.forecastDate).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});ye(Ot)}catch(je){console.error("Error fetching project:",je),Po.fire({icon:"error",title:"Error",text:"Failed to fetch project data."})}finally{A(!1)}})()},[]);const jt=async Ke=>{Z(!0);try{const Ue=new FormData;Ue.append("projectFile",Ke),Ue.append("projectId",localStorage.getItem("projectId")),console.log("Submitting file:",Ke),j(!1)}catch(Ue){console.error("Submission failed:",Ue)}finally{Z(!1)}},cn=Ke=>{Ke&&Ke.stopPropagation(),Be(J),ut(Ae),$e(K),Ee(!0)},Se=async()=>{try{const Ke=localStorage.getItem("projectId"),je=await eG(Ke,{name:Oe,chartType:at,forecastDate:nt});de(je.name),ne(je.chartType),ye(je.forecastDate),Ee(!1),Po.fire({icon:"success",title:"Project updated successfully!",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(Ke){Po.fire({icon:"error",title:"Error updating project",text:Ke.message||"An unexpected error occurred",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}},mt=async()=>{if(xt===J)try{const Ke=localStorage.getItem("projectId");await wR(Ke),localStorage.removeItem("projectId"),localStorage.removeItem("projectName"),localStorage.removeItem("chartType"),localStorage.removeItem("forecastDate"),Po.fire({icon:"success",title:"Project deleted successfully!",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}).then(()=>{window.location.reload()}),At(!1)}catch(Ke){Po.fire({icon:"error",title:"Error deleting project",text:Ke.message||"An unexpected error occurred",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}};return J?ue.jsxs(ue.Fragment,{children:[ue.jsxs(gM,{ref:pe,children:[ue.jsxs(_M,{children:[ue.jsxs(yM,{children:[ue.jsx(Bg,{}),"Project Details"]}),ue.jsx(Lte,{children:ue.jsx(Fte,{onClick:cn,children:ue.jsx(HL,{})})})]}),ue.jsxs(P1,{children:[ue.jsx(M1,{iconType:"project",children:ue.jsx(Bg,{})}),ue.jsxs(I1,{children:[ue.jsx(R1,{children:"Project Name"}),ue.jsx(D1,{children:J})]})]}),ue.jsxs(P1,{children:[ue.jsx(M1,{iconType:"chart",children:ue.jsx(kM,{})}),ue.jsxs(I1,{children:[ue.jsx(R1,{children:"Chart Type"}),ue.jsx(D1,{children:Ae||"Not specified"})]})]}),ue.jsxs(P1,{children:[ue.jsx(M1,{iconType:"date",children:ue.jsx(DM,{})}),ue.jsxs(I1,{children:[ue.jsx(R1,{children:"Forecast Date"}),ue.jsx(D1,{children:K||"Not set"})]})]})]}),Re&&ue.jsx(vM,{onClick:()=>Ee(!1),children:ue.jsxs(xM,{onClick:Ke=>Ke.stopPropagation(),children:[ue.jsx("h2",{children:"Edit Project Details"}),ue.jsxs(k1,{children:[ue.jsx("label",{children:"Project Name"}),ue.jsx(xw,{value:Oe,onChange:Ke=>Be(Ke.target.value),placeholder:"Enter project name"})]}),ue.jsxs(k1,{children:[ue.jsx("label",{children:"Chart Type"}),ue.jsx(xw,{value:at,onChange:Ke=>ut(Ke.target.value),placeholder:"Enter chart type"})]}),ue.jsxs(k1,{children:[ue.jsx("label",{children:"Forecast Date"}),ue.jsx(jS,{dateAdapter:QD,children:ue.jsx(JD,{value:Es(new Date(nt)),onChange:Ke=>{if(Ke){const Ue=new Date(Ke).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});$e(Ue)}},slotProps:{textField:{fullWidth:!0,variant:"standard",InputProps:{disableUnderline:!0,sx:{backgroundColor:"rgba(248, 250, 252, 0.8)",borderRadius:"12px",fontSize:"0.95rem",color:"#1f2937",height:"56px",paddingLeft:"1rem",border:"1px solid rgba(0, 0, 0, 0.1)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{borderColor:"rgba(0, 0, 0, 0.15)"},"&.Mui-focused":{borderColor:"#3b82f6",boxShadow:"0 0 0 3px rgba(59, 130, 246, 0.1)",transform:"translateY(-2px)",backgroundColor:"rgba(255, 255, 255, 0.9)"}}}}}})})]}),ue.jsxs(wM,{children:[ue.jsx(O1,{onClick:()=>Ee(!1),children:"Cancel"}),ue.jsx(O1,{onClick:Se,children:"Save Changes"})]})]})}),ct&&ue.jsx(vM,{onClick:()=>At(!1),children:ue.jsxs(xM,{onClick:Ke=>Ke.stopPropagation(),children:[ue.jsx("h3",{children:" Confirm Deletion"}),ue.jsxs("p",{children:["This action cannot be undone. To confirm deletion of this project, please type ",ue.jsxs("strong",{children:['"',J,'"']})," in the field below."]}),ue.jsx(k1,{children:ue.jsx(xw,{placeholder:`Type "${J}" to confirm`,value:xt,onChange:Ke=>It(Ke.target.value)})}),ue.jsxs(wM,{children:[ue.jsx(O1,{onClick:()=>At(!1),children:"Cancel"}),ue.jsxs(O1,{danger:!0,disabled:xt!==J,onClick:mt,children:[ue.jsx(zM,{style:{marginRight:"0.5rem"}}),"Confirm Delete"]})]})]})}),O&&ue.jsx(wx,{visible:O,onClose:()=>N(!1),onSubmit:()=>lS({projectName:J,chartType:Ae,description:xe,forecastDate:K,onNew:p,setShowModal:N,setMainOpen:z,setProjectOpen:D,setProjectName:de,setChartType:ne,setDescription:Ce}),projectName:J,setProjectName:de,chartType:Ae,setChartType:ne,description:xe,setDescription:Ce,forecastDate:K,setForecastDate:ye}),ge&&ue.jsx(aS,{visible:ge,projects:X,onClose:()=>ae(!1),onSelect:Ke=>{console.log("Selected project:",Ke),localStorage.setItem("projectId",Ke._id),localStorage.setItem("projectName",Ke.name),localStorage.setItem("chartType",Ke.chartType||"12"),g&&g(Ke),z(!1),D(!1),ae(!1)}}),oe&&ue.jsx(bM,{children:"Exporting map, please wait..."}),H&&ue.jsx(sS,{visible:H,onClose:()=>j(!1),onSubmit:jt,projectTitle:localStorage.getItem("projectName")||"Untitled Project",projectType:localStorage.getItem("chartType")||"Wave Analysis",forecastDate:K||"Not set",isSubmitting:V,isDarkMode:r})]}):ue.jsxs(gM,{ref:pe,$shouldBlink:t&&!c,children:[ue.jsx(_M,{children:ue.jsxs(yM,{children:[ue.jsx(Bg,{}),"No Project Selected"]})}),F&&ue.jsxs(Bte,{children:[ue.jsxs(Ty,{onClick:()=>D(!R),"aria-expanded":R,children:[ue.jsx(Bg,{}),"Project"]}),R&&ue.jsxs(Nte,{children:[ue.jsxs(vw,{onClick:()=>N(!0),children:[ue.jsx(LM,{}),"New Project"]}),ue.jsxs(vw,{onClick:async()=>{try{const Ke=await $w();se(Ke),ae(!0)}catch{Po.fire({toast:!0,position:"top-end",icon:"error",title:"Failed to load projects",showConfirmButton:!1,timer:2500})}},children:[ue.jsx(Bg,{}),"Open Project"]}),ue.jsxs(vw,{onClick:async()=>{i6(E,S)},children:[ue.jsx(ZL,{}),"Export Project"]})]}),ue.jsxs(Ty,{onClick:v,children:[ue.jsx(OM,{}),"View"]}),ue.jsxs(Ty,{onClick:()=>j(!0),children:[ue.jsx(JL,{}),"Submit"]}),ue.jsxs(Ty,{onClick:r6,$danger:!0,children:[ue.jsx(QL,{}),"Logout"]})]}),ue.jsxs(P1,{children:[ue.jsx(M1,{iconType:"project",children:ue.jsx(Bg,{})}),ue.jsxs(I1,{children:[ue.jsx(R1,{children:"Status"}),ue.jsx(D1,{children:"Please create or select a project to get started"})]})]}),O&&ue.jsx(wx,{visible:O,onClose:()=>N(!1),onSubmit:()=>lS({projectName:J,chartType:Ae,description:xe,forecastDate:K,onNew:p,setShowModal:N,setMainOpen:z,setProjectOpen:D,setProjectName:de,setChartType:ne,setDescription:Ce}),projectName:J,setProjectName:de,chartType:Ae,setChartType:ne,description:xe,setDescription:Ce,forecastDate:K,setForecastDate:ye}),ge&&ue.jsx(aS,{visible:ge,projects:X,onClose:()=>ae(!1),onSelect:Ke=>{console.log("Selected project:",Ke),localStorage.setItem("projectId",Ke._id),localStorage.setItem("projectName",Ke.name),localStorage.setItem("chartType",Ke.chartType||"12"),g&&g(Ke),z(!1),D(!1),ae(!1)}}),oe&&ue.jsx(bM,{children:"Exporting map, please wait..."}),H&&ue.jsx(sS,{visible:H,onClose:()=>j(!1),onSubmit:jt,projectTitle:localStorage.getItem("projectName")||"Untitled Project",projectType:localStorage.getItem("chartType")||"Wave Analysis",forecastDate:K||"Not set",isSubmitting:V,isDarkMode:r})]})},Ute=pn.div`
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: ${({theme:t})=>t.colors.loadingBackground||"rgba(0, 0, 0, 0.3)"};
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
`,jte=pn(qy.div)`
  background: ${({theme:t})=>t.colors.lightBackground};
  padding: 30px 20px;
  border-radius: 16px;
  max-width: 320px;
  width: 100%;
  text-align: center;
  position: relative;
  box-shadow: ${({theme:t})=>t.colors.boxShadow};
  font-family: ${({theme:t})=>t.fonts.regular};
`,Gte=pn.div`
  background: ${({theme:t})=>t.colors.itemBackground||"#f1f5f9"};
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 16px;
`,$te=pn.h2`
  font-size: ${({theme:t})=>t.fontSizes.medium};
  font-weight: ${({theme:t})=>t.fontWeights.bold};
  margin-bottom: ${({theme:t})=>t.spacing.small};
  color: ${({theme:t})=>t.colors.textPrimary};
`,Hte=pn.input`
  width: 90%;
  padding: 10px 12px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 20px;
  outline: none;

  &:focus {
    border-color: #2563eb;
  }
`,qte=pn.button`
  background-color: ${({theme:t})=>t.mainColors.blue};
  color: ${({theme:t})=>t.mainColors.white};
  border: none;
  border-radius: ${({theme:t})=>t.borderRadius.medium};
  padding: ${({theme:t})=>`${t.spacing.small} ${t.spacing.medium}`};
  font-weight: ${({theme:t})=>t.fontWeights.medium};
  font-family: ${({theme:t})=>t.fonts.medium};
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  justify-content: center;
  margin-bottom: 10px;

  &:hover {
    background-color: ${({theme:t})=>t.mainColors.lightBlue};
  }

  &:last-child {
    margin-bottom: 0;
  }
`,Wte={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},Zte=({isOpen:t,onClose:s,onSave:c,inputValue:p,onInputChange:g})=>{const v=()=>{c(p||"Untitled Marker")},S=r=>{r.key==="Enter"&&v()};return ue.jsx(Hy,{children:t&&ue.jsx(Ute,{onClick:s,children:ue.jsxs(jte,{variants:Wte,initial:"hidden",animate:"visible",exit:"exit",onClick:r=>r.stopPropagation(),children:[ue.jsx(Gte,{children:ue.jsx(MM,{size:22,color:"#2563eb"})}),ue.jsx($te,{children:"Enter Typhoon or Storm Name"}),ue.jsx(Hte,{type:"text",value:p,onChange:r=>g(r.target.value),placeholder:"e.g. Kristine",onKeyDown:S}),ue.jsx(qte,{onClick:v,children:"Add Marker"})]})})})},Yte=ll`
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
`,Xte=ll`
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
`,Kte=pn.div`
  position: fixed;
  inset: 0;
  background: rgba(15, 15, 15, 0.65);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9998;
`,Jte=pn.div`
  background: rgb(255, 255, 255);
  padding: 2rem 2.5rem;
  border-radius: 16px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  animation: ${Yte} 0.3s ease-out;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
`,Qte=pn(ez)`
  font-size: 2rem;
  color: #0077ff;
  animation: ${Xte} 1s linear infinite;
  margin-bottom: 1rem;
`,ene=pn.p`
  font-size: 1.1rem;
  font-weight: 500;
  color: #333;
  margin: 0;
  max-width: 300px;
`,SM=["Initializing map...","Loading map layers...","Finalizing setup..."],tne=()=>{const[t,s]=Te.useState(0),[c,p]=Te.useState(!1);return Te.useEffect(()=>{const g=setTimeout(()=>{p(!0)},500);return()=>clearTimeout(g)},[]),Te.useEffect(()=>{if(!c)return;const g=setInterval(()=>{s(v=>v<SM.length-1?v+1:v)},500);return()=>clearInterval(g)},[c]),c?ue.jsx(Kte,{children:ue.jsxs(Jte,{children:[ue.jsx(Qte,{}),ue.jsx(ene,{children:SM[t]})]})}):null};function TM({map:t,mapRef:s,setDrawInstance:c,setMapLoaded:p,setSelectedPoint:g,setShowTitleModal:v,setLineCount:S,initialFeatures:r=[],logger:E,setLoading:A,selectedToolRef:I,setCapturedImages:F,isDarkMode:z}){const R=z?"#19b8b7":"#000000",D=z?"#ffffff":"#000000";if(!t)return console.warn("No map instance provided");typeof A=="function"&&A(!0),Oc(t,"typhoon","/hurricane.png"),Oc(t,"low_pressure","/LPA.png"),Oc(t,"high_pressure","/HPA.png"),Oc(t,"less_1","/L1.png"),Oc(t,"0kts","/barbs/0kts.svg"),Oc(t,"5kts","/barbs/5kts.svg"),Oc(t,"10kts","/barbs/10kts.svg"),Oc(t,"15kts","/barbs/15kts.svg"),Oc(t,"20kts","/barbs/20kts.svg"),Oc(t,"25kts","/barbs/25kts.svg"),Oc(t,"30kts","/barbs/30kts.svg"),t.on("load",()=>{HB(t),qB(t)}),t.getSource("12SEP2025v2")&&(t.removeLayer("wind-layer"),t.removeSource("12SEP2025v2")),t.addSource("12SEP2025v2",{type:"raster-array",url:"mapbox://karlbernaldizzy.09182025?fresh="+Date.now(),tileSize:4096}),t.addLayer({id:"wind-layer",type:"raster-particle",source:"12SEP2025v2","source-layer":"10m_wind",slot:"bottom",paint:{"raster-particle-speed-factor":.6,"raster-particle-fade-opacity-factor":.6,"raster-particle-reset-rate-factor":.4,"raster-particle-count":28e3,"raster-particle-max-speed":100,"raster-particle-color":["interpolate",["linear"],["raster-particle-speed"],1.5,"rgba(134,163,171,256)",2.5,"rgba(126,152,188,256)",4.12,"rgba(110,143,208,256)",4.63,"rgba(110,143,208,256)",6.17,"rgba(15,147,167,256)",7.72,"rgba(15,147,167,256)",9.26,"rgba(57,163,57,256)",10.29,"rgba(57,163,57,256)",11.83,"rgba(194,134,62,256)",13.37,"rgba(194,134,63,256)",14.92,"rgba(200,66,13,256)",16.46,"rgba(200,66,13,256)",18,"rgba(210,0,50,256)",20.06,"rgba(215,0,50,256)",21.6,"rgba(175,80,136,256)",23.66,"rgba(175,80,136,256)",25.21,"rgba(117,74,147,256)",27.78,"rgba(117,74,147,256)",29.32,"rgba(68,105,141,256)",31.89,"rgba(68,105,141,256)",33.44,"rgba(194,251,119,256)",42.18,"rgba(194,251,119,256)",43.72,"rgba(241,255,109,256)",48.87,"rgba(241,255,109,256)",50.41,"rgba(256,256,256,256)",57.61,"rgba(256,256,256,256)",59.16,"rgba(0,256,256,256)",68.93,"rgba(0,256,256,256)",69.44,"rgba(256,37,256,256)"]}}),s.current=t;const O=WB(t);c(O);const N=Array.isArray(r)?r:r?.features||[],H=[],j=[],V=[];let Z=0;N.forEach(pe=>{const K=pe.geometry?.type;if(K==="Point")H.push(pe);else if(K==="Polygon")O.add({type:"Feature",geometry:pe.geometry,properties:pe.properties||{}});else if(K==="LineString"){Z++;const ye=pe.geometry?.coordinates;Array.isArray(ye)&&ye.length===1&&Array.isArray(ye[0])&&Array.isArray(ye[0][0])&&(pe.geometry.coordinates=ye[0]),(pe.properties?.isFront?j:V).push(pe)}}),typeof S=="function"&&S(Z),H.length>0&&H.forEach(pe=>{const[K]=pe.geometry?.coordinates||[],[ye,J]=K,[de,Ae]=ye,ne=pe.name||"";pe.sourceId;const xe=pe.properties.type;de!==void 0&&Ae!==void 0&&ax({lat:Ae,lng:de},s,()=>{},xe)(ne)}),V.length>0&&V.forEach(pe=>{const K={type:"Feature",geometry:pe.geometry,properties:pe.properties,id:pe._id},ye=pe.sourceId,J=pe.sourceId||"non-front-lines";t.addSource(J,{type:"geojson",data:K});const Ae=pe.properties?.labelValue<2;t.addLayer({id:ye,type:"line",source:J,slot:"top",paint:{"line-color":R,"line-opacity":.5,"line-width":3,"line-dasharray":Ae?[.5,.5]:[]},filter:["==","$type","LineString"]});const ne=pe.geometry?.coordinates,xe=pe.properties||{},Ce=String(xe.labelValue||pe.name||"Label"),Re=xe.closedMode,Ee=pe._id;if(Array.isArray(ne)&&ne.length>=2){let Oe=[];if(Re){const[Be,at]=ne[0];Oe.push([Be,at])}else{const[Be,at]=ne[0],[ut,nt]=ne[ne.length-1];Oe.push([Be,at],[ut,nt])}Oe.forEach((Be,at)=>{const ut=`${ye}-${at}`,nt=`${ye}-${at}`;t.addSource(ut,{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",id:`${Ee}-${at}`,geometry:{type:"Point",coordinates:Be},properties:{text:Ce}}]}}),t.addLayer({id:nt,type:"symbol",source:ut,slot:"top",layout:{"text-field":["get","text"],"text-size":18,"text-anchor":"bottom","text-offset":[0,.5]},paint:{"text-color":D,"text-halo-width":2,"text-halo-color":z?"#19b8b7":"#ffffff"}})})}});let X=[];j.length>0&&j.forEach((pe,K)=>{const ye=pe.sourceId,J=`${ye}_bg`,de=`${ye}_dash`;t.addSource(ye,{type:"geojson",data:{type:"FeatureCollection",features:[pe]}}),t.addLayer({id:J,type:"line",source:ye,slot:"top",paint:{"line-color":"#0000FF","line-width":6,"line-opacity":.8}}),t.addLayer({id:de,type:"line",source:ye,slot:"top",paint:{"line-color":"#FF0000","line-width":6,"line-dasharray":[0,4,3]}})});const se=localStorage.getItem("PAR"),ge=localStorage.getItem("TCID"),ae=localStorage.getItem("TCAD"),oe=localStorage.getItem("SHIPPING_ZONE"),fe=localStorage.getItem("wind_layer");return se==="true"?(t.setLayoutProperty("PAR","visibility","visible"),t.setLayoutProperty("PAR_dash","visibility","visible")):(t.setLayoutProperty("PAR","visibility","none"),t.setLayoutProperty("PAR_dash","visibility","none")),ge==="true"?t.setLayoutProperty("TCID","visibility","visible"):t.setLayoutProperty("TCID","visibility","none"),ae==="true"?t.setLayoutProperty("TCAD","visibility","visible"):t.setLayoutProperty("TCAD","visibility","none"),oe==="true"?(t.setLayoutProperty("graticules","visibility","visible"),t.setLayoutProperty("country-boundaries","visibility","visible"),t.setLayoutProperty("ERA5_c1","visibility","visible"),t.setLayoutProperty("ERA5_c2","visibility","visible")):(t.setLayoutProperty("graticules","visibility","none"),t.setLayoutProperty("country-boundaries","visibility","none"),t.setLayoutProperty("ERA5_c1","visibility","none"),t.setLayoutProperty("ERA5_c2","visibility","none")),fe==="true"?t.setLayoutProperty("wind-layer","visibility","visible"):t.setLayoutProperty("wind-layer","visibility","none"),t.on("draw.create",pe=>{const K=pe.features[0];if(K?.geometry.type==="Point"){const[ye,J]=K.geometry.coordinates;g({lng:ye,lat:J}),(I?.current||"").toLowerCase()!=="less_1"&&v(!0),O.delete(K.id)}}),t.once("idle",()=>{typeof A=="function"&&A(!1),p(!0);try{const K=t.getCanvas().toDataURL("image/png"),ye=localStorage.getItem("isDarkMode")==="true",J=ye?"map_snapshot_dark":"map_snapshot_light";localStorage.setItem(J,K),typeof F=="function"&&F(de=>({...de,[ye?"dark":"light"]:K}))}catch(pe){console.error(" Error capturing map snapshot:",pe)}}),p(!0),function(){X.forEach(K=>cancelAnimationFrame(K))}}const nne=pn.div`
  position: relative;
  height: 100vh;
  width: 100%;
  display: flex;
  overflow: hidden;
`,rne=pn.div`
  flex-grow: 1;
  width: ${({collapsed:t})=>t?"100vw":"calc(100vw - 250px)"};
  height: 100%;
  transition: width 0.3s ease;
  position: relative;
`,ine=ll`
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
`,one=pn.div`
  position: fixed;
  top: 5rem;
  left: 0.8rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  z-index: 100;
  animation: ${ine} 0.6s ease-out;

  @media (max-width: 768px) {
    top: 1rem;
    right: 1rem;
    left: 1rem;
    flex-direction: column;
    align-items: stretch;
  }
`,sne=ll`
  0%, 100% { border-color: transparent; }
  50% { border-color: #f59e0b; } /* amber/orange */
`;pn.div`
  border: 2px solid transparent;
  border-radius: 8px;
  display: inline-block;
  animation: ${({blink:t})=>t?uh`${sne} 0.5s ease-in-out infinite`:"none"};
`;const Qne=({isDarkMode:t,setIsDarkMode:s,logger:c})=>{const[p,g]=Te.useState(!1),[v,S]=Te.useState([]),[r,E]=Te.useState(null),[A,I]=Te.useState(!1),[F,z]=Te.useState(!1),[R,D]=Te.useState(0),[O,N]=Te.useState(0),[H,j]=Te.useState(!1),[V,Z]=Te.useState(null),[X,se]=Te.useState(!1),[ge,ae]=Te.useState(""),[oe,fe]=Te.useState(!1),[pe,K]=Te.useState(!1),[ye,J]=Te.useState(null),[de,Ae]=Te.useState([]),[ne,xe]=Te.useState(!0),[Ce,Re]=Te.useState(!1),[Ee,Oe]=Te.useState(null),[Be,at]=Te.useState(!0),[ut,nt]=Te.useState({light:null,dark:null}),$e=Te.useRef(null),ct=Te.useRef(null),At=Te.useRef(null),xt=Te.useRef(),It=Te.useRef("");let jt=localStorage.getItem("projectId");Te.useEffect(()=>{if(!jt){Re(Ce);const je=setTimeout(()=>Re(!1),3e3);return()=>clearTimeout(je)}},[jt]),Te.useEffect(()=>{jt?at(!1):(async()=>{try{const gt=await Qj();Oe(gt),localStorage.setItem("projectId",gt._id),jt=gt._id}catch(gt){at(!1),xe(!1),console.error("Failed to fetch the latest project:",gt),Po.fire({icon:"info",title:"No Projects Found",text:"Please create a new project to get started."}).then(()=>{Re(!0)})}finally{at(!1)}})()},[]),Te.useEffect(()=>{xt.current=S},[S]);const cn=Te.useCallback(()=>I(je=>!je),[]),Se=Te.useCallback(()=>z(je=>!je),[]),mt=je=>{It.current=je,ae(je),ax(V,ct,se,ye)(je);const gt=[V.lng,V.lat];Ow({coords:gt,title:je,selectedType:ye,setLayersRef:xt})},Ke=je=>{It.current=je,ae(je)},Ue=Te.useCallback(async je=>{ct.current=je;const gt=async()=>{try{if(jt){const Ft=(await RF(jt)).filter(dn=>dn?.properties?.project===jt);Ae(Ft);const pt=Ft.map(dn=>({id:dn.sourceId,name:dn.name||"Untitled Feature",visible:!0,locked:!1,type:dn.properties.type||"Wave Height"}));S(pt),At.current=TM({map:je,mapRef:ct,setDrawInstance:E,setMapLoaded:j,setSelectedPoint:Z,setShowTitleModal:se,setLineCount:D,initialFeatures:{type:"FeatureCollection",features:Ft},logger:c,setLoading:xe,selectedToolRef:$e,setCapturedImages:nt,isDarkMode:t})}}catch(Ot){console.error("[MAP LOAD ERROR]",Ot),At.current=TM({map:je,mapRef:ct,setDrawInstance:E,setMapLoaded:j,setSelectedPoint:Z,setShowTitleModal:se})}};await gt(),je._hasStyleLoadListener||(je.on("style.load",gt),je._hasStyleLoadListener=!0)},[]);return Te.useEffect(()=>()=>{At.current},[]),Te.useEffect(()=>{let je;const gt=()=>{clearTimeout(je),je=setTimeout(()=>{window.location.reload()},9e4)};return window.addEventListener("mousemove",gt),window.addEventListener("keydown",gt),window.addEventListener("click",gt),window.addEventListener("scroll",gt),gt(),()=>{clearTimeout(je),window.removeEventListener("mousemove",gt),window.removeEventListener("keydown",gt),window.removeEventListener("click",gt),window.removeEventListener("scroll",gt)}},[]),Te.useEffect(()=>{const je=setTimeout(()=>fe(!0),1e3);return()=>clearTimeout(je)},[]),ue.jsxs(nne,{children:[ue.jsx(rne,{collapsed:p,children:ue.jsx($L,{onMapLoad:Ue,isDarkMode:t})}),oe&&jt&&ue.jsx(tN,{draw:r,mapRef:ct,onToggleCanvas:cn,onToggleFlagCanvas:Se,isCanvasActive:A,isFlagCanvasActive:F,isDarkMode:t,layers:v,setLayers:S,setLayersRef:xt,closedMode:pe,setClosedMode:K,setType:J,selectedToolRef:$e,title:ge}),A&&ue.jsx(PQ,{mapRef:ct,drawRef:r,drawCounter:O,setDrawCounter:N,isDarkMode:t,setLayersRef:xt,closedMode:pe,lineCount:R}),F&&ue.jsx(kQ,{mapRef:ct,drawRef:r,drawCounter:O,setDrawCounter:N,isDarkMode:t,setLayersRef:xt,closedMode:pe}),ue.jsx(Zte,{isOpen:X,onClose:()=>se(!1),onSave:mt,inputValue:ge,onInputChange:Ke}),!Be&&ue.jsxs(ue.Fragment,{children:[ue.jsxs(one,{children:[ue.jsx(Dte,{blink:Ce,projectId:jt,mapRef:ct,features:{type:"FeatureCollection",features:de},isDarkMode:t,setIsDarkMode:s,setMapLoaded:j,isLoading:ne}),ue.jsx(Vte,{layers:v,setLayers:S,mapRef:ct,isDarkMode:t,draw:r,setIsLoading:xe,isLoading:ne})]}),ue.jsx(s8,{layers:v,setLayers:S,mapRef:ct,isDarkMode:t,draw:r}),ue.jsx(UQ,{isDarkMode:t})]}),ne&&ue.jsx(tne,{})]})};export{Qne as default};
